var nj=e=>{throw TypeError(e)};var QT=(e,t,i)=>t.has(e)||nj("Cannot "+i);var $t=(e,t,i)=>(QT(e,t,"read from private field"),i?i.call(e):t.get(e)),ci=(e,t,i)=>t.has(e)?nj("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,i),An=(e,t,i,a)=>(QT(e,t,"write to private field"),a?a.call(e,i):t.set(e,i),i),to=(e,t,i)=>(QT(e,t,"access private method"),i);var q1=(e,t,i,a)=>({set _(d){An(e,t,d,i)},get _(){return $t(e,t,a)}});function D7(e,t){for(var i=0;i<t.length;i++){const a=t[i];if(typeof a!="string"&&!Array.isArray(a)){for(const d in a)if(d!=="default"&&!(d in e)){const y=Object.getOwnPropertyDescriptor(a,d);y&&Object.defineProperty(e,d,y.get?y:{enumerable:!0,get:()=>a[d]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))a(d);new MutationObserver(d=>{for(const y of d)if(y.type==="childList")for(const S of y.addedNodes)S.tagName==="LINK"&&S.rel==="modulepreload"&&a(S)}).observe(document,{childList:!0,subtree:!0});function i(d){const y={};return d.integrity&&(y.integrity=d.integrity),d.referrerPolicy&&(y.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?y.credentials="include":d.crossOrigin==="anonymous"?y.credentials="omit":y.credentials="same-origin",y}function a(d){if(d.ep)return;d.ep=!0;const y=i(d);fetch(d.href,y)}})();var Ta=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ZM(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function L7(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var i=function a(){return this instanceof a?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};i.prototype=t.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(e).forEach(function(a){var d=Object.getOwnPropertyDescriptor(e,a);Object.defineProperty(i,a,d.get?d:{enumerable:!0,get:function(){return e[a]}})}),i}var nL={exports:{}},Yw={},iL={exports:{}},Ln={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Nv=Symbol.for("react.element"),O7=Symbol.for("react.portal"),z7=Symbol.for("react.fragment"),F7=Symbol.for("react.strict_mode"),B7=Symbol.for("react.profiler"),V7=Symbol.for("react.provider"),U7=Symbol.for("react.context"),$7=Symbol.for("react.forward_ref"),G7=Symbol.for("react.suspense"),q7=Symbol.for("react.memo"),H7=Symbol.for("react.lazy"),ij=Symbol.iterator;function W7(e){return e===null||typeof e!="object"?null:(e=ij&&e[ij]||e["@@iterator"],typeof e=="function"?e:null)}var sL={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},oL=Object.assign,aL={};function Ng(e,t,i){this.props=e,this.context=t,this.refs=aL,this.updater=i||sL}Ng.prototype.isReactComponent={};Ng.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Ng.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function lL(){}lL.prototype=Ng.prototype;function YM(e,t,i){this.props=e,this.context=t,this.refs=aL,this.updater=i||sL}var XM=YM.prototype=new lL;XM.constructor=YM;oL(XM,Ng.prototype);XM.isPureReactComponent=!0;var sj=Array.isArray,cL=Object.prototype.hasOwnProperty,KM={current:null},uL={key:!0,ref:!0,__self:!0,__source:!0};function dL(e,t,i){var a,d={},y=null,S=null;if(t!=null)for(a in t.ref!==void 0&&(S=t.ref),t.key!==void 0&&(y=""+t.key),t)cL.call(t,a)&&!uL.hasOwnProperty(a)&&(d[a]=t[a]);var s=arguments.length-2;if(s===1)d.children=i;else if(1<s){for(var N=Array(s),D=0;D<s;D++)N[D]=arguments[D+2];d.children=N}if(e&&e.defaultProps)for(a in s=e.defaultProps,s)d[a]===void 0&&(d[a]=s[a]);return{$$typeof:Nv,type:e,key:y,ref:S,props:d,_owner:KM.current}}function Z7(e,t){return{$$typeof:Nv,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function JM(e){return typeof e=="object"&&e!==null&&e.$$typeof===Nv}function Y7(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(i){return t[i]})}var oj=/\/+/g;function eE(e,t){return typeof e=="object"&&e!==null&&e.key!=null?Y7(""+e.key):t.toString(36)}function Cb(e,t,i,a,d){var y=typeof e;(y==="undefined"||y==="boolean")&&(e=null);var S=!1;if(e===null)S=!0;else switch(y){case"string":case"number":S=!0;break;case"object":switch(e.$$typeof){case Nv:case O7:S=!0}}if(S)return S=e,d=d(S),e=a===""?"."+eE(S,0):a,sj(d)?(i="",e!=null&&(i=e.replace(oj,"$&/")+"/"),Cb(d,t,i,"",function(D){return D})):d!=null&&(JM(d)&&(d=Z7(d,i+(!d.key||S&&S.key===d.key?"":(""+d.key).replace(oj,"$&/")+"/")+e)),t.push(d)),1;if(S=0,a=a===""?".":a+":",sj(e))for(var s=0;s<e.length;s++){y=e[s];var N=a+eE(y,s);S+=Cb(y,t,i,N,d)}else if(N=W7(e),typeof N=="function")for(e=N.call(e),s=0;!(y=e.next()).done;)y=y.value,N=a+eE(y,s++),S+=Cb(y,t,i,N,d);else if(y==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return S}function H1(e,t,i){if(e==null)return e;var a=[],d=0;return Cb(e,a,"","",function(y){return t.call(i,y,d++)}),a}function X7(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(i){(e._status===0||e._status===-1)&&(e._status=1,e._result=i)},function(i){(e._status===0||e._status===-1)&&(e._status=2,e._result=i)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Io={current:null},Mb={transition:null},K7={ReactCurrentDispatcher:Io,ReactCurrentBatchConfig:Mb,ReactCurrentOwner:KM};function hL(){throw Error("act(...) is not supported in production builds of React.")}Ln.Children={map:H1,forEach:function(e,t,i){H1(e,function(){t.apply(this,arguments)},i)},count:function(e){var t=0;return H1(e,function(){t++}),t},toArray:function(e){return H1(e,function(t){return t})||[]},only:function(e){if(!JM(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Ln.Component=Ng;Ln.Fragment=z7;Ln.Profiler=B7;Ln.PureComponent=YM;Ln.StrictMode=F7;Ln.Suspense=G7;Ln.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=K7;Ln.act=hL;Ln.cloneElement=function(e,t,i){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var a=oL({},e.props),d=e.key,y=e.ref,S=e._owner;if(t!=null){if(t.ref!==void 0&&(y=t.ref,S=KM.current),t.key!==void 0&&(d=""+t.key),e.type&&e.type.defaultProps)var s=e.type.defaultProps;for(N in t)cL.call(t,N)&&!uL.hasOwnProperty(N)&&(a[N]=t[N]===void 0&&s!==void 0?s[N]:t[N])}var N=arguments.length-2;if(N===1)a.children=i;else if(1<N){s=Array(N);for(var D=0;D<N;D++)s[D]=arguments[D+2];a.children=s}return{$$typeof:Nv,type:e.type,key:d,ref:y,props:a,_owner:S}};Ln.createContext=function(e){return e={$$typeof:U7,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:V7,_context:e},e.Consumer=e};Ln.createElement=dL;Ln.createFactory=function(e){var t=dL.bind(null,e);return t.type=e,t};Ln.createRef=function(){return{current:null}};Ln.forwardRef=function(e){return{$$typeof:$7,render:e}};Ln.isValidElement=JM;Ln.lazy=function(e){return{$$typeof:H7,_payload:{_status:-1,_result:e},_init:X7}};Ln.memo=function(e,t){return{$$typeof:q7,type:e,compare:t===void 0?null:t}};Ln.startTransition=function(e){var t=Mb.transition;Mb.transition={};try{e()}finally{Mb.transition=t}};Ln.unstable_act=hL;Ln.useCallback=function(e,t){return Io.current.useCallback(e,t)};Ln.useContext=function(e){return Io.current.useContext(e)};Ln.useDebugValue=function(){};Ln.useDeferredValue=function(e){return Io.current.useDeferredValue(e)};Ln.useEffect=function(e,t){return Io.current.useEffect(e,t)};Ln.useId=function(){return Io.current.useId()};Ln.useImperativeHandle=function(e,t,i){return Io.current.useImperativeHandle(e,t,i)};Ln.useInsertionEffect=function(e,t){return Io.current.useInsertionEffect(e,t)};Ln.useLayoutEffect=function(e,t){return Io.current.useLayoutEffect(e,t)};Ln.useMemo=function(e,t){return Io.current.useMemo(e,t)};Ln.useReducer=function(e,t,i){return Io.current.useReducer(e,t,i)};Ln.useRef=function(e){return Io.current.useRef(e)};Ln.useState=function(e){return Io.current.useState(e)};Ln.useSyncExternalStore=function(e,t,i){return Io.current.useSyncExternalStore(e,t,i)};Ln.useTransition=function(){return Io.current.useTransition()};Ln.version="18.3.1";iL.exports=Ln;var H=iL.exports;const Gt=ZM(H),fL=D7({__proto__:null,default:Gt},[H]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var J7=H,Q7=Symbol.for("react.element"),eG=Symbol.for("react.fragment"),tG=Object.prototype.hasOwnProperty,rG=J7.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,nG={key:!0,ref:!0,__self:!0,__source:!0};function pL(e,t,i){var a,d={},y=null,S=null;i!==void 0&&(y=""+i),t.key!==void 0&&(y=""+t.key),t.ref!==void 0&&(S=t.ref);for(a in t)tG.call(t,a)&&!nG.hasOwnProperty(a)&&(d[a]=t[a]);if(e&&e.defaultProps)for(a in t=e.defaultProps,t)d[a]===void 0&&(d[a]=t[a]);return{$$typeof:Q7,type:e,key:y,ref:S,props:d,_owner:rG.current}}Yw.Fragment=eG;Yw.jsx=pL;Yw.jsxs=pL;nL.exports=Yw;var f=nL.exports,mL={exports:{}},Ma={},gL={exports:{}},_L={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(Xe,nt){var Qt=Xe.length;Xe.push(nt);e:for(;0<Qt;){var rr=Qt-1>>>1,mr=Xe[rr];if(0<d(mr,nt))Xe[rr]=nt,Xe[Qt]=mr,Qt=rr;else break e}}function i(Xe){return Xe.length===0?null:Xe[0]}function a(Xe){if(Xe.length===0)return null;var nt=Xe[0],Qt=Xe.pop();if(Qt!==nt){Xe[0]=Qt;e:for(var rr=0,mr=Xe.length,Ut=mr>>>1;rr<Ut;){var hn=2*(rr+1)-1,Gn=Xe[hn],At=hn+1,qt=Xe[At];if(0>d(Gn,Qt))At<mr&&0>d(qt,Gn)?(Xe[rr]=qt,Xe[At]=Qt,rr=At):(Xe[rr]=Gn,Xe[hn]=Qt,rr=hn);else if(At<mr&&0>d(qt,Qt))Xe[rr]=qt,Xe[At]=Qt,rr=At;else break e}}return nt}function d(Xe,nt){var Qt=Xe.sortIndex-nt.sortIndex;return Qt!==0?Qt:Xe.id-nt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var y=performance;e.unstable_now=function(){return y.now()}}else{var S=Date,s=S.now();e.unstable_now=function(){return S.now()-s}}var N=[],D=[],O=1,$=null,q=3,J=!1,re=!1,Q=!1,ce=typeof setTimeout=="function"?setTimeout:null,le=typeof clearTimeout=="function"?clearTimeout:null,ae=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function he(Xe){for(var nt=i(D);nt!==null;){if(nt.callback===null)a(D);else if(nt.startTime<=Xe)a(D),nt.sortIndex=nt.expirationTime,t(N,nt);else break;nt=i(D)}}function Se(Xe){if(Q=!1,he(Xe),!re)if(i(N)!==null)re=!0,Wt(je);else{var nt=i(D);nt!==null&&Nt(Se,nt.startTime-Xe)}}function je(Xe,nt){re=!1,Q&&(Q=!1,le(ct),ct=-1),J=!0;var Qt=q;try{for(he(nt),$=i(N);$!==null&&(!($.expirationTime>nt)||Xe&&!yt());){var rr=$.callback;if(typeof rr=="function"){$.callback=null,q=$.priorityLevel;var mr=rr($.expirationTime<=nt);nt=e.unstable_now(),typeof mr=="function"?$.callback=mr:$===i(N)&&a(N),he(nt)}else a(N);$=i(N)}if($!==null)var Ut=!0;else{var hn=i(D);hn!==null&&Nt(Se,hn.startTime-nt),Ut=!1}return Ut}finally{$=null,q=Qt,J=!1}}var it=!1,qe=null,ct=-1,pt=5,Ze=-1;function yt(){return!(e.unstable_now()-Ze<pt)}function Mt(){if(qe!==null){var Xe=e.unstable_now();Ze=Xe;var nt=!0;try{nt=qe(!0,Xe)}finally{nt?Jt():(it=!1,qe=null)}}else it=!1}var Jt;if(typeof ae=="function")Jt=function(){ae(Mt)};else if(typeof MessageChannel<"u"){var jt=new MessageChannel,Pt=jt.port2;jt.port1.onmessage=Mt,Jt=function(){Pt.postMessage(null)}}else Jt=function(){ce(Mt,0)};function Wt(Xe){qe=Xe,it||(it=!0,Jt())}function Nt(Xe,nt){ct=ce(function(){Xe(e.unstable_now())},nt)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(Xe){Xe.callback=null},e.unstable_continueExecution=function(){re||J||(re=!0,Wt(je))},e.unstable_forceFrameRate=function(Xe){0>Xe||125<Xe?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):pt=0<Xe?Math.floor(1e3/Xe):5},e.unstable_getCurrentPriorityLevel=function(){return q},e.unstable_getFirstCallbackNode=function(){return i(N)},e.unstable_next=function(Xe){switch(q){case 1:case 2:case 3:var nt=3;break;default:nt=q}var Qt=q;q=nt;try{return Xe()}finally{q=Qt}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(Xe,nt){switch(Xe){case 1:case 2:case 3:case 4:case 5:break;default:Xe=3}var Qt=q;q=Xe;try{return nt()}finally{q=Qt}},e.unstable_scheduleCallback=function(Xe,nt,Qt){var rr=e.unstable_now();switch(typeof Qt=="object"&&Qt!==null?(Qt=Qt.delay,Qt=typeof Qt=="number"&&0<Qt?rr+Qt:rr):Qt=rr,Xe){case 1:var mr=-1;break;case 2:mr=250;break;case 5:mr=1073741823;break;case 4:mr=1e4;break;default:mr=5e3}return mr=Qt+mr,Xe={id:O++,callback:nt,priorityLevel:Xe,startTime:Qt,expirationTime:mr,sortIndex:-1},Qt>rr?(Xe.sortIndex=Qt,t(D,Xe),i(N)===null&&Xe===i(D)&&(Q?(le(ct),ct=-1):Q=!0,Nt(Se,Qt-rr))):(Xe.sortIndex=mr,t(N,Xe),re||J||(re=!0,Wt(je))),Xe},e.unstable_shouldYield=yt,e.unstable_wrapCallback=function(Xe){var nt=q;return function(){var Qt=q;q=nt;try{return Xe.apply(this,arguments)}finally{q=Qt}}}})(_L);gL.exports=_L;var iG=gL.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sG=H,Ea=iG;function nr(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,i=1;i<arguments.length;i++)t+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var yL=new Set,Lx={};function Zf(e,t){hg(e,t),hg(e+"Capture",t)}function hg(e,t){for(Lx[e]=t,e=0;e<t.length;e++)yL.add(t[e])}var uu=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),lC=Object.prototype.hasOwnProperty,oG=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,aj={},lj={};function aG(e){return lC.call(lj,e)?!0:lC.call(aj,e)?!1:oG.test(e)?lj[e]=!0:(aj[e]=!0,!1)}function lG(e,t,i,a){if(i!==null&&i.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return a?!1:i!==null?!i.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function cG(e,t,i,a){if(t===null||typeof t>"u"||lG(e,t,i,a))return!0;if(a)return!1;if(i!==null)switch(i.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function ko(e,t,i,a,d,y,S){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=a,this.attributeNamespace=d,this.mustUseProperty=i,this.propertyName=e,this.type=t,this.sanitizeURL=y,this.removeEmptyString=S}var Zs={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Zs[e]=new ko(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Zs[t]=new ko(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Zs[e]=new ko(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Zs[e]=new ko(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Zs[e]=new ko(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Zs[e]=new ko(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Zs[e]=new ko(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Zs[e]=new ko(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Zs[e]=new ko(e,5,!1,e.toLowerCase(),null,!1,!1)});var QM=/[\-:]([a-z])/g;function eA(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(QM,eA);Zs[t]=new ko(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(QM,eA);Zs[t]=new ko(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(QM,eA);Zs[t]=new ko(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Zs[e]=new ko(e,1,!1,e.toLowerCase(),null,!1,!1)});Zs.xlinkHref=new ko("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Zs[e]=new ko(e,1,!1,e.toLowerCase(),null,!0,!0)});function tA(e,t,i,a){var d=Zs.hasOwnProperty(t)?Zs[t]:null;(d!==null?d.type!==0:a||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(cG(t,i,d,a)&&(i=null),a||d===null?aG(t)&&(i===null?e.removeAttribute(t):e.setAttribute(t,""+i)):d.mustUseProperty?e[d.propertyName]=i===null?d.type===3?!1:"":i:(t=d.attributeName,a=d.attributeNamespace,i===null?e.removeAttribute(t):(d=d.type,i=d===3||d===4&&i===!0?"":""+i,a?e.setAttributeNS(a,t,i):e.setAttribute(t,i))))}var vu=sG.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,W1=Symbol.for("react.element"),km=Symbol.for("react.portal"),Nm=Symbol.for("react.fragment"),rA=Symbol.for("react.strict_mode"),cC=Symbol.for("react.profiler"),xL=Symbol.for("react.provider"),vL=Symbol.for("react.context"),nA=Symbol.for("react.forward_ref"),uC=Symbol.for("react.suspense"),dC=Symbol.for("react.suspense_list"),iA=Symbol.for("react.memo"),Cd=Symbol.for("react.lazy"),bL=Symbol.for("react.offscreen"),cj=Symbol.iterator;function Gy(e){return e===null||typeof e!="object"?null:(e=cj&&e[cj]||e["@@iterator"],typeof e=="function"?e:null)}var Zi=Object.assign,tE;function ox(e){if(tE===void 0)try{throw Error()}catch(i){var t=i.stack.trim().match(/\n( *(at )?)/);tE=t&&t[1]||""}return`
`+tE+e}var rE=!1;function nE(e,t){if(!e||rE)return"";rE=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(D){var a=D}Reflect.construct(e,[],t)}else{try{t.call()}catch(D){a=D}e.call(t.prototype)}else{try{throw Error()}catch(D){a=D}e()}}catch(D){if(D&&a&&typeof D.stack=="string"){for(var d=D.stack.split(`
`),y=a.stack.split(`
`),S=d.length-1,s=y.length-1;1<=S&&0<=s&&d[S]!==y[s];)s--;for(;1<=S&&0<=s;S--,s--)if(d[S]!==y[s]){if(S!==1||s!==1)do if(S--,s--,0>s||d[S]!==y[s]){var N=`
`+d[S].replace(" at new "," at ");return e.displayName&&N.includes("<anonymous>")&&(N=N.replace("<anonymous>",e.displayName)),N}while(1<=S&&0<=s);break}}}finally{rE=!1,Error.prepareStackTrace=i}return(e=e?e.displayName||e.name:"")?ox(e):""}function uG(e){switch(e.tag){case 5:return ox(e.type);case 16:return ox("Lazy");case 13:return ox("Suspense");case 19:return ox("SuspenseList");case 0:case 2:case 15:return e=nE(e.type,!1),e;case 11:return e=nE(e.type.render,!1),e;case 1:return e=nE(e.type,!0),e;default:return""}}function hC(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Nm:return"Fragment";case km:return"Portal";case cC:return"Profiler";case rA:return"StrictMode";case uC:return"Suspense";case dC:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case vL:return(e.displayName||"Context")+".Consumer";case xL:return(e._context.displayName||"Context")+".Provider";case nA:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case iA:return t=e.displayName||null,t!==null?t:hC(e.type)||"Memo";case Cd:t=e._payload,e=e._init;try{return hC(e(t))}catch{}}return null}function dG(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return hC(t);case 8:return t===rA?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function th(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function wL(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function hG(e){var t=wL(e)?"checked":"value",i=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),a=""+e[t];if(!e.hasOwnProperty(t)&&typeof i<"u"&&typeof i.get=="function"&&typeof i.set=="function"){var d=i.get,y=i.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return d.call(this)},set:function(S){a=""+S,y.call(this,S)}}),Object.defineProperty(e,t,{enumerable:i.enumerable}),{getValue:function(){return a},setValue:function(S){a=""+S},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Z1(e){e._valueTracker||(e._valueTracker=hG(e))}function SL(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var i=t.getValue(),a="";return e&&(a=wL(e)?e.checked?"true":"false":e.value),e=a,e!==i?(t.setValue(e),!0):!1}function Wb(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function fC(e,t){var i=t.checked;return Zi({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:i??e._wrapperState.initialChecked})}function uj(e,t){var i=t.defaultValue==null?"":t.defaultValue,a=t.checked!=null?t.checked:t.defaultChecked;i=th(t.value!=null?t.value:i),e._wrapperState={initialChecked:a,initialValue:i,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function TL(e,t){t=t.checked,t!=null&&tA(e,"checked",t,!1)}function pC(e,t){TL(e,t);var i=th(t.value),a=t.type;if(i!=null)a==="number"?(i===0&&e.value===""||e.value!=i)&&(e.value=""+i):e.value!==""+i&&(e.value=""+i);else if(a==="submit"||a==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?mC(e,t.type,i):t.hasOwnProperty("defaultValue")&&mC(e,t.type,th(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function dj(e,t,i){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var a=t.type;if(!(a!=="submit"&&a!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,i||t===e.value||(e.value=t),e.defaultValue=t}i=e.name,i!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,i!==""&&(e.name=i)}function mC(e,t,i){(t!=="number"||Wb(e.ownerDocument)!==e)&&(i==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+i&&(e.defaultValue=""+i))}var ax=Array.isArray;function Gm(e,t,i,a){if(e=e.options,t){t={};for(var d=0;d<i.length;d++)t["$"+i[d]]=!0;for(i=0;i<e.length;i++)d=t.hasOwnProperty("$"+e[i].value),e[i].selected!==d&&(e[i].selected=d),d&&a&&(e[i].defaultSelected=!0)}else{for(i=""+th(i),t=null,d=0;d<e.length;d++){if(e[d].value===i){e[d].selected=!0,a&&(e[d].defaultSelected=!0);return}t!==null||e[d].disabled||(t=e[d])}t!==null&&(t.selected=!0)}}function gC(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(nr(91));return Zi({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function hj(e,t){var i=t.value;if(i==null){if(i=t.children,t=t.defaultValue,i!=null){if(t!=null)throw Error(nr(92));if(ax(i)){if(1<i.length)throw Error(nr(93));i=i[0]}t=i}t==null&&(t=""),i=t}e._wrapperState={initialValue:th(i)}}function EL(e,t){var i=th(t.value),a=th(t.defaultValue);i!=null&&(i=""+i,i!==e.value&&(e.value=i),t.defaultValue==null&&e.defaultValue!==i&&(e.defaultValue=i)),a!=null&&(e.defaultValue=""+a)}function fj(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function CL(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function _C(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?CL(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var Y1,ML=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,i,a,d){MSApp.execUnsafeLocalFunction(function(){return e(t,i,a,d)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(Y1=Y1||document.createElement("div"),Y1.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Y1.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function Ox(e,t){if(t){var i=e.firstChild;if(i&&i===e.lastChild&&i.nodeType===3){i.nodeValue=t;return}}e.textContent=t}var vx={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},fG=["Webkit","ms","Moz","O"];Object.keys(vx).forEach(function(e){fG.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),vx[t]=vx[e]})});function AL(e,t,i){return t==null||typeof t=="boolean"||t===""?"":i||typeof t!="number"||t===0||vx.hasOwnProperty(e)&&vx[e]?(""+t).trim():t+"px"}function PL(e,t){e=e.style;for(var i in t)if(t.hasOwnProperty(i)){var a=i.indexOf("--")===0,d=AL(i,t[i],a);i==="float"&&(i="cssFloat"),a?e.setProperty(i,d):e[i]=d}}var pG=Zi({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function yC(e,t){if(t){if(pG[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(nr(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(nr(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(nr(61))}if(t.style!=null&&typeof t.style!="object")throw Error(nr(62))}}function xC(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var vC=null;function sA(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var bC=null,qm=null,Hm=null;function pj(e){if(e=Dv(e)){if(typeof bC!="function")throw Error(nr(280));var t=e.stateNode;t&&(t=e2(t),bC(e.stateNode,e.type,t))}}function IL(e){qm?Hm?Hm.push(e):Hm=[e]:qm=e}function kL(){if(qm){var e=qm,t=Hm;if(Hm=qm=null,pj(e),t)for(e=0;e<t.length;e++)pj(t[e])}}function NL(e,t){return e(t)}function RL(){}var iE=!1;function jL(e,t,i){if(iE)return e(t,i);iE=!0;try{return NL(e,t,i)}finally{iE=!1,(qm!==null||Hm!==null)&&(RL(),kL())}}function zx(e,t){var i=e.stateNode;if(i===null)return null;var a=e2(i);if(a===null)return null;i=a[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(a=!a.disabled)||(e=e.type,a=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!a;break e;default:e=!1}if(e)return null;if(i&&typeof i!="function")throw Error(nr(231,t,typeof i));return i}var wC=!1;if(uu)try{var qy={};Object.defineProperty(qy,"passive",{get:function(){wC=!0}}),window.addEventListener("test",qy,qy),window.removeEventListener("test",qy,qy)}catch{wC=!1}function mG(e,t,i,a,d,y,S,s,N){var D=Array.prototype.slice.call(arguments,3);try{t.apply(i,D)}catch(O){this.onError(O)}}var bx=!1,Zb=null,Yb=!1,SC=null,gG={onError:function(e){bx=!0,Zb=e}};function _G(e,t,i,a,d,y,S,s,N){bx=!1,Zb=null,mG.apply(gG,arguments)}function yG(e,t,i,a,d,y,S,s,N){if(_G.apply(this,arguments),bx){if(bx){var D=Zb;bx=!1,Zb=null}else throw Error(nr(198));Yb||(Yb=!0,SC=D)}}function Yf(e){var t=e,i=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(i=t.return),e=t.return;while(e)}return t.tag===3?i:null}function DL(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function mj(e){if(Yf(e)!==e)throw Error(nr(188))}function xG(e){var t=e.alternate;if(!t){if(t=Yf(e),t===null)throw Error(nr(188));return t!==e?null:e}for(var i=e,a=t;;){var d=i.return;if(d===null)break;var y=d.alternate;if(y===null){if(a=d.return,a!==null){i=a;continue}break}if(d.child===y.child){for(y=d.child;y;){if(y===i)return mj(d),e;if(y===a)return mj(d),t;y=y.sibling}throw Error(nr(188))}if(i.return!==a.return)i=d,a=y;else{for(var S=!1,s=d.child;s;){if(s===i){S=!0,i=d,a=y;break}if(s===a){S=!0,a=d,i=y;break}s=s.sibling}if(!S){for(s=y.child;s;){if(s===i){S=!0,i=y,a=d;break}if(s===a){S=!0,a=y,i=d;break}s=s.sibling}if(!S)throw Error(nr(189))}}if(i.alternate!==a)throw Error(nr(190))}if(i.tag!==3)throw Error(nr(188));return i.stateNode.current===i?e:t}function LL(e){return e=xG(e),e!==null?OL(e):null}function OL(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=OL(e);if(t!==null)return t;e=e.sibling}return null}var zL=Ea.unstable_scheduleCallback,gj=Ea.unstable_cancelCallback,vG=Ea.unstable_shouldYield,bG=Ea.unstable_requestPaint,fs=Ea.unstable_now,wG=Ea.unstable_getCurrentPriorityLevel,oA=Ea.unstable_ImmediatePriority,FL=Ea.unstable_UserBlockingPriority,Xb=Ea.unstable_NormalPriority,SG=Ea.unstable_LowPriority,BL=Ea.unstable_IdlePriority,Xw=null,vc=null;function TG(e){if(vc&&typeof vc.onCommitFiberRoot=="function")try{vc.onCommitFiberRoot(Xw,e,void 0,(e.current.flags&128)===128)}catch{}}var Rl=Math.clz32?Math.clz32:MG,EG=Math.log,CG=Math.LN2;function MG(e){return e>>>=0,e===0?32:31-(EG(e)/CG|0)|0}var X1=64,K1=4194304;function lx(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Kb(e,t){var i=e.pendingLanes;if(i===0)return 0;var a=0,d=e.suspendedLanes,y=e.pingedLanes,S=i&268435455;if(S!==0){var s=S&~d;s!==0?a=lx(s):(y&=S,y!==0&&(a=lx(y)))}else S=i&~d,S!==0?a=lx(S):y!==0&&(a=lx(y));if(a===0)return 0;if(t!==0&&t!==a&&!(t&d)&&(d=a&-a,y=t&-t,d>=y||d===16&&(y&4194240)!==0))return t;if(a&4&&(a|=i&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=a;0<t;)i=31-Rl(t),d=1<<i,a|=e[i],t&=~d;return a}function AG(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function PG(e,t){for(var i=e.suspendedLanes,a=e.pingedLanes,d=e.expirationTimes,y=e.pendingLanes;0<y;){var S=31-Rl(y),s=1<<S,N=d[S];N===-1?(!(s&i)||s&a)&&(d[S]=AG(s,t)):N<=t&&(e.expiredLanes|=s),y&=~s}}function TC(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function VL(){var e=X1;return X1<<=1,!(X1&4194240)&&(X1=64),e}function sE(e){for(var t=[],i=0;31>i;i++)t.push(e);return t}function Rv(e,t,i){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Rl(t),e[t]=i}function IG(e,t){var i=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var a=e.eventTimes;for(e=e.expirationTimes;0<i;){var d=31-Rl(i),y=1<<d;t[d]=0,a[d]=-1,e[d]=-1,i&=~y}}function aA(e,t){var i=e.entangledLanes|=t;for(e=e.entanglements;i;){var a=31-Rl(i),d=1<<a;d&t|e[a]&t&&(e[a]|=t),i&=~d}}var yi=0;function UL(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var $L,lA,GL,qL,HL,EC=!1,J1=[],$d=null,Gd=null,qd=null,Fx=new Map,Bx=new Map,Id=[],kG="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function _j(e,t){switch(e){case"focusin":case"focusout":$d=null;break;case"dragenter":case"dragleave":Gd=null;break;case"mouseover":case"mouseout":qd=null;break;case"pointerover":case"pointerout":Fx.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Bx.delete(t.pointerId)}}function Hy(e,t,i,a,d,y){return e===null||e.nativeEvent!==y?(e={blockedOn:t,domEventName:i,eventSystemFlags:a,nativeEvent:y,targetContainers:[d]},t!==null&&(t=Dv(t),t!==null&&lA(t)),e):(e.eventSystemFlags|=a,t=e.targetContainers,d!==null&&t.indexOf(d)===-1&&t.push(d),e)}function NG(e,t,i,a,d){switch(t){case"focusin":return $d=Hy($d,e,t,i,a,d),!0;case"dragenter":return Gd=Hy(Gd,e,t,i,a,d),!0;case"mouseover":return qd=Hy(qd,e,t,i,a,d),!0;case"pointerover":var y=d.pointerId;return Fx.set(y,Hy(Fx.get(y)||null,e,t,i,a,d)),!0;case"gotpointercapture":return y=d.pointerId,Bx.set(y,Hy(Bx.get(y)||null,e,t,i,a,d)),!0}return!1}function WL(e){var t=Sf(e.target);if(t!==null){var i=Yf(t);if(i!==null){if(t=i.tag,t===13){if(t=DL(i),t!==null){e.blockedOn=t,HL(e.priority,function(){GL(i)});return}}else if(t===3&&i.stateNode.current.memoizedState.isDehydrated){e.blockedOn=i.tag===3?i.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Ab(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var i=CC(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(i===null){i=e.nativeEvent;var a=new i.constructor(i.type,i);vC=a,i.target.dispatchEvent(a),vC=null}else return t=Dv(i),t!==null&&lA(t),e.blockedOn=i,!1;t.shift()}return!0}function yj(e,t,i){Ab(e)&&i.delete(t)}function RG(){EC=!1,$d!==null&&Ab($d)&&($d=null),Gd!==null&&Ab(Gd)&&(Gd=null),qd!==null&&Ab(qd)&&(qd=null),Fx.forEach(yj),Bx.forEach(yj)}function Wy(e,t){e.blockedOn===t&&(e.blockedOn=null,EC||(EC=!0,Ea.unstable_scheduleCallback(Ea.unstable_NormalPriority,RG)))}function Vx(e){function t(d){return Wy(d,e)}if(0<J1.length){Wy(J1[0],e);for(var i=1;i<J1.length;i++){var a=J1[i];a.blockedOn===e&&(a.blockedOn=null)}}for($d!==null&&Wy($d,e),Gd!==null&&Wy(Gd,e),qd!==null&&Wy(qd,e),Fx.forEach(t),Bx.forEach(t),i=0;i<Id.length;i++)a=Id[i],a.blockedOn===e&&(a.blockedOn=null);for(;0<Id.length&&(i=Id[0],i.blockedOn===null);)WL(i),i.blockedOn===null&&Id.shift()}var Wm=vu.ReactCurrentBatchConfig,Jb=!0;function jG(e,t,i,a){var d=yi,y=Wm.transition;Wm.transition=null;try{yi=1,cA(e,t,i,a)}finally{yi=d,Wm.transition=y}}function DG(e,t,i,a){var d=yi,y=Wm.transition;Wm.transition=null;try{yi=4,cA(e,t,i,a)}finally{yi=d,Wm.transition=y}}function cA(e,t,i,a){if(Jb){var d=CC(e,t,i,a);if(d===null)mE(e,t,a,Qb,i),_j(e,a);else if(NG(d,e,t,i,a))a.stopPropagation();else if(_j(e,a),t&4&&-1<kG.indexOf(e)){for(;d!==null;){var y=Dv(d);if(y!==null&&$L(y),y=CC(e,t,i,a),y===null&&mE(e,t,a,Qb,i),y===d)break;d=y}d!==null&&a.stopPropagation()}else mE(e,t,a,null,i)}}var Qb=null;function CC(e,t,i,a){if(Qb=null,e=sA(a),e=Sf(e),e!==null)if(t=Yf(e),t===null)e=null;else if(i=t.tag,i===13){if(e=DL(t),e!==null)return e;e=null}else if(i===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Qb=e,null}function ZL(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(wG()){case oA:return 1;case FL:return 4;case Xb:case SG:return 16;case BL:return 536870912;default:return 16}default:return 16}}var Bd=null,uA=null,Pb=null;function YL(){if(Pb)return Pb;var e,t=uA,i=t.length,a,d="value"in Bd?Bd.value:Bd.textContent,y=d.length;for(e=0;e<i&&t[e]===d[e];e++);var S=i-e;for(a=1;a<=S&&t[i-a]===d[y-a];a++);return Pb=d.slice(e,1<a?1-a:void 0)}function Ib(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Q1(){return!0}function xj(){return!1}function Aa(e){function t(i,a,d,y,S){this._reactName=i,this._targetInst=d,this.type=a,this.nativeEvent=y,this.target=S,this.currentTarget=null;for(var s in e)e.hasOwnProperty(s)&&(i=e[s],this[s]=i?i(y):y[s]);return this.isDefaultPrevented=(y.defaultPrevented!=null?y.defaultPrevented:y.returnValue===!1)?Q1:xj,this.isPropagationStopped=xj,this}return Zi(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var i=this.nativeEvent;i&&(i.preventDefault?i.preventDefault():typeof i.returnValue!="unknown"&&(i.returnValue=!1),this.isDefaultPrevented=Q1)},stopPropagation:function(){var i=this.nativeEvent;i&&(i.stopPropagation?i.stopPropagation():typeof i.cancelBubble!="unknown"&&(i.cancelBubble=!0),this.isPropagationStopped=Q1)},persist:function(){},isPersistent:Q1}),t}var Rg={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},dA=Aa(Rg),jv=Zi({},Rg,{view:0,detail:0}),LG=Aa(jv),oE,aE,Zy,Kw=Zi({},jv,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:hA,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Zy&&(Zy&&e.type==="mousemove"?(oE=e.screenX-Zy.screenX,aE=e.screenY-Zy.screenY):aE=oE=0,Zy=e),oE)},movementY:function(e){return"movementY"in e?e.movementY:aE}}),vj=Aa(Kw),OG=Zi({},Kw,{dataTransfer:0}),zG=Aa(OG),FG=Zi({},jv,{relatedTarget:0}),lE=Aa(FG),BG=Zi({},Rg,{animationName:0,elapsedTime:0,pseudoElement:0}),VG=Aa(BG),UG=Zi({},Rg,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),$G=Aa(UG),GG=Zi({},Rg,{data:0}),bj=Aa(GG),qG={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},HG={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},WG={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ZG(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=WG[e])?!!t[e]:!1}function hA(){return ZG}var YG=Zi({},jv,{key:function(e){if(e.key){var t=qG[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Ib(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?HG[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:hA,charCode:function(e){return e.type==="keypress"?Ib(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Ib(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),XG=Aa(YG),KG=Zi({},Kw,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),wj=Aa(KG),JG=Zi({},jv,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:hA}),QG=Aa(JG),eq=Zi({},Rg,{propertyName:0,elapsedTime:0,pseudoElement:0}),tq=Aa(eq),rq=Zi({},Kw,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),nq=Aa(rq),iq=[9,13,27,32],fA=uu&&"CompositionEvent"in window,wx=null;uu&&"documentMode"in document&&(wx=document.documentMode);var sq=uu&&"TextEvent"in window&&!wx,XL=uu&&(!fA||wx&&8<wx&&11>=wx),Sj=" ",Tj=!1;function KL(e,t){switch(e){case"keyup":return iq.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function JL(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Rm=!1;function oq(e,t){switch(e){case"compositionend":return JL(t);case"keypress":return t.which!==32?null:(Tj=!0,Sj);case"textInput":return e=t.data,e===Sj&&Tj?null:e;default:return null}}function aq(e,t){if(Rm)return e==="compositionend"||!fA&&KL(e,t)?(e=YL(),Pb=uA=Bd=null,Rm=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return XL&&t.locale!=="ko"?null:t.data;default:return null}}var lq={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ej(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!lq[e.type]:t==="textarea"}function QL(e,t,i,a){IL(a),t=ew(t,"onChange"),0<t.length&&(i=new dA("onChange","change",null,i,a),e.push({event:i,listeners:t}))}var Sx=null,Ux=null;function cq(e){uO(e,0)}function Jw(e){var t=Lm(e);if(SL(t))return e}function uq(e,t){if(e==="change")return t}var eO=!1;if(uu){var cE;if(uu){var uE="oninput"in document;if(!uE){var Cj=document.createElement("div");Cj.setAttribute("oninput","return;"),uE=typeof Cj.oninput=="function"}cE=uE}else cE=!1;eO=cE&&(!document.documentMode||9<document.documentMode)}function Mj(){Sx&&(Sx.detachEvent("onpropertychange",tO),Ux=Sx=null)}function tO(e){if(e.propertyName==="value"&&Jw(Ux)){var t=[];QL(t,Ux,e,sA(e)),jL(cq,t)}}function dq(e,t,i){e==="focusin"?(Mj(),Sx=t,Ux=i,Sx.attachEvent("onpropertychange",tO)):e==="focusout"&&Mj()}function hq(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Jw(Ux)}function fq(e,t){if(e==="click")return Jw(t)}function pq(e,t){if(e==="input"||e==="change")return Jw(t)}function mq(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Ol=typeof Object.is=="function"?Object.is:mq;function $x(e,t){if(Ol(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var i=Object.keys(e),a=Object.keys(t);if(i.length!==a.length)return!1;for(a=0;a<i.length;a++){var d=i[a];if(!lC.call(t,d)||!Ol(e[d],t[d]))return!1}return!0}function Aj(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Pj(e,t){var i=Aj(e);e=0;for(var a;i;){if(i.nodeType===3){if(a=e+i.textContent.length,e<=t&&a>=t)return{node:i,offset:t-e};e=a}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=Aj(i)}}function rO(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?rO(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function nO(){for(var e=window,t=Wb();t instanceof e.HTMLIFrameElement;){try{var i=typeof t.contentWindow.location.href=="string"}catch{i=!1}if(i)e=t.contentWindow;else break;t=Wb(e.document)}return t}function pA(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function gq(e){var t=nO(),i=e.focusedElem,a=e.selectionRange;if(t!==i&&i&&i.ownerDocument&&rO(i.ownerDocument.documentElement,i)){if(a!==null&&pA(i)){if(t=a.start,e=a.end,e===void 0&&(e=t),"selectionStart"in i)i.selectionStart=t,i.selectionEnd=Math.min(e,i.value.length);else if(e=(t=i.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var d=i.textContent.length,y=Math.min(a.start,d);a=a.end===void 0?y:Math.min(a.end,d),!e.extend&&y>a&&(d=a,a=y,y=d),d=Pj(i,y);var S=Pj(i,a);d&&S&&(e.rangeCount!==1||e.anchorNode!==d.node||e.anchorOffset!==d.offset||e.focusNode!==S.node||e.focusOffset!==S.offset)&&(t=t.createRange(),t.setStart(d.node,d.offset),e.removeAllRanges(),y>a?(e.addRange(t),e.extend(S.node,S.offset)):(t.setEnd(S.node,S.offset),e.addRange(t)))}}for(t=[],e=i;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof i.focus=="function"&&i.focus(),i=0;i<t.length;i++)e=t[i],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var _q=uu&&"documentMode"in document&&11>=document.documentMode,jm=null,MC=null,Tx=null,AC=!1;function Ij(e,t,i){var a=i.window===i?i.document:i.nodeType===9?i:i.ownerDocument;AC||jm==null||jm!==Wb(a)||(a=jm,"selectionStart"in a&&pA(a)?a={start:a.selectionStart,end:a.selectionEnd}:(a=(a.ownerDocument&&a.ownerDocument.defaultView||window).getSelection(),a={anchorNode:a.anchorNode,anchorOffset:a.anchorOffset,focusNode:a.focusNode,focusOffset:a.focusOffset}),Tx&&$x(Tx,a)||(Tx=a,a=ew(MC,"onSelect"),0<a.length&&(t=new dA("onSelect","select",null,t,i),e.push({event:t,listeners:a}),t.target=jm)))}function eb(e,t){var i={};return i[e.toLowerCase()]=t.toLowerCase(),i["Webkit"+e]="webkit"+t,i["Moz"+e]="moz"+t,i}var Dm={animationend:eb("Animation","AnimationEnd"),animationiteration:eb("Animation","AnimationIteration"),animationstart:eb("Animation","AnimationStart"),transitionend:eb("Transition","TransitionEnd")},dE={},iO={};uu&&(iO=document.createElement("div").style,"AnimationEvent"in window||(delete Dm.animationend.animation,delete Dm.animationiteration.animation,delete Dm.animationstart.animation),"TransitionEvent"in window||delete Dm.transitionend.transition);function Qw(e){if(dE[e])return dE[e];if(!Dm[e])return e;var t=Dm[e],i;for(i in t)if(t.hasOwnProperty(i)&&i in iO)return dE[e]=t[i];return e}var sO=Qw("animationend"),oO=Qw("animationiteration"),aO=Qw("animationstart"),lO=Qw("transitionend"),cO=new Map,kj="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function hh(e,t){cO.set(e,t),Zf(t,[e])}for(var hE=0;hE<kj.length;hE++){var fE=kj[hE],yq=fE.toLowerCase(),xq=fE[0].toUpperCase()+fE.slice(1);hh(yq,"on"+xq)}hh(sO,"onAnimationEnd");hh(oO,"onAnimationIteration");hh(aO,"onAnimationStart");hh("dblclick","onDoubleClick");hh("focusin","onFocus");hh("focusout","onBlur");hh(lO,"onTransitionEnd");hg("onMouseEnter",["mouseout","mouseover"]);hg("onMouseLeave",["mouseout","mouseover"]);hg("onPointerEnter",["pointerout","pointerover"]);hg("onPointerLeave",["pointerout","pointerover"]);Zf("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Zf("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Zf("onBeforeInput",["compositionend","keypress","textInput","paste"]);Zf("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Zf("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Zf("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var cx="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),vq=new Set("cancel close invalid load scroll toggle".split(" ").concat(cx));function Nj(e,t,i){var a=e.type||"unknown-event";e.currentTarget=i,yG(a,t,void 0,e),e.currentTarget=null}function uO(e,t){t=(t&4)!==0;for(var i=0;i<e.length;i++){var a=e[i],d=a.event;a=a.listeners;e:{var y=void 0;if(t)for(var S=a.length-1;0<=S;S--){var s=a[S],N=s.instance,D=s.currentTarget;if(s=s.listener,N!==y&&d.isPropagationStopped())break e;Nj(d,s,D),y=N}else for(S=0;S<a.length;S++){if(s=a[S],N=s.instance,D=s.currentTarget,s=s.listener,N!==y&&d.isPropagationStopped())break e;Nj(d,s,D),y=N}}}if(Yb)throw e=SC,Yb=!1,SC=null,e}function Di(e,t){var i=t[RC];i===void 0&&(i=t[RC]=new Set);var a=e+"__bubble";i.has(a)||(dO(t,e,2,!1),i.add(a))}function pE(e,t,i){var a=0;t&&(a|=4),dO(i,e,a,t)}var tb="_reactListening"+Math.random().toString(36).slice(2);function Gx(e){if(!e[tb]){e[tb]=!0,yL.forEach(function(i){i!=="selectionchange"&&(vq.has(i)||pE(i,!1,e),pE(i,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[tb]||(t[tb]=!0,pE("selectionchange",!1,t))}}function dO(e,t,i,a){switch(ZL(t)){case 1:var d=jG;break;case 4:d=DG;break;default:d=cA}i=d.bind(null,t,i,e),d=void 0,!wC||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(d=!0),a?d!==void 0?e.addEventListener(t,i,{capture:!0,passive:d}):e.addEventListener(t,i,!0):d!==void 0?e.addEventListener(t,i,{passive:d}):e.addEventListener(t,i,!1)}function mE(e,t,i,a,d){var y=a;if(!(t&1)&&!(t&2)&&a!==null)e:for(;;){if(a===null)return;var S=a.tag;if(S===3||S===4){var s=a.stateNode.containerInfo;if(s===d||s.nodeType===8&&s.parentNode===d)break;if(S===4)for(S=a.return;S!==null;){var N=S.tag;if((N===3||N===4)&&(N=S.stateNode.containerInfo,N===d||N.nodeType===8&&N.parentNode===d))return;S=S.return}for(;s!==null;){if(S=Sf(s),S===null)return;if(N=S.tag,N===5||N===6){a=y=S;continue e}s=s.parentNode}}a=a.return}jL(function(){var D=y,O=sA(i),$=[];e:{var q=cO.get(e);if(q!==void 0){var J=dA,re=e;switch(e){case"keypress":if(Ib(i)===0)break e;case"keydown":case"keyup":J=XG;break;case"focusin":re="focus",J=lE;break;case"focusout":re="blur",J=lE;break;case"beforeblur":case"afterblur":J=lE;break;case"click":if(i.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":J=vj;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":J=zG;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":J=QG;break;case sO:case oO:case aO:J=VG;break;case lO:J=tq;break;case"scroll":J=LG;break;case"wheel":J=nq;break;case"copy":case"cut":case"paste":J=$G;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":J=wj}var Q=(t&4)!==0,ce=!Q&&e==="scroll",le=Q?q!==null?q+"Capture":null:q;Q=[];for(var ae=D,he;ae!==null;){he=ae;var Se=he.stateNode;if(he.tag===5&&Se!==null&&(he=Se,le!==null&&(Se=zx(ae,le),Se!=null&&Q.push(qx(ae,Se,he)))),ce)break;ae=ae.return}0<Q.length&&(q=new J(q,re,null,i,O),$.push({event:q,listeners:Q}))}}if(!(t&7)){e:{if(q=e==="mouseover"||e==="pointerover",J=e==="mouseout"||e==="pointerout",q&&i!==vC&&(re=i.relatedTarget||i.fromElement)&&(Sf(re)||re[du]))break e;if((J||q)&&(q=O.window===O?O:(q=O.ownerDocument)?q.defaultView||q.parentWindow:window,J?(re=i.relatedTarget||i.toElement,J=D,re=re?Sf(re):null,re!==null&&(ce=Yf(re),re!==ce||re.tag!==5&&re.tag!==6)&&(re=null)):(J=null,re=D),J!==re)){if(Q=vj,Se="onMouseLeave",le="onMouseEnter",ae="mouse",(e==="pointerout"||e==="pointerover")&&(Q=wj,Se="onPointerLeave",le="onPointerEnter",ae="pointer"),ce=J==null?q:Lm(J),he=re==null?q:Lm(re),q=new Q(Se,ae+"leave",J,i,O),q.target=ce,q.relatedTarget=he,Se=null,Sf(O)===D&&(Q=new Q(le,ae+"enter",re,i,O),Q.target=he,Q.relatedTarget=ce,Se=Q),ce=Se,J&&re)t:{for(Q=J,le=re,ae=0,he=Q;he;he=xm(he))ae++;for(he=0,Se=le;Se;Se=xm(Se))he++;for(;0<ae-he;)Q=xm(Q),ae--;for(;0<he-ae;)le=xm(le),he--;for(;ae--;){if(Q===le||le!==null&&Q===le.alternate)break t;Q=xm(Q),le=xm(le)}Q=null}else Q=null;J!==null&&Rj($,q,J,Q,!1),re!==null&&ce!==null&&Rj($,ce,re,Q,!0)}}e:{if(q=D?Lm(D):window,J=q.nodeName&&q.nodeName.toLowerCase(),J==="select"||J==="input"&&q.type==="file")var je=uq;else if(Ej(q))if(eO)je=pq;else{je=hq;var it=dq}else(J=q.nodeName)&&J.toLowerCase()==="input"&&(q.type==="checkbox"||q.type==="radio")&&(je=fq);if(je&&(je=je(e,D))){QL($,je,i,O);break e}it&&it(e,q,D),e==="focusout"&&(it=q._wrapperState)&&it.controlled&&q.type==="number"&&mC(q,"number",q.value)}switch(it=D?Lm(D):window,e){case"focusin":(Ej(it)||it.contentEditable==="true")&&(jm=it,MC=D,Tx=null);break;case"focusout":Tx=MC=jm=null;break;case"mousedown":AC=!0;break;case"contextmenu":case"mouseup":case"dragend":AC=!1,Ij($,i,O);break;case"selectionchange":if(_q)break;case"keydown":case"keyup":Ij($,i,O)}var qe;if(fA)e:{switch(e){case"compositionstart":var ct="onCompositionStart";break e;case"compositionend":ct="onCompositionEnd";break e;case"compositionupdate":ct="onCompositionUpdate";break e}ct=void 0}else Rm?KL(e,i)&&(ct="onCompositionEnd"):e==="keydown"&&i.keyCode===229&&(ct="onCompositionStart");ct&&(XL&&i.locale!=="ko"&&(Rm||ct!=="onCompositionStart"?ct==="onCompositionEnd"&&Rm&&(qe=YL()):(Bd=O,uA="value"in Bd?Bd.value:Bd.textContent,Rm=!0)),it=ew(D,ct),0<it.length&&(ct=new bj(ct,e,null,i,O),$.push({event:ct,listeners:it}),qe?ct.data=qe:(qe=JL(i),qe!==null&&(ct.data=qe)))),(qe=sq?oq(e,i):aq(e,i))&&(D=ew(D,"onBeforeInput"),0<D.length&&(O=new bj("onBeforeInput","beforeinput",null,i,O),$.push({event:O,listeners:D}),O.data=qe))}uO($,t)})}function qx(e,t,i){return{instance:e,listener:t,currentTarget:i}}function ew(e,t){for(var i=t+"Capture",a=[];e!==null;){var d=e,y=d.stateNode;d.tag===5&&y!==null&&(d=y,y=zx(e,i),y!=null&&a.unshift(qx(e,y,d)),y=zx(e,t),y!=null&&a.push(qx(e,y,d))),e=e.return}return a}function xm(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function Rj(e,t,i,a,d){for(var y=t._reactName,S=[];i!==null&&i!==a;){var s=i,N=s.alternate,D=s.stateNode;if(N!==null&&N===a)break;s.tag===5&&D!==null&&(s=D,d?(N=zx(i,y),N!=null&&S.unshift(qx(i,N,s))):d||(N=zx(i,y),N!=null&&S.push(qx(i,N,s)))),i=i.return}S.length!==0&&e.push({event:t,listeners:S})}var bq=/\r\n?/g,wq=/\u0000|\uFFFD/g;function jj(e){return(typeof e=="string"?e:""+e).replace(bq,`
`).replace(wq,"")}function rb(e,t,i){if(t=jj(t),jj(e)!==t&&i)throw Error(nr(425))}function tw(){}var PC=null,IC=null;function kC(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var NC=typeof setTimeout=="function"?setTimeout:void 0,Sq=typeof clearTimeout=="function"?clearTimeout:void 0,Dj=typeof Promise=="function"?Promise:void 0,Tq=typeof queueMicrotask=="function"?queueMicrotask:typeof Dj<"u"?function(e){return Dj.resolve(null).then(e).catch(Eq)}:NC;function Eq(e){setTimeout(function(){throw e})}function gE(e,t){var i=t,a=0;do{var d=i.nextSibling;if(e.removeChild(i),d&&d.nodeType===8)if(i=d.data,i==="/$"){if(a===0){e.removeChild(d),Vx(t);return}a--}else i!=="$"&&i!=="$?"&&i!=="$!"||a++;i=d}while(i);Vx(t)}function Hd(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function Lj(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var i=e.data;if(i==="$"||i==="$!"||i==="$?"){if(t===0)return e;t--}else i==="/$"&&t++}e=e.previousSibling}return null}var jg=Math.random().toString(36).slice(2),mc="__reactFiber$"+jg,Hx="__reactProps$"+jg,du="__reactContainer$"+jg,RC="__reactEvents$"+jg,Cq="__reactListeners$"+jg,Mq="__reactHandles$"+jg;function Sf(e){var t=e[mc];if(t)return t;for(var i=e.parentNode;i;){if(t=i[du]||i[mc]){if(i=t.alternate,t.child!==null||i!==null&&i.child!==null)for(e=Lj(e);e!==null;){if(i=e[mc])return i;e=Lj(e)}return t}e=i,i=e.parentNode}return null}function Dv(e){return e=e[mc]||e[du],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Lm(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(nr(33))}function e2(e){return e[Hx]||null}var jC=[],Om=-1;function fh(e){return{current:e}}function Oi(e){0>Om||(e.current=jC[Om],jC[Om]=null,Om--)}function Ai(e,t){Om++,jC[Om]=e.current,e.current=t}var rh={},ao=fh(rh),Xo=fh(!1),Df=rh;function fg(e,t){var i=e.type.contextTypes;if(!i)return rh;var a=e.stateNode;if(a&&a.__reactInternalMemoizedUnmaskedChildContext===t)return a.__reactInternalMemoizedMaskedChildContext;var d={},y;for(y in i)d[y]=t[y];return a&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=d),d}function Ko(e){return e=e.childContextTypes,e!=null}function rw(){Oi(Xo),Oi(ao)}function Oj(e,t,i){if(ao.current!==rh)throw Error(nr(168));Ai(ao,t),Ai(Xo,i)}function hO(e,t,i){var a=e.stateNode;if(t=t.childContextTypes,typeof a.getChildContext!="function")return i;a=a.getChildContext();for(var d in a)if(!(d in t))throw Error(nr(108,dG(e)||"Unknown",d));return Zi({},i,a)}function nw(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||rh,Df=ao.current,Ai(ao,e),Ai(Xo,Xo.current),!0}function zj(e,t,i){var a=e.stateNode;if(!a)throw Error(nr(169));i?(e=hO(e,t,Df),a.__reactInternalMemoizedMergedChildContext=e,Oi(Xo),Oi(ao),Ai(ao,e)):Oi(Xo),Ai(Xo,i)}var tu=null,t2=!1,_E=!1;function fO(e){tu===null?tu=[e]:tu.push(e)}function Aq(e){t2=!0,fO(e)}function ph(){if(!_E&&tu!==null){_E=!0;var e=0,t=yi;try{var i=tu;for(yi=1;e<i.length;e++){var a=i[e];do a=a(!0);while(a!==null)}tu=null,t2=!1}catch(d){throw tu!==null&&(tu=tu.slice(e+1)),zL(oA,ph),d}finally{yi=t,_E=!1}}return null}var zm=[],Fm=0,iw=null,sw=0,$a=[],Ga=0,Lf=null,ru=1,nu="";function yf(e,t){zm[Fm++]=sw,zm[Fm++]=iw,iw=e,sw=t}function pO(e,t,i){$a[Ga++]=ru,$a[Ga++]=nu,$a[Ga++]=Lf,Lf=e;var a=ru;e=nu;var d=32-Rl(a)-1;a&=~(1<<d),i+=1;var y=32-Rl(t)+d;if(30<y){var S=d-d%5;y=(a&(1<<S)-1).toString(32),a>>=S,d-=S,ru=1<<32-Rl(t)+d|i<<d|a,nu=y+e}else ru=1<<y|i<<d|a,nu=e}function mA(e){e.return!==null&&(yf(e,1),pO(e,1,0))}function gA(e){for(;e===iw;)iw=zm[--Fm],zm[Fm]=null,sw=zm[--Fm],zm[Fm]=null;for(;e===Lf;)Lf=$a[--Ga],$a[Ga]=null,nu=$a[--Ga],$a[Ga]=null,ru=$a[--Ga],$a[Ga]=null}var va=null,xa=null,Bi=!1,Pl=null;function mO(e,t){var i=qa(5,null,null,0);i.elementType="DELETED",i.stateNode=t,i.return=e,t=e.deletions,t===null?(e.deletions=[i],e.flags|=16):t.push(i)}function Fj(e,t){switch(e.tag){case 5:var i=e.type;return t=t.nodeType!==1||i.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,va=e,xa=Hd(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,va=e,xa=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(i=Lf!==null?{id:ru,overflow:nu}:null,e.memoizedState={dehydrated:t,treeContext:i,retryLane:1073741824},i=qa(18,null,null,0),i.stateNode=t,i.return=e,e.child=i,va=e,xa=null,!0):!1;default:return!1}}function DC(e){return(e.mode&1)!==0&&(e.flags&128)===0}function LC(e){if(Bi){var t=xa;if(t){var i=t;if(!Fj(e,t)){if(DC(e))throw Error(nr(418));t=Hd(i.nextSibling);var a=va;t&&Fj(e,t)?mO(a,i):(e.flags=e.flags&-4097|2,Bi=!1,va=e)}}else{if(DC(e))throw Error(nr(418));e.flags=e.flags&-4097|2,Bi=!1,va=e}}}function Bj(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;va=e}function nb(e){if(e!==va)return!1;if(!Bi)return Bj(e),Bi=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!kC(e.type,e.memoizedProps)),t&&(t=xa)){if(DC(e))throw gO(),Error(nr(418));for(;t;)mO(e,t),t=Hd(t.nextSibling)}if(Bj(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(nr(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var i=e.data;if(i==="/$"){if(t===0){xa=Hd(e.nextSibling);break e}t--}else i!=="$"&&i!=="$!"&&i!=="$?"||t++}e=e.nextSibling}xa=null}}else xa=va?Hd(e.stateNode.nextSibling):null;return!0}function gO(){for(var e=xa;e;)e=Hd(e.nextSibling)}function pg(){xa=va=null,Bi=!1}function _A(e){Pl===null?Pl=[e]:Pl.push(e)}var Pq=vu.ReactCurrentBatchConfig;function Yy(e,t,i){if(e=i.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(i._owner){if(i=i._owner,i){if(i.tag!==1)throw Error(nr(309));var a=i.stateNode}if(!a)throw Error(nr(147,e));var d=a,y=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===y?t.ref:(t=function(S){var s=d.refs;S===null?delete s[y]:s[y]=S},t._stringRef=y,t)}if(typeof e!="string")throw Error(nr(284));if(!i._owner)throw Error(nr(290,e))}return e}function ib(e,t){throw e=Object.prototype.toString.call(t),Error(nr(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Vj(e){var t=e._init;return t(e._payload)}function _O(e){function t(le,ae){if(e){var he=le.deletions;he===null?(le.deletions=[ae],le.flags|=16):he.push(ae)}}function i(le,ae){if(!e)return null;for(;ae!==null;)t(le,ae),ae=ae.sibling;return null}function a(le,ae){for(le=new Map;ae!==null;)ae.key!==null?le.set(ae.key,ae):le.set(ae.index,ae),ae=ae.sibling;return le}function d(le,ae){return le=Xd(le,ae),le.index=0,le.sibling=null,le}function y(le,ae,he){return le.index=he,e?(he=le.alternate,he!==null?(he=he.index,he<ae?(le.flags|=2,ae):he):(le.flags|=2,ae)):(le.flags|=1048576,ae)}function S(le){return e&&le.alternate===null&&(le.flags|=2),le}function s(le,ae,he,Se){return ae===null||ae.tag!==6?(ae=TE(he,le.mode,Se),ae.return=le,ae):(ae=d(ae,he),ae.return=le,ae)}function N(le,ae,he,Se){var je=he.type;return je===Nm?O(le,ae,he.props.children,Se,he.key):ae!==null&&(ae.elementType===je||typeof je=="object"&&je!==null&&je.$$typeof===Cd&&Vj(je)===ae.type)?(Se=d(ae,he.props),Se.ref=Yy(le,ae,he),Se.return=le,Se):(Se=Ob(he.type,he.key,he.props,null,le.mode,Se),Se.ref=Yy(le,ae,he),Se.return=le,Se)}function D(le,ae,he,Se){return ae===null||ae.tag!==4||ae.stateNode.containerInfo!==he.containerInfo||ae.stateNode.implementation!==he.implementation?(ae=EE(he,le.mode,Se),ae.return=le,ae):(ae=d(ae,he.children||[]),ae.return=le,ae)}function O(le,ae,he,Se,je){return ae===null||ae.tag!==7?(ae=Nf(he,le.mode,Se,je),ae.return=le,ae):(ae=d(ae,he),ae.return=le,ae)}function $(le,ae,he){if(typeof ae=="string"&&ae!==""||typeof ae=="number")return ae=TE(""+ae,le.mode,he),ae.return=le,ae;if(typeof ae=="object"&&ae!==null){switch(ae.$$typeof){case W1:return he=Ob(ae.type,ae.key,ae.props,null,le.mode,he),he.ref=Yy(le,null,ae),he.return=le,he;case km:return ae=EE(ae,le.mode,he),ae.return=le,ae;case Cd:var Se=ae._init;return $(le,Se(ae._payload),he)}if(ax(ae)||Gy(ae))return ae=Nf(ae,le.mode,he,null),ae.return=le,ae;ib(le,ae)}return null}function q(le,ae,he,Se){var je=ae!==null?ae.key:null;if(typeof he=="string"&&he!==""||typeof he=="number")return je!==null?null:s(le,ae,""+he,Se);if(typeof he=="object"&&he!==null){switch(he.$$typeof){case W1:return he.key===je?N(le,ae,he,Se):null;case km:return he.key===je?D(le,ae,he,Se):null;case Cd:return je=he._init,q(le,ae,je(he._payload),Se)}if(ax(he)||Gy(he))return je!==null?null:O(le,ae,he,Se,null);ib(le,he)}return null}function J(le,ae,he,Se,je){if(typeof Se=="string"&&Se!==""||typeof Se=="number")return le=le.get(he)||null,s(ae,le,""+Se,je);if(typeof Se=="object"&&Se!==null){switch(Se.$$typeof){case W1:return le=le.get(Se.key===null?he:Se.key)||null,N(ae,le,Se,je);case km:return le=le.get(Se.key===null?he:Se.key)||null,D(ae,le,Se,je);case Cd:var it=Se._init;return J(le,ae,he,it(Se._payload),je)}if(ax(Se)||Gy(Se))return le=le.get(he)||null,O(ae,le,Se,je,null);ib(ae,Se)}return null}function re(le,ae,he,Se){for(var je=null,it=null,qe=ae,ct=ae=0,pt=null;qe!==null&&ct<he.length;ct++){qe.index>ct?(pt=qe,qe=null):pt=qe.sibling;var Ze=q(le,qe,he[ct],Se);if(Ze===null){qe===null&&(qe=pt);break}e&&qe&&Ze.alternate===null&&t(le,qe),ae=y(Ze,ae,ct),it===null?je=Ze:it.sibling=Ze,it=Ze,qe=pt}if(ct===he.length)return i(le,qe),Bi&&yf(le,ct),je;if(qe===null){for(;ct<he.length;ct++)qe=$(le,he[ct],Se),qe!==null&&(ae=y(qe,ae,ct),it===null?je=qe:it.sibling=qe,it=qe);return Bi&&yf(le,ct),je}for(qe=a(le,qe);ct<he.length;ct++)pt=J(qe,le,ct,he[ct],Se),pt!==null&&(e&&pt.alternate!==null&&qe.delete(pt.key===null?ct:pt.key),ae=y(pt,ae,ct),it===null?je=pt:it.sibling=pt,it=pt);return e&&qe.forEach(function(yt){return t(le,yt)}),Bi&&yf(le,ct),je}function Q(le,ae,he,Se){var je=Gy(he);if(typeof je!="function")throw Error(nr(150));if(he=je.call(he),he==null)throw Error(nr(151));for(var it=je=null,qe=ae,ct=ae=0,pt=null,Ze=he.next();qe!==null&&!Ze.done;ct++,Ze=he.next()){qe.index>ct?(pt=qe,qe=null):pt=qe.sibling;var yt=q(le,qe,Ze.value,Se);if(yt===null){qe===null&&(qe=pt);break}e&&qe&&yt.alternate===null&&t(le,qe),ae=y(yt,ae,ct),it===null?je=yt:it.sibling=yt,it=yt,qe=pt}if(Ze.done)return i(le,qe),Bi&&yf(le,ct),je;if(qe===null){for(;!Ze.done;ct++,Ze=he.next())Ze=$(le,Ze.value,Se),Ze!==null&&(ae=y(Ze,ae,ct),it===null?je=Ze:it.sibling=Ze,it=Ze);return Bi&&yf(le,ct),je}for(qe=a(le,qe);!Ze.done;ct++,Ze=he.next())Ze=J(qe,le,ct,Ze.value,Se),Ze!==null&&(e&&Ze.alternate!==null&&qe.delete(Ze.key===null?ct:Ze.key),ae=y(Ze,ae,ct),it===null?je=Ze:it.sibling=Ze,it=Ze);return e&&qe.forEach(function(Mt){return t(le,Mt)}),Bi&&yf(le,ct),je}function ce(le,ae,he,Se){if(typeof he=="object"&&he!==null&&he.type===Nm&&he.key===null&&(he=he.props.children),typeof he=="object"&&he!==null){switch(he.$$typeof){case W1:e:{for(var je=he.key,it=ae;it!==null;){if(it.key===je){if(je=he.type,je===Nm){if(it.tag===7){i(le,it.sibling),ae=d(it,he.props.children),ae.return=le,le=ae;break e}}else if(it.elementType===je||typeof je=="object"&&je!==null&&je.$$typeof===Cd&&Vj(je)===it.type){i(le,it.sibling),ae=d(it,he.props),ae.ref=Yy(le,it,he),ae.return=le,le=ae;break e}i(le,it);break}else t(le,it);it=it.sibling}he.type===Nm?(ae=Nf(he.props.children,le.mode,Se,he.key),ae.return=le,le=ae):(Se=Ob(he.type,he.key,he.props,null,le.mode,Se),Se.ref=Yy(le,ae,he),Se.return=le,le=Se)}return S(le);case km:e:{for(it=he.key;ae!==null;){if(ae.key===it)if(ae.tag===4&&ae.stateNode.containerInfo===he.containerInfo&&ae.stateNode.implementation===he.implementation){i(le,ae.sibling),ae=d(ae,he.children||[]),ae.return=le,le=ae;break e}else{i(le,ae);break}else t(le,ae);ae=ae.sibling}ae=EE(he,le.mode,Se),ae.return=le,le=ae}return S(le);case Cd:return it=he._init,ce(le,ae,it(he._payload),Se)}if(ax(he))return re(le,ae,he,Se);if(Gy(he))return Q(le,ae,he,Se);ib(le,he)}return typeof he=="string"&&he!==""||typeof he=="number"?(he=""+he,ae!==null&&ae.tag===6?(i(le,ae.sibling),ae=d(ae,he),ae.return=le,le=ae):(i(le,ae),ae=TE(he,le.mode,Se),ae.return=le,le=ae),S(le)):i(le,ae)}return ce}var mg=_O(!0),yO=_O(!1),ow=fh(null),aw=null,Bm=null,yA=null;function xA(){yA=Bm=aw=null}function vA(e){var t=ow.current;Oi(ow),e._currentValue=t}function OC(e,t,i){for(;e!==null;){var a=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,a!==null&&(a.childLanes|=t)):a!==null&&(a.childLanes&t)!==t&&(a.childLanes|=t),e===i)break;e=e.return}}function Zm(e,t){aw=e,yA=Bm=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Zo=!0),e.firstContext=null)}function Za(e){var t=e._currentValue;if(yA!==e)if(e={context:e,memoizedValue:t,next:null},Bm===null){if(aw===null)throw Error(nr(308));Bm=e,aw.dependencies={lanes:0,firstContext:e}}else Bm=Bm.next=e;return t}var Tf=null;function bA(e){Tf===null?Tf=[e]:Tf.push(e)}function xO(e,t,i,a){var d=t.interleaved;return d===null?(i.next=i,bA(t)):(i.next=d.next,d.next=i),t.interleaved=i,hu(e,a)}function hu(e,t){e.lanes|=t;var i=e.alternate;for(i!==null&&(i.lanes|=t),i=e,e=e.return;e!==null;)e.childLanes|=t,i=e.alternate,i!==null&&(i.childLanes|=t),i=e,e=e.return;return i.tag===3?i.stateNode:null}var Md=!1;function wA(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function vO(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function su(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Wd(e,t,i){var a=e.updateQueue;if(a===null)return null;if(a=a.shared,ei&2){var d=a.pending;return d===null?t.next=t:(t.next=d.next,d.next=t),a.pending=t,hu(e,i)}return d=a.interleaved,d===null?(t.next=t,bA(a)):(t.next=d.next,d.next=t),a.interleaved=t,hu(e,i)}function kb(e,t,i){if(t=t.updateQueue,t!==null&&(t=t.shared,(i&4194240)!==0)){var a=t.lanes;a&=e.pendingLanes,i|=a,t.lanes=i,aA(e,i)}}function Uj(e,t){var i=e.updateQueue,a=e.alternate;if(a!==null&&(a=a.updateQueue,i===a)){var d=null,y=null;if(i=i.firstBaseUpdate,i!==null){do{var S={eventTime:i.eventTime,lane:i.lane,tag:i.tag,payload:i.payload,callback:i.callback,next:null};y===null?d=y=S:y=y.next=S,i=i.next}while(i!==null);y===null?d=y=t:y=y.next=t}else d=y=t;i={baseState:a.baseState,firstBaseUpdate:d,lastBaseUpdate:y,shared:a.shared,effects:a.effects},e.updateQueue=i;return}e=i.lastBaseUpdate,e===null?i.firstBaseUpdate=t:e.next=t,i.lastBaseUpdate=t}function lw(e,t,i,a){var d=e.updateQueue;Md=!1;var y=d.firstBaseUpdate,S=d.lastBaseUpdate,s=d.shared.pending;if(s!==null){d.shared.pending=null;var N=s,D=N.next;N.next=null,S===null?y=D:S.next=D,S=N;var O=e.alternate;O!==null&&(O=O.updateQueue,s=O.lastBaseUpdate,s!==S&&(s===null?O.firstBaseUpdate=D:s.next=D,O.lastBaseUpdate=N))}if(y!==null){var $=d.baseState;S=0,O=D=N=null,s=y;do{var q=s.lane,J=s.eventTime;if((a&q)===q){O!==null&&(O=O.next={eventTime:J,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var re=e,Q=s;switch(q=t,J=i,Q.tag){case 1:if(re=Q.payload,typeof re=="function"){$=re.call(J,$,q);break e}$=re;break e;case 3:re.flags=re.flags&-65537|128;case 0:if(re=Q.payload,q=typeof re=="function"?re.call(J,$,q):re,q==null)break e;$=Zi({},$,q);break e;case 2:Md=!0}}s.callback!==null&&s.lane!==0&&(e.flags|=64,q=d.effects,q===null?d.effects=[s]:q.push(s))}else J={eventTime:J,lane:q,tag:s.tag,payload:s.payload,callback:s.callback,next:null},O===null?(D=O=J,N=$):O=O.next=J,S|=q;if(s=s.next,s===null){if(s=d.shared.pending,s===null)break;q=s,s=q.next,q.next=null,d.lastBaseUpdate=q,d.shared.pending=null}}while(!0);if(O===null&&(N=$),d.baseState=N,d.firstBaseUpdate=D,d.lastBaseUpdate=O,t=d.shared.interleaved,t!==null){d=t;do S|=d.lane,d=d.next;while(d!==t)}else y===null&&(d.shared.lanes=0);zf|=S,e.lanes=S,e.memoizedState=$}}function $j(e,t,i){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var a=e[t],d=a.callback;if(d!==null){if(a.callback=null,a=i,typeof d!="function")throw Error(nr(191,d));d.call(a)}}}var Lv={},bc=fh(Lv),Wx=fh(Lv),Zx=fh(Lv);function Ef(e){if(e===Lv)throw Error(nr(174));return e}function SA(e,t){switch(Ai(Zx,t),Ai(Wx,e),Ai(bc,Lv),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:_C(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=_C(t,e)}Oi(bc),Ai(bc,t)}function gg(){Oi(bc),Oi(Wx),Oi(Zx)}function bO(e){Ef(Zx.current);var t=Ef(bc.current),i=_C(t,e.type);t!==i&&(Ai(Wx,e),Ai(bc,i))}function TA(e){Wx.current===e&&(Oi(bc),Oi(Wx))}var Hi=fh(0);function cw(e){for(var t=e;t!==null;){if(t.tag===13){var i=t.memoizedState;if(i!==null&&(i=i.dehydrated,i===null||i.data==="$?"||i.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var yE=[];function EA(){for(var e=0;e<yE.length;e++)yE[e]._workInProgressVersionPrimary=null;yE.length=0}var Nb=vu.ReactCurrentDispatcher,xE=vu.ReactCurrentBatchConfig,Of=0,Wi=null,Rs=null,Fs=null,uw=!1,Ex=!1,Yx=0,Iq=0;function ro(){throw Error(nr(321))}function CA(e,t){if(t===null)return!1;for(var i=0;i<t.length&&i<e.length;i++)if(!Ol(e[i],t[i]))return!1;return!0}function MA(e,t,i,a,d,y){if(Of=y,Wi=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Nb.current=e===null||e.memoizedState===null?jq:Dq,e=i(a,d),Ex){y=0;do{if(Ex=!1,Yx=0,25<=y)throw Error(nr(301));y+=1,Fs=Rs=null,t.updateQueue=null,Nb.current=Lq,e=i(a,d)}while(Ex)}if(Nb.current=dw,t=Rs!==null&&Rs.next!==null,Of=0,Fs=Rs=Wi=null,uw=!1,t)throw Error(nr(300));return e}function AA(){var e=Yx!==0;return Yx=0,e}function dc(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Fs===null?Wi.memoizedState=Fs=e:Fs=Fs.next=e,Fs}function Ya(){if(Rs===null){var e=Wi.alternate;e=e!==null?e.memoizedState:null}else e=Rs.next;var t=Fs===null?Wi.memoizedState:Fs.next;if(t!==null)Fs=t,Rs=e;else{if(e===null)throw Error(nr(310));Rs=e,e={memoizedState:Rs.memoizedState,baseState:Rs.baseState,baseQueue:Rs.baseQueue,queue:Rs.queue,next:null},Fs===null?Wi.memoizedState=Fs=e:Fs=Fs.next=e}return Fs}function Xx(e,t){return typeof t=="function"?t(e):t}function vE(e){var t=Ya(),i=t.queue;if(i===null)throw Error(nr(311));i.lastRenderedReducer=e;var a=Rs,d=a.baseQueue,y=i.pending;if(y!==null){if(d!==null){var S=d.next;d.next=y.next,y.next=S}a.baseQueue=d=y,i.pending=null}if(d!==null){y=d.next,a=a.baseState;var s=S=null,N=null,D=y;do{var O=D.lane;if((Of&O)===O)N!==null&&(N=N.next={lane:0,action:D.action,hasEagerState:D.hasEagerState,eagerState:D.eagerState,next:null}),a=D.hasEagerState?D.eagerState:e(a,D.action);else{var $={lane:O,action:D.action,hasEagerState:D.hasEagerState,eagerState:D.eagerState,next:null};N===null?(s=N=$,S=a):N=N.next=$,Wi.lanes|=O,zf|=O}D=D.next}while(D!==null&&D!==y);N===null?S=a:N.next=s,Ol(a,t.memoizedState)||(Zo=!0),t.memoizedState=a,t.baseState=S,t.baseQueue=N,i.lastRenderedState=a}if(e=i.interleaved,e!==null){d=e;do y=d.lane,Wi.lanes|=y,zf|=y,d=d.next;while(d!==e)}else d===null&&(i.lanes=0);return[t.memoizedState,i.dispatch]}function bE(e){var t=Ya(),i=t.queue;if(i===null)throw Error(nr(311));i.lastRenderedReducer=e;var a=i.dispatch,d=i.pending,y=t.memoizedState;if(d!==null){i.pending=null;var S=d=d.next;do y=e(y,S.action),S=S.next;while(S!==d);Ol(y,t.memoizedState)||(Zo=!0),t.memoizedState=y,t.baseQueue===null&&(t.baseState=y),i.lastRenderedState=y}return[y,a]}function wO(){}function SO(e,t){var i=Wi,a=Ya(),d=t(),y=!Ol(a.memoizedState,d);if(y&&(a.memoizedState=d,Zo=!0),a=a.queue,PA(CO.bind(null,i,a,e),[e]),a.getSnapshot!==t||y||Fs!==null&&Fs.memoizedState.tag&1){if(i.flags|=2048,Kx(9,EO.bind(null,i,a,d,t),void 0,null),Bs===null)throw Error(nr(349));Of&30||TO(i,t,d)}return d}function TO(e,t,i){e.flags|=16384,e={getSnapshot:t,value:i},t=Wi.updateQueue,t===null?(t={lastEffect:null,stores:null},Wi.updateQueue=t,t.stores=[e]):(i=t.stores,i===null?t.stores=[e]:i.push(e))}function EO(e,t,i,a){t.value=i,t.getSnapshot=a,MO(t)&&AO(e)}function CO(e,t,i){return i(function(){MO(t)&&AO(e)})}function MO(e){var t=e.getSnapshot;e=e.value;try{var i=t();return!Ol(e,i)}catch{return!0}}function AO(e){var t=hu(e,1);t!==null&&jl(t,e,1,-1)}function Gj(e){var t=dc();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Xx,lastRenderedState:e},t.queue=e,e=e.dispatch=Rq.bind(null,Wi,e),[t.memoizedState,e]}function Kx(e,t,i,a){return e={tag:e,create:t,destroy:i,deps:a,next:null},t=Wi.updateQueue,t===null?(t={lastEffect:null,stores:null},Wi.updateQueue=t,t.lastEffect=e.next=e):(i=t.lastEffect,i===null?t.lastEffect=e.next=e:(a=i.next,i.next=e,e.next=a,t.lastEffect=e)),e}function PO(){return Ya().memoizedState}function Rb(e,t,i,a){var d=dc();Wi.flags|=e,d.memoizedState=Kx(1|t,i,void 0,a===void 0?null:a)}function r2(e,t,i,a){var d=Ya();a=a===void 0?null:a;var y=void 0;if(Rs!==null){var S=Rs.memoizedState;if(y=S.destroy,a!==null&&CA(a,S.deps)){d.memoizedState=Kx(t,i,y,a);return}}Wi.flags|=e,d.memoizedState=Kx(1|t,i,y,a)}function qj(e,t){return Rb(8390656,8,e,t)}function PA(e,t){return r2(2048,8,e,t)}function IO(e,t){return r2(4,2,e,t)}function kO(e,t){return r2(4,4,e,t)}function NO(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function RO(e,t,i){return i=i!=null?i.concat([e]):null,r2(4,4,NO.bind(null,t,e),i)}function IA(){}function jO(e,t){var i=Ya();t=t===void 0?null:t;var a=i.memoizedState;return a!==null&&t!==null&&CA(t,a[1])?a[0]:(i.memoizedState=[e,t],e)}function DO(e,t){var i=Ya();t=t===void 0?null:t;var a=i.memoizedState;return a!==null&&t!==null&&CA(t,a[1])?a[0]:(e=e(),i.memoizedState=[e,t],e)}function LO(e,t,i){return Of&21?(Ol(i,t)||(i=VL(),Wi.lanes|=i,zf|=i,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Zo=!0),e.memoizedState=i)}function kq(e,t){var i=yi;yi=i!==0&&4>i?i:4,e(!0);var a=xE.transition;xE.transition={};try{e(!1),t()}finally{yi=i,xE.transition=a}}function OO(){return Ya().memoizedState}function Nq(e,t,i){var a=Yd(e);if(i={lane:a,action:i,hasEagerState:!1,eagerState:null,next:null},zO(e))FO(t,i);else if(i=xO(e,t,i,a),i!==null){var d=Mo();jl(i,e,a,d),BO(i,t,a)}}function Rq(e,t,i){var a=Yd(e),d={lane:a,action:i,hasEagerState:!1,eagerState:null,next:null};if(zO(e))FO(t,d);else{var y=e.alternate;if(e.lanes===0&&(y===null||y.lanes===0)&&(y=t.lastRenderedReducer,y!==null))try{var S=t.lastRenderedState,s=y(S,i);if(d.hasEagerState=!0,d.eagerState=s,Ol(s,S)){var N=t.interleaved;N===null?(d.next=d,bA(t)):(d.next=N.next,N.next=d),t.interleaved=d;return}}catch{}finally{}i=xO(e,t,d,a),i!==null&&(d=Mo(),jl(i,e,a,d),BO(i,t,a))}}function zO(e){var t=e.alternate;return e===Wi||t!==null&&t===Wi}function FO(e,t){Ex=uw=!0;var i=e.pending;i===null?t.next=t:(t.next=i.next,i.next=t),e.pending=t}function BO(e,t,i){if(i&4194240){var a=t.lanes;a&=e.pendingLanes,i|=a,t.lanes=i,aA(e,i)}}var dw={readContext:Za,useCallback:ro,useContext:ro,useEffect:ro,useImperativeHandle:ro,useInsertionEffect:ro,useLayoutEffect:ro,useMemo:ro,useReducer:ro,useRef:ro,useState:ro,useDebugValue:ro,useDeferredValue:ro,useTransition:ro,useMutableSource:ro,useSyncExternalStore:ro,useId:ro,unstable_isNewReconciler:!1},jq={readContext:Za,useCallback:function(e,t){return dc().memoizedState=[e,t===void 0?null:t],e},useContext:Za,useEffect:qj,useImperativeHandle:function(e,t,i){return i=i!=null?i.concat([e]):null,Rb(4194308,4,NO.bind(null,t,e),i)},useLayoutEffect:function(e,t){return Rb(4194308,4,e,t)},useInsertionEffect:function(e,t){return Rb(4,2,e,t)},useMemo:function(e,t){var i=dc();return t=t===void 0?null:t,e=e(),i.memoizedState=[e,t],e},useReducer:function(e,t,i){var a=dc();return t=i!==void 0?i(t):t,a.memoizedState=a.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},a.queue=e,e=e.dispatch=Nq.bind(null,Wi,e),[a.memoizedState,e]},useRef:function(e){var t=dc();return e={current:e},t.memoizedState=e},useState:Gj,useDebugValue:IA,useDeferredValue:function(e){return dc().memoizedState=e},useTransition:function(){var e=Gj(!1),t=e[0];return e=kq.bind(null,e[1]),dc().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,i){var a=Wi,d=dc();if(Bi){if(i===void 0)throw Error(nr(407));i=i()}else{if(i=t(),Bs===null)throw Error(nr(349));Of&30||TO(a,t,i)}d.memoizedState=i;var y={value:i,getSnapshot:t};return d.queue=y,qj(CO.bind(null,a,y,e),[e]),a.flags|=2048,Kx(9,EO.bind(null,a,y,i,t),void 0,null),i},useId:function(){var e=dc(),t=Bs.identifierPrefix;if(Bi){var i=nu,a=ru;i=(a&~(1<<32-Rl(a)-1)).toString(32)+i,t=":"+t+"R"+i,i=Yx++,0<i&&(t+="H"+i.toString(32)),t+=":"}else i=Iq++,t=":"+t+"r"+i.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Dq={readContext:Za,useCallback:jO,useContext:Za,useEffect:PA,useImperativeHandle:RO,useInsertionEffect:IO,useLayoutEffect:kO,useMemo:DO,useReducer:vE,useRef:PO,useState:function(){return vE(Xx)},useDebugValue:IA,useDeferredValue:function(e){var t=Ya();return LO(t,Rs.memoizedState,e)},useTransition:function(){var e=vE(Xx)[0],t=Ya().memoizedState;return[e,t]},useMutableSource:wO,useSyncExternalStore:SO,useId:OO,unstable_isNewReconciler:!1},Lq={readContext:Za,useCallback:jO,useContext:Za,useEffect:PA,useImperativeHandle:RO,useInsertionEffect:IO,useLayoutEffect:kO,useMemo:DO,useReducer:bE,useRef:PO,useState:function(){return bE(Xx)},useDebugValue:IA,useDeferredValue:function(e){var t=Ya();return Rs===null?t.memoizedState=e:LO(t,Rs.memoizedState,e)},useTransition:function(){var e=bE(Xx)[0],t=Ya().memoizedState;return[e,t]},useMutableSource:wO,useSyncExternalStore:SO,useId:OO,unstable_isNewReconciler:!1};function Tl(e,t){if(e&&e.defaultProps){t=Zi({},t),e=e.defaultProps;for(var i in e)t[i]===void 0&&(t[i]=e[i]);return t}return t}function zC(e,t,i,a){t=e.memoizedState,i=i(a,t),i=i==null?t:Zi({},t,i),e.memoizedState=i,e.lanes===0&&(e.updateQueue.baseState=i)}var n2={isMounted:function(e){return(e=e._reactInternals)?Yf(e)===e:!1},enqueueSetState:function(e,t,i){e=e._reactInternals;var a=Mo(),d=Yd(e),y=su(a,d);y.payload=t,i!=null&&(y.callback=i),t=Wd(e,y,d),t!==null&&(jl(t,e,d,a),kb(t,e,d))},enqueueReplaceState:function(e,t,i){e=e._reactInternals;var a=Mo(),d=Yd(e),y=su(a,d);y.tag=1,y.payload=t,i!=null&&(y.callback=i),t=Wd(e,y,d),t!==null&&(jl(t,e,d,a),kb(t,e,d))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var i=Mo(),a=Yd(e),d=su(i,a);d.tag=2,t!=null&&(d.callback=t),t=Wd(e,d,a),t!==null&&(jl(t,e,a,i),kb(t,e,a))}};function Hj(e,t,i,a,d,y,S){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(a,y,S):t.prototype&&t.prototype.isPureReactComponent?!$x(i,a)||!$x(d,y):!0}function VO(e,t,i){var a=!1,d=rh,y=t.contextType;return typeof y=="object"&&y!==null?y=Za(y):(d=Ko(t)?Df:ao.current,a=t.contextTypes,y=(a=a!=null)?fg(e,d):rh),t=new t(i,y),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=n2,e.stateNode=t,t._reactInternals=e,a&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=d,e.__reactInternalMemoizedMaskedChildContext=y),t}function Wj(e,t,i,a){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(i,a),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(i,a),t.state!==e&&n2.enqueueReplaceState(t,t.state,null)}function FC(e,t,i,a){var d=e.stateNode;d.props=i,d.state=e.memoizedState,d.refs={},wA(e);var y=t.contextType;typeof y=="object"&&y!==null?d.context=Za(y):(y=Ko(t)?Df:ao.current,d.context=fg(e,y)),d.state=e.memoizedState,y=t.getDerivedStateFromProps,typeof y=="function"&&(zC(e,t,y,i),d.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof d.getSnapshotBeforeUpdate=="function"||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(t=d.state,typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount(),t!==d.state&&n2.enqueueReplaceState(d,d.state,null),lw(e,i,d,a),d.state=e.memoizedState),typeof d.componentDidMount=="function"&&(e.flags|=4194308)}function _g(e,t){try{var i="",a=t;do i+=uG(a),a=a.return;while(a);var d=i}catch(y){d=`
Error generating stack: `+y.message+`
`+y.stack}return{value:e,source:t,stack:d,digest:null}}function wE(e,t,i){return{value:e,source:null,stack:i??null,digest:t??null}}function BC(e,t){try{console.error(t.value)}catch(i){setTimeout(function(){throw i})}}var Oq=typeof WeakMap=="function"?WeakMap:Map;function UO(e,t,i){i=su(-1,i),i.tag=3,i.payload={element:null};var a=t.value;return i.callback=function(){fw||(fw=!0,XC=a),BC(e,t)},i}function $O(e,t,i){i=su(-1,i),i.tag=3;var a=e.type.getDerivedStateFromError;if(typeof a=="function"){var d=t.value;i.payload=function(){return a(d)},i.callback=function(){BC(e,t)}}var y=e.stateNode;return y!==null&&typeof y.componentDidCatch=="function"&&(i.callback=function(){BC(e,t),typeof a!="function"&&(Zd===null?Zd=new Set([this]):Zd.add(this));var S=t.stack;this.componentDidCatch(t.value,{componentStack:S!==null?S:""})}),i}function Zj(e,t,i){var a=e.pingCache;if(a===null){a=e.pingCache=new Oq;var d=new Set;a.set(t,d)}else d=a.get(t),d===void 0&&(d=new Set,a.set(t,d));d.has(i)||(d.add(i),e=Kq.bind(null,e,t,i),t.then(e,e))}function Yj(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function Xj(e,t,i,a,d){return e.mode&1?(e.flags|=65536,e.lanes=d,e):(e===t?e.flags|=65536:(e.flags|=128,i.flags|=131072,i.flags&=-52805,i.tag===1&&(i.alternate===null?i.tag=17:(t=su(-1,1),t.tag=2,Wd(i,t,1))),i.lanes|=1),e)}var zq=vu.ReactCurrentOwner,Zo=!1;function wo(e,t,i,a){t.child=e===null?yO(t,null,i,a):mg(t,e.child,i,a)}function Kj(e,t,i,a,d){i=i.render;var y=t.ref;return Zm(t,d),a=MA(e,t,i,a,y,d),i=AA(),e!==null&&!Zo?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~d,fu(e,t,d)):(Bi&&i&&mA(t),t.flags|=1,wo(e,t,a,d),t.child)}function Jj(e,t,i,a,d){if(e===null){var y=i.type;return typeof y=="function"&&!zA(y)&&y.defaultProps===void 0&&i.compare===null&&i.defaultProps===void 0?(t.tag=15,t.type=y,GO(e,t,y,a,d)):(e=Ob(i.type,null,a,t,t.mode,d),e.ref=t.ref,e.return=t,t.child=e)}if(y=e.child,!(e.lanes&d)){var S=y.memoizedProps;if(i=i.compare,i=i!==null?i:$x,i(S,a)&&e.ref===t.ref)return fu(e,t,d)}return t.flags|=1,e=Xd(y,a),e.ref=t.ref,e.return=t,t.child=e}function GO(e,t,i,a,d){if(e!==null){var y=e.memoizedProps;if($x(y,a)&&e.ref===t.ref)if(Zo=!1,t.pendingProps=a=y,(e.lanes&d)!==0)e.flags&131072&&(Zo=!0);else return t.lanes=e.lanes,fu(e,t,d)}return VC(e,t,i,a,d)}function qO(e,t,i){var a=t.pendingProps,d=a.children,y=e!==null?e.memoizedState:null;if(a.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ai(Um,_a),_a|=i;else{if(!(i&1073741824))return e=y!==null?y.baseLanes|i:i,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ai(Um,_a),_a|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},a=y!==null?y.baseLanes:i,Ai(Um,_a),_a|=a}else y!==null?(a=y.baseLanes|i,t.memoizedState=null):a=i,Ai(Um,_a),_a|=a;return wo(e,t,d,i),t.child}function HO(e,t){var i=t.ref;(e===null&&i!==null||e!==null&&e.ref!==i)&&(t.flags|=512,t.flags|=2097152)}function VC(e,t,i,a,d){var y=Ko(i)?Df:ao.current;return y=fg(t,y),Zm(t,d),i=MA(e,t,i,a,y,d),a=AA(),e!==null&&!Zo?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~d,fu(e,t,d)):(Bi&&a&&mA(t),t.flags|=1,wo(e,t,i,d),t.child)}function Qj(e,t,i,a,d){if(Ko(i)){var y=!0;nw(t)}else y=!1;if(Zm(t,d),t.stateNode===null)jb(e,t),VO(t,i,a),FC(t,i,a,d),a=!0;else if(e===null){var S=t.stateNode,s=t.memoizedProps;S.props=s;var N=S.context,D=i.contextType;typeof D=="object"&&D!==null?D=Za(D):(D=Ko(i)?Df:ao.current,D=fg(t,D));var O=i.getDerivedStateFromProps,$=typeof O=="function"||typeof S.getSnapshotBeforeUpdate=="function";$||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(s!==a||N!==D)&&Wj(t,S,a,D),Md=!1;var q=t.memoizedState;S.state=q,lw(t,a,S,d),N=t.memoizedState,s!==a||q!==N||Xo.current||Md?(typeof O=="function"&&(zC(t,i,O,a),N=t.memoizedState),(s=Md||Hj(t,i,s,a,q,N,D))?($||typeof S.UNSAFE_componentWillMount!="function"&&typeof S.componentWillMount!="function"||(typeof S.componentWillMount=="function"&&S.componentWillMount(),typeof S.UNSAFE_componentWillMount=="function"&&S.UNSAFE_componentWillMount()),typeof S.componentDidMount=="function"&&(t.flags|=4194308)):(typeof S.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=a,t.memoizedState=N),S.props=a,S.state=N,S.context=D,a=s):(typeof S.componentDidMount=="function"&&(t.flags|=4194308),a=!1)}else{S=t.stateNode,vO(e,t),s=t.memoizedProps,D=t.type===t.elementType?s:Tl(t.type,s),S.props=D,$=t.pendingProps,q=S.context,N=i.contextType,typeof N=="object"&&N!==null?N=Za(N):(N=Ko(i)?Df:ao.current,N=fg(t,N));var J=i.getDerivedStateFromProps;(O=typeof J=="function"||typeof S.getSnapshotBeforeUpdate=="function")||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(s!==$||q!==N)&&Wj(t,S,a,N),Md=!1,q=t.memoizedState,S.state=q,lw(t,a,S,d);var re=t.memoizedState;s!==$||q!==re||Xo.current||Md?(typeof J=="function"&&(zC(t,i,J,a),re=t.memoizedState),(D=Md||Hj(t,i,D,a,q,re,N)||!1)?(O||typeof S.UNSAFE_componentWillUpdate!="function"&&typeof S.componentWillUpdate!="function"||(typeof S.componentWillUpdate=="function"&&S.componentWillUpdate(a,re,N),typeof S.UNSAFE_componentWillUpdate=="function"&&S.UNSAFE_componentWillUpdate(a,re,N)),typeof S.componentDidUpdate=="function"&&(t.flags|=4),typeof S.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof S.componentDidUpdate!="function"||s===e.memoizedProps&&q===e.memoizedState||(t.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&q===e.memoizedState||(t.flags|=1024),t.memoizedProps=a,t.memoizedState=re),S.props=a,S.state=re,S.context=N,a=D):(typeof S.componentDidUpdate!="function"||s===e.memoizedProps&&q===e.memoizedState||(t.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&q===e.memoizedState||(t.flags|=1024),a=!1)}return UC(e,t,i,a,y,d)}function UC(e,t,i,a,d,y){HO(e,t);var S=(t.flags&128)!==0;if(!a&&!S)return d&&zj(t,i,!1),fu(e,t,y);a=t.stateNode,zq.current=t;var s=S&&typeof i.getDerivedStateFromError!="function"?null:a.render();return t.flags|=1,e!==null&&S?(t.child=mg(t,e.child,null,y),t.child=mg(t,null,s,y)):wo(e,t,s,y),t.memoizedState=a.state,d&&zj(t,i,!0),t.child}function WO(e){var t=e.stateNode;t.pendingContext?Oj(e,t.pendingContext,t.pendingContext!==t.context):t.context&&Oj(e,t.context,!1),SA(e,t.containerInfo)}function e3(e,t,i,a,d){return pg(),_A(d),t.flags|=256,wo(e,t,i,a),t.child}var $C={dehydrated:null,treeContext:null,retryLane:0};function GC(e){return{baseLanes:e,cachePool:null,transitions:null}}function ZO(e,t,i){var a=t.pendingProps,d=Hi.current,y=!1,S=(t.flags&128)!==0,s;if((s=S)||(s=e!==null&&e.memoizedState===null?!1:(d&2)!==0),s?(y=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(d|=1),Ai(Hi,d&1),e===null)return LC(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(S=a.children,e=a.fallback,y?(a=t.mode,y=t.child,S={mode:"hidden",children:S},!(a&1)&&y!==null?(y.childLanes=0,y.pendingProps=S):y=o2(S,a,0,null),e=Nf(e,a,i,null),y.return=t,e.return=t,y.sibling=e,t.child=y,t.child.memoizedState=GC(i),t.memoizedState=$C,e):kA(t,S));if(d=e.memoizedState,d!==null&&(s=d.dehydrated,s!==null))return Fq(e,t,S,a,s,d,i);if(y){y=a.fallback,S=t.mode,d=e.child,s=d.sibling;var N={mode:"hidden",children:a.children};return!(S&1)&&t.child!==d?(a=t.child,a.childLanes=0,a.pendingProps=N,t.deletions=null):(a=Xd(d,N),a.subtreeFlags=d.subtreeFlags&14680064),s!==null?y=Xd(s,y):(y=Nf(y,S,i,null),y.flags|=2),y.return=t,a.return=t,a.sibling=y,t.child=a,a=y,y=t.child,S=e.child.memoizedState,S=S===null?GC(i):{baseLanes:S.baseLanes|i,cachePool:null,transitions:S.transitions},y.memoizedState=S,y.childLanes=e.childLanes&~i,t.memoizedState=$C,a}return y=e.child,e=y.sibling,a=Xd(y,{mode:"visible",children:a.children}),!(t.mode&1)&&(a.lanes=i),a.return=t,a.sibling=null,e!==null&&(i=t.deletions,i===null?(t.deletions=[e],t.flags|=16):i.push(e)),t.child=a,t.memoizedState=null,a}function kA(e,t){return t=o2({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function sb(e,t,i,a){return a!==null&&_A(a),mg(t,e.child,null,i),e=kA(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Fq(e,t,i,a,d,y,S){if(i)return t.flags&256?(t.flags&=-257,a=wE(Error(nr(422))),sb(e,t,S,a)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(y=a.fallback,d=t.mode,a=o2({mode:"visible",children:a.children},d,0,null),y=Nf(y,d,S,null),y.flags|=2,a.return=t,y.return=t,a.sibling=y,t.child=a,t.mode&1&&mg(t,e.child,null,S),t.child.memoizedState=GC(S),t.memoizedState=$C,y);if(!(t.mode&1))return sb(e,t,S,null);if(d.data==="$!"){if(a=d.nextSibling&&d.nextSibling.dataset,a)var s=a.dgst;return a=s,y=Error(nr(419)),a=wE(y,a,void 0),sb(e,t,S,a)}if(s=(S&e.childLanes)!==0,Zo||s){if(a=Bs,a!==null){switch(S&-S){case 4:d=2;break;case 16:d=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:d=32;break;case 536870912:d=268435456;break;default:d=0}d=d&(a.suspendedLanes|S)?0:d,d!==0&&d!==y.retryLane&&(y.retryLane=d,hu(e,d),jl(a,e,d,-1))}return OA(),a=wE(Error(nr(421))),sb(e,t,S,a)}return d.data==="$?"?(t.flags|=128,t.child=e.child,t=Jq.bind(null,e),d._reactRetry=t,null):(e=y.treeContext,xa=Hd(d.nextSibling),va=t,Bi=!0,Pl=null,e!==null&&($a[Ga++]=ru,$a[Ga++]=nu,$a[Ga++]=Lf,ru=e.id,nu=e.overflow,Lf=t),t=kA(t,a.children),t.flags|=4096,t)}function t3(e,t,i){e.lanes|=t;var a=e.alternate;a!==null&&(a.lanes|=t),OC(e.return,t,i)}function SE(e,t,i,a,d){var y=e.memoizedState;y===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:a,tail:i,tailMode:d}:(y.isBackwards=t,y.rendering=null,y.renderingStartTime=0,y.last=a,y.tail=i,y.tailMode=d)}function YO(e,t,i){var a=t.pendingProps,d=a.revealOrder,y=a.tail;if(wo(e,t,a.children,i),a=Hi.current,a&2)a=a&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&t3(e,i,t);else if(e.tag===19)t3(e,i,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}a&=1}if(Ai(Hi,a),!(t.mode&1))t.memoizedState=null;else switch(d){case"forwards":for(i=t.child,d=null;i!==null;)e=i.alternate,e!==null&&cw(e)===null&&(d=i),i=i.sibling;i=d,i===null?(d=t.child,t.child=null):(d=i.sibling,i.sibling=null),SE(t,!1,d,i,y);break;case"backwards":for(i=null,d=t.child,t.child=null;d!==null;){if(e=d.alternate,e!==null&&cw(e)===null){t.child=d;break}e=d.sibling,d.sibling=i,i=d,d=e}SE(t,!0,i,null,y);break;case"together":SE(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function jb(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function fu(e,t,i){if(e!==null&&(t.dependencies=e.dependencies),zf|=t.lanes,!(i&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(nr(153));if(t.child!==null){for(e=t.child,i=Xd(e,e.pendingProps),t.child=i,i.return=t;e.sibling!==null;)e=e.sibling,i=i.sibling=Xd(e,e.pendingProps),i.return=t;i.sibling=null}return t.child}function Bq(e,t,i){switch(t.tag){case 3:WO(t),pg();break;case 5:bO(t);break;case 1:Ko(t.type)&&nw(t);break;case 4:SA(t,t.stateNode.containerInfo);break;case 10:var a=t.type._context,d=t.memoizedProps.value;Ai(ow,a._currentValue),a._currentValue=d;break;case 13:if(a=t.memoizedState,a!==null)return a.dehydrated!==null?(Ai(Hi,Hi.current&1),t.flags|=128,null):i&t.child.childLanes?ZO(e,t,i):(Ai(Hi,Hi.current&1),e=fu(e,t,i),e!==null?e.sibling:null);Ai(Hi,Hi.current&1);break;case 19:if(a=(i&t.childLanes)!==0,e.flags&128){if(a)return YO(e,t,i);t.flags|=128}if(d=t.memoizedState,d!==null&&(d.rendering=null,d.tail=null,d.lastEffect=null),Ai(Hi,Hi.current),a)break;return null;case 22:case 23:return t.lanes=0,qO(e,t,i)}return fu(e,t,i)}var XO,qC,KO,JO;XO=function(e,t){for(var i=t.child;i!==null;){if(i.tag===5||i.tag===6)e.appendChild(i.stateNode);else if(i.tag!==4&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===t)break;for(;i.sibling===null;){if(i.return===null||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}};qC=function(){};KO=function(e,t,i,a){var d=e.memoizedProps;if(d!==a){e=t.stateNode,Ef(bc.current);var y=null;switch(i){case"input":d=fC(e,d),a=fC(e,a),y=[];break;case"select":d=Zi({},d,{value:void 0}),a=Zi({},a,{value:void 0}),y=[];break;case"textarea":d=gC(e,d),a=gC(e,a),y=[];break;default:typeof d.onClick!="function"&&typeof a.onClick=="function"&&(e.onclick=tw)}yC(i,a);var S;i=null;for(D in d)if(!a.hasOwnProperty(D)&&d.hasOwnProperty(D)&&d[D]!=null)if(D==="style"){var s=d[D];for(S in s)s.hasOwnProperty(S)&&(i||(i={}),i[S]="")}else D!=="dangerouslySetInnerHTML"&&D!=="children"&&D!=="suppressContentEditableWarning"&&D!=="suppressHydrationWarning"&&D!=="autoFocus"&&(Lx.hasOwnProperty(D)?y||(y=[]):(y=y||[]).push(D,null));for(D in a){var N=a[D];if(s=d!=null?d[D]:void 0,a.hasOwnProperty(D)&&N!==s&&(N!=null||s!=null))if(D==="style")if(s){for(S in s)!s.hasOwnProperty(S)||N&&N.hasOwnProperty(S)||(i||(i={}),i[S]="");for(S in N)N.hasOwnProperty(S)&&s[S]!==N[S]&&(i||(i={}),i[S]=N[S])}else i||(y||(y=[]),y.push(D,i)),i=N;else D==="dangerouslySetInnerHTML"?(N=N?N.__html:void 0,s=s?s.__html:void 0,N!=null&&s!==N&&(y=y||[]).push(D,N)):D==="children"?typeof N!="string"&&typeof N!="number"||(y=y||[]).push(D,""+N):D!=="suppressContentEditableWarning"&&D!=="suppressHydrationWarning"&&(Lx.hasOwnProperty(D)?(N!=null&&D==="onScroll"&&Di("scroll",e),y||s===N||(y=[])):(y=y||[]).push(D,N))}i&&(y=y||[]).push("style",i);var D=y;(t.updateQueue=D)&&(t.flags|=4)}};JO=function(e,t,i,a){i!==a&&(t.flags|=4)};function Xy(e,t){if(!Bi)switch(e.tailMode){case"hidden":t=e.tail;for(var i=null;t!==null;)t.alternate!==null&&(i=t),t=t.sibling;i===null?e.tail=null:i.sibling=null;break;case"collapsed":i=e.tail;for(var a=null;i!==null;)i.alternate!==null&&(a=i),i=i.sibling;a===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:a.sibling=null}}function no(e){var t=e.alternate!==null&&e.alternate.child===e.child,i=0,a=0;if(t)for(var d=e.child;d!==null;)i|=d.lanes|d.childLanes,a|=d.subtreeFlags&14680064,a|=d.flags&14680064,d.return=e,d=d.sibling;else for(d=e.child;d!==null;)i|=d.lanes|d.childLanes,a|=d.subtreeFlags,a|=d.flags,d.return=e,d=d.sibling;return e.subtreeFlags|=a,e.childLanes=i,t}function Vq(e,t,i){var a=t.pendingProps;switch(gA(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return no(t),null;case 1:return Ko(t.type)&&rw(),no(t),null;case 3:return a=t.stateNode,gg(),Oi(Xo),Oi(ao),EA(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),(e===null||e.child===null)&&(nb(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,Pl!==null&&(QC(Pl),Pl=null))),qC(e,t),no(t),null;case 5:TA(t);var d=Ef(Zx.current);if(i=t.type,e!==null&&t.stateNode!=null)KO(e,t,i,a,d),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!a){if(t.stateNode===null)throw Error(nr(166));return no(t),null}if(e=Ef(bc.current),nb(t)){a=t.stateNode,i=t.type;var y=t.memoizedProps;switch(a[mc]=t,a[Hx]=y,e=(t.mode&1)!==0,i){case"dialog":Di("cancel",a),Di("close",a);break;case"iframe":case"object":case"embed":Di("load",a);break;case"video":case"audio":for(d=0;d<cx.length;d++)Di(cx[d],a);break;case"source":Di("error",a);break;case"img":case"image":case"link":Di("error",a),Di("load",a);break;case"details":Di("toggle",a);break;case"input":uj(a,y),Di("invalid",a);break;case"select":a._wrapperState={wasMultiple:!!y.multiple},Di("invalid",a);break;case"textarea":hj(a,y),Di("invalid",a)}yC(i,y),d=null;for(var S in y)if(y.hasOwnProperty(S)){var s=y[S];S==="children"?typeof s=="string"?a.textContent!==s&&(y.suppressHydrationWarning!==!0&&rb(a.textContent,s,e),d=["children",s]):typeof s=="number"&&a.textContent!==""+s&&(y.suppressHydrationWarning!==!0&&rb(a.textContent,s,e),d=["children",""+s]):Lx.hasOwnProperty(S)&&s!=null&&S==="onScroll"&&Di("scroll",a)}switch(i){case"input":Z1(a),dj(a,y,!0);break;case"textarea":Z1(a),fj(a);break;case"select":case"option":break;default:typeof y.onClick=="function"&&(a.onclick=tw)}a=d,t.updateQueue=a,a!==null&&(t.flags|=4)}else{S=d.nodeType===9?d:d.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=CL(i)),e==="http://www.w3.org/1999/xhtml"?i==="script"?(e=S.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof a.is=="string"?e=S.createElement(i,{is:a.is}):(e=S.createElement(i),i==="select"&&(S=e,a.multiple?S.multiple=!0:a.size&&(S.size=a.size))):e=S.createElementNS(e,i),e[mc]=t,e[Hx]=a,XO(e,t,!1,!1),t.stateNode=e;e:{switch(S=xC(i,a),i){case"dialog":Di("cancel",e),Di("close",e),d=a;break;case"iframe":case"object":case"embed":Di("load",e),d=a;break;case"video":case"audio":for(d=0;d<cx.length;d++)Di(cx[d],e);d=a;break;case"source":Di("error",e),d=a;break;case"img":case"image":case"link":Di("error",e),Di("load",e),d=a;break;case"details":Di("toggle",e),d=a;break;case"input":uj(e,a),d=fC(e,a),Di("invalid",e);break;case"option":d=a;break;case"select":e._wrapperState={wasMultiple:!!a.multiple},d=Zi({},a,{value:void 0}),Di("invalid",e);break;case"textarea":hj(e,a),d=gC(e,a),Di("invalid",e);break;default:d=a}yC(i,d),s=d;for(y in s)if(s.hasOwnProperty(y)){var N=s[y];y==="style"?PL(e,N):y==="dangerouslySetInnerHTML"?(N=N?N.__html:void 0,N!=null&&ML(e,N)):y==="children"?typeof N=="string"?(i!=="textarea"||N!=="")&&Ox(e,N):typeof N=="number"&&Ox(e,""+N):y!=="suppressContentEditableWarning"&&y!=="suppressHydrationWarning"&&y!=="autoFocus"&&(Lx.hasOwnProperty(y)?N!=null&&y==="onScroll"&&Di("scroll",e):N!=null&&tA(e,y,N,S))}switch(i){case"input":Z1(e),dj(e,a,!1);break;case"textarea":Z1(e),fj(e);break;case"option":a.value!=null&&e.setAttribute("value",""+th(a.value));break;case"select":e.multiple=!!a.multiple,y=a.value,y!=null?Gm(e,!!a.multiple,y,!1):a.defaultValue!=null&&Gm(e,!!a.multiple,a.defaultValue,!0);break;default:typeof d.onClick=="function"&&(e.onclick=tw)}switch(i){case"button":case"input":case"select":case"textarea":a=!!a.autoFocus;break e;case"img":a=!0;break e;default:a=!1}}a&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return no(t),null;case 6:if(e&&t.stateNode!=null)JO(e,t,e.memoizedProps,a);else{if(typeof a!="string"&&t.stateNode===null)throw Error(nr(166));if(i=Ef(Zx.current),Ef(bc.current),nb(t)){if(a=t.stateNode,i=t.memoizedProps,a[mc]=t,(y=a.nodeValue!==i)&&(e=va,e!==null))switch(e.tag){case 3:rb(a.nodeValue,i,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&rb(a.nodeValue,i,(e.mode&1)!==0)}y&&(t.flags|=4)}else a=(i.nodeType===9?i:i.ownerDocument).createTextNode(a),a[mc]=t,t.stateNode=a}return no(t),null;case 13:if(Oi(Hi),a=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(Bi&&xa!==null&&t.mode&1&&!(t.flags&128))gO(),pg(),t.flags|=98560,y=!1;else if(y=nb(t),a!==null&&a.dehydrated!==null){if(e===null){if(!y)throw Error(nr(318));if(y=t.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(nr(317));y[mc]=t}else pg(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;no(t),y=!1}else Pl!==null&&(QC(Pl),Pl=null),y=!0;if(!y)return t.flags&65536?t:null}return t.flags&128?(t.lanes=i,t):(a=a!==null,a!==(e!==null&&e.memoizedState!==null)&&a&&(t.child.flags|=8192,t.mode&1&&(e===null||Hi.current&1?js===0&&(js=3):OA())),t.updateQueue!==null&&(t.flags|=4),no(t),null);case 4:return gg(),qC(e,t),e===null&&Gx(t.stateNode.containerInfo),no(t),null;case 10:return vA(t.type._context),no(t),null;case 17:return Ko(t.type)&&rw(),no(t),null;case 19:if(Oi(Hi),y=t.memoizedState,y===null)return no(t),null;if(a=(t.flags&128)!==0,S=y.rendering,S===null)if(a)Xy(y,!1);else{if(js!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(S=cw(e),S!==null){for(t.flags|=128,Xy(y,!1),a=S.updateQueue,a!==null&&(t.updateQueue=a,t.flags|=4),t.subtreeFlags=0,a=i,i=t.child;i!==null;)y=i,e=a,y.flags&=14680066,S=y.alternate,S===null?(y.childLanes=0,y.lanes=e,y.child=null,y.subtreeFlags=0,y.memoizedProps=null,y.memoizedState=null,y.updateQueue=null,y.dependencies=null,y.stateNode=null):(y.childLanes=S.childLanes,y.lanes=S.lanes,y.child=S.child,y.subtreeFlags=0,y.deletions=null,y.memoizedProps=S.memoizedProps,y.memoizedState=S.memoizedState,y.updateQueue=S.updateQueue,y.type=S.type,e=S.dependencies,y.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),i=i.sibling;return Ai(Hi,Hi.current&1|2),t.child}e=e.sibling}y.tail!==null&&fs()>yg&&(t.flags|=128,a=!0,Xy(y,!1),t.lanes=4194304)}else{if(!a)if(e=cw(S),e!==null){if(t.flags|=128,a=!0,i=e.updateQueue,i!==null&&(t.updateQueue=i,t.flags|=4),Xy(y,!0),y.tail===null&&y.tailMode==="hidden"&&!S.alternate&&!Bi)return no(t),null}else 2*fs()-y.renderingStartTime>yg&&i!==1073741824&&(t.flags|=128,a=!0,Xy(y,!1),t.lanes=4194304);y.isBackwards?(S.sibling=t.child,t.child=S):(i=y.last,i!==null?i.sibling=S:t.child=S,y.last=S)}return y.tail!==null?(t=y.tail,y.rendering=t,y.tail=t.sibling,y.renderingStartTime=fs(),t.sibling=null,i=Hi.current,Ai(Hi,a?i&1|2:i&1),t):(no(t),null);case 22:case 23:return LA(),a=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==a&&(t.flags|=8192),a&&t.mode&1?_a&1073741824&&(no(t),t.subtreeFlags&6&&(t.flags|=8192)):no(t),null;case 24:return null;case 25:return null}throw Error(nr(156,t.tag))}function Uq(e,t){switch(gA(t),t.tag){case 1:return Ko(t.type)&&rw(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return gg(),Oi(Xo),Oi(ao),EA(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return TA(t),null;case 13:if(Oi(Hi),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(nr(340));pg()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Oi(Hi),null;case 4:return gg(),null;case 10:return vA(t.type._context),null;case 22:case 23:return LA(),null;case 24:return null;default:return null}}var ob=!1,so=!1,$q=typeof WeakSet=="function"?WeakSet:Set,Ir=null;function Vm(e,t){var i=e.ref;if(i!==null)if(typeof i=="function")try{i(null)}catch(a){ns(e,t,a)}else i.current=null}function HC(e,t,i){try{i()}catch(a){ns(e,t,a)}}var r3=!1;function Gq(e,t){if(PC=Jb,e=nO(),pA(e)){if("selectionStart"in e)var i={start:e.selectionStart,end:e.selectionEnd};else e:{i=(i=e.ownerDocument)&&i.defaultView||window;var a=i.getSelection&&i.getSelection();if(a&&a.rangeCount!==0){i=a.anchorNode;var d=a.anchorOffset,y=a.focusNode;a=a.focusOffset;try{i.nodeType,y.nodeType}catch{i=null;break e}var S=0,s=-1,N=-1,D=0,O=0,$=e,q=null;t:for(;;){for(var J;$!==i||d!==0&&$.nodeType!==3||(s=S+d),$!==y||a!==0&&$.nodeType!==3||(N=S+a),$.nodeType===3&&(S+=$.nodeValue.length),(J=$.firstChild)!==null;)q=$,$=J;for(;;){if($===e)break t;if(q===i&&++D===d&&(s=S),q===y&&++O===a&&(N=S),(J=$.nextSibling)!==null)break;$=q,q=$.parentNode}$=J}i=s===-1||N===-1?null:{start:s,end:N}}else i=null}i=i||{start:0,end:0}}else i=null;for(IC={focusedElem:e,selectionRange:i},Jb=!1,Ir=t;Ir!==null;)if(t=Ir,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Ir=e;else for(;Ir!==null;){t=Ir;try{var re=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(re!==null){var Q=re.memoizedProps,ce=re.memoizedState,le=t.stateNode,ae=le.getSnapshotBeforeUpdate(t.elementType===t.type?Q:Tl(t.type,Q),ce);le.__reactInternalSnapshotBeforeUpdate=ae}break;case 3:var he=t.stateNode.containerInfo;he.nodeType===1?he.textContent="":he.nodeType===9&&he.documentElement&&he.removeChild(he.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(nr(163))}}catch(Se){ns(t,t.return,Se)}if(e=t.sibling,e!==null){e.return=t.return,Ir=e;break}Ir=t.return}return re=r3,r3=!1,re}function Cx(e,t,i){var a=t.updateQueue;if(a=a!==null?a.lastEffect:null,a!==null){var d=a=a.next;do{if((d.tag&e)===e){var y=d.destroy;d.destroy=void 0,y!==void 0&&HC(t,i,y)}d=d.next}while(d!==a)}}function i2(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var i=t=t.next;do{if((i.tag&e)===e){var a=i.create;i.destroy=a()}i=i.next}while(i!==t)}}function WC(e){var t=e.ref;if(t!==null){var i=e.stateNode;switch(e.tag){case 5:e=i;break;default:e=i}typeof t=="function"?t(e):t.current=e}}function QO(e){var t=e.alternate;t!==null&&(e.alternate=null,QO(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[mc],delete t[Hx],delete t[RC],delete t[Cq],delete t[Mq])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function e4(e){return e.tag===5||e.tag===3||e.tag===4}function n3(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||e4(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function ZC(e,t,i){var a=e.tag;if(a===5||a===6)e=e.stateNode,t?i.nodeType===8?i.parentNode.insertBefore(e,t):i.insertBefore(e,t):(i.nodeType===8?(t=i.parentNode,t.insertBefore(e,i)):(t=i,t.appendChild(e)),i=i._reactRootContainer,i!=null||t.onclick!==null||(t.onclick=tw));else if(a!==4&&(e=e.child,e!==null))for(ZC(e,t,i),e=e.sibling;e!==null;)ZC(e,t,i),e=e.sibling}function YC(e,t,i){var a=e.tag;if(a===5||a===6)e=e.stateNode,t?i.insertBefore(e,t):i.appendChild(e);else if(a!==4&&(e=e.child,e!==null))for(YC(e,t,i),e=e.sibling;e!==null;)YC(e,t,i),e=e.sibling}var Hs=null,Ml=!1;function yd(e,t,i){for(i=i.child;i!==null;)t4(e,t,i),i=i.sibling}function t4(e,t,i){if(vc&&typeof vc.onCommitFiberUnmount=="function")try{vc.onCommitFiberUnmount(Xw,i)}catch{}switch(i.tag){case 5:so||Vm(i,t);case 6:var a=Hs,d=Ml;Hs=null,yd(e,t,i),Hs=a,Ml=d,Hs!==null&&(Ml?(e=Hs,i=i.stateNode,e.nodeType===8?e.parentNode.removeChild(i):e.removeChild(i)):Hs.removeChild(i.stateNode));break;case 18:Hs!==null&&(Ml?(e=Hs,i=i.stateNode,e.nodeType===8?gE(e.parentNode,i):e.nodeType===1&&gE(e,i),Vx(e)):gE(Hs,i.stateNode));break;case 4:a=Hs,d=Ml,Hs=i.stateNode.containerInfo,Ml=!0,yd(e,t,i),Hs=a,Ml=d;break;case 0:case 11:case 14:case 15:if(!so&&(a=i.updateQueue,a!==null&&(a=a.lastEffect,a!==null))){d=a=a.next;do{var y=d,S=y.destroy;y=y.tag,S!==void 0&&(y&2||y&4)&&HC(i,t,S),d=d.next}while(d!==a)}yd(e,t,i);break;case 1:if(!so&&(Vm(i,t),a=i.stateNode,typeof a.componentWillUnmount=="function"))try{a.props=i.memoizedProps,a.state=i.memoizedState,a.componentWillUnmount()}catch(s){ns(i,t,s)}yd(e,t,i);break;case 21:yd(e,t,i);break;case 22:i.mode&1?(so=(a=so)||i.memoizedState!==null,yd(e,t,i),so=a):yd(e,t,i);break;default:yd(e,t,i)}}function i3(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var i=e.stateNode;i===null&&(i=e.stateNode=new $q),t.forEach(function(a){var d=Qq.bind(null,e,a);i.has(a)||(i.add(a),a.then(d,d))})}}function wl(e,t){var i=t.deletions;if(i!==null)for(var a=0;a<i.length;a++){var d=i[a];try{var y=e,S=t,s=S;e:for(;s!==null;){switch(s.tag){case 5:Hs=s.stateNode,Ml=!1;break e;case 3:Hs=s.stateNode.containerInfo,Ml=!0;break e;case 4:Hs=s.stateNode.containerInfo,Ml=!0;break e}s=s.return}if(Hs===null)throw Error(nr(160));t4(y,S,d),Hs=null,Ml=!1;var N=d.alternate;N!==null&&(N.return=null),d.return=null}catch(D){ns(d,t,D)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)r4(t,e),t=t.sibling}function r4(e,t){var i=e.alternate,a=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(wl(t,e),cc(e),a&4){try{Cx(3,e,e.return),i2(3,e)}catch(Q){ns(e,e.return,Q)}try{Cx(5,e,e.return)}catch(Q){ns(e,e.return,Q)}}break;case 1:wl(t,e),cc(e),a&512&&i!==null&&Vm(i,i.return);break;case 5:if(wl(t,e),cc(e),a&512&&i!==null&&Vm(i,i.return),e.flags&32){var d=e.stateNode;try{Ox(d,"")}catch(Q){ns(e,e.return,Q)}}if(a&4&&(d=e.stateNode,d!=null)){var y=e.memoizedProps,S=i!==null?i.memoizedProps:y,s=e.type,N=e.updateQueue;if(e.updateQueue=null,N!==null)try{s==="input"&&y.type==="radio"&&y.name!=null&&TL(d,y),xC(s,S);var D=xC(s,y);for(S=0;S<N.length;S+=2){var O=N[S],$=N[S+1];O==="style"?PL(d,$):O==="dangerouslySetInnerHTML"?ML(d,$):O==="children"?Ox(d,$):tA(d,O,$,D)}switch(s){case"input":pC(d,y);break;case"textarea":EL(d,y);break;case"select":var q=d._wrapperState.wasMultiple;d._wrapperState.wasMultiple=!!y.multiple;var J=y.value;J!=null?Gm(d,!!y.multiple,J,!1):q!==!!y.multiple&&(y.defaultValue!=null?Gm(d,!!y.multiple,y.defaultValue,!0):Gm(d,!!y.multiple,y.multiple?[]:"",!1))}d[Hx]=y}catch(Q){ns(e,e.return,Q)}}break;case 6:if(wl(t,e),cc(e),a&4){if(e.stateNode===null)throw Error(nr(162));d=e.stateNode,y=e.memoizedProps;try{d.nodeValue=y}catch(Q){ns(e,e.return,Q)}}break;case 3:if(wl(t,e),cc(e),a&4&&i!==null&&i.memoizedState.isDehydrated)try{Vx(t.containerInfo)}catch(Q){ns(e,e.return,Q)}break;case 4:wl(t,e),cc(e);break;case 13:wl(t,e),cc(e),d=e.child,d.flags&8192&&(y=d.memoizedState!==null,d.stateNode.isHidden=y,!y||d.alternate!==null&&d.alternate.memoizedState!==null||(jA=fs())),a&4&&i3(e);break;case 22:if(O=i!==null&&i.memoizedState!==null,e.mode&1?(so=(D=so)||O,wl(t,e),so=D):wl(t,e),cc(e),a&8192){if(D=e.memoizedState!==null,(e.stateNode.isHidden=D)&&!O&&e.mode&1)for(Ir=e,O=e.child;O!==null;){for($=Ir=O;Ir!==null;){switch(q=Ir,J=q.child,q.tag){case 0:case 11:case 14:case 15:Cx(4,q,q.return);break;case 1:Vm(q,q.return);var re=q.stateNode;if(typeof re.componentWillUnmount=="function"){a=q,i=q.return;try{t=a,re.props=t.memoizedProps,re.state=t.memoizedState,re.componentWillUnmount()}catch(Q){ns(a,i,Q)}}break;case 5:Vm(q,q.return);break;case 22:if(q.memoizedState!==null){o3($);continue}}J!==null?(J.return=q,Ir=J):o3($)}O=O.sibling}e:for(O=null,$=e;;){if($.tag===5){if(O===null){O=$;try{d=$.stateNode,D?(y=d.style,typeof y.setProperty=="function"?y.setProperty("display","none","important"):y.display="none"):(s=$.stateNode,N=$.memoizedProps.style,S=N!=null&&N.hasOwnProperty("display")?N.display:null,s.style.display=AL("display",S))}catch(Q){ns(e,e.return,Q)}}}else if($.tag===6){if(O===null)try{$.stateNode.nodeValue=D?"":$.memoizedProps}catch(Q){ns(e,e.return,Q)}}else if(($.tag!==22&&$.tag!==23||$.memoizedState===null||$===e)&&$.child!==null){$.child.return=$,$=$.child;continue}if($===e)break e;for(;$.sibling===null;){if($.return===null||$.return===e)break e;O===$&&(O=null),$=$.return}O===$&&(O=null),$.sibling.return=$.return,$=$.sibling}}break;case 19:wl(t,e),cc(e),a&4&&i3(e);break;case 21:break;default:wl(t,e),cc(e)}}function cc(e){var t=e.flags;if(t&2){try{e:{for(var i=e.return;i!==null;){if(e4(i)){var a=i;break e}i=i.return}throw Error(nr(160))}switch(a.tag){case 5:var d=a.stateNode;a.flags&32&&(Ox(d,""),a.flags&=-33);var y=n3(e);YC(e,y,d);break;case 3:case 4:var S=a.stateNode.containerInfo,s=n3(e);ZC(e,s,S);break;default:throw Error(nr(161))}}catch(N){ns(e,e.return,N)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function qq(e,t,i){Ir=e,n4(e)}function n4(e,t,i){for(var a=(e.mode&1)!==0;Ir!==null;){var d=Ir,y=d.child;if(d.tag===22&&a){var S=d.memoizedState!==null||ob;if(!S){var s=d.alternate,N=s!==null&&s.memoizedState!==null||so;s=ob;var D=so;if(ob=S,(so=N)&&!D)for(Ir=d;Ir!==null;)S=Ir,N=S.child,S.tag===22&&S.memoizedState!==null?a3(d):N!==null?(N.return=S,Ir=N):a3(d);for(;y!==null;)Ir=y,n4(y),y=y.sibling;Ir=d,ob=s,so=D}s3(e)}else d.subtreeFlags&8772&&y!==null?(y.return=d,Ir=y):s3(e)}}function s3(e){for(;Ir!==null;){var t=Ir;if(t.flags&8772){var i=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:so||i2(5,t);break;case 1:var a=t.stateNode;if(t.flags&4&&!so)if(i===null)a.componentDidMount();else{var d=t.elementType===t.type?i.memoizedProps:Tl(t.type,i.memoizedProps);a.componentDidUpdate(d,i.memoizedState,a.__reactInternalSnapshotBeforeUpdate)}var y=t.updateQueue;y!==null&&$j(t,y,a);break;case 3:var S=t.updateQueue;if(S!==null){if(i=null,t.child!==null)switch(t.child.tag){case 5:i=t.child.stateNode;break;case 1:i=t.child.stateNode}$j(t,S,i)}break;case 5:var s=t.stateNode;if(i===null&&t.flags&4){i=s;var N=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":N.autoFocus&&i.focus();break;case"img":N.src&&(i.src=N.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var D=t.alternate;if(D!==null){var O=D.memoizedState;if(O!==null){var $=O.dehydrated;$!==null&&Vx($)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(nr(163))}so||t.flags&512&&WC(t)}catch(q){ns(t,t.return,q)}}if(t===e){Ir=null;break}if(i=t.sibling,i!==null){i.return=t.return,Ir=i;break}Ir=t.return}}function o3(e){for(;Ir!==null;){var t=Ir;if(t===e){Ir=null;break}var i=t.sibling;if(i!==null){i.return=t.return,Ir=i;break}Ir=t.return}}function a3(e){for(;Ir!==null;){var t=Ir;try{switch(t.tag){case 0:case 11:case 15:var i=t.return;try{i2(4,t)}catch(N){ns(t,i,N)}break;case 1:var a=t.stateNode;if(typeof a.componentDidMount=="function"){var d=t.return;try{a.componentDidMount()}catch(N){ns(t,d,N)}}var y=t.return;try{WC(t)}catch(N){ns(t,y,N)}break;case 5:var S=t.return;try{WC(t)}catch(N){ns(t,S,N)}}}catch(N){ns(t,t.return,N)}if(t===e){Ir=null;break}var s=t.sibling;if(s!==null){s.return=t.return,Ir=s;break}Ir=t.return}}var Hq=Math.ceil,hw=vu.ReactCurrentDispatcher,NA=vu.ReactCurrentOwner,Ha=vu.ReactCurrentBatchConfig,ei=0,Bs=null,Ss=null,Ws=0,_a=0,Um=fh(0),js=0,Jx=null,zf=0,s2=0,RA=0,Mx=null,Ho=null,jA=0,yg=1/0,Qc=null,fw=!1,XC=null,Zd=null,ab=!1,Vd=null,pw=0,Ax=0,KC=null,Db=-1,Lb=0;function Mo(){return ei&6?fs():Db!==-1?Db:Db=fs()}function Yd(e){return e.mode&1?ei&2&&Ws!==0?Ws&-Ws:Pq.transition!==null?(Lb===0&&(Lb=VL()),Lb):(e=yi,e!==0||(e=window.event,e=e===void 0?16:ZL(e.type)),e):1}function jl(e,t,i,a){if(50<Ax)throw Ax=0,KC=null,Error(nr(185));Rv(e,i,a),(!(ei&2)||e!==Bs)&&(e===Bs&&(!(ei&2)&&(s2|=i),js===4&&kd(e,Ws)),Jo(e,a),i===1&&ei===0&&!(t.mode&1)&&(yg=fs()+500,t2&&ph()))}function Jo(e,t){var i=e.callbackNode;PG(e,t);var a=Kb(e,e===Bs?Ws:0);if(a===0)i!==null&&gj(i),e.callbackNode=null,e.callbackPriority=0;else if(t=a&-a,e.callbackPriority!==t){if(i!=null&&gj(i),t===1)e.tag===0?Aq(l3.bind(null,e)):fO(l3.bind(null,e)),Tq(function(){!(ei&6)&&ph()}),i=null;else{switch(UL(a)){case 1:i=oA;break;case 4:i=FL;break;case 16:i=Xb;break;case 536870912:i=BL;break;default:i=Xb}i=d4(i,i4.bind(null,e))}e.callbackPriority=t,e.callbackNode=i}}function i4(e,t){if(Db=-1,Lb=0,ei&6)throw Error(nr(327));var i=e.callbackNode;if(Ym()&&e.callbackNode!==i)return null;var a=Kb(e,e===Bs?Ws:0);if(a===0)return null;if(a&30||a&e.expiredLanes||t)t=mw(e,a);else{t=a;var d=ei;ei|=2;var y=o4();(Bs!==e||Ws!==t)&&(Qc=null,yg=fs()+500,kf(e,t));do try{Yq();break}catch(s){s4(e,s)}while(!0);xA(),hw.current=y,ei=d,Ss!==null?t=0:(Bs=null,Ws=0,t=js)}if(t!==0){if(t===2&&(d=TC(e),d!==0&&(a=d,t=JC(e,d))),t===1)throw i=Jx,kf(e,0),kd(e,a),Jo(e,fs()),i;if(t===6)kd(e,a);else{if(d=e.current.alternate,!(a&30)&&!Wq(d)&&(t=mw(e,a),t===2&&(y=TC(e),y!==0&&(a=y,t=JC(e,y))),t===1))throw i=Jx,kf(e,0),kd(e,a),Jo(e,fs()),i;switch(e.finishedWork=d,e.finishedLanes=a,t){case 0:case 1:throw Error(nr(345));case 2:xf(e,Ho,Qc);break;case 3:if(kd(e,a),(a&130023424)===a&&(t=jA+500-fs(),10<t)){if(Kb(e,0)!==0)break;if(d=e.suspendedLanes,(d&a)!==a){Mo(),e.pingedLanes|=e.suspendedLanes&d;break}e.timeoutHandle=NC(xf.bind(null,e,Ho,Qc),t);break}xf(e,Ho,Qc);break;case 4:if(kd(e,a),(a&4194240)===a)break;for(t=e.eventTimes,d=-1;0<a;){var S=31-Rl(a);y=1<<S,S=t[S],S>d&&(d=S),a&=~y}if(a=d,a=fs()-a,a=(120>a?120:480>a?480:1080>a?1080:1920>a?1920:3e3>a?3e3:4320>a?4320:1960*Hq(a/1960))-a,10<a){e.timeoutHandle=NC(xf.bind(null,e,Ho,Qc),a);break}xf(e,Ho,Qc);break;case 5:xf(e,Ho,Qc);break;default:throw Error(nr(329))}}}return Jo(e,fs()),e.callbackNode===i?i4.bind(null,e):null}function JC(e,t){var i=Mx;return e.current.memoizedState.isDehydrated&&(kf(e,t).flags|=256),e=mw(e,t),e!==2&&(t=Ho,Ho=i,t!==null&&QC(t)),e}function QC(e){Ho===null?Ho=e:Ho.push.apply(Ho,e)}function Wq(e){for(var t=e;;){if(t.flags&16384){var i=t.updateQueue;if(i!==null&&(i=i.stores,i!==null))for(var a=0;a<i.length;a++){var d=i[a],y=d.getSnapshot;d=d.value;try{if(!Ol(y(),d))return!1}catch{return!1}}}if(i=t.child,t.subtreeFlags&16384&&i!==null)i.return=t,t=i;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function kd(e,t){for(t&=~RA,t&=~s2,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var i=31-Rl(t),a=1<<i;e[i]=-1,t&=~a}}function l3(e){if(ei&6)throw Error(nr(327));Ym();var t=Kb(e,0);if(!(t&1))return Jo(e,fs()),null;var i=mw(e,t);if(e.tag!==0&&i===2){var a=TC(e);a!==0&&(t=a,i=JC(e,a))}if(i===1)throw i=Jx,kf(e,0),kd(e,t),Jo(e,fs()),i;if(i===6)throw Error(nr(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,xf(e,Ho,Qc),Jo(e,fs()),null}function DA(e,t){var i=ei;ei|=1;try{return e(t)}finally{ei=i,ei===0&&(yg=fs()+500,t2&&ph())}}function Ff(e){Vd!==null&&Vd.tag===0&&!(ei&6)&&Ym();var t=ei;ei|=1;var i=Ha.transition,a=yi;try{if(Ha.transition=null,yi=1,e)return e()}finally{yi=a,Ha.transition=i,ei=t,!(ei&6)&&ph()}}function LA(){_a=Um.current,Oi(Um)}function kf(e,t){e.finishedWork=null,e.finishedLanes=0;var i=e.timeoutHandle;if(i!==-1&&(e.timeoutHandle=-1,Sq(i)),Ss!==null)for(i=Ss.return;i!==null;){var a=i;switch(gA(a),a.tag){case 1:a=a.type.childContextTypes,a!=null&&rw();break;case 3:gg(),Oi(Xo),Oi(ao),EA();break;case 5:TA(a);break;case 4:gg();break;case 13:Oi(Hi);break;case 19:Oi(Hi);break;case 10:vA(a.type._context);break;case 22:case 23:LA()}i=i.return}if(Bs=e,Ss=e=Xd(e.current,null),Ws=_a=t,js=0,Jx=null,RA=s2=zf=0,Ho=Mx=null,Tf!==null){for(t=0;t<Tf.length;t++)if(i=Tf[t],a=i.interleaved,a!==null){i.interleaved=null;var d=a.next,y=i.pending;if(y!==null){var S=y.next;y.next=d,a.next=S}i.pending=a}Tf=null}return e}function s4(e,t){do{var i=Ss;try{if(xA(),Nb.current=dw,uw){for(var a=Wi.memoizedState;a!==null;){var d=a.queue;d!==null&&(d.pending=null),a=a.next}uw=!1}if(Of=0,Fs=Rs=Wi=null,Ex=!1,Yx=0,NA.current=null,i===null||i.return===null){js=1,Jx=t,Ss=null;break}e:{var y=e,S=i.return,s=i,N=t;if(t=Ws,s.flags|=32768,N!==null&&typeof N=="object"&&typeof N.then=="function"){var D=N,O=s,$=O.tag;if(!(O.mode&1)&&($===0||$===11||$===15)){var q=O.alternate;q?(O.updateQueue=q.updateQueue,O.memoizedState=q.memoizedState,O.lanes=q.lanes):(O.updateQueue=null,O.memoizedState=null)}var J=Yj(S);if(J!==null){J.flags&=-257,Xj(J,S,s,y,t),J.mode&1&&Zj(y,D,t),t=J,N=D;var re=t.updateQueue;if(re===null){var Q=new Set;Q.add(N),t.updateQueue=Q}else re.add(N);break e}else{if(!(t&1)){Zj(y,D,t),OA();break e}N=Error(nr(426))}}else if(Bi&&s.mode&1){var ce=Yj(S);if(ce!==null){!(ce.flags&65536)&&(ce.flags|=256),Xj(ce,S,s,y,t),_A(_g(N,s));break e}}y=N=_g(N,s),js!==4&&(js=2),Mx===null?Mx=[y]:Mx.push(y),y=S;do{switch(y.tag){case 3:y.flags|=65536,t&=-t,y.lanes|=t;var le=UO(y,N,t);Uj(y,le);break e;case 1:s=N;var ae=y.type,he=y.stateNode;if(!(y.flags&128)&&(typeof ae.getDerivedStateFromError=="function"||he!==null&&typeof he.componentDidCatch=="function"&&(Zd===null||!Zd.has(he)))){y.flags|=65536,t&=-t,y.lanes|=t;var Se=$O(y,s,t);Uj(y,Se);break e}}y=y.return}while(y!==null)}l4(i)}catch(je){t=je,Ss===i&&i!==null&&(Ss=i=i.return);continue}break}while(!0)}function o4(){var e=hw.current;return hw.current=dw,e===null?dw:e}function OA(){(js===0||js===3||js===2)&&(js=4),Bs===null||!(zf&268435455)&&!(s2&268435455)||kd(Bs,Ws)}function mw(e,t){var i=ei;ei|=2;var a=o4();(Bs!==e||Ws!==t)&&(Qc=null,kf(e,t));do try{Zq();break}catch(d){s4(e,d)}while(!0);if(xA(),ei=i,hw.current=a,Ss!==null)throw Error(nr(261));return Bs=null,Ws=0,js}function Zq(){for(;Ss!==null;)a4(Ss)}function Yq(){for(;Ss!==null&&!vG();)a4(Ss)}function a4(e){var t=u4(e.alternate,e,_a);e.memoizedProps=e.pendingProps,t===null?l4(e):Ss=t,NA.current=null}function l4(e){var t=e;do{var i=t.alternate;if(e=t.return,t.flags&32768){if(i=Uq(i,t),i!==null){i.flags&=32767,Ss=i;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{js=6,Ss=null;return}}else if(i=Vq(i,t,_a),i!==null){Ss=i;return}if(t=t.sibling,t!==null){Ss=t;return}Ss=t=e}while(t!==null);js===0&&(js=5)}function xf(e,t,i){var a=yi,d=Ha.transition;try{Ha.transition=null,yi=1,Xq(e,t,i,a)}finally{Ha.transition=d,yi=a}return null}function Xq(e,t,i,a){do Ym();while(Vd!==null);if(ei&6)throw Error(nr(327));i=e.finishedWork;var d=e.finishedLanes;if(i===null)return null;if(e.finishedWork=null,e.finishedLanes=0,i===e.current)throw Error(nr(177));e.callbackNode=null,e.callbackPriority=0;var y=i.lanes|i.childLanes;if(IG(e,y),e===Bs&&(Ss=Bs=null,Ws=0),!(i.subtreeFlags&2064)&&!(i.flags&2064)||ab||(ab=!0,d4(Xb,function(){return Ym(),null})),y=(i.flags&15990)!==0,i.subtreeFlags&15990||y){y=Ha.transition,Ha.transition=null;var S=yi;yi=1;var s=ei;ei|=4,NA.current=null,Gq(e,i),r4(i,e),gq(IC),Jb=!!PC,IC=PC=null,e.current=i,qq(i),bG(),ei=s,yi=S,Ha.transition=y}else e.current=i;if(ab&&(ab=!1,Vd=e,pw=d),y=e.pendingLanes,y===0&&(Zd=null),TG(i.stateNode),Jo(e,fs()),t!==null)for(a=e.onRecoverableError,i=0;i<t.length;i++)d=t[i],a(d.value,{componentStack:d.stack,digest:d.digest});if(fw)throw fw=!1,e=XC,XC=null,e;return pw&1&&e.tag!==0&&Ym(),y=e.pendingLanes,y&1?e===KC?Ax++:(Ax=0,KC=e):Ax=0,ph(),null}function Ym(){if(Vd!==null){var e=UL(pw),t=Ha.transition,i=yi;try{if(Ha.transition=null,yi=16>e?16:e,Vd===null)var a=!1;else{if(e=Vd,Vd=null,pw=0,ei&6)throw Error(nr(331));var d=ei;for(ei|=4,Ir=e.current;Ir!==null;){var y=Ir,S=y.child;if(Ir.flags&16){var s=y.deletions;if(s!==null){for(var N=0;N<s.length;N++){var D=s[N];for(Ir=D;Ir!==null;){var O=Ir;switch(O.tag){case 0:case 11:case 15:Cx(8,O,y)}var $=O.child;if($!==null)$.return=O,Ir=$;else for(;Ir!==null;){O=Ir;var q=O.sibling,J=O.return;if(QO(O),O===D){Ir=null;break}if(q!==null){q.return=J,Ir=q;break}Ir=J}}}var re=y.alternate;if(re!==null){var Q=re.child;if(Q!==null){re.child=null;do{var ce=Q.sibling;Q.sibling=null,Q=ce}while(Q!==null)}}Ir=y}}if(y.subtreeFlags&2064&&S!==null)S.return=y,Ir=S;else e:for(;Ir!==null;){if(y=Ir,y.flags&2048)switch(y.tag){case 0:case 11:case 15:Cx(9,y,y.return)}var le=y.sibling;if(le!==null){le.return=y.return,Ir=le;break e}Ir=y.return}}var ae=e.current;for(Ir=ae;Ir!==null;){S=Ir;var he=S.child;if(S.subtreeFlags&2064&&he!==null)he.return=S,Ir=he;else e:for(S=ae;Ir!==null;){if(s=Ir,s.flags&2048)try{switch(s.tag){case 0:case 11:case 15:i2(9,s)}}catch(je){ns(s,s.return,je)}if(s===S){Ir=null;break e}var Se=s.sibling;if(Se!==null){Se.return=s.return,Ir=Se;break e}Ir=s.return}}if(ei=d,ph(),vc&&typeof vc.onPostCommitFiberRoot=="function")try{vc.onPostCommitFiberRoot(Xw,e)}catch{}a=!0}return a}finally{yi=i,Ha.transition=t}}return!1}function c3(e,t,i){t=_g(i,t),t=UO(e,t,1),e=Wd(e,t,1),t=Mo(),e!==null&&(Rv(e,1,t),Jo(e,t))}function ns(e,t,i){if(e.tag===3)c3(e,e,i);else for(;t!==null;){if(t.tag===3){c3(t,e,i);break}else if(t.tag===1){var a=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof a.componentDidCatch=="function"&&(Zd===null||!Zd.has(a))){e=_g(i,e),e=$O(t,e,1),t=Wd(t,e,1),e=Mo(),t!==null&&(Rv(t,1,e),Jo(t,e));break}}t=t.return}}function Kq(e,t,i){var a=e.pingCache;a!==null&&a.delete(t),t=Mo(),e.pingedLanes|=e.suspendedLanes&i,Bs===e&&(Ws&i)===i&&(js===4||js===3&&(Ws&130023424)===Ws&&500>fs()-jA?kf(e,0):RA|=i),Jo(e,t)}function c4(e,t){t===0&&(e.mode&1?(t=K1,K1<<=1,!(K1&130023424)&&(K1=4194304)):t=1);var i=Mo();e=hu(e,t),e!==null&&(Rv(e,t,i),Jo(e,i))}function Jq(e){var t=e.memoizedState,i=0;t!==null&&(i=t.retryLane),c4(e,i)}function Qq(e,t){var i=0;switch(e.tag){case 13:var a=e.stateNode,d=e.memoizedState;d!==null&&(i=d.retryLane);break;case 19:a=e.stateNode;break;default:throw Error(nr(314))}a!==null&&a.delete(t),c4(e,i)}var u4;u4=function(e,t,i){if(e!==null)if(e.memoizedProps!==t.pendingProps||Xo.current)Zo=!0;else{if(!(e.lanes&i)&&!(t.flags&128))return Zo=!1,Bq(e,t,i);Zo=!!(e.flags&131072)}else Zo=!1,Bi&&t.flags&1048576&&pO(t,sw,t.index);switch(t.lanes=0,t.tag){case 2:var a=t.type;jb(e,t),e=t.pendingProps;var d=fg(t,ao.current);Zm(t,i),d=MA(null,t,a,e,d,i);var y=AA();return t.flags|=1,typeof d=="object"&&d!==null&&typeof d.render=="function"&&d.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Ko(a)?(y=!0,nw(t)):y=!1,t.memoizedState=d.state!==null&&d.state!==void 0?d.state:null,wA(t),d.updater=n2,t.stateNode=d,d._reactInternals=t,FC(t,a,e,i),t=UC(null,t,a,!0,y,i)):(t.tag=0,Bi&&y&&mA(t),wo(null,t,d,i),t=t.child),t;case 16:a=t.elementType;e:{switch(jb(e,t),e=t.pendingProps,d=a._init,a=d(a._payload),t.type=a,d=t.tag=tH(a),e=Tl(a,e),d){case 0:t=VC(null,t,a,e,i);break e;case 1:t=Qj(null,t,a,e,i);break e;case 11:t=Kj(null,t,a,e,i);break e;case 14:t=Jj(null,t,a,Tl(a.type,e),i);break e}throw Error(nr(306,a,""))}return t;case 0:return a=t.type,d=t.pendingProps,d=t.elementType===a?d:Tl(a,d),VC(e,t,a,d,i);case 1:return a=t.type,d=t.pendingProps,d=t.elementType===a?d:Tl(a,d),Qj(e,t,a,d,i);case 3:e:{if(WO(t),e===null)throw Error(nr(387));a=t.pendingProps,y=t.memoizedState,d=y.element,vO(e,t),lw(t,a,null,i);var S=t.memoizedState;if(a=S.element,y.isDehydrated)if(y={element:a,isDehydrated:!1,cache:S.cache,pendingSuspenseBoundaries:S.pendingSuspenseBoundaries,transitions:S.transitions},t.updateQueue.baseState=y,t.memoizedState=y,t.flags&256){d=_g(Error(nr(423)),t),t=e3(e,t,a,i,d);break e}else if(a!==d){d=_g(Error(nr(424)),t),t=e3(e,t,a,i,d);break e}else for(xa=Hd(t.stateNode.containerInfo.firstChild),va=t,Bi=!0,Pl=null,i=yO(t,null,a,i),t.child=i;i;)i.flags=i.flags&-3|4096,i=i.sibling;else{if(pg(),a===d){t=fu(e,t,i);break e}wo(e,t,a,i)}t=t.child}return t;case 5:return bO(t),e===null&&LC(t),a=t.type,d=t.pendingProps,y=e!==null?e.memoizedProps:null,S=d.children,kC(a,d)?S=null:y!==null&&kC(a,y)&&(t.flags|=32),HO(e,t),wo(e,t,S,i),t.child;case 6:return e===null&&LC(t),null;case 13:return ZO(e,t,i);case 4:return SA(t,t.stateNode.containerInfo),a=t.pendingProps,e===null?t.child=mg(t,null,a,i):wo(e,t,a,i),t.child;case 11:return a=t.type,d=t.pendingProps,d=t.elementType===a?d:Tl(a,d),Kj(e,t,a,d,i);case 7:return wo(e,t,t.pendingProps,i),t.child;case 8:return wo(e,t,t.pendingProps.children,i),t.child;case 12:return wo(e,t,t.pendingProps.children,i),t.child;case 10:e:{if(a=t.type._context,d=t.pendingProps,y=t.memoizedProps,S=d.value,Ai(ow,a._currentValue),a._currentValue=S,y!==null)if(Ol(y.value,S)){if(y.children===d.children&&!Xo.current){t=fu(e,t,i);break e}}else for(y=t.child,y!==null&&(y.return=t);y!==null;){var s=y.dependencies;if(s!==null){S=y.child;for(var N=s.firstContext;N!==null;){if(N.context===a){if(y.tag===1){N=su(-1,i&-i),N.tag=2;var D=y.updateQueue;if(D!==null){D=D.shared;var O=D.pending;O===null?N.next=N:(N.next=O.next,O.next=N),D.pending=N}}y.lanes|=i,N=y.alternate,N!==null&&(N.lanes|=i),OC(y.return,i,t),s.lanes|=i;break}N=N.next}}else if(y.tag===10)S=y.type===t.type?null:y.child;else if(y.tag===18){if(S=y.return,S===null)throw Error(nr(341));S.lanes|=i,s=S.alternate,s!==null&&(s.lanes|=i),OC(S,i,t),S=y.sibling}else S=y.child;if(S!==null)S.return=y;else for(S=y;S!==null;){if(S===t){S=null;break}if(y=S.sibling,y!==null){y.return=S.return,S=y;break}S=S.return}y=S}wo(e,t,d.children,i),t=t.child}return t;case 9:return d=t.type,a=t.pendingProps.children,Zm(t,i),d=Za(d),a=a(d),t.flags|=1,wo(e,t,a,i),t.child;case 14:return a=t.type,d=Tl(a,t.pendingProps),d=Tl(a.type,d),Jj(e,t,a,d,i);case 15:return GO(e,t,t.type,t.pendingProps,i);case 17:return a=t.type,d=t.pendingProps,d=t.elementType===a?d:Tl(a,d),jb(e,t),t.tag=1,Ko(a)?(e=!0,nw(t)):e=!1,Zm(t,i),VO(t,a,d),FC(t,a,d,i),UC(null,t,a,!0,e,i);case 19:return YO(e,t,i);case 22:return qO(e,t,i)}throw Error(nr(156,t.tag))};function d4(e,t){return zL(e,t)}function eH(e,t,i,a){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=a,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function qa(e,t,i,a){return new eH(e,t,i,a)}function zA(e){return e=e.prototype,!(!e||!e.isReactComponent)}function tH(e){if(typeof e=="function")return zA(e)?1:0;if(e!=null){if(e=e.$$typeof,e===nA)return 11;if(e===iA)return 14}return 2}function Xd(e,t){var i=e.alternate;return i===null?(i=qa(e.tag,t,e.key,e.mode),i.elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,i.alternate=e,e.alternate=i):(i.pendingProps=t,i.type=e.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=e.flags&14680064,i.childLanes=e.childLanes,i.lanes=e.lanes,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,t=e.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i}function Ob(e,t,i,a,d,y){var S=2;if(a=e,typeof e=="function")zA(e)&&(S=1);else if(typeof e=="string")S=5;else e:switch(e){case Nm:return Nf(i.children,d,y,t);case rA:S=8,d|=8;break;case cC:return e=qa(12,i,t,d|2),e.elementType=cC,e.lanes=y,e;case uC:return e=qa(13,i,t,d),e.elementType=uC,e.lanes=y,e;case dC:return e=qa(19,i,t,d),e.elementType=dC,e.lanes=y,e;case bL:return o2(i,d,y,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case xL:S=10;break e;case vL:S=9;break e;case nA:S=11;break e;case iA:S=14;break e;case Cd:S=16,a=null;break e}throw Error(nr(130,e==null?e:typeof e,""))}return t=qa(S,i,t,d),t.elementType=e,t.type=a,t.lanes=y,t}function Nf(e,t,i,a){return e=qa(7,e,a,t),e.lanes=i,e}function o2(e,t,i,a){return e=qa(22,e,a,t),e.elementType=bL,e.lanes=i,e.stateNode={isHidden:!1},e}function TE(e,t,i){return e=qa(6,e,null,t),e.lanes=i,e}function EE(e,t,i){return t=qa(4,e.children!==null?e.children:[],e.key,t),t.lanes=i,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function rH(e,t,i,a,d){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=sE(0),this.expirationTimes=sE(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=sE(0),this.identifierPrefix=a,this.onRecoverableError=d,this.mutableSourceEagerHydrationData=null}function FA(e,t,i,a,d,y,S,s,N){return e=new rH(e,t,i,s,N),t===1?(t=1,y===!0&&(t|=8)):t=0,y=qa(3,null,null,t),e.current=y,y.stateNode=e,y.memoizedState={element:a,isDehydrated:i,cache:null,transitions:null,pendingSuspenseBoundaries:null},wA(y),e}function nH(e,t,i){var a=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:km,key:a==null?null:""+a,children:e,containerInfo:t,implementation:i}}function h4(e){if(!e)return rh;e=e._reactInternals;e:{if(Yf(e)!==e||e.tag!==1)throw Error(nr(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Ko(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(nr(171))}if(e.tag===1){var i=e.type;if(Ko(i))return hO(e,i,t)}return t}function f4(e,t,i,a,d,y,S,s,N){return e=FA(i,a,!0,e,d,y,S,s,N),e.context=h4(null),i=e.current,a=Mo(),d=Yd(i),y=su(a,d),y.callback=t??null,Wd(i,y,d),e.current.lanes=d,Rv(e,d,a),Jo(e,a),e}function a2(e,t,i,a){var d=t.current,y=Mo(),S=Yd(d);return i=h4(i),t.context===null?t.context=i:t.pendingContext=i,t=su(y,S),t.payload={element:e},a=a===void 0?null:a,a!==null&&(t.callback=a),e=Wd(d,t,S),e!==null&&(jl(e,d,S,y),kb(e,d,S)),S}function gw(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function u3(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var i=e.retryLane;e.retryLane=i!==0&&i<t?i:t}}function BA(e,t){u3(e,t),(e=e.alternate)&&u3(e,t)}function iH(){return null}var p4=typeof reportError=="function"?reportError:function(e){console.error(e)};function VA(e){this._internalRoot=e}l2.prototype.render=VA.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(nr(409));a2(e,t,null,null)};l2.prototype.unmount=VA.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Ff(function(){a2(null,e,null,null)}),t[du]=null}};function l2(e){this._internalRoot=e}l2.prototype.unstable_scheduleHydration=function(e){if(e){var t=qL();e={blockedOn:null,target:e,priority:t};for(var i=0;i<Id.length&&t!==0&&t<Id[i].priority;i++);Id.splice(i,0,e),i===0&&WL(e)}};function UA(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function c2(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function d3(){}function sH(e,t,i,a,d){if(d){if(typeof a=="function"){var y=a;a=function(){var D=gw(S);y.call(D)}}var S=f4(t,a,e,0,null,!1,!1,"",d3);return e._reactRootContainer=S,e[du]=S.current,Gx(e.nodeType===8?e.parentNode:e),Ff(),S}for(;d=e.lastChild;)e.removeChild(d);if(typeof a=="function"){var s=a;a=function(){var D=gw(N);s.call(D)}}var N=FA(e,0,!1,null,null,!1,!1,"",d3);return e._reactRootContainer=N,e[du]=N.current,Gx(e.nodeType===8?e.parentNode:e),Ff(function(){a2(t,N,i,a)}),N}function u2(e,t,i,a,d){var y=i._reactRootContainer;if(y){var S=y;if(typeof d=="function"){var s=d;d=function(){var N=gw(S);s.call(N)}}a2(t,S,e,d)}else S=sH(i,t,e,d,a);return gw(S)}$L=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var i=lx(t.pendingLanes);i!==0&&(aA(t,i|1),Jo(t,fs()),!(ei&6)&&(yg=fs()+500,ph()))}break;case 13:Ff(function(){var a=hu(e,1);if(a!==null){var d=Mo();jl(a,e,1,d)}}),BA(e,1)}};lA=function(e){if(e.tag===13){var t=hu(e,134217728);if(t!==null){var i=Mo();jl(t,e,134217728,i)}BA(e,134217728)}};GL=function(e){if(e.tag===13){var t=Yd(e),i=hu(e,t);if(i!==null){var a=Mo();jl(i,e,t,a)}BA(e,t)}};qL=function(){return yi};HL=function(e,t){var i=yi;try{return yi=e,t()}finally{yi=i}};bC=function(e,t,i){switch(t){case"input":if(pC(e,i),t=i.name,i.type==="radio"&&t!=null){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<i.length;t++){var a=i[t];if(a!==e&&a.form===e.form){var d=e2(a);if(!d)throw Error(nr(90));SL(a),pC(a,d)}}}break;case"textarea":EL(e,i);break;case"select":t=i.value,t!=null&&Gm(e,!!i.multiple,t,!1)}};NL=DA;RL=Ff;var oH={usingClientEntryPoint:!1,Events:[Dv,Lm,e2,IL,kL,DA]},Ky={findFiberByHostInstance:Sf,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},aH={bundleType:Ky.bundleType,version:Ky.version,rendererPackageName:Ky.rendererPackageName,rendererConfig:Ky.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:vu.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=LL(e),e===null?null:e.stateNode},findFiberByHostInstance:Ky.findFiberByHostInstance||iH,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var lb=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!lb.isDisabled&&lb.supportsFiber)try{Xw=lb.inject(aH),vc=lb}catch{}}Ma.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=oH;Ma.createPortal=function(e,t){var i=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!UA(t))throw Error(nr(200));return nH(e,t,null,i)};Ma.createRoot=function(e,t){if(!UA(e))throw Error(nr(299));var i=!1,a="",d=p4;return t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(a=t.identifierPrefix),t.onRecoverableError!==void 0&&(d=t.onRecoverableError)),t=FA(e,1,!1,null,null,i,!1,a,d),e[du]=t.current,Gx(e.nodeType===8?e.parentNode:e),new VA(t)};Ma.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(nr(188)):(e=Object.keys(e).join(","),Error(nr(268,e)));return e=LL(t),e=e===null?null:e.stateNode,e};Ma.flushSync=function(e){return Ff(e)};Ma.hydrate=function(e,t,i){if(!c2(t))throw Error(nr(200));return u2(null,e,t,!0,i)};Ma.hydrateRoot=function(e,t,i){if(!UA(e))throw Error(nr(405));var a=i!=null&&i.hydratedSources||null,d=!1,y="",S=p4;if(i!=null&&(i.unstable_strictMode===!0&&(d=!0),i.identifierPrefix!==void 0&&(y=i.identifierPrefix),i.onRecoverableError!==void 0&&(S=i.onRecoverableError)),t=f4(t,null,e,1,i??null,d,!1,y,S),e[du]=t.current,Gx(e),a)for(e=0;e<a.length;e++)i=a[e],d=i._getVersion,d=d(i._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[i,d]:t.mutableSourceEagerHydrationData.push(i,d);return new l2(t)};Ma.render=function(e,t,i){if(!c2(t))throw Error(nr(200));return u2(null,e,t,!1,i)};Ma.unmountComponentAtNode=function(e){if(!c2(e))throw Error(nr(40));return e._reactRootContainer?(Ff(function(){u2(null,null,e,!1,function(){e._reactRootContainer=null,e[du]=null})}),!0):!1};Ma.unstable_batchedUpdates=DA;Ma.unstable_renderSubtreeIntoContainer=function(e,t,i,a){if(!c2(i))throw Error(nr(200));if(e==null||e._reactInternals===void 0)throw Error(nr(38));return u2(e,t,i,!1,a)};Ma.version="18.3.1-next-f1338f8080-20240426";function m4(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(m4)}catch(e){console.error(e)}}m4(),mL.exports=Ma;var Xf=mL.exports;const $A=ZM(Xf);var g4,h3=Xf;g4=h3.createRoot,h3.hydrateRoot;const lH=1,cH=1e6;let CE=0;function uH(){return CE=(CE+1)%Number.MAX_SAFE_INTEGER,CE.toString()}const ME=new Map,f3=e=>{if(ME.has(e))return;const t=setTimeout(()=>{ME.delete(e),Px({type:"REMOVE_TOAST",toastId:e})},cH);ME.set(e,t)},dH=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,lH)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(i=>i.id===t.toast.id?{...i,...t.toast}:i)};case"DISMISS_TOAST":{const{toastId:i}=t;return i?f3(i):e.toasts.forEach(a=>{f3(a.id)}),{...e,toasts:e.toasts.map(a=>a.id===i||i===void 0?{...a,open:!1}:a)}}case"REMOVE_TOAST":return t.toastId===void 0?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(i=>i.id!==t.toastId)}}},zb=[];let Fb={toasts:[]};function Px(e){Fb=dH(Fb,e),zb.forEach(t=>{t(Fb)})}function hH({...e}){const t=uH(),i=d=>Px({type:"UPDATE_TOAST",toast:{...d,id:t}}),a=()=>Px({type:"DISMISS_TOAST",toastId:t});return Px({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:d=>{d||a()}}}),{id:t,dismiss:a,update:i}}function Ov(){const[e,t]=H.useState(Fb);return H.useEffect(()=>(zb.push(t),()=>{const i=zb.indexOf(t);i>-1&&zb.splice(i,1)}),[e]),{...e,toast:hH,dismiss:i=>Px({type:"DISMISS_TOAST",toastId:i})}}function Ht(e,t,{checkForDefaultPrevented:i=!0}={}){return function(d){if(e==null||e(d),i===!1||!d.defaultPrevented)return t==null?void 0:t(d)}}function fH(e,t){typeof e=="function"?e(t):e!=null&&(e.current=t)}function zv(...e){return t=>e.forEach(i=>fH(i,t))}function dn(...e){return H.useCallback(zv(...e),e)}function pH(e,t=[]){let i=[];function a(y,S){const s=H.createContext(S),N=i.length;i=[...i,S];function D($){const{scope:q,children:J,...re}=$,Q=(q==null?void 0:q[e][N])||s,ce=H.useMemo(()=>re,Object.values(re));return f.jsx(Q.Provider,{value:ce,children:J})}function O($,q){const J=(q==null?void 0:q[e][N])||s,re=H.useContext(J);if(re)return re;if(S!==void 0)return S;throw new Error(`\`${$}\` must be used within \`${y}\``)}return D.displayName=y+"Provider",[D,O]}const d=()=>{const y=i.map(S=>H.createContext(S));return function(s){const N=(s==null?void 0:s[e])||y;return H.useMemo(()=>({[`__scope${e}`]:{...s,[e]:N}}),[s,N])}};return d.scopeName=e,[a,mH(d,...t)]}function mH(...e){const t=e[0];if(e.length===1)return t;const i=()=>{const a=e.map(d=>({useScope:d(),scopeName:d.scopeName}));return function(y){const S=a.reduce((s,{useScope:N,scopeName:D})=>{const $=N(y)[`__scope${D}`];return{...s,...$}},{});return H.useMemo(()=>({[`__scope${t.scopeName}`]:S}),[S])}};return i.scopeName=t.scopeName,i}var Tc=H.forwardRef((e,t)=>{const{children:i,...a}=e,d=H.Children.toArray(i),y=d.find(gH);if(y){const S=y.props.children,s=d.map(N=>N===y?H.Children.count(S)>1?H.Children.only(null):H.isValidElement(S)?S.props.children:null:N);return f.jsx(eM,{...a,ref:t,children:H.isValidElement(S)?H.cloneElement(S,void 0,s):null})}return f.jsx(eM,{...a,ref:t,children:i})});Tc.displayName="Slot";var eM=H.forwardRef((e,t)=>{const{children:i,...a}=e;if(H.isValidElement(i)){const d=yH(i);return H.cloneElement(i,{..._H(a,i.props),ref:t?zv(t,d):d})}return H.Children.count(i)>1?H.Children.only(null):null});eM.displayName="SlotClone";var _4=({children:e})=>f.jsx(f.Fragment,{children:e});function gH(e){return H.isValidElement(e)&&e.type===_4}function _H(e,t){const i={...t};for(const a in t){const d=e[a],y=t[a];/^on[A-Z]/.test(a)?d&&y?i[a]=(...s)=>{y(...s),d(...s)}:d&&(i[a]=d):a==="style"?i[a]={...d,...y}:a==="className"&&(i[a]=[d,y].filter(Boolean).join(" "))}return{...e,...i}}function yH(e){var a,d;let t=(a=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:a.get,i=t&&"isReactWarning"in t&&t.isReactWarning;return i?e.ref:(t=(d=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:d.get,i=t&&"isReactWarning"in t&&t.isReactWarning,i?e.props.ref:e.props.ref||e.ref)}function Dg(e){const t=e+"CollectionProvider",[i,a]=pH(t),[d,y]=i(t,{collectionRef:{current:null},itemMap:new Map}),S=J=>{const{scope:re,children:Q}=J,ce=Gt.useRef(null),le=Gt.useRef(new Map).current;return f.jsx(d,{scope:re,itemMap:le,collectionRef:ce,children:Q})};S.displayName=t;const s=e+"CollectionSlot",N=Gt.forwardRef((J,re)=>{const{scope:Q,children:ce}=J,le=y(s,Q),ae=dn(re,le.collectionRef);return f.jsx(Tc,{ref:ae,children:ce})});N.displayName=s;const D=e+"CollectionItemSlot",O="data-radix-collection-item",$=Gt.forwardRef((J,re)=>{const{scope:Q,children:ce,...le}=J,ae=Gt.useRef(null),he=dn(re,ae),Se=y(D,Q);return Gt.useEffect(()=>(Se.itemMap.set(ae,{ref:ae,...le}),()=>void Se.itemMap.delete(ae))),f.jsx(Tc,{[O]:"",ref:he,children:ce})});$.displayName=D;function q(J){const re=y(e+"CollectionConsumer",J);return Gt.useCallback(()=>{const ce=re.collectionRef.current;if(!ce)return[];const le=Array.from(ce.querySelectorAll(`[${O}]`));return Array.from(re.itemMap.values()).sort((Se,je)=>le.indexOf(Se.ref.current)-le.indexOf(je.ref.current))},[re.collectionRef,re.itemMap])}return[{Provider:S,Slot:N,ItemSlot:$},q,a]}function xH(e,t){const i=H.createContext(t),a=y=>{const{children:S,...s}=y,N=H.useMemo(()=>s,Object.values(s));return f.jsx(i.Provider,{value:N,children:S})};a.displayName=e+"Provider";function d(y){const S=H.useContext(i);if(S)return S;if(t!==void 0)return t;throw new Error(`\`${y}\` must be used within \`${e}\``)}return[a,d]}function ta(e,t=[]){let i=[];function a(y,S){const s=H.createContext(S),N=i.length;i=[...i,S];const D=$=>{var le;const{scope:q,children:J,...re}=$,Q=((le=q==null?void 0:q[e])==null?void 0:le[N])||s,ce=H.useMemo(()=>re,Object.values(re));return f.jsx(Q.Provider,{value:ce,children:J})};D.displayName=y+"Provider";function O($,q){var Q;const J=((Q=q==null?void 0:q[e])==null?void 0:Q[N])||s,re=H.useContext(J);if(re)return re;if(S!==void 0)return S;throw new Error(`\`${$}\` must be used within \`${y}\``)}return[D,O]}const d=()=>{const y=i.map(S=>H.createContext(S));return function(s){const N=(s==null?void 0:s[e])||y;return H.useMemo(()=>({[`__scope${e}`]:{...s,[e]:N}}),[s,N])}};return d.scopeName=e,[a,vH(d,...t)]}function vH(...e){const t=e[0];if(e.length===1)return t;const i=()=>{const a=e.map(d=>({useScope:d(),scopeName:d.scopeName}));return function(y){const S=a.reduce((s,{useScope:N,scopeName:D})=>{const $=N(y)[`__scope${D}`];return{...s,...$}},{});return H.useMemo(()=>({[`__scope${t.scopeName}`]:S}),[S])}};return i.scopeName=t.scopeName,i}var bH=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],wr=bH.reduce((e,t)=>{const i=H.forwardRef((a,d)=>{const{asChild:y,...S}=a,s=y?Tc:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),f.jsx(s,{...S,ref:d})});return i.displayName=`Primitive.${t}`,{...e,[t]:i}},{});function Qx(e,t){e&&Xf.flushSync(()=>e.dispatchEvent(t))}function oi(e){const t=H.useRef(e);return H.useEffect(()=>{t.current=e}),H.useMemo(()=>(...i)=>{var a;return(a=t.current)==null?void 0:a.call(t,...i)},[])}function wH(e,t=globalThis==null?void 0:globalThis.document){const i=oi(e);H.useEffect(()=>{const a=d=>{d.key==="Escape"&&i(d)};return t.addEventListener("keydown",a,{capture:!0}),()=>t.removeEventListener("keydown",a,{capture:!0})},[i,t])}var SH="DismissableLayer",tM="dismissableLayer.update",TH="dismissableLayer.pointerDownOutside",EH="dismissableLayer.focusOutside",p3,y4=H.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),mh=H.forwardRef((e,t)=>{const{disableOutsidePointerEvents:i=!1,onEscapeKeyDown:a,onPointerDownOutside:d,onFocusOutside:y,onInteractOutside:S,onDismiss:s,...N}=e,D=H.useContext(y4),[O,$]=H.useState(null),q=(O==null?void 0:O.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,J]=H.useState({}),re=dn(t,qe=>$(qe)),Q=Array.from(D.layers),[ce]=[...D.layersWithOutsidePointerEventsDisabled].slice(-1),le=Q.indexOf(ce),ae=O?Q.indexOf(O):-1,he=D.layersWithOutsidePointerEventsDisabled.size>0,Se=ae>=le,je=MH(qe=>{const ct=qe.target,pt=[...D.branches].some(Ze=>Ze.contains(ct));!Se||pt||(d==null||d(qe),S==null||S(qe),qe.defaultPrevented||s==null||s())},q),it=AH(qe=>{const ct=qe.target;[...D.branches].some(Ze=>Ze.contains(ct))||(y==null||y(qe),S==null||S(qe),qe.defaultPrevented||s==null||s())},q);return wH(qe=>{ae===D.layers.size-1&&(a==null||a(qe),!qe.defaultPrevented&&s&&(qe.preventDefault(),s()))},q),H.useEffect(()=>{if(O)return i&&(D.layersWithOutsidePointerEventsDisabled.size===0&&(p3=q.body.style.pointerEvents,q.body.style.pointerEvents="none"),D.layersWithOutsidePointerEventsDisabled.add(O)),D.layers.add(O),m3(),()=>{i&&D.layersWithOutsidePointerEventsDisabled.size===1&&(q.body.style.pointerEvents=p3)}},[O,q,i,D]),H.useEffect(()=>()=>{O&&(D.layers.delete(O),D.layersWithOutsidePointerEventsDisabled.delete(O),m3())},[O,D]),H.useEffect(()=>{const qe=()=>J({});return document.addEventListener(tM,qe),()=>document.removeEventListener(tM,qe)},[]),f.jsx(wr.div,{...N,ref:re,style:{pointerEvents:he?Se?"auto":"none":void 0,...e.style},onFocusCapture:Ht(e.onFocusCapture,it.onFocusCapture),onBlurCapture:Ht(e.onBlurCapture,it.onBlurCapture),onPointerDownCapture:Ht(e.onPointerDownCapture,je.onPointerDownCapture)})});mh.displayName=SH;var CH="DismissableLayerBranch",x4=H.forwardRef((e,t)=>{const i=H.useContext(y4),a=H.useRef(null),d=dn(t,a);return H.useEffect(()=>{const y=a.current;if(y)return i.branches.add(y),()=>{i.branches.delete(y)}},[i.branches]),f.jsx(wr.div,{...e,ref:d})});x4.displayName=CH;function MH(e,t=globalThis==null?void 0:globalThis.document){const i=oi(e),a=H.useRef(!1),d=H.useRef(()=>{});return H.useEffect(()=>{const y=s=>{if(s.target&&!a.current){let N=function(){v4(TH,i,D,{discrete:!0})};const D={originalEvent:s};s.pointerType==="touch"?(t.removeEventListener("click",d.current),d.current=N,t.addEventListener("click",d.current,{once:!0})):N()}else t.removeEventListener("click",d.current);a.current=!1},S=window.setTimeout(()=>{t.addEventListener("pointerdown",y)},0);return()=>{window.clearTimeout(S),t.removeEventListener("pointerdown",y),t.removeEventListener("click",d.current)}},[t,i]),{onPointerDownCapture:()=>a.current=!0}}function AH(e,t=globalThis==null?void 0:globalThis.document){const i=oi(e),a=H.useRef(!1);return H.useEffect(()=>{const d=y=>{y.target&&!a.current&&v4(EH,i,{originalEvent:y},{discrete:!1})};return t.addEventListener("focusin",d),()=>t.removeEventListener("focusin",d)},[t,i]),{onFocusCapture:()=>a.current=!0,onBlurCapture:()=>a.current=!1}}function m3(){const e=new CustomEvent(tM);document.dispatchEvent(e)}function v4(e,t,i,{discrete:a}){const d=i.originalEvent.target,y=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:i});t&&d.addEventListener(e,t,{once:!0}),a?Qx(d,y):d.dispatchEvent(y)}var PH=mh,IH=x4,ss=globalThis!=null&&globalThis.document?H.useLayoutEffect:()=>{},kH="Portal",Lg=H.forwardRef((e,t)=>{var s;const{container:i,...a}=e,[d,y]=H.useState(!1);ss(()=>y(!0),[]);const S=i||d&&((s=globalThis==null?void 0:globalThis.document)==null?void 0:s.body);return S?$A.createPortal(f.jsx(wr.div,{...a,ref:t}),S):null});Lg.displayName=kH;function NH(e,t){return H.useReducer((i,a)=>t[i][a]??i,e)}var Yi=e=>{const{present:t,children:i}=e,a=RH(t),d=typeof i=="function"?i({present:a.isPresent}):H.Children.only(i),y=dn(a.ref,jH(d));return typeof i=="function"||a.isPresent?H.cloneElement(d,{ref:y}):null};Yi.displayName="Presence";function RH(e){const[t,i]=H.useState(),a=H.useRef({}),d=H.useRef(e),y=H.useRef("none"),S=e?"mounted":"unmounted",[s,N]=NH(S,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return H.useEffect(()=>{const D=cb(a.current);y.current=s==="mounted"?D:"none"},[s]),ss(()=>{const D=a.current,O=d.current;if(O!==e){const q=y.current,J=cb(D);e?N("MOUNT"):J==="none"||(D==null?void 0:D.display)==="none"?N("UNMOUNT"):N(O&&q!==J?"ANIMATION_OUT":"UNMOUNT"),d.current=e}},[e,N]),ss(()=>{if(t){let D;const O=t.ownerDocument.defaultView??window,$=J=>{const Q=cb(a.current).includes(J.animationName);if(J.target===t&&Q&&(N("ANIMATION_END"),!d.current)){const ce=t.style.animationFillMode;t.style.animationFillMode="forwards",D=O.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=ce)})}},q=J=>{J.target===t&&(y.current=cb(a.current))};return t.addEventListener("animationstart",q),t.addEventListener("animationcancel",$),t.addEventListener("animationend",$),()=>{O.clearTimeout(D),t.removeEventListener("animationstart",q),t.removeEventListener("animationcancel",$),t.removeEventListener("animationend",$)}}else N("ANIMATION_END")},[t,N]),{isPresent:["mounted","unmountSuspended"].includes(s),ref:H.useCallback(D=>{D&&(a.current=getComputedStyle(D)),i(D)},[])}}function cb(e){return(e==null?void 0:e.animationName)||"none"}function jH(e){var a,d;let t=(a=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:a.get,i=t&&"isReactWarning"in t&&t.isReactWarning;return i?e.ref:(t=(d=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:d.get,i=t&&"isReactWarning"in t&&t.isReactWarning,i?e.props.ref:e.props.ref||e.ref)}function Xa({prop:e,defaultProp:t,onChange:i=()=>{}}){const[a,d]=DH({defaultProp:t,onChange:i}),y=e!==void 0,S=y?e:a,s=oi(i),N=H.useCallback(D=>{if(y){const $=typeof D=="function"?D(e):D;$!==e&&s($)}else d(D)},[y,e,d,s]);return[S,N]}function DH({defaultProp:e,onChange:t}){const i=H.useState(e),[a]=i,d=H.useRef(a),y=oi(t);return H.useEffect(()=>{d.current!==a&&(y(a),d.current=a)},[a,d,y]),i}var LH="VisuallyHidden",Fv=H.forwardRef((e,t)=>f.jsx(wr.span,{...e,ref:t,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...e.style}}));Fv.displayName=LH;var b4=Fv,GA="ToastProvider",[qA,OH,zH]=Dg("Toast"),[w4,fce]=ta("Toast",[zH]),[FH,d2]=w4(GA),S4=e=>{const{__scopeToast:t,label:i="Notification",duration:a=5e3,swipeDirection:d="right",swipeThreshold:y=50,children:S}=e,[s,N]=H.useState(null),[D,O]=H.useState(0),$=H.useRef(!1),q=H.useRef(!1);return i.trim()||console.error(`Invalid prop \`label\` supplied to \`${GA}\`. Expected non-empty \`string\`.`),f.jsx(qA.Provider,{scope:t,children:f.jsx(FH,{scope:t,label:i,duration:a,swipeDirection:d,swipeThreshold:y,toastCount:D,viewport:s,onViewportChange:N,onToastAdd:H.useCallback(()=>O(J=>J+1),[]),onToastRemove:H.useCallback(()=>O(J=>J-1),[]),isFocusedToastEscapeKeyDownRef:$,isClosePausedRef:q,children:S})})};S4.displayName=GA;var T4="ToastViewport",BH=["F8"],rM="toast.viewportPause",nM="toast.viewportResume",E4=H.forwardRef((e,t)=>{const{__scopeToast:i,hotkey:a=BH,label:d="Notifications ({hotkey})",...y}=e,S=d2(T4,i),s=OH(i),N=H.useRef(null),D=H.useRef(null),O=H.useRef(null),$=H.useRef(null),q=dn(t,$,S.onViewportChange),J=a.join("+").replace(/Key/g,"").replace(/Digit/g,""),re=S.toastCount>0;H.useEffect(()=>{const ce=le=>{var he;a.length!==0&&a.every(Se=>le[Se]||le.code===Se)&&((he=$.current)==null||he.focus())};return document.addEventListener("keydown",ce),()=>document.removeEventListener("keydown",ce)},[a]),H.useEffect(()=>{const ce=N.current,le=$.current;if(re&&ce&&le){const ae=()=>{if(!S.isClosePausedRef.current){const it=new CustomEvent(rM);le.dispatchEvent(it),S.isClosePausedRef.current=!0}},he=()=>{if(S.isClosePausedRef.current){const it=new CustomEvent(nM);le.dispatchEvent(it),S.isClosePausedRef.current=!1}},Se=it=>{!ce.contains(it.relatedTarget)&&he()},je=()=>{ce.contains(document.activeElement)||he()};return ce.addEventListener("focusin",ae),ce.addEventListener("focusout",Se),ce.addEventListener("pointermove",ae),ce.addEventListener("pointerleave",je),window.addEventListener("blur",ae),window.addEventListener("focus",he),()=>{ce.removeEventListener("focusin",ae),ce.removeEventListener("focusout",Se),ce.removeEventListener("pointermove",ae),ce.removeEventListener("pointerleave",je),window.removeEventListener("blur",ae),window.removeEventListener("focus",he)}}},[re,S.isClosePausedRef]);const Q=H.useCallback(({tabbingDirection:ce})=>{const ae=s().map(he=>{const Se=he.ref.current,je=[Se,...QH(Se)];return ce==="forwards"?je:je.reverse()});return(ce==="forwards"?ae.reverse():ae).flat()},[s]);return H.useEffect(()=>{const ce=$.current;if(ce){const le=ae=>{var je,it,qe;const he=ae.altKey||ae.ctrlKey||ae.metaKey;if(ae.key==="Tab"&&!he){const ct=document.activeElement,pt=ae.shiftKey;if(ae.target===ce&&pt){(je=D.current)==null||je.focus();return}const Mt=Q({tabbingDirection:pt?"backwards":"forwards"}),Jt=Mt.findIndex(jt=>jt===ct);AE(Mt.slice(Jt+1))?ae.preventDefault():pt?(it=D.current)==null||it.focus():(qe=O.current)==null||qe.focus()}};return ce.addEventListener("keydown",le),()=>ce.removeEventListener("keydown",le)}},[s,Q]),f.jsxs(IH,{ref:N,role:"region","aria-label":d.replace("{hotkey}",J),tabIndex:-1,style:{pointerEvents:re?void 0:"none"},children:[re&&f.jsx(iM,{ref:D,onFocusFromOutsideViewport:()=>{const ce=Q({tabbingDirection:"forwards"});AE(ce)}}),f.jsx(qA.Slot,{scope:i,children:f.jsx(wr.ol,{tabIndex:-1,...y,ref:q})}),re&&f.jsx(iM,{ref:O,onFocusFromOutsideViewport:()=>{const ce=Q({tabbingDirection:"backwards"});AE(ce)}})]})});E4.displayName=T4;var C4="ToastFocusProxy",iM=H.forwardRef((e,t)=>{const{__scopeToast:i,onFocusFromOutsideViewport:a,...d}=e,y=d2(C4,i);return f.jsx(Fv,{"aria-hidden":!0,tabIndex:0,...d,ref:t,style:{position:"fixed"},onFocus:S=>{var D;const s=S.relatedTarget;!((D=y.viewport)!=null&&D.contains(s))&&a()}})});iM.displayName=C4;var h2="Toast",VH="toast.swipeStart",UH="toast.swipeMove",$H="toast.swipeCancel",GH="toast.swipeEnd",M4=H.forwardRef((e,t)=>{const{forceMount:i,open:a,defaultOpen:d,onOpenChange:y,...S}=e,[s=!0,N]=Xa({prop:a,defaultProp:d,onChange:y});return f.jsx(Yi,{present:i||s,children:f.jsx(WH,{open:s,...S,ref:t,onClose:()=>N(!1),onPause:oi(e.onPause),onResume:oi(e.onResume),onSwipeStart:Ht(e.onSwipeStart,D=>{D.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:Ht(e.onSwipeMove,D=>{const{x:O,y:$}=D.detail.delta;D.currentTarget.setAttribute("data-swipe","move"),D.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${O}px`),D.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${$}px`)}),onSwipeCancel:Ht(e.onSwipeCancel,D=>{D.currentTarget.setAttribute("data-swipe","cancel"),D.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),D.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),D.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),D.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:Ht(e.onSwipeEnd,D=>{const{x:O,y:$}=D.detail.delta;D.currentTarget.setAttribute("data-swipe","end"),D.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),D.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),D.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${O}px`),D.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${$}px`),N(!1)})})})});M4.displayName=h2;var[qH,HH]=w4(h2,{onClose(){}}),WH=H.forwardRef((e,t)=>{const{__scopeToast:i,type:a="foreground",duration:d,open:y,onClose:S,onEscapeKeyDown:s,onPause:N,onResume:D,onSwipeStart:O,onSwipeMove:$,onSwipeCancel:q,onSwipeEnd:J,...re}=e,Q=d2(h2,i),[ce,le]=H.useState(null),ae=dn(t,jt=>le(jt)),he=H.useRef(null),Se=H.useRef(null),je=d||Q.duration,it=H.useRef(0),qe=H.useRef(je),ct=H.useRef(0),{onToastAdd:pt,onToastRemove:Ze}=Q,yt=oi(()=>{var Pt;(ce==null?void 0:ce.contains(document.activeElement))&&((Pt=Q.viewport)==null||Pt.focus()),S()}),Mt=H.useCallback(jt=>{!jt||jt===1/0||(window.clearTimeout(ct.current),it.current=new Date().getTime(),ct.current=window.setTimeout(yt,jt))},[yt]);H.useEffect(()=>{const jt=Q.viewport;if(jt){const Pt=()=>{Mt(qe.current),D==null||D()},Wt=()=>{const Nt=new Date().getTime()-it.current;qe.current=qe.current-Nt,window.clearTimeout(ct.current),N==null||N()};return jt.addEventListener(rM,Wt),jt.addEventListener(nM,Pt),()=>{jt.removeEventListener(rM,Wt),jt.removeEventListener(nM,Pt)}}},[Q.viewport,je,N,D,Mt]),H.useEffect(()=>{y&&!Q.isClosePausedRef.current&&Mt(je)},[y,je,Q.isClosePausedRef,Mt]),H.useEffect(()=>(pt(),()=>Ze()),[pt,Ze]);const Jt=H.useMemo(()=>ce?j4(ce):null,[ce]);return Q.viewport?f.jsxs(f.Fragment,{children:[Jt&&f.jsx(ZH,{__scopeToast:i,role:"status","aria-live":a==="foreground"?"assertive":"polite","aria-atomic":!0,children:Jt}),f.jsx(qH,{scope:i,onClose:yt,children:Xf.createPortal(f.jsx(qA.ItemSlot,{scope:i,children:f.jsx(PH,{asChild:!0,onEscapeKeyDown:Ht(s,()=>{Q.isFocusedToastEscapeKeyDownRef.current||yt(),Q.isFocusedToastEscapeKeyDownRef.current=!1}),children:f.jsx(wr.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":y?"open":"closed","data-swipe-direction":Q.swipeDirection,...re,ref:ae,style:{userSelect:"none",touchAction:"none",...e.style},onKeyDown:Ht(e.onKeyDown,jt=>{jt.key==="Escape"&&(s==null||s(jt.nativeEvent),jt.nativeEvent.defaultPrevented||(Q.isFocusedToastEscapeKeyDownRef.current=!0,yt()))}),onPointerDown:Ht(e.onPointerDown,jt=>{jt.button===0&&(he.current={x:jt.clientX,y:jt.clientY})}),onPointerMove:Ht(e.onPointerMove,jt=>{if(!he.current)return;const Pt=jt.clientX-he.current.x,Wt=jt.clientY-he.current.y,Nt=!!Se.current,Xe=["left","right"].includes(Q.swipeDirection),nt=["left","up"].includes(Q.swipeDirection)?Math.min:Math.max,Qt=Xe?nt(0,Pt):0,rr=Xe?0:nt(0,Wt),mr=jt.pointerType==="touch"?10:2,Ut={x:Qt,y:rr},hn={originalEvent:jt,delta:Ut};Nt?(Se.current=Ut,ub(UH,$,hn,{discrete:!1})):g3(Ut,Q.swipeDirection,mr)?(Se.current=Ut,ub(VH,O,hn,{discrete:!1}),jt.target.setPointerCapture(jt.pointerId)):(Math.abs(Pt)>mr||Math.abs(Wt)>mr)&&(he.current=null)}),onPointerUp:Ht(e.onPointerUp,jt=>{const Pt=Se.current,Wt=jt.target;if(Wt.hasPointerCapture(jt.pointerId)&&Wt.releasePointerCapture(jt.pointerId),Se.current=null,he.current=null,Pt){const Nt=jt.currentTarget,Xe={originalEvent:jt,delta:Pt};g3(Pt,Q.swipeDirection,Q.swipeThreshold)?ub(GH,J,Xe,{discrete:!0}):ub($H,q,Xe,{discrete:!0}),Nt.addEventListener("click",nt=>nt.preventDefault(),{once:!0})}})})})}),Q.viewport)})]}):null}),ZH=e=>{const{__scopeToast:t,children:i,...a}=e,d=d2(h2,t),[y,S]=H.useState(!1),[s,N]=H.useState(!1);return KH(()=>S(!0)),H.useEffect(()=>{const D=window.setTimeout(()=>N(!0),1e3);return()=>window.clearTimeout(D)},[]),s?null:f.jsx(Lg,{asChild:!0,children:f.jsx(Fv,{...a,children:y&&f.jsxs(f.Fragment,{children:[d.label," ",i]})})})},YH="ToastTitle",A4=H.forwardRef((e,t)=>{const{__scopeToast:i,...a}=e;return f.jsx(wr.div,{...a,ref:t})});A4.displayName=YH;var XH="ToastDescription",P4=H.forwardRef((e,t)=>{const{__scopeToast:i,...a}=e;return f.jsx(wr.div,{...a,ref:t})});P4.displayName=XH;var I4="ToastAction",k4=H.forwardRef((e,t)=>{const{altText:i,...a}=e;return i.trim()?f.jsx(R4,{altText:i,asChild:!0,children:f.jsx(HA,{...a,ref:t})}):(console.error(`Invalid prop \`altText\` supplied to \`${I4}\`. Expected non-empty \`string\`.`),null)});k4.displayName=I4;var N4="ToastClose",HA=H.forwardRef((e,t)=>{const{__scopeToast:i,...a}=e,d=HH(N4,i);return f.jsx(R4,{asChild:!0,children:f.jsx(wr.button,{type:"button",...a,ref:t,onClick:Ht(e.onClick,d.onClose)})})});HA.displayName=N4;var R4=H.forwardRef((e,t)=>{const{__scopeToast:i,altText:a,...d}=e;return f.jsx(wr.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":a||void 0,...d,ref:t})});function j4(e){const t=[];return Array.from(e.childNodes).forEach(a=>{if(a.nodeType===a.TEXT_NODE&&a.textContent&&t.push(a.textContent),JH(a)){const d=a.ariaHidden||a.hidden||a.style.display==="none",y=a.dataset.radixToastAnnounceExclude==="";if(!d)if(y){const S=a.dataset.radixToastAnnounceAlt;S&&t.push(S)}else t.push(...j4(a))}}),t}function ub(e,t,i,{discrete:a}){const d=i.originalEvent.currentTarget,y=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:i});t&&d.addEventListener(e,t,{once:!0}),a?Qx(d,y):d.dispatchEvent(y)}var g3=(e,t,i=0)=>{const a=Math.abs(e.x),d=Math.abs(e.y),y=a>d;return t==="left"||t==="right"?y&&a>i:!y&&d>i};function KH(e=()=>{}){const t=oi(e);ss(()=>{let i=0,a=0;return i=window.requestAnimationFrame(()=>a=window.requestAnimationFrame(t)),()=>{window.cancelAnimationFrame(i),window.cancelAnimationFrame(a)}},[t])}function JH(e){return e.nodeType===e.ELEMENT_NODE}function QH(e){const t=[],i=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:a=>{const d=a.tagName==="INPUT"&&a.type==="hidden";return a.disabled||a.hidden||d?NodeFilter.FILTER_SKIP:a.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;i.nextNode();)t.push(i.currentNode);return t}function AE(e){const t=document.activeElement;return e.some(i=>i===t?!0:(i.focus(),document.activeElement!==t))}var eW=S4,D4=E4,L4=M4,O4=A4,z4=P4,F4=k4,B4=HA;function V4(e){var t,i,a="";if(typeof e=="string"||typeof e=="number")a+=e;else if(typeof e=="object")if(Array.isArray(e)){var d=e.length;for(t=0;t<d;t++)e[t]&&(i=V4(e[t]))&&(a&&(a+=" "),a+=i)}else for(i in e)e[i]&&(a&&(a+=" "),a+=i);return a}function U4(){for(var e,t,i=0,a="",d=arguments.length;i<d;i++)(e=arguments[i])&&(t=V4(e))&&(a&&(a+=" "),a+=t);return a}const _3=e=>typeof e=="boolean"?`${e}`:e===0?"0":e,y3=U4,Og=(e,t)=>i=>{var a;if((t==null?void 0:t.variants)==null)return y3(e,i==null?void 0:i.class,i==null?void 0:i.className);const{variants:d,defaultVariants:y}=t,S=Object.keys(d).map(D=>{const O=i==null?void 0:i[D],$=y==null?void 0:y[D];if(O===null)return null;const q=_3(O)||_3($);return d[D][q]}),s=i&&Object.entries(i).reduce((D,O)=>{let[$,q]=O;return q===void 0||(D[$]=q),D},{}),N=t==null||(a=t.compoundVariants)===null||a===void 0?void 0:a.reduce((D,O)=>{let{class:$,className:q,...J}=O;return Object.entries(J).every(re=>{let[Q,ce]=re;return Array.isArray(ce)?ce.includes({...y,...s}[Q]):{...y,...s}[Q]===ce})?[...D,$,q]:D},[]);return y3(e,S,N,i==null?void 0:i.class,i==null?void 0:i.className)};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tW=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),$4=(...e)=>e.filter((t,i,a)=>!!t&&t.trim()!==""&&a.indexOf(t)===i).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var rW={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nW=H.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:i=2,absoluteStrokeWidth:a,className:d="",children:y,iconNode:S,...s},N)=>H.createElement("svg",{ref:N,...rW,width:t,height:t,stroke:e,strokeWidth:a?Number(i)*24/Number(t):i,className:$4("lucide",d),...s},[...S.map(([D,O])=>H.createElement(D,O)),...Array.isArray(y)?y:[y]]));/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sr=(e,t)=>{const i=H.forwardRef(({className:a,...d},y)=>H.createElement(nW,{ref:y,iconNode:t,className:$4(`lucide-${tW(e)}`,a),...d}));return i.displayName=`${e}`,i};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G4=Sr("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const f2=Sr("ArrowRightLeft",[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WA=Sr("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iW=Sr("BookOpen",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sW=Sr("Book",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ix=Sr("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oW=Sr("Briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PE=Sr("CalendarCheck",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aW=Sr("CalendarDays",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lW=Sr("CalendarRange",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M17 14h-6",key:"bkmgh3"}],["path",{d:"M13 18H7",key:"bb0bb7"}],["path",{d:"M7 14h.01",key:"1qa3f1"}],["path",{d:"M17 18h.01",key:"1bdyru"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nh=Sr("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cW=Sr("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uW=Sr("Car",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Co=Sr("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZA=Sr("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dW=Sr("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q4=Sr("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hW=Sr("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fW=Sr("Cigarette",[["path",{d:"M17 12H3a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1h14",key:"1mb5g1"}],["path",{d:"M18 8c0-2.5-2-2.5-2-5",key:"1il607"}],["path",{d:"M21 16a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"1yl5r7"}],["path",{d:"M22 8c0-2.5-2-2.5-2-5",key:"1gah44"}],["path",{d:"M7 12v4",key:"jqww69"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pW=Sr("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pu=Sr("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mW=Sr("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H4=Sr("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ev=Sr("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W4=Sr("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gc=Sr("Crown",[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gW=Sr("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _W=Sr("Droplets",[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yW=Sr("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xg=Sr("Euro",[["path",{d:"M4 10h12",key:"1y6xl8"}],["path",{d:"M4 14h9",key:"1loblj"}],["path",{d:"M19 6a7.7 7.7 0 0 0-5.2-2A7.9 7.9 0 0 0 6 12c0 4.4 3.5 8 7.8 8 2 0 3.8-.8 5.2-2",key:"1j6lzo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x3=Sr("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xW=Sr("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vW=Sr("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bW=Sr("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tv=Sr("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kf=Sr("GraduationCap",[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rf=Sr("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xm=Sr("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bf=Sr("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p2=Sr("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wW=Sr("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SW=Sr("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TW=Sr("MailCheck",[["path",{d:"M22 13V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v12c0 1.1.9 2 2 2h8",key:"12jkf8"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}],["path",{d:"m16 19 2 2 4-4",key:"1b14m6"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vf=Sr("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ec=Sr("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EW=Sr("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z4=Sr("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vg=Sr("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CW=Sr("PawPrint",[["circle",{cx:"11",cy:"4",r:"2",key:"vol9p0"}],["circle",{cx:"18",cy:"8",r:"2",key:"17gozi"}],["circle",{cx:"20",cy:"16",r:"2",key:"1v9bxh"}],["path",{d:"M9 10a5 5 0 0 1 5 5v3.5a3.5 3.5 0 0 1-6.84 1.045Q6.52 17.48 4.46 16.84A3.5 3.5 0 0 1 5.5 10Z",key:"1ydw1z"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MW=Sr("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AW=Sr("Plane",[["path",{d:"M17.8 19.2 16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.1-1.1.5l-.3.5c-.2.5-.1 1 .3 1.3L9 12l-2 3H4l-1 1 3 2 2 3 1-1v-3l3-2 3.5 5.3c.3.4.8.5 1.3.3l.5-.2c.4-.3.6-.7.5-1.2z",key:"1v9wt8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rv=Sr("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PW=Sr("Quote",[["path",{d:"M16 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"rib7q0"}],["path",{d:"M5 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"1ymkrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IW=Sr("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _w=Sr("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y4=Sr("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kW=Sr("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ao=Sr("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NW=Sr("SlidersHorizontal",[["line",{x1:"21",x2:"14",y1:"4",y2:"4",key:"obuewd"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4",key:"1q6298"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12",key:"1iu8h1"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12",key:"ntss68"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20",key:"14d8ph"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20",key:"m0wm8r"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6",key:"14e1ph"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22",key:"1lctlv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X4=Sr("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dl=Sr("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RW=Sr("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jW=Sr("ThumbsUp",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Km=Sr("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DW=Sr("Tv",[["rect",{width:"20",height:"15",x:"2",y:"7",rx:"2",ry:"2",key:"10ag99"}],["polyline",{points:"17 2 12 7 7 2",key:"11pgbg"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YA=Sr("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yw=Sr("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K4=Sr("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qo=Sr("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LW=Sr("Utensils",[["path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2",key:"cjf0a3"}],["path",{d:"M7 2v20",key:"1473qp"}],["path",{d:"M21 15V2a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7",key:"j28e5"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OW=Sr("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zW=Sr("Wind",[["path",{d:"M12.8 19.6A2 2 0 1 0 14 16H2",key:"148xed"}],["path",{d:"M17.5 8a2.5 2.5 0 1 1 2 4H2",key:"1u4tom"}],["path",{d:"M9.8 4.4A2 2 0 1 1 11 8H2",key:"75valh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wc=Sr("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XA=Sr("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),KA="-",FW=e=>{const t=VW(e),{conflictingClassGroups:i,conflictingClassGroupModifiers:a}=e;return{getClassGroupId:S=>{const s=S.split(KA);return s[0]===""&&s.length!==1&&s.shift(),J4(s,t)||BW(S)},getConflictingClassGroupIds:(S,s)=>{const N=i[S]||[];return s&&a[S]?[...N,...a[S]]:N}}},J4=(e,t)=>{var S;if(e.length===0)return t.classGroupId;const i=e[0],a=t.nextPart.get(i),d=a?J4(e.slice(1),a):void 0;if(d)return d;if(t.validators.length===0)return;const y=e.join(KA);return(S=t.validators.find(({validator:s})=>s(y)))==null?void 0:S.classGroupId},v3=/^\[(.+)\]$/,BW=e=>{if(v3.test(e)){const t=v3.exec(e)[1],i=t==null?void 0:t.substring(0,t.indexOf(":"));if(i)return"arbitrary.."+i}},VW=e=>{const{theme:t,prefix:i}=e,a={nextPart:new Map,validators:[]};return $W(Object.entries(e.classGroups),i).forEach(([y,S])=>{sM(S,a,y,t)}),a},sM=(e,t,i,a)=>{e.forEach(d=>{if(typeof d=="string"){const y=d===""?t:b3(t,d);y.classGroupId=i;return}if(typeof d=="function"){if(UW(d)){sM(d(a),t,i,a);return}t.validators.push({validator:d,classGroupId:i});return}Object.entries(d).forEach(([y,S])=>{sM(S,b3(t,y),i,a)})})},b3=(e,t)=>{let i=e;return t.split(KA).forEach(a=>{i.nextPart.has(a)||i.nextPart.set(a,{nextPart:new Map,validators:[]}),i=i.nextPart.get(a)}),i},UW=e=>e.isThemeGetter,$W=(e,t)=>t?e.map(([i,a])=>{const d=a.map(y=>typeof y=="string"?t+y:typeof y=="object"?Object.fromEntries(Object.entries(y).map(([S,s])=>[t+S,s])):y);return[i,d]}):e,GW=e=>{if(e<1)return{get:()=>{},set:()=>{}};let t=0,i=new Map,a=new Map;const d=(y,S)=>{i.set(y,S),t++,t>e&&(t=0,a=i,i=new Map)};return{get(y){let S=i.get(y);if(S!==void 0)return S;if((S=a.get(y))!==void 0)return d(y,S),S},set(y,S){i.has(y)?i.set(y,S):d(y,S)}}},Q4="!",qW=e=>{const{separator:t,experimentalParseClassName:i}=e,a=t.length===1,d=t[0],y=t.length,S=s=>{const N=[];let D=0,O=0,$;for(let ce=0;ce<s.length;ce++){let le=s[ce];if(D===0){if(le===d&&(a||s.slice(ce,ce+y)===t)){N.push(s.slice(O,ce)),O=ce+y;continue}if(le==="/"){$=ce;continue}}le==="["?D++:le==="]"&&D--}const q=N.length===0?s:s.substring(O),J=q.startsWith(Q4),re=J?q.substring(1):q,Q=$&&$>O?$-O:void 0;return{modifiers:N,hasImportantModifier:J,baseClassName:re,maybePostfixModifierPosition:Q}};return i?s=>i({className:s,parseClassName:S}):S},HW=e=>{if(e.length<=1)return e;const t=[];let i=[];return e.forEach(a=>{a[0]==="["?(t.push(...i.sort(),a),i=[]):i.push(a)}),t.push(...i.sort()),t},WW=e=>({cache:GW(e.cacheSize),parseClassName:qW(e),...FW(e)}),ZW=/\s+/,YW=(e,t)=>{const{parseClassName:i,getClassGroupId:a,getConflictingClassGroupIds:d}=t,y=[],S=e.trim().split(ZW);let s="";for(let N=S.length-1;N>=0;N-=1){const D=S[N],{modifiers:O,hasImportantModifier:$,baseClassName:q,maybePostfixModifierPosition:J}=i(D);let re=!!J,Q=a(re?q.substring(0,J):q);if(!Q){if(!re){s=D+(s.length>0?" "+s:s);continue}if(Q=a(q),!Q){s=D+(s.length>0?" "+s:s);continue}re=!1}const ce=HW(O).join(":"),le=$?ce+Q4:ce,ae=le+Q;if(y.includes(ae))continue;y.push(ae);const he=d(Q,re);for(let Se=0;Se<he.length;++Se){const je=he[Se];y.push(le+je)}s=D+(s.length>0?" "+s:s)}return s};function XW(){let e=0,t,i,a="";for(;e<arguments.length;)(t=arguments[e++])&&(i=ez(t))&&(a&&(a+=" "),a+=i);return a}const ez=e=>{if(typeof e=="string")return e;let t,i="";for(let a=0;a<e.length;a++)e[a]&&(t=ez(e[a]))&&(i&&(i+=" "),i+=t);return i};function KW(e,...t){let i,a,d,y=S;function S(N){const D=t.reduce((O,$)=>$(O),e());return i=WW(D),a=i.cache.get,d=i.cache.set,y=s,s(N)}function s(N){const D=a(N);if(D)return D;const O=YW(N,i);return d(N,O),O}return function(){return y(XW.apply(null,arguments))}}const ji=e=>{const t=i=>i[e]||[];return t.isThemeGetter=!0,t},tz=/^\[(?:([a-z-]+):)?(.+)\]$/i,JW=/^\d+\/\d+$/,QW=new Set(["px","full","screen"]),e9=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,t9=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,r9=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,n9=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,i9=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Zc=e=>Jm(e)||QW.has(e)||JW.test(e),xd=e=>zg(e,"length",h9),Jm=e=>!!e&&!Number.isNaN(Number(e)),IE=e=>zg(e,"number",Jm),Jy=e=>!!e&&Number.isInteger(Number(e)),s9=e=>e.endsWith("%")&&Jm(e.slice(0,-1)),Tn=e=>tz.test(e),vd=e=>e9.test(e),o9=new Set(["length","size","percentage"]),a9=e=>zg(e,o9,rz),l9=e=>zg(e,"position",rz),c9=new Set(["image","url"]),u9=e=>zg(e,c9,p9),d9=e=>zg(e,"",f9),Qy=()=>!0,zg=(e,t,i)=>{const a=tz.exec(e);return a?a[1]?typeof t=="string"?a[1]===t:t.has(a[1]):i(a[2]):!1},h9=e=>t9.test(e)&&!r9.test(e),rz=()=>!1,f9=e=>n9.test(e),p9=e=>i9.test(e),m9=()=>{const e=ji("colors"),t=ji("spacing"),i=ji("blur"),a=ji("brightness"),d=ji("borderColor"),y=ji("borderRadius"),S=ji("borderSpacing"),s=ji("borderWidth"),N=ji("contrast"),D=ji("grayscale"),O=ji("hueRotate"),$=ji("invert"),q=ji("gap"),J=ji("gradientColorStops"),re=ji("gradientColorStopPositions"),Q=ji("inset"),ce=ji("margin"),le=ji("opacity"),ae=ji("padding"),he=ji("saturate"),Se=ji("scale"),je=ji("sepia"),it=ji("skew"),qe=ji("space"),ct=ji("translate"),pt=()=>["auto","contain","none"],Ze=()=>["auto","hidden","clip","visible","scroll"],yt=()=>["auto",Tn,t],Mt=()=>[Tn,t],Jt=()=>["",Zc,xd],jt=()=>["auto",Jm,Tn],Pt=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],Wt=()=>["solid","dashed","dotted","double","none"],Nt=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Xe=()=>["start","end","center","between","around","evenly","stretch"],nt=()=>["","0",Tn],Qt=()=>["auto","avoid","all","avoid-page","page","left","right","column"],rr=()=>[Jm,Tn];return{cacheSize:500,separator:":",theme:{colors:[Qy],spacing:[Zc,xd],blur:["none","",vd,Tn],brightness:rr(),borderColor:[e],borderRadius:["none","","full",vd,Tn],borderSpacing:Mt(),borderWidth:Jt(),contrast:rr(),grayscale:nt(),hueRotate:rr(),invert:nt(),gap:Mt(),gradientColorStops:[e],gradientColorStopPositions:[s9,xd],inset:yt(),margin:yt(),opacity:rr(),padding:Mt(),saturate:rr(),scale:rr(),sepia:nt(),skew:rr(),space:Mt(),translate:Mt()},classGroups:{aspect:[{aspect:["auto","square","video",Tn]}],container:["container"],columns:[{columns:[vd]}],"break-after":[{"break-after":Qt()}],"break-before":[{"break-before":Qt()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...Pt(),Tn]}],overflow:[{overflow:Ze()}],"overflow-x":[{"overflow-x":Ze()}],"overflow-y":[{"overflow-y":Ze()}],overscroll:[{overscroll:pt()}],"overscroll-x":[{"overscroll-x":pt()}],"overscroll-y":[{"overscroll-y":pt()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[Q]}],"inset-x":[{"inset-x":[Q]}],"inset-y":[{"inset-y":[Q]}],start:[{start:[Q]}],end:[{end:[Q]}],top:[{top:[Q]}],right:[{right:[Q]}],bottom:[{bottom:[Q]}],left:[{left:[Q]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Jy,Tn]}],basis:[{basis:yt()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Tn]}],grow:[{grow:nt()}],shrink:[{shrink:nt()}],order:[{order:["first","last","none",Jy,Tn]}],"grid-cols":[{"grid-cols":[Qy]}],"col-start-end":[{col:["auto",{span:["full",Jy,Tn]},Tn]}],"col-start":[{"col-start":jt()}],"col-end":[{"col-end":jt()}],"grid-rows":[{"grid-rows":[Qy]}],"row-start-end":[{row:["auto",{span:[Jy,Tn]},Tn]}],"row-start":[{"row-start":jt()}],"row-end":[{"row-end":jt()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Tn]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Tn]}],gap:[{gap:[q]}],"gap-x":[{"gap-x":[q]}],"gap-y":[{"gap-y":[q]}],"justify-content":[{justify:["normal",...Xe()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...Xe(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...Xe(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[ae]}],px:[{px:[ae]}],py:[{py:[ae]}],ps:[{ps:[ae]}],pe:[{pe:[ae]}],pt:[{pt:[ae]}],pr:[{pr:[ae]}],pb:[{pb:[ae]}],pl:[{pl:[ae]}],m:[{m:[ce]}],mx:[{mx:[ce]}],my:[{my:[ce]}],ms:[{ms:[ce]}],me:[{me:[ce]}],mt:[{mt:[ce]}],mr:[{mr:[ce]}],mb:[{mb:[ce]}],ml:[{ml:[ce]}],"space-x":[{"space-x":[qe]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[qe]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Tn,t]}],"min-w":[{"min-w":[Tn,t,"min","max","fit"]}],"max-w":[{"max-w":[Tn,t,"none","full","min","max","fit","prose",{screen:[vd]},vd]}],h:[{h:[Tn,t,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Tn,t,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Tn,t,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Tn,t,"auto","min","max","fit"]}],"font-size":[{text:["base",vd,xd]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",IE]}],"font-family":[{font:[Qy]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractons"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Tn]}],"line-clamp":[{"line-clamp":["none",Jm,IE]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Zc,Tn]}],"list-image":[{"list-image":["none",Tn]}],"list-style-type":[{list:["none","disc","decimal",Tn]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[le]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[le]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Wt(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Zc,xd]}],"underline-offset":[{"underline-offset":["auto",Zc,Tn]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Mt()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Tn]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Tn]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[le]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...Pt(),l9]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",a9]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},u9]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[re]}],"gradient-via-pos":[{via:[re]}],"gradient-to-pos":[{to:[re]}],"gradient-from":[{from:[J]}],"gradient-via":[{via:[J]}],"gradient-to":[{to:[J]}],rounded:[{rounded:[y]}],"rounded-s":[{"rounded-s":[y]}],"rounded-e":[{"rounded-e":[y]}],"rounded-t":[{"rounded-t":[y]}],"rounded-r":[{"rounded-r":[y]}],"rounded-b":[{"rounded-b":[y]}],"rounded-l":[{"rounded-l":[y]}],"rounded-ss":[{"rounded-ss":[y]}],"rounded-se":[{"rounded-se":[y]}],"rounded-ee":[{"rounded-ee":[y]}],"rounded-es":[{"rounded-es":[y]}],"rounded-tl":[{"rounded-tl":[y]}],"rounded-tr":[{"rounded-tr":[y]}],"rounded-br":[{"rounded-br":[y]}],"rounded-bl":[{"rounded-bl":[y]}],"border-w":[{border:[s]}],"border-w-x":[{"border-x":[s]}],"border-w-y":[{"border-y":[s]}],"border-w-s":[{"border-s":[s]}],"border-w-e":[{"border-e":[s]}],"border-w-t":[{"border-t":[s]}],"border-w-r":[{"border-r":[s]}],"border-w-b":[{"border-b":[s]}],"border-w-l":[{"border-l":[s]}],"border-opacity":[{"border-opacity":[le]}],"border-style":[{border:[...Wt(),"hidden"]}],"divide-x":[{"divide-x":[s]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[s]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[le]}],"divide-style":[{divide:Wt()}],"border-color":[{border:[d]}],"border-color-x":[{"border-x":[d]}],"border-color-y":[{"border-y":[d]}],"border-color-s":[{"border-s":[d]}],"border-color-e":[{"border-e":[d]}],"border-color-t":[{"border-t":[d]}],"border-color-r":[{"border-r":[d]}],"border-color-b":[{"border-b":[d]}],"border-color-l":[{"border-l":[d]}],"divide-color":[{divide:[d]}],"outline-style":[{outline:["",...Wt()]}],"outline-offset":[{"outline-offset":[Zc,Tn]}],"outline-w":[{outline:[Zc,xd]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:Jt()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[le]}],"ring-offset-w":[{"ring-offset":[Zc,xd]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",vd,d9]}],"shadow-color":[{shadow:[Qy]}],opacity:[{opacity:[le]}],"mix-blend":[{"mix-blend":[...Nt(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":Nt()}],filter:[{filter:["","none"]}],blur:[{blur:[i]}],brightness:[{brightness:[a]}],contrast:[{contrast:[N]}],"drop-shadow":[{"drop-shadow":["","none",vd,Tn]}],grayscale:[{grayscale:[D]}],"hue-rotate":[{"hue-rotate":[O]}],invert:[{invert:[$]}],saturate:[{saturate:[he]}],sepia:[{sepia:[je]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[i]}],"backdrop-brightness":[{"backdrop-brightness":[a]}],"backdrop-contrast":[{"backdrop-contrast":[N]}],"backdrop-grayscale":[{"backdrop-grayscale":[D]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[O]}],"backdrop-invert":[{"backdrop-invert":[$]}],"backdrop-opacity":[{"backdrop-opacity":[le]}],"backdrop-saturate":[{"backdrop-saturate":[he]}],"backdrop-sepia":[{"backdrop-sepia":[je]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[S]}],"border-spacing-x":[{"border-spacing-x":[S]}],"border-spacing-y":[{"border-spacing-y":[S]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Tn]}],duration:[{duration:rr()}],ease:[{ease:["linear","in","out","in-out",Tn]}],delay:[{delay:rr()}],animate:[{animate:["none","spin","ping","pulse","bounce",Tn]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[Se]}],"scale-x":[{"scale-x":[Se]}],"scale-y":[{"scale-y":[Se]}],rotate:[{rotate:[Jy,Tn]}],"translate-x":[{"translate-x":[ct]}],"translate-y":[{"translate-y":[ct]}],"skew-x":[{"skew-x":[it]}],"skew-y":[{"skew-y":[it]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Tn]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Tn]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Mt()}],"scroll-mx":[{"scroll-mx":Mt()}],"scroll-my":[{"scroll-my":Mt()}],"scroll-ms":[{"scroll-ms":Mt()}],"scroll-me":[{"scroll-me":Mt()}],"scroll-mt":[{"scroll-mt":Mt()}],"scroll-mr":[{"scroll-mr":Mt()}],"scroll-mb":[{"scroll-mb":Mt()}],"scroll-ml":[{"scroll-ml":Mt()}],"scroll-p":[{"scroll-p":Mt()}],"scroll-px":[{"scroll-px":Mt()}],"scroll-py":[{"scroll-py":Mt()}],"scroll-ps":[{"scroll-ps":Mt()}],"scroll-pe":[{"scroll-pe":Mt()}],"scroll-pt":[{"scroll-pt":Mt()}],"scroll-pr":[{"scroll-pr":Mt()}],"scroll-pb":[{"scroll-pb":Mt()}],"scroll-pl":[{"scroll-pl":Mt()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Tn]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[Zc,xd,IE]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},g9=KW(m9);function br(...e){return g9(U4(e))}const _9=eW,nz=H.forwardRef(({className:e,...t},i)=>f.jsx(D4,{ref:i,className:br("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",e),...t}));nz.displayName=D4.displayName;const y9=Og("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),iz=H.forwardRef(({className:e,variant:t,...i},a)=>f.jsx(L4,{ref:a,className:br(y9({variant:t}),e),...i}));iz.displayName=L4.displayName;const x9=H.forwardRef(({className:e,...t},i)=>f.jsx(F4,{ref:i,className:br("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",e),...t}));x9.displayName=F4.displayName;const sz=H.forwardRef(({className:e,...t},i)=>f.jsx(B4,{ref:i,className:br("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",e),"toast-close":"",...t,children:f.jsx(wc,{className:"h-4 w-4"})}));sz.displayName=B4.displayName;const oz=H.forwardRef(({className:e,...t},i)=>f.jsx(O4,{ref:i,className:br("text-sm font-semibold",e),...t}));oz.displayName=O4.displayName;const az=H.forwardRef(({className:e,...t},i)=>f.jsx(z4,{ref:i,className:br("text-sm opacity-90",e),...t}));az.displayName=z4.displayName;function v9(){const{toasts:e}=Ov();return f.jsxs(_9,{children:[e.map(function({id:t,title:i,description:a,action:d,...y}){return f.jsxs(iz,{...y,children:[f.jsxs("div",{className:"grid gap-1",children:[i&&f.jsx(oz,{children:i}),a&&f.jsx(az,{children:a})]}),d,f.jsx(sz,{})]},t)}),f.jsx(nz,{})]})}var w3=["light","dark"],b9="(prefers-color-scheme: dark)",w9=H.createContext(void 0),S9={setTheme:e=>{},themes:[]},T9=()=>{var e;return(e=H.useContext(w9))!=null?e:S9};H.memo(({forcedTheme:e,storageKey:t,attribute:i,enableSystem:a,enableColorScheme:d,defaultTheme:y,value:S,attrs:s,nonce:N})=>{let D=y==="system",O=i==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${s.map(re=>`'${re}'`).join(",")})`};`:`var d=document.documentElement,n='${i}',s='setAttribute';`,$=d?w3.includes(y)&&y?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${y}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",q=(re,Q=!1,ce=!0)=>{let le=S?S[re]:re,ae=Q?re+"|| ''":`'${le}'`,he="";return d&&ce&&!Q&&w3.includes(re)&&(he+=`d.style.colorScheme = '${re}';`),i==="class"?Q||le?he+=`c.add(${ae})`:he+="null":le&&(he+=`d[s](n,${ae})`),he},J=e?`!function(){${O}${q(e)}}()`:a?`!function(){try{${O}var e=localStorage.getItem('${t}');if('system'===e||(!e&&${D})){var t='${b9}',m=window.matchMedia(t);if(m.media!==t||m.matches){${q("dark")}}else{${q("light")}}}else if(e){${S?`var x=${JSON.stringify(S)};`:""}${q(S?"x[e]":"e",!0)}}${D?"":"else{"+q(y,!1,!1)+"}"}${$}}catch(e){}}()`:`!function(){try{${O}var e=localStorage.getItem('${t}');if(e){${S?`var x=${JSON.stringify(S)};`:""}${q(S?"x[e]":"e",!0)}}else{${q(y,!1,!1)};}${$}}catch(t){}}();`;return H.createElement("script",{nonce:N,dangerouslySetInnerHTML:{__html:J}})});var E9=e=>{switch(e){case"success":return A9;case"info":return I9;case"warning":return P9;case"error":return k9;default:return null}},C9=Array(12).fill(0),M9=({visible:e})=>Gt.createElement("div",{className:"sonner-loading-wrapper","data-visible":e},Gt.createElement("div",{className:"sonner-spinner"},C9.map((t,i)=>Gt.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${i}`})))),A9=Gt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Gt.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),P9=Gt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},Gt.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),I9=Gt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Gt.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),k9=Gt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Gt.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),N9=()=>{let[e,t]=Gt.useState(document.hidden);return Gt.useEffect(()=>{let i=()=>{t(document.hidden)};return document.addEventListener("visibilitychange",i),()=>window.removeEventListener("visibilitychange",i)},[]),e},oM=1,R9=class{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{let t=this.subscribers.indexOf(e);this.subscribers.splice(t,1)}),this.publish=e=>{this.subscribers.forEach(t=>t(e))},this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e]},this.create=e=>{var t;let{message:i,...a}=e,d=typeof(e==null?void 0:e.id)=="number"||((t=e.id)==null?void 0:t.length)>0?e.id:oM++,y=this.toasts.find(s=>s.id===d),S=e.dismissible===void 0?!0:e.dismissible;return y?this.toasts=this.toasts.map(s=>s.id===d?(this.publish({...s,...e,id:d,title:i}),{...s,...e,id:d,dismissible:S,title:i}):s):this.addToast({title:i,...a,dismissible:S,id:d}),d},this.dismiss=e=>(e||this.toasts.forEach(t=>{this.subscribers.forEach(i=>i({id:t.id,dismiss:!0}))}),this.subscribers.forEach(t=>t({id:e,dismiss:!0})),e),this.message=(e,t)=>this.create({...t,message:e}),this.error=(e,t)=>this.create({...t,message:e,type:"error"}),this.success=(e,t)=>this.create({...t,type:"success",message:e}),this.info=(e,t)=>this.create({...t,type:"info",message:e}),this.warning=(e,t)=>this.create({...t,type:"warning",message:e}),this.loading=(e,t)=>this.create({...t,type:"loading",message:e}),this.promise=(e,t)=>{if(!t)return;let i;t.loading!==void 0&&(i=this.create({...t,promise:e,type:"loading",message:t.loading,description:typeof t.description!="function"?t.description:void 0}));let a=e instanceof Promise?e:e(),d=i!==void 0;return a.then(async y=>{if(D9(y)&&!y.ok){d=!1;let S=typeof t.error=="function"?await t.error(`HTTP error! status: ${y.status}`):t.error,s=typeof t.description=="function"?await t.description(`HTTP error! status: ${y.status}`):t.description;this.create({id:i,type:"error",message:S,description:s})}else if(t.success!==void 0){d=!1;let S=typeof t.success=="function"?await t.success(y):t.success,s=typeof t.description=="function"?await t.description(y):t.description;this.create({id:i,type:"success",message:S,description:s})}}).catch(async y=>{if(t.error!==void 0){d=!1;let S=typeof t.error=="function"?await t.error(y):t.error,s=typeof t.description=="function"?await t.description(y):t.description;this.create({id:i,type:"error",message:S,description:s})}}).finally(()=>{var y;d&&(this.dismiss(i),i=void 0),(y=t.finally)==null||y.call(t)}),i},this.custom=(e,t)=>{let i=(t==null?void 0:t.id)||oM++;return this.create({jsx:e(i),id:i,...t}),i},this.subscribers=[],this.toasts=[]}},ga=new R9,j9=(e,t)=>{let i=(t==null?void 0:t.id)||oM++;return ga.addToast({title:e,...t,id:i}),i},D9=e=>e&&typeof e=="object"&&"ok"in e&&typeof e.ok=="boolean"&&"status"in e&&typeof e.status=="number",L9=j9,O9=()=>ga.toasts,di=Object.assign(L9,{success:ga.success,info:ga.info,warning:ga.warning,error:ga.error,custom:ga.custom,message:ga.message,promise:ga.promise,dismiss:ga.dismiss,loading:ga.loading},{getHistory:O9});function z9(e,{insertAt:t}={}){if(typeof document>"u")return;let i=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css",t==="top"&&i.firstChild?i.insertBefore(a,i.firstChild):i.appendChild(a),a.styleSheet?a.styleSheet.cssText=e:a.appendChild(document.createTextNode(e))}z9(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999}:where([data-sonner-toaster][data-x-position="right"]){right:max(var(--offset),env(safe-area-inset-right))}:where([data-sonner-toaster][data-x-position="left"]){left:max(var(--offset),env(safe-area-inset-left))}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:max(var(--offset),env(safe-area-inset-top))}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:max(var(--offset),env(safe-area-inset-bottom))}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;background:var(--gray1);color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:0;right:0;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount, 0px));transition:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation:swipe-out .2s ease-out forwards}@keyframes swipe-out{0%{transform:translateY(calc(var(--lift) * var(--offset) + var(--swipe-amount)));opacity:1}to{transform:translateY(calc(var(--lift) * var(--offset) + var(--swipe-amount) + var(--lift) * -100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;--mobile-offset: 16px;right:var(--mobile-offset);left:var(--mobile-offset);width:100%}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset)}[data-sonner-toaster][data-y-position=bottom]{bottom:20px}[data-sonner-toaster][data-y-position=top]{top:20px}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset);right:var(--mobile-offset);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function db(e){return e.label!==void 0}var F9=3,B9="32px",V9=4e3,U9=356,$9=14,G9=20,q9=200;function H9(...e){return e.filter(Boolean).join(" ")}var W9=e=>{var t,i,a,d,y,S,s,N,D,O;let{invert:$,toast:q,unstyled:J,interacting:re,setHeights:Q,visibleToasts:ce,heights:le,index:ae,toasts:he,expanded:Se,removeToast:je,defaultRichColors:it,closeButton:qe,style:ct,cancelButtonStyle:pt,actionButtonStyle:Ze,className:yt="",descriptionClassName:Mt="",duration:Jt,position:jt,gap:Pt,loadingIcon:Wt,expandByDefault:Nt,classNames:Xe,icons:nt,closeButtonAriaLabel:Qt="Close toast",pauseWhenPageIsHidden:rr,cn:mr}=e,[Ut,hn]=Gt.useState(!1),[Gn,At]=Gt.useState(!1),[qt,Br]=Gt.useState(!1),[xn,de]=Gt.useState(!1),[bn,pn]=Gt.useState(0),[hi,bt]=Gt.useState(0),Vi=Gt.useRef(null),ni=Gt.useRef(null),os=ae===0,Be=ae+1<=ce,ut=q.type,St=q.dismissible!==!1,dr=q.className||"",or=q.descriptionClassName||"",tr=Gt.useMemo(()=>le.findIndex(hr=>hr.toastId===q.id)||0,[le,q.id]),Bt=Gt.useMemo(()=>{var hr;return(hr=q.closeButton)!=null?hr:qe},[q.closeButton,qe]),Or=Gt.useMemo(()=>q.duration||Jt||V9,[q.duration,Jt]),Xn=Gt.useRef(0),Bn=Gt.useRef(0),fi=Gt.useRef(0),ms=Gt.useRef(null),[Es,ra]=jt.split("-"),Pa=Gt.useMemo(()=>le.reduce((hr,Jn,Vn)=>Vn>=tr?hr:hr+Jn.height,0),[le,tr]),co=N9(),na=q.invert||$,Xi=ut==="loading";Bn.current=Gt.useMemo(()=>tr*Pt+Pa,[tr,Pa]),Gt.useEffect(()=>{hn(!0)},[]),Gt.useLayoutEffect(()=>{if(!Ut)return;let hr=ni.current,Jn=hr.style.height;hr.style.height="auto";let Vn=hr.getBoundingClientRect().height;hr.style.height=Jn,bt(Vn),Q(xi=>xi.find(gs=>gs.toastId===q.id)?xi.map(gs=>gs.toastId===q.id?{...gs,height:Vn}:gs):[{toastId:q.id,height:Vn,position:q.position},...xi])},[Ut,q.title,q.description,Q,q.id]);let Vs=Gt.useCallback(()=>{At(!0),pn(Bn.current),Q(hr=>hr.filter(Jn=>Jn.toastId!==q.id)),setTimeout(()=>{je(q)},q9)},[q,je,Q,Bn]);Gt.useEffect(()=>{if(q.promise&&ut==="loading"||q.duration===1/0||q.type==="loading")return;let hr,Jn=Or;return Se||re||rr&&co?(()=>{if(fi.current<Xn.current){let Vn=new Date().getTime()-Xn.current;Jn=Jn-Vn}fi.current=new Date().getTime()})():Jn!==1/0&&(Xn.current=new Date().getTime(),hr=setTimeout(()=>{var Vn;(Vn=q.onAutoClose)==null||Vn.call(q,q),Vs()},Jn)),()=>clearTimeout(hr)},[Se,re,Nt,q,Or,Vs,q.promise,ut,rr,co]),Gt.useEffect(()=>{let hr=ni.current;if(hr){let Jn=hr.getBoundingClientRect().height;return bt(Jn),Q(Vn=>[{toastId:q.id,height:Jn,position:q.position},...Vn]),()=>Q(Vn=>Vn.filter(xi=>xi.toastId!==q.id))}},[Q,q.id]),Gt.useEffect(()=>{q.delete&&Vs()},[Vs,q.delete]);function Kn(){return nt!=null&&nt.loading?Gt.createElement("div",{className:"sonner-loader","data-visible":ut==="loading"},nt.loading):Wt?Gt.createElement("div",{className:"sonner-loader","data-visible":ut==="loading"},Wt):Gt.createElement(M9,{visible:ut==="loading"})}return Gt.createElement("li",{"aria-live":q.important?"assertive":"polite","aria-atomic":"true",role:"status",tabIndex:0,ref:ni,className:mr(yt,dr,Xe==null?void 0:Xe.toast,(t=q==null?void 0:q.classNames)==null?void 0:t.toast,Xe==null?void 0:Xe.default,Xe==null?void 0:Xe[ut],(i=q==null?void 0:q.classNames)==null?void 0:i[ut]),"data-sonner-toast":"","data-rich-colors":(a=q.richColors)!=null?a:it,"data-styled":!(q.jsx||q.unstyled||J),"data-mounted":Ut,"data-promise":!!q.promise,"data-removed":Gn,"data-visible":Be,"data-y-position":Es,"data-x-position":ra,"data-index":ae,"data-front":os,"data-swiping":qt,"data-dismissible":St,"data-type":ut,"data-invert":na,"data-swipe-out":xn,"data-expanded":!!(Se||Nt&&Ut),style:{"--index":ae,"--toasts-before":ae,"--z-index":he.length-ae,"--offset":`${Gn?bn:Bn.current}px`,"--initial-height":Nt?"auto":`${hi}px`,...ct,...q.style},onPointerDown:hr=>{Xi||!St||(Vi.current=new Date,pn(Bn.current),hr.target.setPointerCapture(hr.pointerId),hr.target.tagName!=="BUTTON"&&(Br(!0),ms.current={x:hr.clientX,y:hr.clientY}))},onPointerUp:()=>{var hr,Jn,Vn,xi;if(xn||!St)return;ms.current=null;let gs=Number(((hr=ni.current)==null?void 0:hr.style.getPropertyValue("--swipe-amount").replace("px",""))||0),Ia=new Date().getTime()-((Jn=Vi.current)==null?void 0:Jn.getTime()),ql=Math.abs(gs)/Ia;if(Math.abs(gs)>=G9||ql>.11){pn(Bn.current),(Vn=q.onDismiss)==null||Vn.call(q,q),Vs(),de(!0);return}(xi=ni.current)==null||xi.style.setProperty("--swipe-amount","0px"),Br(!1)},onPointerMove:hr=>{var Jn;if(!ms.current||!St)return;let Vn=hr.clientY-ms.current.y,xi=hr.clientX-ms.current.x,gs=(Es==="top"?Math.min:Math.max)(0,Vn),Ia=hr.pointerType==="touch"?10:2;Math.abs(gs)>Ia?(Jn=ni.current)==null||Jn.style.setProperty("--swipe-amount",`${Vn}px`):Math.abs(xi)>Ia&&(ms.current=null)}},Bt&&!q.jsx?Gt.createElement("button",{"aria-label":Qt,"data-disabled":Xi,"data-close-button":!0,onClick:Xi||!St?()=>{}:()=>{var hr;Vs(),(hr=q.onDismiss)==null||hr.call(q,q)},className:mr(Xe==null?void 0:Xe.closeButton,(d=q==null?void 0:q.classNames)==null?void 0:d.closeButton)},Gt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},Gt.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),Gt.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))):null,q.jsx||Gt.isValidElement(q.title)?q.jsx||q.title:Gt.createElement(Gt.Fragment,null,ut||q.icon||q.promise?Gt.createElement("div",{"data-icon":"",className:mr(Xe==null?void 0:Xe.icon,(y=q==null?void 0:q.classNames)==null?void 0:y.icon)},q.promise||q.type==="loading"&&!q.icon?q.icon||Kn():null,q.type!=="loading"?q.icon||(nt==null?void 0:nt[ut])||E9(ut):null):null,Gt.createElement("div",{"data-content":"",className:mr(Xe==null?void 0:Xe.content,(S=q==null?void 0:q.classNames)==null?void 0:S.content)},Gt.createElement("div",{"data-title":"",className:mr(Xe==null?void 0:Xe.title,(s=q==null?void 0:q.classNames)==null?void 0:s.title)},q.title),q.description?Gt.createElement("div",{"data-description":"",className:mr(Mt,or,Xe==null?void 0:Xe.description,(N=q==null?void 0:q.classNames)==null?void 0:N.description)},q.description):null),Gt.isValidElement(q.cancel)?q.cancel:q.cancel&&db(q.cancel)?Gt.createElement("button",{"data-button":!0,"data-cancel":!0,style:q.cancelButtonStyle||pt,onClick:hr=>{var Jn,Vn;db(q.cancel)&&St&&((Vn=(Jn=q.cancel).onClick)==null||Vn.call(Jn,hr),Vs())},className:mr(Xe==null?void 0:Xe.cancelButton,(D=q==null?void 0:q.classNames)==null?void 0:D.cancelButton)},q.cancel.label):null,Gt.isValidElement(q.action)?q.action:q.action&&db(q.action)?Gt.createElement("button",{"data-button":!0,"data-action":!0,style:q.actionButtonStyle||Ze,onClick:hr=>{var Jn,Vn;db(q.action)&&(hr.defaultPrevented||((Vn=(Jn=q.action).onClick)==null||Vn.call(Jn,hr),Vs()))},className:mr(Xe==null?void 0:Xe.actionButton,(O=q==null?void 0:q.classNames)==null?void 0:O.actionButton)},q.action.label):null))};function S3(){if(typeof window>"u"||typeof document>"u")return"ltr";let e=document.documentElement.getAttribute("dir");return e==="auto"||!e?window.getComputedStyle(document.documentElement).direction:e}var Z9=e=>{let{invert:t,position:i="bottom-right",hotkey:a=["altKey","KeyT"],expand:d,closeButton:y,className:S,offset:s,theme:N="light",richColors:D,duration:O,style:$,visibleToasts:q=F9,toastOptions:J,dir:re=S3(),gap:Q=$9,loadingIcon:ce,icons:le,containerAriaLabel:ae="Notifications",pauseWhenPageIsHidden:he,cn:Se=H9}=e,[je,it]=Gt.useState([]),qe=Gt.useMemo(()=>Array.from(new Set([i].concat(je.filter(rr=>rr.position).map(rr=>rr.position)))),[je,i]),[ct,pt]=Gt.useState([]),[Ze,yt]=Gt.useState(!1),[Mt,Jt]=Gt.useState(!1),[jt,Pt]=Gt.useState(N!=="system"?N:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),Wt=Gt.useRef(null),Nt=a.join("+").replace(/Key/g,"").replace(/Digit/g,""),Xe=Gt.useRef(null),nt=Gt.useRef(!1),Qt=Gt.useCallback(rr=>{var mr;(mr=je.find(Ut=>Ut.id===rr.id))!=null&&mr.delete||ga.dismiss(rr.id),it(Ut=>Ut.filter(({id:hn})=>hn!==rr.id))},[je]);return Gt.useEffect(()=>ga.subscribe(rr=>{if(rr.dismiss){it(mr=>mr.map(Ut=>Ut.id===rr.id?{...Ut,delete:!0}:Ut));return}setTimeout(()=>{$A.flushSync(()=>{it(mr=>{let Ut=mr.findIndex(hn=>hn.id===rr.id);return Ut!==-1?[...mr.slice(0,Ut),{...mr[Ut],...rr},...mr.slice(Ut+1)]:[rr,...mr]})})})}),[]),Gt.useEffect(()=>{if(N!=="system"){Pt(N);return}N==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?Pt("dark"):Pt("light")),typeof window<"u"&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",({matches:rr})=>{Pt(rr?"dark":"light")})},[N]),Gt.useEffect(()=>{je.length<=1&&yt(!1)},[je]),Gt.useEffect(()=>{let rr=mr=>{var Ut,hn;a.every(Gn=>mr[Gn]||mr.code===Gn)&&(yt(!0),(Ut=Wt.current)==null||Ut.focus()),mr.code==="Escape"&&(document.activeElement===Wt.current||(hn=Wt.current)!=null&&hn.contains(document.activeElement))&&yt(!1)};return document.addEventListener("keydown",rr),()=>document.removeEventListener("keydown",rr)},[a]),Gt.useEffect(()=>{if(Wt.current)return()=>{Xe.current&&(Xe.current.focus({preventScroll:!0}),Xe.current=null,nt.current=!1)}},[Wt.current]),je.length?Gt.createElement("section",{"aria-label":`${ae} ${Nt}`,tabIndex:-1},qe.map((rr,mr)=>{var Ut;let[hn,Gn]=rr.split("-");return Gt.createElement("ol",{key:rr,dir:re==="auto"?S3():re,tabIndex:-1,ref:Wt,className:S,"data-sonner-toaster":!0,"data-theme":jt,"data-y-position":hn,"data-x-position":Gn,style:{"--front-toast-height":`${((Ut=ct[0])==null?void 0:Ut.height)||0}px`,"--offset":typeof s=="number"?`${s}px`:s||B9,"--width":`${U9}px`,"--gap":`${Q}px`,...$},onBlur:At=>{nt.current&&!At.currentTarget.contains(At.relatedTarget)&&(nt.current=!1,Xe.current&&(Xe.current.focus({preventScroll:!0}),Xe.current=null))},onFocus:At=>{At.target instanceof HTMLElement&&At.target.dataset.dismissible==="false"||nt.current||(nt.current=!0,Xe.current=At.relatedTarget)},onMouseEnter:()=>yt(!0),onMouseMove:()=>yt(!0),onMouseLeave:()=>{Mt||yt(!1)},onPointerDown:At=>{At.target instanceof HTMLElement&&At.target.dataset.dismissible==="false"||Jt(!0)},onPointerUp:()=>Jt(!1)},je.filter(At=>!At.position&&mr===0||At.position===rr).map((At,qt)=>{var Br,xn;return Gt.createElement(W9,{key:At.id,icons:le,index:qt,toast:At,defaultRichColors:D,duration:(Br=J==null?void 0:J.duration)!=null?Br:O,className:J==null?void 0:J.className,descriptionClassName:J==null?void 0:J.descriptionClassName,invert:t,visibleToasts:q,closeButton:(xn=J==null?void 0:J.closeButton)!=null?xn:y,interacting:Mt,position:rr,style:J==null?void 0:J.style,unstyled:J==null?void 0:J.unstyled,classNames:J==null?void 0:J.classNames,cancelButtonStyle:J==null?void 0:J.cancelButtonStyle,actionButtonStyle:J==null?void 0:J.actionButtonStyle,removeToast:Qt,toasts:je.filter(de=>de.position==At.position),heights:ct.filter(de=>de.position==At.position),setHeights:pt,expandByDefault:d,gap:Q,loadingIcon:ce,expanded:Ze,pauseWhenPageIsHidden:he,cn:Se})}))})):null};const Y9=({...e})=>{const{theme:t="system"}=T9();return f.jsx(Z9,{theme:t,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...e})};var X9=fL.useId||(()=>{}),K9=0;function ba(e){const[t,i]=H.useState(X9());return ss(()=>{e||i(a=>a??String(K9++))},[e]),e||(t?`radix-${t}`:"")}const J9=["top","right","bottom","left"],ih=Math.min,ya=Math.max,xw=Math.round,hb=Math.floor,sh=e=>({x:e,y:e}),Q9={left:"right",right:"left",bottom:"top",top:"bottom"},eZ={start:"end",end:"start"};function aM(e,t,i){return ya(e,ih(t,i))}function mu(e,t){return typeof e=="function"?e(t):e}function gu(e){return e.split("-")[0]}function Fg(e){return e.split("-")[1]}function JA(e){return e==="x"?"y":"x"}function QA(e){return e==="y"?"height":"width"}function oh(e){return["top","bottom"].includes(gu(e))?"y":"x"}function eP(e){return JA(oh(e))}function tZ(e,t,i){i===void 0&&(i=!1);const a=Fg(e),d=eP(e),y=QA(d);let S=d==="x"?a===(i?"end":"start")?"right":"left":a==="start"?"bottom":"top";return t.reference[y]>t.floating[y]&&(S=vw(S)),[S,vw(S)]}function rZ(e){const t=vw(e);return[lM(e),t,lM(t)]}function lM(e){return e.replace(/start|end/g,t=>eZ[t])}function nZ(e,t,i){const a=["left","right"],d=["right","left"],y=["top","bottom"],S=["bottom","top"];switch(e){case"top":case"bottom":return i?t?d:a:t?a:d;case"left":case"right":return t?y:S;default:return[]}}function iZ(e,t,i,a){const d=Fg(e);let y=nZ(gu(e),i==="start",a);return d&&(y=y.map(S=>S+"-"+d),t&&(y=y.concat(y.map(lM)))),y}function vw(e){return e.replace(/left|right|bottom|top/g,t=>Q9[t])}function sZ(e){return{top:0,right:0,bottom:0,left:0,...e}}function lz(e){return typeof e!="number"?sZ(e):{top:e,right:e,bottom:e,left:e}}function bw(e){const{x:t,y:i,width:a,height:d}=e;return{width:a,height:d,top:i,left:t,right:t+a,bottom:i+d,x:t,y:i}}function T3(e,t,i){let{reference:a,floating:d}=e;const y=oh(t),S=eP(t),s=QA(S),N=gu(t),D=y==="y",O=a.x+a.width/2-d.width/2,$=a.y+a.height/2-d.height/2,q=a[s]/2-d[s]/2;let J;switch(N){case"top":J={x:O,y:a.y-d.height};break;case"bottom":J={x:O,y:a.y+a.height};break;case"right":J={x:a.x+a.width,y:$};break;case"left":J={x:a.x-d.width,y:$};break;default:J={x:a.x,y:a.y}}switch(Fg(t)){case"start":J[S]-=q*(i&&D?-1:1);break;case"end":J[S]+=q*(i&&D?-1:1);break}return J}const oZ=async(e,t,i)=>{const{placement:a="bottom",strategy:d="absolute",middleware:y=[],platform:S}=i,s=y.filter(Boolean),N=await(S.isRTL==null?void 0:S.isRTL(t));let D=await S.getElementRects({reference:e,floating:t,strategy:d}),{x:O,y:$}=T3(D,a,N),q=a,J={},re=0;for(let Q=0;Q<s.length;Q++){const{name:ce,fn:le}=s[Q],{x:ae,y:he,data:Se,reset:je}=await le({x:O,y:$,initialPlacement:a,placement:q,strategy:d,middlewareData:J,rects:D,platform:S,elements:{reference:e,floating:t}});O=ae??O,$=he??$,J={...J,[ce]:{...J[ce],...Se}},je&&re<=50&&(re++,typeof je=="object"&&(je.placement&&(q=je.placement),je.rects&&(D=je.rects===!0?await S.getElementRects({reference:e,floating:t,strategy:d}):je.rects),{x:O,y:$}=T3(D,q,N)),Q=-1)}return{x:O,y:$,placement:q,strategy:d,middlewareData:J}};async function nv(e,t){var i;t===void 0&&(t={});const{x:a,y:d,platform:y,rects:S,elements:s,strategy:N}=e,{boundary:D="clippingAncestors",rootBoundary:O="viewport",elementContext:$="floating",altBoundary:q=!1,padding:J=0}=mu(t,e),re=lz(J),ce=s[q?$==="floating"?"reference":"floating":$],le=bw(await y.getClippingRect({element:(i=await(y.isElement==null?void 0:y.isElement(ce)))==null||i?ce:ce.contextElement||await(y.getDocumentElement==null?void 0:y.getDocumentElement(s.floating)),boundary:D,rootBoundary:O,strategy:N})),ae=$==="floating"?{x:a,y:d,width:S.floating.width,height:S.floating.height}:S.reference,he=await(y.getOffsetParent==null?void 0:y.getOffsetParent(s.floating)),Se=await(y.isElement==null?void 0:y.isElement(he))?await(y.getScale==null?void 0:y.getScale(he))||{x:1,y:1}:{x:1,y:1},je=bw(y.convertOffsetParentRelativeRectToViewportRelativeRect?await y.convertOffsetParentRelativeRectToViewportRelativeRect({elements:s,rect:ae,offsetParent:he,strategy:N}):ae);return{top:(le.top-je.top+re.top)/Se.y,bottom:(je.bottom-le.bottom+re.bottom)/Se.y,left:(le.left-je.left+re.left)/Se.x,right:(je.right-le.right+re.right)/Se.x}}const aZ=e=>({name:"arrow",options:e,async fn(t){const{x:i,y:a,placement:d,rects:y,platform:S,elements:s,middlewareData:N}=t,{element:D,padding:O=0}=mu(e,t)||{};if(D==null)return{};const $=lz(O),q={x:i,y:a},J=eP(d),re=QA(J),Q=await S.getDimensions(D),ce=J==="y",le=ce?"top":"left",ae=ce?"bottom":"right",he=ce?"clientHeight":"clientWidth",Se=y.reference[re]+y.reference[J]-q[J]-y.floating[re],je=q[J]-y.reference[J],it=await(S.getOffsetParent==null?void 0:S.getOffsetParent(D));let qe=it?it[he]:0;(!qe||!await(S.isElement==null?void 0:S.isElement(it)))&&(qe=s.floating[he]||y.floating[re]);const ct=Se/2-je/2,pt=qe/2-Q[re]/2-1,Ze=ih($[le],pt),yt=ih($[ae],pt),Mt=Ze,Jt=qe-Q[re]-yt,jt=qe/2-Q[re]/2+ct,Pt=aM(Mt,jt,Jt),Wt=!N.arrow&&Fg(d)!=null&&jt!==Pt&&y.reference[re]/2-(jt<Mt?Ze:yt)-Q[re]/2<0,Nt=Wt?jt<Mt?jt-Mt:jt-Jt:0;return{[J]:q[J]+Nt,data:{[J]:Pt,centerOffset:jt-Pt-Nt,...Wt&&{alignmentOffset:Nt}},reset:Wt}}}),lZ=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(t){var i,a;const{placement:d,middlewareData:y,rects:S,initialPlacement:s,platform:N,elements:D}=t,{mainAxis:O=!0,crossAxis:$=!0,fallbackPlacements:q,fallbackStrategy:J="bestFit",fallbackAxisSideDirection:re="none",flipAlignment:Q=!0,...ce}=mu(e,t);if((i=y.arrow)!=null&&i.alignmentOffset)return{};const le=gu(d),ae=oh(s),he=gu(s)===s,Se=await(N.isRTL==null?void 0:N.isRTL(D.floating)),je=q||(he||!Q?[vw(s)]:rZ(s)),it=re!=="none";!q&&it&&je.push(...iZ(s,Q,re,Se));const qe=[s,...je],ct=await nv(t,ce),pt=[];let Ze=((a=y.flip)==null?void 0:a.overflows)||[];if(O&&pt.push(ct[le]),$){const jt=tZ(d,S,Se);pt.push(ct[jt[0]],ct[jt[1]])}if(Ze=[...Ze,{placement:d,overflows:pt}],!pt.every(jt=>jt<=0)){var yt,Mt;const jt=(((yt=y.flip)==null?void 0:yt.index)||0)+1,Pt=qe[jt];if(Pt)return{data:{index:jt,overflows:Ze},reset:{placement:Pt}};let Wt=(Mt=Ze.filter(Nt=>Nt.overflows[0]<=0).sort((Nt,Xe)=>Nt.overflows[1]-Xe.overflows[1])[0])==null?void 0:Mt.placement;if(!Wt)switch(J){case"bestFit":{var Jt;const Nt=(Jt=Ze.filter(Xe=>{if(it){const nt=oh(Xe.placement);return nt===ae||nt==="y"}return!0}).map(Xe=>[Xe.placement,Xe.overflows.filter(nt=>nt>0).reduce((nt,Qt)=>nt+Qt,0)]).sort((Xe,nt)=>Xe[1]-nt[1])[0])==null?void 0:Jt[0];Nt&&(Wt=Nt);break}case"initialPlacement":Wt=s;break}if(d!==Wt)return{reset:{placement:Wt}}}return{}}}};function E3(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function C3(e){return J9.some(t=>e[t]>=0)}const cZ=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(t){const{rects:i}=t,{strategy:a="referenceHidden",...d}=mu(e,t);switch(a){case"referenceHidden":{const y=await nv(t,{...d,elementContext:"reference"}),S=E3(y,i.reference);return{data:{referenceHiddenOffsets:S,referenceHidden:C3(S)}}}case"escaped":{const y=await nv(t,{...d,altBoundary:!0}),S=E3(y,i.floating);return{data:{escapedOffsets:S,escaped:C3(S)}}}default:return{}}}}};async function uZ(e,t){const{placement:i,platform:a,elements:d}=e,y=await(a.isRTL==null?void 0:a.isRTL(d.floating)),S=gu(i),s=Fg(i),N=oh(i)==="y",D=["left","top"].includes(S)?-1:1,O=y&&N?-1:1,$=mu(t,e);let{mainAxis:q,crossAxis:J,alignmentAxis:re}=typeof $=="number"?{mainAxis:$,crossAxis:0,alignmentAxis:null}:{mainAxis:$.mainAxis||0,crossAxis:$.crossAxis||0,alignmentAxis:$.alignmentAxis};return s&&typeof re=="number"&&(J=s==="end"?re*-1:re),N?{x:J*O,y:q*D}:{x:q*D,y:J*O}}const dZ=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(t){var i,a;const{x:d,y,placement:S,middlewareData:s}=t,N=await uZ(t,e);return S===((i=s.offset)==null?void 0:i.placement)&&(a=s.arrow)!=null&&a.alignmentOffset?{}:{x:d+N.x,y:y+N.y,data:{...N,placement:S}}}}},hZ=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(t){const{x:i,y:a,placement:d}=t,{mainAxis:y=!0,crossAxis:S=!1,limiter:s={fn:ce=>{let{x:le,y:ae}=ce;return{x:le,y:ae}}},...N}=mu(e,t),D={x:i,y:a},O=await nv(t,N),$=oh(gu(d)),q=JA($);let J=D[q],re=D[$];if(y){const ce=q==="y"?"top":"left",le=q==="y"?"bottom":"right",ae=J+O[ce],he=J-O[le];J=aM(ae,J,he)}if(S){const ce=$==="y"?"top":"left",le=$==="y"?"bottom":"right",ae=re+O[ce],he=re-O[le];re=aM(ae,re,he)}const Q=s.fn({...t,[q]:J,[$]:re});return{...Q,data:{x:Q.x-i,y:Q.y-a,enabled:{[q]:y,[$]:S}}}}}},fZ=function(e){return e===void 0&&(e={}),{options:e,fn(t){const{x:i,y:a,placement:d,rects:y,middlewareData:S}=t,{offset:s=0,mainAxis:N=!0,crossAxis:D=!0}=mu(e,t),O={x:i,y:a},$=oh(d),q=JA($);let J=O[q],re=O[$];const Q=mu(s,t),ce=typeof Q=="number"?{mainAxis:Q,crossAxis:0}:{mainAxis:0,crossAxis:0,...Q};if(N){const he=q==="y"?"height":"width",Se=y.reference[q]-y.floating[he]+ce.mainAxis,je=y.reference[q]+y.reference[he]-ce.mainAxis;J<Se?J=Se:J>je&&(J=je)}if(D){var le,ae;const he=q==="y"?"width":"height",Se=["top","left"].includes(gu(d)),je=y.reference[$]-y.floating[he]+(Se&&((le=S.offset)==null?void 0:le[$])||0)+(Se?0:ce.crossAxis),it=y.reference[$]+y.reference[he]+(Se?0:((ae=S.offset)==null?void 0:ae[$])||0)-(Se?ce.crossAxis:0);re<je?re=je:re>it&&(re=it)}return{[q]:J,[$]:re}}}},pZ=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(t){var i,a;const{placement:d,rects:y,platform:S,elements:s}=t,{apply:N=()=>{},...D}=mu(e,t),O=await nv(t,D),$=gu(d),q=Fg(d),J=oh(d)==="y",{width:re,height:Q}=y.floating;let ce,le;$==="top"||$==="bottom"?(ce=$,le=q===(await(S.isRTL==null?void 0:S.isRTL(s.floating))?"start":"end")?"left":"right"):(le=$,ce=q==="end"?"top":"bottom");const ae=Q-O.top-O.bottom,he=re-O.left-O.right,Se=ih(Q-O[ce],ae),je=ih(re-O[le],he),it=!t.middlewareData.shift;let qe=Se,ct=je;if((i=t.middlewareData.shift)!=null&&i.enabled.x&&(ct=he),(a=t.middlewareData.shift)!=null&&a.enabled.y&&(qe=ae),it&&!q){const Ze=ya(O.left,0),yt=ya(O.right,0),Mt=ya(O.top,0),Jt=ya(O.bottom,0);J?ct=re-2*(Ze!==0||yt!==0?Ze+yt:ya(O.left,O.right)):qe=Q-2*(Mt!==0||Jt!==0?Mt+Jt:ya(O.top,O.bottom))}await N({...t,availableWidth:ct,availableHeight:qe});const pt=await S.getDimensions(s.floating);return re!==pt.width||Q!==pt.height?{reset:{rects:!0}}:{}}}};function m2(){return typeof window<"u"}function Bg(e){return cz(e)?(e.nodeName||"").toLowerCase():"#document"}function wa(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function Ic(e){var t;return(t=(cz(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function cz(e){return m2()?e instanceof Node||e instanceof wa(e).Node:!1}function zl(e){return m2()?e instanceof Element||e instanceof wa(e).Element:!1}function Cc(e){return m2()?e instanceof HTMLElement||e instanceof wa(e).HTMLElement:!1}function M3(e){return!m2()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof wa(e).ShadowRoot}function Bv(e){const{overflow:t,overflowX:i,overflowY:a,display:d}=Fl(e);return/auto|scroll|overlay|hidden|clip/.test(t+a+i)&&!["inline","contents"].includes(d)}function mZ(e){return["table","td","th"].includes(Bg(e))}function g2(e){return[":popover-open",":modal"].some(t=>{try{return e.matches(t)}catch{return!1}})}function tP(e){const t=rP(),i=zl(e)?Fl(e):e;return i.transform!=="none"||i.perspective!=="none"||(i.containerType?i.containerType!=="normal":!1)||!t&&(i.backdropFilter?i.backdropFilter!=="none":!1)||!t&&(i.filter?i.filter!=="none":!1)||["transform","perspective","filter"].some(a=>(i.willChange||"").includes(a))||["paint","layout","strict","content"].some(a=>(i.contain||"").includes(a))}function gZ(e){let t=ah(e);for(;Cc(t)&&!bg(t);){if(tP(t))return t;if(g2(t))return null;t=ah(t)}return null}function rP(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function bg(e){return["html","body","#document"].includes(Bg(e))}function Fl(e){return wa(e).getComputedStyle(e)}function _2(e){return zl(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function ah(e){if(Bg(e)==="html")return e;const t=e.assignedSlot||e.parentNode||M3(e)&&e.host||Ic(e);return M3(t)?t.host:t}function uz(e){const t=ah(e);return bg(t)?e.ownerDocument?e.ownerDocument.body:e.body:Cc(t)&&Bv(t)?t:uz(t)}function iv(e,t,i){var a;t===void 0&&(t=[]),i===void 0&&(i=!0);const d=uz(e),y=d===((a=e.ownerDocument)==null?void 0:a.body),S=wa(d);if(y){const s=cM(S);return t.concat(S,S.visualViewport||[],Bv(d)?d:[],s&&i?iv(s):[])}return t.concat(d,iv(d,[],i))}function cM(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function dz(e){const t=Fl(e);let i=parseFloat(t.width)||0,a=parseFloat(t.height)||0;const d=Cc(e),y=d?e.offsetWidth:i,S=d?e.offsetHeight:a,s=xw(i)!==y||xw(a)!==S;return s&&(i=y,a=S),{width:i,height:a,$:s}}function nP(e){return zl(e)?e:e.contextElement}function Qm(e){const t=nP(e);if(!Cc(t))return sh(1);const i=t.getBoundingClientRect(),{width:a,height:d,$:y}=dz(t);let S=(y?xw(i.width):i.width)/a,s=(y?xw(i.height):i.height)/d;return(!S||!Number.isFinite(S))&&(S=1),(!s||!Number.isFinite(s))&&(s=1),{x:S,y:s}}const _Z=sh(0);function hz(e){const t=wa(e);return!rP()||!t.visualViewport?_Z:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function yZ(e,t,i){return t===void 0&&(t=!1),!i||t&&i!==wa(e)?!1:t}function Uf(e,t,i,a){t===void 0&&(t=!1),i===void 0&&(i=!1);const d=e.getBoundingClientRect(),y=nP(e);let S=sh(1);t&&(a?zl(a)&&(S=Qm(a)):S=Qm(e));const s=yZ(y,i,a)?hz(y):sh(0);let N=(d.left+s.x)/S.x,D=(d.top+s.y)/S.y,O=d.width/S.x,$=d.height/S.y;if(y){const q=wa(y),J=a&&zl(a)?wa(a):a;let re=q,Q=cM(re);for(;Q&&a&&J!==re;){const ce=Qm(Q),le=Q.getBoundingClientRect(),ae=Fl(Q),he=le.left+(Q.clientLeft+parseFloat(ae.paddingLeft))*ce.x,Se=le.top+(Q.clientTop+parseFloat(ae.paddingTop))*ce.y;N*=ce.x,D*=ce.y,O*=ce.x,$*=ce.y,N+=he,D+=Se,re=wa(Q),Q=cM(re)}}return bw({width:O,height:$,x:N,y:D})}function xZ(e){let{elements:t,rect:i,offsetParent:a,strategy:d}=e;const y=d==="fixed",S=Ic(a),s=t?g2(t.floating):!1;if(a===S||s&&y)return i;let N={scrollLeft:0,scrollTop:0},D=sh(1);const O=sh(0),$=Cc(a);if(($||!$&&!y)&&((Bg(a)!=="body"||Bv(S))&&(N=_2(a)),Cc(a))){const q=Uf(a);D=Qm(a),O.x=q.x+a.clientLeft,O.y=q.y+a.clientTop}return{width:i.width*D.x,height:i.height*D.y,x:i.x*D.x-N.scrollLeft*D.x+O.x,y:i.y*D.y-N.scrollTop*D.y+O.y}}function vZ(e){return Array.from(e.getClientRects())}function uM(e,t){const i=_2(e).scrollLeft;return t?t.left+i:Uf(Ic(e)).left+i}function bZ(e){const t=Ic(e),i=_2(e),a=e.ownerDocument.body,d=ya(t.scrollWidth,t.clientWidth,a.scrollWidth,a.clientWidth),y=ya(t.scrollHeight,t.clientHeight,a.scrollHeight,a.clientHeight);let S=-i.scrollLeft+uM(e);const s=-i.scrollTop;return Fl(a).direction==="rtl"&&(S+=ya(t.clientWidth,a.clientWidth)-d),{width:d,height:y,x:S,y:s}}function wZ(e,t){const i=wa(e),a=Ic(e),d=i.visualViewport;let y=a.clientWidth,S=a.clientHeight,s=0,N=0;if(d){y=d.width,S=d.height;const D=rP();(!D||D&&t==="fixed")&&(s=d.offsetLeft,N=d.offsetTop)}return{width:y,height:S,x:s,y:N}}function SZ(e,t){const i=Uf(e,!0,t==="fixed"),a=i.top+e.clientTop,d=i.left+e.clientLeft,y=Cc(e)?Qm(e):sh(1),S=e.clientWidth*y.x,s=e.clientHeight*y.y,N=d*y.x,D=a*y.y;return{width:S,height:s,x:N,y:D}}function A3(e,t,i){let a;if(t==="viewport")a=wZ(e,i);else if(t==="document")a=bZ(Ic(e));else if(zl(t))a=SZ(t,i);else{const d=hz(e);a={...t,x:t.x-d.x,y:t.y-d.y}}return bw(a)}function fz(e,t){const i=ah(e);return i===t||!zl(i)||bg(i)?!1:Fl(i).position==="fixed"||fz(i,t)}function TZ(e,t){const i=t.get(e);if(i)return i;let a=iv(e,[],!1).filter(s=>zl(s)&&Bg(s)!=="body"),d=null;const y=Fl(e).position==="fixed";let S=y?ah(e):e;for(;zl(S)&&!bg(S);){const s=Fl(S),N=tP(S);!N&&s.position==="fixed"&&(d=null),(y?!N&&!d:!N&&s.position==="static"&&!!d&&["absolute","fixed"].includes(d.position)||Bv(S)&&!N&&fz(e,S))?a=a.filter(O=>O!==S):d=s,S=ah(S)}return t.set(e,a),a}function EZ(e){let{element:t,boundary:i,rootBoundary:a,strategy:d}=e;const S=[...i==="clippingAncestors"?g2(t)?[]:TZ(t,this._c):[].concat(i),a],s=S[0],N=S.reduce((D,O)=>{const $=A3(t,O,d);return D.top=ya($.top,D.top),D.right=ih($.right,D.right),D.bottom=ih($.bottom,D.bottom),D.left=ya($.left,D.left),D},A3(t,s,d));return{width:N.right-N.left,height:N.bottom-N.top,x:N.left,y:N.top}}function CZ(e){const{width:t,height:i}=dz(e);return{width:t,height:i}}function MZ(e,t,i){const a=Cc(t),d=Ic(t),y=i==="fixed",S=Uf(e,!0,y,t);let s={scrollLeft:0,scrollTop:0};const N=sh(0);if(a||!a&&!y)if((Bg(t)!=="body"||Bv(d))&&(s=_2(t)),a){const J=Uf(t,!0,y,t);N.x=J.x+t.clientLeft,N.y=J.y+t.clientTop}else d&&(N.x=uM(d));let D=0,O=0;if(d&&!a&&!y){const J=d.getBoundingClientRect();O=J.top+s.scrollTop,D=J.left+s.scrollLeft-uM(d,J)}const $=S.left+s.scrollLeft-N.x-D,q=S.top+s.scrollTop-N.y-O;return{x:$,y:q,width:S.width,height:S.height}}function kE(e){return Fl(e).position==="static"}function P3(e,t){if(!Cc(e)||Fl(e).position==="fixed")return null;if(t)return t(e);let i=e.offsetParent;return Ic(e)===i&&(i=i.ownerDocument.body),i}function pz(e,t){const i=wa(e);if(g2(e))return i;if(!Cc(e)){let d=ah(e);for(;d&&!bg(d);){if(zl(d)&&!kE(d))return d;d=ah(d)}return i}let a=P3(e,t);for(;a&&mZ(a)&&kE(a);)a=P3(a,t);return a&&bg(a)&&kE(a)&&!tP(a)?i:a||gZ(e)||i}const AZ=async function(e){const t=this.getOffsetParent||pz,i=this.getDimensions,a=await i(e.floating);return{reference:MZ(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:a.width,height:a.height}}};function PZ(e){return Fl(e).direction==="rtl"}const IZ={convertOffsetParentRelativeRectToViewportRelativeRect:xZ,getDocumentElement:Ic,getClippingRect:EZ,getOffsetParent:pz,getElementRects:AZ,getClientRects:vZ,getDimensions:CZ,getScale:Qm,isElement:zl,isRTL:PZ};function kZ(e,t){let i=null,a;const d=Ic(e);function y(){var s;clearTimeout(a),(s=i)==null||s.disconnect(),i=null}function S(s,N){s===void 0&&(s=!1),N===void 0&&(N=1),y();const{left:D,top:O,width:$,height:q}=e.getBoundingClientRect();if(s||t(),!$||!q)return;const J=hb(O),re=hb(d.clientWidth-(D+$)),Q=hb(d.clientHeight-(O+q)),ce=hb(D),ae={rootMargin:-J+"px "+-re+"px "+-Q+"px "+-ce+"px",threshold:ya(0,ih(1,N))||1};let he=!0;function Se(je){const it=je[0].intersectionRatio;if(it!==N){if(!he)return S();it?S(!1,it):a=setTimeout(()=>{S(!1,1e-7)},1e3)}he=!1}try{i=new IntersectionObserver(Se,{...ae,root:d.ownerDocument})}catch{i=new IntersectionObserver(Se,ae)}i.observe(e)}return S(!0),y}function NZ(e,t,i,a){a===void 0&&(a={});const{ancestorScroll:d=!0,ancestorResize:y=!0,elementResize:S=typeof ResizeObserver=="function",layoutShift:s=typeof IntersectionObserver=="function",animationFrame:N=!1}=a,D=nP(e),O=d||y?[...D?iv(D):[],...iv(t)]:[];O.forEach(le=>{d&&le.addEventListener("scroll",i,{passive:!0}),y&&le.addEventListener("resize",i)});const $=D&&s?kZ(D,i):null;let q=-1,J=null;S&&(J=new ResizeObserver(le=>{let[ae]=le;ae&&ae.target===D&&J&&(J.unobserve(t),cancelAnimationFrame(q),q=requestAnimationFrame(()=>{var he;(he=J)==null||he.observe(t)})),i()}),D&&!N&&J.observe(D),J.observe(t));let re,Q=N?Uf(e):null;N&&ce();function ce(){const le=Uf(e);Q&&(le.x!==Q.x||le.y!==Q.y||le.width!==Q.width||le.height!==Q.height)&&i(),Q=le,re=requestAnimationFrame(ce)}return i(),()=>{var le;O.forEach(ae=>{d&&ae.removeEventListener("scroll",i),y&&ae.removeEventListener("resize",i)}),$==null||$(),(le=J)==null||le.disconnect(),J=null,N&&cancelAnimationFrame(re)}}const RZ=dZ,jZ=hZ,DZ=lZ,LZ=pZ,OZ=cZ,I3=aZ,zZ=fZ,FZ=(e,t,i)=>{const a=new Map,d={platform:IZ,...i},y={...d.platform,_c:a};return oZ(e,t,{...d,platform:y})};var Bb=typeof document<"u"?H.useLayoutEffect:H.useEffect;function ww(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(typeof e=="function"&&e.toString()===t.toString())return!0;let i,a,d;if(e&&t&&typeof e=="object"){if(Array.isArray(e)){if(i=e.length,i!==t.length)return!1;for(a=i;a--!==0;)if(!ww(e[a],t[a]))return!1;return!0}if(d=Object.keys(e),i=d.length,i!==Object.keys(t).length)return!1;for(a=i;a--!==0;)if(!{}.hasOwnProperty.call(t,d[a]))return!1;for(a=i;a--!==0;){const y=d[a];if(!(y==="_owner"&&e.$$typeof)&&!ww(e[y],t[y]))return!1}return!0}return e!==e&&t!==t}function mz(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function k3(e,t){const i=mz(e);return Math.round(t*i)/i}function NE(e){const t=H.useRef(e);return Bb(()=>{t.current=e}),t}function BZ(e){e===void 0&&(e={});const{placement:t="bottom",strategy:i="absolute",middleware:a=[],platform:d,elements:{reference:y,floating:S}={},transform:s=!0,whileElementsMounted:N,open:D}=e,[O,$]=H.useState({x:0,y:0,strategy:i,placement:t,middlewareData:{},isPositioned:!1}),[q,J]=H.useState(a);ww(q,a)||J(a);const[re,Q]=H.useState(null),[ce,le]=H.useState(null),ae=H.useCallback(Xe=>{Xe!==it.current&&(it.current=Xe,Q(Xe))},[]),he=H.useCallback(Xe=>{Xe!==qe.current&&(qe.current=Xe,le(Xe))},[]),Se=y||re,je=S||ce,it=H.useRef(null),qe=H.useRef(null),ct=H.useRef(O),pt=N!=null,Ze=NE(N),yt=NE(d),Mt=NE(D),Jt=H.useCallback(()=>{if(!it.current||!qe.current)return;const Xe={placement:t,strategy:i,middleware:q};yt.current&&(Xe.platform=yt.current),FZ(it.current,qe.current,Xe).then(nt=>{const Qt={...nt,isPositioned:Mt.current!==!1};jt.current&&!ww(ct.current,Qt)&&(ct.current=Qt,Xf.flushSync(()=>{$(Qt)}))})},[q,t,i,yt,Mt]);Bb(()=>{D===!1&&ct.current.isPositioned&&(ct.current.isPositioned=!1,$(Xe=>({...Xe,isPositioned:!1})))},[D]);const jt=H.useRef(!1);Bb(()=>(jt.current=!0,()=>{jt.current=!1}),[]),Bb(()=>{if(Se&&(it.current=Se),je&&(qe.current=je),Se&&je){if(Ze.current)return Ze.current(Se,je,Jt);Jt()}},[Se,je,Jt,Ze,pt]);const Pt=H.useMemo(()=>({reference:it,floating:qe,setReference:ae,setFloating:he}),[ae,he]),Wt=H.useMemo(()=>({reference:Se,floating:je}),[Se,je]),Nt=H.useMemo(()=>{const Xe={position:i,left:0,top:0};if(!Wt.floating)return Xe;const nt=k3(Wt.floating,O.x),Qt=k3(Wt.floating,O.y);return s?{...Xe,transform:"translate("+nt+"px, "+Qt+"px)",...mz(Wt.floating)>=1.5&&{willChange:"transform"}}:{position:i,left:nt,top:Qt}},[i,s,Wt.floating,O.x,O.y]);return H.useMemo(()=>({...O,update:Jt,refs:Pt,elements:Wt,floatingStyles:Nt}),[O,Jt,Pt,Wt,Nt])}const VZ=e=>{function t(i){return{}.hasOwnProperty.call(i,"current")}return{name:"arrow",options:e,fn(i){const{element:a,padding:d}=typeof e=="function"?e(i):e;return a&&t(a)?a.current!=null?I3({element:a.current,padding:d}).fn(i):{}:a?I3({element:a,padding:d}).fn(i):{}}}},UZ=(e,t)=>({...RZ(e),options:[e,t]}),$Z=(e,t)=>({...jZ(e),options:[e,t]}),GZ=(e,t)=>({...zZ(e),options:[e,t]}),qZ=(e,t)=>({...DZ(e),options:[e,t]}),HZ=(e,t)=>({...LZ(e),options:[e,t]}),WZ=(e,t)=>({...OZ(e),options:[e,t]}),ZZ=(e,t)=>({...VZ(e),options:[e,t]});var YZ="Arrow",gz=H.forwardRef((e,t)=>{const{children:i,width:a=10,height:d=5,...y}=e;return f.jsx(wr.svg,{...y,ref:t,width:a,height:d,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?i:f.jsx("polygon",{points:"0,0 30,0 15,10"})})});gz.displayName=YZ;var XZ=gz;function KZ(e,t=[]){let i=[];function a(y,S){const s=H.createContext(S),N=i.length;i=[...i,S];function D($){const{scope:q,children:J,...re}=$,Q=(q==null?void 0:q[e][N])||s,ce=H.useMemo(()=>re,Object.values(re));return f.jsx(Q.Provider,{value:ce,children:J})}function O($,q){const J=(q==null?void 0:q[e][N])||s,re=H.useContext(J);if(re)return re;if(S!==void 0)return S;throw new Error(`\`${$}\` must be used within \`${y}\``)}return D.displayName=y+"Provider",[D,O]}const d=()=>{const y=i.map(S=>H.createContext(S));return function(s){const N=(s==null?void 0:s[e])||y;return H.useMemo(()=>({[`__scope${e}`]:{...s,[e]:N}}),[s,N])}};return d.scopeName=e,[a,JZ(d,...t)]}function JZ(...e){const t=e[0];if(e.length===1)return t;const i=()=>{const a=e.map(d=>({useScope:d(),scopeName:d.scopeName}));return function(y){const S=a.reduce((s,{useScope:N,scopeName:D})=>{const $=N(y)[`__scope${D}`];return{...s,...$}},{});return H.useMemo(()=>({[`__scope${t.scopeName}`]:S}),[S])}};return i.scopeName=t.scopeName,i}function iP(e){const[t,i]=H.useState(void 0);return ss(()=>{if(e){i({width:e.offsetWidth,height:e.offsetHeight});const a=new ResizeObserver(d=>{if(!Array.isArray(d)||!d.length)return;const y=d[0];let S,s;if("borderBoxSize"in y){const N=y.borderBoxSize,D=Array.isArray(N)?N[0]:N;S=D.inlineSize,s=D.blockSize}else S=e.offsetWidth,s=e.offsetHeight;i({width:S,height:s})});return a.observe(e,{box:"border-box"}),()=>a.unobserve(e)}else i(void 0)},[e]),t}var sP="Popper",[_z,gh]=KZ(sP),[QZ,yz]=_z(sP),xz=e=>{const{__scopePopper:t,children:i}=e,[a,d]=H.useState(null);return f.jsx(QZ,{scope:t,anchor:a,onAnchorChange:d,children:i})};xz.displayName=sP;var vz="PopperAnchor",bz=H.forwardRef((e,t)=>{const{__scopePopper:i,virtualRef:a,...d}=e,y=yz(vz,i),S=H.useRef(null),s=dn(t,S);return H.useEffect(()=>{y.onAnchorChange((a==null?void 0:a.current)||S.current)}),a?null:f.jsx(wr.div,{...d,ref:s})});bz.displayName=vz;var oP="PopperContent",[eY,tY]=_z(oP),wz=H.forwardRef((e,t)=>{var qt,Br,xn,de,bn,pn;const{__scopePopper:i,side:a="bottom",sideOffset:d=0,align:y="center",alignOffset:S=0,arrowPadding:s=0,avoidCollisions:N=!0,collisionBoundary:D=[],collisionPadding:O=0,sticky:$="partial",hideWhenDetached:q=!1,updatePositionStrategy:J="optimized",onPlaced:re,...Q}=e,ce=yz(oP,i),[le,ae]=H.useState(null),he=dn(t,hi=>ae(hi)),[Se,je]=H.useState(null),it=iP(Se),qe=(it==null?void 0:it.width)??0,ct=(it==null?void 0:it.height)??0,pt=a+(y!=="center"?"-"+y:""),Ze=typeof O=="number"?O:{top:0,right:0,bottom:0,left:0,...O},yt=Array.isArray(D)?D:[D],Mt=yt.length>0,Jt={padding:Ze,boundary:yt.filter(nY),altBoundary:Mt},{refs:jt,floatingStyles:Pt,placement:Wt,isPositioned:Nt,middlewareData:Xe}=BZ({strategy:"fixed",placement:pt,whileElementsMounted:(...hi)=>NZ(...hi,{animationFrame:J==="always"}),elements:{reference:ce.anchor},middleware:[UZ({mainAxis:d+ct,alignmentAxis:S}),N&&$Z({mainAxis:!0,crossAxis:!1,limiter:$==="partial"?GZ():void 0,...Jt}),N&&qZ({...Jt}),HZ({...Jt,apply:({elements:hi,rects:bt,availableWidth:Vi,availableHeight:ni})=>{const{width:os,height:Be}=bt.reference,ut=hi.floating.style;ut.setProperty("--radix-popper-available-width",`${Vi}px`),ut.setProperty("--radix-popper-available-height",`${ni}px`),ut.setProperty("--radix-popper-anchor-width",`${os}px`),ut.setProperty("--radix-popper-anchor-height",`${Be}px`)}}),Se&&ZZ({element:Se,padding:s}),iY({arrowWidth:qe,arrowHeight:ct}),q&&WZ({strategy:"referenceHidden",...Jt})]}),[nt,Qt]=Ez(Wt),rr=oi(re);ss(()=>{Nt&&(rr==null||rr())},[Nt,rr]);const mr=(qt=Xe.arrow)==null?void 0:qt.x,Ut=(Br=Xe.arrow)==null?void 0:Br.y,hn=((xn=Xe.arrow)==null?void 0:xn.centerOffset)!==0,[Gn,At]=H.useState();return ss(()=>{le&&At(window.getComputedStyle(le).zIndex)},[le]),f.jsx("div",{ref:jt.setFloating,"data-radix-popper-content-wrapper":"",style:{...Pt,transform:Nt?Pt.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Gn,"--radix-popper-transform-origin":[(de=Xe.transformOrigin)==null?void 0:de.x,(bn=Xe.transformOrigin)==null?void 0:bn.y].join(" "),...((pn=Xe.hide)==null?void 0:pn.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:f.jsx(eY,{scope:i,placedSide:nt,onArrowChange:je,arrowX:mr,arrowY:Ut,shouldHideArrow:hn,children:f.jsx(wr.div,{"data-side":nt,"data-align":Qt,...Q,ref:he,style:{...Q.style,animation:Nt?void 0:"none"}})})})});wz.displayName=oP;var Sz="PopperArrow",rY={top:"bottom",right:"left",bottom:"top",left:"right"},Tz=H.forwardRef(function(t,i){const{__scopePopper:a,...d}=t,y=tY(Sz,a),S=rY[y.placedSide];return f.jsx("span",{ref:y.onArrowChange,style:{position:"absolute",left:y.arrowX,top:y.arrowY,[S]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[y.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[y.placedSide],visibility:y.shouldHideArrow?"hidden":void 0},children:f.jsx(XZ,{...d,ref:i,style:{...d.style,display:"block"}})})});Tz.displayName=Sz;function nY(e){return e!==null}var iY=e=>({name:"transformOrigin",options:e,fn(t){var ce,le,ae;const{placement:i,rects:a,middlewareData:d}=t,S=((ce=d.arrow)==null?void 0:ce.centerOffset)!==0,s=S?0:e.arrowWidth,N=S?0:e.arrowHeight,[D,O]=Ez(i),$={start:"0%",center:"50%",end:"100%"}[O],q=(((le=d.arrow)==null?void 0:le.x)??0)+s/2,J=(((ae=d.arrow)==null?void 0:ae.y)??0)+N/2;let re="",Q="";return D==="bottom"?(re=S?$:`${q}px`,Q=`${-N}px`):D==="top"?(re=S?$:`${q}px`,Q=`${a.floating.height+N}px`):D==="right"?(re=`${-N}px`,Q=S?$:`${J}px`):D==="left"&&(re=`${a.floating.width+N}px`,Q=S?$:`${J}px`),{data:{x:re,y:Q}}}});function Ez(e){const[t,i="center"]=e.split("-");return[t,i]}var aP=xz,Vv=bz,y2=wz,x2=Tz,[v2,pce]=ta("Tooltip",[gh]),lP=gh(),Cz="TooltipProvider",sY=700,N3="tooltip.open",[oY,Mz]=v2(Cz),Az=e=>{const{__scopeTooltip:t,delayDuration:i=sY,skipDelayDuration:a=300,disableHoverableContent:d=!1,children:y}=e,[S,s]=H.useState(!0),N=H.useRef(!1),D=H.useRef(0);return H.useEffect(()=>{const O=D.current;return()=>window.clearTimeout(O)},[]),f.jsx(oY,{scope:t,isOpenDelayed:S,delayDuration:i,onOpen:H.useCallback(()=>{window.clearTimeout(D.current),s(!1)},[]),onClose:H.useCallback(()=>{window.clearTimeout(D.current),D.current=window.setTimeout(()=>s(!0),a)},[a]),isPointerInTransitRef:N,onPointerInTransitChange:H.useCallback(O=>{N.current=O},[]),disableHoverableContent:d,children:y})};Az.displayName=Cz;var Pz="Tooltip",[mce,b2]=v2(Pz),dM="TooltipTrigger",aY=H.forwardRef((e,t)=>{const{__scopeTooltip:i,...a}=e,d=b2(dM,i),y=Mz(dM,i),S=lP(i),s=H.useRef(null),N=dn(t,s,d.onTriggerChange),D=H.useRef(!1),O=H.useRef(!1),$=H.useCallback(()=>D.current=!1,[]);return H.useEffect(()=>()=>document.removeEventListener("pointerup",$),[$]),f.jsx(Vv,{asChild:!0,...S,children:f.jsx(wr.button,{"aria-describedby":d.open?d.contentId:void 0,"data-state":d.stateAttribute,...a,ref:N,onPointerMove:Ht(e.onPointerMove,q=>{q.pointerType!=="touch"&&!O.current&&!y.isPointerInTransitRef.current&&(d.onTriggerEnter(),O.current=!0)}),onPointerLeave:Ht(e.onPointerLeave,()=>{d.onTriggerLeave(),O.current=!1}),onPointerDown:Ht(e.onPointerDown,()=>{D.current=!0,document.addEventListener("pointerup",$,{once:!0})}),onFocus:Ht(e.onFocus,()=>{D.current||d.onOpen()}),onBlur:Ht(e.onBlur,d.onClose),onClick:Ht(e.onClick,d.onClose)})})});aY.displayName=dM;var lY="TooltipPortal",[gce,cY]=v2(lY,{forceMount:void 0}),wg="TooltipContent",Iz=H.forwardRef((e,t)=>{const i=cY(wg,e.__scopeTooltip),{forceMount:a=i.forceMount,side:d="top",...y}=e,S=b2(wg,e.__scopeTooltip);return f.jsx(Yi,{present:a||S.open,children:S.disableHoverableContent?f.jsx(kz,{side:d,...y,ref:t}):f.jsx(uY,{side:d,...y,ref:t})})}),uY=H.forwardRef((e,t)=>{const i=b2(wg,e.__scopeTooltip),a=Mz(wg,e.__scopeTooltip),d=H.useRef(null),y=dn(t,d),[S,s]=H.useState(null),{trigger:N,onClose:D}=i,O=d.current,{onPointerInTransitChange:$}=a,q=H.useCallback(()=>{s(null),$(!1)},[$]),J=H.useCallback((re,Q)=>{const ce=re.currentTarget,le={x:re.clientX,y:re.clientY},ae=pY(le,ce.getBoundingClientRect()),he=mY(le,ae),Se=gY(Q.getBoundingClientRect()),je=yY([...he,...Se]);s(je),$(!0)},[$]);return H.useEffect(()=>()=>q(),[q]),H.useEffect(()=>{if(N&&O){const re=ce=>J(ce,O),Q=ce=>J(ce,N);return N.addEventListener("pointerleave",re),O.addEventListener("pointerleave",Q),()=>{N.removeEventListener("pointerleave",re),O.removeEventListener("pointerleave",Q)}}},[N,O,J,q]),H.useEffect(()=>{if(S){const re=Q=>{const ce=Q.target,le={x:Q.clientX,y:Q.clientY},ae=(N==null?void 0:N.contains(ce))||(O==null?void 0:O.contains(ce)),he=!_Y(le,S);ae?q():he&&(q(),D())};return document.addEventListener("pointermove",re),()=>document.removeEventListener("pointermove",re)}},[N,O,S,D,q]),f.jsx(kz,{...e,ref:y})}),[dY,hY]=v2(Pz,{isInside:!1}),kz=H.forwardRef((e,t)=>{const{__scopeTooltip:i,children:a,"aria-label":d,onEscapeKeyDown:y,onPointerDownOutside:S,...s}=e,N=b2(wg,i),D=lP(i),{onClose:O}=N;return H.useEffect(()=>(document.addEventListener(N3,O),()=>document.removeEventListener(N3,O)),[O]),H.useEffect(()=>{if(N.trigger){const $=q=>{const J=q.target;J!=null&&J.contains(N.trigger)&&O()};return window.addEventListener("scroll",$,{capture:!0}),()=>window.removeEventListener("scroll",$,{capture:!0})}},[N.trigger,O]),f.jsx(mh,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:y,onPointerDownOutside:S,onFocusOutside:$=>$.preventDefault(),onDismiss:O,children:f.jsxs(y2,{"data-state":N.stateAttribute,...D,...s,ref:t,style:{...s.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[f.jsx(_4,{children:a}),f.jsx(dY,{scope:i,isInside:!0,children:f.jsx(b4,{id:N.contentId,role:"tooltip",children:d||a})})]})})});Iz.displayName=wg;var Nz="TooltipArrow",fY=H.forwardRef((e,t)=>{const{__scopeTooltip:i,...a}=e,d=lP(i);return hY(Nz,i).isInside?null:f.jsx(x2,{...d,...a,ref:t})});fY.displayName=Nz;function pY(e,t){const i=Math.abs(t.top-e.y),a=Math.abs(t.bottom-e.y),d=Math.abs(t.right-e.x),y=Math.abs(t.left-e.x);switch(Math.min(i,a,d,y)){case y:return"left";case d:return"right";case i:return"top";case a:return"bottom";default:throw new Error("unreachable")}}function mY(e,t,i=5){const a=[];switch(t){case"top":a.push({x:e.x-i,y:e.y+i},{x:e.x+i,y:e.y+i});break;case"bottom":a.push({x:e.x-i,y:e.y-i},{x:e.x+i,y:e.y-i});break;case"left":a.push({x:e.x+i,y:e.y-i},{x:e.x+i,y:e.y+i});break;case"right":a.push({x:e.x-i,y:e.y-i},{x:e.x-i,y:e.y+i});break}return a}function gY(e){const{top:t,right:i,bottom:a,left:d}=e;return[{x:d,y:t},{x:i,y:t},{x:i,y:a},{x:d,y:a}]}function _Y(e,t){const{x:i,y:a}=e;let d=!1;for(let y=0,S=t.length-1;y<t.length;S=y++){const s=t[y].x,N=t[y].y,D=t[S].x,O=t[S].y;N>a!=O>a&&i<(D-s)*(a-N)/(O-N)+s&&(d=!d)}return d}function yY(e){const t=e.slice();return t.sort((i,a)=>i.x<a.x?-1:i.x>a.x?1:i.y<a.y?-1:i.y>a.y?1:0),xY(t)}function xY(e){if(e.length<=1)return e.slice();const t=[];for(let a=0;a<e.length;a++){const d=e[a];for(;t.length>=2;){const y=t[t.length-1],S=t[t.length-2];if((y.x-S.x)*(d.y-S.y)>=(y.y-S.y)*(d.x-S.x))t.pop();else break}t.push(d)}t.pop();const i=[];for(let a=e.length-1;a>=0;a--){const d=e[a];for(;i.length>=2;){const y=i[i.length-1],S=i[i.length-2];if((y.x-S.x)*(d.y-S.y)>=(y.y-S.y)*(d.x-S.x))i.pop();else break}i.push(d)}return i.pop(),t.length===1&&i.length===1&&t[0].x===i[0].x&&t[0].y===i[0].y?t:t.concat(i)}var vY=Az,Rz=Iz;const bY=vY,wY=H.forwardRef(({className:e,sideOffset:t=4,...i},a)=>f.jsx(Rz,{ref:a,sideOffset:t,className:br("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...i}));wY.displayName=Rz.displayName;var w2=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},S2=typeof window>"u"||"Deno"in globalThis;function El(){}function SY(e,t){return typeof e=="function"?e(t):e}function TY(e){return typeof e=="number"&&e>=0&&e!==1/0}function EY(e,t){return Math.max(e+(t||0)-Date.now(),0)}function R3(e,t){return typeof e=="function"?e(t):e}function CY(e,t){return typeof e=="function"?e(t):e}function j3(e,t){const{type:i="all",exact:a,fetchStatus:d,predicate:y,queryKey:S,stale:s}=e;if(S){if(a){if(t.queryHash!==cP(S,t.options))return!1}else if(!ov(t.queryKey,S))return!1}if(i!=="all"){const N=t.isActive();if(i==="active"&&!N||i==="inactive"&&N)return!1}return!(typeof s=="boolean"&&t.isStale()!==s||d&&d!==t.state.fetchStatus||y&&!y(t))}function D3(e,t){const{exact:i,status:a,predicate:d,mutationKey:y}=e;if(y){if(!t.options.mutationKey)return!1;if(i){if(sv(t.options.mutationKey)!==sv(y))return!1}else if(!ov(t.options.mutationKey,y))return!1}return!(a&&t.state.status!==a||d&&!d(t))}function cP(e,t){return((t==null?void 0:t.queryKeyHashFn)||sv)(e)}function sv(e){return JSON.stringify(e,(t,i)=>hM(i)?Object.keys(i).sort().reduce((a,d)=>(a[d]=i[d],a),{}):i)}function ov(e,t){return e===t?!0:typeof e!=typeof t?!1:e&&t&&typeof e=="object"&&typeof t=="object"?!Object.keys(t).some(i=>!ov(e[i],t[i])):!1}function jz(e,t){if(e===t)return e;const i=L3(e)&&L3(t);if(i||hM(e)&&hM(t)){const a=i?e:Object.keys(e),d=a.length,y=i?t:Object.keys(t),S=y.length,s=i?[]:{};let N=0;for(let D=0;D<S;D++){const O=i?D:y[D];(!i&&a.includes(O)||i)&&e[O]===void 0&&t[O]===void 0?(s[O]=void 0,N++):(s[O]=jz(e[O],t[O]),s[O]===e[O]&&e[O]!==void 0&&N++)}return d===S&&N===d?e:s}return t}function L3(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function hM(e){if(!O3(e))return!1;const t=e.constructor;if(t===void 0)return!0;const i=t.prototype;return!(!O3(i)||!i.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(e)!==Object.prototype)}function O3(e){return Object.prototype.toString.call(e)==="[object Object]"}function MY(e){return new Promise(t=>{setTimeout(t,e)})}function AY(e,t,i){return typeof i.structuralSharing=="function"?i.structuralSharing(e,t):i.structuralSharing!==!1?jz(e,t):t}function PY(e,t,i=0){const a=[...e,t];return i&&a.length>i?a.slice(1):a}function IY(e,t,i=0){const a=[t,...e];return i&&a.length>i?a.slice(0,-1):a}var uP=Symbol();function Dz(e,t){return!e.queryFn&&(t!=null&&t.initialPromise)?()=>t.initialPromise:!e.queryFn||e.queryFn===uP?()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`)):e.queryFn}var Mf,Dd,ng,YD,kY=(YD=class extends w2{constructor(){super();ci(this,Mf);ci(this,Dd);ci(this,ng);An(this,ng,t=>{if(!S2&&window.addEventListener){const i=()=>t();return window.addEventListener("visibilitychange",i,!1),()=>{window.removeEventListener("visibilitychange",i)}}})}onSubscribe(){$t(this,Dd)||this.setEventListener($t(this,ng))}onUnsubscribe(){var t;this.hasListeners()||((t=$t(this,Dd))==null||t.call(this),An(this,Dd,void 0))}setEventListener(t){var i;An(this,ng,t),(i=$t(this,Dd))==null||i.call(this),An(this,Dd,t(a=>{typeof a=="boolean"?this.setFocused(a):this.onFocus()}))}setFocused(t){$t(this,Mf)!==t&&(An(this,Mf,t),this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(i=>{i(t)})}isFocused(){var t;return typeof $t(this,Mf)=="boolean"?$t(this,Mf):((t=globalThis.document)==null?void 0:t.visibilityState)!=="hidden"}},Mf=new WeakMap,Dd=new WeakMap,ng=new WeakMap,YD),Lz=new kY,ig,Ld,sg,XD,NY=(XD=class extends w2{constructor(){super();ci(this,ig,!0);ci(this,Ld);ci(this,sg);An(this,sg,t=>{if(!S2&&window.addEventListener){const i=()=>t(!0),a=()=>t(!1);return window.addEventListener("online",i,!1),window.addEventListener("offline",a,!1),()=>{window.removeEventListener("online",i),window.removeEventListener("offline",a)}}})}onSubscribe(){$t(this,Ld)||this.setEventListener($t(this,sg))}onUnsubscribe(){var t;this.hasListeners()||((t=$t(this,Ld))==null||t.call(this),An(this,Ld,void 0))}setEventListener(t){var i;An(this,sg,t),(i=$t(this,Ld))==null||i.call(this),An(this,Ld,t(this.setOnline.bind(this)))}setOnline(t){$t(this,ig)!==t&&(An(this,ig,t),this.listeners.forEach(a=>{a(t)}))}isOnline(){return $t(this,ig)}},ig=new WeakMap,Ld=new WeakMap,sg=new WeakMap,XD),Sw=new NY;function RY(){let e,t;const i=new Promise((d,y)=>{e=d,t=y});i.status="pending",i.catch(()=>{});function a(d){Object.assign(i,d),delete i.resolve,delete i.reject}return i.resolve=d=>{a({status:"fulfilled",value:d}),e(d)},i.reject=d=>{a({status:"rejected",reason:d}),t(d)},i}function jY(e){return Math.min(1e3*2**e,3e4)}function Oz(e){return(e??"online")==="online"?Sw.isOnline():!0}var zz=class extends Error{constructor(e){super("CancelledError"),this.revert=e==null?void 0:e.revert,this.silent=e==null?void 0:e.silent}};function RE(e){return e instanceof zz}function Fz(e){let t=!1,i=0,a=!1,d;const y=RY(),S=Q=>{var ce;a||(q(new zz(Q)),(ce=e.abort)==null||ce.call(e))},s=()=>{t=!0},N=()=>{t=!1},D=()=>Lz.isFocused()&&(e.networkMode==="always"||Sw.isOnline())&&e.canRun(),O=()=>Oz(e.networkMode)&&e.canRun(),$=Q=>{var ce;a||(a=!0,(ce=e.onSuccess)==null||ce.call(e,Q),d==null||d(),y.resolve(Q))},q=Q=>{var ce;a||(a=!0,(ce=e.onError)==null||ce.call(e,Q),d==null||d(),y.reject(Q))},J=()=>new Promise(Q=>{var ce;d=le=>{(a||D())&&Q(le)},(ce=e.onPause)==null||ce.call(e)}).then(()=>{var Q;d=void 0,a||(Q=e.onContinue)==null||Q.call(e)}),re=()=>{if(a)return;let Q;const ce=i===0?e.initialPromise:void 0;try{Q=ce??e.fn()}catch(le){Q=Promise.reject(le)}Promise.resolve(Q).then($).catch(le=>{var it;if(a)return;const ae=e.retry??(S2?0:3),he=e.retryDelay??jY,Se=typeof he=="function"?he(i,le):he,je=ae===!0||typeof ae=="number"&&i<ae||typeof ae=="function"&&ae(i,le);if(t||!je){q(le);return}i++,(it=e.onFail)==null||it.call(e,i,le),MY(Se).then(()=>D()?void 0:J()).then(()=>{t?q(le):re()})})};return{promise:y,cancel:S,continue:()=>(d==null||d(),y),cancelRetry:s,continueRetry:N,canStart:O,start:()=>(O()?re():J().then(re),y)}}function DY(){let e=[],t=0,i=s=>{s()},a=s=>{s()},d=s=>setTimeout(s,0);const y=s=>{t?e.push(s):d(()=>{i(s)})},S=()=>{const s=e;e=[],s.length&&d(()=>{a(()=>{s.forEach(N=>{i(N)})})})};return{batch:s=>{let N;t++;try{N=s()}finally{t--,t||S()}return N},batchCalls:s=>(...N)=>{y(()=>{s(...N)})},schedule:y,setNotifyFunction:s=>{i=s},setBatchNotifyFunction:s=>{a=s},setScheduler:s=>{d=s}}}var Eo=DY(),Af,KD,Bz=(KD=class{constructor(){ci(this,Af)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),TY(this.gcTime)&&An(this,Af,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(S2?1/0:5*60*1e3))}clearGcTimeout(){$t(this,Af)&&(clearTimeout($t(this,Af)),An(this,Af,void 0))}},Af=new WeakMap,KD),og,ag,Va,io,Iv,Pf,Cl,Kc,JD,LY=(JD=class extends Bz{constructor(t){super();ci(this,Cl);ci(this,og);ci(this,ag);ci(this,Va);ci(this,io);ci(this,Iv);ci(this,Pf);An(this,Pf,!1),An(this,Iv,t.defaultOptions),this.setOptions(t.options),this.observers=[],An(this,Va,t.cache),this.queryKey=t.queryKey,this.queryHash=t.queryHash,An(this,og,zY(this.options)),this.state=t.state??$t(this,og),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var t;return(t=$t(this,io))==null?void 0:t.promise}setOptions(t){this.options={...$t(this,Iv),...t},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&$t(this,Va).remove(this)}setData(t,i){const a=AY(this.state.data,t,this.options);return to(this,Cl,Kc).call(this,{data:a,type:"success",dataUpdatedAt:i==null?void 0:i.updatedAt,manual:i==null?void 0:i.manual}),a}setState(t,i){to(this,Cl,Kc).call(this,{type:"setState",state:t,setStateOptions:i})}cancel(t){var a,d;const i=(a=$t(this,io))==null?void 0:a.promise;return(d=$t(this,io))==null||d.cancel(t),i?i.then(El).catch(El):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState($t(this,og))}isActive(){return this.observers.some(t=>CY(t.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===uP||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStale(){return this.state.isInvalidated?!0:this.getObserversCount()>0?this.observers.some(t=>t.getCurrentResult().isStale):this.state.data===void 0}isStaleByTime(t=0){return this.state.isInvalidated||this.state.data===void 0||!EY(this.state.dataUpdatedAt,t)}onFocus(){var i;const t=this.observers.find(a=>a.shouldFetchOnWindowFocus());t==null||t.refetch({cancelRefetch:!1}),(i=$t(this,io))==null||i.continue()}onOnline(){var i;const t=this.observers.find(a=>a.shouldFetchOnReconnect());t==null||t.refetch({cancelRefetch:!1}),(i=$t(this,io))==null||i.continue()}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),$t(this,Va).notify({type:"observerAdded",query:this,observer:t}))}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter(i=>i!==t),this.observers.length||($t(this,io)&&($t(this,Pf)?$t(this,io).cancel({revert:!0}):$t(this,io).cancelRetry()),this.scheduleGc()),$t(this,Va).notify({type:"observerRemoved",query:this,observer:t}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||to(this,Cl,Kc).call(this,{type:"invalidate"})}fetch(t,i){var N,D,O;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(i!=null&&i.cancelRefetch))this.cancel({silent:!0});else if($t(this,io))return $t(this,io).continueRetry(),$t(this,io).promise}if(t&&this.setOptions(t),!this.options.queryFn){const $=this.observers.find(q=>q.options.queryFn);$&&this.setOptions($.options)}const a=new AbortController,d=$=>{Object.defineProperty($,"signal",{enumerable:!0,get:()=>(An(this,Pf,!0),a.signal)})},y=()=>{const $=Dz(this.options,i),q={queryKey:this.queryKey,meta:this.meta};return d(q),An(this,Pf,!1),this.options.persister?this.options.persister($,q,this):$(q)},S={fetchOptions:i,options:this.options,queryKey:this.queryKey,state:this.state,fetchFn:y};d(S),(N=this.options.behavior)==null||N.onFetch(S,this),An(this,ag,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((D=S.fetchOptions)==null?void 0:D.meta))&&to(this,Cl,Kc).call(this,{type:"fetch",meta:(O=S.fetchOptions)==null?void 0:O.meta});const s=$=>{var q,J,re,Q;RE($)&&$.silent||to(this,Cl,Kc).call(this,{type:"error",error:$}),RE($)||((J=(q=$t(this,Va).config).onError)==null||J.call(q,$,this),(Q=(re=$t(this,Va).config).onSettled)==null||Q.call(re,this.state.data,$,this)),this.scheduleGc()};return An(this,io,Fz({initialPromise:i==null?void 0:i.initialPromise,fn:S.fetchFn,abort:a.abort.bind(a),onSuccess:$=>{var q,J,re,Q;if($===void 0){s(new Error(`${this.queryHash} data is undefined`));return}try{this.setData($)}catch(ce){s(ce);return}(J=(q=$t(this,Va).config).onSuccess)==null||J.call(q,$,this),(Q=(re=$t(this,Va).config).onSettled)==null||Q.call(re,$,this.state.error,this),this.scheduleGc()},onError:s,onFail:($,q)=>{to(this,Cl,Kc).call(this,{type:"failed",failureCount:$,error:q})},onPause:()=>{to(this,Cl,Kc).call(this,{type:"pause"})},onContinue:()=>{to(this,Cl,Kc).call(this,{type:"continue"})},retry:S.options.retry,retryDelay:S.options.retryDelay,networkMode:S.options.networkMode,canRun:()=>!0})),$t(this,io).start()}},og=new WeakMap,ag=new WeakMap,Va=new WeakMap,io=new WeakMap,Iv=new WeakMap,Pf=new WeakMap,Cl=new WeakSet,Kc=function(t){const i=a=>{switch(t.type){case"failed":return{...a,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case"pause":return{...a,fetchStatus:"paused"};case"continue":return{...a,fetchStatus:"fetching"};case"fetch":return{...a,...OY(a.data,this.options),fetchMeta:t.meta??null};case"success":return{...a,data:t.data,dataUpdateCount:a.dataUpdateCount+1,dataUpdatedAt:t.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const d=t.error;return RE(d)&&d.revert&&$t(this,ag)?{...$t(this,ag),fetchStatus:"idle"}:{...a,error:d,errorUpdateCount:a.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:a.fetchFailureCount+1,fetchFailureReason:d,fetchStatus:"idle",status:"error"};case"invalidate":return{...a,isInvalidated:!0};case"setState":return{...a,...t.state}}};this.state=i(this.state),Eo.batch(()=>{this.observers.forEach(a=>{a.onQueryUpdate()}),$t(this,Va).notify({query:this,type:"updated",action:t})})},JD);function OY(e,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:Oz(t.networkMode)?"fetching":"paused",...e===void 0&&{error:null,status:"pending"}}}function zY(e){const t=typeof e.initialData=="function"?e.initialData():e.initialData,i=t!==void 0,a=i?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:i?a??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:i?"success":"pending",fetchStatus:"idle"}}var hc,QD,FY=(QD=class extends w2{constructor(t={}){super();ci(this,hc);this.config=t,An(this,hc,new Map)}build(t,i,a){const d=i.queryKey,y=i.queryHash??cP(d,i);let S=this.get(y);return S||(S=new LY({cache:this,queryKey:d,queryHash:y,options:t.defaultQueryOptions(i),state:a,defaultOptions:t.getQueryDefaults(d)}),this.add(S)),S}add(t){$t(this,hc).has(t.queryHash)||($t(this,hc).set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const i=$t(this,hc).get(t.queryHash);i&&(t.destroy(),i===t&&$t(this,hc).delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){Eo.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return $t(this,hc).get(t)}getAll(){return[...$t(this,hc).values()]}find(t){const i={exact:!0,...t};return this.getAll().find(a=>j3(i,a))}findAll(t={}){const i=this.getAll();return Object.keys(t).length>0?i.filter(a=>j3(t,a)):i}notify(t){Eo.batch(()=>{this.listeners.forEach(i=>{i(t)})})}onFocus(){Eo.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){Eo.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},hc=new WeakMap,QD),fc,bo,If,pc,wd,eL,BY=(eL=class extends Bz{constructor(t){super();ci(this,pc);ci(this,fc);ci(this,bo);ci(this,If);this.mutationId=t.mutationId,An(this,bo,t.mutationCache),An(this,fc,[]),this.state=t.state||VY(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){$t(this,fc).includes(t)||($t(this,fc).push(t),this.clearGcTimeout(),$t(this,bo).notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){An(this,fc,$t(this,fc).filter(i=>i!==t)),this.scheduleGc(),$t(this,bo).notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){$t(this,fc).length||(this.state.status==="pending"?this.scheduleGc():$t(this,bo).remove(this))}continue(){var t;return((t=$t(this,If))==null?void 0:t.continue())??this.execute(this.state.variables)}async execute(t){var d,y,S,s,N,D,O,$,q,J,re,Q,ce,le,ae,he,Se,je,it,qe;An(this,If,Fz({fn:()=>this.options.mutationFn?this.options.mutationFn(t):Promise.reject(new Error("No mutationFn found")),onFail:(ct,pt)=>{to(this,pc,wd).call(this,{type:"failed",failureCount:ct,error:pt})},onPause:()=>{to(this,pc,wd).call(this,{type:"pause"})},onContinue:()=>{to(this,pc,wd).call(this,{type:"continue"})},retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>$t(this,bo).canRun(this)}));const i=this.state.status==="pending",a=!$t(this,If).canStart();try{if(!i){to(this,pc,wd).call(this,{type:"pending",variables:t,isPaused:a}),await((y=(d=$t(this,bo).config).onMutate)==null?void 0:y.call(d,t,this));const pt=await((s=(S=this.options).onMutate)==null?void 0:s.call(S,t));pt!==this.state.context&&to(this,pc,wd).call(this,{type:"pending",context:pt,variables:t,isPaused:a})}const ct=await $t(this,If).start();return await((D=(N=$t(this,bo).config).onSuccess)==null?void 0:D.call(N,ct,t,this.state.context,this)),await(($=(O=this.options).onSuccess)==null?void 0:$.call(O,ct,t,this.state.context)),await((J=(q=$t(this,bo).config).onSettled)==null?void 0:J.call(q,ct,null,this.state.variables,this.state.context,this)),await((Q=(re=this.options).onSettled)==null?void 0:Q.call(re,ct,null,t,this.state.context)),to(this,pc,wd).call(this,{type:"success",data:ct}),ct}catch(ct){try{throw await((le=(ce=$t(this,bo).config).onError)==null?void 0:le.call(ce,ct,t,this.state.context,this)),await((he=(ae=this.options).onError)==null?void 0:he.call(ae,ct,t,this.state.context)),await((je=(Se=$t(this,bo).config).onSettled)==null?void 0:je.call(Se,void 0,ct,this.state.variables,this.state.context,this)),await((qe=(it=this.options).onSettled)==null?void 0:qe.call(it,void 0,ct,t,this.state.context)),ct}finally{to(this,pc,wd).call(this,{type:"error",error:ct})}}finally{$t(this,bo).runNext(this)}}},fc=new WeakMap,bo=new WeakMap,If=new WeakMap,pc=new WeakSet,wd=function(t){const i=a=>{switch(t.type){case"failed":return{...a,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...a,isPaused:!0};case"continue":return{...a,isPaused:!1};case"pending":return{...a,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...a,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...a,data:void 0,error:t.error,failureCount:a.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}};this.state=i(this.state),Eo.batch(()=>{$t(this,fc).forEach(a=>{a.onMutationUpdate(t)}),$t(this,bo).notify({mutation:this,type:"updated",action:t})})},eL);function VY(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var ma,kv,tL,UY=(tL=class extends w2{constructor(t={}){super();ci(this,ma);ci(this,kv);this.config=t,An(this,ma,new Map),An(this,kv,Date.now())}build(t,i,a){const d=new BY({mutationCache:this,mutationId:++q1(this,kv)._,options:t.defaultMutationOptions(i),state:a});return this.add(d),d}add(t){const i=fb(t),a=$t(this,ma).get(i)??[];a.push(t),$t(this,ma).set(i,a),this.notify({type:"added",mutation:t})}remove(t){var a;const i=fb(t);if($t(this,ma).has(i)){const d=(a=$t(this,ma).get(i))==null?void 0:a.filter(y=>y!==t);d&&(d.length===0?$t(this,ma).delete(i):$t(this,ma).set(i,d))}this.notify({type:"removed",mutation:t})}canRun(t){var a;const i=(a=$t(this,ma).get(fb(t)))==null?void 0:a.find(d=>d.state.status==="pending");return!i||i===t}runNext(t){var a;const i=(a=$t(this,ma).get(fb(t)))==null?void 0:a.find(d=>d!==t&&d.state.isPaused);return(i==null?void 0:i.continue())??Promise.resolve()}clear(){Eo.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}getAll(){return[...$t(this,ma).values()].flat()}find(t){const i={exact:!0,...t};return this.getAll().find(a=>D3(i,a))}findAll(t={}){return this.getAll().filter(i=>D3(t,i))}notify(t){Eo.batch(()=>{this.listeners.forEach(i=>{i(t)})})}resumePausedMutations(){const t=this.getAll().filter(i=>i.state.isPaused);return Eo.batch(()=>Promise.all(t.map(i=>i.continue().catch(El))))}},ma=new WeakMap,kv=new WeakMap,tL);function fb(e){var t;return((t=e.options.scope)==null?void 0:t.id)??String(e.mutationId)}function z3(e){return{onFetch:(t,i)=>{var O,$,q,J,re;const a=t.options,d=(q=($=(O=t.fetchOptions)==null?void 0:O.meta)==null?void 0:$.fetchMore)==null?void 0:q.direction,y=((J=t.state.data)==null?void 0:J.pages)||[],S=((re=t.state.data)==null?void 0:re.pageParams)||[];let s={pages:[],pageParams:[]},N=0;const D=async()=>{let Q=!1;const ce=he=>{Object.defineProperty(he,"signal",{enumerable:!0,get:()=>(t.signal.aborted?Q=!0:t.signal.addEventListener("abort",()=>{Q=!0}),t.signal)})},le=Dz(t.options,t.fetchOptions),ae=async(he,Se,je)=>{if(Q)return Promise.reject();if(Se==null&&he.pages.length)return Promise.resolve(he);const it={queryKey:t.queryKey,pageParam:Se,direction:je?"backward":"forward",meta:t.options.meta};ce(it);const qe=await le(it),{maxPages:ct}=t.options,pt=je?IY:PY;return{pages:pt(he.pages,qe,ct),pageParams:pt(he.pageParams,Se,ct)}};if(d&&y.length){const he=d==="backward",Se=he?$Y:F3,je={pages:y,pageParams:S},it=Se(a,je);s=await ae(je,it,he)}else{const he=e??y.length;do{const Se=N===0?S[0]??a.initialPageParam:F3(a,s);if(N>0&&Se==null)break;s=await ae(s,Se),N++}while(N<he)}return s};t.options.persister?t.fetchFn=()=>{var Q,ce;return(ce=(Q=t.options).persister)==null?void 0:ce.call(Q,D,{queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},i)}:t.fetchFn=D}}}function F3(e,{pages:t,pageParams:i}){const a=t.length-1;return t.length>0?e.getNextPageParam(t[a],t,i[a],i):void 0}function $Y(e,{pages:t,pageParams:i}){var a;return t.length>0?(a=e.getPreviousPageParam)==null?void 0:a.call(e,t[0],t,i[0],i):void 0}var ts,Od,zd,lg,cg,Fd,ug,dg,rL,GY=(rL=class{constructor(e={}){ci(this,ts);ci(this,Od);ci(this,zd);ci(this,lg);ci(this,cg);ci(this,Fd);ci(this,ug);ci(this,dg);An(this,ts,e.queryCache||new FY),An(this,Od,e.mutationCache||new UY),An(this,zd,e.defaultOptions||{}),An(this,lg,new Map),An(this,cg,new Map),An(this,Fd,0)}mount(){q1(this,Fd)._++,$t(this,Fd)===1&&(An(this,ug,Lz.subscribe(async e=>{e&&(await this.resumePausedMutations(),$t(this,ts).onFocus())})),An(this,dg,Sw.subscribe(async e=>{e&&(await this.resumePausedMutations(),$t(this,ts).onOnline())})))}unmount(){var e,t;q1(this,Fd)._--,$t(this,Fd)===0&&((e=$t(this,ug))==null||e.call(this),An(this,ug,void 0),(t=$t(this,dg))==null||t.call(this),An(this,dg,void 0))}isFetching(e){return $t(this,ts).findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return $t(this,Od).findAll({...e,status:"pending"}).length}getQueryData(e){var i;const t=this.defaultQueryOptions({queryKey:e});return(i=$t(this,ts).get(t.queryHash))==null?void 0:i.state.data}ensureQueryData(e){const t=this.getQueryData(e.queryKey);if(t===void 0)return this.fetchQuery(e);{const i=this.defaultQueryOptions(e),a=$t(this,ts).build(this,i);return e.revalidateIfStale&&a.isStaleByTime(R3(i.staleTime,a))&&this.prefetchQuery(i),Promise.resolve(t)}}getQueriesData(e){return $t(this,ts).findAll(e).map(({queryKey:t,state:i})=>{const a=i.data;return[t,a]})}setQueryData(e,t,i){const a=this.defaultQueryOptions({queryKey:e}),d=$t(this,ts).get(a.queryHash),y=d==null?void 0:d.state.data,S=SY(t,y);if(S!==void 0)return $t(this,ts).build(this,a).setData(S,{...i,manual:!0})}setQueriesData(e,t,i){return Eo.batch(()=>$t(this,ts).findAll(e).map(({queryKey:a})=>[a,this.setQueryData(a,t,i)]))}getQueryState(e){var i;const t=this.defaultQueryOptions({queryKey:e});return(i=$t(this,ts).get(t.queryHash))==null?void 0:i.state}removeQueries(e){const t=$t(this,ts);Eo.batch(()=>{t.findAll(e).forEach(i=>{t.remove(i)})})}resetQueries(e,t){const i=$t(this,ts),a={type:"active",...e};return Eo.batch(()=>(i.findAll(e).forEach(d=>{d.reset()}),this.refetchQueries(a,t)))}cancelQueries(e={},t={}){const i={revert:!0,...t},a=Eo.batch(()=>$t(this,ts).findAll(e).map(d=>d.cancel(i)));return Promise.all(a).then(El).catch(El)}invalidateQueries(e={},t={}){return Eo.batch(()=>{if($t(this,ts).findAll(e).forEach(a=>{a.invalidate()}),e.refetchType==="none")return Promise.resolve();const i={...e,type:e.refetchType??e.type??"active"};return this.refetchQueries(i,t)})}refetchQueries(e={},t){const i={...t,cancelRefetch:(t==null?void 0:t.cancelRefetch)??!0},a=Eo.batch(()=>$t(this,ts).findAll(e).filter(d=>!d.isDisabled()).map(d=>{let y=d.fetch(void 0,i);return i.throwOnError||(y=y.catch(El)),d.state.fetchStatus==="paused"?Promise.resolve():y}));return Promise.all(a).then(El)}fetchQuery(e){const t=this.defaultQueryOptions(e);t.retry===void 0&&(t.retry=!1);const i=$t(this,ts).build(this,t);return i.isStaleByTime(R3(t.staleTime,i))?i.fetch(t):Promise.resolve(i.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(El).catch(El)}fetchInfiniteQuery(e){return e.behavior=z3(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(El).catch(El)}ensureInfiniteQueryData(e){return e.behavior=z3(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return Sw.isOnline()?$t(this,Od).resumePausedMutations():Promise.resolve()}getQueryCache(){return $t(this,ts)}getMutationCache(){return $t(this,Od)}getDefaultOptions(){return $t(this,zd)}setDefaultOptions(e){An(this,zd,e)}setQueryDefaults(e,t){$t(this,lg).set(sv(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...$t(this,lg).values()];let i={};return t.forEach(a=>{ov(e,a.queryKey)&&(i={...i,...a.defaultOptions})}),i}setMutationDefaults(e,t){$t(this,cg).set(sv(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...$t(this,cg).values()];let i={};return t.forEach(a=>{ov(e,a.mutationKey)&&(i={...i,...a.defaultOptions})}),i}defaultQueryOptions(e){if(e._defaulted)return e;const t={...$t(this,zd).queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=cP(t.queryKey,t)),t.refetchOnReconnect===void 0&&(t.refetchOnReconnect=t.networkMode!=="always"),t.throwOnError===void 0&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.enabled!==!0&&t.queryFn===uP&&(t.enabled=!1),t}defaultMutationOptions(e){return e!=null&&e._defaulted?e:{...$t(this,zd).mutations,...(e==null?void 0:e.mutationKey)&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){$t(this,ts).clear(),$t(this,Od).clear()}},ts=new WeakMap,Od=new WeakMap,zd=new WeakMap,lg=new WeakMap,cg=new WeakMap,Fd=new WeakMap,ug=new WeakMap,dg=new WeakMap,rL),qY=H.createContext(void 0),HY=({client:e,children:t})=>(H.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),f.jsx(qY.Provider,{value:e,children:t}));/**
 * @remix-run/router v1.20.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function av(){return av=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},av.apply(this,arguments)}var Ud;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(Ud||(Ud={}));const B3="popstate";function WY(e){e===void 0&&(e={});function t(a,d){let{pathname:y,search:S,hash:s}=a.location;return fM("",{pathname:y,search:S,hash:s},d.state&&d.state.usr||null,d.state&&d.state.key||"default")}function i(a,d){return typeof d=="string"?d:Tw(d)}return YY(t,i,null,e)}function Ts(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function Vz(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function ZY(){return Math.random().toString(36).substr(2,8)}function V3(e,t){return{usr:e.state,key:e.key,idx:t}}function fM(e,t,i,a){return i===void 0&&(i=null),av({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?Vg(t):t,{state:i,key:t&&t.key||a||ZY()})}function Tw(e){let{pathname:t="/",search:i="",hash:a=""}=e;return i&&i!=="?"&&(t+=i.charAt(0)==="?"?i:"?"+i),a&&a!=="#"&&(t+=a.charAt(0)==="#"?a:"#"+a),t}function Vg(e){let t={};if(e){let i=e.indexOf("#");i>=0&&(t.hash=e.substr(i),e=e.substr(0,i));let a=e.indexOf("?");a>=0&&(t.search=e.substr(a),e=e.substr(0,a)),e&&(t.pathname=e)}return t}function YY(e,t,i,a){a===void 0&&(a={});let{window:d=document.defaultView,v5Compat:y=!1}=a,S=d.history,s=Ud.Pop,N=null,D=O();D==null&&(D=0,S.replaceState(av({},S.state,{idx:D}),""));function O(){return(S.state||{idx:null}).idx}function $(){s=Ud.Pop;let ce=O(),le=ce==null?null:ce-D;D=ce,N&&N({action:s,location:Q.location,delta:le})}function q(ce,le){s=Ud.Push;let ae=fM(Q.location,ce,le);D=O()+1;let he=V3(ae,D),Se=Q.createHref(ae);try{S.pushState(he,"",Se)}catch(je){if(je instanceof DOMException&&je.name==="DataCloneError")throw je;d.location.assign(Se)}y&&N&&N({action:s,location:Q.location,delta:1})}function J(ce,le){s=Ud.Replace;let ae=fM(Q.location,ce,le);D=O();let he=V3(ae,D),Se=Q.createHref(ae);S.replaceState(he,"",Se),y&&N&&N({action:s,location:Q.location,delta:0})}function re(ce){let le=d.location.origin!=="null"?d.location.origin:d.location.href,ae=typeof ce=="string"?ce:Tw(ce);return ae=ae.replace(/ $/,"%20"),Ts(le,"No window.location.(origin|href) available to create URL for href: "+ae),new URL(ae,le)}let Q={get action(){return s},get location(){return e(d,S)},listen(ce){if(N)throw new Error("A history only accepts one active listener");return d.addEventListener(B3,$),N=ce,()=>{d.removeEventListener(B3,$),N=null}},createHref(ce){return t(d,ce)},createURL:re,encodeLocation(ce){let le=re(ce);return{pathname:le.pathname,search:le.search,hash:le.hash}},push:q,replace:J,go(ce){return S.go(ce)}};return Q}var U3;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(U3||(U3={}));function XY(e,t,i){return i===void 0&&(i="/"),KY(e,t,i,!1)}function KY(e,t,i,a){let d=typeof t=="string"?Vg(t):t,y=dP(d.pathname||"/",i);if(y==null)return null;let S=Uz(e);JY(S);let s=null;for(let N=0;s==null&&N<S.length;++N){let D=cX(y);s=aX(S[N],D,a)}return s}function Uz(e,t,i,a){t===void 0&&(t=[]),i===void 0&&(i=[]),a===void 0&&(a="");let d=(y,S,s)=>{let N={relativePath:s===void 0?y.path||"":s,caseSensitive:y.caseSensitive===!0,childrenIndex:S,route:y};N.relativePath.startsWith("/")&&(Ts(N.relativePath.startsWith(a),'Absolute route path "'+N.relativePath+'" nested under path '+('"'+a+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),N.relativePath=N.relativePath.slice(a.length));let D=Kd([a,N.relativePath]),O=i.concat(N);y.children&&y.children.length>0&&(Ts(y.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+D+'".')),Uz(y.children,t,O,D)),!(y.path==null&&!y.index)&&t.push({path:D,score:sX(D,y.index),routesMeta:O})};return e.forEach((y,S)=>{var s;if(y.path===""||!((s=y.path)!=null&&s.includes("?")))d(y,S);else for(let N of $z(y.path))d(y,S,N)}),t}function $z(e){let t=e.split("/");if(t.length===0)return[];let[i,...a]=t,d=i.endsWith("?"),y=i.replace(/\?$/,"");if(a.length===0)return d?[y,""]:[y];let S=$z(a.join("/")),s=[];return s.push(...S.map(N=>N===""?y:[y,N].join("/"))),d&&s.push(...S),s.map(N=>e.startsWith("/")&&N===""?"/":N)}function JY(e){e.sort((t,i)=>t.score!==i.score?i.score-t.score:oX(t.routesMeta.map(a=>a.childrenIndex),i.routesMeta.map(a=>a.childrenIndex)))}const QY=/^:[\w-]+$/,eX=3,tX=2,rX=1,nX=10,iX=-2,$3=e=>e==="*";function sX(e,t){let i=e.split("/"),a=i.length;return i.some($3)&&(a+=iX),t&&(a+=tX),i.filter(d=>!$3(d)).reduce((d,y)=>d+(QY.test(y)?eX:y===""?rX:nX),a)}function oX(e,t){return e.length===t.length&&e.slice(0,-1).every((a,d)=>a===t[d])?e[e.length-1]-t[t.length-1]:0}function aX(e,t,i){let{routesMeta:a}=e,d={},y="/",S=[];for(let s=0;s<a.length;++s){let N=a[s],D=s===a.length-1,O=y==="/"?t:t.slice(y.length)||"/",$=G3({path:N.relativePath,caseSensitive:N.caseSensitive,end:D},O),q=N.route;if(!$&&D&&i&&!a[a.length-1].route.index&&($=G3({path:N.relativePath,caseSensitive:N.caseSensitive,end:!1},O)),!$)return null;Object.assign(d,$.params),S.push({params:d,pathname:Kd([y,$.pathname]),pathnameBase:fX(Kd([y,$.pathnameBase])),route:q}),$.pathnameBase!=="/"&&(y=Kd([y,$.pathnameBase]))}return S}function G3(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[i,a]=lX(e.path,e.caseSensitive,e.end),d=t.match(i);if(!d)return null;let y=d[0],S=y.replace(/(.)\/+$/,"$1"),s=d.slice(1);return{params:a.reduce((D,O,$)=>{let{paramName:q,isOptional:J}=O;if(q==="*"){let Q=s[$]||"";S=y.slice(0,y.length-Q.length).replace(/(.)\/+$/,"$1")}const re=s[$];return J&&!re?D[q]=void 0:D[q]=(re||"").replace(/%2F/g,"/"),D},{}),pathname:y,pathnameBase:S,pattern:e}}function lX(e,t,i){t===void 0&&(t=!1),i===void 0&&(i=!0),Vz(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let a=[],d="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(S,s,N)=>(a.push({paramName:s,isOptional:N!=null}),N?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(a.push({paramName:"*"}),d+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):i?d+="\\/*$":e!==""&&e!=="/"&&(d+="(?:(?=\\/|$))"),[new RegExp(d,t?void 0:"i"),a]}function cX(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return Vz(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function dP(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let i=t.endsWith("/")?t.length-1:t.length,a=e.charAt(i);return a&&a!=="/"?null:e.slice(i)||"/"}function uX(e,t){t===void 0&&(t="/");let{pathname:i,search:a="",hash:d=""}=typeof e=="string"?Vg(e):e;return{pathname:i?i.startsWith("/")?i:dX(i,t):t,search:pX(a),hash:mX(d)}}function dX(e,t){let i=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(d=>{d===".."?i.length>1&&i.pop():d!=="."&&i.push(d)}),i.length>1?i.join("/"):"/"}function jE(e,t,i,a){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(a)+"].  Please separate it out to the ")+("`to."+i+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function hX(e){return e.filter((t,i)=>i===0||t.route.path&&t.route.path.length>0)}function Gz(e,t){let i=hX(e);return t?i.map((a,d)=>d===i.length-1?a.pathname:a.pathnameBase):i.map(a=>a.pathnameBase)}function qz(e,t,i,a){a===void 0&&(a=!1);let d;typeof e=="string"?d=Vg(e):(d=av({},e),Ts(!d.pathname||!d.pathname.includes("?"),jE("?","pathname","search",d)),Ts(!d.pathname||!d.pathname.includes("#"),jE("#","pathname","hash",d)),Ts(!d.search||!d.search.includes("#"),jE("#","search","hash",d)));let y=e===""||d.pathname==="",S=y?"/":d.pathname,s;if(S==null)s=i;else{let $=t.length-1;if(!a&&S.startsWith("..")){let q=S.split("/");for(;q[0]==="..";)q.shift(),$-=1;d.pathname=q.join("/")}s=$>=0?t[$]:"/"}let N=uX(d,s),D=S&&S!=="/"&&S.endsWith("/"),O=(y||S===".")&&i.endsWith("/");return!N.pathname.endsWith("/")&&(D||O)&&(N.pathname+="/"),N}const Kd=e=>e.join("/").replace(/\/\/+/g,"/"),fX=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),pX=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,mX=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function gX(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const Hz=["post","put","patch","delete"];new Set(Hz);const _X=["get",...Hz];new Set(_X);/**
 * React Router v6.27.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function lv(){return lv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},lv.apply(this,arguments)}const hP=H.createContext(null),yX=H.createContext(null),Jf=H.createContext(null),T2=H.createContext(null),_h=H.createContext({outlet:null,matches:[],isDataRoute:!1}),Wz=H.createContext(null);function xX(e,t){let{relative:i}=t===void 0?{}:t;Uv()||Ts(!1);let{basename:a,navigator:d}=H.useContext(Jf),{hash:y,pathname:S,search:s}=Yz(e,{relative:i}),N=S;return a!=="/"&&(N=S==="/"?a:Kd([a,S])),d.createHref({pathname:N,search:s,hash:y})}function Uv(){return H.useContext(T2)!=null}function yh(){return Uv()||Ts(!1),H.useContext(T2).location}function Zz(e){H.useContext(Jf).static||H.useLayoutEffect(e)}function $l(){let{isDataRoute:e}=H.useContext(_h);return e?NX():vX()}function vX(){Uv()||Ts(!1);let e=H.useContext(hP),{basename:t,future:i,navigator:a}=H.useContext(Jf),{matches:d}=H.useContext(_h),{pathname:y}=yh(),S=JSON.stringify(Gz(d,i.v7_relativeSplatPath)),s=H.useRef(!1);return Zz(()=>{s.current=!0}),H.useCallback(function(D,O){if(O===void 0&&(O={}),!s.current)return;if(typeof D=="number"){a.go(D);return}let $=qz(D,JSON.parse(S),y,O.relative==="path");e==null&&t!=="/"&&($.pathname=$.pathname==="/"?t:Kd([t,$.pathname])),(O.replace?a.replace:a.push)($,O.state,O)},[t,a,S,y,e])}function fP(){let{matches:e}=H.useContext(_h),t=e[e.length-1];return t?t.params:{}}function Yz(e,t){let{relative:i}=t===void 0?{}:t,{future:a}=H.useContext(Jf),{matches:d}=H.useContext(_h),{pathname:y}=yh(),S=JSON.stringify(Gz(d,a.v7_relativeSplatPath));return H.useMemo(()=>qz(e,JSON.parse(S),y,i==="path"),[e,S,y,i])}function bX(e,t){return wX(e,t)}function wX(e,t,i,a){Uv()||Ts(!1);let{navigator:d}=H.useContext(Jf),{matches:y}=H.useContext(_h),S=y[y.length-1],s=S?S.params:{};S&&S.pathname;let N=S?S.pathnameBase:"/";S&&S.route;let D=yh(),O;if(t){var $;let ce=typeof t=="string"?Vg(t):t;N==="/"||($=ce.pathname)!=null&&$.startsWith(N)||Ts(!1),O=ce}else O=D;let q=O.pathname||"/",J=q;if(N!=="/"){let ce=N.replace(/^\//,"").split("/");J="/"+q.replace(/^\//,"").split("/").slice(ce.length).join("/")}let re=XY(e,{pathname:J}),Q=MX(re&&re.map(ce=>Object.assign({},ce,{params:Object.assign({},s,ce.params),pathname:Kd([N,d.encodeLocation?d.encodeLocation(ce.pathname).pathname:ce.pathname]),pathnameBase:ce.pathnameBase==="/"?N:Kd([N,d.encodeLocation?d.encodeLocation(ce.pathnameBase).pathname:ce.pathnameBase])})),y,i,a);return t&&Q?H.createElement(T2.Provider,{value:{location:lv({pathname:"/",search:"",hash:"",state:null,key:"default"},O),navigationType:Ud.Pop}},Q):Q}function SX(){let e=kX(),t=gX(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),i=e instanceof Error?e.stack:null,d={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return H.createElement(H.Fragment,null,H.createElement("h2",null,"Unexpected Application Error!"),H.createElement("h3",{style:{fontStyle:"italic"}},t),i?H.createElement("pre",{style:d},i):null,null)}const TX=H.createElement(SX,null);class EX extends H.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,i){return i.location!==t.location||i.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:i.error,location:i.location,revalidation:t.revalidation||i.revalidation}}componentDidCatch(t,i){console.error("React Router caught the following error during render",t,i)}render(){return this.state.error!==void 0?H.createElement(_h.Provider,{value:this.props.routeContext},H.createElement(Wz.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function CX(e){let{routeContext:t,match:i,children:a}=e,d=H.useContext(hP);return d&&d.static&&d.staticContext&&(i.route.errorElement||i.route.ErrorBoundary)&&(d.staticContext._deepestRenderedBoundaryId=i.route.id),H.createElement(_h.Provider,{value:t},a)}function MX(e,t,i,a){var d;if(t===void 0&&(t=[]),i===void 0&&(i=null),a===void 0&&(a=null),e==null){var y;if(!i)return null;if(i.errors)e=i.matches;else if((y=a)!=null&&y.v7_partialHydration&&t.length===0&&!i.initialized&&i.matches.length>0)e=i.matches;else return null}let S=e,s=(d=i)==null?void 0:d.errors;if(s!=null){let O=S.findIndex($=>$.route.id&&(s==null?void 0:s[$.route.id])!==void 0);O>=0||Ts(!1),S=S.slice(0,Math.min(S.length,O+1))}let N=!1,D=-1;if(i&&a&&a.v7_partialHydration)for(let O=0;O<S.length;O++){let $=S[O];if(($.route.HydrateFallback||$.route.hydrateFallbackElement)&&(D=O),$.route.id){let{loaderData:q,errors:J}=i,re=$.route.loader&&q[$.route.id]===void 0&&(!J||J[$.route.id]===void 0);if($.route.lazy||re){N=!0,D>=0?S=S.slice(0,D+1):S=[S[0]];break}}}return S.reduceRight((O,$,q)=>{let J,re=!1,Q=null,ce=null;i&&(J=s&&$.route.id?s[$.route.id]:void 0,Q=$.route.errorElement||TX,N&&(D<0&&q===0?(re=!0,ce=null):D===q&&(re=!0,ce=$.route.hydrateFallbackElement||null)));let le=t.concat(S.slice(0,q+1)),ae=()=>{let he;return J?he=Q:re?he=ce:$.route.Component?he=H.createElement($.route.Component,null):$.route.element?he=$.route.element:he=O,H.createElement(CX,{match:$,routeContext:{outlet:O,matches:le,isDataRoute:i!=null},children:he})};return i&&($.route.ErrorBoundary||$.route.errorElement||q===0)?H.createElement(EX,{location:i.location,revalidation:i.revalidation,component:Q,error:J,children:ae(),routeContext:{outlet:null,matches:le,isDataRoute:!0}}):ae()},null)}var Xz=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(Xz||{}),Ew=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(Ew||{});function AX(e){let t=H.useContext(hP);return t||Ts(!1),t}function PX(e){let t=H.useContext(yX);return t||Ts(!1),t}function IX(e){let t=H.useContext(_h);return t||Ts(!1),t}function Kz(e){let t=IX(),i=t.matches[t.matches.length-1];return i.route.id||Ts(!1),i.route.id}function kX(){var e;let t=H.useContext(Wz),i=PX(Ew.UseRouteError),a=Kz(Ew.UseRouteError);return t!==void 0?t:(e=i.errors)==null?void 0:e[a]}function NX(){let{router:e}=AX(Xz.UseNavigateStable),t=Kz(Ew.UseNavigateStable),i=H.useRef(!1);return Zz(()=>{i.current=!0}),H.useCallback(function(d,y){y===void 0&&(y={}),i.current&&(typeof d=="number"?e.navigate(d):e.navigate(d,lv({fromRouteId:t},y)))},[e,t])}function Li(e){Ts(!1)}function RX(e){let{basename:t="/",children:i=null,location:a,navigationType:d=Ud.Pop,navigator:y,static:S=!1,future:s}=e;Uv()&&Ts(!1);let N=t.replace(/^\/*/,"/"),D=H.useMemo(()=>({basename:N,navigator:y,static:S,future:lv({v7_relativeSplatPath:!1},s)}),[N,s,y,S]);typeof a=="string"&&(a=Vg(a));let{pathname:O="/",search:$="",hash:q="",state:J=null,key:re="default"}=a,Q=H.useMemo(()=>{let ce=dP(O,N);return ce==null?null:{location:{pathname:ce,search:$,hash:q,state:J,key:re},navigationType:d}},[N,O,$,q,J,re,d]);return Q==null?null:H.createElement(Jf.Provider,{value:D},H.createElement(T2.Provider,{children:i,value:Q}))}function jX(e){let{children:t,location:i}=e;return bX(pM(t),i)}new Promise(()=>{});function pM(e,t){t===void 0&&(t=[]);let i=[];return H.Children.forEach(e,(a,d)=>{if(!H.isValidElement(a))return;let y=[...t,d];if(a.type===H.Fragment){i.push.apply(i,pM(a.props.children,y));return}a.type!==Li&&Ts(!1),!a.props.index||!a.props.children||Ts(!1);let S={id:a.props.id||y.join("-"),caseSensitive:a.props.caseSensitive,element:a.props.element,Component:a.props.Component,index:a.props.index,path:a.props.path,loader:a.props.loader,action:a.props.action,errorElement:a.props.errorElement,ErrorBoundary:a.props.ErrorBoundary,hasErrorBoundary:a.props.ErrorBoundary!=null||a.props.errorElement!=null,shouldRevalidate:a.props.shouldRevalidate,handle:a.props.handle,lazy:a.props.lazy};a.props.children&&(S.children=pM(a.props.children,y)),i.push(S)}),i}/**
 * React Router DOM v6.27.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function mM(){return mM=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},mM.apply(this,arguments)}function DX(e,t){if(e==null)return{};var i={},a=Object.keys(e),d,y;for(y=0;y<a.length;y++)d=a[y],!(t.indexOf(d)>=0)&&(i[d]=e[d]);return i}function LX(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function OX(e,t){return e.button===0&&(!t||t==="_self")&&!LX(e)}function gM(e){return e===void 0&&(e=""),new URLSearchParams(typeof e=="string"||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((t,i)=>{let a=e[i];return t.concat(Array.isArray(a)?a.map(d=>[i,d]):[[i,a]])},[]))}function zX(e,t){let i=gM(e);return t&&t.forEach((a,d)=>{i.has(d)||t.getAll(d).forEach(y=>{i.append(d,y)})}),i}const FX=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],BX="6";try{window.__reactRouterVersion=BX}catch{}const VX="startTransition",q3=fL[VX];function UX(e){let{basename:t,children:i,future:a,window:d}=e,y=H.useRef();y.current==null&&(y.current=WY({window:d,v5Compat:!0}));let S=y.current,[s,N]=H.useState({action:S.action,location:S.location}),{v7_startTransition:D}=a||{},O=H.useCallback($=>{D&&q3?q3(()=>N($)):N($)},[N,D]);return H.useLayoutEffect(()=>S.listen(O),[S,O]),H.createElement(RX,{basename:t,children:i,location:s.location,navigationType:s.action,navigator:S,future:a})}const $X=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",GX=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,un=H.forwardRef(function(t,i){let{onClick:a,relative:d,reloadDocument:y,replace:S,state:s,target:N,to:D,preventScrollReset:O,viewTransition:$}=t,q=DX(t,FX),{basename:J}=H.useContext(Jf),re,Q=!1;if(typeof D=="string"&&GX.test(D)&&(re=D,$X))try{let he=new URL(window.location.href),Se=D.startsWith("//")?new URL(he.protocol+D):new URL(D),je=dP(Se.pathname,J);Se.origin===he.origin&&je!=null?D=je+Se.search+Se.hash:Q=!0}catch{}let ce=xX(D,{relative:d}),le=qX(D,{replace:S,state:s,target:N,preventScrollReset:O,relative:d,viewTransition:$});function ae(he){a&&a(he),he.defaultPrevented||le(he)}return H.createElement("a",mM({},q,{href:re||ce,onClick:Q||y?a:ae,ref:i,target:N}))});var H3;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(H3||(H3={}));var W3;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(W3||(W3={}));function qX(e,t){let{target:i,replace:a,state:d,preventScrollReset:y,relative:S,viewTransition:s}=t===void 0?{}:t,N=$l(),D=yh(),O=Yz(e,{relative:S});return H.useCallback($=>{if(OX($,i)){$.preventDefault();let q=a!==void 0?a:Tw(D)===Tw(O);N(e,{replace:q,state:d,preventScrollReset:y,relative:S,viewTransition:s})}},[D,N,O,a,d,i,e,y,S,s])}function HX(e){let t=H.useRef(gM(e)),i=H.useRef(!1),a=yh(),d=H.useMemo(()=>zX(a.search,i.current?null:t.current),[a.search]),y=$l(),S=H.useCallback((s,N)=>{const D=gM(typeof s=="function"?s(d):s);i.current=!0,y("?"+D,N)},[y,d]);return[d,S]}const _M=Og("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Kt=H.forwardRef(({className:e,variant:t,size:i,asChild:a=!1,...d},y)=>{const S=a?Tc:"button";return f.jsx(S,{className:br(_M({variant:t,size:i,className:e})),ref:y,...d})});Kt.displayName="Button";var WX=H.createContext(void 0);function Qf(e){const t=H.useContext(WX);return e||t||"ltr"}function E2(e){const t=H.useRef({value:e,previous:e});return H.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}var Ug="NavigationMenu",[pP,Jz,ZX]=Dg(Ug),[yM,YX,XX]=Dg(Ug),[mP,_ce]=ta(Ug,[ZX,XX]),[KX,Ka]=mP(Ug),[JX,QX]=mP(Ug),Qz=H.forwardRef((e,t)=>{const{__scopeNavigationMenu:i,value:a,onValueChange:d,defaultValue:y,delayDuration:S=200,skipDelayDuration:s=300,orientation:N="horizontal",dir:D,...O}=e,[$,q]=H.useState(null),J=dn(t,pt=>q(pt)),re=Qf(D),Q=H.useRef(0),ce=H.useRef(0),le=H.useRef(0),[ae,he]=H.useState(!0),[Se="",je]=Xa({prop:a,onChange:pt=>{const Ze=pt!=="",yt=s>0;Ze?(window.clearTimeout(le.current),yt&&he(!1)):(window.clearTimeout(le.current),le.current=window.setTimeout(()=>he(!0),s)),d==null||d(pt)},defaultProp:y}),it=H.useCallback(()=>{window.clearTimeout(ce.current),ce.current=window.setTimeout(()=>je(""),150)},[je]),qe=H.useCallback(pt=>{window.clearTimeout(ce.current),je(pt)},[je]),ct=H.useCallback(pt=>{Se===pt?window.clearTimeout(ce.current):Q.current=window.setTimeout(()=>{window.clearTimeout(ce.current),je(pt)},S)},[Se,je,S]);return H.useEffect(()=>()=>{window.clearTimeout(Q.current),window.clearTimeout(ce.current),window.clearTimeout(le.current)},[]),f.jsx(tF,{scope:i,isRootMenu:!0,value:Se,dir:re,orientation:N,rootNavigationMenu:$,onTriggerEnter:pt=>{window.clearTimeout(Q.current),ae?ct(pt):qe(pt)},onTriggerLeave:()=>{window.clearTimeout(Q.current),it()},onContentEnter:()=>window.clearTimeout(ce.current),onContentLeave:it,onItemSelect:pt=>{je(Ze=>Ze===pt?"":pt)},onItemDismiss:()=>je(""),children:f.jsx(wr.nav,{"aria-label":"Main","data-orientation":N,dir:re,...O,ref:J})})});Qz.displayName=Ug;var eF="NavigationMenuSub",eK=H.forwardRef((e,t)=>{const{__scopeNavigationMenu:i,value:a,onValueChange:d,defaultValue:y,orientation:S="horizontal",...s}=e,N=Ka(eF,i),[D="",O]=Xa({prop:a,onChange:d,defaultProp:y});return f.jsx(tF,{scope:i,isRootMenu:!1,value:D,dir:N.dir,orientation:S,rootNavigationMenu:N.rootNavigationMenu,onTriggerEnter:$=>O($),onItemSelect:$=>O($),onItemDismiss:()=>O(""),children:f.jsx(wr.div,{"data-orientation":S,...s,ref:t})})});eK.displayName=eF;var tF=e=>{const{scope:t,isRootMenu:i,rootNavigationMenu:a,dir:d,orientation:y,children:S,value:s,onItemSelect:N,onItemDismiss:D,onTriggerEnter:O,onTriggerLeave:$,onContentEnter:q,onContentLeave:J}=e,[re,Q]=H.useState(null),[ce,le]=H.useState(new Map),[ae,he]=H.useState(null);return f.jsx(KX,{scope:t,isRootMenu:i,rootNavigationMenu:a,value:s,previousValue:E2(s),baseId:ba(),dir:d,orientation:y,viewport:re,onViewportChange:Q,indicatorTrack:ae,onIndicatorTrackChange:he,onTriggerEnter:oi(O),onTriggerLeave:oi($),onContentEnter:oi(q),onContentLeave:oi(J),onItemSelect:oi(N),onItemDismiss:oi(D),onViewportContentChange:H.useCallback((Se,je)=>{le(it=>(it.set(Se,je),new Map(it)))},[]),onViewportContentRemove:H.useCallback(Se=>{le(je=>je.has(Se)?(je.delete(Se),new Map(je)):je)},[]),children:f.jsx(pP.Provider,{scope:t,children:f.jsx(JX,{scope:t,items:ce,children:S})})})},rF="NavigationMenuList",nF=H.forwardRef((e,t)=>{const{__scopeNavigationMenu:i,...a}=e,d=Ka(rF,i),y=f.jsx(wr.ul,{"data-orientation":d.orientation,...a,ref:t});return f.jsx(wr.div,{style:{position:"relative"},ref:d.onIndicatorTrackChange,children:f.jsx(pP.Slot,{scope:i,children:d.isRootMenu?f.jsx(fF,{asChild:!0,children:y}):y})})});nF.displayName=rF;var iF="NavigationMenuItem",[tK,sF]=mP(iF),oF=H.forwardRef((e,t)=>{const{__scopeNavigationMenu:i,value:a,...d}=e,y=ba(),S=a||y||"LEGACY_REACT_AUTO_VALUE",s=H.useRef(null),N=H.useRef(null),D=H.useRef(null),O=H.useRef(()=>{}),$=H.useRef(!1),q=H.useCallback((re="start")=>{if(s.current){O.current();const Q=vM(s.current);Q.length&&yP(re==="start"?Q:Q.reverse())}},[]),J=H.useCallback(()=>{if(s.current){const re=vM(s.current);re.length&&(O.current=lK(re))}},[]);return f.jsx(tK,{scope:i,value:S,triggerRef:N,contentRef:s,focusProxyRef:D,wasEscapeCloseRef:$,onEntryKeyDown:q,onFocusProxyEnter:q,onRootContentClose:J,onContentFocusOutside:J,children:f.jsx(wr.li,{...d,ref:t})})});oF.displayName=iF;var xM="NavigationMenuTrigger",aF=H.forwardRef((e,t)=>{const{__scopeNavigationMenu:i,disabled:a,...d}=e,y=Ka(xM,e.__scopeNavigationMenu),S=sF(xM,e.__scopeNavigationMenu),s=H.useRef(null),N=dn(s,S.triggerRef,t),D=mF(y.baseId,S.value),O=gF(y.baseId,S.value),$=H.useRef(!1),q=H.useRef(!1),J=S.value===y.value;return f.jsxs(f.Fragment,{children:[f.jsx(pP.ItemSlot,{scope:i,value:S.value,children:f.jsx(pF,{asChild:!0,children:f.jsx(wr.button,{id:D,disabled:a,"data-disabled":a?"":void 0,"data-state":xP(J),"aria-expanded":J,"aria-controls":O,...d,ref:N,onPointerEnter:Ht(e.onPointerEnter,()=>{q.current=!1,S.wasEscapeCloseRef.current=!1}),onPointerMove:Ht(e.onPointerMove,Cw(()=>{a||q.current||S.wasEscapeCloseRef.current||$.current||(y.onTriggerEnter(S.value),$.current=!0)})),onPointerLeave:Ht(e.onPointerLeave,Cw(()=>{a||(y.onTriggerLeave(),$.current=!1)})),onClick:Ht(e.onClick,()=>{y.onItemSelect(S.value),q.current=J}),onKeyDown:Ht(e.onKeyDown,re=>{const ce={horizontal:"ArrowDown",vertical:y.dir==="rtl"?"ArrowLeft":"ArrowRight"}[y.orientation];J&&re.key===ce&&(S.onEntryKeyDown(),re.preventDefault())})})})}),J&&f.jsxs(f.Fragment,{children:[f.jsx(b4,{"aria-hidden":!0,tabIndex:0,ref:S.focusProxyRef,onFocus:re=>{const Q=S.contentRef.current,ce=re.relatedTarget,le=ce===s.current,ae=Q==null?void 0:Q.contains(ce);(le||!ae)&&S.onFocusProxyEnter(le?"start":"end")}}),y.viewport&&f.jsx("span",{"aria-owns":O})]})]})});aF.displayName=xM;var rK="NavigationMenuLink",Z3="navigationMenu.linkSelect",lF=H.forwardRef((e,t)=>{const{__scopeNavigationMenu:i,active:a,onSelect:d,...y}=e;return f.jsx(pF,{asChild:!0,children:f.jsx(wr.a,{"data-active":a?"":void 0,"aria-current":a?"page":void 0,...y,ref:t,onClick:Ht(e.onClick,S=>{const s=S.target,N=new CustomEvent(Z3,{bubbles:!0,cancelable:!0});if(s.addEventListener(Z3,D=>d==null?void 0:d(D),{once:!0}),Qx(s,N),!N.defaultPrevented&&!S.metaKey){const D=new CustomEvent(Vb,{bubbles:!0,cancelable:!0});Qx(s,D)}},{checkForDefaultPrevented:!1})})})});lF.displayName=rK;var gP="NavigationMenuIndicator",cF=H.forwardRef((e,t)=>{const{forceMount:i,...a}=e,d=Ka(gP,e.__scopeNavigationMenu),y=!!d.value;return d.indicatorTrack?$A.createPortal(f.jsx(Yi,{present:i||y,children:f.jsx(nK,{...a,ref:t})}),d.indicatorTrack):null});cF.displayName=gP;var nK=H.forwardRef((e,t)=>{const{__scopeNavigationMenu:i,...a}=e,d=Ka(gP,i),y=Jz(i),[S,s]=H.useState(null),[N,D]=H.useState(null),O=d.orientation==="horizontal",$=!!d.value;H.useEffect(()=>{var Q;const re=(Q=y().find(ce=>ce.value===d.value))==null?void 0:Q.ref.current;re&&s(re)},[y,d.value]);const q=()=>{S&&D({size:O?S.offsetWidth:S.offsetHeight,offset:O?S.offsetLeft:S.offsetTop})};return bM(S,q),bM(d.indicatorTrack,q),N?f.jsx(wr.div,{"aria-hidden":!0,"data-state":$?"visible":"hidden","data-orientation":d.orientation,...a,ref:t,style:{position:"absolute",...O?{left:0,width:N.size+"px",transform:`translateX(${N.offset}px)`}:{top:0,height:N.size+"px",transform:`translateY(${N.offset}px)`},...a.style}}):null}),Sg="NavigationMenuContent",uF=H.forwardRef((e,t)=>{const{forceMount:i,...a}=e,d=Ka(Sg,e.__scopeNavigationMenu),y=sF(Sg,e.__scopeNavigationMenu),S=dn(y.contentRef,t),s=y.value===d.value,N={value:y.value,triggerRef:y.triggerRef,focusProxyRef:y.focusProxyRef,wasEscapeCloseRef:y.wasEscapeCloseRef,onContentFocusOutside:y.onContentFocusOutside,onRootContentClose:y.onRootContentClose,...a};return d.viewport?f.jsx(iK,{forceMount:i,...N,ref:S}):f.jsx(Yi,{present:i||s,children:f.jsx(dF,{"data-state":xP(s),...N,ref:S,onPointerEnter:Ht(e.onPointerEnter,d.onContentEnter),onPointerLeave:Ht(e.onPointerLeave,Cw(d.onContentLeave)),style:{pointerEvents:!s&&d.isRootMenu?"none":void 0,...N.style}})})});uF.displayName=Sg;var iK=H.forwardRef((e,t)=>{const i=Ka(Sg,e.__scopeNavigationMenu),{onViewportContentChange:a,onViewportContentRemove:d}=i;return ss(()=>{a(e.value,{ref:t,...e})},[e,t,a]),ss(()=>()=>d(e.value),[e.value,d]),null}),Vb="navigationMenu.rootContentDismiss",dF=H.forwardRef((e,t)=>{const{__scopeNavigationMenu:i,value:a,triggerRef:d,focusProxyRef:y,wasEscapeCloseRef:S,onRootContentClose:s,onContentFocusOutside:N,...D}=e,O=Ka(Sg,i),$=H.useRef(null),q=dn($,t),J=mF(O.baseId,a),re=gF(O.baseId,a),Q=Jz(i),ce=H.useRef(null),{onItemDismiss:le}=O;H.useEffect(()=>{const he=$.current;if(O.isRootMenu&&he){const Se=()=>{var je;le(),s(),he.contains(document.activeElement)&&((je=d.current)==null||je.focus())};return he.addEventListener(Vb,Se),()=>he.removeEventListener(Vb,Se)}},[O.isRootMenu,e.value,d,le,s]);const ae=H.useMemo(()=>{const Se=Q().map(Ze=>Ze.value);O.dir==="rtl"&&Se.reverse();const je=Se.indexOf(O.value),it=Se.indexOf(O.previousValue),qe=a===O.value,ct=it===Se.indexOf(a);if(!qe&&!ct)return ce.current;const pt=(()=>{if(je!==it){if(qe&&it!==-1)return je>it?"from-end":"from-start";if(ct&&je!==-1)return je>it?"to-start":"to-end"}return null})();return ce.current=pt,pt},[O.previousValue,O.value,O.dir,Q,a]);return f.jsx(fF,{asChild:!0,children:f.jsx(mh,{id:re,"aria-labelledby":J,"data-motion":ae,"data-orientation":O.orientation,...D,ref:q,disableOutsidePointerEvents:!1,onDismiss:()=>{var Se;const he=new Event(Vb,{bubbles:!0,cancelable:!0});(Se=$.current)==null||Se.dispatchEvent(he)},onFocusOutside:Ht(e.onFocusOutside,he=>{var je;N();const Se=he.target;(je=O.rootNavigationMenu)!=null&&je.contains(Se)&&he.preventDefault()}),onPointerDownOutside:Ht(e.onPointerDownOutside,he=>{var qe;const Se=he.target,je=Q().some(ct=>{var pt;return(pt=ct.ref.current)==null?void 0:pt.contains(Se)}),it=O.isRootMenu&&((qe=O.viewport)==null?void 0:qe.contains(Se));(je||it||!O.isRootMenu)&&he.preventDefault()}),onKeyDown:Ht(e.onKeyDown,he=>{var it;const Se=he.altKey||he.ctrlKey||he.metaKey;if(he.key==="Tab"&&!Se){const qe=vM(he.currentTarget),ct=document.activeElement,pt=qe.findIndex(Mt=>Mt===ct),yt=he.shiftKey?qe.slice(0,pt).reverse():qe.slice(pt+1,qe.length);yP(yt)?he.preventDefault():(it=y.current)==null||it.focus()}}),onEscapeKeyDown:Ht(e.onEscapeKeyDown,he=>{S.current=!0})})})}),_P="NavigationMenuViewport",hF=H.forwardRef((e,t)=>{const{forceMount:i,...a}=e,y=!!Ka(_P,e.__scopeNavigationMenu).value;return f.jsx(Yi,{present:i||y,children:f.jsx(sK,{...a,ref:t})})});hF.displayName=_P;var sK=H.forwardRef((e,t)=>{const{__scopeNavigationMenu:i,children:a,...d}=e,y=Ka(_P,i),S=dn(t,y.onViewportChange),s=QX(Sg,e.__scopeNavigationMenu),[N,D]=H.useState(null),[O,$]=H.useState(null),q=N?(N==null?void 0:N.width)+"px":void 0,J=N?(N==null?void 0:N.height)+"px":void 0,re=!!y.value,Q=re?y.value:y.previousValue;return bM(O,()=>{O&&D({width:O.offsetWidth,height:O.offsetHeight})}),f.jsx(wr.div,{"data-state":xP(re),"data-orientation":y.orientation,...d,ref:S,style:{pointerEvents:!re&&y.isRootMenu?"none":void 0,"--radix-navigation-menu-viewport-width":q,"--radix-navigation-menu-viewport-height":J,...d.style},onPointerEnter:Ht(e.onPointerEnter,y.onContentEnter),onPointerLeave:Ht(e.onPointerLeave,Cw(y.onContentLeave)),children:Array.from(s.items).map(([le,{ref:ae,forceMount:he,...Se}])=>{const je=Q===le;return f.jsx(Yi,{present:he||je,children:f.jsx(dF,{...Se,ref:zv(ae,it=>{je&&it&&$(it)})})},le)})})}),oK="FocusGroup",fF=H.forwardRef((e,t)=>{const{__scopeNavigationMenu:i,...a}=e,d=Ka(oK,i);return f.jsx(yM.Provider,{scope:i,children:f.jsx(yM.Slot,{scope:i,children:f.jsx(wr.div,{dir:d.dir,...a,ref:t})})})}),Y3=["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"],aK="FocusGroupItem",pF=H.forwardRef((e,t)=>{const{__scopeNavigationMenu:i,...a}=e,d=YX(i),y=Ka(aK,i);return f.jsx(yM.ItemSlot,{scope:i,children:f.jsx(wr.button,{...a,ref:t,onKeyDown:Ht(e.onKeyDown,S=>{if(["Home","End",...Y3].includes(S.key)){let N=d().map($=>$.ref.current);if([y.dir==="rtl"?"ArrowRight":"ArrowLeft","ArrowUp","End"].includes(S.key)&&N.reverse(),Y3.includes(S.key)){const $=N.indexOf(S.currentTarget);N=N.slice($+1)}setTimeout(()=>yP(N)),S.preventDefault()}})})})});function vM(e){const t=[],i=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:a=>{const d=a.tagName==="INPUT"&&a.type==="hidden";return a.disabled||a.hidden||d?NodeFilter.FILTER_SKIP:a.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;i.nextNode();)t.push(i.currentNode);return t}function yP(e){const t=document.activeElement;return e.some(i=>i===t?!0:(i.focus(),document.activeElement!==t))}function lK(e){return e.forEach(t=>{t.dataset.tabindex=t.getAttribute("tabindex")||"",t.setAttribute("tabindex","-1")}),()=>{e.forEach(t=>{const i=t.dataset.tabindex;t.setAttribute("tabindex",i)})}}function bM(e,t){const i=oi(t);ss(()=>{let a=0;if(e){const d=new ResizeObserver(()=>{cancelAnimationFrame(a),a=window.requestAnimationFrame(i)});return d.observe(e),()=>{window.cancelAnimationFrame(a),d.unobserve(e)}}},[e,i])}function xP(e){return e?"open":"closed"}function mF(e,t){return`${e}-trigger-${t}`}function gF(e,t){return`${e}-content-${t}`}function Cw(e){return t=>t.pointerType==="mouse"?e(t):void 0}var _F=Qz,yF=nF,cK=oF,xF=aF,uK=lF,vF=cF,bF=uF,wF=hF;const SF=H.forwardRef(({className:e,children:t,...i},a)=>f.jsxs(_F,{ref:a,className:br("relative z-10 flex max-w-max flex-1 items-center justify-center",e),...i,children:[t,f.jsx(EF,{})]}));SF.displayName=_F.displayName;const TF=H.forwardRef(({className:e,...t},i)=>f.jsx(yF,{ref:i,className:br("group flex flex-1 list-none items-center justify-center space-x-1",e),...t}));TF.displayName=yF.displayName;const pb=cK,ux=Og("group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[active]:bg-accent/50 data-[state=open]:bg-accent/50"),dK=H.forwardRef(({className:e,children:t,...i},a)=>f.jsxs(xF,{ref:a,className:br(ux(),"group",e),...i,children:[t," ",f.jsx(ZA,{className:"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180","aria-hidden":"true"})]}));dK.displayName=xF.displayName;const hK=H.forwardRef(({className:e,...t},i)=>f.jsx(bF,{ref:i,className:br("left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto ",e),...t}));hK.displayName=bF.displayName;const mb=uK,EF=H.forwardRef(({className:e,...t},i)=>f.jsx("div",{className:br("absolute left-0 top-full flex justify-center"),children:f.jsx(wF,{className:br("origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]",e),ref:i,...t})}));EF.displayName=wF.displayName;const fK=H.forwardRef(({className:e,...t},i)=>f.jsx(vF,{ref:i,className:br("top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in",e),...t,children:f.jsx("div",{className:"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md"})}));fK.displayName=vF.displayName;var DE=0;function C2(){H.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??X3()),document.body.insertAdjacentElement("beforeend",e[1]??X3()),DE++,()=>{DE===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),DE--}},[])}function X3(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var LE="focusScope.autoFocusOnMount",OE="focusScope.autoFocusOnUnmount",K3={bubbles:!1,cancelable:!0},pK="FocusScope",$v=H.forwardRef((e,t)=>{const{loop:i=!1,trapped:a=!1,onMountAutoFocus:d,onUnmountAutoFocus:y,...S}=e,[s,N]=H.useState(null),D=oi(d),O=oi(y),$=H.useRef(null),q=dn(t,Q=>N(Q)),J=H.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;H.useEffect(()=>{if(a){let Q=function(he){if(J.paused||!s)return;const Se=he.target;s.contains(Se)?$.current=Se:Sd($.current,{select:!0})},ce=function(he){if(J.paused||!s)return;const Se=he.relatedTarget;Se!==null&&(s.contains(Se)||Sd($.current,{select:!0}))},le=function(he){if(document.activeElement===document.body)for(const je of he)je.removedNodes.length>0&&Sd(s)};document.addEventListener("focusin",Q),document.addEventListener("focusout",ce);const ae=new MutationObserver(le);return s&&ae.observe(s,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",Q),document.removeEventListener("focusout",ce),ae.disconnect()}}},[a,s,J.paused]),H.useEffect(()=>{if(s){Q3.add(J);const Q=document.activeElement;if(!s.contains(Q)){const le=new CustomEvent(LE,K3);s.addEventListener(LE,D),s.dispatchEvent(le),le.defaultPrevented||(mK(vK(CF(s)),{select:!0}),document.activeElement===Q&&Sd(s))}return()=>{s.removeEventListener(LE,D),setTimeout(()=>{const le=new CustomEvent(OE,K3);s.addEventListener(OE,O),s.dispatchEvent(le),le.defaultPrevented||Sd(Q??document.body,{select:!0}),s.removeEventListener(OE,O),Q3.remove(J)},0)}}},[s,D,O,J]);const re=H.useCallback(Q=>{if(!i&&!a||J.paused)return;const ce=Q.key==="Tab"&&!Q.altKey&&!Q.ctrlKey&&!Q.metaKey,le=document.activeElement;if(ce&&le){const ae=Q.currentTarget,[he,Se]=gK(ae);he&&Se?!Q.shiftKey&&le===Se?(Q.preventDefault(),i&&Sd(he,{select:!0})):Q.shiftKey&&le===he&&(Q.preventDefault(),i&&Sd(Se,{select:!0})):le===ae&&Q.preventDefault()}},[i,a,J.paused]);return f.jsx(wr.div,{tabIndex:-1,...S,ref:q,onKeyDown:re})});$v.displayName=pK;function mK(e,{select:t=!1}={}){const i=document.activeElement;for(const a of e)if(Sd(a,{select:t}),document.activeElement!==i)return}function gK(e){const t=CF(e),i=J3(t,e),a=J3(t.reverse(),e);return[i,a]}function CF(e){const t=[],i=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:a=>{const d=a.tagName==="INPUT"&&a.type==="hidden";return a.disabled||a.hidden||d?NodeFilter.FILTER_SKIP:a.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;i.nextNode();)t.push(i.currentNode);return t}function J3(e,t){for(const i of e)if(!_K(i,{upTo:t}))return i}function _K(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function yK(e){return e instanceof HTMLInputElement&&"select"in e}function Sd(e,{select:t=!1}={}){if(e&&e.focus){const i=document.activeElement;e.focus({preventScroll:!0}),e!==i&&yK(e)&&t&&e.select()}}var Q3=xK();function xK(){let e=[];return{add(t){const i=e[0];t!==i&&(i==null||i.pause()),e=eD(e,t),e.unshift(t)},remove(t){var i;e=eD(e,t),(i=e[0])==null||i.resume()}}}function eD(e,t){const i=[...e],a=i.indexOf(t);return a!==-1&&i.splice(a,1),i}function vK(e){return e.filter(t=>t.tagName!=="A")}function bK(e,t=[]){let i=[];function a(y,S){const s=H.createContext(S),N=i.length;i=[...i,S];function D($){const{scope:q,children:J,...re}=$,Q=(q==null?void 0:q[e][N])||s,ce=H.useMemo(()=>re,Object.values(re));return f.jsx(Q.Provider,{value:ce,children:J})}function O($,q){const J=(q==null?void 0:q[e][N])||s,re=H.useContext(J);if(re)return re;if(S!==void 0)return S;throw new Error(`\`${$}\` must be used within \`${y}\``)}return D.displayName=y+"Provider",[D,O]}const d=()=>{const y=i.map(S=>H.createContext(S));return function(s){const N=(s==null?void 0:s[e])||y;return H.useMemo(()=>({[`__scope${e}`]:{...s,[e]:N}}),[s,N])}};return d.scopeName=e,[a,wK(d,...t)]}function wK(...e){const t=e[0];if(e.length===1)return t;const i=()=>{const a=e.map(d=>({useScope:d(),scopeName:d.scopeName}));return function(y){const S=a.reduce((s,{useScope:N,scopeName:D})=>{const $=N(y)[`__scope${D}`];return{...s,...$}},{});return H.useMemo(()=>({[`__scope${t.scopeName}`]:S}),[S])}};return i.scopeName=t.scopeName,i}var zE="rovingFocusGroup.onEntryFocus",SK={bubbles:!1,cancelable:!0},M2="RovingFocusGroup",[wM,MF,TK]=Dg(M2),[EK,$g]=bK(M2,[TK]),[CK,MK]=EK(M2),AF=H.forwardRef((e,t)=>f.jsx(wM.Provider,{scope:e.__scopeRovingFocusGroup,children:f.jsx(wM.Slot,{scope:e.__scopeRovingFocusGroup,children:f.jsx(AK,{...e,ref:t})})}));AF.displayName=M2;var AK=H.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:i,orientation:a,loop:d=!1,dir:y,currentTabStopId:S,defaultCurrentTabStopId:s,onCurrentTabStopIdChange:N,onEntryFocus:D,preventScrollOnEntryFocus:O=!1,...$}=e,q=H.useRef(null),J=dn(t,q),re=Qf(y),[Q=null,ce]=Xa({prop:S,defaultProp:s,onChange:N}),[le,ae]=H.useState(!1),he=oi(D),Se=MF(i),je=H.useRef(!1),[it,qe]=H.useState(0);return H.useEffect(()=>{const ct=q.current;if(ct)return ct.addEventListener(zE,he),()=>ct.removeEventListener(zE,he)},[he]),f.jsx(CK,{scope:i,orientation:a,dir:re,loop:d,currentTabStopId:Q,onItemFocus:H.useCallback(ct=>ce(ct),[ce]),onItemShiftTab:H.useCallback(()=>ae(!0),[]),onFocusableItemAdd:H.useCallback(()=>qe(ct=>ct+1),[]),onFocusableItemRemove:H.useCallback(()=>qe(ct=>ct-1),[]),children:f.jsx(wr.div,{tabIndex:le||it===0?-1:0,"data-orientation":a,...$,ref:J,style:{outline:"none",...e.style},onMouseDown:Ht(e.onMouseDown,()=>{je.current=!0}),onFocus:Ht(e.onFocus,ct=>{const pt=!je.current;if(ct.target===ct.currentTarget&&pt&&!le){const Ze=new CustomEvent(zE,SK);if(ct.currentTarget.dispatchEvent(Ze),!Ze.defaultPrevented){const yt=Se().filter(Wt=>Wt.focusable),Mt=yt.find(Wt=>Wt.active),Jt=yt.find(Wt=>Wt.id===Q),Pt=[Mt,Jt,...yt].filter(Boolean).map(Wt=>Wt.ref.current);kF(Pt,O)}}je.current=!1}),onBlur:Ht(e.onBlur,()=>ae(!1))})})}),PF="RovingFocusGroupItem",IF=H.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:i,focusable:a=!0,active:d=!1,tabStopId:y,...S}=e,s=ba(),N=y||s,D=MK(PF,i),O=D.currentTabStopId===N,$=MF(i),{onFocusableItemAdd:q,onFocusableItemRemove:J}=D;return H.useEffect(()=>{if(a)return q(),()=>J()},[a,q,J]),f.jsx(wM.ItemSlot,{scope:i,id:N,focusable:a,active:d,children:f.jsx(wr.span,{tabIndex:O?0:-1,"data-orientation":D.orientation,...S,ref:t,onMouseDown:Ht(e.onMouseDown,re=>{a?D.onItemFocus(N):re.preventDefault()}),onFocus:Ht(e.onFocus,()=>D.onItemFocus(N)),onKeyDown:Ht(e.onKeyDown,re=>{if(re.key==="Tab"&&re.shiftKey){D.onItemShiftTab();return}if(re.target!==re.currentTarget)return;const Q=kK(re,D.orientation,D.dir);if(Q!==void 0){if(re.metaKey||re.ctrlKey||re.altKey||re.shiftKey)return;re.preventDefault();let le=$().filter(ae=>ae.focusable).map(ae=>ae.ref.current);if(Q==="last")le.reverse();else if(Q==="prev"||Q==="next"){Q==="prev"&&le.reverse();const ae=le.indexOf(re.currentTarget);le=D.loop?NK(le,ae+1):le.slice(ae+1)}setTimeout(()=>kF(le))}})})})});IF.displayName=PF;var PK={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function IK(e,t){return t!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function kK(e,t,i){const a=IK(e.key,i);if(!(t==="vertical"&&["ArrowLeft","ArrowRight"].includes(a))&&!(t==="horizontal"&&["ArrowUp","ArrowDown"].includes(a)))return PK[a]}function kF(e,t=!1){const i=document.activeElement;for(const a of e)if(a===i||(a.focus({preventScroll:t}),document.activeElement!==i))return}function NK(e,t){return e.map((i,a)=>e[(t+a)%e.length])}var vP=AF,bP=IF,RK=function(e){if(typeof document>"u")return null;var t=Array.isArray(e)?e[0]:e;return t.ownerDocument.body},vm=new WeakMap,gb=new WeakMap,_b={},FE=0,NF=function(e){return e&&(e.host||NF(e.parentNode))},jK=function(e,t){return t.map(function(i){if(e.contains(i))return i;var a=NF(i);return a&&e.contains(a)?a:(console.error("aria-hidden",i,"in not contained inside",e,". Doing nothing"),null)}).filter(function(i){return!!i})},DK=function(e,t,i,a){var d=jK(t,Array.isArray(e)?e:[e]);_b[i]||(_b[i]=new WeakMap);var y=_b[i],S=[],s=new Set,N=new Set(d),D=function($){!$||s.has($)||(s.add($),D($.parentNode))};d.forEach(D);var O=function($){!$||N.has($)||Array.prototype.forEach.call($.children,function(q){if(s.has(q))O(q);else try{var J=q.getAttribute(a),re=J!==null&&J!=="false",Q=(vm.get(q)||0)+1,ce=(y.get(q)||0)+1;vm.set(q,Q),y.set(q,ce),S.push(q),Q===1&&re&&gb.set(q,!0),ce===1&&q.setAttribute(i,"true"),re||q.setAttribute(a,"true")}catch(le){console.error("aria-hidden: cannot operate on ",q,le)}})};return O(t),s.clear(),FE++,function(){S.forEach(function($){var q=vm.get($)-1,J=y.get($)-1;vm.set($,q),y.set($,J),q||(gb.has($)||$.removeAttribute(a),gb.delete($)),J||$.removeAttribute(i)}),FE--,FE||(vm=new WeakMap,vm=new WeakMap,gb=new WeakMap,_b={})}},A2=function(e,t,i){i===void 0&&(i="data-aria-hidden");var a=Array.from(Array.isArray(e)?e:[e]),d=RK(e);return d?(a.push.apply(a,Array.from(d.querySelectorAll("[aria-live]"))),DK(a,d,i,"aria-hidden")):function(){return null}},_c=function(){return _c=Object.assign||function(t){for(var i,a=1,d=arguments.length;a<d;a++){i=arguments[a];for(var y in i)Object.prototype.hasOwnProperty.call(i,y)&&(t[y]=i[y])}return t},_c.apply(this,arguments)};function RF(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var d=0,a=Object.getOwnPropertySymbols(e);d<a.length;d++)t.indexOf(a[d])<0&&Object.prototype.propertyIsEnumerable.call(e,a[d])&&(i[a[d]]=e[a[d]]);return i}function LK(e,t,i){if(i||arguments.length===2)for(var a=0,d=t.length,y;a<d;a++)(y||!(a in t))&&(y||(y=Array.prototype.slice.call(t,0,a)),y[a]=t[a]);return e.concat(y||Array.prototype.slice.call(t))}var Ub="right-scroll-bar-position",$b="width-before-scroll-bar",OK="with-scroll-bars-hidden",zK="--removed-body-scroll-bar-size";function BE(e,t){return typeof e=="function"?e(t):e&&(e.current=t),e}function FK(e,t){var i=H.useState(function(){return{value:e,callback:t,facade:{get current(){return i.value},set current(a){var d=i.value;d!==a&&(i.value=a,i.callback(a,d))}}}})[0];return i.callback=t,i.facade}var BK=typeof window<"u"?H.useLayoutEffect:H.useEffect,tD=new WeakMap;function VK(e,t){var i=FK(null,function(a){return e.forEach(function(d){return BE(d,a)})});return BK(function(){var a=tD.get(i);if(a){var d=new Set(a),y=new Set(e),S=i.current;d.forEach(function(s){y.has(s)||BE(s,null)}),y.forEach(function(s){d.has(s)||BE(s,S)})}tD.set(i,e)},[e]),i}function UK(e){return e}function $K(e,t){t===void 0&&(t=UK);var i=[],a=!1,d={read:function(){if(a)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return i.length?i[i.length-1]:e},useMedium:function(y){var S=t(y,a);return i.push(S),function(){i=i.filter(function(s){return s!==S})}},assignSyncMedium:function(y){for(a=!0;i.length;){var S=i;i=[],S.forEach(y)}i={push:function(s){return y(s)},filter:function(){return i}}},assignMedium:function(y){a=!0;var S=[];if(i.length){var s=i;i=[],s.forEach(y),S=i}var N=function(){var O=S;S=[],O.forEach(y)},D=function(){return Promise.resolve().then(N)};D(),i={push:function(O){S.push(O),D()},filter:function(O){return S=S.filter(O),i}}}};return d}function GK(e){e===void 0&&(e={});var t=$K(null);return t.options=_c({async:!0,ssr:!1},e),t}var jF=function(e){var t=e.sideCar,i=RF(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var a=t.read();if(!a)throw new Error("Sidecar medium not found");return H.createElement(a,_c({},i))};jF.isSideCarExport=!0;function qK(e,t){return e.useMedium(t),jF}var DF=GK(),VE=function(){},P2=H.forwardRef(function(e,t){var i=H.useRef(null),a=H.useState({onScrollCapture:VE,onWheelCapture:VE,onTouchMoveCapture:VE}),d=a[0],y=a[1],S=e.forwardProps,s=e.children,N=e.className,D=e.removeScrollBar,O=e.enabled,$=e.shards,q=e.sideCar,J=e.noIsolation,re=e.inert,Q=e.allowPinchZoom,ce=e.as,le=ce===void 0?"div":ce,ae=e.gapMode,he=RF(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),Se=q,je=VK([i,t]),it=_c(_c({},he),d);return H.createElement(H.Fragment,null,O&&H.createElement(Se,{sideCar:DF,removeScrollBar:D,shards:$,noIsolation:J,inert:re,setCallbacks:y,allowPinchZoom:!!Q,lockRef:i,gapMode:ae}),S?H.cloneElement(H.Children.only(s),_c(_c({},it),{ref:je})):H.createElement(le,_c({},it,{className:N,ref:je}),s))});P2.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};P2.classNames={fullWidth:$b,zeroRight:Ub};var HK=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function WK(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=HK();return t&&e.setAttribute("nonce",t),e}function ZK(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function YK(e){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(e)}var XK=function(){var e=0,t=null;return{add:function(i){e==0&&(t=WK())&&(ZK(t,i),YK(t)),e++},remove:function(){e--,!e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},KK=function(){var e=XK();return function(t,i){H.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&i])}},LF=function(){var e=KK(),t=function(i){var a=i.styles,d=i.dynamic;return e(a,d),null};return t},JK={left:0,top:0,right:0,gap:0},UE=function(e){return parseInt(e||"",10)||0},QK=function(e){var t=window.getComputedStyle(document.body),i=t[e==="padding"?"paddingLeft":"marginLeft"],a=t[e==="padding"?"paddingTop":"marginTop"],d=t[e==="padding"?"paddingRight":"marginRight"];return[UE(i),UE(a),UE(d)]},eJ=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return JK;var t=QK(e),i=document.documentElement.clientWidth,a=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,a-i+t[2]-t[0])}},tJ=LF(),eg="data-scroll-locked",rJ=function(e,t,i,a){var d=e.left,y=e.top,S=e.right,s=e.gap;return i===void 0&&(i="margin"),`
  .`.concat(OK,` {
   overflow: hidden `).concat(a,`;
   padding-right: `).concat(s,"px ").concat(a,`;
  }
  body[`).concat(eg,`] {
    overflow: hidden `).concat(a,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(a,";"),i==="margin"&&`
    padding-left: `.concat(d,`px;
    padding-top: `).concat(y,`px;
    padding-right: `).concat(S,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(s,"px ").concat(a,`;
    `),i==="padding"&&"padding-right: ".concat(s,"px ").concat(a,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(Ub,` {
    right: `).concat(s,"px ").concat(a,`;
  }
  
  .`).concat($b,` {
    margin-right: `).concat(s,"px ").concat(a,`;
  }
  
  .`).concat(Ub," .").concat(Ub,` {
    right: 0 `).concat(a,`;
  }
  
  .`).concat($b," .").concat($b,` {
    margin-right: 0 `).concat(a,`;
  }
  
  body[`).concat(eg,`] {
    `).concat(zK,": ").concat(s,`px;
  }
`)},rD=function(){var e=parseInt(document.body.getAttribute(eg)||"0",10);return isFinite(e)?e:0},nJ=function(){H.useEffect(function(){return document.body.setAttribute(eg,(rD()+1).toString()),function(){var e=rD()-1;e<=0?document.body.removeAttribute(eg):document.body.setAttribute(eg,e.toString())}},[])},iJ=function(e){var t=e.noRelative,i=e.noImportant,a=e.gapMode,d=a===void 0?"margin":a;nJ();var y=H.useMemo(function(){return eJ(d)},[d]);return H.createElement(tJ,{styles:rJ(y,!t,d,i?"":"!important")})},SM=!1;if(typeof window<"u")try{var yb=Object.defineProperty({},"passive",{get:function(){return SM=!0,!0}});window.addEventListener("test",yb,yb),window.removeEventListener("test",yb,yb)}catch{SM=!1}var bm=SM?{passive:!1}:!1,sJ=function(e){return e.tagName==="TEXTAREA"},OF=function(e,t){if(!(e instanceof Element))return!1;var i=window.getComputedStyle(e);return i[t]!=="hidden"&&!(i.overflowY===i.overflowX&&!sJ(e)&&i[t]==="visible")},oJ=function(e){return OF(e,"overflowY")},aJ=function(e){return OF(e,"overflowX")},nD=function(e,t){var i=t.ownerDocument,a=t;do{typeof ShadowRoot<"u"&&a instanceof ShadowRoot&&(a=a.host);var d=zF(e,a);if(d){var y=FF(e,a),S=y[1],s=y[2];if(S>s)return!0}a=a.parentNode}while(a&&a!==i.body);return!1},lJ=function(e){var t=e.scrollTop,i=e.scrollHeight,a=e.clientHeight;return[t,i,a]},cJ=function(e){var t=e.scrollLeft,i=e.scrollWidth,a=e.clientWidth;return[t,i,a]},zF=function(e,t){return e==="v"?oJ(t):aJ(t)},FF=function(e,t){return e==="v"?lJ(t):cJ(t)},uJ=function(e,t){return e==="h"&&t==="rtl"?-1:1},dJ=function(e,t,i,a,d){var y=uJ(e,window.getComputedStyle(t).direction),S=y*a,s=i.target,N=t.contains(s),D=!1,O=S>0,$=0,q=0;do{var J=FF(e,s),re=J[0],Q=J[1],ce=J[2],le=Q-ce-y*re;(re||le)&&zF(e,s)&&($+=le,q+=re),s instanceof ShadowRoot?s=s.host:s=s.parentNode}while(!N&&s!==document.body||N&&(t.contains(s)||t===s));return(O&&(Math.abs($)<1||!d)||!O&&(Math.abs(q)<1||!d))&&(D=!0),D},xb=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},iD=function(e){return[e.deltaX,e.deltaY]},sD=function(e){return e&&"current"in e?e.current:e},hJ=function(e,t){return e[0]===t[0]&&e[1]===t[1]},fJ=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},pJ=0,wm=[];function mJ(e){var t=H.useRef([]),i=H.useRef([0,0]),a=H.useRef(),d=H.useState(pJ++)[0],y=H.useState(LF)[0],S=H.useRef(e);H.useEffect(function(){S.current=e},[e]),H.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(d));var Q=LK([e.lockRef.current],(e.shards||[]).map(sD),!0).filter(Boolean);return Q.forEach(function(ce){return ce.classList.add("allow-interactivity-".concat(d))}),function(){document.body.classList.remove("block-interactivity-".concat(d)),Q.forEach(function(ce){return ce.classList.remove("allow-interactivity-".concat(d))})}}},[e.inert,e.lockRef.current,e.shards]);var s=H.useCallback(function(Q,ce){if("touches"in Q&&Q.touches.length===2||Q.type==="wheel"&&Q.ctrlKey)return!S.current.allowPinchZoom;var le=xb(Q),ae=i.current,he="deltaX"in Q?Q.deltaX:ae[0]-le[0],Se="deltaY"in Q?Q.deltaY:ae[1]-le[1],je,it=Q.target,qe=Math.abs(he)>Math.abs(Se)?"h":"v";if("touches"in Q&&qe==="h"&&it.type==="range")return!1;var ct=nD(qe,it);if(!ct)return!0;if(ct?je=qe:(je=qe==="v"?"h":"v",ct=nD(qe,it)),!ct)return!1;if(!a.current&&"changedTouches"in Q&&(he||Se)&&(a.current=je),!je)return!0;var pt=a.current||je;return dJ(pt,ce,Q,pt==="h"?he:Se,!0)},[]),N=H.useCallback(function(Q){var ce=Q;if(!(!wm.length||wm[wm.length-1]!==y)){var le="deltaY"in ce?iD(ce):xb(ce),ae=t.current.filter(function(je){return je.name===ce.type&&(je.target===ce.target||ce.target===je.shadowParent)&&hJ(je.delta,le)})[0];if(ae&&ae.should){ce.cancelable&&ce.preventDefault();return}if(!ae){var he=(S.current.shards||[]).map(sD).filter(Boolean).filter(function(je){return je.contains(ce.target)}),Se=he.length>0?s(ce,he[0]):!S.current.noIsolation;Se&&ce.cancelable&&ce.preventDefault()}}},[]),D=H.useCallback(function(Q,ce,le,ae){var he={name:Q,delta:ce,target:le,should:ae,shadowParent:gJ(le)};t.current.push(he),setTimeout(function(){t.current=t.current.filter(function(Se){return Se!==he})},1)},[]),O=H.useCallback(function(Q){i.current=xb(Q),a.current=void 0},[]),$=H.useCallback(function(Q){D(Q.type,iD(Q),Q.target,s(Q,e.lockRef.current))},[]),q=H.useCallback(function(Q){D(Q.type,xb(Q),Q.target,s(Q,e.lockRef.current))},[]);H.useEffect(function(){return wm.push(y),e.setCallbacks({onScrollCapture:$,onWheelCapture:$,onTouchMoveCapture:q}),document.addEventListener("wheel",N,bm),document.addEventListener("touchmove",N,bm),document.addEventListener("touchstart",O,bm),function(){wm=wm.filter(function(Q){return Q!==y}),document.removeEventListener("wheel",N,bm),document.removeEventListener("touchmove",N,bm),document.removeEventListener("touchstart",O,bm)}},[]);var J=e.removeScrollBar,re=e.inert;return H.createElement(H.Fragment,null,re?H.createElement(y,{styles:fJ(d)}):null,J?H.createElement(iJ,{gapMode:e.gapMode}):null)}function gJ(e){for(var t=null;e!==null;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const _J=qK(DF,mJ);var Gv=H.forwardRef(function(e,t){return H.createElement(P2,_c({},e,{ref:t,sideCar:_J}))});Gv.classNames=P2.classNames;var TM=["Enter"," "],yJ=["ArrowDown","PageUp","Home"],BF=["ArrowUp","PageDown","End"],xJ=[...yJ,...BF],vJ={ltr:[...TM,"ArrowRight"],rtl:[...TM,"ArrowLeft"]},bJ={ltr:["ArrowLeft"],rtl:["ArrowRight"]},qv="Menu",[cv,wJ,SJ]=Dg(qv),[ep,VF]=ta(qv,[SJ,gh,$g]),I2=gh(),UF=$g(),[TJ,tp]=ep(qv),[EJ,Hv]=ep(qv),$F=e=>{const{__scopeMenu:t,open:i=!1,children:a,dir:d,onOpenChange:y,modal:S=!0}=e,s=I2(t),[N,D]=H.useState(null),O=H.useRef(!1),$=oi(y),q=Qf(d);return H.useEffect(()=>{const J=()=>{O.current=!0,document.addEventListener("pointerdown",re,{capture:!0,once:!0}),document.addEventListener("pointermove",re,{capture:!0,once:!0})},re=()=>O.current=!1;return document.addEventListener("keydown",J,{capture:!0}),()=>{document.removeEventListener("keydown",J,{capture:!0}),document.removeEventListener("pointerdown",re,{capture:!0}),document.removeEventListener("pointermove",re,{capture:!0})}},[]),f.jsx(aP,{...s,children:f.jsx(TJ,{scope:t,open:i,onOpenChange:$,content:N,onContentChange:D,children:f.jsx(EJ,{scope:t,onClose:H.useCallback(()=>$(!1),[$]),isUsingKeyboardRef:O,dir:q,modal:S,children:a})})})};$F.displayName=qv;var CJ="MenuAnchor",wP=H.forwardRef((e,t)=>{const{__scopeMenu:i,...a}=e,d=I2(i);return f.jsx(Vv,{...d,...a,ref:t})});wP.displayName=CJ;var SP="MenuPortal",[MJ,GF]=ep(SP,{forceMount:void 0}),qF=e=>{const{__scopeMenu:t,forceMount:i,children:a,container:d}=e,y=tp(SP,t);return f.jsx(MJ,{scope:t,forceMount:i,children:f.jsx(Yi,{present:i||y.open,children:f.jsx(Lg,{asChild:!0,container:d,children:a})})})};qF.displayName=SP;var Wa="MenuContent",[AJ,TP]=ep(Wa),HF=H.forwardRef((e,t)=>{const i=GF(Wa,e.__scopeMenu),{forceMount:a=i.forceMount,...d}=e,y=tp(Wa,e.__scopeMenu),S=Hv(Wa,e.__scopeMenu);return f.jsx(cv.Provider,{scope:e.__scopeMenu,children:f.jsx(Yi,{present:a||y.open,children:f.jsx(cv.Slot,{scope:e.__scopeMenu,children:S.modal?f.jsx(PJ,{...d,ref:t}):f.jsx(IJ,{...d,ref:t})})})})}),PJ=H.forwardRef((e,t)=>{const i=tp(Wa,e.__scopeMenu),a=H.useRef(null),d=dn(t,a);return H.useEffect(()=>{const y=a.current;if(y)return A2(y)},[]),f.jsx(EP,{...e,ref:d,trapFocus:i.open,disableOutsidePointerEvents:i.open,disableOutsideScroll:!0,onFocusOutside:Ht(e.onFocusOutside,y=>y.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>i.onOpenChange(!1)})}),IJ=H.forwardRef((e,t)=>{const i=tp(Wa,e.__scopeMenu);return f.jsx(EP,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>i.onOpenChange(!1)})}),EP=H.forwardRef((e,t)=>{const{__scopeMenu:i,loop:a=!1,trapFocus:d,onOpenAutoFocus:y,onCloseAutoFocus:S,disableOutsidePointerEvents:s,onEntryFocus:N,onEscapeKeyDown:D,onPointerDownOutside:O,onFocusOutside:$,onInteractOutside:q,onDismiss:J,disableOutsideScroll:re,...Q}=e,ce=tp(Wa,i),le=Hv(Wa,i),ae=I2(i),he=UF(i),Se=wJ(i),[je,it]=H.useState(null),qe=H.useRef(null),ct=dn(t,qe,ce.onContentChange),pt=H.useRef(0),Ze=H.useRef(""),yt=H.useRef(0),Mt=H.useRef(null),Jt=H.useRef("right"),jt=H.useRef(0),Pt=re?Gv:H.Fragment,Wt=re?{as:Tc,allowPinchZoom:!0}:void 0,Nt=nt=>{var qt,Br;const Qt=Ze.current+nt,rr=Se().filter(xn=>!xn.disabled),mr=document.activeElement,Ut=(qt=rr.find(xn=>xn.ref.current===mr))==null?void 0:qt.textValue,hn=rr.map(xn=>xn.textValue),Gn=UJ(hn,Qt,Ut),At=(Br=rr.find(xn=>xn.textValue===Gn))==null?void 0:Br.ref.current;(function xn(de){Ze.current=de,window.clearTimeout(pt.current),de!==""&&(pt.current=window.setTimeout(()=>xn(""),1e3))})(Qt),At&&setTimeout(()=>At.focus())};H.useEffect(()=>()=>window.clearTimeout(pt.current),[]),C2();const Xe=H.useCallback(nt=>{var rr,mr;return Jt.current===((rr=Mt.current)==null?void 0:rr.side)&&GJ(nt,(mr=Mt.current)==null?void 0:mr.area)},[]);return f.jsx(AJ,{scope:i,searchRef:Ze,onItemEnter:H.useCallback(nt=>{Xe(nt)&&nt.preventDefault()},[Xe]),onItemLeave:H.useCallback(nt=>{var Qt;Xe(nt)||((Qt=qe.current)==null||Qt.focus(),it(null))},[Xe]),onTriggerLeave:H.useCallback(nt=>{Xe(nt)&&nt.preventDefault()},[Xe]),pointerGraceTimerRef:yt,onPointerGraceIntentChange:H.useCallback(nt=>{Mt.current=nt},[]),children:f.jsx(Pt,{...Wt,children:f.jsx($v,{asChild:!0,trapped:d,onMountAutoFocus:Ht(y,nt=>{var Qt;nt.preventDefault(),(Qt=qe.current)==null||Qt.focus({preventScroll:!0})}),onUnmountAutoFocus:S,children:f.jsx(mh,{asChild:!0,disableOutsidePointerEvents:s,onEscapeKeyDown:D,onPointerDownOutside:O,onFocusOutside:$,onInteractOutside:q,onDismiss:J,children:f.jsx(vP,{asChild:!0,...he,dir:le.dir,orientation:"vertical",loop:a,currentTabStopId:je,onCurrentTabStopIdChange:it,onEntryFocus:Ht(N,nt=>{le.isUsingKeyboardRef.current||nt.preventDefault()}),preventScrollOnEntryFocus:!0,children:f.jsx(y2,{role:"menu","aria-orientation":"vertical","data-state":l5(ce.open),"data-radix-menu-content":"",dir:le.dir,...ae,...Q,ref:ct,style:{outline:"none",...Q.style},onKeyDown:Ht(Q.onKeyDown,nt=>{const rr=nt.target.closest("[data-radix-menu-content]")===nt.currentTarget,mr=nt.ctrlKey||nt.altKey||nt.metaKey,Ut=nt.key.length===1;rr&&(nt.key==="Tab"&&nt.preventDefault(),!mr&&Ut&&Nt(nt.key));const hn=qe.current;if(nt.target!==hn||!xJ.includes(nt.key))return;nt.preventDefault();const At=Se().filter(qt=>!qt.disabled).map(qt=>qt.ref.current);BF.includes(nt.key)&&At.reverse(),BJ(At)}),onBlur:Ht(e.onBlur,nt=>{nt.currentTarget.contains(nt.target)||(window.clearTimeout(pt.current),Ze.current="")}),onPointerMove:Ht(e.onPointerMove,uv(nt=>{const Qt=nt.target,rr=jt.current!==nt.clientX;if(nt.currentTarget.contains(Qt)&&rr){const mr=nt.clientX>jt.current?"right":"left";Jt.current=mr,jt.current=nt.clientX}}))})})})})})})});HF.displayName=Wa;var kJ="MenuGroup",CP=H.forwardRef((e,t)=>{const{__scopeMenu:i,...a}=e;return f.jsx(wr.div,{role:"group",...a,ref:t})});CP.displayName=kJ;var NJ="MenuLabel",WF=H.forwardRef((e,t)=>{const{__scopeMenu:i,...a}=e;return f.jsx(wr.div,{...a,ref:t})});WF.displayName=NJ;var Mw="MenuItem",oD="menu.itemSelect",k2=H.forwardRef((e,t)=>{const{disabled:i=!1,onSelect:a,...d}=e,y=H.useRef(null),S=Hv(Mw,e.__scopeMenu),s=TP(Mw,e.__scopeMenu),N=dn(t,y),D=H.useRef(!1),O=()=>{const $=y.current;if(!i&&$){const q=new CustomEvent(oD,{bubbles:!0,cancelable:!0});$.addEventListener(oD,J=>a==null?void 0:a(J),{once:!0}),Qx($,q),q.defaultPrevented?D.current=!1:S.onClose()}};return f.jsx(ZF,{...d,ref:N,disabled:i,onClick:Ht(e.onClick,O),onPointerDown:$=>{var q;(q=e.onPointerDown)==null||q.call(e,$),D.current=!0},onPointerUp:Ht(e.onPointerUp,$=>{var q;D.current||(q=$.currentTarget)==null||q.click()}),onKeyDown:Ht(e.onKeyDown,$=>{const q=s.searchRef.current!=="";i||q&&$.key===" "||TM.includes($.key)&&($.currentTarget.click(),$.preventDefault())})})});k2.displayName=Mw;var ZF=H.forwardRef((e,t)=>{const{__scopeMenu:i,disabled:a=!1,textValue:d,...y}=e,S=TP(Mw,i),s=UF(i),N=H.useRef(null),D=dn(t,N),[O,$]=H.useState(!1),[q,J]=H.useState("");return H.useEffect(()=>{const re=N.current;re&&J((re.textContent??"").trim())},[y.children]),f.jsx(cv.ItemSlot,{scope:i,disabled:a,textValue:d??q,children:f.jsx(bP,{asChild:!0,...s,focusable:!a,children:f.jsx(wr.div,{role:"menuitem","data-highlighted":O?"":void 0,"aria-disabled":a||void 0,"data-disabled":a?"":void 0,...y,ref:D,onPointerMove:Ht(e.onPointerMove,uv(re=>{a?S.onItemLeave(re):(S.onItemEnter(re),re.defaultPrevented||re.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:Ht(e.onPointerLeave,uv(re=>S.onItemLeave(re))),onFocus:Ht(e.onFocus,()=>$(!0)),onBlur:Ht(e.onBlur,()=>$(!1))})})})}),RJ="MenuCheckboxItem",YF=H.forwardRef((e,t)=>{const{checked:i=!1,onCheckedChange:a,...d}=e;return f.jsx(e5,{scope:e.__scopeMenu,checked:i,children:f.jsx(k2,{role:"menuitemcheckbox","aria-checked":Aw(i)?"mixed":i,...d,ref:t,"data-state":AP(i),onSelect:Ht(d.onSelect,()=>a==null?void 0:a(Aw(i)?!0:!i),{checkForDefaultPrevented:!1})})})});YF.displayName=RJ;var XF="MenuRadioGroup",[jJ,DJ]=ep(XF,{value:void 0,onValueChange:()=>{}}),KF=H.forwardRef((e,t)=>{const{value:i,onValueChange:a,...d}=e,y=oi(a);return f.jsx(jJ,{scope:e.__scopeMenu,value:i,onValueChange:y,children:f.jsx(CP,{...d,ref:t})})});KF.displayName=XF;var JF="MenuRadioItem",QF=H.forwardRef((e,t)=>{const{value:i,...a}=e,d=DJ(JF,e.__scopeMenu),y=i===d.value;return f.jsx(e5,{scope:e.__scopeMenu,checked:y,children:f.jsx(k2,{role:"menuitemradio","aria-checked":y,...a,ref:t,"data-state":AP(y),onSelect:Ht(a.onSelect,()=>{var S;return(S=d.onValueChange)==null?void 0:S.call(d,i)},{checkForDefaultPrevented:!1})})})});QF.displayName=JF;var MP="MenuItemIndicator",[e5,LJ]=ep(MP,{checked:!1}),t5=H.forwardRef((e,t)=>{const{__scopeMenu:i,forceMount:a,...d}=e,y=LJ(MP,i);return f.jsx(Yi,{present:a||Aw(y.checked)||y.checked===!0,children:f.jsx(wr.span,{...d,ref:t,"data-state":AP(y.checked)})})});t5.displayName=MP;var OJ="MenuSeparator",r5=H.forwardRef((e,t)=>{const{__scopeMenu:i,...a}=e;return f.jsx(wr.div,{role:"separator","aria-orientation":"horizontal",...a,ref:t})});r5.displayName=OJ;var zJ="MenuArrow",n5=H.forwardRef((e,t)=>{const{__scopeMenu:i,...a}=e,d=I2(i);return f.jsx(x2,{...d,...a,ref:t})});n5.displayName=zJ;var FJ="MenuSub",[yce,i5]=ep(FJ),dx="MenuSubTrigger",s5=H.forwardRef((e,t)=>{const i=tp(dx,e.__scopeMenu),a=Hv(dx,e.__scopeMenu),d=i5(dx,e.__scopeMenu),y=TP(dx,e.__scopeMenu),S=H.useRef(null),{pointerGraceTimerRef:s,onPointerGraceIntentChange:N}=y,D={__scopeMenu:e.__scopeMenu},O=H.useCallback(()=>{S.current&&window.clearTimeout(S.current),S.current=null},[]);return H.useEffect(()=>O,[O]),H.useEffect(()=>{const $=s.current;return()=>{window.clearTimeout($),N(null)}},[s,N]),f.jsx(wP,{asChild:!0,...D,children:f.jsx(ZF,{id:d.triggerId,"aria-haspopup":"menu","aria-expanded":i.open,"aria-controls":d.contentId,"data-state":l5(i.open),...e,ref:zv(t,d.onTriggerChange),onClick:$=>{var q;(q=e.onClick)==null||q.call(e,$),!(e.disabled||$.defaultPrevented)&&($.currentTarget.focus(),i.open||i.onOpenChange(!0))},onPointerMove:Ht(e.onPointerMove,uv($=>{y.onItemEnter($),!$.defaultPrevented&&!e.disabled&&!i.open&&!S.current&&(y.onPointerGraceIntentChange(null),S.current=window.setTimeout(()=>{i.onOpenChange(!0),O()},100))})),onPointerLeave:Ht(e.onPointerLeave,uv($=>{var J,re;O();const q=(J=i.content)==null?void 0:J.getBoundingClientRect();if(q){const Q=(re=i.content)==null?void 0:re.dataset.side,ce=Q==="right",le=ce?-5:5,ae=q[ce?"left":"right"],he=q[ce?"right":"left"];y.onPointerGraceIntentChange({area:[{x:$.clientX+le,y:$.clientY},{x:ae,y:q.top},{x:he,y:q.top},{x:he,y:q.bottom},{x:ae,y:q.bottom}],side:Q}),window.clearTimeout(s.current),s.current=window.setTimeout(()=>y.onPointerGraceIntentChange(null),300)}else{if(y.onTriggerLeave($),$.defaultPrevented)return;y.onPointerGraceIntentChange(null)}})),onKeyDown:Ht(e.onKeyDown,$=>{var J;const q=y.searchRef.current!=="";e.disabled||q&&$.key===" "||vJ[a.dir].includes($.key)&&(i.onOpenChange(!0),(J=i.content)==null||J.focus(),$.preventDefault())})})})});s5.displayName=dx;var o5="MenuSubContent",a5=H.forwardRef((e,t)=>{const i=GF(Wa,e.__scopeMenu),{forceMount:a=i.forceMount,...d}=e,y=tp(Wa,e.__scopeMenu),S=Hv(Wa,e.__scopeMenu),s=i5(o5,e.__scopeMenu),N=H.useRef(null),D=dn(t,N);return f.jsx(cv.Provider,{scope:e.__scopeMenu,children:f.jsx(Yi,{present:a||y.open,children:f.jsx(cv.Slot,{scope:e.__scopeMenu,children:f.jsx(EP,{id:s.contentId,"aria-labelledby":s.triggerId,...d,ref:D,align:"start",side:S.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:O=>{var $;S.isUsingKeyboardRef.current&&(($=N.current)==null||$.focus()),O.preventDefault()},onCloseAutoFocus:O=>O.preventDefault(),onFocusOutside:Ht(e.onFocusOutside,O=>{O.target!==s.trigger&&y.onOpenChange(!1)}),onEscapeKeyDown:Ht(e.onEscapeKeyDown,O=>{S.onClose(),O.preventDefault()}),onKeyDown:Ht(e.onKeyDown,O=>{var J;const $=O.currentTarget.contains(O.target),q=bJ[S.dir].includes(O.key);$&&q&&(y.onOpenChange(!1),(J=s.trigger)==null||J.focus(),O.preventDefault())})})})})})});a5.displayName=o5;function l5(e){return e?"open":"closed"}function Aw(e){return e==="indeterminate"}function AP(e){return Aw(e)?"indeterminate":e?"checked":"unchecked"}function BJ(e){const t=document.activeElement;for(const i of e)if(i===t||(i.focus(),document.activeElement!==t))return}function VJ(e,t){return e.map((i,a)=>e[(t+a)%e.length])}function UJ(e,t,i){const d=t.length>1&&Array.from(t).every(D=>D===t[0])?t[0]:t,y=i?e.indexOf(i):-1;let S=VJ(e,Math.max(y,0));d.length===1&&(S=S.filter(D=>D!==i));const N=S.find(D=>D.toLowerCase().startsWith(d.toLowerCase()));return N!==i?N:void 0}function $J(e,t){const{x:i,y:a}=e;let d=!1;for(let y=0,S=t.length-1;y<t.length;S=y++){const s=t[y].x,N=t[y].y,D=t[S].x,O=t[S].y;N>a!=O>a&&i<(D-s)*(a-N)/(O-N)+s&&(d=!d)}return d}function GJ(e,t){if(!t)return!1;const i={x:e.clientX,y:e.clientY};return $J(i,t)}function uv(e){return t=>t.pointerType==="mouse"?e(t):void 0}var qJ=$F,HJ=wP,WJ=qF,ZJ=HF,YJ=CP,XJ=WF,KJ=k2,JJ=YF,QJ=KF,eQ=QF,tQ=t5,rQ=r5,nQ=n5,iQ=s5,sQ=a5,PP="DropdownMenu",[oQ,xce]=ta(PP,[VF]),No=VF(),[aQ,c5]=oQ(PP),u5=e=>{const{__scopeDropdownMenu:t,children:i,dir:a,open:d,defaultOpen:y,onOpenChange:S,modal:s=!0}=e,N=No(t),D=H.useRef(null),[O=!1,$]=Xa({prop:d,defaultProp:y,onChange:S});return f.jsx(aQ,{scope:t,triggerId:ba(),triggerRef:D,contentId:ba(),open:O,onOpenChange:$,onOpenToggle:H.useCallback(()=>$(q=>!q),[$]),modal:s,children:f.jsx(qJ,{...N,open:O,onOpenChange:$,dir:a,modal:s,children:i})})};u5.displayName=PP;var d5="DropdownMenuTrigger",h5=H.forwardRef((e,t)=>{const{__scopeDropdownMenu:i,disabled:a=!1,...d}=e,y=c5(d5,i),S=No(i);return f.jsx(HJ,{asChild:!0,...S,children:f.jsx(wr.button,{type:"button",id:y.triggerId,"aria-haspopup":"menu","aria-expanded":y.open,"aria-controls":y.open?y.contentId:void 0,"data-state":y.open?"open":"closed","data-disabled":a?"":void 0,disabled:a,...d,ref:zv(t,y.triggerRef),onPointerDown:Ht(e.onPointerDown,s=>{!a&&s.button===0&&s.ctrlKey===!1&&(y.onOpenToggle(),y.open||s.preventDefault())}),onKeyDown:Ht(e.onKeyDown,s=>{a||(["Enter"," "].includes(s.key)&&y.onOpenToggle(),s.key==="ArrowDown"&&y.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(s.key)&&s.preventDefault())})})})});h5.displayName=d5;var lQ="DropdownMenuPortal",f5=e=>{const{__scopeDropdownMenu:t,...i}=e,a=No(t);return f.jsx(WJ,{...a,...i})};f5.displayName=lQ;var p5="DropdownMenuContent",m5=H.forwardRef((e,t)=>{const{__scopeDropdownMenu:i,...a}=e,d=c5(p5,i),y=No(i),S=H.useRef(!1);return f.jsx(ZJ,{id:d.contentId,"aria-labelledby":d.triggerId,...y,...a,ref:t,onCloseAutoFocus:Ht(e.onCloseAutoFocus,s=>{var N;S.current||(N=d.triggerRef.current)==null||N.focus(),S.current=!1,s.preventDefault()}),onInteractOutside:Ht(e.onInteractOutside,s=>{const N=s.detail.originalEvent,D=N.button===0&&N.ctrlKey===!0,O=N.button===2||D;(!d.modal||O)&&(S.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});m5.displayName=p5;var cQ="DropdownMenuGroup",uQ=H.forwardRef((e,t)=>{const{__scopeDropdownMenu:i,...a}=e,d=No(i);return f.jsx(YJ,{...d,...a,ref:t})});uQ.displayName=cQ;var dQ="DropdownMenuLabel",g5=H.forwardRef((e,t)=>{const{__scopeDropdownMenu:i,...a}=e,d=No(i);return f.jsx(XJ,{...d,...a,ref:t})});g5.displayName=dQ;var hQ="DropdownMenuItem",_5=H.forwardRef((e,t)=>{const{__scopeDropdownMenu:i,...a}=e,d=No(i);return f.jsx(KJ,{...d,...a,ref:t})});_5.displayName=hQ;var fQ="DropdownMenuCheckboxItem",y5=H.forwardRef((e,t)=>{const{__scopeDropdownMenu:i,...a}=e,d=No(i);return f.jsx(JJ,{...d,...a,ref:t})});y5.displayName=fQ;var pQ="DropdownMenuRadioGroup",mQ=H.forwardRef((e,t)=>{const{__scopeDropdownMenu:i,...a}=e,d=No(i);return f.jsx(QJ,{...d,...a,ref:t})});mQ.displayName=pQ;var gQ="DropdownMenuRadioItem",x5=H.forwardRef((e,t)=>{const{__scopeDropdownMenu:i,...a}=e,d=No(i);return f.jsx(eQ,{...d,...a,ref:t})});x5.displayName=gQ;var _Q="DropdownMenuItemIndicator",v5=H.forwardRef((e,t)=>{const{__scopeDropdownMenu:i,...a}=e,d=No(i);return f.jsx(tQ,{...d,...a,ref:t})});v5.displayName=_Q;var yQ="DropdownMenuSeparator",b5=H.forwardRef((e,t)=>{const{__scopeDropdownMenu:i,...a}=e,d=No(i);return f.jsx(rQ,{...d,...a,ref:t})});b5.displayName=yQ;var xQ="DropdownMenuArrow",vQ=H.forwardRef((e,t)=>{const{__scopeDropdownMenu:i,...a}=e,d=No(i);return f.jsx(nQ,{...d,...a,ref:t})});vQ.displayName=xQ;var bQ="DropdownMenuSubTrigger",w5=H.forwardRef((e,t)=>{const{__scopeDropdownMenu:i,...a}=e,d=No(i);return f.jsx(iQ,{...d,...a,ref:t})});w5.displayName=bQ;var wQ="DropdownMenuSubContent",S5=H.forwardRef((e,t)=>{const{__scopeDropdownMenu:i,...a}=e,d=No(i);return f.jsx(sQ,{...d,...a,ref:t,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});S5.displayName=wQ;var SQ=u5,TQ=h5,EQ=f5,T5=m5,E5=g5,C5=_5,M5=y5,A5=x5,P5=v5,I5=b5,k5=w5,N5=S5;const R5=SQ,j5=TQ,CQ=H.forwardRef(({className:e,inset:t,children:i,...a},d)=>f.jsxs(k5,{ref:d,className:br("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",t&&"pl-8",e),...a,children:[i,f.jsx(q4,{className:"ml-auto h-4 w-4"})]}));CQ.displayName=k5.displayName;const MQ=H.forwardRef(({className:e,...t},i)=>f.jsx(N5,{ref:i,className:br("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...t}));MQ.displayName=N5.displayName;const IP=H.forwardRef(({className:e,sideOffset:t=4,...i},a)=>f.jsx(EQ,{children:f.jsx(T5,{ref:a,sideOffset:t,className:br("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...i})}));IP.displayName=T5.displayName;const Ad=H.forwardRef(({className:e,inset:t,...i},a)=>f.jsx(C5,{ref:a,className:br("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t&&"pl-8",e),...i}));Ad.displayName=C5.displayName;const AQ=H.forwardRef(({className:e,children:t,checked:i,...a},d)=>f.jsxs(M5,{ref:d,className:br("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:i,...a,children:[f.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:f.jsx(P5,{children:f.jsx(Co,{className:"h-4 w-4"})})}),t]}));AQ.displayName=M5.displayName;const PQ=H.forwardRef(({className:e,children:t,...i},a)=>f.jsxs(A5,{ref:a,className:br("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...i,children:[f.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:f.jsx(P5,{children:f.jsx(H4,{className:"h-2 w-2 fill-current"})})}),t]}));PQ.displayName=A5.displayName;const IQ=H.forwardRef(({className:e,inset:t,...i},a)=>f.jsx(E5,{ref:a,className:br("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",e),...i}));IQ.displayName=E5.displayName;const kQ=H.forwardRef(({className:e,...t},i)=>f.jsx(I5,{ref:i,className:br("-mx-1 my-1 h-px bg-muted",e),...t}));kQ.displayName=I5.displayName;const $E=768;function NQ(){const[e,t]=H.useState(void 0);return H.useEffect(()=>{const i=window.matchMedia(`(max-width: ${$E-1}px)`),a=()=>{t(window.innerWidth<$E)};return i.addEventListener("change",a),t(window.innerWidth<$E),()=>i.removeEventListener("change",a)},[]),!!e}const gi=()=>{const e=NQ();H.useState(!1);const t=$l(),i=a=>{a.preventDefault(),t("/login?fromNav=true")};return f.jsx("div",{className:"bg-white border-b shadow-sm sticky top-0 z-50",children:f.jsxs("div",{className:"container flex items-center justify-between py-4",children:[f.jsxs(un,{to:"/",className:"flex items-center gap-2 font-bold text-2xl text-swap-blue",children:[f.jsx("div",{className:"relative",children:f.jsx(f2,{className:"h-8 w-8 text-swap-blue animate-pulse hover:animate-spin transition-all duration-300"})}),"SwapSpot"]}),e?f.jsxs(R5,{children:[f.jsx(j5,{asChild:!0,children:f.jsx(Kt,{variant:"ghost",size:"icon",children:f.jsx(EW,{className:"h-5 w-5"})})}),f.jsxs(IP,{align:"end",className:"w-[180px]",children:[f.jsx(Ad,{asChild:!0,children:f.jsx(un,{to:"/",children:"Home"})}),f.jsx(Ad,{asChild:!0,children:f.jsx(un,{to:"/post-place",children:"Post a Place"})}),f.jsx(Ad,{asChild:!0,children:f.jsx(un,{to:"/help-tips",children:"Help & Tips"})}),f.jsx(Ad,{asChild:!0,children:f.jsx(un,{to:"/community",children:"Community"})}),f.jsx(Ad,{asChild:!0,children:f.jsx(un,{to:"#",onClick:i,children:"Log In"})}),f.jsx(Ad,{asChild:!0,children:f.jsx(un,{to:"/signup",children:"Sign Up"})})]})]}):f.jsxs("div",{className:"flex items-center space-x-4",children:[f.jsx(SF,{children:f.jsxs(TF,{children:[f.jsx(pb,{children:f.jsx(mb,{children:f.jsx(un,{to:"/how-it-works",className:ux(),children:"How it Works"})})}),f.jsx(pb,{children:f.jsx(mb,{children:f.jsx(un,{to:"/help-tips",className:ux(),children:"Help & Tips"})})}),f.jsx(pb,{children:f.jsx(mb,{children:f.jsx(un,{to:"/community",className:ux(),children:"Community"})})}),f.jsx(pb,{children:f.jsx(mb,{children:f.jsx(un,{to:"/about",className:ux(),children:"About"})})})]})}),f.jsx(Kt,{variant:"outline",asChild:!0,children:f.jsx(un,{to:"#",onClick:i,children:"Log In"})}),f.jsx(Kt,{asChild:!0,children:f.jsx(un,{to:"/signup",children:"Sign Up"})})]})]})})};function RQ(){return f.jsx("section",{className:"bg-gradient-to-b from-white to-swap-lightBlue py-20 md:py-28",children:f.jsxs("div",{className:"max-w-7xl mx-auto px-4 md:px-8 text-center",children:[f.jsx("div",{className:"mb-4",children:f.jsx("span",{className:"bg-swap-blue text-white px-4 py-2 rounded-full text-sm font-medium",children:"Made Exclusively for Exchange Students"})}),f.jsxs("h1",{className:"text-4xl md:text-6xl font-bold text-gray-900 mb-6",children:[f.jsx("span",{className:"text-swap-blue",children:"We Do All The Work"})," - You Just Study Abroad"]}),f.jsx("p",{className:"text-xl md:text-2xl text-gray-600 mb-4 max-w-4xl mx-auto",children:"Stop spending hours searching for exchange housing swaps. Tell us your university exchange preferences once, and we'll automatically find and deliver perfect student matches to your inbox."}),f.jsx("p",{className:"text-lg text-gray-500 mb-10 max-w-3xl mx-auto",children:"No browsing, no endless searching, no stress. We handle everything while you focus on what matters most - your studies abroad and exchange experience."}),f.jsxs("div",{className:"flex flex-col sm:flex-row justify-center gap-4",children:[f.jsx(Kt,{asChild:!0,size:"lg",className:"text-lg px-8 py-6 bg-swap-blue hover:bg-swap-blue/90",children:f.jsx(un,{to:"/signup",children:"Find My Exchange Housing Match"})}),f.jsx(Kt,{asChild:!0,variant:"outline",size:"lg",className:"text-lg px-8 py-6",children:f.jsx(un,{to:"/how-it-works",children:"See How We Work For Exchange Students"})})]}),f.jsxs("div",{className:"mt-12 bg-white/70 backdrop-blur-sm rounded-lg p-6 max-w-4xl mx-auto",children:[f.jsx("p",{className:"text-gray-700 font-medium",children:`"Finally, a service that actually works FOR exchange students instead of making us do all the work. SwapSpot found my perfect semester abroad housing match in 2 days - I didn't have to search through hundreds of listings!"`}),f.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"- Sarah M., studying abroad in Barcelona"})]})]})})}const Zr=H.forwardRef(({className:e,...t},i)=>f.jsx("div",{ref:i,className:br("rounded-lg border bg-card text-card-foreground shadow-sm",e),...t}));Zr.displayName="Card";const zn=H.forwardRef(({className:e,...t},i)=>f.jsx("div",{ref:i,className:br("flex flex-col space-y-1.5 p-6",e),...t}));zn.displayName="CardHeader";const Fn=H.forwardRef(({className:e,...t},i)=>f.jsx("h3",{ref:i,className:br("text-2xl font-semibold leading-none tracking-tight",e),...t}));Fn.displayName="CardTitle";const oo=H.forwardRef(({className:e,...t},i)=>f.jsx("p",{ref:i,className:br("text-sm text-muted-foreground",e),...t}));oo.displayName="CardDescription";const Kr=H.forwardRef(({className:e,...t},i)=>f.jsx("div",{ref:i,className:br("p-6 pt-0",e),...t}));Kr.displayName="CardContent";const N2=H.forwardRef(({className:e,...t},i)=>f.jsx("div",{ref:i,className:br("flex items-center p-6 pt-0",e),...t}));N2.displayName="CardFooter";const jQ=()=>f.jsx("div",{className:"w-full py-16 bg-white",children:f.jsxs("div",{className:"container mx-auto",children:[f.jsxs("div",{className:"text-center mb-12",children:[f.jsx("h2",{className:"text-3xl font-bold mb-4",children:"Direct Housing Swaps Made Simple"}),f.jsx("p",{className:"text-gray-600 max-w-2xl mx-auto",children:"No middleman, no points system, no extra fees. Just direct exchanges between verified students for the exact dates you need."})]}),f.jsx("div",{className:"max-w-2xl mx-auto",children:f.jsxs(Zr,{children:[f.jsx(zn,{className:"bg-swap-lightBlue rounded-t-lg",children:f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{children:[f.jsx(Fn,{className:"text-2xl",children:"Student Housing Swap"}),f.jsx(oo,{className:"text-gray-700",children:"Direct exchange with verified students worldwide"})]}),f.jsx("div",{className:"bg-swap-blue rounded-full p-3",children:f.jsx(f2,{className:"h-8 w-8 text-white"})})]})}),f.jsxs(Kr,{className:"pt-6",children:[f.jsx("p",{className:"mb-4",children:"Perfect for students seeking authentic exchanges. Swap your accommodation directly with another verified student for your exact study dates—no fees, no points, just a fair trade."}),f.jsxs("ul",{className:"space-y-2 mb-6",children:[f.jsxs("li",{className:"flex items-start",children:[f.jsx("div",{className:"bg-green-100 rounded-full p-1 mr-2 mt-0.5",children:f.jsx("svg",{className:"h-3 w-3 text-green-600",fill:"currentColor",viewBox:"0 0 20 20",children:f.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),f.jsxs("span",{children:[f.jsx("strong",{children:"Zero extra costs:"})," Pay only your existing rent"]})]}),f.jsxs("li",{className:"flex items-start",children:[f.jsx("div",{className:"bg-green-100 rounded-full p-1 mr-2 mt-0.5",children:f.jsx("svg",{className:"h-3 w-3 text-green-600",fill:"currentColor",viewBox:"0 0 20 20",children:f.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),f.jsxs("span",{children:[f.jsx("strong",{children:"Verified students only:"})," University email verification required"]})]}),f.jsxs("li",{className:"flex items-start",children:[f.jsx("div",{className:"bg-green-100 rounded-full p-1 mr-2 mt-0.5",children:f.jsx("svg",{className:"h-3 w-3 text-green-600",fill:"currentColor",viewBox:"0 0 20 20",children:f.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),f.jsxs("span",{children:[f.jsx("strong",{children:"Date matching:"})," Find swaps for your exact study period"]})]})]})]}),f.jsx(N2,{children:f.jsx(Kt,{asChild:!0,className:"w-full bg-swap-blue hover:bg-swap-darkBlue",children:f.jsxs(un,{to:"/browse",children:["Start Your Housing Swap ",f.jsx(WA,{className:"ml-2 h-4 w-4"})]})})})]})})]})});function DQ(){const e=[{icon:f.jsx(yw,{className:"h-8 w-8 text-swap-blue"}),title:"You tell us your exchange needs",description:"Share your university exchange program, study abroad dates, destination preferences, and housing requirements. That's it - we handle the rest."},{icon:f.jsx(XA,{className:"h-8 w-8 text-swap-blue"}),title:"We do the searching for exchange students",description:"Our intelligent system works 24/7, automatically scanning and analyzing thousands of verified university student profiles to find your perfect exchange matches."},{icon:f.jsx(Qo,{className:"h-8 w-8 text-swap-blue"}),title:"We deliver your student matches",description:"Receive curated exchange student match notifications with complete profiles and contact details - no searching, no browsing, just perfect study abroad matches."},{icon:f.jsx(pu,{className:"h-8 w-8 text-swap-blue"}),title:"You connect and swap for your exchange",description:"Simply reach out to your pre-screened exchange student matches to finalize details. We've already done all the hard work of finding compatibility for your study abroad experience."}];return f.jsx("section",{className:"py-16 bg-white",children:f.jsxs("div",{className:"max-w-7xl mx-auto px-4 md:px-8",children:[f.jsxs("div",{className:"text-center mb-16",children:[f.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[f.jsx(Kf,{className:"h-8 w-8 text-swap-blue"}),f.jsx("span",{className:"text-swap-blue font-semibold text-lg",children:"For University Exchange Students"})]}),f.jsx("h2",{className:"text-3xl md:text-4xl font-bold mb-4",children:"We Handle Everything So Exchange Students Don't Have To"}),f.jsx("p",{className:"text-xl text-gray-600 max-w-3xl mx-auto",children:"Stop wasting time on endless searches. Our AI-powered system works around the clock to find your perfect study abroad housing match automatically."})]}),f.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8",children:e.map((t,i)=>f.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-100 shadow-sm hover:shadow-md transition-shadow text-center",children:[f.jsx("div",{className:"bg-swap-lightBlue p-3 rounded-full w-fit mx-auto mb-4",children:t.icon}),f.jsx("div",{className:"bg-swap-blue text-white rounded-full w-8 h-8 flex items-center justify-center mx-auto mb-3 text-sm font-bold",children:i+1}),f.jsx("h3",{className:"text-xl font-semibold mb-3",children:t.title}),f.jsx("p",{className:"text-gray-600",children:t.description})]},i))}),f.jsx("div",{className:"mt-16 text-center",children:f.jsxs("div",{className:"bg-swap-lightBlue rounded-lg p-8 max-w-4xl mx-auto",children:[f.jsx("h3",{className:"text-2xl font-bold text-swap-darkBlue mb-4",children:"Zero Effort, Maximum Exchange Results"}),f.jsxs("p",{className:"text-gray-700 text-lg",children:["While you focus on your studies and exchange preparations, our advanced matching system works continuously to find university students who perfectly complement your study abroad needs. We analyze compatibility factors, verify student status, and deliver only the highest-quality exchange matches directly to you.",f.jsx("span",{className:"font-semibold text-swap-darkBlue",children:" You literally don't have to do anything except provide your exchange preferences once."})]})]})})]})})}const LQ=Og("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function wn({className:e,variant:t,...i}){return f.jsx("div",{className:br(LQ({variant:t}),e),...i})}function OQ(e,t=[]){let i=[];function a(y,S){const s=H.createContext(S),N=i.length;i=[...i,S];function D($){const{scope:q,children:J,...re}=$,Q=(q==null?void 0:q[e][N])||s,ce=H.useMemo(()=>re,Object.values(re));return f.jsx(Q.Provider,{value:ce,children:J})}function O($,q){const J=(q==null?void 0:q[e][N])||s,re=H.useContext(J);if(re)return re;if(S!==void 0)return S;throw new Error(`\`${$}\` must be used within \`${y}\``)}return D.displayName=y+"Provider",[D,O]}const d=()=>{const y=i.map(S=>H.createContext(S));return function(s){const N=(s==null?void 0:s[e])||y;return H.useMemo(()=>({[`__scope${e}`]:{...s,[e]:N}}),[s,N])}};return d.scopeName=e,[a,zQ(d,...t)]}function zQ(...e){const t=e[0];if(e.length===1)return t;const i=()=>{const a=e.map(d=>({useScope:d(),scopeName:d.scopeName}));return function(y){const S=a.reduce((s,{useScope:N,scopeName:D})=>{const $=N(y)[`__scope${D}`];return{...s,...$}},{});return H.useMemo(()=>({[`__scope${t.scopeName}`]:S}),[S])}};return i.scopeName=t.scopeName,i}var kP="Progress",NP=100,[FQ,vce]=OQ(kP),[BQ,VQ]=FQ(kP),D5=H.forwardRef((e,t)=>{const{__scopeProgress:i,value:a=null,max:d,getValueLabel:y=UQ,...S}=e;(d||d===0)&&!aD(d)&&console.error($Q(`${d}`,"Progress"));const s=aD(d)?d:NP;a!==null&&!lD(a,s)&&console.error(GQ(`${a}`,"Progress"));const N=lD(a,s)?a:null,D=Pw(N)?y(N,s):void 0;return f.jsx(BQ,{scope:i,value:N,max:s,children:f.jsx(wr.div,{"aria-valuemax":s,"aria-valuemin":0,"aria-valuenow":Pw(N)?N:void 0,"aria-valuetext":D,role:"progressbar","data-state":z5(N,s),"data-value":N??void 0,"data-max":s,...S,ref:t})})});D5.displayName=kP;var L5="ProgressIndicator",O5=H.forwardRef((e,t)=>{const{__scopeProgress:i,...a}=e,d=VQ(L5,i);return f.jsx(wr.div,{"data-state":z5(d.value,d.max),"data-value":d.value??void 0,"data-max":d.max,...a,ref:t})});O5.displayName=L5;function UQ(e,t){return`${Math.round(e/t*100)}%`}function z5(e,t){return e==null?"indeterminate":e===t?"complete":"loading"}function Pw(e){return typeof e=="number"}function aD(e){return Pw(e)&&!isNaN(e)&&e>0}function lD(e,t){return Pw(e)&&!isNaN(e)&&e<=t&&e>=0}function $Q(e,t){return`Invalid prop \`max\` of value \`${e}\` supplied to \`${t}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${NP}\`.`}function GQ(e,t){return`Invalid prop \`value\` of value \`${e}\` supplied to \`${t}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${NP} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var F5=D5,qQ=O5;const Iw=H.forwardRef(({className:e,value:t,...i},a)=>f.jsx(F5,{ref:a,className:br("relative h-4 w-full overflow-hidden rounded-full bg-secondary",e),...i,children:f.jsx(qQ,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})}));Iw.displayName=F5.displayName;function R2({userStartDate:e,userEndDate:t,swapStartDate:i,swapEndDate:a,compatibility:d,variant:y="default",className:S}){if(d!==void 0){const ce=d>=90?{color:"bg-green-50 text-green-700 border-green-200",icon:f.jsx(pu,{className:"h-3 w-3"}),text:"Excellent match"}:d>=70?{color:"bg-yellow-50 text-yellow-700 border-yellow-200",icon:f.jsx(PE,{className:"h-3 w-3"}),text:"Good match"}:{color:"bg-orange-50 text-orange-700 border-orange-200",icon:f.jsx(Km,{className:"h-3 w-3"}),text:"Partial match"};return y==="compact"?f.jsx("div",{className:S,children:f.jsxs(wn,{variant:"secondary",className:`${ce.color} flex items-center gap-1`,children:[ce.icon,d,"%"]})}):f.jsx("div",{className:S,children:f.jsxs("div",{className:"space-y-2",children:[f.jsxs(wn,{variant:"secondary",className:`${ce.color} flex items-center gap-1`,children:[ce.icon,d,"% compatibility • ",ce.text]}),f.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[f.jsx(Iw,{value:d,className:"flex-1 h-2"}),f.jsxs("span",{children:[d,"%"]})]})]})})}if(!e||!t||!i||!a)return f.jsx("div",{className:S,children:f.jsxs(wn,{variant:"outline",className:"bg-gray-50 text-gray-600",children:[f.jsx(PE,{className:"h-3 w-3 mr-1"}),"Select your dates to see compatibility"]})});const s=new Date(Math.max(e.getTime(),i.getTime())),N=new Date(Math.min(t.getTime(),a.getTime()));if(!(s<=N))return f.jsx("div",{className:S,children:f.jsxs(wn,{variant:"destructive",className:"flex items-center gap-1",children:[f.jsx(Km,{className:"h-3 w-3"}),"No overlap with your dates"]})});const O=t.getTime()-e.getTime(),$=N.getTime()-s.getTime(),q=Math.round($/O*100),re=q>=90?{color:"bg-green-50 text-green-700 border-green-200",icon:f.jsx(pu,{className:"h-3 w-3"}),text:"Excellent match"}:q>=70?{color:"bg-yellow-50 text-yellow-700 border-yellow-200",icon:f.jsx(PE,{className:"h-3 w-3"}),text:"Good match"}:{color:"bg-orange-50 text-orange-700 border-orange-200",icon:f.jsx(Km,{className:"h-3 w-3"}),text:"Partial match"};return f.jsx("div",{className:S,children:f.jsxs("div",{className:"space-y-2",children:[f.jsxs(wn,{variant:"secondary",className:`${re.color} flex items-center gap-1`,children:[re.icon,q,"% overlap • ",re.text]}),f.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[f.jsx(Iw,{value:q,className:"flex-1 h-2"}),f.jsxs("span",{children:[q,"%"]})]}),f.jsxs("p",{className:"text-xs text-gray-500",children:["Your dates overlap for ",Math.ceil($/(1e3*60*60*24))," days"]})]})})}const HQ=[{id:1,user:{name:"Emma Johnson",avatar:"https://i.pravatar.cc/150?img=1",university:"Sciences Po Paris",isVerified:!0,verificationMethod:"University Email"},current:{city:"Paris, France",type:"Studio Apartment",price:"€800/month",image:"https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8NHx8YXBhcnRtZW50fGVufDB8fDB8fHww&auto=format&fit=crop&w=600&q=60"},wanted:{city:"Madrid, Spain",type:"Any",price:"€600-800/month"},dates:"Sep 5, 2023 - Feb 20, 2024",tags:["Near University","Furnished","Public Transit"]},{id:2,user:{name:"Miguel Santos",avatar:"https://i.pravatar.cc/150?img=11",university:"University of Barcelona",isVerified:!0,verificationMethod:"Student ID Card"},current:{city:"Barcelona, Spain",type:"1 Bedroom Apartment",price:"€750/month",image:"https://images.unsplash.com/photo-1493809842364-78817add7ffb?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTB8fGFwYXJ0bWVudHxlbnwwfHwwfHx8MA%3D%3D&auto=format&fit=crop&w=600&q=60"},wanted:{city:"Berlin, Germany",type:"Studio or Room",price:"€500-800/month"},dates:"Oct 10, 2023 - Mar 15, 2024",tags:["Balcony","WiFi","Furnished"]},{id:3,user:{name:"Sophie Weber",avatar:"https://i.pravatar.cc/150?img=5",university:"Humboldt University",isVerified:!1,verificationMethod:null},current:{city:"Berlin, Germany",type:"2 Bedroom Apartment (Shared)",price:"€550/month",image:"https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTd8fGFwYXJ0bWVudHxlbnwwfHwwfHx8MA%3D%3D&auto=format&fit=crop&w=600&q=60"},wanted:{city:"Copenhagen, Denmark",type:"Any",price:"€500-700/month"},dates:"Jan 15, 2024 - Jun 30, 2024",tags:["Pet Friendly","Near Park","Bicycle Storage"]}];function cD(){const[e,t]=H.useState(HQ),i=new Date(2023,8,15),a=new Date(2024,1,10),d=y=>{const[S,s]=y.split(" - ");return{startDate:new Date(S+", "+new Date().getFullYear()),endDate:new Date(s)}};return f.jsx("section",{className:"py-16 bg-gray-50",children:f.jsxs("div",{className:"max-w-7xl mx-auto px-4 md:px-8",children:[f.jsxs("div",{className:"text-center mb-12",children:[f.jsx("h2",{className:"text-3xl md:text-4xl font-bold mb-4",children:"Featured Swap Opportunities"}),f.jsx("p",{className:"text-xl text-gray-600 max-w-2xl mx-auto",children:"Browse verified student swaps from top universities around the world."})]}),f.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:e.map(y=>{const{startDate:S,endDate:s}=d(y.dates);return f.jsxs(Zr,{className:"overflow-hidden hover:shadow-md transition-shadow",children:[f.jsx(zn,{className:"pb-2",children:f.jsx("div",{className:"flex justify-between items-start",children:f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx("img",{src:y.user.avatar,alt:y.user.name,className:"w-10 h-10 rounded-full object-cover"}),f.jsxs("div",{children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx(Fn,{className:"text-lg",children:y.user.name}),y.user.isVerified?f.jsxs(wn,{variant:"secondary",className:"bg-green-50 text-green-700 border-green-200 flex items-center gap-1",children:[f.jsx(Ao,{className:"h-3 w-3"}),"Verified"]}):f.jsx(wn,{variant:"outline",className:"bg-gray-50 text-gray-600 border-gray-200",children:"Unverified"})]}),f.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-600",children:[f.jsx(Kf,{className:"h-3 w-3"}),f.jsx(oo,{children:y.user.university})]}),y.user.isVerified&&y.user.verificationMethod&&f.jsxs("p",{className:"text-xs text-green-600",children:["Verified via ",y.user.verificationMethod]})]})]})})}),f.jsxs(Kr,{children:[f.jsx("div",{className:"flex items-center justify-between mb-4 pt-2",children:f.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-600",children:[f.jsx(nh,{className:"h-4 w-4 text-swap-blue"}),f.jsx("span",{children:y.dates})]})}),f.jsx(R2,{userStartDate:i,userEndDate:a,swapStartDate:S,swapEndDate:s,className:"mb-4"}),f.jsx("div",{className:"mb-4 aspect-video rounded-md overflow-hidden",children:f.jsx("img",{src:y.current.image,alt:`${y.current.city} apartment`,className:"w-full h-full object-cover"})}),f.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[f.jsxs("div",{className:"bg-swap-lightBlue rounded-lg p-4",children:[f.jsx("h4",{className:"font-medium mb-2 text-sm uppercase text-gray-500",children:"Current Place"}),f.jsxs("div",{className:"mb-2",children:[f.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[f.jsx(Ec,{className:"h-4 w-4 text-swap-blue"}),f.jsx("span",{className:"font-medium",children:y.current.city})]}),f.jsx("p",{className:"text-sm text-gray-600",children:y.current.type})]}),f.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[f.jsx(xg,{className:"h-4 w-4"}),f.jsx("span",{children:y.current.price})]})]}),f.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[f.jsx("h4",{className:"font-medium mb-2 text-sm uppercase text-gray-500",children:"Looking For"}),f.jsxs("div",{className:"mb-2",children:[f.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[f.jsx(Ec,{className:"h-4 w-4 text-swap-blue"}),f.jsx("span",{className:"font-medium",children:y.wanted.city})]}),f.jsx("p",{className:"text-sm text-gray-600",children:y.wanted.type})]}),f.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[f.jsx(xg,{className:"h-4 w-4"}),f.jsx("span",{children:y.wanted.price})]})]})]}),f.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:y.tags.map((N,D)=>f.jsx(wn,{variant:"secondary",className:"bg-gray-100 text-gray-800 hover:bg-gray-200",children:N},D))})]}),f.jsx(N2,{children:f.jsx(Kt,{asChild:!0,className:"w-full bg-swap-blue hover:bg-swap-darkBlue",children:f.jsxs(un,{to:`/swaps/${y.id}`,children:[f.jsx(f2,{className:"h-4 w-4 mr-2"}),"View Swap Details"]})})})]},y.id)})}),f.jsx("div",{className:"text-center mt-12",children:f.jsx(Kt,{variant:"outline",asChild:!0,className:"border-swap-blue text-swap-blue hover:bg-swap-lightBlue px-6",children:f.jsx(un,{to:"/browse",children:"View All Swaps"})})})]})})}function WQ(){const e=[{id:1,quote:"I was dreading spending weeks searching for a housing swap for my semester in Spain. SwapSpot found my perfect exchange student match in just 3 days without me having to do anything. They literally did all the work while I focused on preparing for my study abroad experience.",name:"Marco Rodriguez",role:"Business Student, Exchange to Barcelona",program:"Universitat Pompeu Fabra Exchange Program",avatar:"https://i.pravatar.cc/150?img=53"},{id:2,quote:"Finally, a service that actually works FOR exchange students instead of making us work. I got three perfect student matches delivered to my email for my London semester - no browsing, no endless scrolling. SwapSpot did everything.",name:"Sophie Chen",role:"International Relations Exchange Student",program:"LSE Study Abroad Program",avatar:"https://i.pravatar.cc/150?img=20"},{id:3,quote:"The best part? I literally did nothing except fill out my exchange preferences once. SwapSpot's system found my ideal housing partner for my medical exchange and handled all the matching. I could focus entirely on my studies abroad preparation.",name:"Emma Thompson",role:"Medical Student Exchange",program:"King's College London Exchange",avatar:"https://i.pravatar.cc/150?img=32"}];return f.jsx("section",{className:"py-16 bg-gray-50",children:f.jsxs("div",{className:"max-w-7xl mx-auto px-4 md:px-8",children:[f.jsxs("div",{className:"text-center mb-12",children:[f.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[f.jsx(Kf,{className:"h-6 w-6 text-swap-blue"}),f.jsx("span",{className:"text-swap-blue font-semibold",children:"Exchange Student Success Stories"})]}),f.jsx("h2",{className:"text-3xl md:text-4xl font-bold mb-4",children:"Exchange Students Love How We Work For Them"}),f.jsx("p",{className:"text-xl text-gray-600 max-w-3xl mx-auto",children:"Hear from university students who saved dozens of hours by letting SwapSpot handle all the searching and matching work for their study abroad experience."})]}),f.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:e.map(t=>f.jsxs("div",{className:"bg-white p-6 rounded-lg relative shadow-sm",children:[f.jsx(PW,{className:"h-10 w-10 text-swap-blue/20 absolute top-6 left-6"}),f.jsxs("div",{className:"pt-8",children:[f.jsxs("p",{className:"text-gray-700 mb-6 relative z-10",children:['"',t.quote,'"']}),f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx("img",{src:t.avatar,alt:t.name,className:"w-12 h-12 rounded-full object-cover"}),f.jsxs("div",{children:[f.jsx("h4",{className:"font-semibold",children:t.name}),f.jsx("p",{className:"text-sm text-gray-600",children:t.role}),f.jsx("p",{className:"text-xs text-gray-500",children:t.program})]})]})]})]},t.id))}),f.jsx("div",{className:"mt-16 text-center",children:f.jsxs("div",{className:"bg-swap-blue rounded-lg p-8 text-white max-w-4xl mx-auto",children:[f.jsx("h3",{className:"text-2xl font-bold mb-4",children:"We Do The Heavy Lifting, Exchange Students Get The Results"}),f.jsxs("p",{className:"text-lg text-white/90",children:["Every day, our system processes thousands of university student profiles, analyzes compatibility factors, and identifies perfect exchange matches. While you sleep, study, or prepare for your study abroad adventure, we're working 24/7 to find your ideal housing partner.",f.jsx("span",{className:"font-semibold",children:" That's the SwapSpot difference - maximum results with zero effort from exchange students."})]})]})})]})})}function ZQ(){const e=["We find compatible exchange students automatically","We verify all university student profiles for you","We deliver semester abroad matches directly to your inbox","We handle all the tedious searching and filtering for your exchange"];return f.jsx("section",{className:"py-16 bg-swap-lightBlue",children:f.jsx("div",{className:"max-w-7xl mx-auto px-4 md:px-8",children:f.jsxs("div",{className:"text-center md:text-left",children:[f.jsxs("div",{className:"flex items-center justify-center md:justify-start gap-2 mb-4",children:[f.jsx(Kf,{className:"h-6 w-6 text-swap-blue"}),f.jsx("span",{className:"text-swap-blue font-semibold",children:"Built for Exchange Students"})]}),f.jsx("h2",{className:"text-3xl md:text-4xl font-bold mb-6",children:"Stop Searching. Start Your Exchange Adventure."}),f.jsx("p",{className:"text-lg text-gray-700 mb-8 max-w-3xl mx-auto md:mx-0",children:"Why spend countless hours browsing through listings when we can do all the work for you? Our intelligent system finds, filters, and delivers perfect exchange student matches while you focus on what really matters - preparing for your study abroad experience."}),f.jsx("ul",{className:"space-y-4 mb-8 max-w-md mx-auto md:mx-0",children:e.map((t,i)=>f.jsxs("li",{className:"flex items-center gap-3",children:[f.jsx(pu,{className:"h-5 w-5 text-swap-blue flex-shrink-0"}),f.jsx("span",{children:t})]},i))}),f.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-lg p-6 mb-8 max-w-2xl mx-auto md:mx-0",children:[f.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[f.jsx(ev,{className:"h-6 w-6 text-swap-blue"}),f.jsx("span",{className:"font-semibold text-swap-darkBlue",children:"Time You'll Save on Your Exchange Planning"})]}),f.jsx("p",{className:"text-swap-darkBlue font-medium",children:"Average exchange student spends 40+ hours searching for housing swaps. With SwapSpot, you spend 5 minutes setting up your profile, and we do the other 39 hours and 55 minutes of work for you."})]}),f.jsx(Kt,{className:"bg-swap-blue hover:bg-swap-darkBlue text-white px-6 py-6",asChild:!0,children:f.jsxs(un,{to:"/signup",children:["Let Us Work For Your Exchange",f.jsx(WA,{className:"h-4 w-4 ml-2"})]})})]})})})}function _i(){const e=()=>{window.scrollTo({top:0,behavior:"smooth"})};return f.jsx("footer",{className:"bg-gray-50 pt-12 pb-8 px-4 md:px-8",children:f.jsxs("div",{className:"max-w-7xl mx-auto",children:[f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-8 mb-8",children:[f.jsxs("div",{children:[f.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[f.jsx(Xm,{className:"h-6 w-6 text-swap-blue"}),f.jsx("h3",{className:"font-bold text-xl text-swap-darkBlue",children:"SwapSpot"})]}),f.jsx("p",{className:"text-gray-600",children:"Making student exchanges easier with perfect accommodation matches."})]}),f.jsxs("div",{children:[f.jsx("h4",{className:"font-semibold text-lg mb-4",children:"Company"}),f.jsxs("ul",{className:"space-y-2",children:[f.jsx("li",{children:f.jsx(un,{to:"/about",onClick:e,className:"text-gray-600 hover:text-swap-blue",children:"About Us"})}),f.jsx("li",{children:f.jsx(un,{to:"/careers",onClick:e,className:"text-gray-600 hover:text-swap-blue",children:"Careers"})})]})]}),f.jsxs("div",{children:[f.jsx("h4",{className:"font-semibold text-lg mb-4",children:"Resources"}),f.jsxs("ul",{className:"space-y-2",children:[f.jsx("li",{children:f.jsx(un,{to:"/how-it-works",onClick:e,className:"text-gray-600 hover:text-swap-blue",children:"How It Works"})}),f.jsx("li",{children:f.jsx(un,{to:"/safety",onClick:e,className:"text-gray-600 hover:text-swap-blue",children:"Safety"})}),f.jsx("li",{children:f.jsx(un,{to:"/faq",onClick:e,className:"text-gray-600 hover:text-swap-blue",children:"FAQ"})}),f.jsx("li",{children:f.jsx(un,{to:"/community",onClick:e,className:"text-gray-600 hover:text-swap-blue",children:"Community"})}),f.jsx("li",{children:f.jsx(un,{to:"/terms",onClick:e,className:"text-gray-600 hover:text-swap-blue",children:"Terms of Service"})})]})]}),f.jsxs("div",{children:[f.jsx("h4",{className:"font-semibold text-lg mb-4",children:"Contact"}),f.jsxs("ul",{className:"space-y-3",children:[f.jsxs("li",{className:"flex items-center gap-2",children:[f.jsx(Vf,{className:"h-5 w-5 text-swap-blue"}),f.jsx("a",{href:"mailto:hello@swapspot.com",className:"text-gray-600 hover:text-swap-blue",children:"hello@swapspot.com"})]}),f.jsxs("li",{className:"flex items-center gap-2",children:[f.jsx(vg,{className:"h-5 w-5 text-swap-blue"}),f.jsx(un,{to:"/support",onClick:e,className:"text-gray-600 hover:text-swap-blue",children:"Support"})]})]})]})]}),f.jsx("div",{className:"pt-8 border-t border-gray-200",children:f.jsxs("p",{className:"text-center text-gray-500",children:["© ",new Date().getFullYear()," SwapSpot. All rights reserved."]})})]})})}function YQ({userPreferences:e,className:t}){const i=[{id:"1",title:"Cozy Studio Near Campus",location:"Barcelona, Spain",dates:{startDate:"2025-09-01",endDate:"2025-12-15"},university:"Universitat de Barcelona",hostName:"Maria García",hostAvatar:"https://images.unsplash.com/photo-1494790108755-2616b612b193?w=150&h=150&fit=crop&crop=face",images:["https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?w=400&h=300&fit=crop"],compatibility:95,type:"Room Swap",price:"€450/month",verified:!0},{id:"2",title:"Modern Apartment Downtown",location:"Paris, France",dates:{startDate:"2025-08-15",endDate:"2025-12-20"},university:"Sorbonne University",hostName:"Pierre Dubois",hostAvatar:"https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=150&h=150&fit=crop&crop=face",images:["https://images.unsplash.com/photo-1502672260266-1c1ef2d93688?w=400&h=300&fit=crop"],compatibility:87,type:"Full Apartment",price:"€600/month",verified:!0},{id:"3",title:"Student Dorm Room",location:"Amsterdam, Netherlands",dates:{startDate:"2025-09-15",endDate:"2025-01-15"},university:"University of Amsterdam",hostName:"Emma van der Berg",hostAvatar:"https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=150&h=150&fit=crop&crop=face",images:["https://images.unsplash.com/photo-1555854877-bab0e5734e27?w=400&h=300&fit=crop"],compatibility:82,type:"Room Swap",verified:!1}];return f.jsxs("div",{className:t,children:[f.jsxs("div",{className:"mb-6",children:[f.jsx("h2",{className:"text-2xl font-bold text-swap-blue mb-2",children:"Recommended for You"}),f.jsx("p",{className:"text-gray-600",children:"Based on your preferences and profile, here are your top compatible swaps"})]}),f.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:i.map((a,d)=>f.jsxs(Zr,{className:"overflow-hidden hover:shadow-lg transition-shadow",children:[f.jsxs("div",{className:"relative",children:[f.jsx("img",{src:a.images[0],alt:a.title,className:"w-full h-48 object-cover"}),f.jsx("div",{className:"absolute top-3 left-3",children:f.jsxs(wn,{className:"bg-swap-blue text-white",children:["#",d+1," Match"]})}),f.jsx("div",{className:"absolute top-3 right-3",children:f.jsx(R2,{compatibility:a.compatibility,variant:"compact"})}),a.verified&&f.jsx("div",{className:"absolute bottom-3 left-3",children:f.jsx(wn,{variant:"secondary",className:"bg-green-50 text-green-700 border-green-200",children:"Verified"})})]}),f.jsxs(zn,{className:"pb-3",children:[f.jsx(Fn,{className:"text-lg",children:a.title}),f.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx(Ec,{className:"h-4 w-4"}),f.jsx("span",{children:a.location})]}),a.price&&f.jsx(wn,{variant:"outline",children:a.price})]})]}),f.jsxs(Kr,{className:"space-y-3",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("img",{src:a.hostAvatar,alt:a.hostName,className:"w-8 h-8 rounded-full"}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm font-medium",children:a.hostName}),f.jsx("p",{className:"text-xs text-gray-500",children:a.university})]})]}),f.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-600",children:[f.jsx(nh,{className:"h-4 w-4"}),f.jsxs("span",{children:[new Date(a.dates.startDate).toLocaleDateString()," - ",new Date(a.dates.endDate).toLocaleDateString()]})]}),f.jsxs("div",{className:"flex gap-2",children:[f.jsx(Kt,{asChild:!0,className:"flex-1",children:f.jsx(un,{to:`/swaps/${a.id}`,children:"View Details"})}),f.jsx(Kt,{variant:"outline",size:"sm",className:"px-3",children:f.jsx(Dl,{className:"h-4 w-4"})})]})]})]},a.id))}),f.jsx("div",{className:"mt-6 text-center",children:f.jsx(Kt,{variant:"outline",asChild:!0,children:f.jsx(un,{to:"/browse",children:"View All Swaps"})})})]})}const XQ="modulepreload",KQ=function(e){return"/"+e},uD={},Tg=function(t,i,a){let d=Promise.resolve();if(i&&i.length>0){document.getElementsByTagName("link");const S=document.querySelector("meta[property=csp-nonce]"),s=(S==null?void 0:S.nonce)||(S==null?void 0:S.getAttribute("nonce"));d=Promise.allSettled(i.map(N=>{if(N=KQ(N),N in uD)return;uD[N]=!0;const D=N.endsWith(".css"),O=D?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${N}"]${O}`))return;const $=document.createElement("link");if($.rel=D?"stylesheet":XQ,D||($.as="script"),$.crossOrigin="",$.href=N,s&&$.setAttribute("nonce",s),document.head.appendChild($),D)return new Promise((q,J)=>{$.addEventListener("load",q),$.addEventListener("error",()=>J(new Error(`Unable to preload CSS for ${N}`)))})}))}function y(S){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=S,window.dispatchEvent(s),!s.defaultPrevented)throw S}return d.then(S=>{for(const s of S||[])s.status==="rejected"&&y(s.reason);return t().catch(y)})},JQ=e=>{let t;return e?t=e:typeof fetch>"u"?t=(...i)=>Tg(async()=>{const{default:a}=await Promise.resolve().then(()=>Gg);return{default:a}},void 0).then(({default:a})=>a(...i)):t=fetch,(...i)=>t(...i)};class RP extends Error{constructor(t,i="FunctionsError",a){super(t),this.name=i,this.context=a}}class QQ extends RP{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class eee extends RP{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class tee extends RP{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var EM;(function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"})(EM||(EM={}));var ree=function(e,t,i,a){function d(y){return y instanceof i?y:new i(function(S){S(y)})}return new(i||(i=Promise))(function(y,S){function s(O){try{D(a.next(O))}catch($){S($)}}function N(O){try{D(a.throw(O))}catch($){S($)}}function D(O){O.done?y(O.value):d(O.value).then(s,N)}D((a=a.apply(e,t||[])).next())})};class nee{constructor(t,{headers:i={},customFetch:a,region:d=EM.Any}={}){this.url=t,this.headers=i,this.region=d,this.fetch=JQ(a)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t,i={}){var a;return ree(this,void 0,void 0,function*(){try{const{headers:d,method:y,body:S}=i;let s={},{region:N}=i;N||(N=this.region),N&&N!=="any"&&(s["x-region"]=N);let D;S&&(d&&!Object.prototype.hasOwnProperty.call(d,"Content-Type")||!d)&&(typeof Blob<"u"&&S instanceof Blob||S instanceof ArrayBuffer?(s["Content-Type"]="application/octet-stream",D=S):typeof S=="string"?(s["Content-Type"]="text/plain",D=S):typeof FormData<"u"&&S instanceof FormData?D=S:(s["Content-Type"]="application/json",D=JSON.stringify(S)));const O=yield this.fetch(`${this.url}/${t}`,{method:y||"POST",headers:Object.assign(Object.assign(Object.assign({},s),this.headers),d),body:D}).catch(re=>{throw new QQ(re)}),$=O.headers.get("x-relay-error");if($&&$==="true")throw new eee(O);if(!O.ok)throw new tee(O);let q=((a=O.headers.get("Content-Type"))!==null&&a!==void 0?a:"text/plain").split(";")[0].trim(),J;return q==="application/json"?J=yield O.json():q==="application/octet-stream"?J=yield O.blob():q==="text/event-stream"?J=O:q==="multipart/form-data"?J=yield O.formData():J=yield O.text(),{data:J,error:null}}catch(d){return{data:null,error:d}}})}}var Wo={},jP={},j2={},Wv={},D2={},L2={},iee=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Eg=iee();const see=Eg.fetch,B5=Eg.fetch.bind(Eg),V5=Eg.Headers,oee=Eg.Request,aee=Eg.Response,Gg=Object.freeze(Object.defineProperty({__proto__:null,Headers:V5,Request:oee,Response:aee,default:B5,fetch:see},Symbol.toStringTag,{value:"Module"})),lee=L7(Gg);var O2={};Object.defineProperty(O2,"__esModule",{value:!0});let cee=class extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}};O2.default=cee;var U5=Ta&&Ta.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(L2,"__esModule",{value:!0});const uee=U5(lee),dee=U5(O2);let hee=class{constructor(t){this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=t.headers,this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=t.shouldThrowOnError,this.signal=t.signal,this.isMaybeSingle=t.isMaybeSingle,t.fetch?this.fetch=t.fetch:typeof fetch>"u"?this.fetch=uee.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,i){return this.headers=Object.assign({},this.headers),this.headers[t]=i,this}then(t,i){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const a=this.fetch;let d=a(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async y=>{var S,s,N;let D=null,O=null,$=null,q=y.status,J=y.statusText;if(y.ok){if(this.method!=="HEAD"){const le=await y.text();le===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?O=le:O=JSON.parse(le))}const Q=(S=this.headers.Prefer)===null||S===void 0?void 0:S.match(/count=(exact|planned|estimated)/),ce=(s=y.headers.get("content-range"))===null||s===void 0?void 0:s.split("/");Q&&ce&&ce.length>1&&($=parseInt(ce[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(O)&&(O.length>1?(D={code:"PGRST116",details:`Results contain ${O.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},O=null,$=null,q=406,J="Not Acceptable"):O.length===1?O=O[0]:O=null)}else{const Q=await y.text();try{D=JSON.parse(Q),Array.isArray(D)&&y.status===404&&(O=[],D=null,q=200,J="OK")}catch{y.status===404&&Q===""?(q=204,J="No Content"):D={message:Q}}if(D&&this.isMaybeSingle&&(!((N=D==null?void 0:D.details)===null||N===void 0)&&N.includes("0 rows"))&&(D=null,q=200,J="OK"),D&&this.shouldThrowOnError)throw new dee.default(D)}return{error:D,data:O,count:$,status:q,statusText:J}});return this.shouldThrowOnError||(d=d.catch(y=>{var S,s,N;return{error:{message:`${(S=y==null?void 0:y.name)!==null&&S!==void 0?S:"FetchError"}: ${y==null?void 0:y.message}`,details:`${(s=y==null?void 0:y.stack)!==null&&s!==void 0?s:""}`,hint:"",code:`${(N=y==null?void 0:y.code)!==null&&N!==void 0?N:""}`},data:null,count:null,status:0,statusText:""}})),d.then(t,i)}returns(){return this}overrideTypes(){return this}};L2.default=hee;var fee=Ta&&Ta.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(D2,"__esModule",{value:!0});const pee=fee(L2);let mee=class extends pee.default{select(t){let i=!1;const a=(t??"*").split("").map(d=>/\s/.test(d)&&!i?"":(d==='"'&&(i=!i),d)).join("");return this.url.searchParams.set("select",a),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(t,{ascending:i=!0,nullsFirst:a,foreignTable:d,referencedTable:y=d}={}){const S=y?`${y}.order`:"order",s=this.url.searchParams.get(S);return this.url.searchParams.set(S,`${s?`${s},`:""}${t}.${i?"asc":"desc"}${a===void 0?"":a?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:i,referencedTable:a=i}={}){const d=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(d,`${t}`),this}range(t,i,{foreignTable:a,referencedTable:d=a}={}){const y=typeof d>"u"?"offset":`${d}.offset`,S=typeof d>"u"?"limit":`${d}.limit`;return this.url.searchParams.set(y,`${t}`),this.url.searchParams.set(S,`${i-t+1}`),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:t=!1,verbose:i=!1,settings:a=!1,buffers:d=!1,wal:y=!1,format:S="text"}={}){var s;const N=[t?"analyze":null,i?"verbose":null,a?"settings":null,d?"buffers":null,y?"wal":null].filter(Boolean).join("|"),D=(s=this.headers.Accept)!==null&&s!==void 0?s:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${S}; for="${D}"; options=${N};`,S==="json"?this:this}rollback(){var t;return((t=this.headers.Prefer)!==null&&t!==void 0?t:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};D2.default=mee;var gee=Ta&&Ta.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Wv,"__esModule",{value:!0});const _ee=gee(D2);let yee=class extends _ee.default{eq(t,i){return this.url.searchParams.append(t,`eq.${i}`),this}neq(t,i){return this.url.searchParams.append(t,`neq.${i}`),this}gt(t,i){return this.url.searchParams.append(t,`gt.${i}`),this}gte(t,i){return this.url.searchParams.append(t,`gte.${i}`),this}lt(t,i){return this.url.searchParams.append(t,`lt.${i}`),this}lte(t,i){return this.url.searchParams.append(t,`lte.${i}`),this}like(t,i){return this.url.searchParams.append(t,`like.${i}`),this}likeAllOf(t,i){return this.url.searchParams.append(t,`like(all).{${i.join(",")}}`),this}likeAnyOf(t,i){return this.url.searchParams.append(t,`like(any).{${i.join(",")}}`),this}ilike(t,i){return this.url.searchParams.append(t,`ilike.${i}`),this}ilikeAllOf(t,i){return this.url.searchParams.append(t,`ilike(all).{${i.join(",")}}`),this}ilikeAnyOf(t,i){return this.url.searchParams.append(t,`ilike(any).{${i.join(",")}}`),this}is(t,i){return this.url.searchParams.append(t,`is.${i}`),this}in(t,i){const a=Array.from(new Set(i)).map(d=>typeof d=="string"&&new RegExp("[,()]").test(d)?`"${d}"`:`${d}`).join(",");return this.url.searchParams.append(t,`in.(${a})`),this}contains(t,i){return typeof i=="string"?this.url.searchParams.append(t,`cs.${i}`):Array.isArray(i)?this.url.searchParams.append(t,`cs.{${i.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(i)}`),this}containedBy(t,i){return typeof i=="string"?this.url.searchParams.append(t,`cd.${i}`):Array.isArray(i)?this.url.searchParams.append(t,`cd.{${i.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(i)}`),this}rangeGt(t,i){return this.url.searchParams.append(t,`sr.${i}`),this}rangeGte(t,i){return this.url.searchParams.append(t,`nxl.${i}`),this}rangeLt(t,i){return this.url.searchParams.append(t,`sl.${i}`),this}rangeLte(t,i){return this.url.searchParams.append(t,`nxr.${i}`),this}rangeAdjacent(t,i){return this.url.searchParams.append(t,`adj.${i}`),this}overlaps(t,i){return typeof i=="string"?this.url.searchParams.append(t,`ov.${i}`):this.url.searchParams.append(t,`ov.{${i.join(",")}}`),this}textSearch(t,i,{config:a,type:d}={}){let y="";d==="plain"?y="pl":d==="phrase"?y="ph":d==="websearch"&&(y="w");const S=a===void 0?"":`(${a})`;return this.url.searchParams.append(t,`${y}fts${S}.${i}`),this}match(t){return Object.entries(t).forEach(([i,a])=>{this.url.searchParams.append(i,`eq.${a}`)}),this}not(t,i,a){return this.url.searchParams.append(t,`not.${i}.${a}`),this}or(t,{foreignTable:i,referencedTable:a=i}={}){const d=a?`${a}.or`:"or";return this.url.searchParams.append(d,`(${t})`),this}filter(t,i,a){return this.url.searchParams.append(t,`${i}.${a}`),this}};Wv.default=yee;var xee=Ta&&Ta.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(j2,"__esModule",{value:!0});const ex=xee(Wv);let vee=class{constructor(t,{headers:i={},schema:a,fetch:d}){this.url=t,this.headers=i,this.schema=a,this.fetch=d}select(t,{head:i=!1,count:a}={}){const d=i?"HEAD":"GET";let y=!1;const S=(t??"*").split("").map(s=>/\s/.test(s)&&!y?"":(s==='"'&&(y=!y),s)).join("");return this.url.searchParams.set("select",S),a&&(this.headers.Prefer=`count=${a}`),new ex.default({method:d,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(t,{count:i,defaultToNull:a=!0}={}){const d="POST",y=[];if(this.headers.Prefer&&y.push(this.headers.Prefer),i&&y.push(`count=${i}`),a||y.push("missing=default"),this.headers.Prefer=y.join(","),Array.isArray(t)){const S=t.reduce((s,N)=>s.concat(Object.keys(N)),[]);if(S.length>0){const s=[...new Set(S)].map(N=>`"${N}"`);this.url.searchParams.set("columns",s.join(","))}}return new ex.default({method:d,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:this.fetch,allowEmpty:!1})}upsert(t,{onConflict:i,ignoreDuplicates:a=!1,count:d,defaultToNull:y=!0}={}){const S="POST",s=[`resolution=${a?"ignore":"merge"}-duplicates`];if(i!==void 0&&this.url.searchParams.set("on_conflict",i),this.headers.Prefer&&s.push(this.headers.Prefer),d&&s.push(`count=${d}`),y||s.push("missing=default"),this.headers.Prefer=s.join(","),Array.isArray(t)){const N=t.reduce((D,O)=>D.concat(Object.keys(O)),[]);if(N.length>0){const D=[...new Set(N)].map(O=>`"${O}"`);this.url.searchParams.set("columns",D.join(","))}}return new ex.default({method:S,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:this.fetch,allowEmpty:!1})}update(t,{count:i}={}){const a="PATCH",d=[];return this.headers.Prefer&&d.push(this.headers.Prefer),i&&d.push(`count=${i}`),this.headers.Prefer=d.join(","),new ex.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:this.fetch,allowEmpty:!1})}delete({count:t}={}){const i="DELETE",a=[];return t&&a.push(`count=${t}`),this.headers.Prefer&&a.unshift(this.headers.Prefer),this.headers.Prefer=a.join(","),new ex.default({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};j2.default=vee;var z2={},F2={};Object.defineProperty(F2,"__esModule",{value:!0});F2.version=void 0;F2.version="0.0.0-automated";Object.defineProperty(z2,"__esModule",{value:!0});z2.DEFAULT_HEADERS=void 0;const bee=F2;z2.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${bee.version}`};var $5=Ta&&Ta.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(jP,"__esModule",{value:!0});const wee=$5(j2),See=$5(Wv),Tee=z2;let Eee=class G5{constructor(t,{headers:i={},schema:a,fetch:d}={}){this.url=t,this.headers=Object.assign(Object.assign({},Tee.DEFAULT_HEADERS),i),this.schemaName=a,this.fetch=d}from(t){const i=new URL(`${this.url}/${t}`);return new wee.default(i,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new G5(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(t,i={},{head:a=!1,get:d=!1,count:y}={}){let S;const s=new URL(`${this.url}/rpc/${t}`);let N;a||d?(S=a?"HEAD":"GET",Object.entries(i).filter(([O,$])=>$!==void 0).map(([O,$])=>[O,Array.isArray($)?`{${$.join(",")}}`:`${$}`]).forEach(([O,$])=>{s.searchParams.append(O,$)})):(S="POST",N=i);const D=Object.assign({},this.headers);return y&&(D.Prefer=`count=${y}`),new See.default({method:S,url:s,headers:D,schema:this.schemaName,body:N,fetch:this.fetch,allowEmpty:!1})}};jP.default=Eee;var qg=Ta&&Ta.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Wo,"__esModule",{value:!0});Wo.PostgrestError=Wo.PostgrestBuilder=Wo.PostgrestTransformBuilder=Wo.PostgrestFilterBuilder=Wo.PostgrestQueryBuilder=Wo.PostgrestClient=void 0;const q5=qg(jP);Wo.PostgrestClient=q5.default;const H5=qg(j2);Wo.PostgrestQueryBuilder=H5.default;const W5=qg(Wv);Wo.PostgrestFilterBuilder=W5.default;const Z5=qg(D2);Wo.PostgrestTransformBuilder=Z5.default;const Y5=qg(L2);Wo.PostgrestBuilder=Y5.default;const X5=qg(O2);Wo.PostgrestError=X5.default;var Cee=Wo.default={PostgrestClient:q5.default,PostgrestQueryBuilder:H5.default,PostgrestFilterBuilder:W5.default,PostgrestTransformBuilder:Z5.default,PostgrestBuilder:Y5.default,PostgrestError:X5.default};const{PostgrestClient:Mee,PostgrestQueryBuilder:Cce,PostgrestFilterBuilder:Mce,PostgrestTransformBuilder:Ace,PostgrestBuilder:Pce,PostgrestError:Ice}=Cee,Aee="2.11.2",Pee={"X-Client-Info":`realtime-js/${Aee}`},Iee="1.0.0",K5=1e4,kee=1e3;var tg;(function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"})(tg||(tg={}));var pa;(function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"})(pa||(pa={}));var Al;(function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"})(Al||(Al={}));var CM;(function(e){e.websocket="websocket"})(CM||(CM={}));var wf;(function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"})(wf||(wf={}));class Nee{constructor(){this.HEADER_LENGTH=1}decode(t,i){return t.constructor===ArrayBuffer?i(this._binaryDecode(t)):i(typeof t=="string"?JSON.parse(t):{})}_binaryDecode(t){const i=new DataView(t),a=new TextDecoder;return this._decodeBroadcast(t,i,a)}_decodeBroadcast(t,i,a){const d=i.getUint8(1),y=i.getUint8(2);let S=this.HEADER_LENGTH+2;const s=a.decode(t.slice(S,S+d));S=S+d;const N=a.decode(t.slice(S,S+y));S=S+y;const D=JSON.parse(a.decode(t.slice(S,t.byteLength)));return{ref:null,topic:s,event:N,payload:D}}}class J5{constructor(t,i){this.callback=t,this.timerCalc=i,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=i}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Mi;(function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"})(Mi||(Mi={}));const dD=(e,t,i={})=>{var a;const d=(a=i.skipTypes)!==null&&a!==void 0?a:[];return Object.keys(t).reduce((y,S)=>(y[S]=Ree(S,e,t,d),y),{})},Ree=(e,t,i,a)=>{const d=t.find(s=>s.name===e),y=d==null?void 0:d.type,S=i[e];return y&&!a.includes(y)?Q5(y,S):MM(S)},Q5=(e,t)=>{if(e.charAt(0)==="_"){const i=e.slice(1,e.length);return Oee(t,i)}switch(e){case Mi.bool:return jee(t);case Mi.float4:case Mi.float8:case Mi.int2:case Mi.int4:case Mi.int8:case Mi.numeric:case Mi.oid:return Dee(t);case Mi.json:case Mi.jsonb:return Lee(t);case Mi.timestamp:return zee(t);case Mi.abstime:case Mi.date:case Mi.daterange:case Mi.int4range:case Mi.int8range:case Mi.money:case Mi.reltime:case Mi.text:case Mi.time:case Mi.timestamptz:case Mi.timetz:case Mi.tsrange:case Mi.tstzrange:return MM(t);default:return MM(t)}},MM=e=>e,jee=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},Dee=e=>{if(typeof e=="string"){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},Lee=e=>{if(typeof e=="string")try{return JSON.parse(e)}catch(t){return console.log(`JSON parse error: ${t}`),e}return e},Oee=(e,t)=>{if(typeof e!="string")return e;const i=e.length-1,a=e[i];if(e[0]==="{"&&a==="}"){let y;const S=e.slice(1,i);try{y=JSON.parse("["+S+"]")}catch{y=S?S.split(","):[]}return y.map(s=>Q5(t,s))}return e},zee=e=>typeof e=="string"?e.replace(" ","T"):e,eB=e=>{let t=e;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")};class GE{constructor(t,i,a={},d=K5){this.channel=t,this.event=i,this.payload=a,this.timeout=d,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,i){var a;return this._hasReceived(t)&&i((a=this.receivedResp)===null||a===void 0?void 0:a.response),this.recHooks.push({status:t,callback:i}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=i=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=i,this._matchReceive(i)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,i){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:i})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:i}){this.recHooks.filter(a=>a.status===t).forEach(a=>a.callback(i))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var hD;(function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"})(hD||(hD={}));class kx{constructor(t,i){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const a=(i==null?void 0:i.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(a.state,{},d=>{const{onJoin:y,onLeave:S,onSync:s}=this.caller;this.joinRef=this.channel._joinRef(),this.state=kx.syncState(this.state,d,y,S),this.pendingDiffs.forEach(N=>{this.state=kx.syncDiff(this.state,N,y,S)}),this.pendingDiffs=[],s()}),this.channel._on(a.diff,{},d=>{const{onJoin:y,onLeave:S,onSync:s}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(d):(this.state=kx.syncDiff(this.state,d,y,S),s())}),this.onJoin((d,y,S)=>{this.channel._trigger("presence",{event:"join",key:d,currentPresences:y,newPresences:S})}),this.onLeave((d,y,S)=>{this.channel._trigger("presence",{event:"leave",key:d,currentPresences:y,leftPresences:S})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,i,a,d){const y=this.cloneDeep(t),S=this.transformState(i),s={},N={};return this.map(y,(D,O)=>{S[D]||(N[D]=O)}),this.map(S,(D,O)=>{const $=y[D];if($){const q=O.map(ce=>ce.presence_ref),J=$.map(ce=>ce.presence_ref),re=O.filter(ce=>J.indexOf(ce.presence_ref)<0),Q=$.filter(ce=>q.indexOf(ce.presence_ref)<0);re.length>0&&(s[D]=re),Q.length>0&&(N[D]=Q)}else s[D]=O}),this.syncDiff(y,{joins:s,leaves:N},a,d)}static syncDiff(t,i,a,d){const{joins:y,leaves:S}={joins:this.transformState(i.joins),leaves:this.transformState(i.leaves)};return a||(a=()=>{}),d||(d=()=>{}),this.map(y,(s,N)=>{var D;const O=(D=t[s])!==null&&D!==void 0?D:[];if(t[s]=this.cloneDeep(N),O.length>0){const $=t[s].map(J=>J.presence_ref),q=O.filter(J=>$.indexOf(J.presence_ref)<0);t[s].unshift(...q)}a(s,O,N)}),this.map(S,(s,N)=>{let D=t[s];if(!D)return;const O=N.map($=>$.presence_ref);D=D.filter($=>O.indexOf($.presence_ref)<0),t[s]=D,d(s,D,N),D.length===0&&delete t[s]}),t}static map(t,i){return Object.getOwnPropertyNames(t).map(a=>i(a,t[a]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((i,a)=>{const d=t[a];return"metas"in d?i[a]=d.metas.map(y=>(y.presence_ref=y.phx_ref,delete y.phx_ref,delete y.phx_ref_prev,y)):i[a]=d,i},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var fD;(function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"})(fD||(fD={}));var pD;(function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"})(pD||(pD={}));var eu;(function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"})(eu||(eu={}));class DP{constructor(t,i={config:{}},a){this.topic=t,this.params=i,this.socket=a,this.bindings={},this.state=pa.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},i.config),this.timeout=this.socket.timeout,this.joinPush=new GE(this,Al.join,this.params,this.timeout),this.rejoinTimer=new J5(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=pa.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(d=>d.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=pa.closed,this.socket._remove(this)}),this._onError(d=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,d),this.state=pa.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=pa.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Al.reply,{},(d,y)=>{this._trigger(this._replyEventName(y),d)}),this.presence=new kx(this),this.broadcastEndpointURL=eB(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(t,i=this.timeout){var a,d;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:y,presence:S,private:s}}=this.params;this._onError(O=>t==null?void 0:t(eu.CHANNEL_ERROR,O)),this._onClose(()=>t==null?void 0:t(eu.CLOSED));const N={},D={broadcast:y,presence:S,postgres_changes:(d=(a=this.bindings.postgres_changes)===null||a===void 0?void 0:a.map(O=>O.filter))!==null&&d!==void 0?d:[],private:s};this.socket.accessTokenValue&&(N.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:D},N)),this.joinedOnce=!0,this._rejoin(i),this.joinPush.receive("ok",async({postgres_changes:O})=>{var $;if(this.socket.setAuth(),O===void 0){t==null||t(eu.SUBSCRIBED);return}else{const q=this.bindings.postgres_changes,J=($=q==null?void 0:q.length)!==null&&$!==void 0?$:0,re=[];for(let Q=0;Q<J;Q++){const ce=q[Q],{filter:{event:le,schema:ae,table:he,filter:Se}}=ce,je=O&&O[Q];if(je&&je.event===le&&je.schema===ae&&je.table===he&&je.filter===Se)re.push(Object.assign(Object.assign({},ce),{id:je.id}));else{this.unsubscribe(),t==null||t(eu.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=re,t&&t(eu.SUBSCRIBED);return}}).receive("error",O=>{t==null||t(eu.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(O).join(", ")||"error")))}).receive("timeout",()=>{t==null||t(eu.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,i={}){return await this.send({type:"presence",event:"track",payload:t},i.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,i,a){return this._on(t,i,a)}async send(t,i={}){var a,d;if(!this._canPush()&&t.type==="broadcast"){const{event:y,payload:S}=t,N={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:y,payload:S,private:this.private}]})};try{const D=await this._fetchWithTimeout(this.broadcastEndpointURL,N,(a=i.timeout)!==null&&a!==void 0?a:this.timeout);return await((d=D.body)===null||d===void 0?void 0:d.cancel()),D.ok?"ok":"error"}catch(D){return D.name==="AbortError"?"timed out":"error"}}else return new Promise(y=>{var S,s,N;const D=this._push(t.type,t,i.timeout||this.timeout);t.type==="broadcast"&&!(!((N=(s=(S=this.params)===null||S===void 0?void 0:S.config)===null||s===void 0?void 0:s.broadcast)===null||N===void 0)&&N.ack)&&y("ok"),D.receive("ok",()=>y("ok")),D.receive("error",()=>y("error")),D.receive("timeout",()=>y("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=pa.leaving;const i=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Al.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(a=>{const d=new GE(this,Al.leave,{},t);d.receive("ok",()=>{i(),a("ok")}).receive("timeout",()=>{i(),a("timed out")}).receive("error",()=>{a("error")}),d.send(),this._canPush()||d.trigger("ok",{})})}async _fetchWithTimeout(t,i,a){const d=new AbortController,y=setTimeout(()=>d.abort(),a),S=await this.socket.fetch(t,Object.assign(Object.assign({},i),{signal:d.signal}));return clearTimeout(y),S}_push(t,i,a=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let d=new GE(this,t,i,a);return this._canPush()?d.send():(d.startTimeout(),this.pushBuffer.push(d)),d}_onMessage(t,i,a){return i}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,i,a){var d,y;const S=t.toLocaleLowerCase(),{close:s,error:N,leave:D,join:O}=Al;if(a&&[s,N,D,O].indexOf(S)>=0&&a!==this._joinRef())return;let q=this._onMessage(S,i,a);if(i&&!q)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(S)?(d=this.bindings.postgres_changes)===null||d===void 0||d.filter(J=>{var re,Q,ce;return((re=J.filter)===null||re===void 0?void 0:re.event)==="*"||((ce=(Q=J.filter)===null||Q===void 0?void 0:Q.event)===null||ce===void 0?void 0:ce.toLocaleLowerCase())===S}).map(J=>J.callback(q,a)):(y=this.bindings[S])===null||y===void 0||y.filter(J=>{var re,Q,ce,le,ae,he;if(["broadcast","presence","postgres_changes"].includes(S))if("id"in J){const Se=J.id,je=(re=J.filter)===null||re===void 0?void 0:re.event;return Se&&((Q=i.ids)===null||Q===void 0?void 0:Q.includes(Se))&&(je==="*"||(je==null?void 0:je.toLocaleLowerCase())===((ce=i.data)===null||ce===void 0?void 0:ce.type.toLocaleLowerCase()))}else{const Se=(ae=(le=J==null?void 0:J.filter)===null||le===void 0?void 0:le.event)===null||ae===void 0?void 0:ae.toLocaleLowerCase();return Se==="*"||Se===((he=i==null?void 0:i.event)===null||he===void 0?void 0:he.toLocaleLowerCase())}else return J.type.toLocaleLowerCase()===S}).map(J=>{if(typeof q=="object"&&"ids"in q){const re=q.data,{schema:Q,table:ce,commit_timestamp:le,type:ae,errors:he}=re;q=Object.assign(Object.assign({},{schema:Q,table:ce,commit_timestamp:le,eventType:ae,new:{},old:{},errors:he}),this._getPayloadRecords(re))}J.callback(q,a)})}_isClosed(){return this.state===pa.closed}_isJoined(){return this.state===pa.joined}_isJoining(){return this.state===pa.joining}_isLeaving(){return this.state===pa.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,i,a){const d=t.toLocaleLowerCase(),y={type:d,filter:i,callback:a};return this.bindings[d]?this.bindings[d].push(y):this.bindings[d]=[y],this}_off(t,i){const a=t.toLocaleLowerCase();return this.bindings[a]=this.bindings[a].filter(d=>{var y;return!(((y=d.type)===null||y===void 0?void 0:y.toLocaleLowerCase())===a&&DP.isEqual(d.filter,i))}),this}static isEqual(t,i){if(Object.keys(t).length!==Object.keys(i).length)return!1;for(const a in t)if(t[a]!==i[a])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(Al.close,{},t)}_onError(t){this._on(Al.error,{},i=>t(i))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=pa.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const i={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(i.new=dD(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(i.old=dD(t.columns,t.old_record)),i}}const Fee=()=>{},Bee=typeof WebSocket<"u",Vee=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Uee{constructor(t,i){var a;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=Pee,this.params={},this.timeout=K5,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=Fee,this.conn=null,this.sendBuffer=[],this.serializer=new Nee,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=y=>{let S;return y?S=y:typeof fetch>"u"?S=(...s)=>Tg(async()=>{const{default:N}=await Promise.resolve().then(()=>Gg);return{default:N}},void 0).then(({default:N})=>N(...s)):S=fetch,(...s)=>S(...s)},this.endPoint=`${t}/${CM.websocket}`,this.httpEndpoint=eB(t),i!=null&&i.transport?this.transport=i.transport:this.transport=null,i!=null&&i.params&&(this.params=i.params),i!=null&&i.headers&&(this.headers=Object.assign(Object.assign({},this.headers),i.headers)),i!=null&&i.timeout&&(this.timeout=i.timeout),i!=null&&i.logger&&(this.logger=i.logger),i!=null&&i.heartbeatIntervalMs&&(this.heartbeatIntervalMs=i.heartbeatIntervalMs);const d=(a=i==null?void 0:i.params)===null||a===void 0?void 0:a.apikey;if(d&&(this.accessTokenValue=d,this.apiKey=d),this.reconnectAfterMs=i!=null&&i.reconnectAfterMs?i.reconnectAfterMs:y=>[1e3,2e3,5e3,1e4][y-1]||1e4,this.encode=i!=null&&i.encode?i.encode:(y,S)=>S(JSON.stringify(y)),this.decode=i!=null&&i.decode?i.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new J5(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(i==null?void 0:i.fetch),i!=null&&i.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(i==null?void 0:i.worker)||!1,this.workerUrl=i==null?void 0:i.workerUrl}this.accessToken=(i==null?void 0:i.accessToken)||null}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers});return}if(Bee){this.conn=new WebSocket(this.endpointURL()),this.setupConnection();return}this.conn=new $ee(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),Tg(async()=>{const{default:t}=await import("./browser-DZoFp10n.js").then(i=>i.b);return{default:t}},[]).then(({default:t})=>{this.conn=new t(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Iee}))}disconnect(t,i){this.conn&&(this.conn.onclose=function(){},t?this.conn.close(t,i??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(t){const i=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),i}async removeAllChannels(){const t=await Promise.all(this.channels.map(i=>i.unsubscribe()));return this.disconnect(),t}log(t,i,a){this.logger(t,i,a)}connectionState(){switch(this.conn&&this.conn.readyState){case tg.connecting:return wf.Connecting;case tg.open:return wf.Open;case tg.closing:return wf.Closing;default:return wf.Closed}}isConnected(){return this.connectionState()===wf.Open}channel(t,i={config:{}}){const a=new DP(`realtime:${t}`,i,this);return this.channels.push(a),a}push(t){const{topic:i,event:a,payload:d,ref:y}=t,S=()=>{this.encode(t,s=>{var N;(N=this.conn)===null||N===void 0||N.send(s)})};this.log("push",`${i} ${a} (${y})`,d),this.isConnected()?S():this.sendBuffer.push(S)}async setAuth(t=null){let i=t||this.accessToken&&await this.accessToken()||this.accessTokenValue;if(i){let a=null;try{a=JSON.parse(atob(i.split(".")[1]))}catch{}if(a&&a.exp&&!(Math.floor(Date.now()/1e3)-a.exp<0))return this.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${a.exp}`),Promise.reject(`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${a.exp}`);this.accessTokenValue=i,this.channels.forEach(d=>{i&&d.updateJoinPayload({access_token:i}),d.joinedOnce&&d._isJoined()&&d._push(Al.access_token,{access_token:i})})}}async sendHeartbeat(){var t;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(t=this.conn)===null||t===void 0||t.close(kee,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth()}}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let i=this.channels.find(a=>a.topic===t&&(a._isJoined()||a._isJoining()));i&&(this.log("transport",`leaving duplicate topic "${t}"`),i.unsubscribe())}_remove(t){this.channels=this.channels.filter(i=>i._joinRef()!==t._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t))}_onConnMessage(t){this.decode(t.data,i=>{let{topic:a,event:d,payload:y,ref:S}=i;S&&S===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${y.status||""} ${a} ${d} ${S&&"("+S+")"||""}`,y),this.channels.filter(s=>s._isMember(a)).forEach(s=>s._trigger(d,y,S)),this.stateChangeCallbacks.message.forEach(s=>s(i))})}async _onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=i=>{this.log("worker","worker error",i.message),this.workerRef.terminate()},this.workerRef.onmessage=i=>{i.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(t=>t())}_onConnClose(t){this.log("transport","close",t),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(i=>i(t))}_onConnError(t){this.log("transport",t.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(i=>i(t))}_triggerChanError(){this.channels.forEach(t=>t._trigger(Al.error))}_appendParams(t,i){if(Object.keys(i).length===0)return t;const a=t.match(/\?/)?"&":"?",d=new URLSearchParams(i);return`${t}${a}${d}`}_workerObjectUrl(t){let i;if(t)i=t;else{const a=new Blob([Vee],{type:"application/javascript"});i=URL.createObjectURL(a)}return i}}class $ee{constructor(t,i,a){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=tg.connecting,this.send=()=>{},this.url=null,this.url=t,this.close=a.close}}class LP extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}}function zs(e){return typeof e=="object"&&e!==null&&"__isStorageError"in e}class Gee extends LP{constructor(t,i){super(t),this.name="StorageApiError",this.status=i}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class AM extends LP{constructor(t,i){super(t),this.name="StorageUnknownError",this.originalError=i}}var qee=function(e,t,i,a){function d(y){return y instanceof i?y:new i(function(S){S(y)})}return new(i||(i=Promise))(function(y,S){function s(O){try{D(a.next(O))}catch($){S($)}}function N(O){try{D(a.throw(O))}catch($){S($)}}function D(O){O.done?y(O.value):d(O.value).then(s,N)}D((a=a.apply(e,t||[])).next())})};const tB=e=>{let t;return e?t=e:typeof fetch>"u"?t=(...i)=>Tg(async()=>{const{default:a}=await Promise.resolve().then(()=>Gg);return{default:a}},void 0).then(({default:a})=>a(...i)):t=fetch,(...i)=>t(...i)},Hee=()=>qee(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Tg(()=>Promise.resolve().then(()=>Gg),void 0)).Response:Response}),PM=e=>{if(Array.isArray(e))return e.map(i=>PM(i));if(typeof e=="function"||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([i,a])=>{const d=i.replace(/([-_][a-z])/gi,y=>y.toUpperCase().replace(/[-_]/g,""));t[d]=PM(a)}),t};var rp=function(e,t,i,a){function d(y){return y instanceof i?y:new i(function(S){S(y)})}return new(i||(i=Promise))(function(y,S){function s(O){try{D(a.next(O))}catch($){S($)}}function N(O){try{D(a.throw(O))}catch($){S($)}}function D(O){O.done?y(O.value):d(O.value).then(s,N)}D((a=a.apply(e,t||[])).next())})};const qE=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Wee=(e,t,i)=>rp(void 0,void 0,void 0,function*(){const a=yield Hee();e instanceof a&&!(i!=null&&i.noResolveJson)?e.json().then(d=>{t(new Gee(qE(d),e.status||500))}).catch(d=>{t(new AM(qE(d),d))}):t(new AM(qE(e),e))}),Zee=(e,t,i,a)=>{const d={method:e,headers:(t==null?void 0:t.headers)||{}};return e==="GET"?d:(d.headers=Object.assign({"Content-Type":"application/json"},t==null?void 0:t.headers),a&&(d.body=JSON.stringify(a)),Object.assign(Object.assign({},d),i))};function Zv(e,t,i,a,d,y){return rp(this,void 0,void 0,function*(){return new Promise((S,s)=>{e(i,Zee(t,a,d,y)).then(N=>{if(!N.ok)throw N;return a!=null&&a.noResolveJson?N:N.json()}).then(N=>S(N)).catch(N=>Wee(N,s,a))})})}function kw(e,t,i,a){return rp(this,void 0,void 0,function*(){return Zv(e,"GET",t,i,a)})}function Pd(e,t,i,a,d){return rp(this,void 0,void 0,function*(){return Zv(e,"POST",t,a,d,i)})}function Yee(e,t,i,a,d){return rp(this,void 0,void 0,function*(){return Zv(e,"PUT",t,a,d,i)})}function Xee(e,t,i,a){return rp(this,void 0,void 0,function*(){return Zv(e,"HEAD",t,Object.assign(Object.assign({},i),{noResolveJson:!0}),a)})}function rB(e,t,i,a,d){return rp(this,void 0,void 0,function*(){return Zv(e,"DELETE",t,a,d,i)})}var $o=function(e,t,i,a){function d(y){return y instanceof i?y:new i(function(S){S(y)})}return new(i||(i=Promise))(function(y,S){function s(O){try{D(a.next(O))}catch($){S($)}}function N(O){try{D(a.throw(O))}catch($){S($)}}function D(O){O.done?y(O.value):d(O.value).then(s,N)}D((a=a.apply(e,t||[])).next())})};const Kee={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},mD={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Jee{constructor(t,i={},a,d){this.url=t,this.headers=i,this.bucketId=a,this.fetch=tB(d)}uploadOrUpdate(t,i,a,d){return $o(this,void 0,void 0,function*(){try{let y;const S=Object.assign(Object.assign({},mD),d);let s=Object.assign(Object.assign({},this.headers),t==="POST"&&{"x-upsert":String(S.upsert)});const N=S.metadata;typeof Blob<"u"&&a instanceof Blob?(y=new FormData,y.append("cacheControl",S.cacheControl),N&&y.append("metadata",this.encodeMetadata(N)),y.append("",a)):typeof FormData<"u"&&a instanceof FormData?(y=a,y.append("cacheControl",S.cacheControl),N&&y.append("metadata",this.encodeMetadata(N))):(y=a,s["cache-control"]=`max-age=${S.cacheControl}`,s["content-type"]=S.contentType,N&&(s["x-metadata"]=this.toBase64(this.encodeMetadata(N)))),d!=null&&d.headers&&(s=Object.assign(Object.assign({},s),d.headers));const D=this._removeEmptyFolders(i),O=this._getFinalPath(D),$=yield this.fetch(`${this.url}/object/${O}`,Object.assign({method:t,body:y,headers:s},S!=null&&S.duplex?{duplex:S.duplex}:{})),q=yield $.json();return $.ok?{data:{path:D,id:q.Id,fullPath:q.Key},error:null}:{data:null,error:q}}catch(y){if(zs(y))return{data:null,error:y};throw y}})}upload(t,i,a){return $o(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",t,i,a)})}uploadToSignedUrl(t,i,a,d){return $o(this,void 0,void 0,function*(){const y=this._removeEmptyFolders(t),S=this._getFinalPath(y),s=new URL(this.url+`/object/upload/sign/${S}`);s.searchParams.set("token",i);try{let N;const D=Object.assign({upsert:mD.upsert},d),O=Object.assign(Object.assign({},this.headers),{"x-upsert":String(D.upsert)});typeof Blob<"u"&&a instanceof Blob?(N=new FormData,N.append("cacheControl",D.cacheControl),N.append("",a)):typeof FormData<"u"&&a instanceof FormData?(N=a,N.append("cacheControl",D.cacheControl)):(N=a,O["cache-control"]=`max-age=${D.cacheControl}`,O["content-type"]=D.contentType);const $=yield this.fetch(s.toString(),{method:"PUT",body:N,headers:O}),q=yield $.json();return $.ok?{data:{path:y,fullPath:q.Key},error:null}:{data:null,error:q}}catch(N){if(zs(N))return{data:null,error:N};throw N}})}createSignedUploadUrl(t,i){return $o(this,void 0,void 0,function*(){try{let a=this._getFinalPath(t);const d=Object.assign({},this.headers);i!=null&&i.upsert&&(d["x-upsert"]="true");const y=yield Pd(this.fetch,`${this.url}/object/upload/sign/${a}`,{},{headers:d}),S=new URL(this.url+y.url),s=S.searchParams.get("token");if(!s)throw new LP("No token returned by API");return{data:{signedUrl:S.toString(),path:t,token:s},error:null}}catch(a){if(zs(a))return{data:null,error:a};throw a}})}update(t,i,a){return $o(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",t,i,a)})}move(t,i,a){return $o(this,void 0,void 0,function*(){try{return{data:yield Pd(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:t,destinationKey:i,destinationBucket:a==null?void 0:a.destinationBucket},{headers:this.headers}),error:null}}catch(d){if(zs(d))return{data:null,error:d};throw d}})}copy(t,i,a){return $o(this,void 0,void 0,function*(){try{return{data:{path:(yield Pd(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:t,destinationKey:i,destinationBucket:a==null?void 0:a.destinationBucket},{headers:this.headers})).Key},error:null}}catch(d){if(zs(d))return{data:null,error:d};throw d}})}createSignedUrl(t,i,a){return $o(this,void 0,void 0,function*(){try{let d=this._getFinalPath(t),y=yield Pd(this.fetch,`${this.url}/object/sign/${d}`,Object.assign({expiresIn:i},a!=null&&a.transform?{transform:a.transform}:{}),{headers:this.headers});const S=a!=null&&a.download?`&download=${a.download===!0?"":a.download}`:"";return y={signedUrl:encodeURI(`${this.url}${y.signedURL}${S}`)},{data:y,error:null}}catch(d){if(zs(d))return{data:null,error:d};throw d}})}createSignedUrls(t,i,a){return $o(this,void 0,void 0,function*(){try{const d=yield Pd(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:i,paths:t},{headers:this.headers}),y=a!=null&&a.download?`&download=${a.download===!0?"":a.download}`:"";return{data:d.map(S=>Object.assign(Object.assign({},S),{signedUrl:S.signedURL?encodeURI(`${this.url}${S.signedURL}${y}`):null})),error:null}}catch(d){if(zs(d))return{data:null,error:d};throw d}})}download(t,i){return $o(this,void 0,void 0,function*(){const d=typeof(i==null?void 0:i.transform)<"u"?"render/image/authenticated":"object",y=this.transformOptsToQueryString((i==null?void 0:i.transform)||{}),S=y?`?${y}`:"";try{const s=this._getFinalPath(t);return{data:yield(yield kw(this.fetch,`${this.url}/${d}/${s}${S}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(s){if(zs(s))return{data:null,error:s};throw s}})}info(t){return $o(this,void 0,void 0,function*(){const i=this._getFinalPath(t);try{const a=yield kw(this.fetch,`${this.url}/object/info/${i}`,{headers:this.headers});return{data:PM(a),error:null}}catch(a){if(zs(a))return{data:null,error:a};throw a}})}exists(t){return $o(this,void 0,void 0,function*(){const i=this._getFinalPath(t);try{return yield Xee(this.fetch,`${this.url}/object/${i}`,{headers:this.headers}),{data:!0,error:null}}catch(a){if(zs(a)&&a instanceof AM){const d=a.originalError;if([400,404].includes(d==null?void 0:d.status))return{data:!1,error:a}}throw a}})}getPublicUrl(t,i){const a=this._getFinalPath(t),d=[],y=i!=null&&i.download?`download=${i.download===!0?"":i.download}`:"";y!==""&&d.push(y);const s=typeof(i==null?void 0:i.transform)<"u"?"render/image":"object",N=this.transformOptsToQueryString((i==null?void 0:i.transform)||{});N!==""&&d.push(N);let D=d.join("&");return D!==""&&(D=`?${D}`),{data:{publicUrl:encodeURI(`${this.url}/${s}/public/${a}${D}`)}}}remove(t){return $o(this,void 0,void 0,function*(){try{return{data:yield rB(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:t},{headers:this.headers}),error:null}}catch(i){if(zs(i))return{data:null,error:i};throw i}})}list(t,i,a){return $o(this,void 0,void 0,function*(){try{const d=Object.assign(Object.assign(Object.assign({},Kee),i),{prefix:t||""});return{data:yield Pd(this.fetch,`${this.url}/object/list/${this.bucketId}`,d,{headers:this.headers},a),error:null}}catch(d){if(zs(d))return{data:null,error:d};throw d}})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const i=[];return t.width&&i.push(`width=${t.width}`),t.height&&i.push(`height=${t.height}`),t.resize&&i.push(`resize=${t.resize}`),t.format&&i.push(`format=${t.format}`),t.quality&&i.push(`quality=${t.quality}`),i.join("&")}}const Qee="2.7.1",ete={"X-Client-Info":`storage-js/${Qee}`};var Sm=function(e,t,i,a){function d(y){return y instanceof i?y:new i(function(S){S(y)})}return new(i||(i=Promise))(function(y,S){function s(O){try{D(a.next(O))}catch($){S($)}}function N(O){try{D(a.throw(O))}catch($){S($)}}function D(O){O.done?y(O.value):d(O.value).then(s,N)}D((a=a.apply(e,t||[])).next())})};class tte{constructor(t,i={},a){this.url=t,this.headers=Object.assign(Object.assign({},ete),i),this.fetch=tB(a)}listBuckets(){return Sm(this,void 0,void 0,function*(){try{return{data:yield kw(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(t){if(zs(t))return{data:null,error:t};throw t}})}getBucket(t){return Sm(this,void 0,void 0,function*(){try{return{data:yield kw(this.fetch,`${this.url}/bucket/${t}`,{headers:this.headers}),error:null}}catch(i){if(zs(i))return{data:null,error:i};throw i}})}createBucket(t,i={public:!1}){return Sm(this,void 0,void 0,function*(){try{return{data:yield Pd(this.fetch,`${this.url}/bucket`,{id:t,name:t,public:i.public,file_size_limit:i.fileSizeLimit,allowed_mime_types:i.allowedMimeTypes},{headers:this.headers}),error:null}}catch(a){if(zs(a))return{data:null,error:a};throw a}})}updateBucket(t,i){return Sm(this,void 0,void 0,function*(){try{return{data:yield Yee(this.fetch,`${this.url}/bucket/${t}`,{id:t,name:t,public:i.public,file_size_limit:i.fileSizeLimit,allowed_mime_types:i.allowedMimeTypes},{headers:this.headers}),error:null}}catch(a){if(zs(a))return{data:null,error:a};throw a}})}emptyBucket(t){return Sm(this,void 0,void 0,function*(){try{return{data:yield Pd(this.fetch,`${this.url}/bucket/${t}/empty`,{},{headers:this.headers}),error:null}}catch(i){if(zs(i))return{data:null,error:i};throw i}})}deleteBucket(t){return Sm(this,void 0,void 0,function*(){try{return{data:yield rB(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(i){if(zs(i))return{data:null,error:i};throw i}})}}class rte extends tte{constructor(t,i={},a){super(t,i,a)}from(t){return new Jee(this.url,this.headers,t,this.fetch)}}const nte="2.49.4";let hx="";typeof Deno<"u"?hx="deno":typeof document<"u"?hx="web":typeof navigator<"u"&&navigator.product==="ReactNative"?hx="react-native":hx="node";const ite={"X-Client-Info":`supabase-js-${hx}/${nte}`},ste={headers:ite},ote={schema:"public"},ate={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},lte={};var cte=function(e,t,i,a){function d(y){return y instanceof i?y:new i(function(S){S(y)})}return new(i||(i=Promise))(function(y,S){function s(O){try{D(a.next(O))}catch($){S($)}}function N(O){try{D(a.throw(O))}catch($){S($)}}function D(O){O.done?y(O.value):d(O.value).then(s,N)}D((a=a.apply(e,t||[])).next())})};const ute=e=>{let t;return e?t=e:typeof fetch>"u"?t=B5:t=fetch,(...i)=>t(...i)},dte=()=>typeof Headers>"u"?V5:Headers,hte=(e,t,i)=>{const a=ute(i),d=dte();return(y,S)=>cte(void 0,void 0,void 0,function*(){var s;const N=(s=yield t())!==null&&s!==void 0?s:e;let D=new d(S==null?void 0:S.headers);return D.has("apikey")||D.set("apikey",e),D.has("Authorization")||D.set("Authorization",`Bearer ${N}`),a(y,Object.assign(Object.assign({},S),{headers:D}))})};var fte=function(e,t,i,a){function d(y){return y instanceof i?y:new i(function(S){S(y)})}return new(i||(i=Promise))(function(y,S){function s(O){try{D(a.next(O))}catch($){S($)}}function N(O){try{D(a.throw(O))}catch($){S($)}}function D(O){O.done?y(O.value):d(O.value).then(s,N)}D((a=a.apply(e,t||[])).next())})};function pte(e){return e.replace(/\/$/,"")}function mte(e,t){const{db:i,auth:a,realtime:d,global:y}=e,{db:S,auth:s,realtime:N,global:D}=t,O={db:Object.assign(Object.assign({},S),i),auth:Object.assign(Object.assign({},s),a),realtime:Object.assign(Object.assign({},N),d),global:Object.assign(Object.assign({},D),y),accessToken:()=>fte(this,void 0,void 0,function*(){return""})};return e.accessToken?O.accessToken=e.accessToken:delete O.accessToken,O}const nB="2.69.1",Am=30*1e3,IM=3,HE=IM*Am,gte="http://localhost:9999",_te="supabase.auth.token",yte={"X-Client-Info":`gotrue-js/${nB}`},kM="X-Supabase-Api-Version",iB={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},xte=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,vte=6e5;class OP extends Error{constructor(t,i,a){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=i,this.code=a}}function En(e){return typeof e=="object"&&e!==null&&"__isAuthError"in e}class bte extends OP{constructor(t,i,a){super(t,i,a),this.name="AuthApiError",this.status=i,this.code=a}}function wte(e){return En(e)&&e.name==="AuthApiError"}class sB extends OP{constructor(t,i){super(t),this.name="AuthUnknownError",this.originalError=i}}class xh extends OP{constructor(t,i,a,d){super(t,a,d),this.name=i,this.status=a}}class Td extends xh{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Ste(e){return En(e)&&e.name==="AuthSessionMissingError"}class WE extends xh{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class vb extends xh{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class bb extends xh{constructor(t,i=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=i}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Tte(e){return En(e)&&e.name==="AuthImplicitGrantRedirectError"}class gD extends xh{constructor(t,i=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=i}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class NM extends xh{constructor(t,i){super(t,"AuthRetryableFetchError",i,void 0)}}function ZE(e){return En(e)&&e.name==="AuthRetryableFetchError"}class _D extends xh{constructor(t,i,a){super(t,"AuthWeakPasswordError",i,"weak_password"),this.reasons=a}}class Nx extends xh{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const yD="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),xD=` 	
\r=`.split(""),Ete=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<xD.length;t+=1)e[xD[t].charCodeAt(0)]=-2;for(let t=0;t<yD.length;t+=1)e[yD[t].charCodeAt(0)]=t;return e})();function oB(e,t,i){const a=Ete[e];if(a>-1)for(t.queue=t.queue<<6|a,t.queuedBits+=6;t.queuedBits>=8;)i(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(a===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}}function vD(e){const t=[],i=S=>{t.push(String.fromCodePoint(S))},a={utf8seq:0,codepoint:0},d={queue:0,queuedBits:0},y=S=>{Ate(S,a,i)};for(let S=0;S<e.length;S+=1)oB(e.charCodeAt(S),d,y);return t.join("")}function Cte(e,t){if(e<=127){t(e);return}else if(e<=2047){t(192|e>>6),t(128|e&63);return}else if(e<=65535){t(224|e>>12),t(128|e>>6&63),t(128|e&63);return}else if(e<=1114111){t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),t(128|e&63);return}throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}function Mte(e,t){for(let i=0;i<e.length;i+=1){let a=e.charCodeAt(i);if(a>55295&&a<=56319){const d=(a-55296)*1024&65535;a=(e.charCodeAt(i+1)-56320&65535|d)+65536,i+=1}Cte(a,t)}}function Ate(e,t,i){if(t.utf8seq===0){if(e<=127){i(e);return}for(let a=1;a<6;a+=1)if(!(e>>7-a&1)){t.utf8seq=a;break}if(t.utf8seq===2)t.codepoint=e&31;else if(t.utf8seq===3)t.codepoint=e&15;else if(t.utf8seq===4)t.codepoint=e&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|e&63,t.utf8seq-=1,t.utf8seq===0&&i(t.codepoint)}}function Pte(e){const t=[],i={queue:0,queuedBits:0},a=d=>{t.push(d)};for(let d=0;d<e.length;d+=1)oB(e.charCodeAt(d),i,a);return new Uint8Array(t)}function Ite(e){const t=[];return Mte(e,i=>t.push(i)),new Uint8Array(t)}function kte(e){return Math.round(Date.now()/1e3)+e}function Nte(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=Math.random()*16|0;return(e=="x"?t:t&3|8).toString(16)})}const uc=()=>typeof window<"u"&&typeof document<"u",_f={tested:!1,writable:!1},Rx=()=>{if(!uc())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(_f.tested)return _f.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),_f.tested=!0,_f.writable=!0}catch{_f.tested=!0,_f.writable=!1}return _f.writable};function Rte(e){const t={},i=new URL(e);if(i.hash&&i.hash[0]==="#")try{new URLSearchParams(i.hash.substring(1)).forEach((d,y)=>{t[y]=d})}catch{}return i.searchParams.forEach((a,d)=>{t[d]=a}),t}const aB=e=>{let t;return e?t=e:typeof fetch>"u"?t=(...i)=>Tg(async()=>{const{default:a}=await Promise.resolve().then(()=>Gg);return{default:a}},void 0).then(({default:a})=>a(...i)):t=fetch,(...i)=>t(...i)},jte=e=>typeof e=="object"&&e!==null&&"status"in e&&"ok"in e&&"json"in e&&typeof e.json=="function",lB=async(e,t,i)=>{await e.setItem(t,JSON.stringify(i))},wb=async(e,t)=>{const i=await e.getItem(t);if(!i)return null;try{return JSON.parse(i)}catch{return i}},Sb=async(e,t)=>{await e.removeItem(t)};class B2{constructor(){this.promise=new B2.promiseConstructor((t,i)=>{this.resolve=t,this.reject=i})}}B2.promiseConstructor=Promise;function YE(e){const t=e.split(".");if(t.length!==3)throw new Nx("Invalid JWT structure");for(let a=0;a<t.length;a++)if(!xte.test(t[a]))throw new Nx("JWT not in base64url format");return{header:JSON.parse(vD(t[0])),payload:JSON.parse(vD(t[1])),signature:Pte(t[2]),raw:{header:t[0],payload:t[1]}}}async function Dte(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}function Lte(e,t){return new Promise((a,d)=>{(async()=>{for(let y=0;y<1/0;y++)try{const S=await e(y);if(!t(y,null,S)){a(S);return}}catch(S){if(!t(y,S)){d(S);return}}})()})}function Ote(e){return("0"+e.toString(16)).substr(-2)}function zte(){const t=new Uint32Array(56);if(typeof crypto>"u"){const i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",a=i.length;let d="";for(let y=0;y<56;y++)d+=i.charAt(Math.floor(Math.random()*a));return d}return crypto.getRandomValues(t),Array.from(t,Ote).join("")}async function Fte(e){const i=new TextEncoder().encode(e),a=await crypto.subtle.digest("SHA-256",i),d=new Uint8Array(a);return Array.from(d).map(y=>String.fromCharCode(y)).join("")}async function Bte(e){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const i=await Fte(e);return btoa(i).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Tm(e,t,i=!1){const a=zte();let d=a;i&&(d+="/PASSWORD_RECOVERY"),await lB(e,`${t}-code-verifier`,d);const y=await Bte(a);return[y,a===y?"plain":"s256"]}const Vte=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Ute(e){const t=e.headers.get(kM);if(!t||!t.match(Vte))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function $te(e){if(!e)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(e<=t)throw new Error("JWT has expired")}function Gte(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}var qte=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var d=0,a=Object.getOwnPropertySymbols(e);d<a.length;d++)t.indexOf(a[d])<0&&Object.prototype.propertyIsEnumerable.call(e,a[d])&&(i[a[d]]=e[a[d]]);return i};const vf=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Hte=[502,503,504];async function bD(e){var t;if(!jte(e))throw new NM(vf(e),0);if(Hte.includes(e.status))throw new NM(vf(e),e.status);let i;try{i=await e.json()}catch(y){throw new sB(vf(y),y)}let a;const d=Ute(e);if(d&&d.getTime()>=iB["2024-01-01"].timestamp&&typeof i=="object"&&i&&typeof i.code=="string"?a=i.code:typeof i=="object"&&i&&typeof i.error_code=="string"&&(a=i.error_code),a){if(a==="weak_password")throw new _D(vf(i),e.status,((t=i.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(a==="session_not_found")throw new Td}else if(typeof i=="object"&&i&&typeof i.weak_password=="object"&&i.weak_password&&Array.isArray(i.weak_password.reasons)&&i.weak_password.reasons.length&&i.weak_password.reasons.reduce((y,S)=>y&&typeof S=="string",!0))throw new _D(vf(i),e.status,i.weak_password.reasons);throw new bte(vf(i),e.status||500,a)}const Wte=(e,t,i,a)=>{const d={method:e,headers:(t==null?void 0:t.headers)||{}};return e==="GET"?d:(d.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t==null?void 0:t.headers),d.body=JSON.stringify(a),Object.assign(Object.assign({},d),i))};async function On(e,t,i,a){var d;const y=Object.assign({},a==null?void 0:a.headers);y[kM]||(y[kM]=iB["2024-01-01"].name),a!=null&&a.jwt&&(y.Authorization=`Bearer ${a.jwt}`);const S=(d=a==null?void 0:a.query)!==null&&d!==void 0?d:{};a!=null&&a.redirectTo&&(S.redirect_to=a.redirectTo);const s=Object.keys(S).length?"?"+new URLSearchParams(S).toString():"",N=await Zte(e,t,i+s,{headers:y,noResolveJson:a==null?void 0:a.noResolveJson},{},a==null?void 0:a.body);return a!=null&&a.xform?a==null?void 0:a.xform(N):{data:Object.assign({},N),error:null}}async function Zte(e,t,i,a,d,y){const S=Wte(t,a,d,y);let s;try{s=await e(i,Object.assign({},S))}catch(N){throw console.error(N),new NM(vf(N),0)}if(s.ok||await bD(s),a!=null&&a.noResolveJson)return s;try{return await s.json()}catch(N){await bD(N)}}function Ed(e){var t;let i=null;Jte(e)&&(i=Object.assign({},e),e.expires_at||(i.expires_at=kte(e.expires_in)));const a=(t=e.user)!==null&&t!==void 0?t:e;return{data:{session:i,user:a},error:null}}function wD(e){const t=Ed(e);return!t.error&&e.weak_password&&typeof e.weak_password=="object"&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&typeof e.weak_password.message=="string"&&e.weak_password.reasons.reduce((i,a)=>i&&typeof a=="string",!0)&&(t.data.weak_password=e.weak_password),t}function Nd(e){var t;return{data:{user:(t=e.user)!==null&&t!==void 0?t:e},error:null}}function Yte(e){return{data:e,error:null}}function Xte(e){const{action_link:t,email_otp:i,hashed_token:a,redirect_to:d,verification_type:y}=e,S=qte(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),s={action_link:t,email_otp:i,hashed_token:a,redirect_to:d,verification_type:y},N=Object.assign({},S);return{data:{properties:s,user:N},error:null}}function Kte(e){return e}function Jte(e){return e.access_token&&e.refresh_token&&e.expires_in}var Qte=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var d=0,a=Object.getOwnPropertySymbols(e);d<a.length;d++)t.indexOf(a[d])<0&&Object.prototype.propertyIsEnumerable.call(e,a[d])&&(i[a[d]]=e[a[d]]);return i};class ere{constructor({url:t="",headers:i={},fetch:a}){this.url=t,this.headers=i,this.fetch=aB(a),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(t,i="global"){try{return await On(this.fetch,"POST",`${this.url}/logout?scope=${i}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(a){if(En(a))return{data:null,error:a};throw a}}async inviteUserByEmail(t,i={}){try{return await On(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:i.data},headers:this.headers,redirectTo:i.redirectTo,xform:Nd})}catch(a){if(En(a))return{data:{user:null},error:a};throw a}}async generateLink(t){try{const{options:i}=t,a=Qte(t,["options"]),d=Object.assign(Object.assign({},a),i);return"newEmail"in a&&(d.new_email=a==null?void 0:a.newEmail,delete d.newEmail),await On(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:d,headers:this.headers,xform:Xte,redirectTo:i==null?void 0:i.redirectTo})}catch(i){if(En(i))return{data:{properties:null,user:null},error:i};throw i}}async createUser(t){try{return await On(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:Nd})}catch(i){if(En(i))return{data:{user:null},error:i};throw i}}async listUsers(t){var i,a,d,y,S,s,N;try{const D={nextPage:null,lastPage:0,total:0},O=await On(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(a=(i=t==null?void 0:t.page)===null||i===void 0?void 0:i.toString())!==null&&a!==void 0?a:"",per_page:(y=(d=t==null?void 0:t.perPage)===null||d===void 0?void 0:d.toString())!==null&&y!==void 0?y:""},xform:Kte});if(O.error)throw O.error;const $=await O.json(),q=(S=O.headers.get("x-total-count"))!==null&&S!==void 0?S:0,J=(N=(s=O.headers.get("link"))===null||s===void 0?void 0:s.split(","))!==null&&N!==void 0?N:[];return J.length>0&&(J.forEach(re=>{const Q=parseInt(re.split(";")[0].split("=")[1].substring(0,1)),ce=JSON.parse(re.split(";")[1].split("=")[1]);D[`${ce}Page`]=Q}),D.total=parseInt(q)),{data:Object.assign(Object.assign({},$),D),error:null}}catch(D){if(En(D))return{data:{users:[]},error:D};throw D}}async getUserById(t){try{return await On(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:Nd})}catch(i){if(En(i))return{data:{user:null},error:i};throw i}}async updateUserById(t,i){try{return await On(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:i,headers:this.headers,xform:Nd})}catch(a){if(En(a))return{data:{user:null},error:a};throw a}}async deleteUser(t,i=!1){try{return await On(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:i},xform:Nd})}catch(a){if(En(a))return{data:{user:null},error:a};throw a}}async _listFactors(t){try{const{data:i,error:a}=await On(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:d=>({data:{factors:d},error:null})});return{data:i,error:a}}catch(i){if(En(i))return{data:null,error:i};throw i}}async _deleteFactor(t){try{return{data:await On(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(i){if(En(i))return{data:null,error:i};throw i}}}const tre={getItem:e=>Rx()?globalThis.localStorage.getItem(e):null,setItem:(e,t)=>{Rx()&&globalThis.localStorage.setItem(e,t)},removeItem:e=>{Rx()&&globalThis.localStorage.removeItem(e)}};function SD(e={}){return{getItem:t=>e[t]||null,setItem:(t,i)=>{e[t]=i},removeItem:t=>{delete e[t]}}}function rre(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Em={debug:!!(globalThis&&Rx()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class cB extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class nre extends cB{}async function ire(e,t,i){Em.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const a=new globalThis.AbortController;return t>0&&setTimeout(()=>{a.abort(),Em.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:a.signal},async d=>{if(d){Em.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,d.name);try{return await i()}finally{Em.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",e,d.name)}}else{if(t===0)throw Em.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new nre(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(Em.debug)try{const y=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(y,null,"  "))}catch(y){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",y)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await i()}}))}rre();const sre={url:gte,storageKey:_te,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:yte,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function TD(e,t,i){return await i()}class dv{constructor(t){var i,a;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=dv.nextInstanceID,dv.nextInstanceID+=1,this.instanceID>0&&uc()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const d=Object.assign(Object.assign({},sre),t);if(this.logDebugMessages=!!d.debug,typeof d.debug=="function"&&(this.logger=d.debug),this.persistSession=d.persistSession,this.storageKey=d.storageKey,this.autoRefreshToken=d.autoRefreshToken,this.admin=new ere({url:d.url,headers:d.headers,fetch:d.fetch}),this.url=d.url,this.headers=d.headers,this.fetch=aB(d.fetch),this.lock=d.lock||TD,this.detectSessionInUrl=d.detectSessionInUrl,this.flowType=d.flowType,this.hasCustomAuthorizationHeader=d.hasCustomAuthorizationHeader,d.lock?this.lock=d.lock:uc()&&(!((i=globalThis==null?void 0:globalThis.navigator)===null||i===void 0)&&i.locks)?this.lock=ire:this.lock=TD,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?d.storage?this.storage=d.storage:Rx()?this.storage=tre:(this.memoryStorage={},this.storage=SD(this.memoryStorage)):(this.memoryStorage={},this.storage=SD(this.memoryStorage)),uc()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(y){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",y)}(a=this.broadcastChannel)===null||a===void 0||a.addEventListener("message",async y=>{this._debug("received broadcast notification from other tab or client",y),await this._notifyAllSubscribers(y.data.event,y.data.session,!1)})}this.initialize()}_debug(...t){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${nB}) ${new Date().toISOString()}`,...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{const i=Rte(window.location.href);let a="none";if(this._isImplicitGrantCallback(i)?a="implicit":await this._isPKCECallback(i)&&(a="pkce"),uc()&&this.detectSessionInUrl&&a!=="none"){const{data:d,error:y}=await this._getSessionFromURL(i,a);if(y){if(this._debug("#_initialize()","error detecting session from URL",y),Tte(y)){const N=(t=y.details)===null||t===void 0?void 0:t.code;if(N==="identity_already_exists"||N==="identity_not_found"||N==="single_identity_not_deletable")return{error:y}}return await this._removeSession(),{error:y}}const{session:S,redirectType:s}=d;return this._debug("#_initialize()","detected session in URL",S,"redirect type",s),await this._saveSession(S),setTimeout(async()=>{s==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",S):await this._notifyAllSubscribers("SIGNED_IN",S)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(i){return En(i)?{error:i}:{error:new sB("Unexpected error during initialization",i)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var i,a,d;try{const y=await On(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(a=(i=t==null?void 0:t.options)===null||i===void 0?void 0:i.data)!==null&&a!==void 0?a:{},gotrue_meta_security:{captcha_token:(d=t==null?void 0:t.options)===null||d===void 0?void 0:d.captchaToken}},xform:Ed}),{data:S,error:s}=y;if(s||!S)return{data:{user:null,session:null},error:s};const N=S.session,D=S.user;return S.session&&(await this._saveSession(S.session),await this._notifyAllSubscribers("SIGNED_IN",N)),{data:{user:D,session:N},error:null}}catch(y){if(En(y))return{data:{user:null,session:null},error:y};throw y}}async signUp(t){var i,a,d;try{let y;if("email"in t){const{email:O,password:$,options:q}=t;let J=null,re=null;this.flowType==="pkce"&&([J,re]=await Tm(this.storage,this.storageKey)),y=await On(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:q==null?void 0:q.emailRedirectTo,body:{email:O,password:$,data:(i=q==null?void 0:q.data)!==null&&i!==void 0?i:{},gotrue_meta_security:{captcha_token:q==null?void 0:q.captchaToken},code_challenge:J,code_challenge_method:re},xform:Ed})}else if("phone"in t){const{phone:O,password:$,options:q}=t;y=await On(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:O,password:$,data:(a=q==null?void 0:q.data)!==null&&a!==void 0?a:{},channel:(d=q==null?void 0:q.channel)!==null&&d!==void 0?d:"sms",gotrue_meta_security:{captcha_token:q==null?void 0:q.captchaToken}},xform:Ed})}else throw new vb("You must provide either an email or phone number and a password");const{data:S,error:s}=y;if(s||!S)return{data:{user:null,session:null},error:s};const N=S.session,D=S.user;return S.session&&(await this._saveSession(S.session),await this._notifyAllSubscribers("SIGNED_IN",N)),{data:{user:D,session:N},error:null}}catch(y){if(En(y))return{data:{user:null,session:null},error:y};throw y}}async signInWithPassword(t){try{let i;if("email"in t){const{email:y,password:S,options:s}=t;i=await On(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:y,password:S,gotrue_meta_security:{captcha_token:s==null?void 0:s.captchaToken}},xform:wD})}else if("phone"in t){const{phone:y,password:S,options:s}=t;i=await On(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:y,password:S,gotrue_meta_security:{captcha_token:s==null?void 0:s.captchaToken}},xform:wD})}else throw new vb("You must provide either an email or phone number and a password");const{data:a,error:d}=i;return d?{data:{user:null,session:null},error:d}:!a||!a.session||!a.user?{data:{user:null,session:null},error:new WE}:(a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),{data:Object.assign({user:a.user,session:a.session},a.weak_password?{weakPassword:a.weak_password}:null),error:d})}catch(i){if(En(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithOAuth(t){var i,a,d,y;return await this._handleProviderSignIn(t.provider,{redirectTo:(i=t.options)===null||i===void 0?void 0:i.redirectTo,scopes:(a=t.options)===null||a===void 0?void 0:a.scopes,queryParams:(d=t.options)===null||d===void 0?void 0:d.queryParams,skipBrowserRedirect:(y=t.options)===null||y===void 0?void 0:y.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(t))}async _exchangeCodeForSession(t){const i=await wb(this.storage,`${this.storageKey}-code-verifier`),[a,d]=(i??"").split("/");try{const{data:y,error:S}=await On(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:a},xform:Ed});if(await Sb(this.storage,`${this.storageKey}-code-verifier`),S)throw S;return!y||!y.session||!y.user?{data:{user:null,session:null,redirectType:null},error:new WE}:(y.session&&(await this._saveSession(y.session),await this._notifyAllSubscribers("SIGNED_IN",y.session)),{data:Object.assign(Object.assign({},y),{redirectType:d??null}),error:S})}catch(y){if(En(y))return{data:{user:null,session:null,redirectType:null},error:y};throw y}}async signInWithIdToken(t){try{const{options:i,provider:a,token:d,access_token:y,nonce:S}=t,s=await On(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:a,id_token:d,access_token:y,nonce:S,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},xform:Ed}),{data:N,error:D}=s;return D?{data:{user:null,session:null},error:D}:!N||!N.session||!N.user?{data:{user:null,session:null},error:new WE}:(N.session&&(await this._saveSession(N.session),await this._notifyAllSubscribers("SIGNED_IN",N.session)),{data:N,error:D})}catch(i){if(En(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithOtp(t){var i,a,d,y,S;try{if("email"in t){const{email:s,options:N}=t;let D=null,O=null;this.flowType==="pkce"&&([D,O]=await Tm(this.storage,this.storageKey));const{error:$}=await On(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:s,data:(i=N==null?void 0:N.data)!==null&&i!==void 0?i:{},create_user:(a=N==null?void 0:N.shouldCreateUser)!==null&&a!==void 0?a:!0,gotrue_meta_security:{captcha_token:N==null?void 0:N.captchaToken},code_challenge:D,code_challenge_method:O},redirectTo:N==null?void 0:N.emailRedirectTo});return{data:{user:null,session:null},error:$}}if("phone"in t){const{phone:s,options:N}=t,{data:D,error:O}=await On(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:s,data:(d=N==null?void 0:N.data)!==null&&d!==void 0?d:{},create_user:(y=N==null?void 0:N.shouldCreateUser)!==null&&y!==void 0?y:!0,gotrue_meta_security:{captcha_token:N==null?void 0:N.captchaToken},channel:(S=N==null?void 0:N.channel)!==null&&S!==void 0?S:"sms"}});return{data:{user:null,session:null,messageId:D==null?void 0:D.message_id},error:O}}throw new vb("You must provide either an email or phone number.")}catch(s){if(En(s))return{data:{user:null,session:null},error:s};throw s}}async verifyOtp(t){var i,a;try{let d,y;"options"in t&&(d=(i=t.options)===null||i===void 0?void 0:i.redirectTo,y=(a=t.options)===null||a===void 0?void 0:a.captchaToken);const{data:S,error:s}=await On(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:y}}),redirectTo:d,xform:Ed});if(s)throw s;if(!S)throw new Error("An error occurred on token verification.");const N=S.session,D=S.user;return N!=null&&N.access_token&&(await this._saveSession(N),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",N)),{data:{user:D,session:N},error:null}}catch(d){if(En(d))return{data:{user:null,session:null},error:d};throw d}}async signInWithSSO(t){var i,a,d;try{let y=null,S=null;return this.flowType==="pkce"&&([y,S]=await Tm(this.storage,this.storageKey)),await On(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(a=(i=t.options)===null||i===void 0?void 0:i.redirectTo)!==null&&a!==void 0?a:void 0}),!((d=t==null?void 0:t.options)===null||d===void 0)&&d.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:y,code_challenge_method:S}),headers:this.headers,xform:Yte})}catch(y){if(En(y))return{data:null,error:y};throw y}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:i},error:a}=t;if(a)throw a;if(!i)throw new Td;const{error:d}=await On(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:i.access_token});return{data:{user:null,session:null},error:d}})}catch(t){if(En(t))return{data:{user:null,session:null},error:t};throw t}}async resend(t){try{const i=`${this.url}/resend`;if("email"in t){const{email:a,type:d,options:y}=t,{error:S}=await On(this.fetch,"POST",i,{headers:this.headers,body:{email:a,type:d,gotrue_meta_security:{captcha_token:y==null?void 0:y.captchaToken}},redirectTo:y==null?void 0:y.emailRedirectTo});return{data:{user:null,session:null},error:S}}else if("phone"in t){const{phone:a,type:d,options:y}=t,{data:S,error:s}=await On(this.fetch,"POST",i,{headers:this.headers,body:{phone:a,type:d,gotrue_meta_security:{captcha_token:y==null?void 0:y.captchaToken}}});return{data:{user:null,session:null,messageId:S==null?void 0:S.message_id},error:s}}throw new vb("You must provide either an email or phone number and a type")}catch(i){if(En(i))return{data:{user:null,session:null},error:i};throw i}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async i=>i))}async _acquireLock(t,i){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const a=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),d=(async()=>(await a,await i()))();return this.pendingInLock.push((async()=>{try{await d}catch{}})()),d}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const a=i();for(this.pendingInLock.push((async()=>{try{await a}catch{}})()),await a;this.pendingInLock.length;){const d=[...this.pendingInLock];await Promise.all(d),this.pendingInLock.splice(0,d.length)}return await a}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const i=await this.__loadSession();return await t(i)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const i=await wb(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",i),i!==null&&(this._isValidSession(i)?t=i:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const a=t.expires_at?t.expires_at*1e3-Date.now()<HE:!1;if(this._debug("#__loadSession()",`session has${a?"":" not"} expired`,"expires_at",t.expires_at),!a){if(this.storage.isServer){let S=this.suppressGetSessionWarning;t=new Proxy(t,{get:(N,D,O)=>(!S&&D==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),S=!0,this.suppressGetSessionWarning=!0),Reflect.get(N,D,O))})}return{data:{session:t},error:null}}const{session:d,error:y}=await this._callRefreshToken(t.refresh_token);return y?{data:{session:null},error:y}:{data:{session:d},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(t){return t?await this._getUser(t):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(t){try{return t?await On(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:Nd}):await this._useSession(async i=>{var a,d,y;const{data:S,error:s}=i;if(s)throw s;return!(!((a=S.session)===null||a===void 0)&&a.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Td}:await On(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(y=(d=S.session)===null||d===void 0?void 0:d.access_token)!==null&&y!==void 0?y:void 0,xform:Nd})})}catch(i){if(En(i))return Ste(i)&&(await this._removeSession(),await Sb(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:i};throw i}}async updateUser(t,i={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(t,i))}async _updateUser(t,i={}){try{return await this._useSession(async a=>{const{data:d,error:y}=a;if(y)throw y;if(!d.session)throw new Td;const S=d.session;let s=null,N=null;this.flowType==="pkce"&&t.email!=null&&([s,N]=await Tm(this.storage,this.storageKey));const{data:D,error:O}=await On(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:i==null?void 0:i.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:s,code_challenge_method:N}),jwt:S.access_token,xform:Nd});if(O)throw O;return S.user=D.user,await this._saveSession(S),await this._notifyAllSubscribers("USER_UPDATED",S),{data:{user:S.user},error:null}})}catch(a){if(En(a))return{data:{user:null},error:a};throw a}}async setSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new Td;const i=Date.now()/1e3;let a=i,d=!0,y=null;const{payload:S}=YE(t.access_token);if(S.exp&&(a=S.exp,d=a<=i),d){const{session:s,error:N}=await this._callRefreshToken(t.refresh_token);if(N)return{data:{user:null,session:null},error:N};if(!s)return{data:{user:null,session:null},error:null};y=s}else{const{data:s,error:N}=await this._getUser(t.access_token);if(N)throw N;y={access_token:t.access_token,refresh_token:t.refresh_token,user:s.user,token_type:"bearer",expires_in:a-i,expires_at:a},await this._saveSession(y),await this._notifyAllSubscribers("SIGNED_IN",y)}return{data:{user:y.user,session:y},error:null}}catch(i){if(En(i))return{data:{session:null,user:null},error:i};throw i}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async i=>{var a;if(!t){const{data:S,error:s}=i;if(s)throw s;t=(a=S.session)!==null&&a!==void 0?a:void 0}if(!(t!=null&&t.refresh_token))throw new Td;const{session:d,error:y}=await this._callRefreshToken(t.refresh_token);return y?{data:{user:null,session:null},error:y}:d?{data:{user:d.user,session:d},error:null}:{data:{user:null,session:null},error:null}})}catch(i){if(En(i))return{data:{user:null,session:null},error:i};throw i}}async _getSessionFromURL(t,i){try{if(!uc())throw new bb("No browser detected.");if(t.error||t.error_description||t.error_code)throw new bb(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(i){case"implicit":if(this.flowType==="pkce")throw new gD("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new bb("Not a valid implicit grant flow url.");break;default:}if(i==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new gD("No code detected.");const{data:ae,error:he}=await this._exchangeCodeForSession(t.code);if(he)throw he;const Se=new URL(window.location.href);return Se.searchParams.delete("code"),window.history.replaceState(window.history.state,"",Se.toString()),{data:{session:ae.session,redirectType:null},error:null}}const{provider_token:a,provider_refresh_token:d,access_token:y,refresh_token:S,expires_in:s,expires_at:N,token_type:D}=t;if(!y||!s||!S||!D)throw new bb("No session defined in URL");const O=Math.round(Date.now()/1e3),$=parseInt(s);let q=O+$;N&&(q=parseInt(N));const J=q-O;J*1e3<=Am&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${J}s, should have been closer to ${$}s`);const re=q-$;O-re>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",re,q,O):O-re<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",re,q,O);const{data:Q,error:ce}=await this._getUser(y);if(ce)throw ce;const le={provider_token:a,provider_refresh_token:d,access_token:y,expires_in:$,expires_at:q,refresh_token:S,token_type:D,user:Q.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:le,redirectType:t.type},error:null}}catch(a){if(En(a))return{data:{session:null,redirectType:null},error:a};throw a}}_isImplicitGrantCallback(t){return!!(t.access_token||t.error_description)}async _isPKCECallback(t){const i=await wb(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&i)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async i=>{var a;const{data:d,error:y}=i;if(y)return{error:y};const S=(a=d.session)===null||a===void 0?void 0:a.access_token;if(S){const{error:s}=await this.admin.signOut(S,t);if(s&&!(wte(s)&&(s.status===404||s.status===401||s.status===403)))return{error:s}}return t!=="others"&&(await this._removeSession(),await Sb(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(t){const i=Nte(),a={id:i,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",i),this.stateChangeEmitters.delete(i)}};return this._debug("#onAuthStateChange()","registered callback with id",i),this.stateChangeEmitters.set(i,a),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(i)})))(),{data:{subscription:a}}}async _emitInitialSession(t){return await this._useSession(async i=>{var a,d;try{const{data:{session:y},error:S}=i;if(S)throw S;await((a=this.stateChangeEmitters.get(t))===null||a===void 0?void 0:a.callback("INITIAL_SESSION",y)),this._debug("INITIAL_SESSION","callback id",t,"session",y)}catch(y){await((d=this.stateChangeEmitters.get(t))===null||d===void 0?void 0:d.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",y),console.error(y)}})}async resetPasswordForEmail(t,i={}){let a=null,d=null;this.flowType==="pkce"&&([a,d]=await Tm(this.storage,this.storageKey,!0));try{return await On(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:a,code_challenge_method:d,gotrue_meta_security:{captcha_token:i.captchaToken}},headers:this.headers,redirectTo:i.redirectTo})}catch(y){if(En(y))return{data:null,error:y};throw y}}async getUserIdentities(){var t;try{const{data:i,error:a}=await this.getUser();if(a)throw a;return{data:{identities:(t=i.user.identities)!==null&&t!==void 0?t:[]},error:null}}catch(i){if(En(i))return{data:null,error:i};throw i}}async linkIdentity(t){var i;try{const{data:a,error:d}=await this._useSession(async y=>{var S,s,N,D,O;const{data:$,error:q}=y;if(q)throw q;const J=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(S=t.options)===null||S===void 0?void 0:S.redirectTo,scopes:(s=t.options)===null||s===void 0?void 0:s.scopes,queryParams:(N=t.options)===null||N===void 0?void 0:N.queryParams,skipBrowserRedirect:!0});return await On(this.fetch,"GET",J,{headers:this.headers,jwt:(O=(D=$.session)===null||D===void 0?void 0:D.access_token)!==null&&O!==void 0?O:void 0})});if(d)throw d;return uc()&&!(!((i=t.options)===null||i===void 0)&&i.skipBrowserRedirect)&&window.location.assign(a==null?void 0:a.url),{data:{provider:t.provider,url:a==null?void 0:a.url},error:null}}catch(a){if(En(a))return{data:{provider:t.provider,url:null},error:a};throw a}}async unlinkIdentity(t){try{return await this._useSession(async i=>{var a,d;const{data:y,error:S}=i;if(S)throw S;return await On(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(d=(a=y.session)===null||a===void 0?void 0:a.access_token)!==null&&d!==void 0?d:void 0})})}catch(i){if(En(i))return{data:null,error:i};throw i}}async _refreshAccessToken(t){const i=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(i,"begin");try{const a=Date.now();return await Lte(async d=>(d>0&&await Dte(200*Math.pow(2,d-1)),this._debug(i,"refreshing attempt",d),await On(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:Ed})),(d,y)=>{const S=200*Math.pow(2,d);return y&&ZE(y)&&Date.now()+S-a<Am})}catch(a){if(this._debug(i,"error",a),En(a))return{data:{session:null,user:null},error:a};throw a}finally{this._debug(i,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,i){const a=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:i.redirectTo,scopes:i.scopes,queryParams:i.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",i,"url",a),uc()&&!i.skipBrowserRedirect&&window.location.assign(a),{data:{provider:t,url:a},error:null}}async _recoverAndRefresh(){var t;const i="#_recoverAndRefresh()";this._debug(i,"begin");try{const a=await wb(this.storage,this.storageKey);if(this._debug(i,"session from storage",a),!this._isValidSession(a)){this._debug(i,"session is not valid"),a!==null&&await this._removeSession();return}const d=((t=a.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<HE;if(this._debug(i,`session has${d?"":" not"} expired with margin of ${HE}s`),d){if(this.autoRefreshToken&&a.refresh_token){const{error:y}=await this._callRefreshToken(a.refresh_token);y&&(console.error(y),ZE(y)||(this._debug(i,"refresh failed with a non-retryable error, removing the session",y),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",a)}catch(a){this._debug(i,"error",a),console.error(a);return}finally{this._debug(i,"end")}}async _callRefreshToken(t){var i,a;if(!t)throw new Td;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const d=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(d,"begin");try{this.refreshingDeferred=new B2;const{data:y,error:S}=await this._refreshAccessToken(t);if(S)throw S;if(!y.session)throw new Td;await this._saveSession(y.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",y.session);const s={session:y.session,error:null};return this.refreshingDeferred.resolve(s),s}catch(y){if(this._debug(d,"error",y),En(y)){const S={session:null,error:y};return ZE(y)||await this._removeSession(),(i=this.refreshingDeferred)===null||i===void 0||i.resolve(S),S}throw(a=this.refreshingDeferred)===null||a===void 0||a.reject(y),y}finally{this.refreshingDeferred=null,this._debug(d,"end")}}async _notifyAllSubscribers(t,i,a=!0){const d=`#_notifyAllSubscribers(${t})`;this._debug(d,"begin",i,`broadcast = ${a}`);try{this.broadcastChannel&&a&&this.broadcastChannel.postMessage({event:t,session:i});const y=[],S=Array.from(this.stateChangeEmitters.values()).map(async s=>{try{await s.callback(t,i)}catch(N){y.push(N)}});if(await Promise.all(S),y.length>0){for(let s=0;s<y.length;s+=1)console.error(y[s]);throw y[0]}}finally{this._debug(d,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0,await lB(this.storage,this.storageKey,t)}async _removeSession(){this._debug("#_removeSession()"),await Sb(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&uc()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",t)}catch(i){console.error("removing visibilitychange callback failed",i)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),Am);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async i=>{const{data:{session:a}}=i;if(!a||!a.refresh_token||!a.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const d=Math.floor((a.expires_at*1e3-t)/Am);this._debug("#_autoRefreshTokenTick()",`access token expires in ${d} ticks, a tick lasts ${Am}ms, refresh threshold is ${IM} ticks`),d<=IM&&await this._callRefreshToken(a.refresh_token)})}catch(i){console.error("Auto refresh tick failed with error. This is likely a transient error.",i)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof cB)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!uc()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const i=`#_onVisibilityChanged(${t})`;this._debug(i,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(i,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,i,a){const d=[`provider=${encodeURIComponent(i)}`];if(a!=null&&a.redirectTo&&d.push(`redirect_to=${encodeURIComponent(a.redirectTo)}`),a!=null&&a.scopes&&d.push(`scopes=${encodeURIComponent(a.scopes)}`),this.flowType==="pkce"){const[y,S]=await Tm(this.storage,this.storageKey),s=new URLSearchParams({code_challenge:`${encodeURIComponent(y)}`,code_challenge_method:`${encodeURIComponent(S)}`});d.push(s.toString())}if(a!=null&&a.queryParams){const y=new URLSearchParams(a.queryParams);d.push(y.toString())}return a!=null&&a.skipBrowserRedirect&&d.push(`skip_http_redirect=${a.skipBrowserRedirect}`),`${t}?${d.join("&")}`}async _unenroll(t){try{return await this._useSession(async i=>{var a;const{data:d,error:y}=i;return y?{data:null,error:y}:await On(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(a=d==null?void 0:d.session)===null||a===void 0?void 0:a.access_token})})}catch(i){if(En(i))return{data:null,error:i};throw i}}async _enroll(t){try{return await this._useSession(async i=>{var a,d;const{data:y,error:S}=i;if(S)return{data:null,error:S};const s=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:{issuer:t.issuer}),{data:N,error:D}=await On(this.fetch,"POST",`${this.url}/factors`,{body:s,headers:this.headers,jwt:(a=y==null?void 0:y.session)===null||a===void 0?void 0:a.access_token});return D?{data:null,error:D}:(t.factorType==="totp"&&(!((d=N==null?void 0:N.totp)===null||d===void 0)&&d.qr_code)&&(N.totp.qr_code=`data:image/svg+xml;utf-8,${N.totp.qr_code}`),{data:N,error:null})})}catch(i){if(En(i))return{data:null,error:i};throw i}}async _verify(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async i=>{var a;const{data:d,error:y}=i;if(y)return{data:null,error:y};const{data:S,error:s}=await On(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:{code:t.code,challenge_id:t.challengeId},headers:this.headers,jwt:(a=d==null?void 0:d.session)===null||a===void 0?void 0:a.access_token});return s?{data:null,error:s}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+S.expires_in},S)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",S),{data:S,error:s})})}catch(i){if(En(i))return{data:null,error:i};throw i}})}async _challenge(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async i=>{var a;const{data:d,error:y}=i;return y?{data:null,error:y}:await On(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:{channel:t.channel},headers:this.headers,jwt:(a=d==null?void 0:d.session)===null||a===void 0?void 0:a.access_token})})}catch(i){if(En(i))return{data:null,error:i};throw i}})}async _challengeAndVerify(t){const{data:i,error:a}=await this._challenge({factorId:t.factorId});return a?{data:null,error:a}:await this._verify({factorId:t.factorId,challengeId:i.id,code:t.code})}async _listFactors(){const{data:{user:t},error:i}=await this.getUser();if(i)return{data:null,error:i};const a=(t==null?void 0:t.factors)||[],d=a.filter(S=>S.factor_type==="totp"&&S.status==="verified"),y=a.filter(S=>S.factor_type==="phone"&&S.status==="verified");return{data:{all:a,totp:d,phone:y},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async t=>{var i,a;const{data:{session:d},error:y}=t;if(y)return{data:null,error:y};if(!d)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:S}=YE(d.access_token);let s=null;S.aal&&(s=S.aal);let N=s;((a=(i=d.user.factors)===null||i===void 0?void 0:i.filter($=>$.status==="verified"))!==null&&a!==void 0?a:[]).length>0&&(N="aal2");const O=S.amr||[];return{data:{currentLevel:s,nextLevel:N,currentAuthenticationMethods:O},error:null}}))}async fetchJwk(t,i={keys:[]}){let a=i.keys.find(S=>S.kid===t);if(a||(a=this.jwks.keys.find(S=>S.kid===t),a&&this.jwks_cached_at+vte>Date.now()))return a;const{data:d,error:y}=await On(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(y)throw y;if(!d.keys||d.keys.length===0)throw new Nx("JWKS is empty");if(this.jwks=d,this.jwks_cached_at=Date.now(),a=d.keys.find(S=>S.kid===t),!a)throw new Nx("No matching signing key found in JWKS");return a}async getClaims(t,i={keys:[]}){try{let a=t;if(!a){const{data:J,error:re}=await this.getSession();if(re||!J.session)return{data:null,error:re};a=J.session.access_token}const{header:d,payload:y,signature:S,raw:{header:s,payload:N}}=YE(a);if($te(y.exp),!d.kid||d.alg==="HS256"||!("crypto"in globalThis&&"subtle"in globalThis.crypto)){const{error:J}=await this.getUser(a);if(J)throw J;return{data:{claims:y,header:d,signature:S},error:null}}const D=Gte(d.alg),O=await this.fetchJwk(d.kid,i),$=await crypto.subtle.importKey("jwk",O,D,!0,["verify"]);if(!await crypto.subtle.verify(D,$,S,Ite(`${s}.${N}`)))throw new Nx("Invalid JWT signature");return{data:{claims:y,header:d,signature:S},error:null}}catch(a){if(En(a))return{data:null,error:a};throw a}}}dv.nextInstanceID=0;const ore=dv;class are extends ore{constructor(t){super(t)}}var lre=function(e,t,i,a){function d(y){return y instanceof i?y:new i(function(S){S(y)})}return new(i||(i=Promise))(function(y,S){function s(O){try{D(a.next(O))}catch($){S($)}}function N(O){try{D(a.throw(O))}catch($){S($)}}function D(O){O.done?y(O.value):d(O.value).then(s,N)}D((a=a.apply(e,t||[])).next())})};class cre{constructor(t,i,a){var d,y,S;if(this.supabaseUrl=t,this.supabaseKey=i,!t)throw new Error("supabaseUrl is required.");if(!i)throw new Error("supabaseKey is required.");const s=pte(t);this.realtimeUrl=`${s}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${s}/auth/v1`,this.storageUrl=`${s}/storage/v1`,this.functionsUrl=`${s}/functions/v1`;const N=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,D={db:ote,realtime:lte,auth:Object.assign(Object.assign({},ate),{storageKey:N}),global:ste},O=mte(a??{},D);this.storageKey=(d=O.auth.storageKey)!==null&&d!==void 0?d:"",this.headers=(y=O.global.headers)!==null&&y!==void 0?y:{},O.accessToken?(this.accessToken=O.accessToken,this.auth=new Proxy({},{get:($,q)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(q)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((S=O.auth)!==null&&S!==void 0?S:{},this.headers,O.global.fetch),this.fetch=hte(i,this._getAccessToken.bind(this),O.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},O.realtime)),this.rest=new Mee(`${s}/rest/v1`,{headers:this.headers,schema:O.db.schema,fetch:this.fetch}),O.accessToken||this._listenForAuthEvents()}get functions(){return new nee(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new rte(this.storageUrl,this.headers,this.fetch)}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,i={},a={}){return this.rest.rpc(t,i,a)}channel(t,i={config:{}}){return this.realtime.channel(t,i)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var t,i;return lre(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:a}=yield this.auth.getSession();return(i=(t=a.session)===null||t===void 0?void 0:t.access_token)!==null&&i!==void 0?i:null})}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:i,detectSessionInUrl:a,storage:d,storageKey:y,flowType:S,lock:s,debug:N},D,O){const $={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new are({url:this.authUrl,headers:Object.assign(Object.assign({},$),D),storageKey:y,autoRefreshToken:t,persistSession:i,detectSessionInUrl:a,storage:d,flowType:S,lock:s,debug:N,fetch:O,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(t){return new Uee(this.realtimeUrl,Object.assign(Object.assign({},t),{params:Object.assign({apikey:this.supabaseKey},t==null?void 0:t.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((i,a)=>{this._handleTokenChanged(i,"CLIENT",a==null?void 0:a.access_token)})}_handleTokenChanged(t,i,a){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==a?this.changedAccessToken=a:t==="SIGNED_OUT"&&(this.realtime.setAuth(),i=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const uB=(e,t,i)=>new cre(e,t,i),dB="https://geeuxuskzdnpcuirrkqv.supabase.co",ure="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdlZXV4dXNremRucGN1aXJya3F2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY1MzQ2ODAsImV4cCI6MjA2MjExMDY4MH0.YS4Kjb_cxMq7IjUG_UVU7GE0rQF0A09stuWbPhPhqDg",Pi=uB(dB,ure,{auth:{autoRefreshToken:!0,persistSession:!0,storage:localStorage,detectSessionInUrl:!0,flowType:"pkce"}});console.log("Supabase client initialized with URL:",dB);console.log("Supabase client initialization successful:",!!Pi);const dre=()=>{const[e,t]=H.useState(!0),[i,a]=H.useState(null),[d,y]=H.useState(null),[S,s]=H.useState(!1),N=$l();return H.useEffect(()=>{console.log("Index page loaded"),(async()=>{var $,q;try{const{data:J,error:re}=await Pi.auth.getSession();if(re)console.error("Supabase connection error:",re),a("Failed to connect to Supabase. Check the console for details.");else if(console.log("Supabase connection successful:",J.session?"User is logged in":"No active session"),y((($=J.session)==null?void 0:$.user)||null),(q=J.session)!=null&&q.user){const{data:Q}=await Pi.from("user_payments").select("has_paid").eq("user_id",J.session.user.id).single();s((Q==null?void 0:Q.has_paid)||!1)}}catch(J){console.error("Error checking user session:",J),a("An unexpected error occurred while connecting to Supabase.")}finally{t(!1)}})();const{data:{subscription:O}}=Pi.auth.onAuthStateChange(async($,q)=>{if(y((q==null?void 0:q.user)||null),q!=null&&q.user){const{data:J}=await Pi.from("user_payments").select("has_paid").eq("user_id",q.user.id).single();s((J==null?void 0:J.has_paid)||!1)}else s(!1)});return()=>O.unsubscribe()},[]),e?f.jsxs("div",{className:"min-h-screen flex flex-col",children:[f.jsx(gi,{}),f.jsx("div",{className:"flex-grow flex items-center justify-center",children:f.jsx("p",{className:"text-lg",children:"Loading..."})}),f.jsx(_i,{})]}):i?f.jsxs("div",{className:"min-h-screen flex flex-col",children:[f.jsx(gi,{}),f.jsx("div",{className:"flex-grow flex items-center justify-center p-4",children:f.jsxs("div",{className:"bg-red-50 border border-red-200 p-4 rounded-md max-w-md",children:[f.jsx("h2",{className:"text-lg font-semibold text-red-800 mb-2",children:"Error"}),f.jsx("p",{className:"text-red-700",children:i}),f.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Please check the browser console for more details."})]})}),f.jsx(_i,{})]}):d&&!S?f.jsxs("div",{className:"min-h-screen flex flex-col",children:[f.jsx(gi,{}),f.jsx("main",{className:"flex-grow flex items-center justify-center p-4 bg-gray-50",children:f.jsx("div",{className:"max-w-2xl mx-auto text-center",children:f.jsx(Zr,{className:"border-blue-200 bg-white shadow-lg",children:f.jsxs(Kr,{className:"p-8",children:[f.jsx(p2,{className:"h-16 w-16 text-blue-600 mx-auto mb-6"}),f.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Welcome to SwapSpot!"}),f.jsx("p",{className:"text-xl text-gray-600 mb-6",children:"You're signed in, but need access to connect with verified students."}),f.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6 mb-6",children:[f.jsx("h3",{className:"font-semibold text-blue-800 mb-3",children:"What you'll get with SwapSpot Access:"}),f.jsxs("ul",{className:"text-left text-blue-700 space-y-2",children:[f.jsx("li",{children:"✓ Connect with unlimited verified students"}),f.jsx("li",{children:"✓ Email notifications when you match"}),f.jsx("li",{children:"✓ Access to all contact information"}),f.jsx("li",{children:"✓ Priority support"})]})]}),f.jsxs("div",{className:"flex items-baseline justify-center gap-1 mb-6",children:[f.jsx("span",{className:"text-4xl font-bold text-blue-800",children:"€25"}),f.jsx("span",{className:"text-lg text-blue-600",children:"one-time payment"})]}),f.jsx(Kt,{onClick:()=>N("/required-signup"),className:"bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 text-lg",children:"Get SwapSpot Access"}),f.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-8 pt-6 border-t",children:[f.jsxs("div",{className:"text-center",children:[f.jsx(Ao,{className:"h-6 w-6 text-green-600 mx-auto mb-1"}),f.jsx("p",{className:"text-xs text-gray-600",children:"Verified Students"})]}),f.jsxs("div",{className:"text-center",children:[f.jsx(Qo,{className:"h-6 w-6 text-blue-600 mx-auto mb-1"}),f.jsx("p",{className:"text-xs text-gray-600",children:"10,000+ Members"})]}),f.jsxs("div",{className:"text-center",children:[f.jsx("span",{className:"text-yellow-500 text-lg",children:"★★★★★"}),f.jsx("p",{className:"text-xs text-gray-600",children:"4.8/5 Rating"})]})]})]})})})}),f.jsx(_i,{})]}):f.jsxs("div",{className:"min-h-screen flex flex-col",children:[f.jsx(gi,{}),f.jsx("main",{className:"flex-grow",children:d&&S?f.jsxs("div",{className:"container mx-auto px-4 py-8",children:[f.jsx(YQ,{userPreferences:{location:"Europe",dates:{startDate:"2025-09-01",endDate:"2025-12-15"},university:"Student Exchange Program"},className:"mb-12"}),f.jsx(cD,{})]}):f.jsxs(f.Fragment,{children:[f.jsx(RQ,{}),f.jsx(jQ,{}),f.jsx(DQ,{}),f.jsx(cD,{}),f.jsx(WQ,{}),f.jsx(ZQ,{})]})}),f.jsx(_i,{})]})},Pn=H.forwardRef(({className:e,type:t,...i},a)=>f.jsx("input",{type:t,className:br("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:a,...i}));Pn.displayName="Input";const hre=Og("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),_u=H.forwardRef(({className:e,variant:t,...i},a)=>f.jsx("div",{ref:a,role:"alert",className:br(hre({variant:t}),e),...i}));_u.displayName="Alert";const fre=H.forwardRef(({className:e,...t},i)=>f.jsx("h5",{ref:i,className:br("mb-1 font-medium leading-none tracking-tight",e),...t}));fre.displayName="AlertTitle";const yu=H.forwardRef(({className:e,...t},i)=>f.jsx("div",{ref:i,className:br("text-sm [&_p]:leading-relaxed",e),...t}));yu.displayName="AlertDescription";function RM(e,[t,i]){return Math.min(i,Math.max(t,e))}var pre=[" ","Enter","ArrowUp","ArrowDown"],mre=[" ","Enter"],Yv="Select",[V2,U2,gre]=Dg(Yv),[Hg,kce]=ta(Yv,[gre,gh]),$2=gh(),[_re,vh]=Hg(Yv),[yre,xre]=Hg(Yv),hB=e=>{const{__scopeSelect:t,children:i,open:a,defaultOpen:d,onOpenChange:y,value:S,defaultValue:s,onValueChange:N,dir:D,name:O,autoComplete:$,disabled:q,required:J,form:re}=e,Q=$2(t),[ce,le]=H.useState(null),[ae,he]=H.useState(null),[Se,je]=H.useState(!1),it=Qf(D),[qe=!1,ct]=Xa({prop:a,defaultProp:d,onChange:y}),[pt,Ze]=Xa({prop:S,defaultProp:s,onChange:N}),yt=H.useRef(null),Mt=ce?re||!!ce.closest("form"):!0,[Jt,jt]=H.useState(new Set),Pt=Array.from(Jt).map(Wt=>Wt.props.value).join(";");return f.jsx(aP,{...Q,children:f.jsxs(_re,{required:J,scope:t,trigger:ce,onTriggerChange:le,valueNode:ae,onValueNodeChange:he,valueNodeHasChildren:Se,onValueNodeHasChildrenChange:je,contentId:ba(),value:pt,onValueChange:Ze,open:qe,onOpenChange:ct,dir:it,triggerPointerDownPosRef:yt,disabled:q,children:[f.jsx(V2.Provider,{scope:t,children:f.jsx(yre,{scope:e.__scopeSelect,onNativeOptionAdd:H.useCallback(Wt=>{jt(Nt=>new Set(Nt).add(Wt))},[]),onNativeOptionRemove:H.useCallback(Wt=>{jt(Nt=>{const Xe=new Set(Nt);return Xe.delete(Wt),Xe})},[]),children:i})}),Mt?f.jsxs(OB,{"aria-hidden":!0,required:J,tabIndex:-1,name:O,autoComplete:$,value:pt,onChange:Wt=>Ze(Wt.target.value),disabled:q,form:re,children:[pt===void 0?f.jsx("option",{value:""}):null,Array.from(Jt)]},Pt):null]})})};hB.displayName=Yv;var fB="SelectTrigger",pB=H.forwardRef((e,t)=>{const{__scopeSelect:i,disabled:a=!1,...d}=e,y=$2(i),S=vh(fB,i),s=S.disabled||a,N=dn(t,S.onTriggerChange),D=U2(i),O=H.useRef("touch"),[$,q,J]=zB(Q=>{const ce=D().filter(he=>!he.disabled),le=ce.find(he=>he.value===S.value),ae=FB(ce,Q,le);ae!==void 0&&S.onValueChange(ae.value)}),re=Q=>{s||(S.onOpenChange(!0),J()),Q&&(S.triggerPointerDownPosRef.current={x:Math.round(Q.pageX),y:Math.round(Q.pageY)})};return f.jsx(Vv,{asChild:!0,...y,children:f.jsx(wr.button,{type:"button",role:"combobox","aria-controls":S.contentId,"aria-expanded":S.open,"aria-required":S.required,"aria-autocomplete":"none",dir:S.dir,"data-state":S.open?"open":"closed",disabled:s,"data-disabled":s?"":void 0,"data-placeholder":LB(S.value)?"":void 0,...d,ref:N,onClick:Ht(d.onClick,Q=>{Q.currentTarget.focus(),O.current!=="mouse"&&re(Q)}),onPointerDown:Ht(d.onPointerDown,Q=>{O.current=Q.pointerType;const ce=Q.target;ce.hasPointerCapture(Q.pointerId)&&ce.releasePointerCapture(Q.pointerId),Q.button===0&&Q.ctrlKey===!1&&Q.pointerType==="mouse"&&(re(Q),Q.preventDefault())}),onKeyDown:Ht(d.onKeyDown,Q=>{const ce=$.current!=="";!(Q.ctrlKey||Q.altKey||Q.metaKey)&&Q.key.length===1&&q(Q.key),!(ce&&Q.key===" ")&&pre.includes(Q.key)&&(re(),Q.preventDefault())})})})});pB.displayName=fB;var mB="SelectValue",gB=H.forwardRef((e,t)=>{const{__scopeSelect:i,className:a,style:d,children:y,placeholder:S="",...s}=e,N=vh(mB,i),{onValueNodeHasChildrenChange:D}=N,O=y!==void 0,$=dn(t,N.onValueNodeChange);return ss(()=>{D(O)},[D,O]),f.jsx(wr.span,{...s,ref:$,style:{pointerEvents:"none"},children:LB(N.value)?f.jsx(f.Fragment,{children:S}):y})});gB.displayName=mB;var vre="SelectIcon",_B=H.forwardRef((e,t)=>{const{__scopeSelect:i,children:a,...d}=e;return f.jsx(wr.span,{"aria-hidden":!0,...d,ref:t,children:a||"▼"})});_B.displayName=vre;var bre="SelectPortal",yB=e=>f.jsx(Lg,{asChild:!0,...e});yB.displayName=bre;var $f="SelectContent",xB=H.forwardRef((e,t)=>{const i=vh($f,e.__scopeSelect),[a,d]=H.useState();if(ss(()=>{d(new DocumentFragment)},[]),!i.open){const y=a;return y?Xf.createPortal(f.jsx(vB,{scope:e.__scopeSelect,children:f.jsx(V2.Slot,{scope:e.__scopeSelect,children:f.jsx("div",{children:e.children})})}),y):null}return f.jsx(bB,{...e,ref:t})});xB.displayName=$f;var Sl=10,[vB,bh]=Hg($f),wre="SelectContentImpl",bB=H.forwardRef((e,t)=>{const{__scopeSelect:i,position:a="item-aligned",onCloseAutoFocus:d,onEscapeKeyDown:y,onPointerDownOutside:S,side:s,sideOffset:N,align:D,alignOffset:O,arrowPadding:$,collisionBoundary:q,collisionPadding:J,sticky:re,hideWhenDetached:Q,avoidCollisions:ce,...le}=e,ae=vh($f,i),[he,Se]=H.useState(null),[je,it]=H.useState(null),qe=dn(t,qt=>Se(qt)),[ct,pt]=H.useState(null),[Ze,yt]=H.useState(null),Mt=U2(i),[Jt,jt]=H.useState(!1),Pt=H.useRef(!1);H.useEffect(()=>{if(he)return A2(he)},[he]),C2();const Wt=H.useCallback(qt=>{const[Br,...xn]=Mt().map(pn=>pn.ref.current),[de]=xn.slice(-1),bn=document.activeElement;for(const pn of qt)if(pn===bn||(pn==null||pn.scrollIntoView({block:"nearest"}),pn===Br&&je&&(je.scrollTop=0),pn===de&&je&&(je.scrollTop=je.scrollHeight),pn==null||pn.focus(),document.activeElement!==bn))return},[Mt,je]),Nt=H.useCallback(()=>Wt([ct,he]),[Wt,ct,he]);H.useEffect(()=>{Jt&&Nt()},[Jt,Nt]);const{onOpenChange:Xe,triggerPointerDownPosRef:nt}=ae;H.useEffect(()=>{if(he){let qt={x:0,y:0};const Br=de=>{var bn,pn;qt={x:Math.abs(Math.round(de.pageX)-(((bn=nt.current)==null?void 0:bn.x)??0)),y:Math.abs(Math.round(de.pageY)-(((pn=nt.current)==null?void 0:pn.y)??0))}},xn=de=>{qt.x<=10&&qt.y<=10?de.preventDefault():he.contains(de.target)||Xe(!1),document.removeEventListener("pointermove",Br),nt.current=null};return nt.current!==null&&(document.addEventListener("pointermove",Br),document.addEventListener("pointerup",xn,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",Br),document.removeEventListener("pointerup",xn,{capture:!0})}}},[he,Xe,nt]),H.useEffect(()=>{const qt=()=>Xe(!1);return window.addEventListener("blur",qt),window.addEventListener("resize",qt),()=>{window.removeEventListener("blur",qt),window.removeEventListener("resize",qt)}},[Xe]);const[Qt,rr]=zB(qt=>{const Br=Mt().filter(bn=>!bn.disabled),xn=Br.find(bn=>bn.ref.current===document.activeElement),de=FB(Br,qt,xn);de&&setTimeout(()=>de.ref.current.focus())}),mr=H.useCallback((qt,Br,xn)=>{const de=!Pt.current&&!xn;(ae.value!==void 0&&ae.value===Br||de)&&(pt(qt),de&&(Pt.current=!0))},[ae.value]),Ut=H.useCallback(()=>he==null?void 0:he.focus(),[he]),hn=H.useCallback((qt,Br,xn)=>{const de=!Pt.current&&!xn;(ae.value!==void 0&&ae.value===Br||de)&&yt(qt)},[ae.value]),Gn=a==="popper"?jM:wB,At=Gn===jM?{side:s,sideOffset:N,align:D,alignOffset:O,arrowPadding:$,collisionBoundary:q,collisionPadding:J,sticky:re,hideWhenDetached:Q,avoidCollisions:ce}:{};return f.jsx(vB,{scope:i,content:he,viewport:je,onViewportChange:it,itemRefCallback:mr,selectedItem:ct,onItemLeave:Ut,itemTextRefCallback:hn,focusSelectedItem:Nt,selectedItemText:Ze,position:a,isPositioned:Jt,searchRef:Qt,children:f.jsx(Gv,{as:Tc,allowPinchZoom:!0,children:f.jsx($v,{asChild:!0,trapped:ae.open,onMountAutoFocus:qt=>{qt.preventDefault()},onUnmountAutoFocus:Ht(d,qt=>{var Br;(Br=ae.trigger)==null||Br.focus({preventScroll:!0}),qt.preventDefault()}),children:f.jsx(mh,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:y,onPointerDownOutside:S,onFocusOutside:qt=>qt.preventDefault(),onDismiss:()=>ae.onOpenChange(!1),children:f.jsx(Gn,{role:"listbox",id:ae.contentId,"data-state":ae.open?"open":"closed",dir:ae.dir,onContextMenu:qt=>qt.preventDefault(),...le,...At,onPlaced:()=>jt(!0),ref:qe,style:{display:"flex",flexDirection:"column",outline:"none",...le.style},onKeyDown:Ht(le.onKeyDown,qt=>{const Br=qt.ctrlKey||qt.altKey||qt.metaKey;if(qt.key==="Tab"&&qt.preventDefault(),!Br&&qt.key.length===1&&rr(qt.key),["ArrowUp","ArrowDown","Home","End"].includes(qt.key)){let de=Mt().filter(bn=>!bn.disabled).map(bn=>bn.ref.current);if(["ArrowUp","End"].includes(qt.key)&&(de=de.slice().reverse()),["ArrowUp","ArrowDown"].includes(qt.key)){const bn=qt.target,pn=de.indexOf(bn);de=de.slice(pn+1)}setTimeout(()=>Wt(de)),qt.preventDefault()}})})})})})})});bB.displayName=wre;var Sre="SelectItemAlignedPosition",wB=H.forwardRef((e,t)=>{const{__scopeSelect:i,onPlaced:a,...d}=e,y=vh($f,i),S=bh($f,i),[s,N]=H.useState(null),[D,O]=H.useState(null),$=dn(t,qe=>O(qe)),q=U2(i),J=H.useRef(!1),re=H.useRef(!0),{viewport:Q,selectedItem:ce,selectedItemText:le,focusSelectedItem:ae}=S,he=H.useCallback(()=>{if(y.trigger&&y.valueNode&&s&&D&&Q&&ce&&le){const qe=y.trigger.getBoundingClientRect(),ct=D.getBoundingClientRect(),pt=y.valueNode.getBoundingClientRect(),Ze=le.getBoundingClientRect();if(y.dir!=="rtl"){const bn=Ze.left-ct.left,pn=pt.left-bn,hi=qe.left-pn,bt=qe.width+hi,Vi=Math.max(bt,ct.width),ni=window.innerWidth-Sl,os=RM(pn,[Sl,Math.max(Sl,ni-Vi)]);s.style.minWidth=bt+"px",s.style.left=os+"px"}else{const bn=ct.right-Ze.right,pn=window.innerWidth-pt.right-bn,hi=window.innerWidth-qe.right-pn,bt=qe.width+hi,Vi=Math.max(bt,ct.width),ni=window.innerWidth-Sl,os=RM(pn,[Sl,Math.max(Sl,ni-Vi)]);s.style.minWidth=bt+"px",s.style.right=os+"px"}const yt=q(),Mt=window.innerHeight-Sl*2,Jt=Q.scrollHeight,jt=window.getComputedStyle(D),Pt=parseInt(jt.borderTopWidth,10),Wt=parseInt(jt.paddingTop,10),Nt=parseInt(jt.borderBottomWidth,10),Xe=parseInt(jt.paddingBottom,10),nt=Pt+Wt+Jt+Xe+Nt,Qt=Math.min(ce.offsetHeight*5,nt),rr=window.getComputedStyle(Q),mr=parseInt(rr.paddingTop,10),Ut=parseInt(rr.paddingBottom,10),hn=qe.top+qe.height/2-Sl,Gn=Mt-hn,At=ce.offsetHeight/2,qt=ce.offsetTop+At,Br=Pt+Wt+qt,xn=nt-Br;if(Br<=hn){const bn=yt.length>0&&ce===yt[yt.length-1].ref.current;s.style.bottom="0px";const pn=D.clientHeight-Q.offsetTop-Q.offsetHeight,hi=Math.max(Gn,At+(bn?Ut:0)+pn+Nt),bt=Br+hi;s.style.height=bt+"px"}else{const bn=yt.length>0&&ce===yt[0].ref.current;s.style.top="0px";const hi=Math.max(hn,Pt+Q.offsetTop+(bn?mr:0)+At)+xn;s.style.height=hi+"px",Q.scrollTop=Br-hn+Q.offsetTop}s.style.margin=`${Sl}px 0`,s.style.minHeight=Qt+"px",s.style.maxHeight=Mt+"px",a==null||a(),requestAnimationFrame(()=>J.current=!0)}},[q,y.trigger,y.valueNode,s,D,Q,ce,le,y.dir,a]);ss(()=>he(),[he]);const[Se,je]=H.useState();ss(()=>{D&&je(window.getComputedStyle(D).zIndex)},[D]);const it=H.useCallback(qe=>{qe&&re.current===!0&&(he(),ae==null||ae(),re.current=!1)},[he,ae]);return f.jsx(Ere,{scope:i,contentWrapper:s,shouldExpandOnScrollRef:J,onScrollButtonChange:it,children:f.jsx("div",{ref:N,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:Se},children:f.jsx(wr.div,{...d,ref:$,style:{boxSizing:"border-box",maxHeight:"100%",...d.style}})})})});wB.displayName=Sre;var Tre="SelectPopperPosition",jM=H.forwardRef((e,t)=>{const{__scopeSelect:i,align:a="start",collisionPadding:d=Sl,...y}=e,S=$2(i);return f.jsx(y2,{...S,...y,ref:t,align:a,collisionPadding:d,style:{boxSizing:"border-box",...y.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});jM.displayName=Tre;var[Ere,zP]=Hg($f,{}),DM="SelectViewport",SB=H.forwardRef((e,t)=>{const{__scopeSelect:i,nonce:a,...d}=e,y=bh(DM,i),S=zP(DM,i),s=dn(t,y.onViewportChange),N=H.useRef(0);return f.jsxs(f.Fragment,{children:[f.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:a}),f.jsx(V2.Slot,{scope:i,children:f.jsx(wr.div,{"data-radix-select-viewport":"",role:"presentation",...d,ref:s,style:{position:"relative",flex:1,overflow:"hidden auto",...d.style},onScroll:Ht(d.onScroll,D=>{const O=D.currentTarget,{contentWrapper:$,shouldExpandOnScrollRef:q}=S;if(q!=null&&q.current&&$){const J=Math.abs(N.current-O.scrollTop);if(J>0){const re=window.innerHeight-Sl*2,Q=parseFloat($.style.minHeight),ce=parseFloat($.style.height),le=Math.max(Q,ce);if(le<re){const ae=le+J,he=Math.min(re,ae),Se=ae-he;$.style.height=he+"px",$.style.bottom==="0px"&&(O.scrollTop=Se>0?Se:0,$.style.justifyContent="flex-end")}}}N.current=O.scrollTop})})})]})});SB.displayName=DM;var TB="SelectGroup",[Cre,Mre]=Hg(TB),Are=H.forwardRef((e,t)=>{const{__scopeSelect:i,...a}=e,d=ba();return f.jsx(Cre,{scope:i,id:d,children:f.jsx(wr.div,{role:"group","aria-labelledby":d,...a,ref:t})})});Are.displayName=TB;var EB="SelectLabel",CB=H.forwardRef((e,t)=>{const{__scopeSelect:i,...a}=e,d=Mre(EB,i);return f.jsx(wr.div,{id:d.id,...a,ref:t})});CB.displayName=EB;var Nw="SelectItem",[Pre,MB]=Hg(Nw),AB=H.forwardRef((e,t)=>{const{__scopeSelect:i,value:a,disabled:d=!1,textValue:y,...S}=e,s=vh(Nw,i),N=bh(Nw,i),D=s.value===a,[O,$]=H.useState(y??""),[q,J]=H.useState(!1),re=dn(t,ae=>{var he;return(he=N.itemRefCallback)==null?void 0:he.call(N,ae,a,d)}),Q=ba(),ce=H.useRef("touch"),le=()=>{d||(s.onValueChange(a),s.onOpenChange(!1))};if(a==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return f.jsx(Pre,{scope:i,value:a,disabled:d,textId:Q,isSelected:D,onItemTextChange:H.useCallback(ae=>{$(he=>he||((ae==null?void 0:ae.textContent)??"").trim())},[]),children:f.jsx(V2.ItemSlot,{scope:i,value:a,disabled:d,textValue:O,children:f.jsx(wr.div,{role:"option","aria-labelledby":Q,"data-highlighted":q?"":void 0,"aria-selected":D&&q,"data-state":D?"checked":"unchecked","aria-disabled":d||void 0,"data-disabled":d?"":void 0,tabIndex:d?void 0:-1,...S,ref:re,onFocus:Ht(S.onFocus,()=>J(!0)),onBlur:Ht(S.onBlur,()=>J(!1)),onClick:Ht(S.onClick,()=>{ce.current!=="mouse"&&le()}),onPointerUp:Ht(S.onPointerUp,()=>{ce.current==="mouse"&&le()}),onPointerDown:Ht(S.onPointerDown,ae=>{ce.current=ae.pointerType}),onPointerMove:Ht(S.onPointerMove,ae=>{var he;ce.current=ae.pointerType,d?(he=N.onItemLeave)==null||he.call(N):ce.current==="mouse"&&ae.currentTarget.focus({preventScroll:!0})}),onPointerLeave:Ht(S.onPointerLeave,ae=>{var he;ae.currentTarget===document.activeElement&&((he=N.onItemLeave)==null||he.call(N))}),onKeyDown:Ht(S.onKeyDown,ae=>{var Se;((Se=N.searchRef)==null?void 0:Se.current)!==""&&ae.key===" "||(mre.includes(ae.key)&&le(),ae.key===" "&&ae.preventDefault())})})})})});AB.displayName=Nw;var fx="SelectItemText",PB=H.forwardRef((e,t)=>{const{__scopeSelect:i,className:a,style:d,...y}=e,S=vh(fx,i),s=bh(fx,i),N=MB(fx,i),D=xre(fx,i),[O,$]=H.useState(null),q=dn(t,le=>$(le),N.onItemTextChange,le=>{var ae;return(ae=s.itemTextRefCallback)==null?void 0:ae.call(s,le,N.value,N.disabled)}),J=O==null?void 0:O.textContent,re=H.useMemo(()=>f.jsx("option",{value:N.value,disabled:N.disabled,children:J},N.value),[N.disabled,N.value,J]),{onNativeOptionAdd:Q,onNativeOptionRemove:ce}=D;return ss(()=>(Q(re),()=>ce(re)),[Q,ce,re]),f.jsxs(f.Fragment,{children:[f.jsx(wr.span,{id:N.textId,...y,ref:q}),N.isSelected&&S.valueNode&&!S.valueNodeHasChildren?Xf.createPortal(y.children,S.valueNode):null]})});PB.displayName=fx;var IB="SelectItemIndicator",kB=H.forwardRef((e,t)=>{const{__scopeSelect:i,...a}=e;return MB(IB,i).isSelected?f.jsx(wr.span,{"aria-hidden":!0,...a,ref:t}):null});kB.displayName=IB;var LM="SelectScrollUpButton",NB=H.forwardRef((e,t)=>{const i=bh(LM,e.__scopeSelect),a=zP(LM,e.__scopeSelect),[d,y]=H.useState(!1),S=dn(t,a.onScrollButtonChange);return ss(()=>{if(i.viewport&&i.isPositioned){let s=function(){const D=N.scrollTop>0;y(D)};const N=i.viewport;return s(),N.addEventListener("scroll",s),()=>N.removeEventListener("scroll",s)}},[i.viewport,i.isPositioned]),d?f.jsx(jB,{...e,ref:S,onAutoScroll:()=>{const{viewport:s,selectedItem:N}=i;s&&N&&(s.scrollTop=s.scrollTop-N.offsetHeight)}}):null});NB.displayName=LM;var OM="SelectScrollDownButton",RB=H.forwardRef((e,t)=>{const i=bh(OM,e.__scopeSelect),a=zP(OM,e.__scopeSelect),[d,y]=H.useState(!1),S=dn(t,a.onScrollButtonChange);return ss(()=>{if(i.viewport&&i.isPositioned){let s=function(){const D=N.scrollHeight-N.clientHeight,O=Math.ceil(N.scrollTop)<D;y(O)};const N=i.viewport;return s(),N.addEventListener("scroll",s),()=>N.removeEventListener("scroll",s)}},[i.viewport,i.isPositioned]),d?f.jsx(jB,{...e,ref:S,onAutoScroll:()=>{const{viewport:s,selectedItem:N}=i;s&&N&&(s.scrollTop=s.scrollTop+N.offsetHeight)}}):null});RB.displayName=OM;var jB=H.forwardRef((e,t)=>{const{__scopeSelect:i,onAutoScroll:a,...d}=e,y=bh("SelectScrollButton",i),S=H.useRef(null),s=U2(i),N=H.useCallback(()=>{S.current!==null&&(window.clearInterval(S.current),S.current=null)},[]);return H.useEffect(()=>()=>N(),[N]),ss(()=>{var O;const D=s().find($=>$.ref.current===document.activeElement);(O=D==null?void 0:D.ref.current)==null||O.scrollIntoView({block:"nearest"})},[s]),f.jsx(wr.div,{"aria-hidden":!0,...d,ref:t,style:{flexShrink:0,...d.style},onPointerDown:Ht(d.onPointerDown,()=>{S.current===null&&(S.current=window.setInterval(a,50))}),onPointerMove:Ht(d.onPointerMove,()=>{var D;(D=y.onItemLeave)==null||D.call(y),S.current===null&&(S.current=window.setInterval(a,50))}),onPointerLeave:Ht(d.onPointerLeave,()=>{N()})})}),Ire="SelectSeparator",DB=H.forwardRef((e,t)=>{const{__scopeSelect:i,...a}=e;return f.jsx(wr.div,{"aria-hidden":!0,...a,ref:t})});DB.displayName=Ire;var zM="SelectArrow",kre=H.forwardRef((e,t)=>{const{__scopeSelect:i,...a}=e,d=$2(i),y=vh(zM,i),S=bh(zM,i);return y.open&&S.position==="popper"?f.jsx(x2,{...d,...a,ref:t}):null});kre.displayName=zM;function LB(e){return e===""||e===void 0}var OB=H.forwardRef((e,t)=>{const{value:i,...a}=e,d=H.useRef(null),y=dn(t,d),S=E2(i);return H.useEffect(()=>{const s=d.current,N=window.HTMLSelectElement.prototype,O=Object.getOwnPropertyDescriptor(N,"value").set;if(S!==i&&O){const $=new Event("change",{bubbles:!0});O.call(s,i),s.dispatchEvent($)}},[S,i]),f.jsx(Fv,{asChild:!0,children:f.jsx("select",{...a,ref:y,defaultValue:i})})});OB.displayName="BubbleSelect";function zB(e){const t=oi(e),i=H.useRef(""),a=H.useRef(0),d=H.useCallback(S=>{const s=i.current+S;t(s),function N(D){i.current=D,window.clearTimeout(a.current),D!==""&&(a.current=window.setTimeout(()=>N(""),1e3))}(s)},[t]),y=H.useCallback(()=>{i.current="",window.clearTimeout(a.current)},[]);return H.useEffect(()=>()=>window.clearTimeout(a.current),[]),[i,d,y]}function FB(e,t,i){const d=t.length>1&&Array.from(t).every(D=>D===t[0])?t[0]:t,y=i?e.indexOf(i):-1;let S=Nre(e,Math.max(y,0));d.length===1&&(S=S.filter(D=>D!==i));const N=S.find(D=>D.textValue.toLowerCase().startsWith(d.toLowerCase()));return N!==i?N:void 0}function Nre(e,t){return e.map((i,a)=>e[(t+a)%e.length])}var Rre=hB,BB=pB,jre=gB,Dre=_B,Lre=yB,VB=xB,Ore=SB,UB=CB,$B=AB,zre=PB,Fre=kB,GB=NB,qB=RB,HB=DB;const Jd=Rre,Qd=jre,ou=H.forwardRef(({className:e,children:t,...i},a)=>f.jsxs(BB,{ref:a,className:br("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...i,children:[t,f.jsx(Dre,{asChild:!0,children:f.jsx(ZA,{className:"h-4 w-4 opacity-50"})})]}));ou.displayName=BB.displayName;const WB=H.forwardRef(({className:e,...t},i)=>f.jsx(GB,{ref:i,className:br("flex cursor-default items-center justify-center py-1",e),...t,children:f.jsx(hW,{className:"h-4 w-4"})}));WB.displayName=GB.displayName;const ZB=H.forwardRef(({className:e,...t},i)=>f.jsx(qB,{ref:i,className:br("flex cursor-default items-center justify-center py-1",e),...t,children:f.jsx(ZA,{className:"h-4 w-4"})}));ZB.displayName=qB.displayName;const au=H.forwardRef(({className:e,children:t,position:i="popper",...a},d)=>f.jsx(Lre,{children:f.jsxs(VB,{ref:d,className:br("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",i==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:i,...a,children:[f.jsx(WB,{}),f.jsx(Ore,{className:br("p-1",i==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),f.jsx(ZB,{})]})}));au.displayName=VB.displayName;const Bre=H.forwardRef(({className:e,...t},i)=>f.jsx(UB,{ref:i,className:br("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...t}));Bre.displayName=UB.displayName;const hs=H.forwardRef(({className:e,children:t,...i},a)=>f.jsxs($B,{ref:a,className:br("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...i,children:[f.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:f.jsx(Fre,{children:f.jsx(Co,{className:"h-4 w-4"})})}),f.jsx(zre,{children:t})]}));hs.displayName=$B.displayName;const Vre=H.forwardRef(({className:e,...t},i)=>f.jsx(HB,{ref:i,className:br("-mx-1 my-1 h-px bg-muted",e),...t}));Vre.displayName=HB.displayName;const Ure=()=>{const[e,t]=H.useState(""),[i,a]=H.useState(""),[d,y]=H.useState(""),[S,s]=H.useState(!1),[N,D]=H.useState(null),O=$l(),$=async re=>{if(re.preventDefault(),!e||!e.includes("@")||!e.includes(".")){y("Please enter a valid email address");return}y(""),s(!0);try{const Q={email:e,university:i||"University of Amsterdam",hasUploadedProof:!!N,timestamp:new Date().toISOString(),isDemoUser:!0};localStorage.setItem("demoUserData",JSON.stringify(Q)),di.success("Account created successfully!",{description:"Let's complete your profile setup"}),setTimeout(()=>{O("/onboarding")},1e3)}catch(Q){console.error("Error in signup process:",Q),y("An unexpected error occurred. Please try again later.")}finally{s(!1)}},q=re=>{re.target.files&&re.target.files.length>0&&D(re.target.files[0])},J=["University of Amsterdam","Sorbonne University","Heidelberg University","Cambridge University","Oxford University","Politecnico di Milano","Technical University of Berlin","Uppsala University","Complutense University of Madrid","IE University Madrid","Erasmus University Rotterdam","Harvard University","Stanford University","MIT","UC Berkeley","New York University","Other"];return f.jsxs("div",{className:"min-h-screen flex flex-col",children:[f.jsx(gi,{}),f.jsx("main",{className:"flex-grow flex items-center justify-center p-4 bg-gray-50",children:f.jsxs("div",{className:"w-full max-w-md",children:[f.jsxs("div",{className:"mb-8 text-center",children:[f.jsx("h1",{className:"text-3xl font-bold text-swap-blue",children:"Join SwapSpot"}),f.jsx("p",{className:"mt-2 text-gray-600",children:"Create your account and list your space"}),f.jsxs("div",{className:"mt-2 flex items-center justify-center gap-2",children:[f.jsx(wn,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-200",children:"Step-by-step Setup"}),f.jsxs(wn,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200 flex items-center gap-1",children:[f.jsx(Ao,{className:"h-3 w-3"}),"Demo Mode"]})]}),f.jsx("p",{className:"mt-4 text-sm text-gray-500 bg-yellow-50 p-2 rounded-md border border-yellow-100",children:"Complete our guided setup to create your swap listing and see matches!"})]}),f.jsxs("form",{onSubmit:$,className:"space-y-6",children:[f.jsxs("div",{className:"space-y-2",children:[f.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email Address"}),f.jsx(Pn,{id:"email",type:"email",placeholder:"yourname@example.com",value:e,onChange:re=>t(re.target.value),className:"w-full",required:!0,disabled:S}),f.jsx("p",{className:"text-xs text-gray-500",children:"Use your university email if possible (e.g., name@erasmus.nl)"})]}),f.jsxs("div",{className:"space-y-2",children:[f.jsx("label",{htmlFor:"university",className:"block text-sm font-medium text-gray-700",children:"Which university are you from? (Optional)"}),f.jsxs(Jd,{value:i,onValueChange:a,children:[f.jsx(ou,{className:"w-full",children:f.jsx(Qd,{placeholder:"Select your university"})}),f.jsx(au,{children:J.map(re=>f.jsx(hs,{value:re,children:re},re))})]})]}),f.jsxs("div",{className:"space-y-2",children:[f.jsx("label",{htmlFor:"proof",className:"block text-sm font-medium text-gray-700",children:"Proof of enrollment (Optional)"}),f.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-md p-4 text-center",children:f.jsxs("label",{className:"cursor-pointer",children:[f.jsx(Pn,{id:"proof",type:"file",accept:"image/*,.pdf",onChange:q,className:"hidden"}),f.jsxs("div",{className:"flex flex-col items-center gap-2",children:[f.jsx(YA,{className:"h-8 w-8 text-gray-400"}),f.jsx("span",{className:"text-sm text-gray-600",children:N?N.name:"Upload student card, university letter, or screenshot"})]})]})}),f.jsx("p",{className:"text-xs text-gray-500",children:'Will mark your account as "Verified Student"'})]}),d&&f.jsx(_u,{variant:"destructive",children:f.jsx(yu,{children:d})}),f.jsx(Kt,{type:"submit",className:"w-full",disabled:S,children:S?f.jsxs(f.Fragment,{children:[f.jsx(Bf,{className:"h-4 w-4 mr-2 animate-spin"}),"Creating Account..."]}):"Create Account & Start Setup"})]}),f.jsxs("p",{className:"mt-8 text-center text-sm text-gray-500",children:["Already have an account? ",f.jsx(un,{to:"/login",className:"text-swap-blue font-semibold hover:underline",children:"Log in"})]})]})}),f.jsx(_i,{})]})},$re=()=>{const[e,t]=H.useState(""),[i,a]=H.useState(""),[d,y]=H.useState(""),[S,s]=H.useState(!1),[N,D]=H.useState(!1),O=$l(),$=yh();H.useEffect(()=>{if(new URLSearchParams($.search).get("fromNav")==="true"){const ce=document.getElementById("email");ce&&ce.focus()}},[$]);const q=async re=>{if(re.preventDefault(),!e||!i){y("Please enter both email and password");return}y(""),s(!0);try{const{data:Q,error:ce}=await Pi.auth.signInWithPassword({email:e,password:i});ce?(console.error("Login error:",ce),y("Invalid email or password. Please try again.")):Q!=null&&Q.user&&(di.success("Login successful",{description:"Welcome back to SwapSpot!"}),O("/browse"))}catch(Q){console.error("Error during login:",Q),y("An unexpected error occurred. Please try again later.")}finally{s(!1)}},J=async()=>{if(!e){y("Please enter your email address");return}y(""),s(!0);try{const{error:re}=await Pi.auth.signInWithOtp({email:e,options:{emailRedirectTo:`${window.location.origin}/browse`}});re?(console.error("Magic link error:",re),y("Failed to send magic link. Please try again.")):D(!0)}catch(re){console.error("Error sending magic link:",re),y("An unexpected error occurred. Please try again later.")}finally{s(!1)}};return N?f.jsxs("div",{className:"min-h-screen flex flex-col",children:[f.jsx(gi,{}),f.jsx("main",{className:"flex-grow flex items-center justify-center p-4 bg-gray-50",children:f.jsx("div",{className:"w-full max-w-md",children:f.jsxs("div",{className:"text-center space-y-6 p-6 border border-blue-100 rounded-lg bg-blue-50",children:[f.jsx("div",{className:"mx-auto w-12 h-12 flex items-center justify-center rounded-full bg-blue-100",children:f.jsx(TW,{className:"h-6 w-6 text-blue-600"})}),f.jsx("h2",{className:"text-xl font-medium text-blue-800",children:"Magic Link Sent!"}),f.jsxs("p",{className:"text-gray-600",children:["We've sent a secure login link to ",f.jsx("span",{className:"font-medium",children:e}),"."]}),f.jsx("p",{className:"text-gray-600",children:"Please check your email inbox and click the link to log in."}),f.jsx(Kt,{variant:"outline",onClick:()=>O("/"),className:"mt-4",children:"Return to Home"})]})})}),f.jsx(_i,{})]}):f.jsxs("div",{className:"min-h-screen flex flex-col",children:[f.jsx(gi,{}),f.jsx("main",{className:"flex-grow flex items-center justify-center p-4 bg-gray-50",children:f.jsxs("div",{className:"w-full max-w-md",children:[f.jsxs("div",{className:"mb-8 text-center",children:[f.jsx("h1",{className:"text-3xl font-bold text-swap-blue",children:"Welcome Back"}),f.jsx("p",{className:"mt-2 text-gray-600",children:"Log in to continue your SwapSpot experience"})]}),f.jsxs("form",{onSubmit:q,className:"space-y-6",children:[f.jsxs("div",{className:"space-y-2",children:[f.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email"}),f.jsx(Pn,{id:"email",type:"email",placeholder:"yourname@example.com",value:e,onChange:re=>t(re.target.value),className:"w-full",required:!0,disabled:S})]}),f.jsxs("div",{className:"space-y-2",children:[f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Password"}),f.jsx(un,{to:"/forgot-password",className:"text-xs text-swap-blue hover:underline",children:"Forgot password?"})]}),f.jsx(Pn,{id:"password",type:"password",value:i,onChange:re=>a(re.target.value),className:"w-full",required:!0,disabled:S})]}),d&&f.jsx(_u,{variant:"destructive",children:f.jsx(yu,{children:d})}),f.jsx(Kt,{type:"submit",className:"w-full",disabled:S,children:S?f.jsxs(f.Fragment,{children:[f.jsx(Bf,{className:"h-4 w-4 mr-2 animate-spin"}),"Logging in..."]}):f.jsxs(f.Fragment,{children:[f.jsx(wW,{className:"h-4 w-4 mr-2"}),"Log In"]})}),f.jsxs("div",{className:"relative",children:[f.jsx("div",{className:"absolute inset-0 flex items-center",children:f.jsx("span",{className:"w-full border-t border-gray-300"})}),f.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:f.jsx("span",{className:"bg-gray-50 px-2 text-gray-500",children:"Or"})})]}),f.jsx(Kt,{type:"button",variant:"outline",onClick:J,className:"w-full",disabled:S,children:S?f.jsxs(f.Fragment,{children:[f.jsx(Bf,{className:"h-4 w-4 mr-2 animate-spin"}),"Sending..."]}):"Login with Magic Link"})]}),f.jsxs("p",{className:"mt-8 text-center text-sm text-gray-500",children:["Don't have an account yet? ",f.jsx(un,{to:"/signup",className:"text-swap-blue font-semibold hover:underline",children:"Sign up"})]})]})}),f.jsx(_i,{})]})},Gre=()=>{const e=yh();return H.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",e.pathname)},[e.pathname]),f.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:f.jsxs("div",{className:"text-center",children:[f.jsx("h1",{className:"text-4xl font-bold mb-4",children:"404"}),f.jsx("p",{className:"text-xl text-gray-600 mb-4",children:"Oops! Page not found"}),f.jsx("a",{href:"/",className:"text-blue-500 hover:text-blue-700 underline",children:"Return to Home"})]})})},qre=()=>{const e=[{number:"1",icon:f.jsx(yw,{className:"h-12 w-12 text-swap-blue"}),title:"Tell us your exchange needs",description:"Share your university exchange program, study abroad dates, destination preferences, and housing requirements. That's it - we handle the rest."},{number:"2",icon:f.jsx(XA,{className:"h-12 w-12 text-swap-blue"}),title:"We do the searching for exchange students",description:"Our intelligent system works 24/7, automatically scanning and analyzing thousands of verified university student profiles to find your perfect exchange matches."},{number:"3",icon:f.jsx(Qo,{className:"h-12 w-12 text-swap-blue"}),title:"We deliver your student matches",description:"Receive curated exchange student match notifications with complete profiles and contact details - no searching, no browsing, just perfect study abroad matches."},{number:"4",icon:f.jsx(pu,{className:"h-12 w-12 text-swap-blue"}),title:"You connect and swap for your exchange",description:"Simply reach out to your pre-screened exchange student matches to finalize details. We've already done all the hard work of finding compatibility for your study abroad experience."}];return f.jsxs("div",{className:"min-h-screen flex flex-col",children:[f.jsx(gi,{}),f.jsxs("main",{className:"flex-grow",children:[f.jsx("section",{className:"bg-gradient-to-b from-white to-swap-lightBlue/30 py-16 md:py-24",children:f.jsxs("div",{className:"max-w-4xl mx-auto px-4 md:px-8 text-center",children:[f.jsxs("div",{className:"flex items-center justify-center gap-2 mb-6",children:[f.jsx(Kf,{className:"h-8 w-8 text-swap-blue"}),f.jsx("span",{className:"text-swap-blue font-semibold text-lg",children:"Built Exclusively for Exchange Students"})]}),f.jsxs("h1",{className:"text-3xl md:text-5xl font-bold text-gray-900 mb-6 leading-tight",children:["We Handle Everything",f.jsx("br",{}),f.jsx("span",{className:"text-swap-blue",children:"So Exchange Students Don't Have To"})]}),f.jsx("p",{className:"text-lg md:text-xl text-gray-600 mb-8 max-w-3xl mx-auto leading-relaxed",children:"Stop wasting time on endless searches. Our AI-powered system works around the clock to find your perfect study abroad housing match automatically."})]})}),f.jsx("section",{className:"py-16 md:py-24 bg-white",children:f.jsxs("div",{className:"max-w-5xl mx-auto px-4 md:px-8",children:[f.jsx("div",{className:"space-y-16 md:space-y-24",children:e.map((t,i)=>f.jsxs("div",{className:`flex flex-col lg:flex-row items-center gap-8 lg:gap-16 ${i%2!==0?"lg:flex-row-reverse":""}`,children:[f.jsx("div",{className:"w-full lg:w-1/2 flex justify-center",children:f.jsxs("div",{className:"relative",children:[f.jsx("div",{className:"bg-gradient-to-br from-swap-lightBlue to-swap-lightBlue/60 rounded-3xl p-12 md:p-16 flex items-center justify-center shadow-lg",children:t.icon}),f.jsx("div",{className:"absolute -top-3 -right-3 bg-swap-blue text-white rounded-full w-12 h-12 flex items-center justify-center text-xl font-bold shadow-lg",children:t.number})]})}),f.jsxs("div",{className:"w-full lg:w-1/2 text-center lg:text-left",children:[f.jsx("h2",{className:"text-2xl md:text-3xl font-bold text-gray-900 mb-4 leading-tight",children:t.title}),f.jsx("p",{className:"text-base md:text-lg text-gray-600 leading-relaxed",children:t.description})]})]},i))}),f.jsx("div",{className:"mt-20 md:mt-32 text-center",children:f.jsxs("div",{className:"bg-gradient-to-r from-swap-lightBlue/50 to-swap-lightBlue/30 rounded-3xl p-8 md:p-12 max-w-4xl mx-auto shadow-lg",children:[f.jsx("h3",{className:"text-2xl md:text-3xl font-bold text-swap-darkBlue mb-6 leading-tight",children:"Zero Effort, Maximum Exchange Results"}),f.jsxs("div",{className:"space-y-6 text-base md:text-lg text-gray-700 leading-relaxed",children:[f.jsx("p",{children:"While you focus on your studies and exchange preparations, our advanced matching system works continuously to find university students who perfectly complement your study abroad needs."}),f.jsx("p",{children:"We analyze compatibility factors, verify student status, and deliver only the highest-quality exchange matches directly to you."}),f.jsx("p",{className:"text-lg md:text-xl font-semibold text-swap-darkBlue",children:"You literally don't have to do anything except provide your exchange preferences once."})]}),f.jsx(Kt,{asChild:!0,size:"lg",className:"mt-8 text-base md:text-lg px-8 py-6 bg-swap-blue hover:bg-swap-darkBlue transition-all duration-300 shadow-lg hover:shadow-xl",children:f.jsxs(un,{to:"/signup",children:["Find My Exchange Housing Match",f.jsx(WA,{className:"h-5 w-5 ml-2"})]})})]})})]})})]}),f.jsx(_i,{})]})};function ti(e){const t=Object.prototype.toString.call(e);return e instanceof Date||typeof e=="object"&&t==="[object Date]"?new e.constructor(+e):typeof e=="number"||t==="[object Number]"||typeof e=="string"||t==="[object String]"?new Date(e):new Date(NaN)}function Ca(e,t){return e instanceof Date?new e.constructor(t):new Date(t)}function So(e,t){const i=ti(e);return isNaN(t)?Ca(e,NaN):(t&&i.setDate(i.getDate()+t),i)}function Bl(e,t){const i=ti(e);if(isNaN(t))return Ca(e,NaN);if(!t)return i;const a=i.getDate(),d=Ca(e,i.getTime());d.setMonth(i.getMonth()+t+1,0);const y=d.getDate();return a>=y?d:(i.setFullYear(d.getFullYear(),d.getMonth(),a),i)}const FP=6048e5,Hre=864e5;let Wre={};function Xv(){return Wre}function Mc(e,t){var s,N,D,O;const i=Xv(),a=(t==null?void 0:t.weekStartsOn)??((N=(s=t==null?void 0:t.locale)==null?void 0:s.options)==null?void 0:N.weekStartsOn)??i.weekStartsOn??((O=(D=i.locale)==null?void 0:D.options)==null?void 0:O.weekStartsOn)??0,d=ti(e),y=d.getDay(),S=(y<a?7:0)+y-a;return d.setDate(d.getDate()-S),d.setHours(0,0,0,0),d}function Gf(e){return Mc(e,{weekStartsOn:1})}function YB(e){const t=ti(e),i=t.getFullYear(),a=Ca(e,0);a.setFullYear(i+1,0,4),a.setHours(0,0,0,0);const d=Gf(a),y=Ca(e,0);y.setFullYear(i,0,4),y.setHours(0,0,0,0);const S=Gf(y);return t.getTime()>=d.getTime()?i+1:t.getTime()>=S.getTime()?i:i-1}function Cg(e){const t=ti(e);return t.setHours(0,0,0,0),t}function Rw(e){const t=ti(e),i=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return i.setUTCFullYear(t.getFullYear()),+e-+i}function yc(e,t){const i=Cg(e),a=Cg(t),d=+i-Rw(i),y=+a-Rw(a);return Math.round((d-y)/Hre)}function Zre(e){const t=YB(e),i=Ca(e,0);return i.setFullYear(t,0,4),i.setHours(0,0,0,0),Gf(i)}function FM(e,t){const i=t*7;return So(e,i)}function Yre(e,t){return Bl(e,t*12)}function Xre(e){let t;return e.forEach(function(i){const a=ti(i);(t===void 0||t<a||isNaN(Number(a)))&&(t=a)}),t||new Date(NaN)}function Kre(e){let t;return e.forEach(i=>{const a=ti(i);(!t||t>a||isNaN(+a))&&(t=a)}),t||new Date(NaN)}function Yo(e,t){const i=Cg(e),a=Cg(t);return+i==+a}function BP(e){return e instanceof Date||typeof e=="object"&&Object.prototype.toString.call(e)==="[object Date]"}function Jre(e){if(!BP(e)&&typeof e!="number")return!1;const t=ti(e);return!isNaN(Number(t))}function hv(e,t){const i=ti(e),a=ti(t),d=i.getFullYear()-a.getFullYear(),y=i.getMonth()-a.getMonth();return d*12+y}function Qre(e,t,i){const a=Mc(e,i),d=Mc(t,i),y=+a-Rw(a),S=+d-Rw(d);return Math.round((y-S)/FP)}function VP(e){const t=ti(e),i=t.getMonth();return t.setFullYear(t.getFullYear(),i+1,0),t.setHours(23,59,59,999),t}function ea(e){const t=ti(e);return t.setDate(1),t.setHours(0,0,0,0),t}function XB(e){const t=ti(e),i=Ca(e,0);return i.setFullYear(t.getFullYear(),0,1),i.setHours(0,0,0,0),i}function UP(e,t){var s,N,D,O;const i=Xv(),a=(t==null?void 0:t.weekStartsOn)??((N=(s=t==null?void 0:t.locale)==null?void 0:s.options)==null?void 0:N.weekStartsOn)??i.weekStartsOn??((O=(D=i.locale)==null?void 0:D.options)==null?void 0:O.weekStartsOn)??0,d=ti(e),y=d.getDay(),S=(y<a?-7:0)+6-(y-a);return d.setDate(d.getDate()+S),d.setHours(23,59,59,999),d}function KB(e){return UP(e,{weekStartsOn:1})}const ene={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},tne=(e,t,i)=>{let a;const d=ene[e];return typeof d=="string"?a=d:t===1?a=d.one:a=d.other.replace("{{count}}",t.toString()),i!=null&&i.addSuffix?i.comparison&&i.comparison>0?"in "+a:a+" ago":a};function XE(e){return(t={})=>{const i=t.width?String(t.width):e.defaultWidth;return e.formats[i]||e.formats[e.defaultWidth]}}const rne={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},nne={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},ine={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},sne={date:XE({formats:rne,defaultWidth:"full"}),time:XE({formats:nne,defaultWidth:"full"}),dateTime:XE({formats:ine,defaultWidth:"full"})},one={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},ane=(e,t,i,a)=>one[e];function tx(e){return(t,i)=>{const a=i!=null&&i.context?String(i.context):"standalone";let d;if(a==="formatting"&&e.formattingValues){const S=e.defaultFormattingWidth||e.defaultWidth,s=i!=null&&i.width?String(i.width):S;d=e.formattingValues[s]||e.formattingValues[S]}else{const S=e.defaultWidth,s=i!=null&&i.width?String(i.width):e.defaultWidth;d=e.values[s]||e.values[S]}const y=e.argumentCallback?e.argumentCallback(t):t;return d[y]}}const lne={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},cne={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},une={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},dne={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},hne={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},fne={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},pne=(e,t)=>{const i=Number(e),a=i%100;if(a>20||a<10)switch(a%10){case 1:return i+"st";case 2:return i+"nd";case 3:return i+"rd"}return i+"th"},mne={ordinalNumber:pne,era:tx({values:lne,defaultWidth:"wide"}),quarter:tx({values:cne,defaultWidth:"wide",argumentCallback:e=>e-1}),month:tx({values:une,defaultWidth:"wide"}),day:tx({values:dne,defaultWidth:"wide"}),dayPeriod:tx({values:hne,defaultWidth:"wide",formattingValues:fne,defaultFormattingWidth:"wide"})};function rx(e){return(t,i={})=>{const a=i.width,d=a&&e.matchPatterns[a]||e.matchPatterns[e.defaultMatchWidth],y=t.match(d);if(!y)return null;const S=y[0],s=a&&e.parsePatterns[a]||e.parsePatterns[e.defaultParseWidth],N=Array.isArray(s)?_ne(s,$=>$.test(S)):gne(s,$=>$.test(S));let D;D=e.valueCallback?e.valueCallback(N):N,D=i.valueCallback?i.valueCallback(D):D;const O=t.slice(S.length);return{value:D,rest:O}}}function gne(e,t){for(const i in e)if(Object.prototype.hasOwnProperty.call(e,i)&&t(e[i]))return i}function _ne(e,t){for(let i=0;i<e.length;i++)if(t(e[i]))return i}function yne(e){return(t,i={})=>{const a=t.match(e.matchPattern);if(!a)return null;const d=a[0],y=t.match(e.parsePattern);if(!y)return null;let S=e.valueCallback?e.valueCallback(y[0]):y[0];S=i.valueCallback?i.valueCallback(S):S;const s=t.slice(d.length);return{value:S,rest:s}}}const xne=/^(\d+)(th|st|nd|rd)?/i,vne=/\d+/i,bne={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},wne={any:[/^b/i,/^(a|c)/i]},Sne={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Tne={any:[/1/i,/2/i,/3/i,/4/i]},Ene={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Cne={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Mne={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Ane={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Pne={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Ine={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},kne={ordinalNumber:yne({matchPattern:xne,parsePattern:vne,valueCallback:e=>parseInt(e,10)}),era:rx({matchPatterns:bne,defaultMatchWidth:"wide",parsePatterns:wne,defaultParseWidth:"any"}),quarter:rx({matchPatterns:Sne,defaultMatchWidth:"wide",parsePatterns:Tne,defaultParseWidth:"any",valueCallback:e=>e+1}),month:rx({matchPatterns:Ene,defaultMatchWidth:"wide",parsePatterns:Cne,defaultParseWidth:"any"}),day:rx({matchPatterns:Mne,defaultMatchWidth:"wide",parsePatterns:Ane,defaultParseWidth:"any"}),dayPeriod:rx({matchPatterns:Pne,defaultMatchWidth:"any",parsePatterns:Ine,defaultParseWidth:"any"})},JB={code:"en-US",formatDistance:tne,formatLong:sne,formatRelative:ane,localize:mne,match:kne,options:{weekStartsOn:0,firstWeekContainsDate:1}};function Nne(e){const t=ti(e);return yc(t,XB(t))+1}function QB(e){const t=ti(e),i=+Gf(t)-+Zre(t);return Math.round(i/FP)+1}function e6(e,t){var O,$,q,J;const i=ti(e),a=i.getFullYear(),d=Xv(),y=(t==null?void 0:t.firstWeekContainsDate)??(($=(O=t==null?void 0:t.locale)==null?void 0:O.options)==null?void 0:$.firstWeekContainsDate)??d.firstWeekContainsDate??((J=(q=d.locale)==null?void 0:q.options)==null?void 0:J.firstWeekContainsDate)??1,S=Ca(e,0);S.setFullYear(a+1,0,y),S.setHours(0,0,0,0);const s=Mc(S,t),N=Ca(e,0);N.setFullYear(a,0,y),N.setHours(0,0,0,0);const D=Mc(N,t);return i.getTime()>=s.getTime()?a+1:i.getTime()>=D.getTime()?a:a-1}function Rne(e,t){var s,N,D,O;const i=Xv(),a=(t==null?void 0:t.firstWeekContainsDate)??((N=(s=t==null?void 0:t.locale)==null?void 0:s.options)==null?void 0:N.firstWeekContainsDate)??i.firstWeekContainsDate??((O=(D=i.locale)==null?void 0:D.options)==null?void 0:O.firstWeekContainsDate)??1,d=e6(e,t),y=Ca(e,0);return y.setFullYear(d,0,a),y.setHours(0,0,0,0),Mc(y,t)}function t6(e,t){const i=ti(e),a=+Mc(i,t)-+Rne(i,t);return Math.round(a/FP)+1}function mi(e,t){const i=e<0?"-":"",a=Math.abs(e).toString().padStart(t,"0");return i+a}const bd={y(e,t){const i=e.getFullYear(),a=i>0?i:1-i;return mi(t==="yy"?a%100:a,t.length)},M(e,t){const i=e.getMonth();return t==="M"?String(i+1):mi(i+1,2)},d(e,t){return mi(e.getDate(),t.length)},a(e,t){const i=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return i.toUpperCase();case"aaa":return i;case"aaaaa":return i[0];case"aaaa":default:return i==="am"?"a.m.":"p.m."}},h(e,t){return mi(e.getHours()%12||12,t.length)},H(e,t){return mi(e.getHours(),t.length)},m(e,t){return mi(e.getMinutes(),t.length)},s(e,t){return mi(e.getSeconds(),t.length)},S(e,t){const i=t.length,a=e.getMilliseconds(),d=Math.trunc(a*Math.pow(10,i-3));return mi(d,t.length)}},Cm={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},ED={G:function(e,t,i){const a=e.getFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return i.era(a,{width:"abbreviated"});case"GGGGG":return i.era(a,{width:"narrow"});case"GGGG":default:return i.era(a,{width:"wide"})}},y:function(e,t,i){if(t==="yo"){const a=e.getFullYear(),d=a>0?a:1-a;return i.ordinalNumber(d,{unit:"year"})}return bd.y(e,t)},Y:function(e,t,i,a){const d=e6(e,a),y=d>0?d:1-d;if(t==="YY"){const S=y%100;return mi(S,2)}return t==="Yo"?i.ordinalNumber(y,{unit:"year"}):mi(y,t.length)},R:function(e,t){const i=YB(e);return mi(i,t.length)},u:function(e,t){const i=e.getFullYear();return mi(i,t.length)},Q:function(e,t,i){const a=Math.ceil((e.getMonth()+1)/3);switch(t){case"Q":return String(a);case"QQ":return mi(a,2);case"Qo":return i.ordinalNumber(a,{unit:"quarter"});case"QQQ":return i.quarter(a,{width:"abbreviated",context:"formatting"});case"QQQQQ":return i.quarter(a,{width:"narrow",context:"formatting"});case"QQQQ":default:return i.quarter(a,{width:"wide",context:"formatting"})}},q:function(e,t,i){const a=Math.ceil((e.getMonth()+1)/3);switch(t){case"q":return String(a);case"qq":return mi(a,2);case"qo":return i.ordinalNumber(a,{unit:"quarter"});case"qqq":return i.quarter(a,{width:"abbreviated",context:"standalone"});case"qqqqq":return i.quarter(a,{width:"narrow",context:"standalone"});case"qqqq":default:return i.quarter(a,{width:"wide",context:"standalone"})}},M:function(e,t,i){const a=e.getMonth();switch(t){case"M":case"MM":return bd.M(e,t);case"Mo":return i.ordinalNumber(a+1,{unit:"month"});case"MMM":return i.month(a,{width:"abbreviated",context:"formatting"});case"MMMMM":return i.month(a,{width:"narrow",context:"formatting"});case"MMMM":default:return i.month(a,{width:"wide",context:"formatting"})}},L:function(e,t,i){const a=e.getMonth();switch(t){case"L":return String(a+1);case"LL":return mi(a+1,2);case"Lo":return i.ordinalNumber(a+1,{unit:"month"});case"LLL":return i.month(a,{width:"abbreviated",context:"standalone"});case"LLLLL":return i.month(a,{width:"narrow",context:"standalone"});case"LLLL":default:return i.month(a,{width:"wide",context:"standalone"})}},w:function(e,t,i,a){const d=t6(e,a);return t==="wo"?i.ordinalNumber(d,{unit:"week"}):mi(d,t.length)},I:function(e,t,i){const a=QB(e);return t==="Io"?i.ordinalNumber(a,{unit:"week"}):mi(a,t.length)},d:function(e,t,i){return t==="do"?i.ordinalNumber(e.getDate(),{unit:"date"}):bd.d(e,t)},D:function(e,t,i){const a=Nne(e);return t==="Do"?i.ordinalNumber(a,{unit:"dayOfYear"}):mi(a,t.length)},E:function(e,t,i){const a=e.getDay();switch(t){case"E":case"EE":case"EEE":return i.day(a,{width:"abbreviated",context:"formatting"});case"EEEEE":return i.day(a,{width:"narrow",context:"formatting"});case"EEEEEE":return i.day(a,{width:"short",context:"formatting"});case"EEEE":default:return i.day(a,{width:"wide",context:"formatting"})}},e:function(e,t,i,a){const d=e.getDay(),y=(d-a.weekStartsOn+8)%7||7;switch(t){case"e":return String(y);case"ee":return mi(y,2);case"eo":return i.ordinalNumber(y,{unit:"day"});case"eee":return i.day(d,{width:"abbreviated",context:"formatting"});case"eeeee":return i.day(d,{width:"narrow",context:"formatting"});case"eeeeee":return i.day(d,{width:"short",context:"formatting"});case"eeee":default:return i.day(d,{width:"wide",context:"formatting"})}},c:function(e,t,i,a){const d=e.getDay(),y=(d-a.weekStartsOn+8)%7||7;switch(t){case"c":return String(y);case"cc":return mi(y,t.length);case"co":return i.ordinalNumber(y,{unit:"day"});case"ccc":return i.day(d,{width:"abbreviated",context:"standalone"});case"ccccc":return i.day(d,{width:"narrow",context:"standalone"});case"cccccc":return i.day(d,{width:"short",context:"standalone"});case"cccc":default:return i.day(d,{width:"wide",context:"standalone"})}},i:function(e,t,i){const a=e.getDay(),d=a===0?7:a;switch(t){case"i":return String(d);case"ii":return mi(d,t.length);case"io":return i.ordinalNumber(d,{unit:"day"});case"iii":return i.day(a,{width:"abbreviated",context:"formatting"});case"iiiii":return i.day(a,{width:"narrow",context:"formatting"});case"iiiiii":return i.day(a,{width:"short",context:"formatting"});case"iiii":default:return i.day(a,{width:"wide",context:"formatting"})}},a:function(e,t,i){const d=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return i.dayPeriod(d,{width:"abbreviated",context:"formatting"});case"aaa":return i.dayPeriod(d,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return i.dayPeriod(d,{width:"narrow",context:"formatting"});case"aaaa":default:return i.dayPeriod(d,{width:"wide",context:"formatting"})}},b:function(e,t,i){const a=e.getHours();let d;switch(a===12?d=Cm.noon:a===0?d=Cm.midnight:d=a/12>=1?"pm":"am",t){case"b":case"bb":return i.dayPeriod(d,{width:"abbreviated",context:"formatting"});case"bbb":return i.dayPeriod(d,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return i.dayPeriod(d,{width:"narrow",context:"formatting"});case"bbbb":default:return i.dayPeriod(d,{width:"wide",context:"formatting"})}},B:function(e,t,i){const a=e.getHours();let d;switch(a>=17?d=Cm.evening:a>=12?d=Cm.afternoon:a>=4?d=Cm.morning:d=Cm.night,t){case"B":case"BB":case"BBB":return i.dayPeriod(d,{width:"abbreviated",context:"formatting"});case"BBBBB":return i.dayPeriod(d,{width:"narrow",context:"formatting"});case"BBBB":default:return i.dayPeriod(d,{width:"wide",context:"formatting"})}},h:function(e,t,i){if(t==="ho"){let a=e.getHours()%12;return a===0&&(a=12),i.ordinalNumber(a,{unit:"hour"})}return bd.h(e,t)},H:function(e,t,i){return t==="Ho"?i.ordinalNumber(e.getHours(),{unit:"hour"}):bd.H(e,t)},K:function(e,t,i){const a=e.getHours()%12;return t==="Ko"?i.ordinalNumber(a,{unit:"hour"}):mi(a,t.length)},k:function(e,t,i){let a=e.getHours();return a===0&&(a=24),t==="ko"?i.ordinalNumber(a,{unit:"hour"}):mi(a,t.length)},m:function(e,t,i){return t==="mo"?i.ordinalNumber(e.getMinutes(),{unit:"minute"}):bd.m(e,t)},s:function(e,t,i){return t==="so"?i.ordinalNumber(e.getSeconds(),{unit:"second"}):bd.s(e,t)},S:function(e,t){return bd.S(e,t)},X:function(e,t,i){const a=e.getTimezoneOffset();if(a===0)return"Z";switch(t){case"X":return MD(a);case"XXXX":case"XX":return bf(a);case"XXXXX":case"XXX":default:return bf(a,":")}},x:function(e,t,i){const a=e.getTimezoneOffset();switch(t){case"x":return MD(a);case"xxxx":case"xx":return bf(a);case"xxxxx":case"xxx":default:return bf(a,":")}},O:function(e,t,i){const a=e.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+CD(a,":");case"OOOO":default:return"GMT"+bf(a,":")}},z:function(e,t,i){const a=e.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+CD(a,":");case"zzzz":default:return"GMT"+bf(a,":")}},t:function(e,t,i){const a=Math.trunc(e.getTime()/1e3);return mi(a,t.length)},T:function(e,t,i){const a=e.getTime();return mi(a,t.length)}};function CD(e,t=""){const i=e>0?"-":"+",a=Math.abs(e),d=Math.trunc(a/60),y=a%60;return y===0?i+String(d):i+String(d)+t+mi(y,2)}function MD(e,t){return e%60===0?(e>0?"-":"+")+mi(Math.abs(e)/60,2):bf(e,t)}function bf(e,t=""){const i=e>0?"-":"+",a=Math.abs(e),d=mi(Math.trunc(a/60),2),y=mi(a%60,2);return i+d+t+y}const AD=(e,t)=>{switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}},r6=(e,t)=>{switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}},jne=(e,t)=>{const i=e.match(/(P+)(p+)?/)||[],a=i[1],d=i[2];if(!d)return AD(e,t);let y;switch(a){case"P":y=t.dateTime({width:"short"});break;case"PP":y=t.dateTime({width:"medium"});break;case"PPP":y=t.dateTime({width:"long"});break;case"PPPP":default:y=t.dateTime({width:"full"});break}return y.replace("{{date}}",AD(a,t)).replace("{{time}}",r6(d,t))},Dne={p:r6,P:jne},Lne=/^D+$/,One=/^Y+$/,zne=["D","DD","YY","YYYY"];function Fne(e){return Lne.test(e)}function Bne(e){return One.test(e)}function Vne(e,t,i){const a=Une(e,t,i);if(console.warn(a),zne.includes(e))throw new RangeError(a)}function Une(e,t,i){const a=e[0]==="Y"?"years":"days of the month";return`Use \`${e.toLowerCase()}\` instead of \`${e}\` (in \`${t}\`) for formatting ${a} to the input \`${i}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const $ne=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Gne=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,qne=/^'([^]*?)'?$/,Hne=/''/g,Wne=/[a-zA-Z]/;function kl(e,t,i){var O,$,q,J,re,Q,ce,le;const a=Xv(),d=(i==null?void 0:i.locale)??a.locale??JB,y=(i==null?void 0:i.firstWeekContainsDate)??(($=(O=i==null?void 0:i.locale)==null?void 0:O.options)==null?void 0:$.firstWeekContainsDate)??a.firstWeekContainsDate??((J=(q=a.locale)==null?void 0:q.options)==null?void 0:J.firstWeekContainsDate)??1,S=(i==null?void 0:i.weekStartsOn)??((Q=(re=i==null?void 0:i.locale)==null?void 0:re.options)==null?void 0:Q.weekStartsOn)??a.weekStartsOn??((le=(ce=a.locale)==null?void 0:ce.options)==null?void 0:le.weekStartsOn)??0,s=ti(e);if(!Jre(s))throw new RangeError("Invalid time value");let N=t.match(Gne).map(ae=>{const he=ae[0];if(he==="p"||he==="P"){const Se=Dne[he];return Se(ae,d.formatLong)}return ae}).join("").match($ne).map(ae=>{if(ae==="''")return{isToken:!1,value:"'"};const he=ae[0];if(he==="'")return{isToken:!1,value:Zne(ae)};if(ED[he])return{isToken:!0,value:ae};if(he.match(Wne))throw new RangeError("Format string contains an unescaped latin alphabet character `"+he+"`");return{isToken:!1,value:ae}});d.localize.preprocessor&&(N=d.localize.preprocessor(s,N));const D={firstWeekContainsDate:y,weekStartsOn:S,locale:d};return N.map(ae=>{if(!ae.isToken)return ae.value;const he=ae.value;(!(i!=null&&i.useAdditionalWeekYearTokens)&&Bne(he)||!(i!=null&&i.useAdditionalDayOfYearTokens)&&Fne(he))&&Vne(he,t,String(e));const Se=ED[he[0]];return Se(s,he,d.localize,D)}).join("")}function Zne(e){const t=e.match(qne);return t?t[1].replace(Hne,"'"):e}function Yne(e){const t=ti(e),i=t.getFullYear(),a=t.getMonth(),d=Ca(e,0);return d.setFullYear(i,a+1,0),d.setHours(0,0,0,0),d.getDate()}function Xne(e){return Math.trunc(+ti(e)/1e3)}function Kne(e){const t=ti(e),i=t.getMonth();return t.setFullYear(t.getFullYear(),i+1,0),t.setHours(0,0,0,0),t}function Jne(e,t){return Qre(Kne(e),ea(e),t)+1}function BM(e,t){const i=ti(e),a=ti(t);return i.getTime()>a.getTime()}function n6(e,t){const i=ti(e),a=ti(t);return+i<+a}function $P(e,t){const i=ti(e),a=ti(t);return i.getFullYear()===a.getFullYear()&&i.getMonth()===a.getMonth()}function Qne(e,t){const i=ti(e),a=ti(t);return i.getFullYear()===a.getFullYear()}function KE(e,t){return So(e,-t)}function JE(e,t){const i=ti(e),a=i.getFullYear(),d=i.getDate(),y=Ca(e,0);y.setFullYear(a,t,15),y.setHours(0,0,0,0);const S=Yne(y);return i.setMonth(t,Math.min(d,S)),i}function PD(e,t){const i=ti(e);return isNaN(+i)?Ca(e,NaN):(i.setFullYear(t),i)}var ln=function(){return ln=Object.assign||function(t){for(var i,a=1,d=arguments.length;a<d;a++){i=arguments[a];for(var y in i)Object.prototype.hasOwnProperty.call(i,y)&&(t[y]=i[y])}return t},ln.apply(this,arguments)};function eie(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var d=0,a=Object.getOwnPropertySymbols(e);d<a.length;d++)t.indexOf(a[d])<0&&Object.prototype.propertyIsEnumerable.call(e,a[d])&&(i[a[d]]=e[a[d]]);return i}function i6(e,t,i){for(var a=0,d=t.length,y;a<d;a++)(y||!(a in t))&&(y||(y=Array.prototype.slice.call(t,0,a)),y[a]=t[a]);return e.concat(y||Array.prototype.slice.call(t))}function Kv(e){return e.mode==="multiple"}function Jv(e){return e.mode==="range"}function G2(e){return e.mode==="single"}var tie={root:"rdp",multiple_months:"rdp-multiple_months",with_weeknumber:"rdp-with_weeknumber",vhidden:"rdp-vhidden",button_reset:"rdp-button_reset",button:"rdp-button",caption:"rdp-caption",caption_start:"rdp-caption_start",caption_end:"rdp-caption_end",caption_between:"rdp-caption_between",caption_label:"rdp-caption_label",caption_dropdowns:"rdp-caption_dropdowns",dropdown:"rdp-dropdown",dropdown_month:"rdp-dropdown_month",dropdown_year:"rdp-dropdown_year",dropdown_icon:"rdp-dropdown_icon",months:"rdp-months",month:"rdp-month",table:"rdp-table",tbody:"rdp-tbody",tfoot:"rdp-tfoot",head:"rdp-head",head_row:"rdp-head_row",head_cell:"rdp-head_cell",nav:"rdp-nav",nav_button:"rdp-nav_button",nav_button_previous:"rdp-nav_button_previous",nav_button_next:"rdp-nav_button_next",nav_icon:"rdp-nav_icon",row:"rdp-row",weeknumber:"rdp-weeknumber",cell:"rdp-cell",day:"rdp-day",day_today:"rdp-day_today",day_outside:"rdp-day_outside",day_selected:"rdp-day_selected",day_disabled:"rdp-day_disabled",day_hidden:"rdp-day_hidden",day_range_start:"rdp-day_range_start",day_range_end:"rdp-day_range_end",day_range_middle:"rdp-day_range_middle"};function rie(e,t){return kl(e,"LLLL y",t)}function nie(e,t){return kl(e,"d",t)}function iie(e,t){return kl(e,"LLLL",t)}function sie(e){return"".concat(e)}function oie(e,t){return kl(e,"cccccc",t)}function aie(e,t){return kl(e,"yyyy",t)}var lie=Object.freeze({__proto__:null,formatCaption:rie,formatDay:nie,formatMonthCaption:iie,formatWeekNumber:sie,formatWeekdayName:oie,formatYearCaption:aie}),cie=function(e,t,i){return kl(e,"do MMMM (EEEE)",i)},uie=function(){return"Month: "},die=function(){return"Go to next month"},hie=function(){return"Go to previous month"},fie=function(e,t){return kl(e,"cccc",t)},pie=function(e){return"Week n. ".concat(e)},mie=function(){return"Year: "},gie=Object.freeze({__proto__:null,labelDay:cie,labelMonthDropdown:uie,labelNext:die,labelPrevious:hie,labelWeekNumber:pie,labelWeekday:fie,labelYearDropdown:mie});function _ie(){var e="buttons",t=tie,i=JB,a={},d={},y=1,S={},s=new Date;return{captionLayout:e,classNames:t,formatters:lie,labels:gie,locale:i,modifiersClassNames:a,modifiers:d,numberOfMonths:y,styles:S,today:s,mode:"default"}}function yie(e){var t=e.fromYear,i=e.toYear,a=e.fromMonth,d=e.toMonth,y=e.fromDate,S=e.toDate;return a?y=ea(a):t&&(y=new Date(t,0,1)),d?S=VP(d):i&&(S=new Date(i,11,31)),{fromDate:y?Cg(y):void 0,toDate:S?Cg(S):void 0}}var s6=H.createContext(void 0);function xie(e){var t,i=e.initialProps,a=_ie(),d=yie(i),y=d.fromDate,S=d.toDate,s=(t=i.captionLayout)!==null&&t!==void 0?t:a.captionLayout;s!=="buttons"&&(!y||!S)&&(s="buttons");var N;(G2(i)||Kv(i)||Jv(i))&&(N=i.onSelect);var D=ln(ln(ln({},a),i),{captionLayout:s,classNames:ln(ln({},a.classNames),i.classNames),components:ln({},i.components),formatters:ln(ln({},a.formatters),i.formatters),fromDate:y,labels:ln(ln({},a.labels),i.labels),mode:i.mode||a.mode,modifiers:ln(ln({},a.modifiers),i.modifiers),modifiersClassNames:ln(ln({},a.modifiersClassNames),i.modifiersClassNames),onSelect:N,styles:ln(ln({},a.styles),i.styles),toDate:S});return f.jsx(s6.Provider,{value:D,children:e.children})}function Ii(){var e=H.useContext(s6);if(!e)throw new Error("useDayPicker must be used within a DayPickerProvider.");return e}function o6(e){var t=Ii(),i=t.locale,a=t.classNames,d=t.styles,y=t.formatters.formatCaption;return f.jsx("div",{className:a.caption_label,style:d.caption_label,"aria-live":"polite",role:"presentation",id:e.id,children:y(e.displayMonth,{locale:i})})}function vie(e){return f.jsx("svg",ln({width:"8px",height:"8px",viewBox:"0 0 120 120","data-testid":"iconDropdown"},e,{children:f.jsx("path",{d:"M4.22182541,48.2218254 C8.44222828,44.0014225 15.2388494,43.9273804 19.5496459,47.9996989 L19.7781746,48.2218254 L60,88.443 L100.221825,48.2218254 C104.442228,44.0014225 111.238849,43.9273804 115.549646,47.9996989 L115.778175,48.2218254 C119.998577,52.4422283 120.07262,59.2388494 116.000301,63.5496459 L115.778175,63.7781746 L67.7781746,111.778175 C63.5577717,115.998577 56.7611506,116.07262 52.4503541,112.000301 L52.2218254,111.778175 L4.22182541,63.7781746 C-0.0739418023,59.4824074 -0.0739418023,52.5175926 4.22182541,48.2218254 Z",fill:"currentColor",fillRule:"nonzero"})}))}function a6(e){var t,i,a=e.onChange,d=e.value,y=e.children,S=e.caption,s=e.className,N=e.style,D=Ii(),O=(i=(t=D.components)===null||t===void 0?void 0:t.IconDropdown)!==null&&i!==void 0?i:vie;return f.jsxs("div",{className:s,style:N,children:[f.jsx("span",{className:D.classNames.vhidden,children:e["aria-label"]}),f.jsx("select",{name:e.name,"aria-label":e["aria-label"],className:D.classNames.dropdown,style:D.styles.dropdown,value:d,onChange:a,children:y}),f.jsxs("div",{className:D.classNames.caption_label,style:D.styles.caption_label,"aria-hidden":"true",children:[S,f.jsx(O,{className:D.classNames.dropdown_icon,style:D.styles.dropdown_icon})]})]})}function bie(e){var t,i=Ii(),a=i.fromDate,d=i.toDate,y=i.styles,S=i.locale,s=i.formatters.formatMonthCaption,N=i.classNames,D=i.components,O=i.labels.labelMonthDropdown;if(!a)return f.jsx(f.Fragment,{});if(!d)return f.jsx(f.Fragment,{});var $=[];if(Qne(a,d))for(var q=ea(a),J=a.getMonth();J<=d.getMonth();J++)$.push(JE(q,J));else for(var q=ea(new Date),J=0;J<=11;J++)$.push(JE(q,J));var re=function(ce){var le=Number(ce.target.value),ae=JE(ea(e.displayMonth),le);e.onChange(ae)},Q=(t=D==null?void 0:D.Dropdown)!==null&&t!==void 0?t:a6;return f.jsx(Q,{name:"months","aria-label":O(),className:N.dropdown_month,style:y.dropdown_month,onChange:re,value:e.displayMonth.getMonth(),caption:s(e.displayMonth,{locale:S}),children:$.map(function(ce){return f.jsx("option",{value:ce.getMonth(),children:s(ce,{locale:S})},ce.getMonth())})})}function wie(e){var t,i=e.displayMonth,a=Ii(),d=a.fromDate,y=a.toDate,S=a.locale,s=a.styles,N=a.classNames,D=a.components,O=a.formatters.formatYearCaption,$=a.labels.labelYearDropdown,q=[];if(!d)return f.jsx(f.Fragment,{});if(!y)return f.jsx(f.Fragment,{});for(var J=d.getFullYear(),re=y.getFullYear(),Q=J;Q<=re;Q++)q.push(PD(XB(new Date),Q));var ce=function(ae){var he=PD(ea(i),Number(ae.target.value));e.onChange(he)},le=(t=D==null?void 0:D.Dropdown)!==null&&t!==void 0?t:a6;return f.jsx(le,{name:"years","aria-label":$(),className:N.dropdown_year,style:s.dropdown_year,onChange:ce,value:i.getFullYear(),caption:O(i,{locale:S}),children:q.map(function(ae){return f.jsx("option",{value:ae.getFullYear(),children:O(ae,{locale:S})},ae.getFullYear())})})}function Sie(e,t){var i=H.useState(e),a=i[0],d=i[1],y=t===void 0?a:t;return[y,d]}function Tie(e){var t=e.month,i=e.defaultMonth,a=e.today,d=t||i||a||new Date,y=e.toDate,S=e.fromDate,s=e.numberOfMonths,N=s===void 0?1:s;if(y&&hv(y,d)<0){var D=-1*(N-1);d=Bl(y,D)}return S&&hv(d,S)<0&&(d=S),ea(d)}function Eie(){var e=Ii(),t=Tie(e),i=Sie(t,e.month),a=i[0],d=i[1],y=function(S){var s;if(!e.disableNavigation){var N=ea(S);d(N),(s=e.onMonthChange)===null||s===void 0||s.call(e,N)}};return[a,y]}function Cie(e,t){for(var i=t.reverseMonths,a=t.numberOfMonths,d=ea(e),y=ea(Bl(d,a)),S=hv(y,d),s=[],N=0;N<S;N++){var D=Bl(d,N);s.push(D)}return i&&(s=s.reverse()),s}function Mie(e,t){if(!t.disableNavigation){var i=t.toDate,a=t.pagedNavigation,d=t.numberOfMonths,y=d===void 0?1:d,S=a?y:1,s=ea(e);if(!i)return Bl(s,S);var N=hv(i,e);if(!(N<y))return Bl(s,S)}}function Aie(e,t){if(!t.disableNavigation){var i=t.fromDate,a=t.pagedNavigation,d=t.numberOfMonths,y=d===void 0?1:d,S=a?y:1,s=ea(e);if(!i)return Bl(s,-S);var N=hv(s,i);if(!(N<=0))return Bl(s,-S)}}var l6=H.createContext(void 0);function Pie(e){var t=Ii(),i=Eie(),a=i[0],d=i[1],y=Cie(a,t),S=Mie(a,t),s=Aie(a,t),N=function($){return y.some(function(q){return $P($,q)})},D=function($,q){N($)||(q&&n6($,q)?d(Bl($,1+t.numberOfMonths*-1)):d($))},O={currentMonth:a,displayMonths:y,goToMonth:d,goToDate:D,previousMonth:s,nextMonth:S,isDateDisplayed:N};return f.jsx(l6.Provider,{value:O,children:e.children})}function Qv(){var e=H.useContext(l6);if(!e)throw new Error("useNavigation must be used within a NavigationProvider");return e}function ID(e){var t,i=Ii(),a=i.classNames,d=i.styles,y=i.components,S=Qv().goToMonth,s=function(O){S(Bl(O,e.displayIndex?-e.displayIndex:0))},N=(t=y==null?void 0:y.CaptionLabel)!==null&&t!==void 0?t:o6,D=f.jsx(N,{id:e.id,displayMonth:e.displayMonth});return f.jsxs("div",{className:a.caption_dropdowns,style:d.caption_dropdowns,children:[f.jsx("div",{className:a.vhidden,children:D}),f.jsx(bie,{onChange:s,displayMonth:e.displayMonth}),f.jsx(wie,{onChange:s,displayMonth:e.displayMonth})]})}function Iie(e){return f.jsx("svg",ln({width:"16px",height:"16px",viewBox:"0 0 120 120"},e,{children:f.jsx("path",{d:"M69.490332,3.34314575 C72.6145263,0.218951416 77.6798462,0.218951416 80.8040405,3.34314575 C83.8617626,6.40086786 83.9268205,11.3179931 80.9992143,14.4548388 L80.8040405,14.6568542 L35.461,60 L80.8040405,105.343146 C83.8617626,108.400868 83.9268205,113.317993 80.9992143,116.454839 L80.8040405,116.656854 C77.7463184,119.714576 72.8291931,119.779634 69.6923475,116.852028 L69.490332,116.656854 L18.490332,65.6568542 C15.4326099,62.5991321 15.367552,57.6820069 18.2951583,54.5451612 L18.490332,54.3431458 L69.490332,3.34314575 Z",fill:"currentColor",fillRule:"nonzero"})}))}function kie(e){return f.jsx("svg",ln({width:"16px",height:"16px",viewBox:"0 0 120 120"},e,{children:f.jsx("path",{d:"M49.8040405,3.34314575 C46.6798462,0.218951416 41.6145263,0.218951416 38.490332,3.34314575 C35.4326099,6.40086786 35.367552,11.3179931 38.2951583,14.4548388 L38.490332,14.6568542 L83.8333725,60 L38.490332,105.343146 C35.4326099,108.400868 35.367552,113.317993 38.2951583,116.454839 L38.490332,116.656854 C41.5480541,119.714576 46.4651794,119.779634 49.602025,116.852028 L49.8040405,116.656854 L100.804041,65.6568542 C103.861763,62.5991321 103.926821,57.6820069 100.999214,54.5451612 L100.804041,54.3431458 L49.8040405,3.34314575 Z",fill:"currentColor"})}))}var jw=H.forwardRef(function(e,t){var i=Ii(),a=i.classNames,d=i.styles,y=[a.button_reset,a.button];e.className&&y.push(e.className);var S=y.join(" "),s=ln(ln({},d.button_reset),d.button);return e.style&&Object.assign(s,e.style),f.jsx("button",ln({},e,{ref:t,type:"button",className:S,style:s}))});function Nie(e){var t,i,a=Ii(),d=a.dir,y=a.locale,S=a.classNames,s=a.styles,N=a.labels,D=N.labelPrevious,O=N.labelNext,$=a.components;if(!e.nextMonth&&!e.previousMonth)return f.jsx(f.Fragment,{});var q=D(e.previousMonth,{locale:y}),J=[S.nav_button,S.nav_button_previous].join(" "),re=O(e.nextMonth,{locale:y}),Q=[S.nav_button,S.nav_button_next].join(" "),ce=(t=$==null?void 0:$.IconRight)!==null&&t!==void 0?t:kie,le=(i=$==null?void 0:$.IconLeft)!==null&&i!==void 0?i:Iie;return f.jsxs("div",{className:S.nav,style:s.nav,children:[!e.hidePrevious&&f.jsx(jw,{name:"previous-month","aria-label":q,className:J,style:s.nav_button_previous,disabled:!e.previousMonth,onClick:e.onPreviousClick,children:d==="rtl"?f.jsx(ce,{className:S.nav_icon,style:s.nav_icon}):f.jsx(le,{className:S.nav_icon,style:s.nav_icon})}),!e.hideNext&&f.jsx(jw,{name:"next-month","aria-label":re,className:Q,style:s.nav_button_next,disabled:!e.nextMonth,onClick:e.onNextClick,children:d==="rtl"?f.jsx(le,{className:S.nav_icon,style:s.nav_icon}):f.jsx(ce,{className:S.nav_icon,style:s.nav_icon})})]})}function kD(e){var t=Ii().numberOfMonths,i=Qv(),a=i.previousMonth,d=i.nextMonth,y=i.goToMonth,S=i.displayMonths,s=S.findIndex(function(re){return $P(e.displayMonth,re)}),N=s===0,D=s===S.length-1,O=t>1&&(N||!D),$=t>1&&(D||!N),q=function(){a&&y(a)},J=function(){d&&y(d)};return f.jsx(Nie,{displayMonth:e.displayMonth,hideNext:O,hidePrevious:$,nextMonth:d,previousMonth:a,onPreviousClick:q,onNextClick:J})}function Rie(e){var t,i=Ii(),a=i.classNames,d=i.disableNavigation,y=i.styles,S=i.captionLayout,s=i.components,N=(t=s==null?void 0:s.CaptionLabel)!==null&&t!==void 0?t:o6,D;return d?D=f.jsx(N,{id:e.id,displayMonth:e.displayMonth}):S==="dropdown"?D=f.jsx(ID,{displayMonth:e.displayMonth,id:e.id}):S==="dropdown-buttons"?D=f.jsxs(f.Fragment,{children:[f.jsx(ID,{displayMonth:e.displayMonth,displayIndex:e.displayIndex,id:e.id}),f.jsx(kD,{displayMonth:e.displayMonth,displayIndex:e.displayIndex,id:e.id})]}):D=f.jsxs(f.Fragment,{children:[f.jsx(N,{id:e.id,displayMonth:e.displayMonth,displayIndex:e.displayIndex}),f.jsx(kD,{displayMonth:e.displayMonth,id:e.id})]}),f.jsx("div",{className:a.caption,style:y.caption,children:D})}function jie(e){var t=Ii(),i=t.footer,a=t.styles,d=t.classNames.tfoot;return i?f.jsx("tfoot",{className:d,style:a.tfoot,children:f.jsx("tr",{children:f.jsx("td",{colSpan:8,children:i})})}):f.jsx(f.Fragment,{})}function Die(e,t,i){for(var a=i?Gf(new Date):Mc(new Date,{locale:e,weekStartsOn:t}),d=[],y=0;y<7;y++){var S=So(a,y);d.push(S)}return d}function Lie(){var e=Ii(),t=e.classNames,i=e.styles,a=e.showWeekNumber,d=e.locale,y=e.weekStartsOn,S=e.ISOWeek,s=e.formatters.formatWeekdayName,N=e.labels.labelWeekday,D=Die(d,y,S);return f.jsxs("tr",{style:i.head_row,className:t.head_row,children:[a&&f.jsx("td",{style:i.head_cell,className:t.head_cell}),D.map(function(O,$){return f.jsx("th",{scope:"col",className:t.head_cell,style:i.head_cell,"aria-label":N(O,{locale:d}),children:s(O,{locale:d})},$)})]})}function Oie(){var e,t=Ii(),i=t.classNames,a=t.styles,d=t.components,y=(e=d==null?void 0:d.HeadRow)!==null&&e!==void 0?e:Lie;return f.jsx("thead",{style:a.head,className:i.head,children:f.jsx(y,{})})}function zie(e){var t=Ii(),i=t.locale,a=t.formatters.formatDay;return f.jsx(f.Fragment,{children:a(e.date,{locale:i})})}var GP=H.createContext(void 0);function Fie(e){if(!Kv(e.initialProps)){var t={selected:void 0,modifiers:{disabled:[]}};return f.jsx(GP.Provider,{value:t,children:e.children})}return f.jsx(Bie,{initialProps:e.initialProps,children:e.children})}function Bie(e){var t=e.initialProps,i=e.children,a=t.selected,d=t.min,y=t.max,S=function(D,O,$){var q,J;(q=t.onDayClick)===null||q===void 0||q.call(t,D,O,$);var re=!!(O.selected&&d&&(a==null?void 0:a.length)===d);if(!re){var Q=!!(!O.selected&&y&&(a==null?void 0:a.length)===y);if(!Q){var ce=a?i6([],a):[];if(O.selected){var le=ce.findIndex(function(ae){return Yo(D,ae)});ce.splice(le,1)}else ce.push(D);(J=t.onSelect)===null||J===void 0||J.call(t,ce,D,O,$)}}},s={disabled:[]};a&&s.disabled.push(function(D){var O=y&&a.length>y-1,$=a.some(function(q){return Yo(q,D)});return!!(O&&!$)});var N={selected:a,onDayClick:S,modifiers:s};return f.jsx(GP.Provider,{value:N,children:i})}function qP(){var e=H.useContext(GP);if(!e)throw new Error("useSelectMultiple must be used within a SelectMultipleProvider");return e}function Vie(e,t){var i=t||{},a=i.from,d=i.to;return a&&d?Yo(d,e)&&Yo(a,e)?void 0:Yo(d,e)?{from:d,to:void 0}:Yo(a,e)?void 0:BM(a,e)?{from:e,to:d}:{from:a,to:e}:d?BM(e,d)?{from:d,to:e}:{from:e,to:d}:a?n6(e,a)?{from:e,to:a}:{from:a,to:e}:{from:e,to:void 0}}var HP=H.createContext(void 0);function Uie(e){if(!Jv(e.initialProps)){var t={selected:void 0,modifiers:{range_start:[],range_end:[],range_middle:[],disabled:[]}};return f.jsx(HP.Provider,{value:t,children:e.children})}return f.jsx($ie,{initialProps:e.initialProps,children:e.children})}function $ie(e){var t=e.initialProps,i=e.children,a=t.selected,d=a||{},y=d.from,S=d.to,s=t.min,N=t.max,D=function(J,re,Q){var ce,le;(ce=t.onDayClick)===null||ce===void 0||ce.call(t,J,re,Q);var ae=Vie(J,a);(le=t.onSelect)===null||le===void 0||le.call(t,ae,J,re,Q)},O={range_start:[],range_end:[],range_middle:[],disabled:[]};if(y?(O.range_start=[y],S?(O.range_end=[S],Yo(y,S)||(O.range_middle=[{after:y,before:S}])):O.range_end=[y]):S&&(O.range_start=[S],O.range_end=[S]),s&&(y&&!S&&O.disabled.push({after:KE(y,s-1),before:So(y,s-1)}),y&&S&&O.disabled.push({after:y,before:So(y,s-1)}),!y&&S&&O.disabled.push({after:KE(S,s-1),before:So(S,s-1)})),N){if(y&&!S&&(O.disabled.push({before:So(y,-N+1)}),O.disabled.push({after:So(y,N-1)})),y&&S){var $=yc(S,y)+1,q=N-$;O.disabled.push({before:KE(y,q)}),O.disabled.push({after:So(S,q)})}!y&&S&&(O.disabled.push({before:So(S,-N+1)}),O.disabled.push({after:So(S,N-1)}))}return f.jsx(HP.Provider,{value:{selected:a,onDayClick:D,modifiers:O},children:i})}function WP(){var e=H.useContext(HP);if(!e)throw new Error("useSelectRange must be used within a SelectRangeProvider");return e}function Gb(e){return Array.isArray(e)?i6([],e):e!==void 0?[e]:[]}function Gie(e){var t={};return Object.entries(e).forEach(function(i){var a=i[0],d=i[1];t[a]=Gb(d)}),t}var Vl;(function(e){e.Outside="outside",e.Disabled="disabled",e.Selected="selected",e.Hidden="hidden",e.Today="today",e.RangeStart="range_start",e.RangeEnd="range_end",e.RangeMiddle="range_middle"})(Vl||(Vl={}));var qie=Vl.Selected,Yc=Vl.Disabled,Hie=Vl.Hidden,Wie=Vl.Today,QE=Vl.RangeEnd,eC=Vl.RangeMiddle,tC=Vl.RangeStart,Zie=Vl.Outside;function Yie(e,t,i){var a,d=(a={},a[qie]=Gb(e.selected),a[Yc]=Gb(e.disabled),a[Hie]=Gb(e.hidden),a[Wie]=[e.today],a[QE]=[],a[eC]=[],a[tC]=[],a[Zie]=[],a);return e.fromDate&&d[Yc].push({before:e.fromDate}),e.toDate&&d[Yc].push({after:e.toDate}),Kv(e)?d[Yc]=d[Yc].concat(t.modifiers[Yc]):Jv(e)&&(d[Yc]=d[Yc].concat(i.modifiers[Yc]),d[tC]=i.modifiers[tC],d[eC]=i.modifiers[eC],d[QE]=i.modifiers[QE]),d}var c6=H.createContext(void 0);function Xie(e){var t=Ii(),i=qP(),a=WP(),d=Yie(t,i,a),y=Gie(t.modifiers),S=ln(ln({},d),y);return f.jsx(c6.Provider,{value:S,children:e.children})}function u6(){var e=H.useContext(c6);if(!e)throw new Error("useModifiers must be used within a ModifiersProvider");return e}function Kie(e){return!!(e&&typeof e=="object"&&"before"in e&&"after"in e)}function Jie(e){return!!(e&&typeof e=="object"&&"from"in e)}function Qie(e){return!!(e&&typeof e=="object"&&"after"in e)}function ese(e){return!!(e&&typeof e=="object"&&"before"in e)}function tse(e){return!!(e&&typeof e=="object"&&"dayOfWeek"in e)}function rse(e,t){var i,a=t.from,d=t.to;if(a&&d){var y=yc(d,a)<0;y&&(i=[d,a],a=i[0],d=i[1]);var S=yc(e,a)>=0&&yc(d,e)>=0;return S}return d?Yo(d,e):a?Yo(a,e):!1}function nse(e){return BP(e)}function ise(e){return Array.isArray(e)&&e.every(BP)}function sse(e,t){return t.some(function(i){if(typeof i=="boolean")return i;if(nse(i))return Yo(e,i);if(ise(i))return i.includes(e);if(Jie(i))return rse(e,i);if(tse(i))return i.dayOfWeek.includes(e.getDay());if(Kie(i)){var a=yc(i.before,e),d=yc(i.after,e),y=a>0,S=d<0,s=BM(i.before,i.after);return s?S&&y:y||S}return Qie(i)?yc(e,i.after)>0:ese(i)?yc(i.before,e)>0:typeof i=="function"?i(e):!1})}function ZP(e,t,i){var a=Object.keys(t).reduce(function(y,S){var s=t[S];return sse(e,s)&&y.push(S),y},[]),d={};return a.forEach(function(y){return d[y]=!0}),i&&!$P(e,i)&&(d.outside=!0),d}function ose(e,t){for(var i=ea(e[0]),a=VP(e[e.length-1]),d,y,S=i;S<=a;){var s=ZP(S,t),N=!s.disabled&&!s.hidden;if(!N){S=So(S,1);continue}if(s.selected)return S;s.today&&!y&&(y=S),d||(d=S),S=So(S,1)}return y||d}var ase=365;function d6(e,t){var i=t.moveBy,a=t.direction,d=t.context,y=t.modifiers,S=t.retry,s=S===void 0?{count:0,lastFocused:e}:S,N=d.weekStartsOn,D=d.fromDate,O=d.toDate,$=d.locale,q={day:So,week:FM,month:Bl,year:Yre,startOfWeek:function(ce){return d.ISOWeek?Gf(ce):Mc(ce,{locale:$,weekStartsOn:N})},endOfWeek:function(ce){return d.ISOWeek?KB(ce):UP(ce,{locale:$,weekStartsOn:N})}},J=q[i](e,a==="after"?1:-1);a==="before"&&D?J=Xre([D,J]):a==="after"&&O&&(J=Kre([O,J]));var re=!0;if(y){var Q=ZP(J,y);re=!Q.disabled&&!Q.hidden}return re?J:s.count>ase?s.lastFocused:d6(J,{moveBy:i,direction:a,context:d,modifiers:y,retry:ln(ln({},s),{count:s.count+1})})}var h6=H.createContext(void 0);function lse(e){var t=Qv(),i=u6(),a=H.useState(),d=a[0],y=a[1],S=H.useState(),s=S[0],N=S[1],D=ose(t.displayMonths,i),O=d??(s&&t.isDateDisplayed(s))?s:D,$=function(){N(d),y(void 0)},q=function(ce){y(ce)},J=Ii(),re=function(ce,le){if(d){var ae=d6(d,{moveBy:ce,direction:le,context:J,modifiers:i});Yo(d,ae)||(t.goToDate(ae,d),q(ae))}},Q={focusedDay:d,focusTarget:O,blur:$,focus:q,focusDayAfter:function(){return re("day","after")},focusDayBefore:function(){return re("day","before")},focusWeekAfter:function(){return re("week","after")},focusWeekBefore:function(){return re("week","before")},focusMonthBefore:function(){return re("month","before")},focusMonthAfter:function(){return re("month","after")},focusYearBefore:function(){return re("year","before")},focusYearAfter:function(){return re("year","after")},focusStartOfWeek:function(){return re("startOfWeek","before")},focusEndOfWeek:function(){return re("endOfWeek","after")}};return f.jsx(h6.Provider,{value:Q,children:e.children})}function YP(){var e=H.useContext(h6);if(!e)throw new Error("useFocusContext must be used within a FocusProvider");return e}function cse(e,t){var i=u6(),a=ZP(e,i,t);return a}var XP=H.createContext(void 0);function use(e){if(!G2(e.initialProps)){var t={selected:void 0};return f.jsx(XP.Provider,{value:t,children:e.children})}return f.jsx(dse,{initialProps:e.initialProps,children:e.children})}function dse(e){var t=e.initialProps,i=e.children,a=function(y,S,s){var N,D,O;if((N=t.onDayClick)===null||N===void 0||N.call(t,y,S,s),S.selected&&!t.required){(D=t.onSelect)===null||D===void 0||D.call(t,void 0,y,S,s);return}(O=t.onSelect)===null||O===void 0||O.call(t,y,y,S,s)},d={selected:t.selected,onDayClick:a};return f.jsx(XP.Provider,{value:d,children:i})}function f6(){var e=H.useContext(XP);if(!e)throw new Error("useSelectSingle must be used within a SelectSingleProvider");return e}function hse(e,t){var i=Ii(),a=f6(),d=qP(),y=WP(),S=YP(),s=S.focusDayAfter,N=S.focusDayBefore,D=S.focusWeekAfter,O=S.focusWeekBefore,$=S.blur,q=S.focus,J=S.focusMonthBefore,re=S.focusMonthAfter,Q=S.focusYearBefore,ce=S.focusYearAfter,le=S.focusStartOfWeek,ae=S.focusEndOfWeek,he=function(Nt){var Xe,nt,Qt,rr;G2(i)?(Xe=a.onDayClick)===null||Xe===void 0||Xe.call(a,e,t,Nt):Kv(i)?(nt=d.onDayClick)===null||nt===void 0||nt.call(d,e,t,Nt):Jv(i)?(Qt=y.onDayClick)===null||Qt===void 0||Qt.call(y,e,t,Nt):(rr=i.onDayClick)===null||rr===void 0||rr.call(i,e,t,Nt)},Se=function(Nt){var Xe;q(e),(Xe=i.onDayFocus)===null||Xe===void 0||Xe.call(i,e,t,Nt)},je=function(Nt){var Xe;$(),(Xe=i.onDayBlur)===null||Xe===void 0||Xe.call(i,e,t,Nt)},it=function(Nt){var Xe;(Xe=i.onDayMouseEnter)===null||Xe===void 0||Xe.call(i,e,t,Nt)},qe=function(Nt){var Xe;(Xe=i.onDayMouseLeave)===null||Xe===void 0||Xe.call(i,e,t,Nt)},ct=function(Nt){var Xe;(Xe=i.onDayPointerEnter)===null||Xe===void 0||Xe.call(i,e,t,Nt)},pt=function(Nt){var Xe;(Xe=i.onDayPointerLeave)===null||Xe===void 0||Xe.call(i,e,t,Nt)},Ze=function(Nt){var Xe;(Xe=i.onDayTouchCancel)===null||Xe===void 0||Xe.call(i,e,t,Nt)},yt=function(Nt){var Xe;(Xe=i.onDayTouchEnd)===null||Xe===void 0||Xe.call(i,e,t,Nt)},Mt=function(Nt){var Xe;(Xe=i.onDayTouchMove)===null||Xe===void 0||Xe.call(i,e,t,Nt)},Jt=function(Nt){var Xe;(Xe=i.onDayTouchStart)===null||Xe===void 0||Xe.call(i,e,t,Nt)},jt=function(Nt){var Xe;(Xe=i.onDayKeyUp)===null||Xe===void 0||Xe.call(i,e,t,Nt)},Pt=function(Nt){var Xe;switch(Nt.key){case"ArrowLeft":Nt.preventDefault(),Nt.stopPropagation(),i.dir==="rtl"?s():N();break;case"ArrowRight":Nt.preventDefault(),Nt.stopPropagation(),i.dir==="rtl"?N():s();break;case"ArrowDown":Nt.preventDefault(),Nt.stopPropagation(),D();break;case"ArrowUp":Nt.preventDefault(),Nt.stopPropagation(),O();break;case"PageUp":Nt.preventDefault(),Nt.stopPropagation(),Nt.shiftKey?Q():J();break;case"PageDown":Nt.preventDefault(),Nt.stopPropagation(),Nt.shiftKey?ce():re();break;case"Home":Nt.preventDefault(),Nt.stopPropagation(),le();break;case"End":Nt.preventDefault(),Nt.stopPropagation(),ae();break}(Xe=i.onDayKeyDown)===null||Xe===void 0||Xe.call(i,e,t,Nt)},Wt={onClick:he,onFocus:Se,onBlur:je,onKeyDown:Pt,onKeyUp:jt,onMouseEnter:it,onMouseLeave:qe,onPointerEnter:ct,onPointerLeave:pt,onTouchCancel:Ze,onTouchEnd:yt,onTouchMove:Mt,onTouchStart:Jt};return Wt}function fse(){var e=Ii(),t=f6(),i=qP(),a=WP(),d=G2(e)?t.selected:Kv(e)?i.selected:Jv(e)?a.selected:void 0;return d}function pse(e){return Object.values(Vl).includes(e)}function mse(e,t){var i=[e.classNames.day];return Object.keys(t).forEach(function(a){var d=e.modifiersClassNames[a];if(d)i.push(d);else if(pse(a)){var y=e.classNames["day_".concat(a)];y&&i.push(y)}}),i}function gse(e,t){var i=ln({},e.styles.day);return Object.keys(t).forEach(function(a){var d;i=ln(ln({},i),(d=e.modifiersStyles)===null||d===void 0?void 0:d[a])}),i}function _se(e,t,i){var a,d,y,S=Ii(),s=YP(),N=cse(e,t),D=hse(e,N),O=fse(),$=!!(S.onDayClick||S.mode!=="default");H.useEffect(function(){var it;N.outside||s.focusedDay&&$&&Yo(s.focusedDay,e)&&((it=i.current)===null||it===void 0||it.focus())},[s.focusedDay,e,i,$,N.outside]);var q=mse(S,N).join(" "),J=gse(S,N),re=!!(N.outside&&!S.showOutsideDays||N.hidden),Q=(y=(d=S.components)===null||d===void 0?void 0:d.DayContent)!==null&&y!==void 0?y:zie,ce=f.jsx(Q,{date:e,displayMonth:t,activeModifiers:N}),le={style:J,className:q,children:ce,role:"gridcell"},ae=s.focusTarget&&Yo(s.focusTarget,e)&&!N.outside,he=s.focusedDay&&Yo(s.focusedDay,e),Se=ln(ln(ln({},le),(a={disabled:N.disabled,role:"gridcell"},a["aria-selected"]=N.selected,a.tabIndex=he||ae?0:-1,a)),D),je={isButton:$,isHidden:re,activeModifiers:N,selectedDays:O,buttonProps:Se,divProps:le};return je}function yse(e){var t=H.useRef(null),i=_se(e.date,e.displayMonth,t);return i.isHidden?f.jsx("div",{role:"gridcell"}):i.isButton?f.jsx(jw,ln({name:"day",ref:t},i.buttonProps)):f.jsx("div",ln({},i.divProps))}function xse(e){var t=e.number,i=e.dates,a=Ii(),d=a.onWeekNumberClick,y=a.styles,S=a.classNames,s=a.locale,N=a.labels.labelWeekNumber,D=a.formatters.formatWeekNumber,O=D(Number(t),{locale:s});if(!d)return f.jsx("span",{className:S.weeknumber,style:y.weeknumber,children:O});var $=N(Number(t),{locale:s}),q=function(J){d(t,i,J)};return f.jsx(jw,{name:"week-number","aria-label":$,className:S.weeknumber,style:y.weeknumber,onClick:q,children:O})}function vse(e){var t,i,a=Ii(),d=a.styles,y=a.classNames,S=a.showWeekNumber,s=a.components,N=(t=s==null?void 0:s.Day)!==null&&t!==void 0?t:yse,D=(i=s==null?void 0:s.WeekNumber)!==null&&i!==void 0?i:xse,O;return S&&(O=f.jsx("td",{className:y.cell,style:d.cell,children:f.jsx(D,{number:e.weekNumber,dates:e.dates})})),f.jsxs("tr",{className:y.row,style:d.row,children:[O,e.dates.map(function($){return f.jsx("td",{className:y.cell,style:d.cell,role:"presentation",children:f.jsx(N,{displayMonth:e.displayMonth,date:$})},Xne($))})]})}function ND(e,t,i){for(var a=i!=null&&i.ISOWeek?KB(t):UP(t,i),d=i!=null&&i.ISOWeek?Gf(e):Mc(e,i),y=yc(a,d),S=[],s=0;s<=y;s++)S.push(So(d,s));var N=S.reduce(function(D,O){var $=i!=null&&i.ISOWeek?QB(O):t6(O,i),q=D.find(function(J){return J.weekNumber===$});return q?(q.dates.push(O),D):(D.push({weekNumber:$,dates:[O]}),D)},[]);return N}function bse(e,t){var i=ND(ea(e),VP(e),t);if(t!=null&&t.useFixedWeeks){var a=Jne(e,t);if(a<6){var d=i[i.length-1],y=d.dates[d.dates.length-1],S=FM(y,6-a),s=ND(FM(y,1),S,t);i.push.apply(i,s)}}return i}function wse(e){var t,i,a,d=Ii(),y=d.locale,S=d.classNames,s=d.styles,N=d.hideHead,D=d.fixedWeeks,O=d.components,$=d.weekStartsOn,q=d.firstWeekContainsDate,J=d.ISOWeek,re=bse(e.displayMonth,{useFixedWeeks:!!D,ISOWeek:J,locale:y,weekStartsOn:$,firstWeekContainsDate:q}),Q=(t=O==null?void 0:O.Head)!==null&&t!==void 0?t:Oie,ce=(i=O==null?void 0:O.Row)!==null&&i!==void 0?i:vse,le=(a=O==null?void 0:O.Footer)!==null&&a!==void 0?a:jie;return f.jsxs("table",{id:e.id,className:S.table,style:s.table,role:"grid","aria-labelledby":e["aria-labelledby"],children:[!N&&f.jsx(Q,{}),f.jsx("tbody",{className:S.tbody,style:s.tbody,children:re.map(function(ae){return f.jsx(ce,{displayMonth:e.displayMonth,dates:ae.dates,weekNumber:ae.weekNumber},ae.weekNumber)})}),f.jsx(le,{displayMonth:e.displayMonth})]})}function Sse(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}var Tse=Sse()?H.useLayoutEffect:H.useEffect,rC=!1,Ese=0;function RD(){return"react-day-picker-".concat(++Ese)}function Cse(e){var t,i=e??(rC?RD():null),a=H.useState(i),d=a[0],y=a[1];return Tse(function(){d===null&&y(RD())},[]),H.useEffect(function(){rC===!1&&(rC=!0)},[]),(t=e??d)!==null&&t!==void 0?t:void 0}function Mse(e){var t,i,a=Ii(),d=a.dir,y=a.classNames,S=a.styles,s=a.components,N=Qv().displayMonths,D=Cse(a.id?"".concat(a.id,"-").concat(e.displayIndex):void 0),O=a.id?"".concat(a.id,"-grid-").concat(e.displayIndex):void 0,$=[y.month],q=S.month,J=e.displayIndex===0,re=e.displayIndex===N.length-1,Q=!J&&!re;d==="rtl"&&(t=[J,re],re=t[0],J=t[1]),J&&($.push(y.caption_start),q=ln(ln({},q),S.caption_start)),re&&($.push(y.caption_end),q=ln(ln({},q),S.caption_end)),Q&&($.push(y.caption_between),q=ln(ln({},q),S.caption_between));var ce=(i=s==null?void 0:s.Caption)!==null&&i!==void 0?i:Rie;return f.jsxs("div",{className:$.join(" "),style:q,children:[f.jsx(ce,{id:D,displayMonth:e.displayMonth,displayIndex:e.displayIndex}),f.jsx(wse,{id:O,"aria-labelledby":D,displayMonth:e.displayMonth})]},e.displayIndex)}function Ase(e){var t=Ii(),i=t.classNames,a=t.styles;return f.jsx("div",{className:i.months,style:a.months,children:e.children})}function Pse(e){var t,i,a=e.initialProps,d=Ii(),y=YP(),S=Qv(),s=H.useState(!1),N=s[0],D=s[1];H.useEffect(function(){d.initialFocus&&y.focusTarget&&(N||(y.focus(y.focusTarget),D(!0)))},[d.initialFocus,N,y.focus,y.focusTarget,y]);var O=[d.classNames.root,d.className];d.numberOfMonths>1&&O.push(d.classNames.multiple_months),d.showWeekNumber&&O.push(d.classNames.with_weeknumber);var $=ln(ln({},d.styles.root),d.style),q=Object.keys(a).filter(function(re){return re.startsWith("data-")}).reduce(function(re,Q){var ce;return ln(ln({},re),(ce={},ce[Q]=a[Q],ce))},{}),J=(i=(t=a.components)===null||t===void 0?void 0:t.Months)!==null&&i!==void 0?i:Ase;return f.jsx("div",ln({className:O.join(" "),style:$,dir:d.dir,id:d.id,nonce:a.nonce,title:a.title,lang:a.lang},q,{children:f.jsx(J,{children:S.displayMonths.map(function(re,Q){return f.jsx(Mse,{displayIndex:Q,displayMonth:re},Q)})})}))}function Ise(e){var t=e.children,i=eie(e,["children"]);return f.jsx(xie,{initialProps:i,children:f.jsx(Pie,{children:f.jsx(use,{initialProps:i,children:f.jsx(Fie,{initialProps:i,children:f.jsx(Uie,{initialProps:i,children:f.jsx(Xie,{children:f.jsx(lse,{children:t})})})})})})})}function kse(e){return f.jsx(Ise,ln({},e,{children:f.jsx(Pse,{initialProps:e})}))}function VM({className:e,classNames:t,showOutsideDays:i=!0,...a}){return f.jsx(kse,{showOutsideDays:i,className:br("p-3",e),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:br(_M({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:br(_M({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...t},components:{IconLeft:({...d})=>f.jsx(dW,{className:"h-4 w-4"}),IconRight:({...d})=>f.jsx(q4,{className:"h-4 w-4"})},...a})}VM.displayName="Calendar";var KP="Popover",[p6,Nce]=ta(KP,[gh]),e0=gh(),[Nse,wh]=p6(KP),m6=e=>{const{__scopePopover:t,children:i,open:a,defaultOpen:d,onOpenChange:y,modal:S=!1}=e,s=e0(t),N=H.useRef(null),[D,O]=H.useState(!1),[$=!1,q]=Xa({prop:a,defaultProp:d,onChange:y});return f.jsx(aP,{...s,children:f.jsx(Nse,{scope:t,contentId:ba(),triggerRef:N,open:$,onOpenChange:q,onOpenToggle:H.useCallback(()=>q(J=>!J),[q]),hasCustomAnchor:D,onCustomAnchorAdd:H.useCallback(()=>O(!0),[]),onCustomAnchorRemove:H.useCallback(()=>O(!1),[]),modal:S,children:i})})};m6.displayName=KP;var g6="PopoverAnchor",Rse=H.forwardRef((e,t)=>{const{__scopePopover:i,...a}=e,d=wh(g6,i),y=e0(i),{onCustomAnchorAdd:S,onCustomAnchorRemove:s}=d;return H.useEffect(()=>(S(),()=>s()),[S,s]),f.jsx(Vv,{...y,...a,ref:t})});Rse.displayName=g6;var _6="PopoverTrigger",y6=H.forwardRef((e,t)=>{const{__scopePopover:i,...a}=e,d=wh(_6,i),y=e0(i),S=dn(t,d.triggerRef),s=f.jsx(wr.button,{type:"button","aria-haspopup":"dialog","aria-expanded":d.open,"aria-controls":d.contentId,"data-state":S6(d.open),...a,ref:S,onClick:Ht(e.onClick,d.onOpenToggle)});return d.hasCustomAnchor?s:f.jsx(Vv,{asChild:!0,...y,children:s})});y6.displayName=_6;var JP="PopoverPortal",[jse,Dse]=p6(JP,{forceMount:void 0}),x6=e=>{const{__scopePopover:t,forceMount:i,children:a,container:d}=e,y=wh(JP,t);return f.jsx(jse,{scope:t,forceMount:i,children:f.jsx(Yi,{present:i||y.open,children:f.jsx(Lg,{asChild:!0,container:d,children:a})})})};x6.displayName=JP;var Mg="PopoverContent",v6=H.forwardRef((e,t)=>{const i=Dse(Mg,e.__scopePopover),{forceMount:a=i.forceMount,...d}=e,y=wh(Mg,e.__scopePopover);return f.jsx(Yi,{present:a||y.open,children:y.modal?f.jsx(Lse,{...d,ref:t}):f.jsx(Ose,{...d,ref:t})})});v6.displayName=Mg;var Lse=H.forwardRef((e,t)=>{const i=wh(Mg,e.__scopePopover),a=H.useRef(null),d=dn(t,a),y=H.useRef(!1);return H.useEffect(()=>{const S=a.current;if(S)return A2(S)},[]),f.jsx(Gv,{as:Tc,allowPinchZoom:!0,children:f.jsx(b6,{...e,ref:d,trapFocus:i.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Ht(e.onCloseAutoFocus,S=>{var s;S.preventDefault(),y.current||(s=i.triggerRef.current)==null||s.focus()}),onPointerDownOutside:Ht(e.onPointerDownOutside,S=>{const s=S.detail.originalEvent,N=s.button===0&&s.ctrlKey===!0,D=s.button===2||N;y.current=D},{checkForDefaultPrevented:!1}),onFocusOutside:Ht(e.onFocusOutside,S=>S.preventDefault(),{checkForDefaultPrevented:!1})})})}),Ose=H.forwardRef((e,t)=>{const i=wh(Mg,e.__scopePopover),a=H.useRef(!1),d=H.useRef(!1);return f.jsx(b6,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:y=>{var S,s;(S=e.onCloseAutoFocus)==null||S.call(e,y),y.defaultPrevented||(a.current||(s=i.triggerRef.current)==null||s.focus(),y.preventDefault()),a.current=!1,d.current=!1},onInteractOutside:y=>{var N,D;(N=e.onInteractOutside)==null||N.call(e,y),y.defaultPrevented||(a.current=!0,y.detail.originalEvent.type==="pointerdown"&&(d.current=!0));const S=y.target;((D=i.triggerRef.current)==null?void 0:D.contains(S))&&y.preventDefault(),y.detail.originalEvent.type==="focusin"&&d.current&&y.preventDefault()}})}),b6=H.forwardRef((e,t)=>{const{__scopePopover:i,trapFocus:a,onOpenAutoFocus:d,onCloseAutoFocus:y,disableOutsidePointerEvents:S,onEscapeKeyDown:s,onPointerDownOutside:N,onFocusOutside:D,onInteractOutside:O,...$}=e,q=wh(Mg,i),J=e0(i);return C2(),f.jsx($v,{asChild:!0,loop:!0,trapped:a,onMountAutoFocus:d,onUnmountAutoFocus:y,children:f.jsx(mh,{asChild:!0,disableOutsidePointerEvents:S,onInteractOutside:O,onEscapeKeyDown:s,onPointerDownOutside:N,onFocusOutside:D,onDismiss:()=>q.onOpenChange(!1),children:f.jsx(y2,{"data-state":S6(q.open),role:"dialog",id:q.contentId,...J,...$,ref:t,style:{...$.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),w6="PopoverClose",zse=H.forwardRef((e,t)=>{const{__scopePopover:i,...a}=e,d=wh(w6,i);return f.jsx(wr.button,{type:"button",...a,ref:t,onClick:Ht(e.onClick,()=>d.onOpenChange(!1))})});zse.displayName=w6;var Fse="PopoverArrow",Bse=H.forwardRef((e,t)=>{const{__scopePopover:i,...a}=e,d=e0(i);return f.jsx(x2,{...d,...a,ref:t})});Bse.displayName=Fse;function S6(e){return e?"open":"closed"}var Vse=m6,Use=y6,$se=x6,T6=v6;const Gse=Vse,qse=Use,E6=H.forwardRef(({className:e,align:t="center",sideOffset:i=4,...a},d)=>f.jsx($se,{children:f.jsx(T6,{ref:d,align:t,sideOffset:i,className:br("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...a})}));E6.displayName=T6.displayName;const Hse=[{name:"Fall 2024",startDate:new Date(2024,8,1),endDate:new Date(2024,11,20)},{name:"Spring 2025",startDate:new Date(2025,0,15),endDate:new Date(2025,4,15)},{name:"Summer 2025",startDate:new Date(2025,5,1),endDate:new Date(2025,7,31)},{name:"Fall 2025",startDate:new Date(2025,8,1),endDate:new Date(2025,11,20)}];function Wse({onDateSelect:e,className:t}){const[i,a]=H.useState(),[d,y]=H.useState(),[S,s]=H.useState(null),[N,D]=H.useState(!1),O=J=>{a(J.startDate),y(J.endDate),s(J.name),e(J.startDate,J.endDate)},$=(J,re)=>{re?(a(J),s(null),J&&d&&J>d?(y(void 0),e(J,void 0)):e(J,d)):(y(J),s(null),e(i,J))},q=()=>i&&d?`${kl(i,"MMM d, yyyy")} - ${kl(d,"MMM d, yyyy")}`:i?`From ${kl(i,"MMM d, yyyy")}`:d?`Until ${kl(d,"MMM d, yyyy")}`:"Select dates";return f.jsxs("div",{className:br("space-y-4",t),children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium mb-2",children:"Quick Select Semester"}),f.jsx("div",{className:"flex flex-wrap gap-2",children:Hse.map(J=>f.jsxs(Kt,{variant:S===J.name?"default":"outline",size:"sm",onClick:()=>O(J),className:"flex items-center gap-1",children:[f.jsx(lW,{className:"h-3 w-3"}),J.name]},J.name))})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium mb-2",children:"Or Choose Custom Dates"}),f.jsxs(Gse,{open:N,onOpenChange:D,children:[f.jsx(qse,{asChild:!0,children:f.jsxs(Kt,{variant:"outline",className:br("w-full justify-start text-left font-normal",!i&&!d&&"text-muted-foreground"),children:[f.jsx(nh,{className:"mr-2 h-4 w-4"}),q()]})}),f.jsx(E6,{className:"w-auto p-0",align:"start",children:f.jsxs("div",{className:"p-4",children:[f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium mb-2",children:"Start Date"}),f.jsx(VM,{mode:"single",selected:i,onSelect:J=>$(J,!0),className:"pointer-events-auto",disabled:J=>J<new Date})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium mb-2",children:"End Date"}),f.jsx(VM,{mode:"single",selected:d,onSelect:J=>$(J,!1),className:"pointer-events-auto",disabled:J=>J<(i||new Date)})]})]}),f.jsx(Kt,{onClick:()=>D(!1),className:"w-full mt-4",disabled:!i&&!d,children:"Apply Dates"})]})})]})]}),(i||d)&&f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsxs(wn,{variant:"secondary",className:"flex items-center gap-1",children:[f.jsx(nh,{className:"h-3 w-3"}),q()]}),S&&f.jsx(wn,{variant:"outline",children:S})]})]})}const jD=[{id:1,user:{name:"Emma Johnson",avatar:"https://i.pravatar.cc/150?img=1",university:"Sciences Po Paris",isVerified:!0,verificationMethod:"University Email"},current:{city:"Paris, France",type:"Studio Apartment",price:"€800/month",image:"https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8NHx8YXBhcnRtZW50fGVufDB8fDB8fHww&auto=format&fit=crop&w=600&q=60"},wanted:{city:"Madrid, Spain",type:"Any",price:"€600-800/month"},dates:"Sep 5, 2023 - Feb 20, 2024",tags:["Near University","Furnished","Public Transit"]},{id:2,user:{name:"Miguel Santos",avatar:"https://i.pravatar.cc/150?img=11",university:"University of Barcelona",isVerified:!0,verificationMethod:"Student ID Card"},current:{city:"Barcelona, Spain",type:"1 Bedroom Apartment",price:"€750/month",image:"https://images.unsplash.com/photo-1493809842364-78817add7ffb?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTB8fGFwYXJ0bWVudHxlbnwwfHwwfHx8MA%3D%3D&auto=format&fit=crop&w=600&q=60"},wanted:{city:"Berlin, Germany",type:"Studio or Room",price:"€500-800/month"},dates:"Oct 10, 2023 - Mar 15, 2024",tags:["Balcony","WiFi","Furnished"]},{id:3,user:{name:"Sophie Weber",avatar:"https://i.pravatar.cc/150?img=5",university:"Humboldt University",isVerified:!1,verificationMethod:null},current:{city:"Berlin, Germany",type:"2 Bedroom Apartment (Shared)",price:"€550/month",image:"https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTd8fGFwYXJ0bWVudHxlbnwwfHwwfHx8MA%3D%3D&auto=format&fit=crop&w=600&q=60"},wanted:{city:"Copenhagen, Denmark",type:"Any",price:"€500-700/month"},dates:"Jan 15, 2024 - Jun 30, 2024",tags:["Pet Friendly","Near Park","Bicycle Storage"]}],Zse=["All Universities","Sciences Po Paris","University of Barcelona","Humboldt University","University of Amsterdam","Sorbonne University","Heidelberg University","Cambridge University","Oxford University","Politecnico di Milano","Technical University of Berlin","Uppsala University","Complutense University of Madrid","IE University Madrid","Erasmus University Rotterdam","Harvard University","Stanford University","MIT","UC Berkeley","New York University"],nC=()=>{yh();const[e,t]=H.useState(jD),[i,a]=H.useState(jD),[d,y]=H.useState(""),[S,s]=H.useState("All Universities"),[N,D]=H.useState("all"),[O,$]=H.useState(!1),[q,J]=H.useState("Browse Available Swaps"),[re,Q]=H.useState("Find your perfect accommodation swap from verified students around the world"),[ce,le]=H.useState(),[ae,he]=H.useState(),Se=(pt,Ze)=>{le(pt),he(Ze),it()},je=pt=>{pt.preventDefault(),it()},it=()=>{let pt=e;d.trim()&&(pt=pt.filter(Ze=>{var Mt,Jt;const yt=Ze;return((Mt=yt.current)==null?void 0:Mt.city.toLowerCase().includes(d.toLowerCase()))||((Jt=yt.wanted)==null?void 0:Jt.city.toLowerCase().includes(d.toLowerCase()))})),S!=="All Universities"&&(pt=pt.filter(Ze=>Ze.user.university===S)),N==="verified"?pt=pt.filter(Ze=>Ze.user.isVerified):N==="unverified"&&(pt=pt.filter(Ze=>!Ze.user.isVerified)),a(pt)};H.useEffect(()=>{it()},[S,N,ce,ae]);const qe=pt=>{const[Ze,yt]=pt.split(" - ");return{startDate:new Date(Ze+", "+new Date().getFullYear()),endDate:new Date(yt)}},ct=pt=>{const Ze=pt,{startDate:yt,endDate:Mt}=qe(Ze.dates);return f.jsxs(Zr,{className:"overflow-hidden hover:shadow-md transition-shadow",children:[f.jsx(zn,{className:"pb-2",children:f.jsx("div",{className:"flex justify-between items-start",children:f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx("img",{src:Ze.user.avatar,alt:Ze.user.name,className:"w-10 h-10 rounded-full object-cover"}),f.jsxs("div",{children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx(Fn,{className:"text-lg",children:Ze.user.name}),Ze.user.isVerified?f.jsxs(wn,{variant:"secondary",className:"bg-green-50 text-green-700 border-green-200 flex items-center gap-1",children:[f.jsx(Ao,{className:"h-3 w-3"}),"Verified"]}):f.jsx(wn,{variant:"outline",className:"bg-gray-50 text-gray-600 border-gray-200",children:"Unverified"})]}),f.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-600",children:[f.jsx(Kf,{className:"h-3 w-3"}),f.jsx(oo,{children:Ze.user.university})]}),Ze.user.isVerified&&Ze.user.verificationMethod&&f.jsxs("p",{className:"text-xs text-green-600",children:["Verified via ",Ze.user.verificationMethod]})]})]})})}),f.jsxs(Kr,{children:[f.jsx("div",{className:"flex items-center justify-between mb-4 pt-2",children:f.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-600",children:[f.jsx(nh,{className:"h-4 w-4 text-swap-blue"}),f.jsx("span",{children:Ze.dates})]})}),f.jsx(R2,{userStartDate:ce,userEndDate:ae,swapStartDate:yt,swapEndDate:Mt,className:"mb-4"}),f.jsx("div",{className:"mb-4 aspect-video rounded-md overflow-hidden",children:f.jsx("img",{src:Ze.current.image,alt:`${Ze.current.city} apartment`,className:"w-full h-full object-cover"})}),f.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[f.jsxs("div",{className:"bg-swap-lightBlue rounded-lg p-4",children:[f.jsx("h4",{className:"font-medium mb-2 text-sm uppercase text-gray-500",children:"Current Place"}),f.jsxs("div",{className:"mb-2",children:[f.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[f.jsx(Ec,{className:"h-4 w-4 text-swap-blue"}),f.jsx("span",{className:"font-medium",children:Ze.current.city})]}),f.jsx("p",{className:"text-sm text-gray-600",children:Ze.current.type})]}),f.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[f.jsx(xg,{className:"h-4 w-4"}),f.jsx("span",{children:Ze.current.price})]})]}),f.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[f.jsx("h4",{className:"font-medium mb-2 text-sm uppercase text-gray-500",children:"Looking For"}),f.jsxs("div",{className:"mb-2",children:[f.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[f.jsx(Ec,{className:"h-4 w-4 text-swap-blue"}),f.jsx("span",{className:"font-medium",children:Ze.wanted.city})]}),f.jsx("p",{className:"text-sm text-gray-600",children:Ze.wanted.type})]}),f.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[f.jsx(xg,{className:"h-4 w-4"}),f.jsx("span",{children:Ze.wanted.price})]})]})]}),f.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:Ze.tags.map((Jt,jt)=>f.jsx(wn,{variant:"secondary",className:"bg-gray-100 text-gray-800 hover:bg-gray-200",children:Jt},jt))})]}),f.jsx(N2,{children:f.jsx(Kt,{asChild:!0,className:"w-full bg-swap-blue hover:bg-swap-darkBlue",children:f.jsxs(un,{to:`/swaps/${Ze.id}`,children:[f.jsx(f2,{className:"h-4 w-4 mr-2"}),"View Swap Details"]})})})]},Ze.id)};return f.jsxs("div",{className:"min-h-screen flex flex-col",children:[f.jsx(gi,{}),f.jsx("main",{className:"flex-grow py-8 px-4 md:px-8 bg-gray-50",children:f.jsxs("div",{className:"max-w-7xl mx-auto",children:[f.jsxs("div",{className:"mb-8",children:[f.jsx("h1",{className:"text-3xl font-bold mb-2",children:q}),f.jsx("p",{className:"text-gray-600",children:re})]}),f.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-8",children:[f.jsx("h2",{className:"text-lg font-semibold mb-4",children:"When do you need accommodation?"}),f.jsx(Wse,{onDateSelect:Se})]}),f.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4 mb-8",children:[f.jsxs("form",{onSubmit:je,className:"flex flex-col md:flex-row gap-4",children:[f.jsx("div",{className:"flex-grow",children:f.jsx(Pn,{placeholder:"Search by location",value:d,onChange:pt=>y(pt.target.value),className:"w-full"})}),f.jsxs("div",{className:"flex gap-2",children:[f.jsxs(Jd,{value:S,onValueChange:s,children:[f.jsx(ou,{className:"w-48",children:f.jsx(Qd,{placeholder:"Select university"})}),f.jsx(au,{children:Zse.map(pt=>f.jsx(hs,{value:pt,children:pt},pt))})]}),f.jsxs(Kt,{type:"submit",className:"bg-swap-blue hover:bg-swap-darkBlue",children:[f.jsx(_w,{className:"h-4 w-4 mr-2"}),"Search"]}),f.jsxs(Kt,{type:"button",variant:"outline",onClick:()=>$(!O),children:[f.jsx(NW,{className:"h-4 w-4 mr-2"}),"Filters"]})]})]}),O&&f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-4 pt-4 border-t",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium mb-1",children:"Price Range"}),f.jsxs(Jd,{children:[f.jsx(ou,{children:f.jsx(Qd,{placeholder:"Select price range"})}),f.jsxs(au,{children:[f.jsx(hs,{value:"0-500",children:"€0 - €500/month"}),f.jsx(hs,{value:"500-750",children:"€500 - €750/month"}),f.jsx(hs,{value:"750-1000",children:"€750 - €1000/month"}),f.jsx(hs,{value:"1000+",children:"€1000+/month"})]})]})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium mb-1",children:"Verification Status"}),f.jsxs(Jd,{value:N,onValueChange:D,children:[f.jsx(ou,{children:f.jsx(Qd,{placeholder:"All students"})}),f.jsxs(au,{children:[f.jsx(hs,{value:"all",children:"All Students"}),f.jsx(hs,{value:"verified",children:"Verified Only"}),f.jsx(hs,{value:"unverified",children:"Unverified Only"})]})]})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium mb-1",children:"Available From"}),f.jsx(Pn,{type:"date"})]})]})]}),f.jsxs("div",{className:"mb-4 flex justify-between items-center",children:[f.jsxs("p",{className:"text-gray-600",children:[i.length," results found"]}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("span",{className:"text-sm text-gray-500",children:"Filter by verification:"}),f.jsx(Kt,{variant:N==="all"?"default":"outline",size:"sm",onClick:()=>D("all"),children:"All"}),f.jsxs(Kt,{variant:N==="verified"?"default":"outline",size:"sm",onClick:()=>D("verified"),className:"flex items-center gap-1",children:[f.jsx(Ao,{className:"h-3 w-3"}),"Verified"]})]})]}),i.length>0?f.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:i.map(pt=>ct(pt))}):f.jsxs("div",{className:"text-center py-12",children:[f.jsx("div",{className:"bg-gray-100 p-8 rounded-lg inline-block mb-4",children:f.jsx(_w,{className:"h-12 w-12 text-gray-400 mx-auto"})}),f.jsx("h3",{className:"text-xl font-medium mb-2",children:"No listings found"}),f.jsx("p",{className:"text-gray-600 mb-6",children:"Try adjusting your search criteria or check back later for new listings"}),f.jsx(Kt,{onClick:()=>{y(""),s("All Universities"),D("all"),le(void 0),he(void 0),a(e)},children:"Reset Filters"})]})]})}),f.jsx(_i,{})]})},Yse=()=>f.jsxs("div",{className:"min-h-screen flex flex-col",children:[f.jsx(gi,{}),f.jsxs("main",{className:"flex-grow",children:[f.jsx("section",{className:"bg-swap-blue py-20",children:f.jsxs("div",{className:"max-w-7xl mx-auto px-4 md:px-8 text-center",children:[f.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-white mb-6",children:"Our Mission"}),f.jsx("p",{className:"text-xl text-white/90 max-w-3xl mx-auto mb-8",children:"SwapSpot connects university students worldwide for safe, affordable accommodation exchanges during study abroad semesters."})]})}),f.jsx("section",{className:"py-16 bg-white",children:f.jsx("div",{className:"max-w-7xl mx-auto px-4 md:px-8",children:f.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-12",children:[f.jsxs("div",{className:"w-full md:w-1/2",children:[f.jsx("h2",{className:"text-3xl font-bold mb-6",children:"Our Story"}),f.jsx("p",{className:"text-lg text-gray-700 mb-4",children:"SwapSpot was born from a simple realization: every semester, thousands of university students travel abroad for exchange programs, while their rooms sit empty at home."}),f.jsx("p",{className:"text-lg text-gray-700 mb-4",children:"Founded by a group of former exchange students who experienced the housing struggle firsthand, we created SwapSpot to solve this problem through a safe, university-verified home exchange platform."}),f.jsx("p",{className:"text-lg text-gray-700",children:"Our platform ensures that students can find affordable accommodations while studying abroad, making international education more accessible to all."})]}),f.jsxs("div",{className:"w-full md:w-1/2 bg-gray-100 rounded-lg p-8",children:[f.jsx("blockquote",{className:"text-gray-700 italic",children:`"During my exchange semester, finding affordable housing was the biggest challenge. I kept thinking how perfect it would be if I could just swap with another student going to my home university. That's when the idea for SwapSpot began to take shape."`}),f.jsx("p",{className:"mt-4 font-medium",children:"— Mael Moulin Fournier, Co-founder"})]})]})})}),f.jsx("section",{className:"py-16 bg-gray-50",children:f.jsxs("div",{className:"max-w-7xl mx-auto px-4 md:px-8",children:[f.jsxs("div",{className:"text-center mb-12",children:[f.jsx("h2",{className:"text-3xl font-bold mb-4",children:"Our Values"}),f.jsx("p",{className:"text-xl text-gray-600 max-w-2xl mx-auto",children:"The principles that guide everything we do at SwapSpot"})]}),f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[f.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-sm",children:[f.jsx("div",{className:"bg-swap-lightBlue p-3 rounded-full w-fit mb-4",children:f.jsx(Ao,{className:"h-6 w-6 text-swap-blue"})}),f.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Safety First"}),f.jsx("p",{className:"text-gray-600",children:"We verify all users through their university email addresses and provide tools to help students make informed decisions about their swaps."})]}),f.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-sm",children:[f.jsx("div",{className:"bg-swap-lightBlue p-3 rounded-full w-fit mb-4",children:f.jsx(tv,{className:"h-6 w-6 text-swap-blue"})}),f.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Accessible Education"}),f.jsx("p",{className:"text-gray-600",children:"We believe that financial constraints shouldn't prevent students from experiencing international education opportunities."})]}),f.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-sm",children:[f.jsx("div",{className:"bg-swap-lightBlue p-3 rounded-full w-fit mb-4",children:f.jsx(Qo,{className:"h-6 w-6 text-swap-blue"})}),f.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Community"}),f.jsx("p",{className:"text-gray-600",children:"Beyond just accommodation, SwapSpot helps build connections between students worldwide, fostering a global community of learners."})]})]})]})}),f.jsx("section",{className:"py-16 bg-white",children:f.jsxs("div",{className:"max-w-7xl mx-auto px-4 md:px-8",children:[f.jsxs("div",{className:"text-center mb-12",children:[f.jsx("h2",{className:"text-3xl font-bold mb-4",children:"Frequently Asked Questions"}),f.jsx("p",{className:"text-xl text-gray-600 max-w-2xl mx-auto",children:"Everything you need to know about using SwapSpot"})]}),f.jsxs("div",{className:"max-w-3xl mx-auto",children:[f.jsxs("div",{className:"mb-6",children:[f.jsx("h3",{className:"text-xl font-semibold mb-2",children:"How does SwapSpot verify users?"}),f.jsx("p",{className:"text-gray-600",children:"We verify all users through their university email addresses. This ensures that everyone on our platform is a current student at an accredited university."})]}),f.jsxs("div",{className:"mb-6",children:[f.jsx("h3",{className:"text-xl font-semibold mb-2",children:"What if I don't find a direct swap match?"}),f.jsx("p",{className:"text-gray-600",children:"SwapSpot allows for both direct swaps and network swaps. This means you can participate in a chain of exchanges if a direct match isn't available for your specific cities and dates."})]}),f.jsxs("div",{className:"mb-6",children:[f.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Is there a fee to use SwapSpot?"}),f.jsx("p",{className:"text-gray-600",children:"Basic matching and communication features are free. Premium features like verified profile badges, priority matching, and virtual tours will be available with a premium subscription in the future."})]}),f.jsxs("div",{className:"mb-6",children:[f.jsx("h3",{className:"text-xl font-semibold mb-2",children:"How are conflicts resolved?"}),f.jsx("p",{className:"text-gray-600",children:"SwapSpot provides a mediation service for any issues that may arise during the swap. We also encourage users to create clear agreements about accommodation rules and expectations before finalizing a swap."})]}),f.jsxs("div",{children:[f.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Can I list my accommodation if I don't need a swap?"}),f.jsx("p",{className:"text-gray-600",children:"Currently, SwapSpot focuses on exchanges. However, we're exploring options to allow one-way listings for students who want to offer their accommodation without requiring a swap in return."})]})]})]})}),f.jsx("section",{className:"py-16 bg-gray-50",children:f.jsxs("div",{className:"max-w-7xl mx-auto px-4 md:px-8",children:[f.jsxs("div",{className:"text-center mb-12",children:[f.jsx("h2",{className:"text-3xl font-bold mb-4",children:"Meet Our Team"}),f.jsx("p",{className:"text-xl text-gray-600 max-w-2xl mx-auto",children:"The passionate people behind SwapSpot"})]}),f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 max-w-2xl mx-auto",children:[f.jsxs("div",{className:"text-center p-6 bg-white rounded-lg shadow-sm",children:[f.jsx("h3",{className:"text-xl font-semibold mt-4",children:"Mael Moulin Fournier"}),f.jsx("p",{className:"text-gray-600",children:"Co-founder & CEO"})]}),f.jsxs("div",{className:"text-center p-6 bg-white rounded-lg shadow-sm",children:[f.jsx("h3",{className:"text-xl font-semibold mt-4",children:"Daniel Puri"}),f.jsx("p",{className:"text-gray-600",children:"Co-founder & CTO"})]})]})]})}),f.jsx("section",{className:"py-16 bg-swap-blue",children:f.jsxs("div",{className:"max-w-7xl mx-auto px-4 md:px-8 text-center",children:[f.jsx("h2",{className:"text-3xl font-bold text-white mb-6",children:"Ready to Join the SwapSpot Community?"}),f.jsx("p",{className:"text-xl text-white/90 max-w-2xl mx-auto mb-8",children:"Sign up with your university email and start finding your perfect accommodation swap today."}),f.jsx(Kt,{asChild:!0,size:"lg",className:"text-lg px-8 py-6 bg-white text-swap-blue hover:bg-gray-100",children:f.jsx(un,{to:"/signup",children:"Sign Up with University Email"})})]})})]}),f.jsx(_i,{})]});function Xse({room:e,className:t}){const[i,a]=H.useState(0),d=y=>({WiFi:f.jsx(OW,{className:"h-4 w-4"}),Parking:f.jsx(uW,{className:"h-4 w-4"}),Kitchen:f.jsx(LW,{className:"h-4 w-4"}),TV:f.jsx(DW,{className:"h-4 w-4"}),"Air Conditioning":f.jsx(zW,{className:"h-4 w-4"}),Heating:f.jsx(_W,{className:"h-4 w-4"}),Electricity:f.jsx(XA,{className:"h-4 w-4"}),Furnished:f.jsx(Xm,{className:"h-4 w-4"})})[y]||f.jsx(Xm,{className:"h-4 w-4"});return f.jsxs("div",{className:t,children:[f.jsx(Zr,{className:"mb-6",children:f.jsxs(Kr,{className:"p-0",children:[f.jsxs("div",{className:"relative aspect-video",children:[f.jsx("img",{src:e.images[i],alt:`${e.title} - Image ${i+1}`,className:"w-full h-full object-cover rounded-t-lg",onError:y=>{console.log(`Failed to load main image: ${e.images[i]}`),y.currentTarget.src="https://images.unsplash.com/photo-1615874955480-11278309c194?ixlib=rb-4.0.3&w=1000&q=80"}}),f.jsx("div",{className:"absolute top-4 right-4",children:f.jsxs(wn,{variant:"secondary",className:"bg-black/70 text-white",children:[i+1," / ",e.images.length]})})]}),f.jsx("div",{className:"p-4",children:f.jsx("div",{className:"flex overflow-x-auto gap-2 pb-2",children:e.images.map((y,S)=>f.jsx("button",{onClick:()=>a(S),className:`relative w-20 h-20 flex-shrink-0 rounded-md overflow-hidden border-2 transition-all ${S===i?"border-swap-blue":"border-gray-200 hover:border-gray-300"}`,children:f.jsx("img",{src:y,alt:`Thumbnail ${S+1}`,className:"w-full h-full object-cover",onError:s=>{console.log(`Failed to load thumbnail: ${y}`),s.currentTarget.src="https://images.unsplash.com/photo-1615874955480-11278309c194?ixlib=rb-4.0.3&w=200&q=80"}})},S))})})]})}),f.jsxs(Zr,{className:"mb-6",children:[f.jsx(zn,{children:f.jsxs(Fn,{className:"flex items-center justify-between",children:[f.jsx("span",{children:e.title}),f.jsx(wn,{variant:"outline",children:e.type})]})}),f.jsxs(Kr,{children:[f.jsx("p",{className:"text-gray-700 mb-4",children:e.description}),f.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 mb-4",children:[f.jsx("h4",{className:"font-medium mb-2",children:"Location"}),f.jsx("p",{className:"text-sm text-gray-600 mb-2",children:e.location.neighborhood}),f.jsxs("div",{className:"space-y-2",children:[f.jsxs("div",{children:[f.jsx("span",{className:"text-xs font-medium text-gray-500",children:"Transportation:"}),f.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:e.location.transportation.map((y,S)=>f.jsx(wn,{variant:"outline",className:"text-xs",children:y},S))})]}),f.jsxs("div",{children:[f.jsx("span",{className:"text-xs font-medium text-gray-500",children:"Nearby Universities:"}),f.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:e.location.nearbyUniversities.map((y,S)=>f.jsx(wn,{variant:"secondary",className:"text-xs bg-swap-lightBlue text-swap-darkBlue",children:y},S))})]})]})]})]})]}),(e.pricing.monthlyRent||e.pricing.utilities)&&f.jsxs(Zr,{className:"mb-6",children:[f.jsx(zn,{children:f.jsxs(Fn,{className:"flex items-center gap-2",children:[f.jsx(xg,{className:"h-5 w-5 text-swap-blue"}),"Pricing Information"]})}),f.jsxs(Kr,{children:[f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.pricing.monthlyRent&&f.jsxs("div",{children:[f.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Monthly Rent"}),f.jsx("p",{className:"text-lg font-semibold",children:e.pricing.monthlyRent})]}),e.pricing.utilities&&f.jsxs("div",{children:[f.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Utilities"}),f.jsx("p",{className:"text-lg font-semibold",children:e.pricing.utilities})]}),e.pricing.deposit&&f.jsxs("div",{children:[f.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Deposit"}),f.jsx("p",{className:"text-lg font-semibold",children:e.pricing.deposit})]})]}),e.pricing.notes&&f.jsx("p",{className:"text-sm text-gray-600 mt-3 italic",children:e.pricing.notes})]})]}),f.jsxs(Zr,{className:"mb-6",children:[f.jsx(zn,{children:f.jsx(Fn,{children:"Amenities"})}),f.jsx(Kr,{children:f.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:e.amenities.map((y,S)=>f.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[f.jsx("div",{className:"text-swap-blue",children:d(y)}),f.jsx("span",{children:y})]},S))})})]}),f.jsxs(Zr,{children:[f.jsx(zn,{children:f.jsx(Fn,{children:"House Rules"})}),f.jsx(Kr,{children:f.jsxs("div",{className:"space-y-3",children:[f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx(fW,{className:"h-4 w-4 text-gray-500"}),f.jsx("span",{className:"text-sm",children:"Smoking"})]}),f.jsxs("div",{className:"flex items-center gap-1",children:[e.houseRules.smoking?f.jsx(Co,{className:"h-4 w-4 text-green-600"}):f.jsx(wc,{className:"h-4 w-4 text-red-600"}),f.jsx("span",{className:"text-sm",children:e.houseRules.smoking?"Allowed":"Not allowed"})]})]}),f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx(CW,{className:"h-4 w-4 text-gray-500"}),f.jsx("span",{className:"text-sm",children:"Pets"})]}),f.jsxs("div",{className:"flex items-center gap-1",children:[e.houseRules.pets?f.jsx(Co,{className:"h-4 w-4 text-green-600"}):f.jsx(wc,{className:"h-4 w-4 text-red-600"}),f.jsx("span",{className:"text-sm",children:e.houseRules.pets?"Allowed":"Not allowed"})]})]}),f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx(Xm,{className:"h-4 w-4 text-gray-500"}),f.jsx("span",{className:"text-sm",children:"Guests"})]}),f.jsxs("div",{className:"flex items-center gap-1",children:[e.houseRules.guests?f.jsx(Co,{className:"h-4 w-4 text-green-600"}):f.jsx(wc,{className:"h-4 w-4 text-red-600"}),f.jsx("span",{className:"text-sm",children:e.houseRules.guests?"Allowed":"Not allowed"})]})]}),e.houseRules.quietHours&&f.jsxs("div",{className:"border-t pt-3 mt-3",children:[f.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Quiet Hours:"}),f.jsx("p",{className:"text-sm text-gray-700",children:e.houseRules.quietHours})]}),e.houseRules.cleaningSchedule&&f.jsxs("div",{className:"border-t pt-3 mt-3",children:[f.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Cleaning Schedule:"}),f.jsx("p",{className:"text-sm text-gray-700",children:e.houseRules.cleaningSchedule})]})]})})]})]})}const Kse=({listingId:e,variant:t="outline",className:i=""})=>{const[a,d]=H.useState(!1),{toast:y}=Ov(),S=()=>{a?(d(!1),y({title:"Removed from Favorites",description:"This listing has been removed from your favorites."})):(d(!0),y({title:"Added to Favorites",description:"This listing has been added to your favorites."}))};return f.jsx(Kt,{variant:t,className:`${a?"bg-opacity-50 text-red-600 border-red-200":""} ${i}`,onClick:S,children:a?f.jsxs(f.Fragment,{children:[f.jsx(Rf,{className:"h-4 w-4 mr-2 text-red-500 fill-red-500"}),"Saved to Favorites"]}):f.jsxs(f.Fragment,{children:[f.jsx(Rf,{className:"h-4 w-4 mr-2"}),"Save to Favorites"]})})};var Jse="Label",C6=H.forwardRef((e,t)=>f.jsx(wr.label,{...e,ref:t,onMouseDown:i=>{var d;i.target.closest("button, input, select, textarea")||((d=e.onMouseDown)==null||d.call(e,i),!i.defaultPrevented&&i.detail>1&&i.preventDefault())}}));C6.displayName=Jse;var M6=C6;const Qse=Og("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),rs=H.forwardRef(({className:e,...t},i)=>f.jsx(M6,{ref:i,className:br(Qse(),e),...t}));rs.displayName=M6.displayName;var QP="Dialog",[A6,Rce]=ta(QP),[eoe,Gl]=A6(QP),P6=e=>{const{__scopeDialog:t,children:i,open:a,defaultOpen:d,onOpenChange:y,modal:S=!0}=e,s=H.useRef(null),N=H.useRef(null),[D=!1,O]=Xa({prop:a,defaultProp:d,onChange:y});return f.jsx(eoe,{scope:t,triggerRef:s,contentRef:N,contentId:ba(),titleId:ba(),descriptionId:ba(),open:D,onOpenChange:O,onOpenToggle:H.useCallback(()=>O($=>!$),[O]),modal:S,children:i})};P6.displayName=QP;var I6="DialogTrigger",k6=H.forwardRef((e,t)=>{const{__scopeDialog:i,...a}=e,d=Gl(I6,i),y=dn(t,d.triggerRef);return f.jsx(wr.button,{type:"button","aria-haspopup":"dialog","aria-expanded":d.open,"aria-controls":d.contentId,"data-state":rI(d.open),...a,ref:y,onClick:Ht(e.onClick,d.onOpenToggle)})});k6.displayName=I6;var eI="DialogPortal",[toe,N6]=A6(eI,{forceMount:void 0}),R6=e=>{const{__scopeDialog:t,forceMount:i,children:a,container:d}=e,y=Gl(eI,t);return f.jsx(toe,{scope:t,forceMount:i,children:H.Children.map(a,S=>f.jsx(Yi,{present:i||y.open,children:f.jsx(Lg,{asChild:!0,container:d,children:S})}))})};R6.displayName=eI;var Dw="DialogOverlay",j6=H.forwardRef((e,t)=>{const i=N6(Dw,e.__scopeDialog),{forceMount:a=i.forceMount,...d}=e,y=Gl(Dw,e.__scopeDialog);return y.modal?f.jsx(Yi,{present:a||y.open,children:f.jsx(roe,{...d,ref:t})}):null});j6.displayName=Dw;var roe=H.forwardRef((e,t)=>{const{__scopeDialog:i,...a}=e,d=Gl(Dw,i);return f.jsx(Gv,{as:Tc,allowPinchZoom:!0,shards:[d.contentRef],children:f.jsx(wr.div,{"data-state":rI(d.open),...a,ref:t,style:{pointerEvents:"auto",...a.style}})})}),qf="DialogContent",D6=H.forwardRef((e,t)=>{const i=N6(qf,e.__scopeDialog),{forceMount:a=i.forceMount,...d}=e,y=Gl(qf,e.__scopeDialog);return f.jsx(Yi,{present:a||y.open,children:y.modal?f.jsx(noe,{...d,ref:t}):f.jsx(ioe,{...d,ref:t})})});D6.displayName=qf;var noe=H.forwardRef((e,t)=>{const i=Gl(qf,e.__scopeDialog),a=H.useRef(null),d=dn(t,i.contentRef,a);return H.useEffect(()=>{const y=a.current;if(y)return A2(y)},[]),f.jsx(L6,{...e,ref:d,trapFocus:i.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Ht(e.onCloseAutoFocus,y=>{var S;y.preventDefault(),(S=i.triggerRef.current)==null||S.focus()}),onPointerDownOutside:Ht(e.onPointerDownOutside,y=>{const S=y.detail.originalEvent,s=S.button===0&&S.ctrlKey===!0;(S.button===2||s)&&y.preventDefault()}),onFocusOutside:Ht(e.onFocusOutside,y=>y.preventDefault())})}),ioe=H.forwardRef((e,t)=>{const i=Gl(qf,e.__scopeDialog),a=H.useRef(!1),d=H.useRef(!1);return f.jsx(L6,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:y=>{var S,s;(S=e.onCloseAutoFocus)==null||S.call(e,y),y.defaultPrevented||(a.current||(s=i.triggerRef.current)==null||s.focus(),y.preventDefault()),a.current=!1,d.current=!1},onInteractOutside:y=>{var N,D;(N=e.onInteractOutside)==null||N.call(e,y),y.defaultPrevented||(a.current=!0,y.detail.originalEvent.type==="pointerdown"&&(d.current=!0));const S=y.target;((D=i.triggerRef.current)==null?void 0:D.contains(S))&&y.preventDefault(),y.detail.originalEvent.type==="focusin"&&d.current&&y.preventDefault()}})}),L6=H.forwardRef((e,t)=>{const{__scopeDialog:i,trapFocus:a,onOpenAutoFocus:d,onCloseAutoFocus:y,...S}=e,s=Gl(qf,i),N=H.useRef(null),D=dn(t,N);return C2(),f.jsxs(f.Fragment,{children:[f.jsx($v,{asChild:!0,loop:!0,trapped:a,onMountAutoFocus:d,onUnmountAutoFocus:y,children:f.jsx(mh,{role:"dialog",id:s.contentId,"aria-describedby":s.descriptionId,"aria-labelledby":s.titleId,"data-state":rI(s.open),...S,ref:D,onDismiss:()=>s.onOpenChange(!1)})}),f.jsxs(f.Fragment,{children:[f.jsx(soe,{titleId:s.titleId}),f.jsx(aoe,{contentRef:N,descriptionId:s.descriptionId})]})]})}),tI="DialogTitle",O6=H.forwardRef((e,t)=>{const{__scopeDialog:i,...a}=e,d=Gl(tI,i);return f.jsx(wr.h2,{id:d.titleId,...a,ref:t})});O6.displayName=tI;var z6="DialogDescription",F6=H.forwardRef((e,t)=>{const{__scopeDialog:i,...a}=e,d=Gl(z6,i);return f.jsx(wr.p,{id:d.descriptionId,...a,ref:t})});F6.displayName=z6;var B6="DialogClose",V6=H.forwardRef((e,t)=>{const{__scopeDialog:i,...a}=e,d=Gl(B6,i);return f.jsx(wr.button,{type:"button",...a,ref:t,onClick:Ht(e.onClick,()=>d.onOpenChange(!1))})});V6.displayName=B6;function rI(e){return e?"open":"closed"}var U6="DialogTitleWarning",[jce,$6]=xH(U6,{contentName:qf,titleName:tI,docsSlug:"dialog"}),soe=({titleId:e})=>{const t=$6(U6),i=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return H.useEffect(()=>{e&&(document.getElementById(e)||console.error(i))},[i,e]),null},ooe="DialogDescriptionWarning",aoe=({contentRef:e,descriptionId:t})=>{const a=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${$6(ooe).contentName}}.`;return H.useEffect(()=>{var y;const d=(y=e.current)==null?void 0:y.getAttribute("aria-describedby");t&&d&&(document.getElementById(t)||console.warn(a))},[a,e,t]),null},loe=P6,coe=k6,uoe=R6,G6=j6,q6=D6,H6=O6,W6=F6,doe=V6;const Wg=loe,t0=coe,hoe=uoe,Z6=H.forwardRef(({className:e,...t},i)=>f.jsx(G6,{ref:i,className:br("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t}));Z6.displayName=G6.displayName;const np=H.forwardRef(({className:e,children:t,...i},a)=>f.jsxs(hoe,{children:[f.jsx(Z6,{}),f.jsxs(q6,{ref:a,className:br("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...i,children:[t,f.jsxs(doe,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[f.jsx(wc,{className:"h-4 w-4"}),f.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));np.displayName=q6.displayName;const ip=({className:e,...t})=>f.jsx("div",{className:br("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});ip.displayName="DialogHeader";const nI=({className:e,...t})=>f.jsx("div",{className:br("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});nI.displayName="DialogFooter";const sp=H.forwardRef(({className:e,...t},i)=>f.jsx(H6,{ref:i,className:br("text-lg font-semibold leading-none tracking-tight",e),...t}));sp.displayName=H6.displayName;const q2=H.forwardRef(({className:e,...t},i)=>f.jsx(W6,{ref:i,className:br("text-sm text-muted-foreground",e),...t}));q2.displayName=W6.displayName;var foe="Separator",DD="horizontal",poe=["horizontal","vertical"],Y6=H.forwardRef((e,t)=>{const{decorative:i,orientation:a=DD,...d}=e,y=moe(a)?a:DD,s=i?{role:"none"}:{"aria-orientation":y==="vertical"?y:void 0,role:"separator"};return f.jsx(wr.div,{"data-orientation":y,...s,...d,ref:t})});Y6.displayName=foe;function moe(e){return poe.includes(e)}var X6=Y6;const qb=H.forwardRef(({className:e,orientation:t="horizontal",decorative:i=!0,...a},d)=>f.jsx(X6,{ref:d,decorative:i,orientation:t,className:br("shrink-0 bg-border",t==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",e),...a}));qb.displayName=X6.displayName;function goe({recipientName:e="",listingTitle:t="",listingLocation:i="",listingDates:a,userDates:d,buttonVariant:y="default",className:S}){const{toast:s}=Ov(),[N,D]=H.useState({party1Name:"",party1Email:"",party1Phone:"",party1Address:"",party2Name:e,party2Email:"",party2Phone:"",party2Address:i,swapStartDate:(d==null?void 0:d.startDate)||"",swapEndDate:(d==null?void 0:d.endDate)||"",deposit:"",emergencyContact1:"",emergencyContact2:"",additionalTerms:""}),O=(q,J)=>{D(re=>({...re,[q]:J}))},$=()=>{const q=`
STUDENT SWAP AGREEMENT

This Student Swap Agreement ("Agreement") is entered into on ${new Date().toLocaleDateString()} between:

PARTY 1: ${N.party1Name}
Email: ${N.party1Email}
Phone: ${N.party1Phone}
Current Address: ${N.party1Address}

PARTY 2: ${N.party2Name}
Email: ${N.party2Email}
Phone: ${N.party2Phone}
Current Address: ${N.party2Address}

SWAP DETAILS:
Property 1: ${N.party1Address}
Property 2: ${N.party2Address}
Swap Period: ${new Date(N.swapStartDate).toLocaleDateString()} to ${new Date(N.swapEndDate).toLocaleDateString()}
Security Deposit: $${N.deposit} (if applicable)

TERMS AND CONDITIONS:

1. PROPERTY CONDITION
Both parties agree to maintain the exchanged property in the same condition as received, normal wear and tear excepted.

2. UTILITIES AND EXPENSES
Each party is responsible for utilities and ongoing expenses during their stay unless otherwise agreed.

3. SECURITY DEPOSIT
${N.deposit?`A security deposit of $${N.deposit} will be held and returned within 14 days after the swap period ends, provided no damage has occurred.`:"No security deposit has been agreed upon."}

4. CANCELLATION
Either party may cancel this agreement with at least 30 days written notice. Emergency cancellations will be handled on a case-by-case basis.

5. EMERGENCY CONTACTS
Party 1 Emergency Contact: ${N.emergencyContact1}
Party 2 Emergency Contact: ${N.emergencyContact2}

6. LIABILITY
Each party assumes responsibility for their own belongings and actions during the swap period.

7. DISPUTE RESOLUTION
Any disputes will first be addressed through direct communication. If unresolved, parties agree to use SwapSpot's dispute resolution resources.

8. ADDITIONAL TERMS
${N.additionalTerms||"None specified."}

By signing below, both parties agree to the terms outlined in this agreement.

Party 1 Signature: _________________________ Date: _________
${N.party1Name}

Party 2 Signature: _________________________ Date: _________
${N.party2Name}

Generated via SwapSpot on ${new Date().toLocaleString()}
`,J=new Blob([q],{type:"text/plain"}),re=URL.createObjectURL(J),Q=document.createElement("a");Q.href=re,Q.download=`student-swap-agreement-${new Date().toISOString().split("T")[0]}.txt`,document.body.appendChild(Q),Q.click(),document.body.removeChild(Q),URL.revokeObjectURL(re),s({title:"Agreement Generated!",description:"Your Student Swap Agreement has been downloaded. Please review and sign with both parties."})};return f.jsxs(Wg,{children:[f.jsx(t0,{asChild:!0,children:f.jsxs(Kt,{variant:y,className:S,children:[f.jsx(xW,{className:"h-4 w-4 mr-2"}),"Generate Swap Agreement"]})}),f.jsxs(np,{className:"sm:max-w-[600px] max-h-[80vh] overflow-y-auto",children:[f.jsxs(ip,{children:[f.jsxs(sp,{className:"flex items-center gap-2",children:[f.jsx(Ao,{className:"h-5 w-5 text-green-600"}),"Student Swap Agreement Generator"]}),f.jsx(q2,{children:"Create a legal template for your student accommodation swap. Fill in the details below to generate a downloadable agreement."})]}),f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[f.jsx("h3",{className:"font-medium text-blue-800 mb-2",children:"Why use an agreement?"}),f.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[f.jsx("li",{children:"• Protects both parties legally"}),f.jsx("li",{children:"• Clarifies expectations and responsibilities"}),f.jsx("li",{children:"• Provides dispute resolution framework"}),f.jsx("li",{children:"• Documents important contact information"})]})]}),f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{children:[f.jsx("h3",{className:"font-medium mb-3",children:"Your Information (Party 1)"}),f.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[f.jsxs("div",{children:[f.jsx(rs,{htmlFor:"party1Name",children:"Full Name *"}),f.jsx(Pn,{id:"party1Name",value:N.party1Name,onChange:q=>O("party1Name",q.target.value),placeholder:"Your full name",required:!0})]}),f.jsxs("div",{children:[f.jsx(rs,{htmlFor:"party1Email",children:"Email *"}),f.jsx(Pn,{id:"party1Email",type:"email",value:N.party1Email,onChange:q=>O("party1Email",q.target.value),placeholder:"your.email@university.edu",required:!0})]}),f.jsxs("div",{children:[f.jsx(rs,{htmlFor:"party1Phone",children:"Phone Number"}),f.jsx(Pn,{id:"party1Phone",value:N.party1Phone,onChange:q=>O("party1Phone",q.target.value),placeholder:"+1 (555) 123-4567"})]}),f.jsxs("div",{children:[f.jsx(rs,{htmlFor:"party1Address",children:"Your Current Address *"}),f.jsx(Pn,{id:"party1Address",value:N.party1Address,onChange:q=>O("party1Address",q.target.value),placeholder:"123 University St, City, State",required:!0})]})]})]}),f.jsx(qb,{}),f.jsxs("div",{children:[f.jsx("h3",{className:"font-medium mb-3",children:"Other Party Information (Party 2)"}),f.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[f.jsxs("div",{children:[f.jsx(rs,{htmlFor:"party2Name",children:"Full Name *"}),f.jsx(Pn,{id:"party2Name",value:N.party2Name,onChange:q=>O("party2Name",q.target.value),placeholder:"Other party's full name",required:!0})]}),f.jsxs("div",{children:[f.jsx(rs,{htmlFor:"party2Email",children:"Email *"}),f.jsx(Pn,{id:"party2Email",type:"email",value:N.party2Email,onChange:q=>O("party2Email",q.target.value),placeholder:"their.email@university.edu",required:!0})]}),f.jsxs("div",{children:[f.jsx(rs,{htmlFor:"party2Phone",children:"Phone Number"}),f.jsx(Pn,{id:"party2Phone",value:N.party2Phone,onChange:q=>O("party2Phone",q.target.value),placeholder:"+1 (555) 123-4567"})]}),f.jsxs("div",{children:[f.jsx(rs,{htmlFor:"party2Address",children:"Their Current Address *"}),f.jsx(Pn,{id:"party2Address",value:N.party2Address,onChange:q=>O("party2Address",q.target.value),placeholder:"456 College Ave, City, State",required:!0})]})]})]}),f.jsx(qb,{}),f.jsxs("div",{children:[f.jsx("h3",{className:"font-medium mb-3",children:"Swap Details"}),f.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[f.jsxs("div",{children:[f.jsx(rs,{htmlFor:"swapStartDate",children:"Start Date *"}),f.jsx(Pn,{id:"swapStartDate",type:"date",value:N.swapStartDate,onChange:q=>O("swapStartDate",q.target.value),required:!0})]}),f.jsxs("div",{children:[f.jsx(rs,{htmlFor:"swapEndDate",children:"End Date *"}),f.jsx(Pn,{id:"swapEndDate",type:"date",value:N.swapEndDate,onChange:q=>O("swapEndDate",q.target.value),required:!0})]}),f.jsxs("div",{children:[f.jsx(rs,{htmlFor:"deposit",children:"Security Deposit (Optional)"}),f.jsx(Pn,{id:"deposit",type:"number",value:N.deposit,onChange:q=>O("deposit",q.target.value),placeholder:"500"})]})]})]}),f.jsx(qb,{}),f.jsxs("div",{children:[f.jsx("h3",{className:"font-medium mb-3",children:"Emergency Contacts"}),f.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[f.jsxs("div",{children:[f.jsx(rs,{htmlFor:"emergencyContact1",children:"Your Emergency Contact"}),f.jsx(Pn,{id:"emergencyContact1",value:N.emergencyContact1,onChange:q=>O("emergencyContact1",q.target.value),placeholder:"Parent/Guardian Name & Phone"})]}),f.jsxs("div",{children:[f.jsx(rs,{htmlFor:"emergencyContact2",children:"Their Emergency Contact"}),f.jsx(Pn,{id:"emergencyContact2",value:N.emergencyContact2,onChange:q=>O("emergencyContact2",q.target.value),placeholder:"Parent/Guardian Name & Phone"})]})]})]}),f.jsxs("div",{children:[f.jsx(rs,{htmlFor:"additionalTerms",children:"Additional Terms (Optional)"}),f.jsx(Pn,{id:"additionalTerms",value:N.additionalTerms,onChange:q=>O("additionalTerms",q.target.value),placeholder:"Any specific agreements or house rules..."})]})]})]}),f.jsx(nI,{children:f.jsxs(Kt,{onClick:$,className:"w-full",children:[f.jsx(gW,{className:"h-4 w-4 mr-2"}),"Generate & Download Agreement"]})})]})]})}const K6=H.createContext(void 0),H2=()=>{const e=H.useContext(K6);if(e===void 0)throw new Error("useSubscription must be used within a SubscriptionProvider");return e},_oe=({children:e})=>{const[t,i]=H.useState(null),[a,d]=H.useState(!0),[y,S]=H.useState(null),s=async()=>{try{d(!0);const{data:{session:$}}=await Pi.auth.getSession();if(!$){i({subscribed:!1,subscription_tier:"free"}),S(null);return}S($.user);const{data:q,error:J}=await Pi.functions.invoke("check-subscription",{headers:{Authorization:`Bearer ${$.access_token}`}});J?(console.error("Error checking subscription:",J),i({subscribed:!1,subscription_tier:"free"})):i(q)}catch($){console.error("Error refreshing subscription:",$),i({subscribed:!1,subscription_tier:"free"})}finally{d(!1)}};H.useEffect(()=>{s();const{data:{subscription:$}}=Pi.auth.onAuthStateChange((q,J)=>{q==="SIGNED_IN"||q==="TOKEN_REFRESHED"?s():q==="SIGNED_OUT"&&(i({subscribed:!1,subscription_tier:"free"}),S(null),d(!1))});return()=>$.unsubscribe()},[]);const N=(t==null?void 0:t.subscription_tier)==="premium"&&(t==null?void 0:t.subscribed),D=(t==null?void 0:t.subscription_tier)==="basic"&&(t==null?void 0:t.subscribed),O=(t==null?void 0:t.subscription_tier)==="elite"&&(t==null?void 0:t.subscribed);return f.jsx(K6.Provider,{value:{subscriptionData:t,loading:a,refreshSubscription:s,isPremium:N,isBasic:D,isElite:O,user:y},children:e})},yoe=()=>{const[e,t]=H.useState([]);return H.useEffect(()=>{const i=["#FFD700","#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7"],a=Array.from({length:50},(d,y)=>({id:y,x:Math.random()*100,y:-10,color:i[Math.floor(Math.random()*i.length)],delay:Math.random()*3}));t(a)},[]),f.jsx("div",{className:"fixed inset-0 pointer-events-none z-50 overflow-hidden",children:e.map(i=>f.jsx("div",{className:"absolute w-2 h-2 animate-float-up",style:{left:`${i.x}%`,backgroundColor:i.color,animationDelay:`${i.delay}s`,animationDuration:"3s"}},i.id))})};function J6({recipientName:e,listingTitle:t,listingLocation:i,contactInfo:a,buttonVariant:d="default",buttonText:y="View Contact Info",className:S}){const{subscriptionData:s,user:N,loading:D}=H2(),[O,$]=H.useState(!1),[q,J]=H.useState(!1),re=(s==null?void 0:s.subscribed)||!1,Q=async()=>{var le;if(N)try{const{error:ae}=await Pi.functions.invoke("send-match-email",{body:{recipientName:e,listingTitle:t,listingLocation:i,contactInfo:a},headers:{Authorization:`Bearer ${(le=(await Pi.auth.getSession()).data.session)==null?void 0:le.access_token}`}});if(ae){console.error("Error sending match email:",ae),di.error("Failed to send match notification");return}di.success("Match notification sent! Check your email for contact details.")}catch(ae){console.error("Error sending match:",ae),di.error("An error occurred. Please try again.")}},ce=()=>{$(!0),J(!0),setTimeout(()=>{J(!1)},4e3),di.success("🎉 Welcome to SwapSpot! Payment successful!")};return f.jsxs(f.Fragment,{children:[q&&f.jsx(yoe,{}),f.jsxs(Wg,{children:[f.jsx(t0,{asChild:!0,children:f.jsxs(Kt,{variant:d,className:S,children:[f.jsx(Z4,{className:"h-4 w-4 mr-2"}),y]})}),f.jsxs(np,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[f.jsxs(ip,{children:[f.jsxs(sp,{className:"flex items-center gap-2",children:[O&&f.jsx(X4,{className:"h-5 w-5 text-yellow-500"}),re||O?`Connect with ${e}`:"Access Required"]}),f.jsx(q2,{children:re||O?`Send a match request for "${t}" in ${i}`:"You need SwapSpot access to connect with verified students"})]}),f.jsx("div",{className:"space-y-6",children:re||O?f.jsxs("div",{className:"space-y-4",children:[O&&f.jsx(Zr,{className:"border-yellow-200 bg-gradient-to-r from-yellow-50 to-orange-50",children:f.jsx(Kr,{className:"p-4",children:f.jsxs("div",{className:"text-center",children:[f.jsx(gc,{className:"h-12 w-12 text-yellow-600 mx-auto mb-2"}),f.jsx("h3",{className:"text-lg font-bold text-yellow-800 mb-1",children:"Payment Successful! 🎉"}),f.jsx("p",{className:"text-sm text-yellow-700",children:"You now have full access to SwapSpot!"})]})})}),f.jsxs(Zr,{children:[f.jsx(zn,{children:f.jsxs(Fn,{className:"flex items-center gap-2",children:[f.jsx(Vf,{className:"h-5 w-5 text-blue-600"}),"Request Match with ",e]})}),f.jsxs(Kr,{className:"space-y-4",children:[f.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[f.jsx("h4",{className:"font-medium text-blue-800 mb-2",children:"What happens next:"}),f.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[f.jsxs("li",{children:["• You'll receive an email with ",e,"'s contact information"]}),f.jsxs("li",{children:["• ",e," will be notified of your interest"]}),f.jsx("li",{children:"• Both parties can then connect directly"})]})]}),f.jsxs(Kt,{onClick:Q,className:"w-full bg-blue-600 hover:bg-blue-700",disabled:D,children:[f.jsx(Vf,{className:"h-4 w-4 mr-2"}),"Send Match Request"]})]})]})]}):f.jsxs("div",{className:"space-y-6",children:[f.jsx(Zr,{className:"border-red-200 bg-red-50",children:f.jsx(Kr,{className:"p-4",children:f.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[f.jsx(p2,{className:"h-6 w-6 text-red-500"}),f.jsxs("div",{children:[f.jsx("h3",{className:"font-semibold text-red-800",children:"SwapSpot Access Required"}),f.jsx("p",{className:"text-sm text-red-600",children:"Connect with verified students across Europe"})]})]})})}),f.jsxs(Zr,{className:"border-blue-200 bg-gradient-to-br from-blue-50 to-indigo-50",children:[f.jsxs(zn,{className:"text-center pb-4",children:[f.jsx(Fn,{className:"text-xl font-bold text-blue-800",children:"SwapSpot Access"}),f.jsxs("div",{className:"flex items-baseline justify-center gap-1",children:[f.jsx("span",{className:"text-3xl font-bold text-blue-800",children:"€25"}),f.jsx("span",{className:"text-sm text-blue-600",children:"one-time"})]}),f.jsx("p",{className:"text-sm text-blue-700",children:"Lifetime access to all features"})]}),f.jsxs(Kr,{className:"space-y-4",children:[f.jsxs("ul",{className:"space-y-2",children:[f.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[f.jsx(Co,{className:"h-4 w-4 text-green-600 mt-0.5"}),f.jsx("span",{children:"Connect with unlimited verified students"})]}),f.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[f.jsx(Co,{className:"h-4 w-4 text-green-600 mt-0.5"}),f.jsx("span",{children:"Email notifications for all matches"})]}),f.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[f.jsx(Co,{className:"h-4 w-4 text-green-600 mt-0.5"}),f.jsx("span",{children:"Access to all contact information"})]}),f.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[f.jsx(Co,{className:"h-4 w-4 text-green-600 mt-0.5"}),f.jsx("span",{children:"Priority support"})]})]}),f.jsx(Kt,{onClick:ce,className:"w-full bg-blue-600 hover:bg-blue-700 text-white",disabled:D,children:D?"Processing...":"Get SwapSpot Access"})]})]}),f.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center text-xs",children:[f.jsxs("div",{className:"flex flex-col items-center gap-1",children:[f.jsx(Ao,{className:"h-6 w-6 text-green-600"}),f.jsx("span",{className:"font-medium",children:"Verified Students"})]}),f.jsxs("div",{className:"flex flex-col items-center gap-1",children:[f.jsx(Qo,{className:"h-6 w-6 text-blue-600"}),f.jsx("span",{className:"font-medium",children:"10,000+ Members"})]}),f.jsxs("div",{className:"flex flex-col items-center gap-1",children:[f.jsx(Dl,{className:"h-6 w-6 text-yellow-600"}),f.jsx("span",{className:"font-medium",children:"4.8/5 Rating"})]})]}),f.jsx("p",{className:"text-xs text-center text-gray-500",children:"Secure payment • Money-back guarantee • One-time payment"})]})})]})]})]})}const xoe=()=>{const{id:e}=fP();H.useEffect(()=>{window.scrollTo(0,0)},[]);const t={id:e||"1",host:{id:"1",name:"John Doe",avatar:"https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=150&h=150&fit=crop&crop=face",university:"University of Example",studyProgram:"Computer Science",yearOfStudy:"3rd Year",currentLocation:"New York, USA",languages:["English","Spanish"],interests:["Photography","Music","Travel"],about:"Hi, I'm John! I'm looking for a place to stay during my exchange program.",isVerified:!0,verificationMethod:"University ID",backgroundCheckVerified:!0},room:{id:"101",title:"Cozy Studio Apartment",type:"Studio",images:["https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?ixlib=rb-4.0.3&w=800&q=80","https://images.unsplash.com/photo-1586023492125-27b2c045efd7?ixlib=rb-4.0.3&w=800&q=80","https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?ixlib=rb-4.0.3&w=800&q=80","https://images.unsplash.com/photo-1484154218962-a197022b5858?ixlib=rb-4.0.3&w=800&q=80"],pricing:{monthlyRent:"$1200",utilities:"$100",deposit:"$600",notes:"Negotiable, depending on the length of stay."},amenities:["WiFi","Kitchen","TV","Air Conditioning"],houseRules:{smoking:!1,pets:!1,guests:!0,quietHours:"10 PM - 7 AM",cleaningSchedule:"Weekly cleaning provided"},description:"A comfortable studio apartment perfect for students. Close to campus and public transportation.",location:{neighborhood:"Downtown",transportation:["Bus","Train","Subway"],nearbyUniversities:["University of Example","College of Arts"]}},location:{city:"New York",country:"USA"},dates:{startDate:"2024-09-01",endDate:"2024-12-31"},stats:{views:1234,saves:123,shares:12},safety:{rating:4.5,reviews:50,tips:["Always lock the door.","Be aware of your surroundings.","Don't walk alone at night."]}};return f.jsxs("div",{className:"min-h-screen flex flex-col bg-gray-50",children:[f.jsx(gi,{}),f.jsx("main",{className:"flex-grow",children:f.jsx("div",{className:"container mx-auto px-4 py-6 max-w-6xl",children:f.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[f.jsx("div",{className:"lg:col-span-2",children:f.jsx(Xse,{room:t.room})}),f.jsxs("div",{className:"lg:col-span-1 space-y-4",children:[f.jsx(Zr,{className:"sticky top-4",children:f.jsxs(Kr,{className:"p-6",children:[f.jsxs("div",{className:"text-center mb-4",children:[f.jsx("div",{className:"text-3xl font-bold text-swap-blue mb-1",children:t.room.pricing.monthlyRent}),f.jsx("div",{className:"text-sm text-gray-600",children:"per month"})]}),f.jsxs("div",{className:"space-y-3 mb-6",children:[f.jsxs("div",{className:"flex items-center justify-between text-sm",children:[f.jsx("span",{className:"text-gray-600",children:"Location"}),f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx(Ec,{className:"h-4 w-4 text-gray-400"}),f.jsx("span",{className:"font-medium",children:t.location.city})]})]}),f.jsxs("div",{className:"flex items-center justify-between text-sm",children:[f.jsx("span",{className:"text-gray-600",children:"Duration"}),f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx(nh,{className:"h-4 w-4 text-gray-400"}),f.jsx("span",{className:"font-medium",children:"4 months"})]})]}),f.jsxs("div",{className:"flex items-center justify-between text-sm",children:[f.jsx("span",{className:"text-gray-600",children:"Room Type"}),f.jsx(wn,{variant:"outline",children:t.room.type})]})]}),f.jsxs("div",{className:"space-y-3",children:[f.jsx(J6,{recipientName:t.host.name,listingTitle:t.room.title,listingLocation:`${t.location.city}, ${t.location.country}`,contactInfo:{instagram:"john_exchange",whatsapp:"+1 555 123 4567",snapchat:"johndoe_snap",email:"john@university-example.edu"},buttonVariant:"default",buttonText:"View Contact Info",className:"w-full bg-swap-blue hover:bg-swap-darkBlue text-lg py-3"}),f.jsx(goe,{recipientName:t.host.name,listingTitle:t.room.title,listingLocation:`${t.location.city}, ${t.location.country}`,listingDates:{startDate:t.dates.startDate,endDate:t.dates.endDate},userDates:{startDate:"2025-09-01",endDate:"2025-12-15"},buttonVariant:"outline",className:"w-full"}),f.jsx(Kse,{listingId:t.id,variant:"ghost",className:"w-full"})]})]})}),f.jsx(Zr,{children:f.jsxs(Kr,{className:"p-4",children:[f.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[f.jsx("img",{src:t.host.avatar,alt:t.host.name,className:"w-12 h-12 rounded-full object-cover border-2 border-swap-blue",onError:i=>{console.log(`Failed to load student avatar: ${t.host.avatar}`),i.currentTarget.src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=150&h=150&fit=crop&crop=face"}}),f.jsxs("div",{className:"flex-1",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[f.jsx("h3",{className:"font-semibold",children:t.host.name}),f.jsx(Ao,{className:"h-4 w-4 text-green-600"})]}),f.jsx("p",{className:"text-sm text-gray-600",children:t.host.studyProgram}),f.jsx("p",{className:"text-xs text-gray-500",children:t.host.university})]})]}),f.jsx("p",{className:"text-sm text-gray-700 mb-3",children:t.host.about}),f.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:t.host.languages.map((i,a)=>f.jsx(wn,{variant:"secondary",className:"text-xs",children:i},a))}),f.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx(Qo,{className:"h-3 w-3"}),f.jsxs("span",{children:[t.stats.views," views"]})]}),f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx(Dl,{className:"h-3 w-3"}),f.jsx("span",{children:"Student Verified"})]})]})]})}),f.jsx(Zr,{className:"bg-blue-50 border-blue-200",children:f.jsx(Kr,{className:"p-4",children:f.jsx("p",{className:"text-sm text-blue-800 text-center",children:"Connect with a verified student who understands your exchange experience"})})})]})]})})}),f.jsx(_i,{})]})},voe=({image:e,title:t})=>f.jsx("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden mb-8",children:f.jsx("div",{className:"relative aspect-video",children:f.jsx("img",{src:e,alt:t,className:"w-full h-full object-cover"})})}),boe=({familyDescription:e,tags:t})=>f.jsxs(f.Fragment,{children:[f.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-8",children:[f.jsx("h2",{className:"text-xl font-semibold mb-4",children:"About the Family"}),f.jsx("p",{className:"text-gray-700",children:e})]}),f.jsxs("div",{className:"mb-8",children:[f.jsx("h3",{className:"text-lg font-medium mb-3",children:"Features"}),f.jsx("div",{className:"flex flex-wrap gap-2",children:t.map((i,a)=>f.jsx(wn,{variant:"secondary",className:"bg-gray-100 text-gray-800 py-1.5 px-3 text-sm",children:i},a))})]})]}),woe=({title:e,benefits:t,description:i})=>f.jsxs("div",{className:"bg-purple-50 rounded-lg p-6",children:[f.jsx("h2",{className:"text-xl font-semibold mb-4",children:"ACCOMMODATION OFFERED"}),f.jsxs("div",{className:"mb-3",children:[f.jsx("p",{className:"font-medium text-lg mb-2",children:e}),f.jsx("p",{className:"text-gray-700 mb-4",children:t}),f.jsx("p",{className:"text-gray-700",children:i})]})]}),Soe=({hours:e,tasks:t,language:i,additional:a})=>f.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[f.jsx("h2",{className:"text-xl font-semibold mb-4",children:"REQUIREMENTS"}),f.jsxs("div",{className:"mb-3",children:[f.jsxs("p",{className:"text-gray-700",children:[f.jsx("span",{className:"font-medium",children:"Hours:"})," ",e]}),f.jsxs("p",{className:"text-gray-700 mt-2",children:[f.jsx("span",{className:"font-medium",children:"Tasks:"})," ",t]}),f.jsxs("p",{className:"text-gray-700 mt-2",children:[f.jsx("span",{className:"font-medium",children:"Language:"})," ",i]}),f.jsx("p",{className:"text-gray-700 mt-4",children:a})]})]});var Q6={exports:{}};(function(e,t){(function(i,a){e.exports=a()})(Ta,function(){var i,a,d;function y(s,N){if(!i)i=N;else if(!a)a=N;else{var D="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+i+")(sharedChunk); ("+a+")(sharedChunk); self.onerror = null;",O={};i(O),d=N(O),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(d.workerUrl=window.URL.createObjectURL(new Blob([D],{type:"text/javascript"})))}}y(["exports"],function(s){function N(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var D,O={},$={};function q(){if(D)return $;D=1,Object.defineProperty($,"__esModule",{value:!0}),$.setMatrixArrayType=function(p){$.ARRAY_TYPE=r=p},$.toRadian=function(p){return p*u},$.equals=function(p,h){return Math.abs(p-h)<=c*Math.max(1,Math.abs(p),Math.abs(h))},$.RANDOM=$.ARRAY_TYPE=$.EPSILON=void 0;var c=1e-6;$.EPSILON=c;var r=typeof Float32Array<"u"?Float32Array:Array;$.ARRAY_TYPE=r;var o=Math.random;$.RANDOM=o;var u=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var p=0,h=arguments.length;h--;)p+=arguments[h]*arguments[h];return Math.sqrt(p)}),$}var J,re={};function Q(){if(J)return re;function c(h){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(_){return typeof _}:function(_){return _&&typeof Symbol=="function"&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _},c(h)}J=1,Object.defineProperty(re,"__esModule",{value:!0}),re.create=function(){var h=new r.ARRAY_TYPE(4);return r.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0),h[0]=1,h[3]=1,h},re.clone=function(h){var _=new r.ARRAY_TYPE(4);return _[0]=h[0],_[1]=h[1],_[2]=h[2],_[3]=h[3],_},re.copy=function(h,_){return h[0]=_[0],h[1]=_[1],h[2]=_[2],h[3]=_[3],h},re.identity=function(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=1,h},re.fromValues=function(h,_,w,E){var A=new r.ARRAY_TYPE(4);return A[0]=h,A[1]=_,A[2]=w,A[3]=E,A},re.set=function(h,_,w,E,A){return h[0]=_,h[1]=w,h[2]=E,h[3]=A,h},re.transpose=function(h,_){if(h===_){var w=_[1];h[1]=_[2],h[2]=w}else h[0]=_[0],h[1]=_[2],h[2]=_[1],h[3]=_[3];return h},re.invert=function(h,_){var w=_[0],E=_[1],A=_[2],v=_[3],C=w*v-A*E;return C?(h[0]=v*(C=1/C),h[1]=-E*C,h[2]=-A*C,h[3]=w*C,h):null},re.adjoint=function(h,_){var w=_[0];return h[0]=_[3],h[1]=-_[1],h[2]=-_[2],h[3]=w,h},re.determinant=function(h){return h[0]*h[3]-h[2]*h[1]},re.multiply=u,re.rotate=function(h,_,w){var E=_[0],A=_[1],v=_[2],C=_[3],I=Math.sin(w),M=Math.cos(w);return h[0]=E*M+v*I,h[1]=A*M+C*I,h[2]=E*-I+v*M,h[3]=A*-I+C*M,h},re.scale=function(h,_,w){var E=_[1],A=_[2],v=_[3],C=w[0],I=w[1];return h[0]=_[0]*C,h[1]=E*C,h[2]=A*I,h[3]=v*I,h},re.fromRotation=function(h,_){var w=Math.sin(_),E=Math.cos(_);return h[0]=E,h[1]=w,h[2]=-w,h[3]=E,h},re.fromScaling=function(h,_){return h[0]=_[0],h[1]=0,h[2]=0,h[3]=_[1],h},re.str=function(h){return"mat2("+h[0]+", "+h[1]+", "+h[2]+", "+h[3]+")"},re.frob=function(h){return Math.hypot(h[0],h[1],h[2],h[3])},re.LDU=function(h,_,w,E){return h[2]=E[2]/E[0],w[0]=E[0],w[1]=E[1],w[3]=E[3]-h[2]*w[1],[h,_,w]},re.add=function(h,_,w){return h[0]=_[0]+w[0],h[1]=_[1]+w[1],h[2]=_[2]+w[2],h[3]=_[3]+w[3],h},re.subtract=p,re.exactEquals=function(h,_){return h[0]===_[0]&&h[1]===_[1]&&h[2]===_[2]&&h[3]===_[3]},re.equals=function(h,_){var w=h[0],E=h[1],A=h[2],v=h[3],C=_[0],I=_[1],M=_[2],P=_[3];return Math.abs(w-C)<=r.EPSILON*Math.max(1,Math.abs(w),Math.abs(C))&&Math.abs(E-I)<=r.EPSILON*Math.max(1,Math.abs(E),Math.abs(I))&&Math.abs(A-M)<=r.EPSILON*Math.max(1,Math.abs(A),Math.abs(M))&&Math.abs(v-P)<=r.EPSILON*Math.max(1,Math.abs(v),Math.abs(P))},re.multiplyScalar=function(h,_,w){return h[0]=_[0]*w,h[1]=_[1]*w,h[2]=_[2]*w,h[3]=_[3]*w,h},re.multiplyScalarAndAdd=function(h,_,w,E){return h[0]=_[0]+w[0]*E,h[1]=_[1]+w[1]*E,h[2]=_[2]+w[2]*E,h[3]=_[3]+w[3]*E,h},re.sub=re.mul=void 0;var r=function(h,_){if(h&&h.__esModule)return h;if(h===null||c(h)!=="object"&&typeof h!="function")return{default:h};var w=o(void 0);if(w&&w.has(h))return w.get(h);var E={},A=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var v in h)if(v!=="default"&&Object.prototype.hasOwnProperty.call(h,v)){var C=A?Object.getOwnPropertyDescriptor(h,v):null;C&&(C.get||C.set)?Object.defineProperty(E,v,C):E[v]=h[v]}return E.default=h,w&&w.set(h,E),E}(q());function o(h){if(typeof WeakMap!="function")return null;var _=new WeakMap,w=new WeakMap;return(o=function(E){return E?w:_})(h)}function u(h,_,w){var E=_[0],A=_[1],v=_[2],C=_[3],I=w[0],M=w[1],P=w[2],R=w[3];return h[0]=E*I+v*M,h[1]=A*I+C*M,h[2]=E*P+v*R,h[3]=A*P+C*R,h}function p(h,_,w){return h[0]=_[0]-w[0],h[1]=_[1]-w[1],h[2]=_[2]-w[2],h[3]=_[3]-w[3],h}return re.mul=u,re.sub=p,re}var ce,le={};function ae(){if(ce)return le;function c(h){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(_){return typeof _}:function(_){return _&&typeof Symbol=="function"&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _},c(h)}ce=1,Object.defineProperty(le,"__esModule",{value:!0}),le.create=function(){var h=new r.ARRAY_TYPE(6);return r.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0,h[4]=0,h[5]=0),h[0]=1,h[3]=1,h},le.clone=function(h){var _=new r.ARRAY_TYPE(6);return _[0]=h[0],_[1]=h[1],_[2]=h[2],_[3]=h[3],_[4]=h[4],_[5]=h[5],_},le.copy=function(h,_){return h[0]=_[0],h[1]=_[1],h[2]=_[2],h[3]=_[3],h[4]=_[4],h[5]=_[5],h},le.identity=function(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=1,h[4]=0,h[5]=0,h},le.fromValues=function(h,_,w,E,A,v){var C=new r.ARRAY_TYPE(6);return C[0]=h,C[1]=_,C[2]=w,C[3]=E,C[4]=A,C[5]=v,C},le.set=function(h,_,w,E,A,v,C){return h[0]=_,h[1]=w,h[2]=E,h[3]=A,h[4]=v,h[5]=C,h},le.invert=function(h,_){var w=_[0],E=_[1],A=_[2],v=_[3],C=_[4],I=_[5],M=w*v-E*A;return M?(h[0]=v*(M=1/M),h[1]=-E*M,h[2]=-A*M,h[3]=w*M,h[4]=(A*I-v*C)*M,h[5]=(E*C-w*I)*M,h):null},le.determinant=function(h){return h[0]*h[3]-h[1]*h[2]},le.multiply=u,le.rotate=function(h,_,w){var E=_[0],A=_[1],v=_[2],C=_[3],I=_[4],M=_[5],P=Math.sin(w),R=Math.cos(w);return h[0]=E*R+v*P,h[1]=A*R+C*P,h[2]=E*-P+v*R,h[3]=A*-P+C*R,h[4]=I,h[5]=M,h},le.scale=function(h,_,w){var E=_[1],A=_[2],v=_[3],C=_[4],I=_[5],M=w[0],P=w[1];return h[0]=_[0]*M,h[1]=E*M,h[2]=A*P,h[3]=v*P,h[4]=C,h[5]=I,h},le.translate=function(h,_,w){var E=_[0],A=_[1],v=_[2],C=_[3],I=_[4],M=_[5],P=w[0],R=w[1];return h[0]=E,h[1]=A,h[2]=v,h[3]=C,h[4]=E*P+v*R+I,h[5]=A*P+C*R+M,h},le.fromRotation=function(h,_){var w=Math.sin(_),E=Math.cos(_);return h[0]=E,h[1]=w,h[2]=-w,h[3]=E,h[4]=0,h[5]=0,h},le.fromScaling=function(h,_){return h[0]=_[0],h[1]=0,h[2]=0,h[3]=_[1],h[4]=0,h[5]=0,h},le.fromTranslation=function(h,_){return h[0]=1,h[1]=0,h[2]=0,h[3]=1,h[4]=_[0],h[5]=_[1],h},le.str=function(h){return"mat2d("+h[0]+", "+h[1]+", "+h[2]+", "+h[3]+", "+h[4]+", "+h[5]+")"},le.frob=function(h){return Math.hypot(h[0],h[1],h[2],h[3],h[4],h[5],1)},le.add=function(h,_,w){return h[0]=_[0]+w[0],h[1]=_[1]+w[1],h[2]=_[2]+w[2],h[3]=_[3]+w[3],h[4]=_[4]+w[4],h[5]=_[5]+w[5],h},le.subtract=p,le.multiplyScalar=function(h,_,w){return h[0]=_[0]*w,h[1]=_[1]*w,h[2]=_[2]*w,h[3]=_[3]*w,h[4]=_[4]*w,h[5]=_[5]*w,h},le.multiplyScalarAndAdd=function(h,_,w,E){return h[0]=_[0]+w[0]*E,h[1]=_[1]+w[1]*E,h[2]=_[2]+w[2]*E,h[3]=_[3]+w[3]*E,h[4]=_[4]+w[4]*E,h[5]=_[5]+w[5]*E,h},le.exactEquals=function(h,_){return h[0]===_[0]&&h[1]===_[1]&&h[2]===_[2]&&h[3]===_[3]&&h[4]===_[4]&&h[5]===_[5]},le.equals=function(h,_){var w=h[0],E=h[1],A=h[2],v=h[3],C=h[4],I=h[5],M=_[0],P=_[1],R=_[2],F=_[3],B=_[4],Z=_[5];return Math.abs(w-M)<=r.EPSILON*Math.max(1,Math.abs(w),Math.abs(M))&&Math.abs(E-P)<=r.EPSILON*Math.max(1,Math.abs(E),Math.abs(P))&&Math.abs(A-R)<=r.EPSILON*Math.max(1,Math.abs(A),Math.abs(R))&&Math.abs(v-F)<=r.EPSILON*Math.max(1,Math.abs(v),Math.abs(F))&&Math.abs(C-B)<=r.EPSILON*Math.max(1,Math.abs(C),Math.abs(B))&&Math.abs(I-Z)<=r.EPSILON*Math.max(1,Math.abs(I),Math.abs(Z))},le.sub=le.mul=void 0;var r=function(h,_){if(h&&h.__esModule)return h;if(h===null||c(h)!=="object"&&typeof h!="function")return{default:h};var w=o(void 0);if(w&&w.has(h))return w.get(h);var E={},A=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var v in h)if(v!=="default"&&Object.prototype.hasOwnProperty.call(h,v)){var C=A?Object.getOwnPropertyDescriptor(h,v):null;C&&(C.get||C.set)?Object.defineProperty(E,v,C):E[v]=h[v]}return E.default=h,w&&w.set(h,E),E}(q());function o(h){if(typeof WeakMap!="function")return null;var _=new WeakMap,w=new WeakMap;return(o=function(E){return E?w:_})(h)}function u(h,_,w){var E=_[0],A=_[1],v=_[2],C=_[3],I=_[4],M=_[5],P=w[0],R=w[1],F=w[2],B=w[3],Z=w[4],W=w[5];return h[0]=E*P+v*R,h[1]=A*P+C*R,h[2]=E*F+v*B,h[3]=A*F+C*B,h[4]=E*Z+v*W+I,h[5]=A*Z+C*W+M,h}function p(h,_,w){return h[0]=_[0]-w[0],h[1]=_[1]-w[1],h[2]=_[2]-w[2],h[3]=_[3]-w[3],h[4]=_[4]-w[4],h[5]=_[5]-w[5],h}return le.mul=u,le.sub=p,le}var he,Se={};function je(){if(he)return Se;function c(h){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(_){return typeof _}:function(_){return _&&typeof Symbol=="function"&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _},c(h)}he=1,Object.defineProperty(Se,"__esModule",{value:!0}),Se.create=function(){var h=new r.ARRAY_TYPE(9);return r.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0,h[3]=0,h[5]=0,h[6]=0,h[7]=0),h[0]=1,h[4]=1,h[8]=1,h},Se.fromMat4=function(h,_){return h[0]=_[0],h[1]=_[1],h[2]=_[2],h[3]=_[4],h[4]=_[5],h[5]=_[6],h[6]=_[8],h[7]=_[9],h[8]=_[10],h},Se.clone=function(h){var _=new r.ARRAY_TYPE(9);return _[0]=h[0],_[1]=h[1],_[2]=h[2],_[3]=h[3],_[4]=h[4],_[5]=h[5],_[6]=h[6],_[7]=h[7],_[8]=h[8],_},Se.copy=function(h,_){return h[0]=_[0],h[1]=_[1],h[2]=_[2],h[3]=_[3],h[4]=_[4],h[5]=_[5],h[6]=_[6],h[7]=_[7],h[8]=_[8],h},Se.fromValues=function(h,_,w,E,A,v,C,I,M){var P=new r.ARRAY_TYPE(9);return P[0]=h,P[1]=_,P[2]=w,P[3]=E,P[4]=A,P[5]=v,P[6]=C,P[7]=I,P[8]=M,P},Se.set=function(h,_,w,E,A,v,C,I,M,P){return h[0]=_,h[1]=w,h[2]=E,h[3]=A,h[4]=v,h[5]=C,h[6]=I,h[7]=M,h[8]=P,h},Se.identity=function(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=1,h[5]=0,h[6]=0,h[7]=0,h[8]=1,h},Se.transpose=function(h,_){if(h===_){var w=_[1],E=_[2],A=_[5];h[1]=_[3],h[2]=_[6],h[3]=w,h[5]=_[7],h[6]=E,h[7]=A}else h[0]=_[0],h[1]=_[3],h[2]=_[6],h[3]=_[1],h[4]=_[4],h[5]=_[7],h[6]=_[2],h[7]=_[5],h[8]=_[8];return h},Se.invert=function(h,_){var w=_[0],E=_[1],A=_[2],v=_[3],C=_[4],I=_[5],M=_[6],P=_[7],R=_[8],F=R*C-I*P,B=-R*v+I*M,Z=P*v-C*M,W=w*F+E*B+A*Z;return W?(h[0]=F*(W=1/W),h[1]=(-R*E+A*P)*W,h[2]=(I*E-A*C)*W,h[3]=B*W,h[4]=(R*w-A*M)*W,h[5]=(-I*w+A*v)*W,h[6]=Z*W,h[7]=(-P*w+E*M)*W,h[8]=(C*w-E*v)*W,h):null},Se.adjoint=function(h,_){var w=_[0],E=_[1],A=_[2],v=_[3],C=_[4],I=_[5],M=_[6],P=_[7],R=_[8];return h[0]=C*R-I*P,h[1]=A*P-E*R,h[2]=E*I-A*C,h[3]=I*M-v*R,h[4]=w*R-A*M,h[5]=A*v-w*I,h[6]=v*P-C*M,h[7]=E*M-w*P,h[8]=w*C-E*v,h},Se.determinant=function(h){var _=h[3],w=h[4],E=h[5],A=h[6],v=h[7],C=h[8];return h[0]*(C*w-E*v)+h[1]*(-C*_+E*A)+h[2]*(v*_-w*A)},Se.multiply=u,Se.translate=function(h,_,w){var E=_[0],A=_[1],v=_[2],C=_[3],I=_[4],M=_[5],P=_[6],R=_[7],F=_[8],B=w[0],Z=w[1];return h[0]=E,h[1]=A,h[2]=v,h[3]=C,h[4]=I,h[5]=M,h[6]=B*E+Z*C+P,h[7]=B*A+Z*I+R,h[8]=B*v+Z*M+F,h},Se.rotate=function(h,_,w){var E=_[0],A=_[1],v=_[2],C=_[3],I=_[4],M=_[5],P=_[6],R=_[7],F=_[8],B=Math.sin(w),Z=Math.cos(w);return h[0]=Z*E+B*C,h[1]=Z*A+B*I,h[2]=Z*v+B*M,h[3]=Z*C-B*E,h[4]=Z*I-B*A,h[5]=Z*M-B*v,h[6]=P,h[7]=R,h[8]=F,h},Se.scale=function(h,_,w){var E=w[0],A=w[1];return h[0]=E*_[0],h[1]=E*_[1],h[2]=E*_[2],h[3]=A*_[3],h[4]=A*_[4],h[5]=A*_[5],h[6]=_[6],h[7]=_[7],h[8]=_[8],h},Se.fromTranslation=function(h,_){return h[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=1,h[5]=0,h[6]=_[0],h[7]=_[1],h[8]=1,h},Se.fromRotation=function(h,_){var w=Math.sin(_),E=Math.cos(_);return h[0]=E,h[1]=w,h[2]=0,h[3]=-w,h[4]=E,h[5]=0,h[6]=0,h[7]=0,h[8]=1,h},Se.fromScaling=function(h,_){return h[0]=_[0],h[1]=0,h[2]=0,h[3]=0,h[4]=_[1],h[5]=0,h[6]=0,h[7]=0,h[8]=1,h},Se.fromMat2d=function(h,_){return h[0]=_[0],h[1]=_[1],h[2]=0,h[3]=_[2],h[4]=_[3],h[5]=0,h[6]=_[4],h[7]=_[5],h[8]=1,h},Se.fromQuat=function(h,_){var w=_[0],E=_[1],A=_[2],v=_[3],C=w+w,I=E+E,M=A+A,P=w*C,R=E*C,F=E*I,B=A*C,Z=A*I,W=A*M,G=v*C,X=v*I,ee=v*M;return h[0]=1-F-W,h[3]=R-ee,h[6]=B+X,h[1]=R+ee,h[4]=1-P-W,h[7]=Z-G,h[2]=B-X,h[5]=Z+G,h[8]=1-P-F,h},Se.normalFromMat4=function(h,_){var w=_[0],E=_[1],A=_[2],v=_[3],C=_[4],I=_[5],M=_[6],P=_[7],R=_[8],F=_[9],B=_[10],Z=_[11],W=_[12],G=_[13],X=_[14],ee=_[15],ie=w*I-E*C,ge=w*M-A*C,fe=w*P-v*C,pe=E*M-A*I,Ce=E*P-v*I,_e=A*P-v*M,Me=R*G-F*W,Re=R*X-B*W,ke=R*ee-Z*W,Oe=F*X-B*G,Le=F*ee-Z*G,Ge=B*ee-Z*X,Ve=ie*Ge-ge*Le+fe*Oe+pe*ke-Ce*Re+_e*Me;return Ve?(h[0]=(I*Ge-M*Le+P*Oe)*(Ve=1/Ve),h[1]=(M*ke-C*Ge-P*Re)*Ve,h[2]=(C*Le-I*ke+P*Me)*Ve,h[3]=(A*Le-E*Ge-v*Oe)*Ve,h[4]=(w*Ge-A*ke+v*Re)*Ve,h[5]=(E*ke-w*Le-v*Me)*Ve,h[6]=(G*_e-X*Ce+ee*pe)*Ve,h[7]=(X*fe-W*_e-ee*ge)*Ve,h[8]=(W*Ce-G*fe+ee*ie)*Ve,h):null},Se.projection=function(h,_,w){return h[0]=2/_,h[1]=0,h[2]=0,h[3]=0,h[4]=-2/w,h[5]=0,h[6]=-1,h[7]=1,h[8]=1,h},Se.str=function(h){return"mat3("+h[0]+", "+h[1]+", "+h[2]+", "+h[3]+", "+h[4]+", "+h[5]+", "+h[6]+", "+h[7]+", "+h[8]+")"},Se.frob=function(h){return Math.hypot(h[0],h[1],h[2],h[3],h[4],h[5],h[6],h[7],h[8])},Se.add=function(h,_,w){return h[0]=_[0]+w[0],h[1]=_[1]+w[1],h[2]=_[2]+w[2],h[3]=_[3]+w[3],h[4]=_[4]+w[4],h[5]=_[5]+w[5],h[6]=_[6]+w[6],h[7]=_[7]+w[7],h[8]=_[8]+w[8],h},Se.subtract=p,Se.multiplyScalar=function(h,_,w){return h[0]=_[0]*w,h[1]=_[1]*w,h[2]=_[2]*w,h[3]=_[3]*w,h[4]=_[4]*w,h[5]=_[5]*w,h[6]=_[6]*w,h[7]=_[7]*w,h[8]=_[8]*w,h},Se.multiplyScalarAndAdd=function(h,_,w,E){return h[0]=_[0]+w[0]*E,h[1]=_[1]+w[1]*E,h[2]=_[2]+w[2]*E,h[3]=_[3]+w[3]*E,h[4]=_[4]+w[4]*E,h[5]=_[5]+w[5]*E,h[6]=_[6]+w[6]*E,h[7]=_[7]+w[7]*E,h[8]=_[8]+w[8]*E,h},Se.exactEquals=function(h,_){return h[0]===_[0]&&h[1]===_[1]&&h[2]===_[2]&&h[3]===_[3]&&h[4]===_[4]&&h[5]===_[5]&&h[6]===_[6]&&h[7]===_[7]&&h[8]===_[8]},Se.equals=function(h,_){var w=h[0],E=h[1],A=h[2],v=h[3],C=h[4],I=h[5],M=h[6],P=h[7],R=h[8],F=_[0],B=_[1],Z=_[2],W=_[3],G=_[4],X=_[5],ee=_[6],ie=_[7],ge=_[8];return Math.abs(w-F)<=r.EPSILON*Math.max(1,Math.abs(w),Math.abs(F))&&Math.abs(E-B)<=r.EPSILON*Math.max(1,Math.abs(E),Math.abs(B))&&Math.abs(A-Z)<=r.EPSILON*Math.max(1,Math.abs(A),Math.abs(Z))&&Math.abs(v-W)<=r.EPSILON*Math.max(1,Math.abs(v),Math.abs(W))&&Math.abs(C-G)<=r.EPSILON*Math.max(1,Math.abs(C),Math.abs(G))&&Math.abs(I-X)<=r.EPSILON*Math.max(1,Math.abs(I),Math.abs(X))&&Math.abs(M-ee)<=r.EPSILON*Math.max(1,Math.abs(M),Math.abs(ee))&&Math.abs(P-ie)<=r.EPSILON*Math.max(1,Math.abs(P),Math.abs(ie))&&Math.abs(R-ge)<=r.EPSILON*Math.max(1,Math.abs(R),Math.abs(ge))},Se.sub=Se.mul=void 0;var r=function(h,_){if(h&&h.__esModule)return h;if(h===null||c(h)!=="object"&&typeof h!="function")return{default:h};var w=o(void 0);if(w&&w.has(h))return w.get(h);var E={},A=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var v in h)if(v!=="default"&&Object.prototype.hasOwnProperty.call(h,v)){var C=A?Object.getOwnPropertyDescriptor(h,v):null;C&&(C.get||C.set)?Object.defineProperty(E,v,C):E[v]=h[v]}return E.default=h,w&&w.set(h,E),E}(q());function o(h){if(typeof WeakMap!="function")return null;var _=new WeakMap,w=new WeakMap;return(o=function(E){return E?w:_})(h)}function u(h,_,w){var E=_[0],A=_[1],v=_[2],C=_[3],I=_[4],M=_[5],P=_[6],R=_[7],F=_[8],B=w[0],Z=w[1],W=w[2],G=w[3],X=w[4],ee=w[5],ie=w[6],ge=w[7],fe=w[8];return h[0]=B*E+Z*C+W*P,h[1]=B*A+Z*I+W*R,h[2]=B*v+Z*M+W*F,h[3]=G*E+X*C+ee*P,h[4]=G*A+X*I+ee*R,h[5]=G*v+X*M+ee*F,h[6]=ie*E+ge*C+fe*P,h[7]=ie*A+ge*I+fe*R,h[8]=ie*v+ge*M+fe*F,h}function p(h,_,w){return h[0]=_[0]-w[0],h[1]=_[1]-w[1],h[2]=_[2]-w[2],h[3]=_[3]-w[3],h[4]=_[4]-w[4],h[5]=_[5]-w[5],h[6]=_[6]-w[6],h[7]=_[7]-w[7],h[8]=_[8]-w[8],h}return Se.mul=u,Se.sub=p,Se}var it,qe={};function ct(){if(it)return qe;function c(v){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},c(v)}it=1,Object.defineProperty(qe,"__esModule",{value:!0}),qe.create=function(){var v=new r.ARRAY_TYPE(16);return r.ARRAY_TYPE!=Float32Array&&(v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[11]=0,v[12]=0,v[13]=0,v[14]=0),v[0]=1,v[5]=1,v[10]=1,v[15]=1,v},qe.clone=function(v){var C=new r.ARRAY_TYPE(16);return C[0]=v[0],C[1]=v[1],C[2]=v[2],C[3]=v[3],C[4]=v[4],C[5]=v[5],C[6]=v[6],C[7]=v[7],C[8]=v[8],C[9]=v[9],C[10]=v[10],C[11]=v[11],C[12]=v[12],C[13]=v[13],C[14]=v[14],C[15]=v[15],C},qe.copy=function(v,C){return v[0]=C[0],v[1]=C[1],v[2]=C[2],v[3]=C[3],v[4]=C[4],v[5]=C[5],v[6]=C[6],v[7]=C[7],v[8]=C[8],v[9]=C[9],v[10]=C[10],v[11]=C[11],v[12]=C[12],v[13]=C[13],v[14]=C[14],v[15]=C[15],v},qe.fromValues=function(v,C,I,M,P,R,F,B,Z,W,G,X,ee,ie,ge,fe){var pe=new r.ARRAY_TYPE(16);return pe[0]=v,pe[1]=C,pe[2]=I,pe[3]=M,pe[4]=P,pe[5]=R,pe[6]=F,pe[7]=B,pe[8]=Z,pe[9]=W,pe[10]=G,pe[11]=X,pe[12]=ee,pe[13]=ie,pe[14]=ge,pe[15]=fe,pe},qe.set=function(v,C,I,M,P,R,F,B,Z,W,G,X,ee,ie,ge,fe,pe){return v[0]=C,v[1]=I,v[2]=M,v[3]=P,v[4]=R,v[5]=F,v[6]=B,v[7]=Z,v[8]=W,v[9]=G,v[10]=X,v[11]=ee,v[12]=ie,v[13]=ge,v[14]=fe,v[15]=pe,v},qe.identity=u,qe.transpose=function(v,C){if(v===C){var I=C[1],M=C[2],P=C[3],R=C[6],F=C[7],B=C[11];v[1]=C[4],v[2]=C[8],v[3]=C[12],v[4]=I,v[6]=C[9],v[7]=C[13],v[8]=M,v[9]=R,v[11]=C[14],v[12]=P,v[13]=F,v[14]=B}else v[0]=C[0],v[1]=C[4],v[2]=C[8],v[3]=C[12],v[4]=C[1],v[5]=C[5],v[6]=C[9],v[7]=C[13],v[8]=C[2],v[9]=C[6],v[10]=C[10],v[11]=C[14],v[12]=C[3],v[13]=C[7],v[14]=C[11],v[15]=C[15];return v},qe.invert=function(v,C){var I=C[0],M=C[1],P=C[2],R=C[3],F=C[4],B=C[5],Z=C[6],W=C[7],G=C[8],X=C[9],ee=C[10],ie=C[11],ge=C[12],fe=C[13],pe=C[14],Ce=C[15],_e=I*B-M*F,Me=I*Z-P*F,Re=I*W-R*F,ke=M*Z-P*B,Oe=M*W-R*B,Le=P*W-R*Z,Ge=G*fe-X*ge,Ve=G*pe-ee*ge,He=G*Ce-ie*ge,gt=X*pe-ee*fe,ft=X*Ce-ie*fe,Ft=ee*Ce-ie*pe,xt=_e*Ft-Me*ft+Re*gt+ke*He-Oe*Ve+Le*Ge;return xt?(v[0]=(B*Ft-Z*ft+W*gt)*(xt=1/xt),v[1]=(P*ft-M*Ft-R*gt)*xt,v[2]=(fe*Le-pe*Oe+Ce*ke)*xt,v[3]=(ee*Oe-X*Le-ie*ke)*xt,v[4]=(Z*He-F*Ft-W*Ve)*xt,v[5]=(I*Ft-P*He+R*Ve)*xt,v[6]=(pe*Re-ge*Le-Ce*Me)*xt,v[7]=(G*Le-ee*Re+ie*Me)*xt,v[8]=(F*ft-B*He+W*Ge)*xt,v[9]=(M*He-I*ft-R*Ge)*xt,v[10]=(ge*Oe-fe*Re+Ce*_e)*xt,v[11]=(X*Re-G*Oe-ie*_e)*xt,v[12]=(B*Ve-F*gt-Z*Ge)*xt,v[13]=(I*gt-M*Ve+P*Ge)*xt,v[14]=(fe*Me-ge*ke-pe*_e)*xt,v[15]=(G*ke-X*Me+ee*_e)*xt,v):null},qe.adjoint=function(v,C){var I=C[0],M=C[1],P=C[2],R=C[3],F=C[4],B=C[5],Z=C[6],W=C[7],G=C[8],X=C[9],ee=C[10],ie=C[11],ge=C[12],fe=C[13],pe=C[14],Ce=C[15];return v[0]=B*(ee*Ce-ie*pe)-X*(Z*Ce-W*pe)+fe*(Z*ie-W*ee),v[1]=-(M*(ee*Ce-ie*pe)-X*(P*Ce-R*pe)+fe*(P*ie-R*ee)),v[2]=M*(Z*Ce-W*pe)-B*(P*Ce-R*pe)+fe*(P*W-R*Z),v[3]=-(M*(Z*ie-W*ee)-B*(P*ie-R*ee)+X*(P*W-R*Z)),v[4]=-(F*(ee*Ce-ie*pe)-G*(Z*Ce-W*pe)+ge*(Z*ie-W*ee)),v[5]=I*(ee*Ce-ie*pe)-G*(P*Ce-R*pe)+ge*(P*ie-R*ee),v[6]=-(I*(Z*Ce-W*pe)-F*(P*Ce-R*pe)+ge*(P*W-R*Z)),v[7]=I*(Z*ie-W*ee)-F*(P*ie-R*ee)+G*(P*W-R*Z),v[8]=F*(X*Ce-ie*fe)-G*(B*Ce-W*fe)+ge*(B*ie-W*X),v[9]=-(I*(X*Ce-ie*fe)-G*(M*Ce-R*fe)+ge*(M*ie-R*X)),v[10]=I*(B*Ce-W*fe)-F*(M*Ce-R*fe)+ge*(M*W-R*B),v[11]=-(I*(B*ie-W*X)-F*(M*ie-R*X)+G*(M*W-R*B)),v[12]=-(F*(X*pe-ee*fe)-G*(B*pe-Z*fe)+ge*(B*ee-Z*X)),v[13]=I*(X*pe-ee*fe)-G*(M*pe-P*fe)+ge*(M*ee-P*X),v[14]=-(I*(B*pe-Z*fe)-F*(M*pe-P*fe)+ge*(M*Z-P*B)),v[15]=I*(B*ee-Z*X)-F*(M*ee-P*X)+G*(M*Z-P*B),v},qe.determinant=function(v){var C=v[0],I=v[1],M=v[2],P=v[3],R=v[4],F=v[5],B=v[6],Z=v[7],W=v[8],G=v[9],X=v[10],ee=v[11],ie=v[12],ge=v[13],fe=v[14],pe=v[15];return(C*F-I*R)*(X*pe-ee*fe)-(C*B-M*R)*(G*pe-ee*ge)+(C*Z-P*R)*(G*fe-X*ge)+(I*B-M*F)*(W*pe-ee*ie)-(I*Z-P*F)*(W*fe-X*ie)+(M*Z-P*B)*(W*ge-G*ie)},qe.multiply=p,qe.translate=function(v,C,I){var M,P,R,F,B,Z,W,G,X,ee,ie,ge,fe=I[0],pe=I[1],Ce=I[2];return C===v?(v[12]=C[0]*fe+C[4]*pe+C[8]*Ce+C[12],v[13]=C[1]*fe+C[5]*pe+C[9]*Ce+C[13],v[14]=C[2]*fe+C[6]*pe+C[10]*Ce+C[14],v[15]=C[3]*fe+C[7]*pe+C[11]*Ce+C[15]):(P=C[1],R=C[2],F=C[3],B=C[4],Z=C[5],W=C[6],G=C[7],X=C[8],ee=C[9],ie=C[10],ge=C[11],v[0]=M=C[0],v[1]=P,v[2]=R,v[3]=F,v[4]=B,v[5]=Z,v[6]=W,v[7]=G,v[8]=X,v[9]=ee,v[10]=ie,v[11]=ge,v[12]=M*fe+B*pe+X*Ce+C[12],v[13]=P*fe+Z*pe+ee*Ce+C[13],v[14]=R*fe+W*pe+ie*Ce+C[14],v[15]=F*fe+G*pe+ge*Ce+C[15]),v},qe.scale=function(v,C,I){var M=I[0],P=I[1],R=I[2];return v[0]=C[0]*M,v[1]=C[1]*M,v[2]=C[2]*M,v[3]=C[3]*M,v[4]=C[4]*P,v[5]=C[5]*P,v[6]=C[6]*P,v[7]=C[7]*P,v[8]=C[8]*R,v[9]=C[9]*R,v[10]=C[10]*R,v[11]=C[11]*R,v[12]=C[12],v[13]=C[13],v[14]=C[14],v[15]=C[15],v},qe.rotate=function(v,C,I,M){var P,R,F,B,Z,W,G,X,ee,ie,ge,fe,pe,Ce,_e,Me,Re,ke,Oe,Le,Ge,Ve,He,gt,ft=M[0],Ft=M[1],xt=M[2],Et=Math.hypot(ft,Ft,xt);return Et<r.EPSILON?null:(ft*=Et=1/Et,Ft*=Et,xt*=Et,P=Math.sin(I),R=Math.cos(I),Z=C[1],W=C[2],G=C[3],ee=C[5],ie=C[6],ge=C[7],pe=C[9],Ce=C[10],_e=C[11],Me=ft*ft*(F=1-R)+R,Oe=ft*Ft*F-xt*P,Le=Ft*Ft*F+R,Ge=xt*Ft*F+ft*P,Ve=ft*xt*F+Ft*P,He=Ft*xt*F-ft*P,gt=xt*xt*F+R,v[0]=(B=C[0])*Me+(X=C[4])*(Re=Ft*ft*F+xt*P)+(fe=C[8])*(ke=xt*ft*F-Ft*P),v[1]=Z*Me+ee*Re+pe*ke,v[2]=W*Me+ie*Re+Ce*ke,v[3]=G*Me+ge*Re+_e*ke,v[4]=B*Oe+X*Le+fe*Ge,v[5]=Z*Oe+ee*Le+pe*Ge,v[6]=W*Oe+ie*Le+Ce*Ge,v[7]=G*Oe+ge*Le+_e*Ge,v[8]=B*Ve+X*He+fe*gt,v[9]=Z*Ve+ee*He+pe*gt,v[10]=W*Ve+ie*He+Ce*gt,v[11]=G*Ve+ge*He+_e*gt,C!==v&&(v[12]=C[12],v[13]=C[13],v[14]=C[14],v[15]=C[15]),v)},qe.rotateX=function(v,C,I){var M=Math.sin(I),P=Math.cos(I),R=C[4],F=C[5],B=C[6],Z=C[7],W=C[8],G=C[9],X=C[10],ee=C[11];return C!==v&&(v[0]=C[0],v[1]=C[1],v[2]=C[2],v[3]=C[3],v[12]=C[12],v[13]=C[13],v[14]=C[14],v[15]=C[15]),v[4]=R*P+W*M,v[5]=F*P+G*M,v[6]=B*P+X*M,v[7]=Z*P+ee*M,v[8]=W*P-R*M,v[9]=G*P-F*M,v[10]=X*P-B*M,v[11]=ee*P-Z*M,v},qe.rotateY=function(v,C,I){var M=Math.sin(I),P=Math.cos(I),R=C[0],F=C[1],B=C[2],Z=C[3],W=C[8],G=C[9],X=C[10],ee=C[11];return C!==v&&(v[4]=C[4],v[5]=C[5],v[6]=C[6],v[7]=C[7],v[12]=C[12],v[13]=C[13],v[14]=C[14],v[15]=C[15]),v[0]=R*P-W*M,v[1]=F*P-G*M,v[2]=B*P-X*M,v[3]=Z*P-ee*M,v[8]=R*M+W*P,v[9]=F*M+G*P,v[10]=B*M+X*P,v[11]=Z*M+ee*P,v},qe.rotateZ=function(v,C,I){var M=Math.sin(I),P=Math.cos(I),R=C[0],F=C[1],B=C[2],Z=C[3],W=C[4],G=C[5],X=C[6],ee=C[7];return C!==v&&(v[8]=C[8],v[9]=C[9],v[10]=C[10],v[11]=C[11],v[12]=C[12],v[13]=C[13],v[14]=C[14],v[15]=C[15]),v[0]=R*P+W*M,v[1]=F*P+G*M,v[2]=B*P+X*M,v[3]=Z*P+ee*M,v[4]=W*P-R*M,v[5]=G*P-F*M,v[6]=X*P-B*M,v[7]=ee*P-Z*M,v},qe.fromTranslation=function(v,C){return v[0]=1,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=1,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[10]=1,v[11]=0,v[12]=C[0],v[13]=C[1],v[14]=C[2],v[15]=1,v},qe.fromScaling=function(v,C){return v[0]=C[0],v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=C[1],v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[10]=C[2],v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,v},qe.fromRotation=function(v,C,I){var M,P,R,F=I[0],B=I[1],Z=I[2],W=Math.hypot(F,B,Z);return W<r.EPSILON?null:(F*=W=1/W,B*=W,Z*=W,M=Math.sin(C),P=Math.cos(C),v[0]=F*F*(R=1-P)+P,v[1]=B*F*R+Z*M,v[2]=Z*F*R-B*M,v[3]=0,v[4]=F*B*R-Z*M,v[5]=B*B*R+P,v[6]=Z*B*R+F*M,v[7]=0,v[8]=F*Z*R+B*M,v[9]=B*Z*R-F*M,v[10]=Z*Z*R+P,v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,v)},qe.fromXRotation=function(v,C){var I=Math.sin(C),M=Math.cos(C);return v[0]=1,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=M,v[6]=I,v[7]=0,v[8]=0,v[9]=-I,v[10]=M,v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,v},qe.fromYRotation=function(v,C){var I=Math.sin(C),M=Math.cos(C);return v[0]=M,v[1]=0,v[2]=-I,v[3]=0,v[4]=0,v[5]=1,v[6]=0,v[7]=0,v[8]=I,v[9]=0,v[10]=M,v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,v},qe.fromZRotation=function(v,C){var I=Math.sin(C),M=Math.cos(C);return v[0]=M,v[1]=I,v[2]=0,v[3]=0,v[4]=-I,v[5]=M,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[10]=1,v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,v},qe.fromRotationTranslation=h,qe.fromQuat2=function(v,C){var I=new r.ARRAY_TYPE(3),M=-C[0],P=-C[1],R=-C[2],F=C[3],B=C[4],Z=C[5],W=C[6],G=C[7],X=M*M+P*P+R*R+F*F;return X>0?(I[0]=2*(B*F+G*M+Z*R-W*P)/X,I[1]=2*(Z*F+G*P+W*M-B*R)/X,I[2]=2*(W*F+G*R+B*P-Z*M)/X):(I[0]=2*(B*F+G*M+Z*R-W*P),I[1]=2*(Z*F+G*P+W*M-B*R),I[2]=2*(W*F+G*R+B*P-Z*M)),h(v,C,I),v},qe.getTranslation=function(v,C){return v[0]=C[12],v[1]=C[13],v[2]=C[14],v},qe.getScaling=_,qe.getRotation=function(v,C){var I=new r.ARRAY_TYPE(3);_(I,C);var M=1/I[0],P=1/I[1],R=1/I[2],F=C[0]*M,B=C[1]*P,Z=C[2]*R,W=C[4]*M,G=C[5]*P,X=C[6]*R,ee=C[8]*M,ie=C[9]*P,ge=C[10]*R,fe=F+G+ge,pe=0;return fe>0?(pe=2*Math.sqrt(fe+1),v[3]=.25*pe,v[0]=(X-ie)/pe,v[1]=(ee-Z)/pe,v[2]=(B-W)/pe):F>G&&F>ge?(pe=2*Math.sqrt(1+F-G-ge),v[3]=(X-ie)/pe,v[0]=.25*pe,v[1]=(B+W)/pe,v[2]=(ee+Z)/pe):G>ge?(pe=2*Math.sqrt(1+G-F-ge),v[3]=(ee-Z)/pe,v[0]=(B+W)/pe,v[1]=.25*pe,v[2]=(X+ie)/pe):(pe=2*Math.sqrt(1+ge-F-G),v[3]=(B-W)/pe,v[0]=(ee+Z)/pe,v[1]=(X+ie)/pe,v[2]=.25*pe),v},qe.fromRotationTranslationScale=function(v,C,I,M){var P=C[0],R=C[1],F=C[2],B=C[3],Z=P+P,W=R+R,G=F+F,X=P*Z,ee=P*W,ie=P*G,ge=R*W,fe=R*G,pe=F*G,Ce=B*Z,_e=B*W,Me=B*G,Re=M[0],ke=M[1],Oe=M[2];return v[0]=(1-(ge+pe))*Re,v[1]=(ee+Me)*Re,v[2]=(ie-_e)*Re,v[3]=0,v[4]=(ee-Me)*ke,v[5]=(1-(X+pe))*ke,v[6]=(fe+Ce)*ke,v[7]=0,v[8]=(ie+_e)*Oe,v[9]=(fe-Ce)*Oe,v[10]=(1-(X+ge))*Oe,v[11]=0,v[12]=I[0],v[13]=I[1],v[14]=I[2],v[15]=1,v},qe.fromRotationTranslationScaleOrigin=function(v,C,I,M,P){var R=C[0],F=C[1],B=C[2],Z=C[3],W=R+R,G=F+F,X=B+B,ee=R*W,ie=R*G,ge=R*X,fe=F*G,pe=F*X,Ce=B*X,_e=Z*W,Me=Z*G,Re=Z*X,ke=M[0],Oe=M[1],Le=M[2],Ge=P[0],Ve=P[1],He=P[2],gt=(1-(fe+Ce))*ke,ft=(ie+Re)*ke,Ft=(ge-Me)*ke,xt=(ie-Re)*Oe,Et=(1-(ee+Ce))*Oe,_t=(pe+_e)*Oe,lr=(ge+Me)*Le,Dt=(pe-_e)*Le,Zt=(1-(ee+fe))*Le;return v[0]=gt,v[1]=ft,v[2]=Ft,v[3]=0,v[4]=xt,v[5]=Et,v[6]=_t,v[7]=0,v[8]=lr,v[9]=Dt,v[10]=Zt,v[11]=0,v[12]=I[0]+Ge-(gt*Ge+xt*Ve+lr*He),v[13]=I[1]+Ve-(ft*Ge+Et*Ve+Dt*He),v[14]=I[2]+He-(Ft*Ge+_t*Ve+Zt*He),v[15]=1,v},qe.fromQuat=function(v,C){var I=C[0],M=C[1],P=C[2],R=C[3],F=I+I,B=M+M,Z=P+P,W=I*F,G=M*F,X=M*B,ee=P*F,ie=P*B,ge=P*Z,fe=R*F,pe=R*B,Ce=R*Z;return v[0]=1-X-ge,v[1]=G+Ce,v[2]=ee-pe,v[3]=0,v[4]=G-Ce,v[5]=1-W-ge,v[6]=ie+fe,v[7]=0,v[8]=ee+pe,v[9]=ie-fe,v[10]=1-W-X,v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,v},qe.frustum=function(v,C,I,M,P,R,F){var B=1/(I-C),Z=1/(P-M),W=1/(R-F);return v[0]=2*R*B,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=2*R*Z,v[6]=0,v[7]=0,v[8]=(I+C)*B,v[9]=(P+M)*Z,v[10]=(F+R)*W,v[11]=-1,v[12]=0,v[13]=0,v[14]=F*R*2*W,v[15]=0,v},qe.perspectiveNO=w,qe.perspectiveZO=function(v,C,I,M,P){var R,F=1/Math.tan(C/2);return v[0]=F/I,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=F,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[11]=-1,v[12]=0,v[13]=0,v[15]=0,P!=null&&P!==1/0?(v[10]=P*(R=1/(M-P)),v[14]=P*M*R):(v[10]=-1,v[14]=-M),v},qe.perspectiveFromFieldOfView=function(v,C,I,M){var P=Math.tan(C.upDegrees*Math.PI/180),R=Math.tan(C.downDegrees*Math.PI/180),F=Math.tan(C.leftDegrees*Math.PI/180),B=Math.tan(C.rightDegrees*Math.PI/180),Z=2/(F+B),W=2/(P+R);return v[0]=Z,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=W,v[6]=0,v[7]=0,v[8]=-(F-B)*Z*.5,v[9]=(P-R)*W*.5,v[10]=M/(I-M),v[11]=-1,v[12]=0,v[13]=0,v[14]=M*I/(I-M),v[15]=0,v},qe.orthoNO=E,qe.orthoZO=function(v,C,I,M,P,R,F){var B=1/(C-I),Z=1/(M-P),W=1/(R-F);return v[0]=-2*B,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=-2*Z,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[10]=W,v[11]=0,v[12]=(C+I)*B,v[13]=(P+M)*Z,v[14]=R*W,v[15]=1,v},qe.lookAt=function(v,C,I,M){var P,R,F,B,Z,W,G,X,ee,ie,ge=C[0],fe=C[1],pe=C[2],Ce=M[0],_e=M[1],Me=M[2],Re=I[0],ke=I[1],Oe=I[2];return Math.abs(ge-Re)<r.EPSILON&&Math.abs(fe-ke)<r.EPSILON&&Math.abs(pe-Oe)<r.EPSILON?u(v):(G=ge-Re,X=fe-ke,ee=pe-Oe,P=_e*(ee*=ie=1/Math.hypot(G,X,ee))-Me*(X*=ie),R=Me*(G*=ie)-Ce*ee,F=Ce*X-_e*G,(ie=Math.hypot(P,R,F))?(P*=ie=1/ie,R*=ie,F*=ie):(P=0,R=0,F=0),B=X*F-ee*R,Z=ee*P-G*F,W=G*R-X*P,(ie=Math.hypot(B,Z,W))?(B*=ie=1/ie,Z*=ie,W*=ie):(B=0,Z=0,W=0),v[0]=P,v[1]=B,v[2]=G,v[3]=0,v[4]=R,v[5]=Z,v[6]=X,v[7]=0,v[8]=F,v[9]=W,v[10]=ee,v[11]=0,v[12]=-(P*ge+R*fe+F*pe),v[13]=-(B*ge+Z*fe+W*pe),v[14]=-(G*ge+X*fe+ee*pe),v[15]=1,v)},qe.targetTo=function(v,C,I,M){var P=C[0],R=C[1],F=C[2],B=M[0],Z=M[1],W=M[2],G=P-I[0],X=R-I[1],ee=F-I[2],ie=G*G+X*X+ee*ee;ie>0&&(G*=ie=1/Math.sqrt(ie),X*=ie,ee*=ie);var ge=Z*ee-W*X,fe=W*G-B*ee,pe=B*X-Z*G;return(ie=ge*ge+fe*fe+pe*pe)>0&&(ge*=ie=1/Math.sqrt(ie),fe*=ie,pe*=ie),v[0]=ge,v[1]=fe,v[2]=pe,v[3]=0,v[4]=X*pe-ee*fe,v[5]=ee*ge-G*pe,v[6]=G*fe-X*ge,v[7]=0,v[8]=G,v[9]=X,v[10]=ee,v[11]=0,v[12]=P,v[13]=R,v[14]=F,v[15]=1,v},qe.str=function(v){return"mat4("+v[0]+", "+v[1]+", "+v[2]+", "+v[3]+", "+v[4]+", "+v[5]+", "+v[6]+", "+v[7]+", "+v[8]+", "+v[9]+", "+v[10]+", "+v[11]+", "+v[12]+", "+v[13]+", "+v[14]+", "+v[15]+")"},qe.frob=function(v){return Math.hypot(v[0],v[1],v[2],v[3],v[4],v[5],v[6],v[7],v[8],v[9],v[10],v[11],v[12],v[13],v[14],v[15])},qe.add=function(v,C,I){return v[0]=C[0]+I[0],v[1]=C[1]+I[1],v[2]=C[2]+I[2],v[3]=C[3]+I[3],v[4]=C[4]+I[4],v[5]=C[5]+I[5],v[6]=C[6]+I[6],v[7]=C[7]+I[7],v[8]=C[8]+I[8],v[9]=C[9]+I[9],v[10]=C[10]+I[10],v[11]=C[11]+I[11],v[12]=C[12]+I[12],v[13]=C[13]+I[13],v[14]=C[14]+I[14],v[15]=C[15]+I[15],v},qe.subtract=A,qe.multiplyScalar=function(v,C,I){return v[0]=C[0]*I,v[1]=C[1]*I,v[2]=C[2]*I,v[3]=C[3]*I,v[4]=C[4]*I,v[5]=C[5]*I,v[6]=C[6]*I,v[7]=C[7]*I,v[8]=C[8]*I,v[9]=C[9]*I,v[10]=C[10]*I,v[11]=C[11]*I,v[12]=C[12]*I,v[13]=C[13]*I,v[14]=C[14]*I,v[15]=C[15]*I,v},qe.multiplyScalarAndAdd=function(v,C,I,M){return v[0]=C[0]+I[0]*M,v[1]=C[1]+I[1]*M,v[2]=C[2]+I[2]*M,v[3]=C[3]+I[3]*M,v[4]=C[4]+I[4]*M,v[5]=C[5]+I[5]*M,v[6]=C[6]+I[6]*M,v[7]=C[7]+I[7]*M,v[8]=C[8]+I[8]*M,v[9]=C[9]+I[9]*M,v[10]=C[10]+I[10]*M,v[11]=C[11]+I[11]*M,v[12]=C[12]+I[12]*M,v[13]=C[13]+I[13]*M,v[14]=C[14]+I[14]*M,v[15]=C[15]+I[15]*M,v},qe.exactEquals=function(v,C){return v[0]===C[0]&&v[1]===C[1]&&v[2]===C[2]&&v[3]===C[3]&&v[4]===C[4]&&v[5]===C[5]&&v[6]===C[6]&&v[7]===C[7]&&v[8]===C[8]&&v[9]===C[9]&&v[10]===C[10]&&v[11]===C[11]&&v[12]===C[12]&&v[13]===C[13]&&v[14]===C[14]&&v[15]===C[15]},qe.equals=function(v,C){var I=v[0],M=v[1],P=v[2],R=v[3],F=v[4],B=v[5],Z=v[6],W=v[7],G=v[8],X=v[9],ee=v[10],ie=v[11],ge=v[12],fe=v[13],pe=v[14],Ce=v[15],_e=C[0],Me=C[1],Re=C[2],ke=C[3],Oe=C[4],Le=C[5],Ge=C[6],Ve=C[7],He=C[8],gt=C[9],ft=C[10],Ft=C[11],xt=C[12],Et=C[13],_t=C[14],lr=C[15];return Math.abs(I-_e)<=r.EPSILON*Math.max(1,Math.abs(I),Math.abs(_e))&&Math.abs(M-Me)<=r.EPSILON*Math.max(1,Math.abs(M),Math.abs(Me))&&Math.abs(P-Re)<=r.EPSILON*Math.max(1,Math.abs(P),Math.abs(Re))&&Math.abs(R-ke)<=r.EPSILON*Math.max(1,Math.abs(R),Math.abs(ke))&&Math.abs(F-Oe)<=r.EPSILON*Math.max(1,Math.abs(F),Math.abs(Oe))&&Math.abs(B-Le)<=r.EPSILON*Math.max(1,Math.abs(B),Math.abs(Le))&&Math.abs(Z-Ge)<=r.EPSILON*Math.max(1,Math.abs(Z),Math.abs(Ge))&&Math.abs(W-Ve)<=r.EPSILON*Math.max(1,Math.abs(W),Math.abs(Ve))&&Math.abs(G-He)<=r.EPSILON*Math.max(1,Math.abs(G),Math.abs(He))&&Math.abs(X-gt)<=r.EPSILON*Math.max(1,Math.abs(X),Math.abs(gt))&&Math.abs(ee-ft)<=r.EPSILON*Math.max(1,Math.abs(ee),Math.abs(ft))&&Math.abs(ie-Ft)<=r.EPSILON*Math.max(1,Math.abs(ie),Math.abs(Ft))&&Math.abs(ge-xt)<=r.EPSILON*Math.max(1,Math.abs(ge),Math.abs(xt))&&Math.abs(fe-Et)<=r.EPSILON*Math.max(1,Math.abs(fe),Math.abs(Et))&&Math.abs(pe-_t)<=r.EPSILON*Math.max(1,Math.abs(pe),Math.abs(_t))&&Math.abs(Ce-lr)<=r.EPSILON*Math.max(1,Math.abs(Ce),Math.abs(lr))},qe.sub=qe.mul=qe.ortho=qe.perspective=void 0;var r=function(v,C){if(v&&v.__esModule)return v;if(v===null||c(v)!=="object"&&typeof v!="function")return{default:v};var I=o(void 0);if(I&&I.has(v))return I.get(v);var M={},P=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var R in v)if(R!=="default"&&Object.prototype.hasOwnProperty.call(v,R)){var F=P?Object.getOwnPropertyDescriptor(v,R):null;F&&(F.get||F.set)?Object.defineProperty(M,R,F):M[R]=v[R]}return M.default=v,I&&I.set(v,M),M}(q());function o(v){if(typeof WeakMap!="function")return null;var C=new WeakMap,I=new WeakMap;return(o=function(M){return M?I:C})(v)}function u(v){return v[0]=1,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=1,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[10]=1,v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,v}function p(v,C,I){var M=C[0],P=C[1],R=C[2],F=C[3],B=C[4],Z=C[5],W=C[6],G=C[7],X=C[8],ee=C[9],ie=C[10],ge=C[11],fe=C[12],pe=C[13],Ce=C[14],_e=C[15],Me=I[0],Re=I[1],ke=I[2],Oe=I[3];return v[0]=Me*M+Re*B+ke*X+Oe*fe,v[1]=Me*P+Re*Z+ke*ee+Oe*pe,v[2]=Me*R+Re*W+ke*ie+Oe*Ce,v[3]=Me*F+Re*G+ke*ge+Oe*_e,v[4]=(Me=I[4])*M+(Re=I[5])*B+(ke=I[6])*X+(Oe=I[7])*fe,v[5]=Me*P+Re*Z+ke*ee+Oe*pe,v[6]=Me*R+Re*W+ke*ie+Oe*Ce,v[7]=Me*F+Re*G+ke*ge+Oe*_e,v[8]=(Me=I[8])*M+(Re=I[9])*B+(ke=I[10])*X+(Oe=I[11])*fe,v[9]=Me*P+Re*Z+ke*ee+Oe*pe,v[10]=Me*R+Re*W+ke*ie+Oe*Ce,v[11]=Me*F+Re*G+ke*ge+Oe*_e,v[12]=(Me=I[12])*M+(Re=I[13])*B+(ke=I[14])*X+(Oe=I[15])*fe,v[13]=Me*P+Re*Z+ke*ee+Oe*pe,v[14]=Me*R+Re*W+ke*ie+Oe*Ce,v[15]=Me*F+Re*G+ke*ge+Oe*_e,v}function h(v,C,I){var M=C[0],P=C[1],R=C[2],F=C[3],B=M+M,Z=P+P,W=R+R,G=M*B,X=M*Z,ee=M*W,ie=P*Z,ge=P*W,fe=R*W,pe=F*B,Ce=F*Z,_e=F*W;return v[0]=1-(ie+fe),v[1]=X+_e,v[2]=ee-Ce,v[3]=0,v[4]=X-_e,v[5]=1-(G+fe),v[6]=ge+pe,v[7]=0,v[8]=ee+Ce,v[9]=ge-pe,v[10]=1-(G+ie),v[11]=0,v[12]=I[0],v[13]=I[1],v[14]=I[2],v[15]=1,v}function _(v,C){var I=C[4],M=C[5],P=C[6],R=C[8],F=C[9],B=C[10];return v[0]=Math.hypot(C[0],C[1],C[2]),v[1]=Math.hypot(I,M,P),v[2]=Math.hypot(R,F,B),v}function w(v,C,I,M,P){var R,F=1/Math.tan(C/2);return v[0]=F/I,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=F,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[11]=-1,v[12]=0,v[13]=0,v[15]=0,P!=null&&P!==1/0?(v[10]=(P+M)*(R=1/(M-P)),v[14]=2*P*M*R):(v[10]=-1,v[14]=-2*M),v}function E(v,C,I,M,P,R,F){var B=1/(C-I),Z=1/(M-P),W=1/(R-F);return v[0]=-2*B,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=-2*Z,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[10]=2*W,v[11]=0,v[12]=(C+I)*B,v[13]=(P+M)*Z,v[14]=(F+R)*W,v[15]=1,v}function A(v,C,I){return v[0]=C[0]-I[0],v[1]=C[1]-I[1],v[2]=C[2]-I[2],v[3]=C[3]-I[3],v[4]=C[4]-I[4],v[5]=C[5]-I[5],v[6]=C[6]-I[6],v[7]=C[7]-I[7],v[8]=C[8]-I[8],v[9]=C[9]-I[9],v[10]=C[10]-I[10],v[11]=C[11]-I[11],v[12]=C[12]-I[12],v[13]=C[13]-I[13],v[14]=C[14]-I[14],v[15]=C[15]-I[15],v}return qe.perspective=w,qe.ortho=E,qe.mul=p,qe.sub=A,qe}var pt,Ze={},yt={};function Mt(){if(pt)return yt;function c(P){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(R){return typeof R}:function(R){return R&&typeof Symbol=="function"&&R.constructor===Symbol&&R!==Symbol.prototype?"symbol":typeof R},c(P)}pt=1,Object.defineProperty(yt,"__esModule",{value:!0}),yt.create=u,yt.clone=function(P){var R=new r.ARRAY_TYPE(3);return R[0]=P[0],R[1]=P[1],R[2]=P[2],R},yt.length=p,yt.fromValues=function(P,R,F){var B=new r.ARRAY_TYPE(3);return B[0]=P,B[1]=R,B[2]=F,B},yt.copy=function(P,R){return P[0]=R[0],P[1]=R[1],P[2]=R[2],P},yt.set=function(P,R,F,B){return P[0]=R,P[1]=F,P[2]=B,P},yt.add=function(P,R,F){return P[0]=R[0]+F[0],P[1]=R[1]+F[1],P[2]=R[2]+F[2],P},yt.subtract=h,yt.multiply=_,yt.divide=w,yt.ceil=function(P,R){return P[0]=Math.ceil(R[0]),P[1]=Math.ceil(R[1]),P[2]=Math.ceil(R[2]),P},yt.floor=function(P,R){return P[0]=Math.floor(R[0]),P[1]=Math.floor(R[1]),P[2]=Math.floor(R[2]),P},yt.min=function(P,R,F){return P[0]=Math.min(R[0],F[0]),P[1]=Math.min(R[1],F[1]),P[2]=Math.min(R[2],F[2]),P},yt.max=function(P,R,F){return P[0]=Math.max(R[0],F[0]),P[1]=Math.max(R[1],F[1]),P[2]=Math.max(R[2],F[2]),P},yt.round=function(P,R){return P[0]=Math.round(R[0]),P[1]=Math.round(R[1]),P[2]=Math.round(R[2]),P},yt.scale=function(P,R,F){return P[0]=R[0]*F,P[1]=R[1]*F,P[2]=R[2]*F,P},yt.scaleAndAdd=function(P,R,F,B){return P[0]=R[0]+F[0]*B,P[1]=R[1]+F[1]*B,P[2]=R[2]+F[2]*B,P},yt.distance=E,yt.squaredDistance=A,yt.squaredLength=v,yt.negate=function(P,R){return P[0]=-R[0],P[1]=-R[1],P[2]=-R[2],P},yt.inverse=function(P,R){return P[0]=1/R[0],P[1]=1/R[1],P[2]=1/R[2],P},yt.normalize=function(P,R){var F=R[0],B=R[1],Z=R[2],W=F*F+B*B+Z*Z;return W>0&&(W=1/Math.sqrt(W)),P[0]=R[0]*W,P[1]=R[1]*W,P[2]=R[2]*W,P},yt.dot=C,yt.cross=function(P,R,F){var B=R[0],Z=R[1],W=R[2],G=F[0],X=F[1],ee=F[2];return P[0]=Z*ee-W*X,P[1]=W*G-B*ee,P[2]=B*X-Z*G,P},yt.lerp=function(P,R,F,B){var Z=R[0],W=R[1],G=R[2];return P[0]=Z+B*(F[0]-Z),P[1]=W+B*(F[1]-W),P[2]=G+B*(F[2]-G),P},yt.hermite=function(P,R,F,B,Z,W){var G=W*W,X=G*(2*W-3)+1,ee=G*(W-2)+W,ie=G*(W-1),ge=G*(3-2*W);return P[0]=R[0]*X+F[0]*ee+B[0]*ie+Z[0]*ge,P[1]=R[1]*X+F[1]*ee+B[1]*ie+Z[1]*ge,P[2]=R[2]*X+F[2]*ee+B[2]*ie+Z[2]*ge,P},yt.bezier=function(P,R,F,B,Z,W){var G=1-W,X=G*G,ee=W*W,ie=X*G,ge=3*W*X,fe=3*ee*G,pe=ee*W;return P[0]=R[0]*ie+F[0]*ge+B[0]*fe+Z[0]*pe,P[1]=R[1]*ie+F[1]*ge+B[1]*fe+Z[1]*pe,P[2]=R[2]*ie+F[2]*ge+B[2]*fe+Z[2]*pe,P},yt.random=function(P,R){R=R||1;var F=2*r.RANDOM()*Math.PI,B=2*r.RANDOM()-1,Z=Math.sqrt(1-B*B)*R;return P[0]=Math.cos(F)*Z,P[1]=Math.sin(F)*Z,P[2]=B*R,P},yt.transformMat4=function(P,R,F){var B=R[0],Z=R[1],W=R[2],G=F[3]*B+F[7]*Z+F[11]*W+F[15];return P[0]=(F[0]*B+F[4]*Z+F[8]*W+F[12])/(G=G||1),P[1]=(F[1]*B+F[5]*Z+F[9]*W+F[13])/G,P[2]=(F[2]*B+F[6]*Z+F[10]*W+F[14])/G,P},yt.transformMat3=function(P,R,F){var B=R[0],Z=R[1],W=R[2];return P[0]=B*F[0]+Z*F[3]+W*F[6],P[1]=B*F[1]+Z*F[4]+W*F[7],P[2]=B*F[2]+Z*F[5]+W*F[8],P},yt.transformQuat=function(P,R,F){var B=F[0],Z=F[1],W=F[2],G=R[0],X=R[1],ee=R[2],ie=Z*ee-W*X,ge=W*G-B*ee,fe=B*X-Z*G,pe=Z*fe-W*ge,Ce=W*ie-B*fe,_e=B*ge-Z*ie,Me=2*F[3];return ge*=Me,fe*=Me,Ce*=2,_e*=2,P[0]=G+(ie*=Me)+(pe*=2),P[1]=X+ge+Ce,P[2]=ee+fe+_e,P},yt.rotateX=function(P,R,F,B){var Z=[],W=[];return Z[0]=R[0]-F[0],Z[1]=R[1]-F[1],Z[2]=R[2]-F[2],W[0]=Z[0],W[1]=Z[1]*Math.cos(B)-Z[2]*Math.sin(B),W[2]=Z[1]*Math.sin(B)+Z[2]*Math.cos(B),P[0]=W[0]+F[0],P[1]=W[1]+F[1],P[2]=W[2]+F[2],P},yt.rotateY=function(P,R,F,B){var Z=[],W=[];return Z[0]=R[0]-F[0],Z[1]=R[1]-F[1],Z[2]=R[2]-F[2],W[0]=Z[2]*Math.sin(B)+Z[0]*Math.cos(B),W[1]=Z[1],W[2]=Z[2]*Math.cos(B)-Z[0]*Math.sin(B),P[0]=W[0]+F[0],P[1]=W[1]+F[1],P[2]=W[2]+F[2],P},yt.rotateZ=function(P,R,F,B){var Z=[],W=[];return Z[0]=R[0]-F[0],Z[1]=R[1]-F[1],Z[2]=R[2]-F[2],W[0]=Z[0]*Math.cos(B)-Z[1]*Math.sin(B),W[1]=Z[0]*Math.sin(B)+Z[1]*Math.cos(B),W[2]=Z[2],P[0]=W[0]+F[0],P[1]=W[1]+F[1],P[2]=W[2]+F[2],P},yt.angle=function(P,R){var F=P[0],B=P[1],Z=P[2],W=R[0],G=R[1],X=R[2],ee=Math.sqrt(F*F+B*B+Z*Z)*Math.sqrt(W*W+G*G+X*X),ie=ee&&C(P,R)/ee;return Math.acos(Math.min(Math.max(ie,-1),1))},yt.zero=function(P){return P[0]=0,P[1]=0,P[2]=0,P},yt.str=function(P){return"vec3("+P[0]+", "+P[1]+", "+P[2]+")"},yt.exactEquals=function(P,R){return P[0]===R[0]&&P[1]===R[1]&&P[2]===R[2]},yt.equals=function(P,R){var F=P[0],B=P[1],Z=P[2],W=R[0],G=R[1],X=R[2];return Math.abs(F-W)<=r.EPSILON*Math.max(1,Math.abs(F),Math.abs(W))&&Math.abs(B-G)<=r.EPSILON*Math.max(1,Math.abs(B),Math.abs(G))&&Math.abs(Z-X)<=r.EPSILON*Math.max(1,Math.abs(Z),Math.abs(X))},yt.forEach=yt.sqrLen=yt.len=yt.sqrDist=yt.dist=yt.div=yt.mul=yt.sub=void 0;var r=function(P,R){if(P&&P.__esModule)return P;if(P===null||c(P)!=="object"&&typeof P!="function")return{default:P};var F=o(void 0);if(F&&F.has(P))return F.get(P);var B={},Z=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var W in P)if(W!=="default"&&Object.prototype.hasOwnProperty.call(P,W)){var G=Z?Object.getOwnPropertyDescriptor(P,W):null;G&&(G.get||G.set)?Object.defineProperty(B,W,G):B[W]=P[W]}return B.default=P,F&&F.set(P,B),B}(q());function o(P){if(typeof WeakMap!="function")return null;var R=new WeakMap,F=new WeakMap;return(o=function(B){return B?F:R})(P)}function u(){var P=new r.ARRAY_TYPE(3);return r.ARRAY_TYPE!=Float32Array&&(P[0]=0,P[1]=0,P[2]=0),P}function p(P){return Math.hypot(P[0],P[1],P[2])}function h(P,R,F){return P[0]=R[0]-F[0],P[1]=R[1]-F[1],P[2]=R[2]-F[2],P}function _(P,R,F){return P[0]=R[0]*F[0],P[1]=R[1]*F[1],P[2]=R[2]*F[2],P}function w(P,R,F){return P[0]=R[0]/F[0],P[1]=R[1]/F[1],P[2]=R[2]/F[2],P}function E(P,R){return Math.hypot(R[0]-P[0],R[1]-P[1],R[2]-P[2])}function A(P,R){var F=R[0]-P[0],B=R[1]-P[1],Z=R[2]-P[2];return F*F+B*B+Z*Z}function v(P){var R=P[0],F=P[1],B=P[2];return R*R+F*F+B*B}function C(P,R){return P[0]*R[0]+P[1]*R[1]+P[2]*R[2]}yt.sub=h,yt.mul=_,yt.div=w,yt.dist=E,yt.sqrDist=A,yt.len=p,yt.sqrLen=v;var I,M=(I=u(),function(P,R,F,B,Z,W){var G,X;for(R||(R=3),F||(F=0),X=B?Math.min(B*R+F,P.length):P.length,G=F;G<X;G+=R)I[0]=P[G],I[1]=P[G+1],I[2]=P[G+2],Z(I,I,W),P[G]=I[0],P[G+1]=I[1],P[G+2]=I[2];return P});return yt.forEach=M,yt}var Jt,jt,Pt={};function Wt(){if(Jt)return Pt;function c(M){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(P){return typeof P}:function(P){return P&&typeof Symbol=="function"&&P.constructor===Symbol&&P!==Symbol.prototype?"symbol":typeof P},c(M)}Jt=1,Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.create=u,Pt.clone=function(M){var P=new r.ARRAY_TYPE(4);return P[0]=M[0],P[1]=M[1],P[2]=M[2],P[3]=M[3],P},Pt.fromValues=function(M,P,R,F){var B=new r.ARRAY_TYPE(4);return B[0]=M,B[1]=P,B[2]=R,B[3]=F,B},Pt.copy=function(M,P){return M[0]=P[0],M[1]=P[1],M[2]=P[2],M[3]=P[3],M},Pt.set=function(M,P,R,F,B){return M[0]=P,M[1]=R,M[2]=F,M[3]=B,M},Pt.add=function(M,P,R){return M[0]=P[0]+R[0],M[1]=P[1]+R[1],M[2]=P[2]+R[2],M[3]=P[3]+R[3],M},Pt.subtract=p,Pt.multiply=h,Pt.divide=_,Pt.ceil=function(M,P){return M[0]=Math.ceil(P[0]),M[1]=Math.ceil(P[1]),M[2]=Math.ceil(P[2]),M[3]=Math.ceil(P[3]),M},Pt.floor=function(M,P){return M[0]=Math.floor(P[0]),M[1]=Math.floor(P[1]),M[2]=Math.floor(P[2]),M[3]=Math.floor(P[3]),M},Pt.min=function(M,P,R){return M[0]=Math.min(P[0],R[0]),M[1]=Math.min(P[1],R[1]),M[2]=Math.min(P[2],R[2]),M[3]=Math.min(P[3],R[3]),M},Pt.max=function(M,P,R){return M[0]=Math.max(P[0],R[0]),M[1]=Math.max(P[1],R[1]),M[2]=Math.max(P[2],R[2]),M[3]=Math.max(P[3],R[3]),M},Pt.round=function(M,P){return M[0]=Math.round(P[0]),M[1]=Math.round(P[1]),M[2]=Math.round(P[2]),M[3]=Math.round(P[3]),M},Pt.scale=function(M,P,R){return M[0]=P[0]*R,M[1]=P[1]*R,M[2]=P[2]*R,M[3]=P[3]*R,M},Pt.scaleAndAdd=function(M,P,R,F){return M[0]=P[0]+R[0]*F,M[1]=P[1]+R[1]*F,M[2]=P[2]+R[2]*F,M[3]=P[3]+R[3]*F,M},Pt.distance=w,Pt.squaredDistance=E,Pt.length=A,Pt.squaredLength=v,Pt.negate=function(M,P){return M[0]=-P[0],M[1]=-P[1],M[2]=-P[2],M[3]=-P[3],M},Pt.inverse=function(M,P){return M[0]=1/P[0],M[1]=1/P[1],M[2]=1/P[2],M[3]=1/P[3],M},Pt.normalize=function(M,P){var R=P[0],F=P[1],B=P[2],Z=P[3],W=R*R+F*F+B*B+Z*Z;return W>0&&(W=1/Math.sqrt(W)),M[0]=R*W,M[1]=F*W,M[2]=B*W,M[3]=Z*W,M},Pt.dot=function(M,P){return M[0]*P[0]+M[1]*P[1]+M[2]*P[2]+M[3]*P[3]},Pt.cross=function(M,P,R,F){var B=R[0]*F[1]-R[1]*F[0],Z=R[0]*F[2]-R[2]*F[0],W=R[0]*F[3]-R[3]*F[0],G=R[1]*F[2]-R[2]*F[1],X=R[1]*F[3]-R[3]*F[1],ee=R[2]*F[3]-R[3]*F[2],ie=P[0],ge=P[1],fe=P[2],pe=P[3];return M[0]=ge*ee-fe*X+pe*G,M[1]=-ie*ee+fe*W-pe*Z,M[2]=ie*X-ge*W+pe*B,M[3]=-ie*G+ge*Z-fe*B,M},Pt.lerp=function(M,P,R,F){var B=P[0],Z=P[1],W=P[2],G=P[3];return M[0]=B+F*(R[0]-B),M[1]=Z+F*(R[1]-Z),M[2]=W+F*(R[2]-W),M[3]=G+F*(R[3]-G),M},Pt.random=function(M,P){var R,F,B,Z,W,G;P=P||1;do W=(R=2*r.RANDOM()-1)*R+(F=2*r.RANDOM()-1)*F;while(W>=1);do G=(B=2*r.RANDOM()-1)*B+(Z=2*r.RANDOM()-1)*Z;while(G>=1);var X=Math.sqrt((1-W)/G);return M[0]=P*R,M[1]=P*F,M[2]=P*B*X,M[3]=P*Z*X,M},Pt.transformMat4=function(M,P,R){var F=P[0],B=P[1],Z=P[2],W=P[3];return M[0]=R[0]*F+R[4]*B+R[8]*Z+R[12]*W,M[1]=R[1]*F+R[5]*B+R[9]*Z+R[13]*W,M[2]=R[2]*F+R[6]*B+R[10]*Z+R[14]*W,M[3]=R[3]*F+R[7]*B+R[11]*Z+R[15]*W,M},Pt.transformQuat=function(M,P,R){var F=P[0],B=P[1],Z=P[2],W=R[0],G=R[1],X=R[2],ee=R[3],ie=ee*F+G*Z-X*B,ge=ee*B+X*F-W*Z,fe=ee*Z+W*B-G*F,pe=-W*F-G*B-X*Z;return M[0]=ie*ee+pe*-W+ge*-X-fe*-G,M[1]=ge*ee+pe*-G+fe*-W-ie*-X,M[2]=fe*ee+pe*-X+ie*-G-ge*-W,M[3]=P[3],M},Pt.zero=function(M){return M[0]=0,M[1]=0,M[2]=0,M[3]=0,M},Pt.str=function(M){return"vec4("+M[0]+", "+M[1]+", "+M[2]+", "+M[3]+")"},Pt.exactEquals=function(M,P){return M[0]===P[0]&&M[1]===P[1]&&M[2]===P[2]&&M[3]===P[3]},Pt.equals=function(M,P){var R=M[0],F=M[1],B=M[2],Z=M[3],W=P[0],G=P[1],X=P[2],ee=P[3];return Math.abs(R-W)<=r.EPSILON*Math.max(1,Math.abs(R),Math.abs(W))&&Math.abs(F-G)<=r.EPSILON*Math.max(1,Math.abs(F),Math.abs(G))&&Math.abs(B-X)<=r.EPSILON*Math.max(1,Math.abs(B),Math.abs(X))&&Math.abs(Z-ee)<=r.EPSILON*Math.max(1,Math.abs(Z),Math.abs(ee))},Pt.forEach=Pt.sqrLen=Pt.len=Pt.sqrDist=Pt.dist=Pt.div=Pt.mul=Pt.sub=void 0;var r=function(M,P){if(M&&M.__esModule)return M;if(M===null||c(M)!=="object"&&typeof M!="function")return{default:M};var R=o(void 0);if(R&&R.has(M))return R.get(M);var F={},B=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Z in M)if(Z!=="default"&&Object.prototype.hasOwnProperty.call(M,Z)){var W=B?Object.getOwnPropertyDescriptor(M,Z):null;W&&(W.get||W.set)?Object.defineProperty(F,Z,W):F[Z]=M[Z]}return F.default=M,R&&R.set(M,F),F}(q());function o(M){if(typeof WeakMap!="function")return null;var P=new WeakMap,R=new WeakMap;return(o=function(F){return F?R:P})(M)}function u(){var M=new r.ARRAY_TYPE(4);return r.ARRAY_TYPE!=Float32Array&&(M[0]=0,M[1]=0,M[2]=0,M[3]=0),M}function p(M,P,R){return M[0]=P[0]-R[0],M[1]=P[1]-R[1],M[2]=P[2]-R[2],M[3]=P[3]-R[3],M}function h(M,P,R){return M[0]=P[0]*R[0],M[1]=P[1]*R[1],M[2]=P[2]*R[2],M[3]=P[3]*R[3],M}function _(M,P,R){return M[0]=P[0]/R[0],M[1]=P[1]/R[1],M[2]=P[2]/R[2],M[3]=P[3]/R[3],M}function w(M,P){return Math.hypot(P[0]-M[0],P[1]-M[1],P[2]-M[2],P[3]-M[3])}function E(M,P){var R=P[0]-M[0],F=P[1]-M[1],B=P[2]-M[2],Z=P[3]-M[3];return R*R+F*F+B*B+Z*Z}function A(M){return Math.hypot(M[0],M[1],M[2],M[3])}function v(M){var P=M[0],R=M[1],F=M[2],B=M[3];return P*P+R*R+F*F+B*B}Pt.sub=p,Pt.mul=h,Pt.div=_,Pt.dist=w,Pt.sqrDist=E,Pt.len=A,Pt.sqrLen=v;var C,I=(C=u(),function(M,P,R,F,B,Z){var W,G;for(P||(P=4),R||(R=0),G=F?Math.min(F*P+R,M.length):M.length,W=R;W<G;W+=P)C[0]=M[W],C[1]=M[W+1],C[2]=M[W+2],C[3]=M[W+3],B(C,C,Z),M[W]=C[0],M[W+1]=C[1],M[W+2]=C[2],M[W+3]=C[3];return M});return Pt.forEach=I,Pt}function Nt(){if(jt)return Ze;function c(_e){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Me){return typeof Me}:function(Me){return Me&&typeof Symbol=="function"&&Me.constructor===Symbol&&Me!==Symbol.prototype?"symbol":typeof Me},c(_e)}jt=1,Object.defineProperty(Ze,"__esModule",{value:!0}),Ze.create=w,Ze.identity=function(_e){return _e[0]=0,_e[1]=0,_e[2]=0,_e[3]=1,_e},Ze.setAxisAngle=E,Ze.getAxisAngle=function(_e,Me){var Re=2*Math.acos(Me[3]),ke=Math.sin(Re/2);return ke>r.EPSILON?(_e[0]=Me[0]/ke,_e[1]=Me[1]/ke,_e[2]=Me[2]/ke):(_e[0]=1,_e[1]=0,_e[2]=0),Re},Ze.getAngle=function(_e,Me){var Re=R(_e,Me);return Math.acos(2*Re*Re-1)},Ze.multiply=A,Ze.rotateX=function(_e,Me,Re){Re*=.5;var ke=Me[0],Oe=Me[1],Le=Me[2],Ge=Me[3],Ve=Math.sin(Re),He=Math.cos(Re);return _e[0]=ke*He+Ge*Ve,_e[1]=Oe*He+Le*Ve,_e[2]=Le*He-Oe*Ve,_e[3]=Ge*He-ke*Ve,_e},Ze.rotateY=function(_e,Me,Re){Re*=.5;var ke=Me[0],Oe=Me[1],Le=Me[2],Ge=Me[3],Ve=Math.sin(Re),He=Math.cos(Re);return _e[0]=ke*He-Le*Ve,_e[1]=Oe*He+Ge*Ve,_e[2]=Le*He+ke*Ve,_e[3]=Ge*He-Oe*Ve,_e},Ze.rotateZ=function(_e,Me,Re){Re*=.5;var ke=Me[0],Oe=Me[1],Le=Me[2],Ge=Me[3],Ve=Math.sin(Re),He=Math.cos(Re);return _e[0]=ke*He+Oe*Ve,_e[1]=Oe*He-ke*Ve,_e[2]=Le*He+Ge*Ve,_e[3]=Ge*He-Le*Ve,_e},Ze.calculateW=function(_e,Me){var Re=Me[0],ke=Me[1],Oe=Me[2];return _e[0]=Re,_e[1]=ke,_e[2]=Oe,_e[3]=Math.sqrt(Math.abs(1-Re*Re-ke*ke-Oe*Oe)),_e},Ze.exp=v,Ze.ln=C,Ze.pow=function(_e,Me,Re){return C(_e,Me),P(_e,_e,Re),v(_e,_e),_e},Ze.slerp=I,Ze.random=function(_e){var Me=r.RANDOM(),Re=r.RANDOM(),ke=r.RANDOM(),Oe=Math.sqrt(1-Me),Le=Math.sqrt(Me);return _e[0]=Oe*Math.sin(2*Math.PI*Re),_e[1]=Oe*Math.cos(2*Math.PI*Re),_e[2]=Le*Math.sin(2*Math.PI*ke),_e[3]=Le*Math.cos(2*Math.PI*ke),_e},Ze.invert=function(_e,Me){var Re=Me[0],ke=Me[1],Oe=Me[2],Le=Me[3],Ge=Re*Re+ke*ke+Oe*Oe+Le*Le,Ve=Ge?1/Ge:0;return _e[0]=-Re*Ve,_e[1]=-ke*Ve,_e[2]=-Oe*Ve,_e[3]=Le*Ve,_e},Ze.conjugate=function(_e,Me){return _e[0]=-Me[0],_e[1]=-Me[1],_e[2]=-Me[2],_e[3]=Me[3],_e},Ze.fromMat3=M,Ze.fromEuler=function(_e,Me,Re,ke){var Oe=.5*Math.PI/180;Me*=Oe,Re*=Oe,ke*=Oe;var Le=Math.sin(Me),Ge=Math.cos(Me),Ve=Math.sin(Re),He=Math.cos(Re),gt=Math.sin(ke),ft=Math.cos(ke);return _e[0]=Le*He*ft-Ge*Ve*gt,_e[1]=Ge*Ve*ft+Le*He*gt,_e[2]=Ge*He*gt-Le*Ve*ft,_e[3]=Ge*He*ft+Le*Ve*gt,_e},Ze.str=function(_e){return"quat("+_e[0]+", "+_e[1]+", "+_e[2]+", "+_e[3]+")"},Ze.setAxes=Ze.sqlerp=Ze.rotationTo=Ze.equals=Ze.exactEquals=Ze.normalize=Ze.sqrLen=Ze.squaredLength=Ze.len=Ze.length=Ze.lerp=Ze.dot=Ze.scale=Ze.mul=Ze.add=Ze.set=Ze.copy=Ze.fromValues=Ze.clone=void 0;var r=_(q()),o=_(je()),u=_(Mt()),p=_(Wt());function h(_e){if(typeof WeakMap!="function")return null;var Me=new WeakMap,Re=new WeakMap;return(h=function(ke){return ke?Re:Me})(_e)}function _(_e,Me){if(_e&&_e.__esModule)return _e;if(_e===null||c(_e)!=="object"&&typeof _e!="function")return{default:_e};var Re=h(Me);if(Re&&Re.has(_e))return Re.get(_e);var ke={},Oe=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Le in _e)if(Le!=="default"&&Object.prototype.hasOwnProperty.call(_e,Le)){var Ge=Oe?Object.getOwnPropertyDescriptor(_e,Le):null;Ge&&(Ge.get||Ge.set)?Object.defineProperty(ke,Le,Ge):ke[Le]=_e[Le]}return ke.default=_e,Re&&Re.set(_e,ke),ke}function w(){var _e=new r.ARRAY_TYPE(4);return r.ARRAY_TYPE!=Float32Array&&(_e[0]=0,_e[1]=0,_e[2]=0),_e[3]=1,_e}function E(_e,Me,Re){Re*=.5;var ke=Math.sin(Re);return _e[0]=ke*Me[0],_e[1]=ke*Me[1],_e[2]=ke*Me[2],_e[3]=Math.cos(Re),_e}function A(_e,Me,Re){var ke=Me[0],Oe=Me[1],Le=Me[2],Ge=Me[3],Ve=Re[0],He=Re[1],gt=Re[2],ft=Re[3];return _e[0]=ke*ft+Ge*Ve+Oe*gt-Le*He,_e[1]=Oe*ft+Ge*He+Le*Ve-ke*gt,_e[2]=Le*ft+Ge*gt+ke*He-Oe*Ve,_e[3]=Ge*ft-ke*Ve-Oe*He-Le*gt,_e}function v(_e,Me){var Re=Me[0],ke=Me[1],Oe=Me[2],Le=Me[3],Ge=Math.sqrt(Re*Re+ke*ke+Oe*Oe),Ve=Math.exp(Le),He=Ge>0?Ve*Math.sin(Ge)/Ge:0;return _e[0]=Re*He,_e[1]=ke*He,_e[2]=Oe*He,_e[3]=Ve*Math.cos(Ge),_e}function C(_e,Me){var Re=Me[0],ke=Me[1],Oe=Me[2],Le=Me[3],Ge=Math.sqrt(Re*Re+ke*ke+Oe*Oe),Ve=Ge>0?Math.atan2(Ge,Le)/Ge:0;return _e[0]=Re*Ve,_e[1]=ke*Ve,_e[2]=Oe*Ve,_e[3]=.5*Math.log(Re*Re+ke*ke+Oe*Oe+Le*Le),_e}function I(_e,Me,Re,ke){var Oe,Le,Ge,Ve,He,gt=Me[0],ft=Me[1],Ft=Me[2],xt=Me[3],Et=Re[0],_t=Re[1],lr=Re[2],Dt=Re[3];return(Le=gt*Et+ft*_t+Ft*lr+xt*Dt)<0&&(Le=-Le,Et=-Et,_t=-_t,lr=-lr,Dt=-Dt),1-Le>r.EPSILON?(Oe=Math.acos(Le),Ge=Math.sin(Oe),Ve=Math.sin((1-ke)*Oe)/Ge,He=Math.sin(ke*Oe)/Ge):(Ve=1-ke,He=ke),_e[0]=Ve*gt+He*Et,_e[1]=Ve*ft+He*_t,_e[2]=Ve*Ft+He*lr,_e[3]=Ve*xt+He*Dt,_e}function M(_e,Me){var Re,ke=Me[0]+Me[4]+Me[8];if(ke>0)Re=Math.sqrt(ke+1),_e[3]=.5*Re,_e[0]=(Me[5]-Me[7])*(Re=.5/Re),_e[1]=(Me[6]-Me[2])*Re,_e[2]=(Me[1]-Me[3])*Re;else{var Oe=0;Me[4]>Me[0]&&(Oe=1),Me[8]>Me[3*Oe+Oe]&&(Oe=2);var Le=(Oe+1)%3,Ge=(Oe+2)%3;Re=Math.sqrt(Me[3*Oe+Oe]-Me[3*Le+Le]-Me[3*Ge+Ge]+1),_e[Oe]=.5*Re,_e[3]=(Me[3*Le+Ge]-Me[3*Ge+Le])*(Re=.5/Re),_e[Le]=(Me[3*Le+Oe]+Me[3*Oe+Le])*Re,_e[Ge]=(Me[3*Ge+Oe]+Me[3*Oe+Ge])*Re}return _e}Ze.clone=p.clone,Ze.fromValues=p.fromValues,Ze.copy=p.copy,Ze.set=p.set,Ze.add=p.add,Ze.mul=A;var P=p.scale;Ze.scale=P;var R=p.dot;Ze.dot=R,Ze.lerp=p.lerp;var F=p.length;Ze.length=F,Ze.len=F;var B=p.squaredLength;Ze.squaredLength=B,Ze.sqrLen=B;var Z=p.normalize;Ze.normalize=Z,Ze.exactEquals=p.exactEquals,Ze.equals=p.equals;var W,G,X,ee=(W=u.create(),G=u.fromValues(1,0,0),X=u.fromValues(0,1,0),function(_e,Me,Re){var ke=u.dot(Me,Re);return ke<-.999999?(u.cross(W,G,Me),u.len(W)<1e-6&&u.cross(W,X,Me),u.normalize(W,W),E(_e,W,Math.PI),_e):ke>.999999?(_e[0]=0,_e[1]=0,_e[2]=0,_e[3]=1,_e):(u.cross(W,Me,Re),_e[0]=W[0],_e[1]=W[1],_e[2]=W[2],_e[3]=1+ke,Z(_e,_e))});Ze.rotationTo=ee;var ie,ge,fe=(ie=w(),ge=w(),function(_e,Me,Re,ke,Oe,Le){return I(ie,Me,Oe,Le),I(ge,Re,ke,Le),I(_e,ie,ge,2*Le*(1-Le)),_e});Ze.sqlerp=fe;var pe,Ce=(pe=o.create(),function(_e,Me,Re,ke){return pe[0]=Re[0],pe[3]=Re[1],pe[6]=Re[2],pe[1]=ke[0],pe[4]=ke[1],pe[7]=ke[2],pe[2]=-Me[0],pe[5]=-Me[1],pe[8]=-Me[2],Z(_e,M(_e,pe))});return Ze.setAxes=Ce,Ze}var Xe,nt={};function Qt(){if(Xe)return nt;function c(I){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(M){return typeof M}:function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M},c(I)}Xe=1,Object.defineProperty(nt,"__esModule",{value:!0}),nt.create=function(){var I=new r.ARRAY_TYPE(8);return r.ARRAY_TYPE!=Float32Array&&(I[0]=0,I[1]=0,I[2]=0,I[4]=0,I[5]=0,I[6]=0,I[7]=0),I[3]=1,I},nt.clone=function(I){var M=new r.ARRAY_TYPE(8);return M[0]=I[0],M[1]=I[1],M[2]=I[2],M[3]=I[3],M[4]=I[4],M[5]=I[5],M[6]=I[6],M[7]=I[7],M},nt.fromValues=function(I,M,P,R,F,B,Z,W){var G=new r.ARRAY_TYPE(8);return G[0]=I,G[1]=M,G[2]=P,G[3]=R,G[4]=F,G[5]=B,G[6]=Z,G[7]=W,G},nt.fromRotationTranslationValues=function(I,M,P,R,F,B,Z){var W=new r.ARRAY_TYPE(8);W[0]=I,W[1]=M,W[2]=P,W[3]=R;var G=.5*F,X=.5*B,ee=.5*Z;return W[4]=G*R+X*P-ee*M,W[5]=X*R+ee*I-G*P,W[6]=ee*R+G*M-X*I,W[7]=-G*I-X*M-ee*P,W},nt.fromRotationTranslation=_,nt.fromTranslation=function(I,M){return I[0]=0,I[1]=0,I[2]=0,I[3]=1,I[4]=.5*M[0],I[5]=.5*M[1],I[6]=.5*M[2],I[7]=0,I},nt.fromRotation=function(I,M){return I[0]=M[0],I[1]=M[1],I[2]=M[2],I[3]=M[3],I[4]=0,I[5]=0,I[6]=0,I[7]=0,I},nt.fromMat4=function(I,M){var P=o.create();u.getRotation(P,M);var R=new r.ARRAY_TYPE(3);return u.getTranslation(R,M),_(I,P,R),I},nt.copy=w,nt.identity=function(I){return I[0]=0,I[1]=0,I[2]=0,I[3]=1,I[4]=0,I[5]=0,I[6]=0,I[7]=0,I},nt.set=function(I,M,P,R,F,B,Z,W,G){return I[0]=M,I[1]=P,I[2]=R,I[3]=F,I[4]=B,I[5]=Z,I[6]=W,I[7]=G,I},nt.getDual=function(I,M){return I[0]=M[4],I[1]=M[5],I[2]=M[6],I[3]=M[7],I},nt.setDual=function(I,M){return I[4]=M[0],I[5]=M[1],I[6]=M[2],I[7]=M[3],I},nt.getTranslation=function(I,M){var P=M[4],R=M[5],F=M[6],B=M[7],Z=-M[0],W=-M[1],G=-M[2],X=M[3];return I[0]=2*(P*X+B*Z+R*G-F*W),I[1]=2*(R*X+B*W+F*Z-P*G),I[2]=2*(F*X+B*G+P*W-R*Z),I},nt.translate=function(I,M,P){var R=M[0],F=M[1],B=M[2],Z=M[3],W=.5*P[0],G=.5*P[1],X=.5*P[2],ee=M[4],ie=M[5],ge=M[6],fe=M[7];return I[0]=R,I[1]=F,I[2]=B,I[3]=Z,I[4]=Z*W+F*X-B*G+ee,I[5]=Z*G+B*W-R*X+ie,I[6]=Z*X+R*G-F*W+ge,I[7]=-R*W-F*G-B*X+fe,I},nt.rotateX=function(I,M,P){var R=-M[0],F=-M[1],B=-M[2],Z=M[3],W=M[4],G=M[5],X=M[6],ee=M[7],ie=W*Z+ee*R+G*B-X*F,ge=G*Z+ee*F+X*R-W*B,fe=X*Z+ee*B+W*F-G*R,pe=ee*Z-W*R-G*F-X*B;return o.rotateX(I,M,P),I[4]=ie*(Z=I[3])+pe*(R=I[0])+ge*(B=I[2])-fe*(F=I[1]),I[5]=ge*Z+pe*F+fe*R-ie*B,I[6]=fe*Z+pe*B+ie*F-ge*R,I[7]=pe*Z-ie*R-ge*F-fe*B,I},nt.rotateY=function(I,M,P){var R=-M[0],F=-M[1],B=-M[2],Z=M[3],W=M[4],G=M[5],X=M[6],ee=M[7],ie=W*Z+ee*R+G*B-X*F,ge=G*Z+ee*F+X*R-W*B,fe=X*Z+ee*B+W*F-G*R,pe=ee*Z-W*R-G*F-X*B;return o.rotateY(I,M,P),I[4]=ie*(Z=I[3])+pe*(R=I[0])+ge*(B=I[2])-fe*(F=I[1]),I[5]=ge*Z+pe*F+fe*R-ie*B,I[6]=fe*Z+pe*B+ie*F-ge*R,I[7]=pe*Z-ie*R-ge*F-fe*B,I},nt.rotateZ=function(I,M,P){var R=-M[0],F=-M[1],B=-M[2],Z=M[3],W=M[4],G=M[5],X=M[6],ee=M[7],ie=W*Z+ee*R+G*B-X*F,ge=G*Z+ee*F+X*R-W*B,fe=X*Z+ee*B+W*F-G*R,pe=ee*Z-W*R-G*F-X*B;return o.rotateZ(I,M,P),I[4]=ie*(Z=I[3])+pe*(R=I[0])+ge*(B=I[2])-fe*(F=I[1]),I[5]=ge*Z+pe*F+fe*R-ie*B,I[6]=fe*Z+pe*B+ie*F-ge*R,I[7]=pe*Z-ie*R-ge*F-fe*B,I},nt.rotateByQuatAppend=function(I,M,P){var R=P[0],F=P[1],B=P[2],Z=P[3],W=M[0],G=M[1],X=M[2],ee=M[3];return I[0]=W*Z+ee*R+G*B-X*F,I[1]=G*Z+ee*F+X*R-W*B,I[2]=X*Z+ee*B+W*F-G*R,I[3]=ee*Z-W*R-G*F-X*B,I[4]=(W=M[4])*Z+(ee=M[7])*R+(G=M[5])*B-(X=M[6])*F,I[5]=G*Z+ee*F+X*R-W*B,I[6]=X*Z+ee*B+W*F-G*R,I[7]=ee*Z-W*R-G*F-X*B,I},nt.rotateByQuatPrepend=function(I,M,P){var R=M[0],F=M[1],B=M[2],Z=M[3],W=P[0],G=P[1],X=P[2],ee=P[3];return I[0]=R*ee+Z*W+F*X-B*G,I[1]=F*ee+Z*G+B*W-R*X,I[2]=B*ee+Z*X+R*G-F*W,I[3]=Z*ee-R*W-F*G-B*X,I[4]=R*(ee=P[7])+Z*(W=P[4])+F*(X=P[6])-B*(G=P[5]),I[5]=F*ee+Z*G+B*W-R*X,I[6]=B*ee+Z*X+R*G-F*W,I[7]=Z*ee-R*W-F*G-B*X,I},nt.rotateAroundAxis=function(I,M,P,R){if(Math.abs(R)<r.EPSILON)return w(I,M);var F=Math.hypot(P[0],P[1],P[2]);R*=.5;var B=Math.sin(R),Z=B*P[0]/F,W=B*P[1]/F,G=B*P[2]/F,X=Math.cos(R),ee=M[0],ie=M[1],ge=M[2],fe=M[3];I[0]=ee*X+fe*Z+ie*G-ge*W,I[1]=ie*X+fe*W+ge*Z-ee*G,I[2]=ge*X+fe*G+ee*W-ie*Z,I[3]=fe*X-ee*Z-ie*W-ge*G;var pe=M[4],Ce=M[5],_e=M[6],Me=M[7];return I[4]=pe*X+Me*Z+Ce*G-_e*W,I[5]=Ce*X+Me*W+_e*Z-pe*G,I[6]=_e*X+Me*G+pe*W-Ce*Z,I[7]=Me*X-pe*Z-Ce*W-_e*G,I},nt.add=function(I,M,P){return I[0]=M[0]+P[0],I[1]=M[1]+P[1],I[2]=M[2]+P[2],I[3]=M[3]+P[3],I[4]=M[4]+P[4],I[5]=M[5]+P[5],I[6]=M[6]+P[6],I[7]=M[7]+P[7],I},nt.multiply=E,nt.scale=function(I,M,P){return I[0]=M[0]*P,I[1]=M[1]*P,I[2]=M[2]*P,I[3]=M[3]*P,I[4]=M[4]*P,I[5]=M[5]*P,I[6]=M[6]*P,I[7]=M[7]*P,I},nt.lerp=function(I,M,P,R){var F=1-R;return A(M,P)<0&&(R=-R),I[0]=M[0]*F+P[0]*R,I[1]=M[1]*F+P[1]*R,I[2]=M[2]*F+P[2]*R,I[3]=M[3]*F+P[3]*R,I[4]=M[4]*F+P[4]*R,I[5]=M[5]*F+P[5]*R,I[6]=M[6]*F+P[6]*R,I[7]=M[7]*F+P[7]*R,I},nt.invert=function(I,M){var P=C(M);return I[0]=-M[0]/P,I[1]=-M[1]/P,I[2]=-M[2]/P,I[3]=M[3]/P,I[4]=-M[4]/P,I[5]=-M[5]/P,I[6]=-M[6]/P,I[7]=M[7]/P,I},nt.conjugate=function(I,M){return I[0]=-M[0],I[1]=-M[1],I[2]=-M[2],I[3]=M[3],I[4]=-M[4],I[5]=-M[5],I[6]=-M[6],I[7]=M[7],I},nt.normalize=function(I,M){var P=C(M);if(P>0){P=Math.sqrt(P);var R=M[0]/P,F=M[1]/P,B=M[2]/P,Z=M[3]/P,W=M[4],G=M[5],X=M[6],ee=M[7],ie=R*W+F*G+B*X+Z*ee;I[0]=R,I[1]=F,I[2]=B,I[3]=Z,I[4]=(W-R*ie)/P,I[5]=(G-F*ie)/P,I[6]=(X-B*ie)/P,I[7]=(ee-Z*ie)/P}return I},nt.str=function(I){return"quat2("+I[0]+", "+I[1]+", "+I[2]+", "+I[3]+", "+I[4]+", "+I[5]+", "+I[6]+", "+I[7]+")"},nt.exactEquals=function(I,M){return I[0]===M[0]&&I[1]===M[1]&&I[2]===M[2]&&I[3]===M[3]&&I[4]===M[4]&&I[5]===M[5]&&I[6]===M[6]&&I[7]===M[7]},nt.equals=function(I,M){var P=I[0],R=I[1],F=I[2],B=I[3],Z=I[4],W=I[5],G=I[6],X=I[7],ee=M[0],ie=M[1],ge=M[2],fe=M[3],pe=M[4],Ce=M[5],_e=M[6],Me=M[7];return Math.abs(P-ee)<=r.EPSILON*Math.max(1,Math.abs(P),Math.abs(ee))&&Math.abs(R-ie)<=r.EPSILON*Math.max(1,Math.abs(R),Math.abs(ie))&&Math.abs(F-ge)<=r.EPSILON*Math.max(1,Math.abs(F),Math.abs(ge))&&Math.abs(B-fe)<=r.EPSILON*Math.max(1,Math.abs(B),Math.abs(fe))&&Math.abs(Z-pe)<=r.EPSILON*Math.max(1,Math.abs(Z),Math.abs(pe))&&Math.abs(W-Ce)<=r.EPSILON*Math.max(1,Math.abs(W),Math.abs(Ce))&&Math.abs(G-_e)<=r.EPSILON*Math.max(1,Math.abs(G),Math.abs(_e))&&Math.abs(X-Me)<=r.EPSILON*Math.max(1,Math.abs(X),Math.abs(Me))},nt.sqrLen=nt.squaredLength=nt.len=nt.length=nt.dot=nt.mul=nt.setReal=nt.getReal=void 0;var r=h(q()),o=h(Nt()),u=h(ct());function p(I){if(typeof WeakMap!="function")return null;var M=new WeakMap,P=new WeakMap;return(p=function(R){return R?P:M})(I)}function h(I,M){if(I&&I.__esModule)return I;if(I===null||c(I)!=="object"&&typeof I!="function")return{default:I};var P=p(M);if(P&&P.has(I))return P.get(I);var R={},F=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var B in I)if(B!=="default"&&Object.prototype.hasOwnProperty.call(I,B)){var Z=F?Object.getOwnPropertyDescriptor(I,B):null;Z&&(Z.get||Z.set)?Object.defineProperty(R,B,Z):R[B]=I[B]}return R.default=I,P&&P.set(I,R),R}function _(I,M,P){var R=.5*P[0],F=.5*P[1],B=.5*P[2],Z=M[0],W=M[1],G=M[2],X=M[3];return I[0]=Z,I[1]=W,I[2]=G,I[3]=X,I[4]=R*X+F*G-B*W,I[5]=F*X+B*Z-R*G,I[6]=B*X+R*W-F*Z,I[7]=-R*Z-F*W-B*G,I}function w(I,M){return I[0]=M[0],I[1]=M[1],I[2]=M[2],I[3]=M[3],I[4]=M[4],I[5]=M[5],I[6]=M[6],I[7]=M[7],I}function E(I,M,P){var R=M[0],F=M[1],B=M[2],Z=M[3],W=P[4],G=P[5],X=P[6],ee=P[7],ie=M[4],ge=M[5],fe=M[6],pe=M[7],Ce=P[0],_e=P[1],Me=P[2],Re=P[3];return I[0]=R*Re+Z*Ce+F*Me-B*_e,I[1]=F*Re+Z*_e+B*Ce-R*Me,I[2]=B*Re+Z*Me+R*_e-F*Ce,I[3]=Z*Re-R*Ce-F*_e-B*Me,I[4]=R*ee+Z*W+F*X-B*G+ie*Re+pe*Ce+ge*Me-fe*_e,I[5]=F*ee+Z*G+B*W-R*X+ge*Re+pe*_e+fe*Ce-ie*Me,I[6]=B*ee+Z*X+R*G-F*W+fe*Re+pe*Me+ie*_e-ge*Ce,I[7]=Z*ee-R*W-F*G-B*X+pe*Re-ie*Ce-ge*_e-fe*Me,I}nt.getReal=o.copy,nt.setReal=o.copy,nt.mul=E;var A=o.dot;nt.dot=A;var v=o.length;nt.length=v,nt.len=v;var C=o.squaredLength;return nt.squaredLength=C,nt.sqrLen=C,nt}var rr,mr,Ut={};function hn(){if(rr)return Ut;function c(M){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(P){return typeof P}:function(P){return P&&typeof Symbol=="function"&&P.constructor===Symbol&&P!==Symbol.prototype?"symbol":typeof P},c(M)}rr=1,Object.defineProperty(Ut,"__esModule",{value:!0}),Ut.create=u,Ut.clone=function(M){var P=new r.ARRAY_TYPE(2);return P[0]=M[0],P[1]=M[1],P},Ut.fromValues=function(M,P){var R=new r.ARRAY_TYPE(2);return R[0]=M,R[1]=P,R},Ut.copy=function(M,P){return M[0]=P[0],M[1]=P[1],M},Ut.set=function(M,P,R){return M[0]=P,M[1]=R,M},Ut.add=function(M,P,R){return M[0]=P[0]+R[0],M[1]=P[1]+R[1],M},Ut.subtract=p,Ut.multiply=h,Ut.divide=_,Ut.ceil=function(M,P){return M[0]=Math.ceil(P[0]),M[1]=Math.ceil(P[1]),M},Ut.floor=function(M,P){return M[0]=Math.floor(P[0]),M[1]=Math.floor(P[1]),M},Ut.min=function(M,P,R){return M[0]=Math.min(P[0],R[0]),M[1]=Math.min(P[1],R[1]),M},Ut.max=function(M,P,R){return M[0]=Math.max(P[0],R[0]),M[1]=Math.max(P[1],R[1]),M},Ut.round=function(M,P){return M[0]=Math.round(P[0]),M[1]=Math.round(P[1]),M},Ut.scale=function(M,P,R){return M[0]=P[0]*R,M[1]=P[1]*R,M},Ut.scaleAndAdd=function(M,P,R,F){return M[0]=P[0]+R[0]*F,M[1]=P[1]+R[1]*F,M},Ut.distance=w,Ut.squaredDistance=E,Ut.length=A,Ut.squaredLength=v,Ut.negate=function(M,P){return M[0]=-P[0],M[1]=-P[1],M},Ut.inverse=function(M,P){return M[0]=1/P[0],M[1]=1/P[1],M},Ut.normalize=function(M,P){var R=P[0],F=P[1],B=R*R+F*F;return B>0&&(B=1/Math.sqrt(B)),M[0]=P[0]*B,M[1]=P[1]*B,M},Ut.dot=function(M,P){return M[0]*P[0]+M[1]*P[1]},Ut.cross=function(M,P,R){var F=P[0]*R[1]-P[1]*R[0];return M[0]=M[1]=0,M[2]=F,M},Ut.lerp=function(M,P,R,F){var B=P[0],Z=P[1];return M[0]=B+F*(R[0]-B),M[1]=Z+F*(R[1]-Z),M},Ut.random=function(M,P){P=P||1;var R=2*r.RANDOM()*Math.PI;return M[0]=Math.cos(R)*P,M[1]=Math.sin(R)*P,M},Ut.transformMat2=function(M,P,R){var F=P[0],B=P[1];return M[0]=R[0]*F+R[2]*B,M[1]=R[1]*F+R[3]*B,M},Ut.transformMat2d=function(M,P,R){var F=P[0],B=P[1];return M[0]=R[0]*F+R[2]*B+R[4],M[1]=R[1]*F+R[3]*B+R[5],M},Ut.transformMat3=function(M,P,R){var F=P[0],B=P[1];return M[0]=R[0]*F+R[3]*B+R[6],M[1]=R[1]*F+R[4]*B+R[7],M},Ut.transformMat4=function(M,P,R){var F=P[0],B=P[1];return M[0]=R[0]*F+R[4]*B+R[12],M[1]=R[1]*F+R[5]*B+R[13],M},Ut.rotate=function(M,P,R,F){var B=P[0]-R[0],Z=P[1]-R[1],W=Math.sin(F),G=Math.cos(F);return M[0]=B*G-Z*W+R[0],M[1]=B*W+Z*G+R[1],M},Ut.angle=function(M,P){var R=M[0],F=M[1],B=P[0],Z=P[1],W=Math.sqrt(R*R+F*F)*Math.sqrt(B*B+Z*Z);return Math.acos(Math.min(Math.max(W&&(R*B+F*Z)/W,-1),1))},Ut.zero=function(M){return M[0]=0,M[1]=0,M},Ut.str=function(M){return"vec2("+M[0]+", "+M[1]+")"},Ut.exactEquals=function(M,P){return M[0]===P[0]&&M[1]===P[1]},Ut.equals=function(M,P){var R=M[0],F=M[1],B=P[0],Z=P[1];return Math.abs(R-B)<=r.EPSILON*Math.max(1,Math.abs(R),Math.abs(B))&&Math.abs(F-Z)<=r.EPSILON*Math.max(1,Math.abs(F),Math.abs(Z))},Ut.forEach=Ut.sqrLen=Ut.sqrDist=Ut.dist=Ut.div=Ut.mul=Ut.sub=Ut.len=void 0;var r=function(M,P){if(M&&M.__esModule)return M;if(M===null||c(M)!=="object"&&typeof M!="function")return{default:M};var R=o(void 0);if(R&&R.has(M))return R.get(M);var F={},B=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Z in M)if(Z!=="default"&&Object.prototype.hasOwnProperty.call(M,Z)){var W=B?Object.getOwnPropertyDescriptor(M,Z):null;W&&(W.get||W.set)?Object.defineProperty(F,Z,W):F[Z]=M[Z]}return F.default=M,R&&R.set(M,F),F}(q());function o(M){if(typeof WeakMap!="function")return null;var P=new WeakMap,R=new WeakMap;return(o=function(F){return F?R:P})(M)}function u(){var M=new r.ARRAY_TYPE(2);return r.ARRAY_TYPE!=Float32Array&&(M[0]=0,M[1]=0),M}function p(M,P,R){return M[0]=P[0]-R[0],M[1]=P[1]-R[1],M}function h(M,P,R){return M[0]=P[0]*R[0],M[1]=P[1]*R[1],M}function _(M,P,R){return M[0]=P[0]/R[0],M[1]=P[1]/R[1],M}function w(M,P){return Math.hypot(P[0]-M[0],P[1]-M[1])}function E(M,P){var R=P[0]-M[0],F=P[1]-M[1];return R*R+F*F}function A(M){return Math.hypot(M[0],M[1])}function v(M){var P=M[0],R=M[1];return P*P+R*R}Ut.len=A,Ut.sub=p,Ut.mul=h,Ut.div=_,Ut.dist=w,Ut.sqrDist=E,Ut.sqrLen=v;var C,I=(C=u(),function(M,P,R,F,B,Z){var W,G;for(P||(P=2),R||(R=0),G=F?Math.min(F*P+R,M.length):M.length,W=R;W<G;W+=P)C[0]=M[W],C[1]=M[W+1],B(C,C,Z),M[W]=C[0],M[W+1]=C[1];return M});return Ut.forEach=I,Ut}function Gn(){if(mr)return O;function c(M){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(P){return typeof P}:function(P){return P&&typeof Symbol=="function"&&P.constructor===Symbol&&P!==Symbol.prototype?"symbol":typeof P},c(M)}mr=1,Object.defineProperty(O,"__esModule",{value:!0}),O.vec4=O.vec3=O.vec2=O.quat2=O.quat=O.mat4=O.mat3=O.mat2d=O.mat2=O.glMatrix=void 0;var r=I(q());O.glMatrix=r;var o=I(Q());O.mat2=o;var u=I(ae());O.mat2d=u;var p=I(je());O.mat3=p;var h=I(ct());O.mat4=h;var _=I(Nt());O.quat=_;var w=I(Qt());O.quat2=w;var E=I(hn());O.vec2=E;var A=I(Mt());O.vec3=A;var v=I(Wt());function C(M){if(typeof WeakMap!="function")return null;var P=new WeakMap,R=new WeakMap;return(C=function(F){return F?R:P})(M)}function I(M,P){if(M&&M.__esModule)return M;if(M===null||c(M)!=="object"&&typeof M!="function")return{default:M};var R=C(P);if(R&&R.has(M))return R.get(M);var F={},B=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Z in M)if(Z!=="default"&&Object.prototype.hasOwnProperty.call(M,Z)){var W=B?Object.getOwnPropertyDescriptor(M,Z):null;W&&(W.get||W.set)?Object.defineProperty(F,Z,W):F[Z]=M[Z]}return F.default=M,R&&R.set(M,F),F}return O.vec4=v,O}var At,qt,Br,xn,de=Gn(),bn=function(){if(qt)return At;function c(r,o,u,p){this.cx=3*r,this.bx=3*(u-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(p-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=o,this.p2x=u,this.p2y=p}return qt=1,At=c,c.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,o){if(o===void 0&&(o=1e-6),r<0)return 0;if(r>1)return 1;for(var u=r,p=0;p<8;p++){var h=this.sampleCurveX(u)-r;if(Math.abs(h)<o)return u;var _=this.sampleCurveDerivativeX(u);if(Math.abs(_)<1e-6)break;u-=h/_}var w=0,E=1;for(u=r,p=0;p<20&&(h=this.sampleCurveX(u),!(Math.abs(h-r)<o));p++)r>h?w=u:E=u,u=.5*(E-w)+w;return u},solve:function(r,o){return this.sampleCurveY(this.solveCurveX(r,o))}},At}(),pn=N(bn);function hi(){if(xn)return Br;function c(r,o){this.x=r,this.y=o}return xn=1,Br=c,c.prototype={clone:function(){return new c(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,o){return this.clone()._rotateAround(r,o)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var o=r.x-this.x,u=r.y-this.y;return o*o+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,o){return Math.atan2(this.x*o-this.y*r,this.x*r+this.y*o)},_matMult:function(r){var o=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=o,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var o=Math.cos(r),u=Math.sin(r),p=u*this.x+o*this.y;return this.x=o*this.x-u*this.y,this.y=p,this},_rotateAround:function(r,o){var u=Math.cos(r),p=Math.sin(r),h=o.y+p*(this.x-o.x)+u*(this.y-o.y);return this.x=o.x+u*(this.x-o.x)-p*(this.y-o.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},c.convert=function(r){return r instanceof c?r:Array.isArray(r)?new c(r[0],r[1]):r},Br}var bt=N(hi());function Vi(c,r){if(Array.isArray(c)){if(!Array.isArray(r)||c.length!==r.length)return!1;for(let o=0;o<c.length;o++)if(!Vi(c[o],r[o]))return!1;return!0}if(typeof c=="object"&&c!==null&&r!==null){if(typeof r!="object"||Object.keys(c).length!==Object.keys(r).length)return!1;for(const o in c)if(!Vi(c[o],r[o]))return!1;return!0}return c===r}const ni=Math.PI/180,os=180/Math.PI;function Be(c){return c*ni}function ut(c){return c*os}const St=[[0,0],[1,0],[1,1],[0,1]];function dr(c){if(c<=0)return 0;if(c>=1)return 1;const r=c*c,o=r*c;return 4*(c<.5?o:3*(c-r)+o-.75)}function or(c,r,o,u){const p=new pn(c,r,o,u);return function(h){return p.solve(h)}}const tr=or(.25,.1,.25,1);function Bt(c,r,o){return Math.min(o,Math.max(r,c))}function Or(c,r,o){return(o=Bt((o-c)/(r-c),0,1))*o*(3-2*o)}function Xn(c,r,o){const u=o-r,p=((c-r)%u+u)%u+r;return p===r?o:p}function Bn(c,r,o){if(!c.length)return o(null,[]);let u=c.length;const p=new Array(c.length);let h=null;c.forEach((_,w)=>{r(_,(E,A)=>{E&&(h=E),p[w]=A,--u==0&&o(h,p)})})}function fi(c,...r){for(const o of r)for(const u in o)c[u]=o[u];return c}let ms=1;function Es(){return ms++}function ra(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))}function Pa(c,r){c.forEach(o=>{r[o]&&(r[o]=r[o].bind(r))})}function co(c,r,o){const u={};for(const p in c)u[p]=r.call(this,c[p],p,c);return u}function na(c,r,o){const u={};for(const p in c)r.call(this,c[p],p,c)&&(u[p]=c[p]);return u}function Xi(c){return Array.isArray(c)?c.map(Xi):typeof c=="object"&&c?co(c,Xi):c}const Vs={};function Kn(c){Vs[c]||(typeof console<"u"&&console.warn(c),Vs[c]=!0)}function hr(c,r,o){return(o.y-c.y)*(r.x-c.x)>(r.y-c.y)*(o.x-c.x)}function Jn(c){let r=0;for(let o,u,p=0,h=c.length,_=h-1;p<h;_=p++)o=c[p],u=c[_],r+=(u.x-o.x)*(o.y+u.y);return r}function Vn([c,r,o]){const u=Be(r+90),p=Be(o);return{x:c*Math.cos(u)*Math.sin(p),y:c*Math.sin(u)*Math.sin(p),z:c*Math.cos(p),azimuthal:r,polar:o}}function xi(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function gs(c){const r={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(o,u,p,h)=>{const _=p||h;return r[u]=!_||_.toLowerCase(),""}),r["max-age"]){const o=parseInt(r["max-age"],10);isNaN(o)?delete r["max-age"]:r["max-age"]=o}return r}let Ia=null;function ql(c,r){return[c[4*r],c[4*r+1],c[4*r+2],c[4*r+3]]}function op(c,r,o,u){for(;r<o;){const p=r+o>>1;c[p]<u?r=p+1:o=p}return r}function ap(c,r,o,u){for(;r<o;){const p=r+o>>1;c[p]<=u?r=p+1:o=p}return r}function Sh(c){return c>0?1/(1.001-c):1+c}function tt(c){return c>0?1-1/(1.001-c):-c}const oe={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!oe.API_URL)return null;try{const c=new URL(oe.API_URL);return c.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":c.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function ue(c){return oe.API_URL_REGEX.test(c)}function ve(c){return oe.API_SPRITE_REGEX.test(c)}let Ie,Ae,De,Ye,ze,Qe;function st(){return Ie==null&&(Ie=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Ie}const et={now:()=>Ye!==void 0?Ye:performance.now(),setNow(c){Ye=c},restoreNow(){Ye=void 0},frame(c){const r=requestAnimationFrame(c);return{cancel:()=>cancelAnimationFrame(r)}},getImageData(c,r=0){const{width:o,height:u}=c;ze||(ze=document.createElement("canvas"));const p=ze.getContext("2d",{willReadFrequently:!0});if(!p)throw new Error("failed to create canvas 2d context");return(o>ze.width||u>ze.height)&&(ze.width=o,ze.height=u),p.clearRect(-r,-r,o+2*r,u+2*r),p.drawImage(c,0,0,o,u),p.getImageData(-r,-r,o+2*r,u+2*r)},resolveURL:c=>(Ae||(Ae=document.createElement("a")),Ae.href=c,Ae.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(De==null&&(De=window.matchMedia("(prefers-reduced-motion: reduce)")),De.matches)},hasCanvasFingerprintNoise(){if(Qe!==void 0)return Qe;if(!st())return Qe=!1,!1;const c=new OffscreenCanvas(85,1),r=c.getContext("2d",{willReadFrequently:!0});let o=0;for(let p=0;p<c.width;++p)r.fillStyle=`rgba(${o++},${o++},${o++}, 255)`,r.fillRect(p,0,1,1);const u=r.getImageData(0,0,c.width,c.height);o=0;for(let p=0;p<u.data.length;++p)if(p%4!=3&&o++!==u.data[p])return Qe=!0,!0;return Qe=!1,!1}};function wt(c,r){const o=c.indexOf("?");if(o<0)return`${c}?${new URLSearchParams(r).toString()}`;const u=new URLSearchParams(c.slice(o));for(const p in r)u.set(p,r[p]);return`${c.slice(0,o)}?${u.toString()}`}function Lt(c,r={persistentParams:[]}){const o=c.indexOf("?");if(o<0)return c;const u=new URLSearchParams,p=new URLSearchParams(c.slice(o));for(const _ of r.persistentParams){const w=p.get(_);w&&u.set(_,w)}const h=u.toString();return`${c.slice(0,o)}${h.length>0?`?${h}`:""}`}const Vt="mapbox-tiles";let Cr=500,kr=50;const Nr=["language","worldview","jobid"];let Dr,jn;function ri(){try{return caches}catch{}}function Vr(){const c=ri();c&&Dr==null&&(Dr=c.open(Vt))}let mn=1/0;const gn={supported:!1,testSupport:function(c){!Ki&&vi&&(Cs?Ds(c):vn=c)}};let vn,vi,Ki=!1,Cs=!1;const Ro=typeof self<"u"?self:{};function Ds(c){const r=c.createTexture();c.bindTexture(c.TEXTURE_2D,r);try{if(c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,vi),c.isContextLost())return;gn.supported=!0}catch{}c.deleteTexture(r),Ki=!0}Ro.document&&(vi=Ro.document.createElement("img"),vi.onload=function(){vn&&Ds(vn),vn=null,Cs=!0},vi.onerror=function(){Ki=!0,vn=null},vi.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Ji={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Ji);class as extends Error{constructor(r,o,u){o===401&&ue(u)&&(r+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(r),this.status=o,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const bu=xi()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,jo=function(c,r){if(!(/^file:/.test(o=c.url)||/^file:/.test(bu())&&!/^\w+:/.test(o))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(u,p){const h=new AbortController,_=new Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:bu(),referrerPolicy:u.referrerPolicy,signal:h.signal});let w=!1,E=!1;const A=(v=_.url).indexOf("sku=")>0&&ue(v);var v;u.type==="json"&&_.headers.set("Accept","application/json");const C=(M,P,R)=>{if(E)return;if(M&&M.message!=="SecurityError"&&Kn(M.toString()),P&&R)return I(P);const F=Date.now();fetch(_).then(B=>{if(B.ok){const Z=A?B.clone():null;return I(B,Z,F)}return p(new as(B.statusText,B.status,u.url))}).catch(B=>{B.name!=="AbortError"&&p(new Error(`${B.message} ${u.url}`))})},I=(M,P,R)=>{(u.type==="arrayBuffer"?M.arrayBuffer():u.type==="json"?M.json():M.text()).then(F=>{E||(P&&R&&function(B,Z,W){if(Vr(),Dr==null)return;const G=gs(Z.headers.get("Cache-Control")||"");if(G["no-store"])return;const X={status:Z.status,statusText:Z.statusText,headers:new Headers};Z.headers.forEach((ge,fe)=>X.headers.set(fe,ge)),G["max-age"]&&X.headers.set("Expires",new Date(W+1e3*G["max-age"]).toUTCString());const ee=X.headers.get("Expires");if(!ee||new Date(ee).getTime()-W<42e4)return;let ie=Lt(B.url,{persistentParams:Nr});if(Z.status===206){const ge=B.headers.get("Range");if(!ge)return;X.status=200,ie=wt(ie,{range:ge})}(function(ge,fe){if(jn===void 0)try{new Response(new ReadableStream),jn=!0}catch{jn=!1}jn?fe(ge.body):ge.blob().then(fe)})(Z,ge=>{const fe=new Response((pe=Z.status)!==200&&pe!==404&&[101,103,204,205,304].includes(pe)?null:ge,X);var pe;Vr(),Dr!=null&&Dr.then(Ce=>Ce.put(ie,fe)).catch(Ce=>Kn(Ce.message))})}(_,P,R),w=!0,p(null,F,M.headers.get("Cache-Control"),M.headers.get("Expires")))}).catch(F=>{E||p(new Error(F.message))})};return A?function(M,P){if(Vr(),Dr==null)return P(null);Dr.then(R=>{let F=Lt(M.url,{persistentParams:Nr});const B=M.headers.get("Range");B&&(F=wt(F,{range:B})),R.match(F).then(Z=>{const W=function(G){if(!G)return!1;const X=new Date(G.headers.get("Expires")||0),ee=gs(G.headers.get("Cache-Control")||"");return X>Date.now()&&!ee["no-cache"]}(Z);R.delete(F),W&&R.put(F,Z.clone()),P(null,Z,W)}).catch(P)}).catch(P)}(_,C):C(null,null),{cancel:()=>{E=!0,w||h.abort()}}}(c,r);if(xi()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",c,r,void 0,!0)}var o;return function(u,p){const h=new XMLHttpRequest;h.open(u.method||"GET",u.url,!0),u.type==="arrayBuffer"&&(h.responseType="arraybuffer");for(const _ in u.headers)h.setRequestHeader(_,u.headers[_]);return u.type==="json"&&(h.responseType="text",h.setRequestHeader("Accept","application/json")),h.withCredentials=u.credentials==="include",h.onerror=()=>{p(new Error(h.statusText))},h.onload=()=>{if((h.status>=200&&h.status<300||h.status===0)&&h.response!==null){let _=h.response;if(u.type==="json")try{_=JSON.parse(h.response)}catch(w){return p(w)}p(null,_,h.getResponseHeader("Cache-Control"),h.getResponseHeader("Expires"))}else p(new as(h.statusText,h.status,u.url))},h.send(u.body),{cancel:()=>h.abort()}}(c,r)},ka=function(c,r){return jo(fi(c,{type:"arrayBuffer"}),r)};function Zg(c){const r=document.createElement("a");return r.href=c,r.protocol===location.protocol&&r.host===location.host}const lp="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Th,wu;Th=[],wu=0;const Yg=function(c,r){if(gn.supported&&(c.headers||(c.headers={}),c.headers.accept="image/webp,*/*"),wu>=oe.MAX_PARALLEL_IMAGE_REQUESTS){const h={requestParameters:c,callback:r,cancelled:!1,cancel(){this.cancelled=!0}};return Th.push(h),h}wu++;let o=!1;const u=()=>{if(!o)for(o=!0,wu--;Th.length&&wu<oe.MAX_PARALLEL_IMAGE_REQUESTS;){const h=Th.shift(),{requestParameters:_,callback:w,cancelled:E}=h;E||(h.cancel=Yg(_,w).cancel)}},p=ka(c,(h,_,w,E)=>{u(),h?r(h):_&&(self.createImageBitmap?function(A,v){const C=new Blob([new Uint8Array(A)],{type:"image/png"});createImageBitmap(C).then(I=>{v(null,I)}).catch(I=>{v(new Error(`Could not load image because of ${I.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(_,(A,v)=>r(A,v,w,E)):function(A,v){const C=new Image;C.onload=()=>{v(null,C),URL.revokeObjectURL(C.src),C.onload=null,requestAnimationFrame(()=>{C.src=lp})},C.onerror=()=>v(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const I=new Blob([new Uint8Array(A)],{type:"image/png"});C.src=A.byteLength?URL.createObjectURL(I):lp}(_,(A,v)=>r(A,v,w,E)))});return{cancel:()=>{p.cancel(),u()}}};var i0,s0,Xg,Su={exports:{}},uo={exports:{}},ia={exports:{}},Hl=function(){if(Xg)return Su.exports;Xg=1;var c=(i0||(i0=1,uo.exports=function(o,u){var p,h,_,w,E,A,v,C;for(h=o.length-(p=3&o.length),_=u,E=3432918353,A=461845907,C=0;C<h;)v=255&o.charCodeAt(C)|(255&o.charCodeAt(++C))<<8|(255&o.charCodeAt(++C))<<16|(255&o.charCodeAt(++C))<<24,++C,_=27492+(65535&(w=5*(65535&(_=(_^=v=(65535&(v=(v=(65535&v)*E+(((v>>>16)*E&65535)<<16)&4294967295)<<15|v>>>17))*A+(((v>>>16)*A&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(v=0,p){case 3:v^=(255&o.charCodeAt(C+2))<<16;case 2:v^=(255&o.charCodeAt(C+1))<<8;case 1:_^=v=(65535&(v=(v=(65535&(v^=255&o.charCodeAt(C)))*E+(((v>>>16)*E&65535)<<16)&4294967295)<<15|v>>>17))*A+(((v>>>16)*A&65535)<<16)&4294967295}return _^=o.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0}),uo.exports),r=(s0||(s0=1,ia.exports=function(o,u){for(var p,h=o.length,_=u^h,w=0;h>=4;)p=1540483477*(65535&(p=255&o.charCodeAt(w)|(255&o.charCodeAt(++w))<<8|(255&o.charCodeAt(++w))<<16|(255&o.charCodeAt(++w))<<24))+((1540483477*(p>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),h-=4,++w;switch(h){case 3:_^=(255&o.charCodeAt(w+2))<<16;case 2:_^=(255&o.charCodeAt(w+1))<<8;case 1:_=1540483477*(65535&(_^=255&o.charCodeAt(w)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0}),ia.exports);return Su.exports=c,Su.exports.murmur3=c,Su.exports.murmur2=r,Su.exports}(),ho=N(Hl);class Ys{constructor(r,...o){fi(this,o[0]||{}),this.type=r}}class Tu extends Ys{constructor(r,o={}){super("error",fi({error:r},o))}}function Kg(c,r,o){o[c]&&o[c].indexOf(r)!==-1||(o[c]=o[c]||[],o[c].push(r))}function cp(c,r,o){if(o&&o[c]){const u=o[c].indexOf(r);u!==-1&&o[c].splice(u,1)}}class sa{on(r,o){return this._listeners=this._listeners||{},Kg(r,o,this._listeners),this}off(r,o){return cp(r,o,this._listeners),cp(r,o,this._oneTimeListeners),this}once(r,o){return o?(this._oneTimeListeners=this._oneTimeListeners||{},Kg(r,o,this._oneTimeListeners),this):new Promise(u=>{this.once(r,u)})}fire(r,o){const u=typeof r=="string"?new Ys(r,o):r,p=u.type;if(this.listens(p)){u.target=this;const h=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const E of h)E.call(this,u);const _=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const E of _)cp(p,E,this._oneTimeListeners),E.call(this,u);const w=this._eventedParent;w&&(fi(u,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),w.fire(u))}else u instanceof Tu&&console.error(u.error);return this}listens(r){return!!(this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r))}setEventedParent(r,o){return this._eventedParent=r,this._eventedParentData=o,this}}class Us{constructor(r){typeof r=="string"?this.name=r:(this.name=r.name,this.iconsetId=r.iconsetId)}static from(r){return new Us(r)}static toString(r){return r.iconsetId?`${r.name}${r.iconsetId}`:r.name}static parse(r){const[o,u]=r.split("");return new Us({name:o,iconsetId:u})}static isEqual(r,o){return r.name===o.name&&r.iconsetId===o.iconsetId}toString(){return Us.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var o0,Jg={},Do=function(){if(o0)return Jg;o0=1;var c={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function r(h){return(h=Math.round(h))<0?0:h>255?255:h}function o(h){return r(h[h.length-1]==="%"?parseFloat(h)/100*255:parseInt(h))}function u(h){return(_=h[h.length-1]==="%"?parseFloat(h)/100:parseFloat(h))<0?0:_>1?1:_;var _}function p(h,_,w){return w<0?w+=1:w>1&&(w-=1),6*w<1?h+(_-h)*w*6:2*w<1?_:3*w<2?h+(_-h)*(2/3-w)*6:h}try{Jg.parseCSSColor=function(h){var _,w=h.replace(/ /g,"").toLowerCase();if(w in c)return c[w].slice();if(w[0]==="#")return w.length===4?(_=parseInt(w.substr(1),16))>=0&&_<=4095?[(3840&_)>>4|(3840&_)>>8,240&_|(240&_)>>4,15&_|(15&_)<<4,1]:null:w.length===7&&(_=parseInt(w.substr(1),16))>=0&&_<=16777215?[(16711680&_)>>16,(65280&_)>>8,255&_,1]:null;var E=w.indexOf("("),A=w.indexOf(")");if(E!==-1&&A+1===w.length){var v=w.substr(0,E),C=w.substr(E+1,A-(E+1)).split(","),I=1;switch(v){case"rgba":if(C.length!==4)return null;I=u(C.pop());case"rgb":return C.length!==3?null:[o(C[0]),o(C[1]),o(C[2]),I];case"hsla":if(C.length!==4)return null;I=u(C.pop());case"hsl":if(C.length!==3)return null;var M=(parseFloat(C[0])%360+360)%360/360,P=u(C[1]),R=u(C[2]),F=R<=.5?R*(P+1):R+P-R*P,B=2*R-F;return[r(255*p(B,F,M+1/3)),r(255*p(B,F,M)),r(255*p(B,F,M-1/3)),I];default:return null}}return null}}catch{}return Jg}();class _n{constructor(r,o,u,p=1){this.r=r,this.g=o,this.b=u,this.a=p}static parse(r){if(!r)return;if(r instanceof _n)return r;if(typeof r!="string")return;const o=Do.parseCSSColor(r);return o?new _n(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3]):void 0}toStringPremultipliedAlpha(){const[r,o,u,p]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(r)},${Math.round(o)},${Math.round(u)},${p})`}toString(){const[r,o,u,p]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*r)},${Math.round(255*o)},${Math.round(255*u)},${p})`}toRenderColor(r){const{r:o,g:u,b:p,a:h}=this;return new Qg(r,o,u,p,h)}clone(){return new _n(this.r,this.g,this.b,this.a)}}class Qg{constructor(r,o,u,p,h){if(r){const _=r.image.height,w=_*_;o=h===0?0:o/h*(_-1),u=h===0?0:u/h*(_-1),p=h===0?0:p/h*(_-1);const E=Math.floor(o),A=Math.floor(u),v=Math.floor(p),C=Math.ceil(o),I=Math.ceil(u),M=Math.ceil(p),P=o-E,R=u-A,F=p-v,B=r.image.data,Z=4*(E+A*w+v*_),W=4*(E+A*w+M*_),G=4*(E+I*w+v*_),X=4*(E+I*w+M*_),ee=4*(C+A*w+v*_),ie=4*(C+A*w+M*_),ge=4*(C+I*w+v*_),fe=4*(C+I*w+M*_);if(Z<0||fe>=B.length)throw new Error("out of range");this.r=ur(ur(ur(B[Z],B[W],F),ur(B[G],B[X],F),R),ur(ur(B[ee],B[ie],F),ur(B[ge],B[fe],F),R),P)/255*h,this.g=ur(ur(ur(B[Z+1],B[W+1],F),ur(B[G+1],B[X+1],F),R),ur(ur(B[ee+1],B[ie+1],F),ur(B[ge+1],B[fe+1],F),R),P)/255*h,this.b=ur(ur(ur(B[Z+2],B[W+2],F),ur(B[G+2],B[X+2],F),R),ur(ur(B[ee+2],B[ie+2],F),ur(B[ge+2],B[fe+2],F),R),P)/255*h,this.a=h}else this.r=o,this.g=u,this.b=p,this.a=h}toArray(){const{r,g:o,b:u,a:p}=this;return p===0?[0,0,0,0]:[255*r/p,255*o/p,255*u/p,p]}toHslaArray(){if(this.a===0)return[0,0,0,0];const{r,g:o,b:u,a:p}=this,h=Math.min(Math.max(r/p,0),1),_=Math.min(Math.max(o/p,0),1),w=Math.min(Math.max(u/p,0),1),E=Math.min(h,_,w),A=Math.max(h,_,w),v=(E+A)/2;if(E===A)return[0,0,100*v,p];const C=A-E,I=v>.5?C/(2-A-E):C/(A+E);let M=0;return A===h?M=(_-w)/C+(_<w?6:0):A===_?M=(w-h)/C+2:A===w&&(M=(h-_)/C+4),M*=60,[Math.min(Math.max(M,0),360),Math.min(Math.max(100*I,0),100),Math.min(Math.max(100*v,0),100),p]}toArray01(){const{r,g:o,b:u,a:p}=this;return p===0?[0,0,0,0]:[r/p,o/p,u/p,p]}toArray01Scaled(r){const{r:o,g:u,b:p,a:h}=this;return h===0?[0,0,0]:[o/h*r,u/h*r,p/h*r]}toArray01PremultipliedAlpha(){const{r,g:o,b:u,a:p}=this;return[r,o,u,p]}toArray01Linear(){const{r,g:o,b:u,a:p}=this;return p===0?[0,0,0,0]:[Math.pow(r/p,2.2),Math.pow(o/p,2.2),Math.pow(u/p,2.2),p]}}function ur(c,r,o){return c*(1-o)+r*o}function a0(c,r,o){return c.map((u,p)=>ur(u,r[p],o))}function l0(c){return c*c*c*c*c}_n.black=new _n(0,0,0,1),_n.white=new _n(1,1,1,1),_n.transparent=new _n(0,0,0,0),_n.red=new _n(1,0,0,1),_n.blue=new _n(0,0,1,1);var Eh=Object.freeze({__proto__:null,array:a0,color:function(c,r,o){return new _n(ur(c.r,r.r,o),ur(c.g,r.g,o),ur(c.b,r.b,o),ur(c.a,r.a,o))},easeIn:l0,number:ur});function Yr(c,...r){for(const o of r)for(const u in o)c[u]=o[u];return c}class Lo extends Error{constructor(r,o){super(o),this.message=o,this.key=r}}class up{constructor(r,o=[]){this.parent=r,this.bindings={};for(const[u,p]of o)this.bindings[u]=p}concat(r){return new up(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}const Eu={kind:"null"},er={kind:"number"},fn={kind:"string"},Jr={kind:"boolean"},Ms={kind:"color"},Cu={kind:"object"},rn={kind:"value"},Qa={kind:"collator"},Ch={kind:"formatted"},el={kind:"resolvedImage"};function _s(c,r){return{kind:"array",itemType:c,N:r}}function bi(c){if(c.kind==="array"){const r=bi(c.itemType);return typeof c.N=="number"?`array<${r}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${r}>`}return c.kind}const oa=[Eu,er,fn,Jr,Ms,Ch,Cu,_s(rn),el];function Mu(c,r){if(r.kind==="error")return null;if(c.kind==="array"){if(r.kind==="array"&&(r.N===0&&r.itemType.kind==="value"||!Mu(c.itemType,r.itemType))&&(typeof c.N!="number"||c.N===r.N))return null}else{if(c.kind===r.kind)return null;if(c.kind==="value"){for(const o of oa)if(!Mu(o,r))return null}}return`Expected ${bi(c)} but found ${bi(r)} instead.`}function e_(c,r){return r.some(o=>o.kind===c.kind)}function Au(c,r){return r.some(o=>o==="null"?c===null:o==="array"?Array.isArray(c):o==="object"?c&&!Array.isArray(c)&&typeof c=="object":o===typeof c)}class dp{constructor(r,o,u){this.sensitivity=r?o?"variant":"case":o?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,o){return this.collator.compare(r,o)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Mh{constructor(r,o,u,p,h){this.text=r.normalize?r.normalize():r,this.image=o,this.scale=u,this.fontStack=p,this.textColor=h}}class As{constructor(r){this.sections=r}static fromString(r){return new As([new Mh(r,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(r=>r.text.length!==0||!!r.image&&r.image.hasPrimary())}static factory(r){return r instanceof As?r:As.fromString(r)}toString(){return this.sections.length===0?"":this.sections.map(r=>r.text).join("")}serialize(){const r=["format"];for(const o of this.sections){if(o.image){const p=o.image.getPrimary().id.toString();r.push(["image",p]);continue}r.push(o.text);const u={};o.fontStack&&(u["text-font"]=["literal",o.fontStack.split(",")]),o.scale&&(u["font-scale"]=o.scale),o.textColor&&(u["text-color"]=["rgba"].concat(o.textColor.toRenderColor(null).toArray())),r.push(u)}return r}}class Na{constructor(r,o={}){if(this.id=Us.from(r),this.options=Object.assign({},o),o.transform){const{a:u,b:p,c:h,d:_,e:w,f:E}=o.transform;this.options.transform=new DOMMatrix([u,p,h,_,w,E])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:r,b:o,c:u,d:p,e:h,f:_}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:r,b:o,c:u,d:p,e:h,f:_}})}static parse(r){let o,u,p,h;try{({name:o,iconsetId:u,params:p,transform:h}=JSON.parse(r)||{})}catch{return null}if(!o)return null;const{a:_,b:w,c:E,d:A,e:v,f:C}=h||{};return new Na({name:o,iconsetId:u},{params:p,transform:new DOMMatrix([_,w,E,A,v,C])})}scaleSelf(r){return this.options.transform.scaleSelf(r),this}}class Ps{constructor(r,o,u,p,h=!1){this.primaryId=Us.from(r),this.primaryOptions=o,u&&(this.secondaryId=Us.from(u)),this.secondaryOptions=p,this.available=h}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Na(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Na(this.secondaryId,this.secondaryOptions):null}static from(r){return typeof r=="string"?Ps.build({name:r}):r}static build(r,o,u,p){return!r||typeof r=="object"&&!("name"in r)?null:new Ps(r,u,o,p)}}function Ah(c,r,o,u){return typeof c=="number"&&c>=0&&c<=255&&typeof r=="number"&&r>=0&&r<=255&&typeof o=="number"&&o>=0&&o<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[c,r,o,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[c,r,o,u]:[c,r,o]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function aa(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof _n||c instanceof dp||c instanceof As||c instanceof Ps)return!0;if(Array.isArray(c)){for(const r of c)if(!aa(r))return!1;return!0}if(typeof c=="object"){for(const r in c)if(!aa(c[r]))return!1;return!0}return!1}function ki(c){if(c===null)return Eu;if(typeof c=="string")return fn;if(typeof c=="boolean")return Jr;if(typeof c=="number")return er;if(c instanceof _n)return Ms;if(c instanceof dp)return Qa;if(c instanceof As)return Ch;if(c instanceof Ps)return el;if(Array.isArray(c)){const r=c.length;let o;for(const u of c){const p=ki(u);if(o){if(o===p)continue;o=rn;break}o=p}return _s(o||rn,r)}return Cu}function Qi(c){const r=typeof c;return c===null?"":r==="string"||r==="number"||r==="boolean"?String(c):c instanceof _n?c.toStringPremultipliedAlpha():c instanceof As||c instanceof Ps?c.toString():JSON.stringify(c)}class tl{constructor(r,o){this.type=r,this.value=o}static parse(r,o){if(r.length!==2)return o.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!aa(r[1]))return o.error("invalid value");const u=r[1];let p=ki(u);const h=o.expectedType;return p.kind!=="array"||p.N!==0||!h||h.kind!=="array"||typeof h.N=="number"&&h.N!==0||(p=h),new tl(p,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof _n?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof As?this.value.serialize():this.value}}class Si{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}}const t_={string:fn,number:er,boolean:Jr,object:Cu};class fo{constructor(r,o){this.type=r,this.args=o}static parse(r,o){if(r.length<2)return o.error("Expected at least one argument.");let u,p=1;const h=r[0];if(h==="array"){let w,E;if(r.length>2){const A=r[1];if(typeof A!="string"||!(A in t_)||A==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);w=t_[A],p++}else w=rn;if(r.length>3){if(r[2]!==null&&(typeof r[2]!="number"||r[2]<0||r[2]!==Math.floor(r[2])))return o.error('The length argument to "array" must be a positive integer literal',2);E=r[2],p++}u=_s(w,E)}else u=t_[h];const _=[];for(;p<r.length;p++){const w=o.parse(r[p],p,rn);if(!w)return null;_.push(w)}return new fo(u,_)}evaluate(r){for(let o=0;o<this.args.length;o++){const u=this.args[o].evaluate(r);if(!Mu(this.type,ki(u)))return u;if(o===this.args.length-1)throw new Si(`The expression ${JSON.stringify(this.args[o].serialize())} evaluated to ${bi(ki(u))} but was expected to be of type ${bi(this.type)}.`)}return null}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=this.type,o=[r.kind];if(r.kind==="array"){const u=r.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){o.push(u.kind);const p=r.N;(typeof p=="number"||this.args.length>1)&&o.push(p)}}return o.concat(this.args.map(u=>u.serialize()))}}class Pu{constructor(r){this.type=Ch,this.sections=r}static parse(r,o){if(r.length<2)return o.error("Expected at least one argument.");const u=r[1];if(!Array.isArray(u)&&typeof u=="object")return o.error("First argument must be an image or text section.");const p=[];let h=!1;for(let _=1;_<=r.length-1;++_){const w=r[_];if(h&&typeof w=="object"&&!Array.isArray(w)){h=!1;let E=null;if(w["font-scale"]&&(E=o.parseObjectValue(w["font-scale"],_,"font-scale",er),!E))return null;let A=null;if(w["text-font"]&&(A=o.parseObjectValue(w["text-font"],_,"text-font",_s(fn)),!A))return null;let v=null;if(w["text-color"]&&(v=o.parseObjectValue(w["text-color"],_,"text-color",Ms),!v))return null;const C=p[p.length-1];C.scale=E,C.font=A,C.textColor=v}else{const E=o.parse(r[_],_,rn);if(!E)return null;const A=E.type.kind;if(A!=="string"&&A!=="value"&&A!=="null"&&A!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");h=!0,p.push({content:E,scale:null,font:null,textColor:null})}}return new Pu(p)}evaluate(r){return new As(this.sections.map(o=>{const u=o.content.evaluate(r);return ki(u)===el?new Mh("",u,null,null,null):new Mh(Qi(u),null,o.scale?o.scale.evaluate(r):null,o.font?o.font.evaluate(r).join(","):null,o.textColor?o.textColor.evaluate(r):null)}))}eachChild(r){for(const o of this.sections)r(o.content),o.scale&&r(o.scale),o.font&&r(o.font),o.textColor&&r(o.textColor)}outputDefined(){return!1}serialize(){const r=["format"];for(const o of this.sections){r.push(o.content.serialize());const u={};o.scale&&(u["font-scale"]=o.scale.serialize()),o.font&&(u["text-font"]=o.font.serialize()),o.textColor&&(u["text-color"]=o.textColor.serialize()),r.push(u)}return r}}class Wl{constructor(r,o,u,p){this._imageWarnHistory={},this.type=el,this.namePrimary=r,this.nameSecondary=o,u&&(this.paramsPrimary=u.params,this.iconsetIdPrimary=u.iconset?u.iconset.id:void 0),p&&(this.paramsSecondary=p.params,this.iconsetIdSecondary=p.iconset?p.iconset.id:void 0)}static parse(r,o){if(r.length<2)return o.error("Expected two or more arguments.");let u=1;const p=[];function h(){if(u<r.length){const w=o.parse(r[u],u++,fn);return w?(p.push({image:w,options:{}}),!0):(o.error(p.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function _(){if(u<r.length){const E=r[u];if((w=E)===null||typeof w!="object"||Array.isArray(w))return!0;const A=E.params,v=E.iconset,C=o.concat(u);if(!A&&!v)return u++,!0;if(A){if(typeof A!="object"||A.constructor!==Object)return C.error('Image options "params" should be an object'),!1;const I={},M=C.concat(void 0,"params");for(const P in A){if(!P)return M.error("Image parameter name should be non-empty"),!1;const R=M.concat(void 0,P).parse(A[P],void 0,Ms,void 0,{typeAnnotation:"coerce"});if(!R)return!1;I[P]=R}p[p.length-1].options.params=I}if(v){if(typeof v!="object"||v.constructor!==Object)return C.error('Image options "iconset" should be an object'),!1;if(!v.id)return C.error('Image options "iconset" should have an "id" property'),!1;p[p.length-1].options.iconset=v}return u++,!0}var w;return!0}for(let w=0;w<2;w++)if(!h()||!_())return;return new Wl(p[0].image,p[1]?p[1].image:void 0,p[0].options,p[1]?p[1].options:void 0)}evaluateParams(r,o){const u={};if(o){for(const p in o)if(o[p])try{u[p]=o[p].evaluate(r)}catch{continue}if(Object.keys(u).length!==0)return{params:u}}}evaluate(r){const o={name:this.namePrimary.evaluate(r),iconsetId:this.iconsetIdPrimary},u=this.nameSecondary?{name:this.nameSecondary.evaluate(r),iconsetId:this.iconsetIdSecondary}:void 0,p=Ps.build(o,u,this.paramsPrimary?this.evaluateParams(r,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(r,this.paramsSecondary):void 0);if(p&&r.availableImages){const h=p.getPrimary().id;if(p.available=r.availableImages.some(_=>Us.isEqual(_,h)),p.available){const _=p.getSecondary()?p.getSecondary().id:null;_&&(p.available=r.availableImages.some(w=>Us.isEqual(w,_)))}}return p}eachChild(r){if(r(this.namePrimary),this.paramsPrimary)for(const o in this.paramsPrimary)this.paramsPrimary[o]&&r(this.paramsPrimary[o]);if(this.nameSecondary&&(r(this.nameSecondary),this.paramsSecondary))for(const o in this.paramsSecondary)this.paramsSecondary[o]&&r(this.paramsSecondary[o])}outputDefined(){return!1}serializeOptions(r,o){const u={};if(o&&(u.iconset={id:o}),r){u.params={};for(const p in r)r[p]&&(u.params[p]=r[p].serialize())}return Object.keys(u).length>0?u:void 0}serialize(){const r=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const o=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);o&&r.push(o)}if(this.nameSecondary&&(r.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const o=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);o&&r.push(o)}return r}}function rl(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":c===null?"null":typeof c}const eS={"to-boolean":Jr,"to-color":Ms,"to-number":er,"to-string":fn};class nl{constructor(r,o){this.type=r,this.args=o}static parse(r,o){if(r.length<2)return o.error("Expected at least one argument.");const u=r[0],p=[];let h=Eu;if(u==="to-array"){if(!Array.isArray(r[1]))return null;const _=r[1].length;if(o.expectedType){if(o.expectedType.kind!=="array")return o.error(`Expected ${o.expectedType.kind} but found array.`);h=_s(o.expectedType.itemType,_)}else{if(!(_>0&&aa(r[1][0])))return null;h=_s(ki(r[1][0]),_)}for(let w=0;w<_;w++){const E=r[1][w];let A;if(rl(E)==="array")A=o.parse(E,void 0,h.itemType);else{const v=rl(E);if(v!==h.itemType.kind)return o.error(`Expected ${h.itemType.kind} but found ${v}.`);A=o.registry.literal.parse(["literal",E===void 0?null:E],o)}if(!A)return null;p.push(A)}}else{if((u==="to-boolean"||u==="to-string")&&r.length!==2)return o.error("Expected one argument.");h=eS[u];for(let _=1;_<r.length;_++){const w=o.parse(r[_],_,rn);if(!w)return null;p.push(w)}}return new nl(h,p)}evaluate(r){if(this.type.kind==="boolean")return!!this.args[0].evaluate(r);if(this.type.kind==="color"){let o,u;for(const p of this.args){if(o=p.evaluate(r),u=null,o instanceof _n)return o;if(typeof o=="string"){const h=r.parseColor(o);if(h)return h}else if(Array.isArray(o)&&(u=o.length<3||o.length>4?`Invalid rbga value ${JSON.stringify(o)}: expected an array containing either three or four numeric values.`:Ah(o[0],o[1],o[2],o[3]),!u))return new _n(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new Si(u||`Could not parse color from value '${typeof o=="string"?o:String(JSON.stringify(o))}'`)}if(this.type.kind==="number"){let o=null;for(const u of this.args){if(o=u.evaluate(r),o===null)return 0;const p=Number(o);if(!isNaN(p))return p}throw new Si(`Could not convert ${JSON.stringify(o)} to number.`)}return this.type.kind==="formatted"?As.fromString(Qi(this.args[0].evaluate(r))):this.type.kind==="resolvedImage"?Ps.build(Qi(this.args[0].evaluate(r))):this.type.kind==="array"?this.args.map(o=>o.evaluate(r)):Qi(this.args[0].evaluate(r))}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Pu([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Wl(this.args[0]).serialize();const r=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(o=>{r.push(o.serialize())}),r}}const tS=["Unknown","Point","LineString","Polygon"];class hp{constructor(r,o){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=r,this.options=o}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?tS[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(r){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const r=this.featureDistanceData.center,o=this.featureDistanceData.scale,{x:u,y:p}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(u*o-r[0])+this.featureDistanceData.bearing[1]*(p*o-r[1])}return 0}parseColor(r){let o=this._parseColorCache[r];return o||(o=this._parseColorCache[r]=_n.parse(r)),o}getConfig(r){return this.options?this.options.get(r):null}}class Ls{constructor(r,o,u,p,h){this.name=r,this.type=o,this._evaluate=u,this.args=p,this._overloadIndex=h}evaluate(r){if(!this._evaluate){const o=Ls.definitions[this.name];this._evaluate=Array.isArray(o)?o[2]:o.overloads[this._overloadIndex][1]}return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(r=>r.serialize()))}static parse(r,o){const u=r[0],p=Ls.definitions[u];if(!p)return o.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const h=Array.isArray(p)?p[0]:p.type,_=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,w=[];let E=null,A=-1;for(const[v,C]of _){if(Array.isArray(v)&&v.length!==r.length-1)continue;w.push(v),A++,E=new l_(o.registry,o.path,null,o.scope,void 0,o._scope,o.options);const I=[];let M=!1;for(let P=1;P<r.length;P++){const R=r[P],F=Array.isArray(v)?v[P-1]:v.type,B=E.parse(R,1+I.length,F);if(!B){M=!0;break}I.push(B)}if(!M)if(Array.isArray(v)&&v.length!==I.length)E.error(`Expected ${v.length} arguments, but found ${I.length} instead.`);else{for(let P=0;P<I.length;P++){const R=Array.isArray(v)?v[P]:v.type,F=I[P];E.concat(P+1).checkSubtype(R,F.type)}if(E.errors.length===0)return new Ls(u,h,C,I,A)}}if(w.length===1)o.errors.push(...E.errors);else{const v=(w.length?w:_.map(([I])=>I)).map(rS).join(" | "),C=[];for(let I=1;I<r.length;I++){const M=o.parse(r[I],1+C.length);if(!M)return null;C.push(bi(M.type))}o.error(`Expected arguments of type ${v}, but found (${C.join(", ")}) instead.`)}return null}static register(r,o){Ls.definitions=o;for(const u in o)r[u]=Ls}}function rS(c){return Array.isArray(c)?`(${c.map(bi).join(", ")})`:`(${bi(c.type)}...)`}class Nc{constructor(r,o,u){this.type=Qa,this.locale=u,this.caseSensitive=r,this.diacriticSensitive=o}static parse(r,o){if(r.length!==2)return o.error("Expected one argument.");const u=r[1];if(typeof u!="object"||Array.isArray(u))return o.error("Collator options argument must be an object.");const p=u["case-sensitive"]===void 0?o.parse(!1,1,Jr):o.parseObjectValue(u["case-sensitive"],1,"case-sensitive",Jr);if(!p)return null;const h=u["diacritic-sensitive"]===void 0?o.parse(!1,1,Jr):o.parseObjectValue(u["diacritic-sensitive"],1,"diacritic-sensitive",Jr);if(!h)return null;let _=null;return u.locale&&(_=o.parseObjectValue(u.locale,1,"locale",fn),!_)?null:new Nc(p,h,_)}evaluate(r){return new dp(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}serialize(){const r={};return r["case-sensitive"]=this.caseSensitive.serialize(),r["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(r.locale=this.locale.serialize()),["collator",r]}}function c0(c,r,o=0,u=c.length-1,p=nS){for(;u>o;){if(u-o>600){const E=u-o+1,A=r-o+1,v=Math.log(E),C=.5*Math.exp(2*v/3),I=.5*Math.sqrt(v*C*(E-C)/E)*(A-E/2<0?-1:1);c0(c,r,Math.max(o,Math.floor(r-A*C/E+I)),Math.min(u,Math.floor(r+(E-A)*C/E+I)),p)}const h=c[r];let _=o,w=u;for(Ph(c,o,r),p(c[u],h)>0&&Ph(c,o,u);_<w;){for(Ph(c,_,w),_++,w--;p(c[_],h)<0;)_++;for(;p(c[w],h)>0;)w--}p(c[o],h)===0?Ph(c,o,w):(w++,Ph(c,w,u)),w<=r&&(o=w+1),r<=w&&(u=w-1)}}function Ph(c,r,o){const u=c[r];c[r]=c[o],c[o]=u}function nS(c,r){return c<r?-1:c>r?1:0}function iS(c){let r=0;for(let o,u,p=0,h=c.length,_=h-1;p<h;_=p++)o=c[p],u=c[_],r+=(u.x-o.x)*(o.y+u.y);return r}function Ih(c,r){c[0]=Math.min(c[0],r[0]),c[1]=Math.min(c[1],r[1]),c[2]=Math.max(c[2],r[0]),c[3]=Math.max(c[3],r[1])}function kh(c,r){return!(c[0]<=r[0]||c[2]>=r[2]||c[1]<=r[1]||c[3]>=r[3])}function sS(c,r,o){const u=c[0]-r[0],p=c[1]-r[1],h=c[0]-o[0],_=c[1]-o[1];return u*_-h*p==0&&u*h<=0&&p*_<=0}function Rc(c,r,o=!1){let u=!1;for(let w=0,E=r.length;w<E;w++){const A=r[w];for(let v=0,C=A.length,I=C-1;v<C;I=v++){const M=A[I],P=A[v];if(sS(c,M,P))return o;(h=M)[1]>(p=c)[1]!=(_=P)[1]>p[1]&&p[0]<(_[0]-h[0])*(p[1]-h[1])/(_[1]-h[1])+h[0]&&(u=!u)}}var p,h,_;return u}function jc(c,r,o,u){const p=u[0]-o[0],h=u[1]-o[1],_=(c[0]-o[0])*h-p*(c[1]-o[1]),w=(r[0]-o[0])*h-p*(r[1]-o[1]);return _>0&&w<0||_<0&&w>0}function fp(c,r,o,u){return(p=[u[0]-o[0],u[1]-o[1]])[0]*(h=[r[0]-c[0],r[1]-c[1]])[1]-p[1]*h[0]!=0&&!(!jc(c,r,o,u)||!jc(o,u,c,r));var p,h}const Zl=8192;function r_(c,r){const o=(180+c[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,p=Math.pow(2,r.z);return[Math.round(o*p*Zl),Math.round(u*p*Zl)]}function oS(c,r){for(let o=0;o<r.length;o++)if(Rc(c,r[o]))return!0;return!1}function aS(c,r,o){for(const u of o)for(let p=0,h=u.length,_=h-1;p<h;_=p++)if(fp(c,r,u[_],u[p]))return!0;return!1}function u0(c,r){for(let o=0;o<c.length;++o)if(!Rc(c[o],r))return!1;for(let o=0;o<c.length-1;++o)if(aS(c[o],c[o+1],r))return!1;return!0}function lS(c,r){for(let o=0;o<r.length;o++)if(u0(c,r[o]))return!0;return!1}function Yl(c,r,o){const u=[];for(let p=0;p<c.length;p++){const h=[];for(let _=0;_<c[p].length;_++){const w=r_(c[p][_],o);Ih(r,w),h.push(w)}u.push(h)}return u}function zr(c,r,o){const u=[];for(let p=0;p<c.length;p++){const h=Yl(c[p],r,o);u.push(h)}return u}function ir(c,r,o,u){if(c[0]<o[0]||c[0]>o[2]){const p=.5*u;let h=c[0]-o[0]>p?-u:o[0]-c[0]>p?u:0;h===0&&(h=c[0]-o[2]>p?-u:o[2]-c[0]>p?u:0),c[0]+=h}Ih(r,c)}function pp(c,r,o,u){const p=Math.pow(2,u.z)*Zl,h=[u.x*Zl,u.y*Zl],_=[];if(!c)return _;for(const w of c)for(const E of w){const A=[E.x+h[0],E.y+h[1]];ir(A,r,o,p),_.push(A)}return _}function Mr(c,r,o,u){const p=Math.pow(2,u.z)*Zl,h=[u.x*Zl,u.y*Zl],_=[];if(!c)return _;for(const E of c){const A=[];for(const v of E){const C=[v.x+h[0],v.y+h[1]];Ih(r,C),A.push(C)}_.push(A)}if(r[2]-r[0]<=p/2){(w=r)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const E of _)for(const A of E)ir(A,r,o,p)}var w;return _}class il{constructor(r,o){this.type=Jr,this.geojson=r,this.geometries=o}static parse(r,o){if(r.length!==2)return o.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(aa(r[1])){const u=r[1];if(u.type==="FeatureCollection")for(let p=0;p<u.features.length;++p){const h=u.features[p].geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new il(u,u.features[p].geometry)}else if(u.type==="Feature"){const p=u.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new il(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new il(u,u)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return function(o,u){const p=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],_=o.canonicalID();if(!_)return!1;if(u.type==="Polygon"){const w=Yl(u.coordinates,h,_),E=pp(o.geometry(),p,h,_);if(!kh(p,h))return!1;for(const A of E)if(!Rc(A,w))return!1}if(u.type==="MultiPolygon"){const w=zr(u.coordinates,h,_),E=pp(o.geometry(),p,h,_);if(!kh(p,h))return!1;for(const A of E)if(!oS(A,w))return!1}return!0}(r,this.geometries);if(r.geometryType()==="LineString")return function(o,u){const p=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],_=o.canonicalID();if(!_)return!1;if(u.type==="Polygon"){const w=Yl(u.coordinates,h,_),E=Mr(o.geometry(),p,h,_);if(!kh(p,h))return!1;for(const A of E)if(!u0(A,w))return!1}if(u.type==="MultiPolygon"){const w=zr(u.coordinates,h,_),E=Mr(o.geometry(),p,h,_);if(!kh(p,h))return!1;for(const A of E)if(!lS(A,w))return!1}return!0}(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Iu={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},vr=1/298.257223563,n_=vr*(2-vr),Dc=Math.PI/180;class ku{static fromTile(r,o,u){const p=Math.PI*(1-2*(r+.5)/Math.pow(2,o)),h=Math.atan(.5*(Math.exp(p)-Math.exp(-p)))/Dc;return new ku(h,u)}static get units(){return Iu}constructor(r,o){if(r===void 0)throw new Error("No latitude given.");if(o&&!Iu[o])throw new Error(`Unknown unit ${o}. Use one of: ${Object.keys(Iu).join(", ")}`);const u=6378.137*Dc*(o?Iu[o]:1),p=Math.cos(r*Dc),h=1/(1-n_*(1-p*p)),_=Math.sqrt(h);this.kx=u*_*p,this.ky=u*_*h*(1-n_)}distance(r,o){const u=pi(r[0]-o[0])*this.kx,p=(r[1]-o[1])*this.ky;return Math.sqrt(u*u+p*p)}bearing(r,o){const u=pi(o[0]-r[0])*this.kx;return Math.atan2(u,(o[1]-r[1])*this.ky)/Dc}destination(r,o,u){const p=u*Dc;return this.offset(r,Math.sin(p)*o,Math.cos(p)*o)}offset(r,o,u){return[r[0]+o/this.kx,r[1]+u/this.ky]}lineDistance(r){let o=0;for(let u=0;u<r.length-1;u++)o+=this.distance(r[u],r[u+1]);return o}area(r){let o=0;for(let u=0;u<r.length;u++){const p=r[u];for(let h=0,_=p.length,w=_-1;h<_;w=h++)o+=pi(p[h][0]-p[w][0])*(p[h][1]+p[w][1])*(u?-1:1)}return Math.abs(o)/2*this.kx*this.ky}along(r,o){let u=0;if(o<=0)return r[0];for(let p=0;p<r.length-1;p++){const h=r[p],_=r[p+1],w=this.distance(h,_);if(u+=w,u>o)return Nu(h,_,(o-(u-w))/w)}return r[r.length-1]}pointToSegmentDistance(r,o,u){let[p,h]=o,_=pi(u[0]-p)*this.kx,w=(u[1]-h)*this.ky;if(_!==0||w!==0){const E=(pi(r[0]-p)*this.kx*_+(r[1]-h)*this.ky*w)/(_*_+w*w);E>1?(p=u[0],h=u[1]):E>0&&(p+=_/this.kx*E,h+=w/this.ky*E)}return _=pi(r[0]-p)*this.kx,w=(r[1]-h)*this.ky,Math.sqrt(_*_+w*w)}pointOnLine(r,o){let u=1/0,p=r[0][0],h=r[0][1],_=0,w=0;for(let E=0;E<r.length-1;E++){let A=r[E][0],v=r[E][1],C=pi(r[E+1][0]-A)*this.kx,I=(r[E+1][1]-v)*this.ky,M=0;C===0&&I===0||(M=(pi(o[0]-A)*this.kx*C+(o[1]-v)*this.ky*I)/(C*C+I*I),M>1?(A=r[E+1][0],v=r[E+1][1]):M>0&&(A+=C/this.kx*M,v+=I/this.ky*M)),C=pi(o[0]-A)*this.kx,I=(o[1]-v)*this.ky;const P=C*C+I*I;P<u&&(u=P,p=A,h=v,_=E,w=M)}return{point:[p,h],index:_,t:Math.max(0,Math.min(1,w))}}lineSlice(r,o,u){let p=this.pointOnLine(u,r),h=this.pointOnLine(u,o);if(p.index>h.index||p.index===h.index&&p.t>h.t){const A=p;p=h,h=A}const _=[p.point],w=p.index+1,E=h.index;!i_(u[w],_[0])&&w<=E&&_.push(u[w]);for(let A=w+1;A<=E;A++)_.push(u[A]);return i_(u[E],h.point)||_.push(h.point),_}lineSliceAlong(r,o,u){let p=0;const h=[];for(let _=0;_<u.length-1;_++){const w=u[_],E=u[_+1],A=this.distance(w,E);if(p+=A,p>r&&h.length===0&&h.push(Nu(w,E,(r-(p-A))/A)),p>=o)return h.push(Nu(w,E,(o-(p-A))/A)),h;p>r&&h.push(E)}return h}bufferPoint(r,o){const u=o/this.ky,p=o/this.kx;return[r[0]-p,r[1]-u,r[0]+p,r[1]+u]}bufferBBox(r,o){const u=o/this.ky,p=o/this.kx;return[r[0]-p,r[1]-u,r[2]+p,r[3]+u]}insideBBox(r,o){return pi(r[0]-o[0])>=0&&pi(r[0]-o[2])<=0&&r[1]>=o[1]&&r[1]<=o[3]}}function i_(c,r){return c[0]===r[0]&&c[1]===r[1]}function Nu(c,r,o){const u=pi(r[0]-c[0]);return[c[0]+u*o,c[1]+(r[1]-c[1])*o]}function pi(c){for(;c<-180;)c+=360;for(;c>180;)c-=360;return c}class Nh{constructor(r=[],o=(u,p)=>u<p?-1:u>p?1:0){if(this.data=r,this.length=this.data.length,this.compare=o,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(r){this.data.push(r),this._up(this.length++)}pop(){if(this.length===0)return;const r=this.data[0],o=this.data.pop();return--this.length>0&&(this.data[0]=o,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:o,compare:u}=this,p=o[r];for(;r>0;){const h=r-1>>1,_=o[h];if(u(p,_)>=0)break;o[r]=_,r=h}o[r]=p}_down(r){const{data:o,compare:u}=this,p=this.length>>1,h=o[r];for(;r<p;){let _=1+(r<<1);const w=_+1;if(w<this.length&&u(o[w],o[_])<0&&(_=w),u(o[_],h)>=0)break;o[r]=o[_],r=_}o[r]=h}}var Ct=8192;function mp(c,r){return r.dist-c.dist}const sl=100,ys=50;function d0(c){const r=[1/0,1/0,-1/0,-1/0];if(r.length!==c.length)return!1;for(let o=0;o<r.length;o++)if(r[o]!==c[o])return!1;return!0}function gp(c){return c[1]-c[0]+1}function ol(c,r){const o=c[1]>=c[0]&&c[1]<r;return o||console.warn("Distance Expression: Index is out of range"),o}function Ru(c,r){if(c[0]>c[1])return[null,null];const o=gp(c);if(r){if(o===2)return[c,null];const u=Math.floor(o/2);return[[c[0],c[0]+u],[c[0]+u,c[1]]]}{if(o===1)return[c,null];const u=Math.floor(o/2)-1;return[[c[0],c[0]+u],[c[0]+u+1,c[1]]]}}function Xl(c,r){const o=[1/0,1/0,-1/0,-1/0];if(!ol(r,c.length))return o;for(let u=r[0];u<=r[1];++u)Ih(o,c[u]);return o}function ju(c){const r=[1/0,1/0,-1/0,-1/0];for(let o=0;o<c.length;++o)for(let u=0;u<c[o].length;++u)Ih(r,c[o][u]);return r}function Du(c,r,o){if(d0(c)||d0(r))return NaN;let u=0,p=0;return c[2]<r[0]&&(u=r[0]-c[2]),c[0]>r[2]&&(u=c[0]-r[2]),c[1]>r[3]&&(p=c[1]-r[3]),c[3]<r[1]&&(p=r[1]-c[3]),o.distance([0,0],[u,p])}function cS(c){return 360*c-180}function uS(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}function s_(c,r){const o=Math.pow(2,r.z),u=(c.y/Ct+r.y)/o;return[cS((c.x/Ct+r.x)/o),uS(u)]}function h0(c,r){const o=[];for(let u=0;u<c.length;++u)o.push(s_(c[u],r));return o}function f0(c,r,o){const u=o.pointOnLine(r,c).point;return o.distance(c,u)}function p0(c,r,o,u,p){const h=o.slice(u[0],u[1]+1);let _=1/0;for(let w=r[0];w<=r[1];++w)if((_=Math.min(_,f0(c[w],h,p)))===0)return 0;return _}function _p(c,r,o,u,p){const h=Math.min(p.pointToSegmentDistance(c,o,u),p.pointToSegmentDistance(r,o,u)),_=Math.min(p.pointToSegmentDistance(o,c,r),p.pointToSegmentDistance(u,c,r));return Math.min(h,_)}function dS(c,r,o,u,p){if(!ol(r,c.length)||!ol(u,o.length))return NaN;let h=1/0;for(let _=r[0];_<r[1];++_)for(let w=u[0];w<u[1];++w){if(fp(c[_],c[_+1],o[w],o[w+1]))return 0;h=Math.min(h,_p(c[_],c[_+1],o[w],o[w+1],p))}return h}function Lc(c,r,o,u,p){if(!ol(r,c.length)||!ol(u,o.length))return NaN;let h=1/0;for(let _=r[0];_<=r[1];++_)for(let w=u[0];w<=u[1];++w)if((h=Math.min(h,p.distance(c[_],o[w])))===0)return h;return h}function hS(c,r,o){if(Rc(c,r,!0))return 0;let u=1/0;for(const p of r){const h=p.length;if(h<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(p[0]!==p[h-1]&&(u=Math.min(u,o.pointToSegmentDistance(c,p[h-1],p[0])))===0||(u=Math.min(u,f0(c,p,o)))===0)return u}return u}function fS(c,r,o,u){if(!ol(r,c.length))return NaN;for(let h=r[0];h<=r[1];++h)if(Rc(c[h],o,!0))return 0;let p=1/0;for(let h=r[0];h<r[1];++h)for(const _ of o)for(let w=0,E=_.length,A=E-1;w<E;A=w++){if(fp(c[h],c[h+1],_[A],_[w]))return 0;p=Math.min(p,_p(c[h],c[h+1],_[A],_[w],u))}return p}function yp(c,r){for(const o of c)for(let u=0;u<=o.length-1;++u)if(Rc(o[u],r,!0))return!0;return!1}function m0(c,r,o,u=1/0){const p=ju(c),h=ju(r);if(u!==1/0&&Du(p,h,o)>=u)return u;if(kh(p,h)){if(yp(c,r))return 0}else if(yp(r,c))return 0;let _=u;for(const w of c)for(let E=0,A=w.length,v=A-1;E<A;v=E++)for(const C of r)for(let I=0,M=C.length,P=M-1;I<M;P=I++){if(fp(w[v],w[E],C[P],C[I]))return 0;_=Math.min(_,_p(w[v],w[E],C[P],C[I],o))}return _}function Rh(c,r,o,u,p,h,_){if(h===null||_===null)return;const w=Du(Xl(u,h),Xl(p,_),o);w<r&&c.push({dist:w,range1:h,range2:_})}function la(c,r,o,u,p=1/0){let h=Math.min(u.distance(c[0],o[0][0]),p);if(h===0)return h;const _=new Nh([{dist:0,range1:[0,c.length-1],range2:[0,0]}],mp),w=r?ys:sl,E=ju(o);for(;_.length;){const A=_.pop();if(A.dist>=h)continue;const v=A.range1;if(gp(v)<=w){if(!ol(v,c.length))return NaN;if(r){const C=fS(c,v,o,u);if((h=Math.min(h,C))===0)return h}else for(let C=v[0];C<=v[1];++C){const I=hS(c[C],o,u);if((h=Math.min(h,I))===0)return h}}else{const C=Ru(v,r);if(C[0]!==null){const I=Du(Xl(c,C[0]),E,u);I<h&&_.push({dist:I,range1:C[0],range2:[0,0]})}if(C[1]!==null){const I=Du(Xl(c,C[1]),E,u);I<h&&_.push({dist:I,range1:C[1],range2:[0,0]})}}}return h}function o_(c,r,o,u,p,h=1/0){let _=Math.min(h,p.distance(c[0],o[0]));if(_===0)return _;const w=new Nh([{dist:0,range1:[0,c.length-1],range2:[0,o.length-1]}],mp),E=r?ys:sl,A=u?ys:sl;for(;w.length;){const v=w.pop();if(v.dist>=_)continue;const C=v.range1,I=v.range2;if(gp(C)<=E&&gp(I)<=A){if(!ol(C,c.length)||!ol(I,o.length))return NaN;if(r&&u?_=Math.min(_,dS(c,C,o,I,p)):r||u?r&&!u?_=Math.min(_,p0(o,I,c,C,p)):!r&&u&&(_=Math.min(_,p0(c,C,o,I,p))):_=Math.min(_,Lc(c,C,o,I,p)),_===0)return _}else{const M=Ru(C,r),P=Ru(I,u);Rh(w,_,p,c,o,M[0],P[0]),Rh(w,_,p,c,o,M[0],P[1]),Rh(w,_,p,c,o,M[1],P[0]),Rh(w,_,p,c,o,M[1],P[1])}}return _}function xp(c,r,o,u,p=1/0){let h=p;const _=Xl(c,[0,c.length-1]);for(const w of o)if(!(h!==1/0&&Du(_,Xl(w,[0,w.length-1]),u)>=h)&&(h=Math.min(h,o_(c,r,w,!0,u,h)),h===0))return h;return h}function jh(c,r,o,u,p=1/0){let h=p;const _=Xl(c,[0,c.length-1]);for(const w of o){if(h!==1/0&&Du(_,ju(w),u)>=h)continue;const E=la(c,r,w,u,h);if(isNaN(E))return E;if((h=Math.min(h,E))===0)return h}return h}function vp(c){return c==="Point"||c==="MultiPoint"||c==="LineString"||c==="MultiLineString"||c==="Polygon"||c==="MultiPolygon"}class Kl{constructor(r,o){this.type=er,this.geojson=r,this.geometries=o}static parse(r,o){if(r.length!==2)return o.error(`'distance' expression requires either one argument, but found ' ${r.length-1} instead.`);if(aa(r[1])){const u=r[1];if(u.type==="FeatureCollection"){for(let p=0;p<u.features.length;++p)if(vp(u.features[p].geometry.type))return new Kl(u,u.features[p].geometry)}else if(u.type==="Feature"){if(vp(u.geometry.type))return new Kl(u,u.geometry)}else if(vp(u.type))return new Kl(u,u)}return o.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(r){const o=r.geometry(),u=r.canonicalID();if(o!=null&&u!=null){if(r.geometryType()==="Point")return function(p,h,_){const w=[];for(const A of p)for(const v of A)w.push(s_(v,h));const E=new ku(w[0][1],"meters");return _.type==="Point"||_.type==="MultiPoint"||_.type==="LineString"?o_(w,!1,_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",E):_.type==="MultiLineString"?xp(w,!1,_.coordinates,E):_.type==="Polygon"||_.type==="MultiPolygon"?jh(w,!1,_.type==="Polygon"?[_.coordinates]:_.coordinates,E):null}(o,u,this.geometries);if(r.geometryType()==="LineString")return function(p,h,_){const w=[];for(const A of p){const v=[];for(const C of A)v.push(s_(C,h));w.push(v)}const E=new ku(w[0][0][1],"meters");if(_.type==="Point"||_.type==="MultiPoint"||_.type==="LineString")return xp(_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",w,E);if(_.type==="MultiLineString"){let A=1/0;for(let v=0;v<_.coordinates.length;v++){const C=xp(_.coordinates[v],!0,w,E,A);if(isNaN(C))return C;if((A=Math.min(A,C))===0)return A}return A}if(_.type==="Polygon"||_.type==="MultiPolygon"){let A=1/0;for(let v=0;v<w.length;v++){const C=jh(w[v],!0,_.type==="Polygon"?[_.coordinates]:_.coordinates,E,A);if(isNaN(C))return C;if((A=Math.min(A,C))===0)return A}return A}return null}(o,u,this.geometries);if(r.geometryType()==="Polygon")return function(p,h,_){const w=[];for(const A of function(v,C){const I=v.length;if(I<=1)return[v];const M=[];let P,R;for(let F=0;F<I;F++){const B=iS(v[F]);B!==0&&(v[F].area=Math.abs(B),R===void 0&&(R=B<0),R===B<0?(P&&M.push(P),P=[v[F]]):P.push(v[F]))}return P&&M.push(P),M}(p)){const v=[];for(let C=0;C<A.length;++C)v.push(h0(A[C],h));w.push(v)}const E=new ku(w[0][0][0][1],"meters");if(_.type==="Point"||_.type==="MultiPoint"||_.type==="LineString")return jh(_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",w,E);if(_.type==="MultiLineString"){let A=1/0;for(let v=0;v<_.coordinates.length;v++){const C=jh(_.coordinates[v],!0,w,E,A);if(isNaN(C))return C;if((A=Math.min(A,C))===0)return A}return A}return _.type==="Polygon"||_.type==="MultiPolygon"?function(A,v,C){let I=1/0;for(const M of A)for(const P of v){const R=m0(M,P,C,I);if(isNaN(R))return R;if((I=Math.min(I,R))===0)return I}return I}(_.type==="Polygon"?[_.coordinates]:_.coordinates,w,E):null}(o,u,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function bp(c,r){switch(c){case"string":return Qi(r);case"number":return+r;case"boolean":return!!r;case"color":return _n.parse(r);case"formatted":return As.fromString(Qi(r));case"resolvedImage":return Ps.build(Qi(r))}return r}function a_(c,r,o,u){return u!==void 0&&(c=u*Math.round(c/u)),r!==void 0&&c<r&&(c=r),o!==void 0&&c>o&&(c=o),c}class Oc{constructor(r,o,u){this.type=r,this.key=o,this.scope=u}static parse(r,o){let u=o.expectedType;if(u==null&&(u=rn),r.length<2||r.length>3)return o.error("Invalid number of arguments for 'config' expression.");const p=o.parse(r[1],1);if(!(p instanceof tl))return o.error("Key name of 'config' expression must be a string literal.");if(r.length>=3){const h=o.parse(r[2],2);return h instanceof tl?new Oc(u,Qi(p.value),Qi(h.value)):o.error("Scope of 'config' expression must be a string literal.")}return new Oc(u,Qi(p.value))}evaluate(r){const o=[this.key,this.scope,r.scope].filter(Boolean).join(""),u=r.getConfig(o);if(!u)return null;const{type:p,value:h,values:_,minValue:w,maxValue:E,stepValue:A}=u,v=u.default.evaluate(r);let C=v;if(h){const I=r.scope;r.scope=(I||"").split("").slice(1).join(""),C=h.evaluate(r),r.scope=I}return p&&(C=bp(p,C)),C===void 0||w===void 0&&E===void 0&&A===void 0||(typeof C=="number"?C=a_(C,w,E,A):Array.isArray(C)&&(C=C.map(I=>typeof I=="number"?a_(I,w,E,A):I))),h!==void 0&&C!==void 0&&_&&!_.includes(C)&&(C=v,p&&(C=bp(p,C))),(p&&p!==this.type||C!==void 0&&ki(C)!==this.type)&&(C=bp(this.type.kind,C)),C}eachChild(){}outputDefined(){return!1}serialize(){const r=["config",this.key];return this.scope&&r.concat(this.key),r}}function Lu(c){if(c instanceof Ls&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof il||c instanceof Kl)return!1;let r=!0;return c.eachChild(o=>{r&&!Lu(o)&&(r=!1)}),r}function Dh(c){if(c instanceof Ls&&c.name==="feature-state")return!1;let r=!0;return c.eachChild(o=>{r&&!Dh(o)&&(r=!1)}),r}function Lh(c){if(c instanceof Oc)return new Set([c.key]);let r=new Set;return c.eachChild(o=>{r=new Set([...r,...Lh(o)])}),r}function al(c,r){if(c instanceof Ls&&r.indexOf(c.name)>=0)return!1;let o=!0;return c.eachChild(u=>{o&&!al(u,r)&&(o=!1)}),o}class zc{constructor(r,o){this.type=o.type,this.name=r,this.boundExpression=o}static parse(r,o){if(r.length!==2||typeof r[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");const u=r[1];return o.scope.has(u)?new zc(u,o.scope.get(u)):o.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Ou{constructor(r,o=[],u,p=new up,h=[],_,w){this.registry=r,this.path=o,this.key=o.map(E=>typeof E=="string"?`['${E}']`:`[${E}]`).join(""),this.scope=p,this.errors=h,this.expectedType=u,this._scope=_,this.options=w}parse(r,o,u,p,h={}){return o||u?this.concat(o,null,u,p)._parse(r,h):this._parse(r,h)}parseObjectValue(r,o,u,p,h,_={}){return this.concat(o,u,p,h)._parse(r,_)}_parse(r,o){function u(p,h,_){return _==="assert"?new fo(h,[p]):_==="coerce"?new nl(h,[p]):p}if(r!==null&&typeof r!="string"&&typeof r!="boolean"&&typeof r!="number"||(r=["literal",r]),Array.isArray(r)){if(r.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=typeof r[0]=="string"?this.registry[r[0]]:void 0;if(p){let h=p.parse(r,this);if(!h)return null;if(this.expectedType){const _=this.expectedType,w=h.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||w.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||w.kind!=="value"&&w.kind!=="string"){if(this.checkSubtype(_,w))return null}else h=u(h,_,o.typeAnnotation||"coerce");else h=u(h,_,o.typeAnnotation||"assert")}if(!(h instanceof tl)&&h.type.kind!=="resolvedImage"&&wp(h)){const _=new hp(this._scope,this.options);try{h=new tl(h.type,h.evaluate(_))}catch(w){return this.error(w.message),null}}return h}return nl.parse(["to-array",r],this)}return this.error(r===void 0?"'undefined' value invalid. Use null instead.":typeof r=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,o,u,p){let h=typeof r=="number"?this.path.concat(r):this.path;h=typeof o=="string"?h.concat(o):h;const _=p?this.scope.concat(p):this.scope;return new Ou(this.registry,h,u||null,_,this.errors,this._scope,this.options)}error(r,...o){const u=`${this.key}${o.map(p=>`[${p}]`).join("")}`;this.errors.push(new Lo(u,r))}checkSubtype(r,o){const u=Mu(r,o);return u&&this.error(u),u}}var l_=Ou;function wp(c){if(c instanceof zc)return wp(c.boundExpression);if(c instanceof Ls&&c.name==="error"||c instanceof Nc||c instanceof il||c instanceof Kl||c instanceof Oc)return!1;const r=c instanceof nl||c instanceof fo;let o=!0;return c.eachChild(u=>{o=r?o&&wp(u):o&&u instanceof tl}),!!o&&Lu(c)&&al(c,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Oh(c,r){const o=c.length-1;let u,p,h=0,_=o,w=0;for(;h<=_;)if(w=Math.floor((h+_)/2),u=c[w],p=c[w+1],u<=r){if(w===o||r<p)return w;h=w+1}else{if(!(u>r))throw new Si("Input is not a number.");_=w-1}return 0}class Ra{constructor(r,o,u){this.type=r,this.input=o,this.labels=[],this.outputs=[];for(const[p,h]of u)this.labels.push(p),this.outputs.push(h)}static parse(r,o){if(r.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return o.error("Expected an even number of arguments.");const u=o.parse(r[1],1,er);if(!u)return null;const p=[];let h=null;o.expectedType&&o.expectedType.kind!=="value"&&(h=o.expectedType);for(let _=1;_<r.length;_+=2){const w=_===1?-1/0:r[_],E=r[_+1],A=_,v=_+1;if(typeof w!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(p.length&&p[p.length-1][0]>=w)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',A);const C=o.parse(E,v,h);if(!C)return null;h=h||C.type,p.push([w,C])}return new Ra(h,u,p)}evaluate(r){const o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(r);const p=this.input.evaluate(r);if(p<=o[0])return u[0].evaluate(r);const h=o.length;return p>=o[h-1]?u[h-1].evaluate(r):u[Oh(o,p)].evaluate(r)}eachChild(r){r(this.input);for(const o of this.outputs)r(o)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){const r=["step",this.input.serialize()];for(let o=0;o<this.labels.length;o++)o>0&&r.push(this.labels[o]),r.push(this.outputs[o].serialize());return r}}const qr=.95047,g0=1.08883,_0=4/29,zu=6/29,c_=3*zu*zu,pS=zu*zu*zu,qn=Math.PI/180,mS=180/Math.PI;function u_(c){return c>pS?Math.pow(c,1/3):c/c_+_0}function d_(c){return c>zu?c*c*c:c_*(c-_0)}function h_(c){return 255*(c<=.0031308?12.92*c:1.055*Math.pow(c,1/2.4)-.055)}function f_(c){return(c/=255)<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function y0(c){const r=f_(c.r),o=f_(c.g),u=f_(c.b),p=u_((.4124564*r+.3575761*o+.1804375*u)/qr),h=u_((.2126729*r+.7151522*o+.072175*u)/1);return{l:116*h-16,a:500*(p-h),b:200*(h-u_((.0193339*r+.119192*o+.9503041*u)/g0)),alpha:c.a}}function x0(c){let r=(c.l+16)/116,o=isNaN(c.a)?r:r+c.a/500,u=isNaN(c.b)?r:r-c.b/200;return r=1*d_(r),o=qr*d_(o),u=g0*d_(u),new _n(h_(3.2404542*o-1.5371385*r-.4985314*u),h_(-.969266*o+1.8760108*r+.041556*u),h_(.0556434*o-.2040259*r+1.0572252*u),c.alpha)}function gS(c,r,o){const u=r-c;return c+o*(u>180||u<-180?u-360*Math.round(u/360):u)}const zh={forward:y0,reverse:x0,interpolate:function(c,r,o){return{l:ur(c.l,r.l,o),a:ur(c.a,r.a,o),b:ur(c.b,r.b,o),alpha:ur(c.alpha,r.alpha,o)}}},Fh={forward:function(c){const{l:r,a:o,b:u}=y0(c),p=Math.atan2(u,o)*mS;return{h:p<0?p+360:p,c:Math.sqrt(o*o+u*u),l:r,alpha:c.a}},reverse:function(c){const r=c.h*qn,o=c.c;return x0({l:c.l,a:Math.cos(r)*o,b:Math.sin(r)*o,alpha:c.alpha})},interpolate:function(c,r,o){return{h:gS(c.h,r.h,o),c:ur(c.c,r.c,o),l:ur(c.l,r.l,o),alpha:ur(c.alpha,r.alpha,o)}}};var v0=Object.freeze({__proto__:null,hcl:Fh,lab:zh});class po{constructor(r,o,u,p,h){this.type=r,this.operator=o,this.interpolation=u,this.input=p,this.labels=[],this.outputs=[];for(const[_,w]of h)this.labels.push(_),this.outputs.push(w)}static interpolationFactor(r,o,u,p){let h=0;if(r.name==="exponential")h=p_(o,r.base,u,p);else if(r.name==="linear")h=p_(o,1,u,p);else if(r.name==="cubic-bezier"){const _=r.controlPoints;h=new pn(_[0],_[1],_[2],_[3]).solve(p_(o,1,u,p))}return h}static parse(r,o){let[u,p,h,..._]=r;if(!Array.isArray(p)||p.length===0)return o.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const A=p[1];if(typeof A!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:A}}else{if(p[0]!=="cubic-bezier")return o.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const A=p.slice(1);if(A.length!==4||A.some(v=>typeof v!="number"||v<0||v>1))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:A}}}if(r.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length-1>3&&(r.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(h=o.parse(h,2,er),!h)return null;const w=[];let E=null;u==="interpolate-hcl"||u==="interpolate-lab"?E=Ms:o.expectedType&&o.expectedType.kind!=="value"&&(E=o.expectedType);for(let A=0;A<_.length;A+=2){const v=_[A],C=_[A+1],I=A+3,M=A+4;if(typeof v!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(w.length&&w[w.length-1][0]>=v)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',I);const P=o.parse(C,M,E);if(!P)return null;E=E||P.type,w.push([v,P])}return E.kind==="number"||E.kind==="color"||E.kind==="array"&&E.itemType.kind==="number"&&typeof E.N=="number"?new po(E,u,p,h,w):o.error(`Type ${bi(E)} is not interpolatable.`)}evaluate(r){const o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(r);const p=this.input.evaluate(r);if(p<=o[0])return u[0].evaluate(r);const h=o.length;if(p>=o[h-1])return u[h-1].evaluate(r);const _=Oh(o,p),w=po.interpolationFactor(this.interpolation,p,o[_],o[_+1]),E=u[_].evaluate(r),A=u[_+1].evaluate(r);return this.operator==="interpolate"?Eh[this.type.kind.toLowerCase()](E,A,w):this.operator==="interpolate-hcl"?Fh.reverse(Fh.interpolate(Fh.forward(E),Fh.forward(A),w)):zh.reverse(zh.interpolate(zh.forward(E),zh.forward(A),w))}eachChild(r){r(this.input);for(const o of this.outputs)r(o)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){let r;r=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const o=[this.operator,r,this.input.serialize()];for(let u=0;u<this.labels.length;u++)o.push(this.labels[u],this.outputs[u].serialize());return o}}function p_(c,r,o,u){const p=u-o,h=c-o;return p===0?0:r===1?h/p:(Math.pow(r,h)-1)/(Math.pow(r,p)-1)}class Sp{constructor(r,o){this.type=r,this.args=o}static parse(r,o){if(r.length<2)return o.error("Expectected at least one argument.");let u=null;const p=o.expectedType;p&&p.kind!=="value"&&(u=p);const h=[];for(const w of r.slice(1)){const E=o.parse(w,1+h.length,u,void 0,{typeAnnotation:"omit"});if(!E)return null;u=u||E.type,h.push(E)}const _=p&&h.some(w=>Mu(p,w.type));return new Sp(_?rn:u,h)}evaluate(r){let o,u=null,p=0;for(const h of this.args){if(p++,u=h.evaluate(r),u&&u instanceof Ps&&!u.available&&(o||(o=u),u=null,p===this.args.length))return o;if(u!==null)break}return u}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=["coalesce"];return this.eachChild(o=>{r.push(o.serialize())}),r}}class Tp{constructor(r,o){this.type=o.type,this.bindings=[].concat(r),this.result=o}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const o of this.bindings)r(o[1]);r(this.result)}static parse(r,o){if(r.length<4)return o.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const u=[];for(let h=1;h<r.length-1;h+=2){const _=r[h];if(typeof _!="string")return o.error(`Expected string, but found ${typeof _} instead.`,h);if(/[^a-zA-Z0-9_]/.test(_))return o.error("Variable names must contain only alphanumeric characters or '_'.",h);const w=o.parse(r[h+1],h+1);if(!w)return null;u.push([_,w])}const p=o.parse(r[r.length-1],r.length-1,o.expectedType,u);return p?new Tp(u,p):null}outputDefined(){return this.result.outputDefined()}serialize(){const r=["let"];for(const[o,u]of this.bindings)r.push(o,u.serialize());return r.push(this.result.serialize()),r}}class m_{constructor(r,o,u){this.type=r,this.index=o,this.input=u}static parse(r,o){if(r.length!==3)return o.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const u=o.parse(r[1],1,er),p=o.parse(r[2],2,_s(o.expectedType||rn));return u&&p?new m_(p.type.itemType,u,p):null}evaluate(r){const o=this.index.evaluate(r),u=this.input.evaluate(r);if(o<0)throw new Si(`Array index out of bounds: ${o} < 0.`);if(o>=u.length)throw new Si(`Array index out of bounds: ${o} > ${u.length-1}.`);if(o!==Math.floor(o))throw new Si(`Array index must be an integer, but found ${o} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return u[o]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class g_{constructor(r,o,u){this.type=r,this.index=o,this.input=u}static parse(r,o){if(r.length!==3)return o.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const u=o.parse(r[1],1,er),p=o.parse(r[2],2,_s(o.expectedType||rn));return u&&p?new g_(p.type.itemType,u,p):null}evaluate(r){const o=this.index.evaluate(r),u=this.input.evaluate(r);if(o<0)throw new Si(`Array index out of bounds: ${o} < 0.`);if(o>u.length-1)throw new Si(`Array index out of bounds: ${o} > ${u.length-1}.`);if(o===Math.floor(o))return u[o];const p=Math.floor(o),h=Math.ceil(o),_=u[p],w=u[h];if(typeof _!="number"||typeof w!="number")throw new Si(`Cannot interpolate between non-number values at index ${o}.`);const E=o-p;return _*(1-E)+w*E}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class __{constructor(r,o){this.type=Jr,this.needle=r,this.haystack=o}static parse(r,o){if(r.length!==3)return o.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const u=o.parse(r[1],1,rn),p=o.parse(r[2],2,rn);return u&&p?e_(u.type,[Jr,fn,er,Eu,rn])?new __(u,p):o.error(`Expected first argument to be of type boolean, string, number or null, but found ${bi(u.type)} instead`):null}evaluate(r){const o=this.needle.evaluate(r),u=this.haystack.evaluate(r);if(u==null)return!1;if(!Au(o,["boolean","string","number","null"]))throw new Si(`Expected first argument to be of type boolean, string, number or null, but found ${bi(ki(o))} instead.`);if(!Au(u,["string","array"]))throw new Si(`Expected second argument to be of type array or string, but found ${bi(ki(u))} instead.`);return u.indexOf(o)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Ep{constructor(r,o,u){this.type=er,this.needle=r,this.haystack=o,this.fromIndex=u}static parse(r,o){if(r.length<=2||r.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const u=o.parse(r[1],1,rn),p=o.parse(r[2],2,rn);if(!u||!p)return null;if(!e_(u.type,[Jr,fn,er,Eu,rn]))return o.error(`Expected first argument to be of type boolean, string, number or null, but found ${bi(u.type)} instead`);if(r.length===4){const h=o.parse(r[3],3,er);return h?new Ep(u,p,h):null}return new Ep(u,p)}evaluate(r){const o=this.needle.evaluate(r),u=this.haystack.evaluate(r);if(!Au(o,["boolean","string","number","null"]))throw new Si(`Expected first argument to be of type boolean, string, number or null, but found ${bi(ki(o))} instead.`);if(!Au(u,["string","array"]))throw new Si(`Expected second argument to be of type array or string, but found ${bi(ki(u))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(r);return u.indexOf(o,p)}return u.indexOf(o)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const r=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),r]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class y_{constructor(r,o,u,p,h,_){this.inputType=r,this.type=o,this.input=u,this.cases=p,this.outputs=h,this.otherwise=_}static parse(r,o){if(r.length<5)return o.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return o.error("Expected an even number of arguments.");let u,p;o.expectedType&&o.expectedType.kind!=="value"&&(p=o.expectedType);const h={},_=[];for(let A=2;A<r.length-1;A+=2){let v=r[A];const C=r[A+1];Array.isArray(v)||(v=[v]);const I=o.concat(A);if(v.length===0)return I.error("Expected at least one branch label.");for(const P of v){if(typeof P!="number"&&typeof P!="string")return I.error("Branch labels must be numbers or strings.");if(typeof P=="number"&&Math.abs(P)>Number.MAX_SAFE_INTEGER)return I.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof P=="number"&&Math.floor(P)!==P)return I.error("Numeric branch labels must be integer values.");if(u){if(I.checkSubtype(u,ki(P)))return null}else u=ki(P);if(h[String(P)]!==void 0)return I.error("Branch labels must be unique.");h[String(P)]=_.length}const M=o.parse(C,A,p);if(!M)return null;p=p||M.type,_.push(M)}const w=o.parse(r[1],1,rn);if(!w)return null;const E=o.parse(r[r.length-1],r.length-1,p);return E?w.type.kind!=="value"&&o.concat(1).checkSubtype(u,w.type)?null:new y_(u,p,w,h,_,E):null}evaluate(r){const o=this.input.evaluate(r);return(ki(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["match",this.input.serialize()],o=Object.keys(this.cases).sort(),u=[],p={};for(const _ of o){const w=p[this.cases[_]];w===void 0?(p[this.cases[_]]=u.length,u.push([this.cases[_],[_]])):u[w][1].push(_)}const h=_=>this.inputType.kind==="number"?Number(_):_;for(const[_,w]of u)r.push(w.length===1?h(w[0]):w.map(h)),r.push(this.outputs[_].serialize());return r.push(this.otherwise.serialize()),r}}class x_{constructor(r,o,u){this.type=r,this.branches=o,this.otherwise=u}static parse(r,o){if(r.length<4)return o.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return o.error("Expected an odd number of arguments.");let u;o.expectedType&&o.expectedType.kind!=="value"&&(u=o.expectedType);const p=[];for(let _=1;_<r.length-1;_+=2){const w=o.parse(r[_],_,Jr);if(!w)return null;const E=o.parse(r[_+1],_+1,u);if(!E)return null;p.push([w,E]),u=u||E.type}const h=o.parse(r[r.length-1],r.length-1,u);return h?new x_(u,p,h):null}evaluate(r){for(const[o,u]of this.branches)if(o.evaluate(r))return u.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[o,u]of this.branches)r(o),r(u);r(this.otherwise)}outputDefined(){return this.branches.every(([r,o])=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["case"];return this.eachChild(o=>{r.push(o.serialize())}),r}}class Cp{constructor(r,o,u,p){this.type=r,this.input=o,this.beginIndex=u,this.endIndex=p}static parse(r,o){if(r.length<=2||r.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const u=o.parse(r[1],1,rn),p=o.parse(r[2],2,er);if(!u||!p)return null;if(!e_(u.type,[_s(rn),fn,rn]))return o.error(`Expected first argument to be of type array or string, but found ${bi(u.type)} instead`);if(r.length===4){const h=o.parse(r[3],3,er);return h?new Cp(u.type,u,p,h):null}return new Cp(u.type,u,p)}evaluate(r){const o=this.input.evaluate(r),u=this.beginIndex.evaluate(r);if(!Au(o,["string","array"]))throw new Si(`Expected first argument to be of type array or string, but found ${bi(ki(o))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(r);return o.slice(u,p)}return o.slice(u)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const r=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),r]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function b0(c,r){return c==="=="||c==="!="?r.kind==="boolean"||r.kind==="string"||r.kind==="number"||r.kind==="null"||r.kind==="value":r.kind==="string"||r.kind==="number"||r.kind==="value"}function w0(c,r,o,u){return u.compare(r,o)===0}function Fu(c,r,o){const u=c!=="=="&&c!=="!=";return class eV{constructor(h,_,w){this.type=Jr,this.lhs=h,this.rhs=_,this.collator=w,this.hasUntypedArgument=h.type.kind==="value"||_.type.kind==="value"}static parse(h,_){if(h.length!==3&&h.length!==4)return _.error("Expected two or three arguments.");const w=h[0];let E=_.parse(h[1],1,rn);if(!E)return null;if(!b0(w,E.type))return _.concat(1).error(`"${w}" comparisons are not supported for type '${bi(E.type)}'.`);let A=_.parse(h[2],2,rn);if(!A)return null;if(!b0(w,A.type))return _.concat(2).error(`"${w}" comparisons are not supported for type '${bi(A.type)}'.`);if(E.type.kind!==A.type.kind&&E.type.kind!=="value"&&A.type.kind!=="value")return _.error(`Cannot compare types '${bi(E.type)}' and '${bi(A.type)}'.`);u&&(E.type.kind==="value"&&A.type.kind!=="value"?E=new fo(A.type,[E]):E.type.kind!=="value"&&A.type.kind==="value"&&(A=new fo(E.type,[A])));let v=null;if(h.length===4){if(E.type.kind!=="string"&&A.type.kind!=="string"&&E.type.kind!=="value"&&A.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(v=_.parse(h[3],3,Qa),!v)return null}return new eV(E,A,v)}evaluate(h){const _=this.lhs.evaluate(h),w=this.rhs.evaluate(h);if(u&&this.hasUntypedArgument){const E=ki(_),A=ki(w);if(E.kind!==A.kind||E.kind!=="string"&&E.kind!=="number")throw new Si(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${E.kind}, ${A.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const E=ki(_),A=ki(w);if(E.kind!=="string"||A.kind!=="string")return r(h,_,w)}return this.collator?o(h,_,w,this.collator.evaluate(h)):r(h,_,w)}eachChild(h){h(this.lhs),h(this.rhs),this.collator&&h(this.collator)}outputDefined(){return!0}serialize(){const h=[c];return this.eachChild(_=>{h.push(_.serialize())}),h}}}const _S=Fu("==",function(c,r,o){return r===o},w0),yS=Fu("!=",function(c,r,o){return r!==o},function(c,r,o,u){return!w0(0,r,o,u)}),xS=Fu("<",function(c,r,o){return r<o},function(c,r,o,u){return u.compare(r,o)<0}),vS=Fu(">",function(c,r,o){return r>o},function(c,r,o,u){return u.compare(r,o)>0}),bS=Fu("<=",function(c,r,o){return r<=o},function(c,r,o,u){return u.compare(r,o)<=0}),wS=Fu(">=",function(c,r,o){return r>=o},function(c,r,o,u){return u.compare(r,o)>=0});class Bh{constructor(r,o,u,p,h,_){this.type=fn,this.number=r,this.locale=o,this.currency=u,this.unit=p,this.minFractionDigits=h,this.maxFractionDigits=_}static parse(r,o){if(r.length!==3)return o.error("Expected two arguments.");const u=o.parse(r[1],1,er);if(!u)return null;const p=r[2];if(typeof p!="object"||Array.isArray(p))return o.error("NumberFormat options argument must be an object.");let h=null;if(p.locale&&(h=o.parseObjectValue(p.locale,2,"locale",fn),!h))return null;let _=null;if(p.currency&&(_=o.parseObjectValue(p.currency,2,"currency",fn),!_))return null;let w=null;if(p.unit&&(w=o.parseObjectValue(p.unit,2,"unit",fn),!w))return null;let E=null;if(p["min-fraction-digits"]&&(E=o.parseObjectValue(p["min-fraction-digits"],2,"min-fraction-digits",er),!E))return null;let A=null;return p["max-fraction-digits"]&&(A=o.parseObjectValue(p["max-fraction-digits"],2,"max-fraction-digits",er),!A)?null:new Bh(u,h,_,w,E,A)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(r):void 0,unit:this.unit?this.unit.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.unit&&r(this.unit),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const r={};return this.locale&&(r.locale=this.locale.serialize()),this.currency&&(r.currency=this.currency.serialize()),this.unit&&(r.unit=this.unit.serialize()),this.minFractionDigits&&(r["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(r["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),r]}}class v_{constructor(r){this.type=er,this.input=r}static parse(r,o){if(r.length!==2)return o.error(`Expected 1 argument, but found ${r.length-1} instead.`);const u=o.parse(r[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?o.error(`Expected argument of type string or array, but found ${bi(u.type)} instead.`):new v_(u):null}evaluate(r){const o=this.input.evaluate(r);if(typeof o=="string"||Array.isArray(o))return o.length;throw new Si(`Expected value to be of type string or array, but found ${bi(ki(o))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){const r=["length"];return this.eachChild(o=>{r.push(o.serialize())}),r}}function b_(c){return function(){c=1831565813+(c|=0)|0;let r=Math.imul(c^c>>>15,1|c);return r=r+Math.imul(r^r>>>7,61|r)^r,((r^r>>>14)>>>0)/4294967296}}const Bu={"==":_S,"!=":yS,">":vS,"<":xS,">=":wS,"<=":bS,array:fo,at:m_,"at-interpolated":g_,boolean:fo,case:x_,coalesce:Sp,collator:Nc,format:Pu,image:Wl,in:__,"index-of":Ep,interpolate:po,"interpolate-hcl":po,"interpolate-lab":po,length:v_,let:Tp,literal:tl,match:y_,number:fo,"number-format":Bh,object:fo,slice:Cp,step:Ra,string:fo,"to-boolean":nl,"to-color":nl,"to-number":nl,"to-string":nl,var:zc,within:il,distance:Kl,config:Oc};function S0(c,[r,o,u,p]){r=r.evaluate(c),o=o.evaluate(c),u=u.evaluate(c);const h=p?p.evaluate(c):1,_=Ah(r,o,u,h);if(_)throw new Si(_);return new _n(r/255*h,o/255*h,u/255*h,h)}function T0(c,[r,o,u,p]){r=r.evaluate(c),o=o.evaluate(c),u=u.evaluate(c);const h=p?p.evaluate(c):1,_=function(A,v,C,I){return typeof A=="number"&&A>=0&&A<=360?typeof v=="number"&&v>=0&&v<=100&&typeof C=="number"&&C>=0&&C<=100?I===void 0||typeof I=="number"&&I>=0&&I<=1?null:`Invalid hsla value [${[A,v,C,I].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof I=="number"?[A,v,C,I]:[A,v,C]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof I=="number"?[A,v,C,I]:[A,v,C]).join(", ")}]: 'h' must be between 0 and 360.`}(r,o,u,h);if(_)throw new Si(_);const w=`hsla(${r}, ${o}%, ${u}%, ${h})`,E=_n.parse(w);if(!E)throw new Si(`Failed to parse HSLA color: ${w}`);return E}function w_(c,r){return c in r}function Mp(c,r){const o=r[c];return o===void 0?null:o}function Oo(c){return{type:c}}function S_(c){return{result:"success",value:c}}function ll(c){return{result:"error",value:c}}function T_(c,r){return!!c&&!!c.parameters&&c.parameters.indexOf(r)>-1}function Vu(c){return c["property-type"]==="data-driven"}function Ap(c){return T_(c.expression,"measure-light")}function E0(c){return T_(c.expression,"zoom")}function E_(c){return!!c.expression&&c.expression.interpolated}function Pp(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)}function C0(c){return c}function M0(c,r){const o=r.type==="color",u=c.stops&&typeof c.stops[0][0]=="object",p=u||!(u||c.property!==void 0),h=c.type||(E_(r)?"exponential":"interval");if(o&&((c=Yr({},c)).stops&&(c.stops=c.stops.map(A=>[A[0],_n.parse(A[1])])),c.default=_n.parse(c.default?c.default:r.default)),c.colorSpace&&c.colorSpace!=="rgb"&&!v0[c.colorSpace])throw new Error(`Unknown color space: ${c.colorSpace}`);let _,w,E;if(h==="exponential")_=C_;else if(h==="interval")_=A0;else if(h==="categorical"){_=SS,w=Object.create(null);for(const A of c.stops)w[A[0]]=A[1];E=typeof c.stops[0][0]}else{if(h!=="identity")throw new Error(`Unknown function type "${h}"`);_=Ip}if(u){const A={},v=[];for(let M=0;M<c.stops.length;M++){const P=c.stops[M],R=P[0].zoom;A[R]===void 0&&(A[R]={zoom:R,type:c.type,property:c.property,default:c.default,stops:[]},v.push(R)),A[R].stops.push([P[0].value,P[1]])}const C=[];for(const M of v)C.push([A[M].zoom,M0(A[M],r)]);const I={name:"linear"};return{kind:"composite",interpolationType:I,interpolationFactor:po.interpolationFactor.bind(void 0,I),zoomStops:C.map(M=>M[0]),evaluate:({zoom:M},P)=>C_({stops:C,base:c.base},r,M).evaluate(M,P)}}if(p){const A=h==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:A,interpolationFactor:po.interpolationFactor.bind(void 0,A),zoomStops:c.stops.map(v=>v[0]),evaluate:({zoom:v})=>_(c,r,v,w,E)}}return{kind:"source",evaluate(A,v){const C=v&&v.properties?v.properties[c.property]:void 0;return C===void 0?Vh(c.default,r.default):_(c,r,C,w,E)}}}function Vh(c,r,o){return c!==void 0?c:r!==void 0?r:o!==void 0?o:void 0}function SS(c,r,o,u,p){return Vh(typeof o===p?u[o]:void 0,c.default,r.default)}function A0(c,r,o){if(rl(o)!=="number")return Vh(c.default,r.default);const u=c.stops.length;if(u===1||o<=c.stops[0][0])return c.stops[0][1];if(o>=c.stops[u-1][0])return c.stops[u-1][1];const p=Oh(c.stops.map(h=>h[0]),o);return c.stops[p][1]}function C_(c,r,o){const u=c.base!==void 0?c.base:1;if(rl(o)!=="number")return Vh(c.default,r.default);const p=c.stops.length;if(p===1||o<=c.stops[0][0])return c.stops[0][1];if(o>=c.stops[p-1][0])return c.stops[p-1][1];const h=Oh(c.stops.map(v=>v[0]),o),_=function(v,C,I,M){const P=M-I,R=v-I;return P===0?0:C===1?R/P:(Math.pow(C,R)-1)/(Math.pow(C,P)-1)}(o,u,c.stops[h][0],c.stops[h+1][0]),w=c.stops[h][1],E=c.stops[h+1][1];let A=Eh[r.type]||C0;if(c.colorSpace&&c.colorSpace!=="rgb"){const v=v0[c.colorSpace];A=(C,I)=>v.reverse(v.interpolate(v.forward(C),v.forward(I),_))}return typeof w.evaluate=="function"?{evaluate(...v){const C=w.evaluate.apply(void 0,v),I=E.evaluate.apply(void 0,v);if(C!==void 0&&I!==void 0)return A(C,I,_)}}:A(w,E,_)}function Ip(c,r,o){return r.type==="color"?o=_n.parse(o):r.type==="formatted"?o=As.fromString(o.toString()):r.type==="resolvedImage"?o=Ps.build(o.toString()):rl(o)===r.type||r.type==="enum"&&r.values[o]||(o=void 0),Vh(o,c.default,r.default)}Ls.register(Bu,{error:[{kind:"error"},[fn],(c,[r])=>{throw new Si(r.evaluate(c))}],typeof:[fn,[rn],(c,[r])=>bi(ki(r.evaluate(c)))],"to-rgba":[_s(er,4),[Ms],(c,[r])=>r.evaluate(c).toRenderColor(null).toArray()],"to-hsla":[_s(er,4),[Ms],(c,[r])=>r.evaluate(c).toRenderColor(null).toHslaArray()],rgb:[Ms,[er,er,er],S0],rgba:[Ms,[er,er,er,er],S0],hsl:[Ms,[er,er,er],T0],hsla:[Ms,[er,er,er,er],T0],has:{type:Jr,overloads:[[[fn],(c,[r])=>w_(r.evaluate(c),c.properties())],[[fn,Cu],(c,[r,o])=>w_(r.evaluate(c),o.evaluate(c))]]},get:{type:rn,overloads:[[[fn],(c,[r])=>Mp(r.evaluate(c),c.properties())],[[fn,Cu],(c,[r,o])=>Mp(r.evaluate(c),o.evaluate(c))]]},"feature-state":[rn,[fn],(c,[r])=>Mp(r.evaluate(c),c.featureState||{})],properties:[Cu,[],c=>c.properties()],"geometry-type":[fn,[],c=>c.geometryType()],id:[rn,[],c=>c.id()],zoom:[er,[],c=>c.globals.zoom],pitch:[er,[],c=>c.globals.pitch||0],"distance-from-center":[er,[],c=>c.distanceFromCenter()],"measure-light":[er,[fn],(c,[r])=>c.measureLight(r.evaluate(c))],"heatmap-density":[er,[],c=>c.globals.heatmapDensity||0],"line-progress":[er,[],c=>c.globals.lineProgress||0],"raster-value":[er,[],c=>c.globals.rasterValue||0],"raster-particle-speed":[er,[],c=>c.globals.rasterParticleSpeed||0],"sky-radial-progress":[er,[],c=>c.globals.skyRadialProgress||0],accumulated:[rn,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[er,Oo(er),(c,r)=>{let o=0;for(const u of r)o+=u.evaluate(c);return o}],"*":[er,Oo(er),(c,r)=>{let o=1;for(const u of r)o*=u.evaluate(c);return o}],"-":{type:er,overloads:[[[er,er],(c,[r,o])=>r.evaluate(c)-o.evaluate(c)],[[er],(c,[r])=>-r.evaluate(c)]]},"/":[er,[er,er],(c,[r,o])=>r.evaluate(c)/o.evaluate(c)],"%":[er,[er,er],(c,[r,o])=>r.evaluate(c)%o.evaluate(c)],ln2:[er,[],()=>Math.LN2],pi:[er,[],()=>Math.PI],e:[er,[],()=>Math.E],"^":[er,[er,er],(c,[r,o])=>Math.pow(r.evaluate(c),o.evaluate(c))],sqrt:[er,[er],(c,[r])=>Math.sqrt(r.evaluate(c))],log10:[er,[er],(c,[r])=>Math.log(r.evaluate(c))/Math.LN10],ln:[er,[er],(c,[r])=>Math.log(r.evaluate(c))],log2:[er,[er],(c,[r])=>Math.log(r.evaluate(c))/Math.LN2],sin:[er,[er],(c,[r])=>Math.sin(r.evaluate(c))],cos:[er,[er],(c,[r])=>Math.cos(r.evaluate(c))],tan:[er,[er],(c,[r])=>Math.tan(r.evaluate(c))],asin:[er,[er],(c,[r])=>Math.asin(r.evaluate(c))],acos:[er,[er],(c,[r])=>Math.acos(r.evaluate(c))],atan:[er,[er],(c,[r])=>Math.atan(r.evaluate(c))],min:[er,Oo(er),(c,r)=>Math.min(...r.map(o=>o.evaluate(c)))],max:[er,Oo(er),(c,r)=>Math.max(...r.map(o=>o.evaluate(c)))],abs:[er,[er],(c,[r])=>Math.abs(r.evaluate(c))],round:[er,[er],(c,[r])=>{const o=r.evaluate(c);return o<0?-Math.round(-o):Math.round(o)}],floor:[er,[er],(c,[r])=>Math.floor(r.evaluate(c))],ceil:[er,[er],(c,[r])=>Math.ceil(r.evaluate(c))],"filter-==":[Jr,[fn,rn],(c,[r,o])=>c.properties()[r.value]===o.value],"filter-id-==":[Jr,[rn],(c,[r])=>c.id()===r.value],"filter-type-==":[Jr,[fn],(c,[r])=>c.geometryType()===r.value],"filter-<":[Jr,[fn,rn],(c,[r,o])=>{const u=c.properties()[r.value],p=o.value;return typeof u==typeof p&&u<p}],"filter-id-<":[Jr,[rn],(c,[r])=>{const o=c.id(),u=r.value;return typeof o==typeof u&&o<u}],"filter->":[Jr,[fn,rn],(c,[r,o])=>{const u=c.properties()[r.value],p=o.value;return typeof u==typeof p&&u>p}],"filter-id->":[Jr,[rn],(c,[r])=>{const o=c.id(),u=r.value;return typeof o==typeof u&&o>u}],"filter-<=":[Jr,[fn,rn],(c,[r,o])=>{const u=c.properties()[r.value],p=o.value;return typeof u==typeof p&&u<=p}],"filter-id-<=":[Jr,[rn],(c,[r])=>{const o=c.id(),u=r.value;return typeof o==typeof u&&o<=u}],"filter->=":[Jr,[fn,rn],(c,[r,o])=>{const u=c.properties()[r.value],p=o.value;return typeof u==typeof p&&u>=p}],"filter-id->=":[Jr,[rn],(c,[r])=>{const o=c.id(),u=r.value;return typeof o==typeof u&&o>=u}],"filter-has":[Jr,[rn],(c,[r])=>r.value in c.properties()],"filter-has-id":[Jr,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[Jr,[_s(fn)],(c,[r])=>r.value.indexOf(c.geometryType())>=0],"filter-id-in":[Jr,[_s(rn)],(c,[r])=>r.value.indexOf(c.id())>=0],"filter-in-small":[Jr,[fn,_s(rn)],(c,[r,o])=>o.value.indexOf(c.properties()[r.value])>=0],"filter-in-large":[Jr,[fn,_s(rn)],(c,[r,o])=>function(u,p,h,_){for(;h<=_;){const w=h+_>>1;if(p[w]===u)return!0;p[w]>u?_=w-1:h=w+1}return!1}(c.properties()[r.value],o.value,0,o.value.length-1)],all:{type:Jr,overloads:[[[Jr,Jr],(c,[r,o])=>r.evaluate(c)&&o.evaluate(c)],[Oo(Jr),(c,r)=>{for(const o of r)if(!o.evaluate(c))return!1;return!0}]]},any:{type:Jr,overloads:[[[Jr,Jr],(c,[r,o])=>r.evaluate(c)||o.evaluate(c)],[Oo(Jr),(c,r)=>{for(const o of r)if(o.evaluate(c))return!0;return!1}]]},"!":[Jr,[Jr],(c,[r])=>!r.evaluate(c)],"is-supported-script":[Jr,[fn],(c,[r])=>{const o=c.globals&&c.globals.isSupportedScript;return!o||o(r.evaluate(c))}],upcase:[fn,[fn],(c,[r])=>r.evaluate(c).toUpperCase()],downcase:[fn,[fn],(c,[r])=>r.evaluate(c).toLowerCase()],concat:[fn,Oo(rn),(c,r)=>r.map(o=>Qi(o.evaluate(c))).join("")],"resolved-locale":[fn,[Qa],(c,[r])=>r.evaluate(c).resolvedLocale()],random:[er,[er,er,rn],(c,r)=>{const[o,u,p]=r.map(_=>_.evaluate(c));if(o>u||o===u)return o;let h;if(typeof p=="string")h=function(_){let w=0;if(_.length===0)return w;for(let E=0;E<_.length;E++)w=(w<<5)-w+_.charCodeAt(E),w|=0;return w}(p);else{if(typeof p!="number")throw new Si(`Invalid seed input: ${p}`);h=p}return o+b_(h)()*(u-o)}]});class M_{constructor(r,o,u,p){this.expression=r,this._warningHistory={},this._evaluator=new hp(u,p),this._defaultValue=o?function(h){return h.type==="color"&&(Pp(h.default)||Array.isArray(h.default))?new _n(0,0,0,0):h.type==="color"?_n.parse(h.default)||null:h.default===void 0?null:h.default}(o):null,this._enumValues=o&&o.type==="enum"?o.values:null,this.configDependencies=Lh(r)}evaluateWithoutErrorHandling(r,o,u,p,h,_,w,E){return this._evaluator.globals=r,this._evaluator.feature=o,this._evaluator.featureState=u,this._evaluator.canonical=p||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=E||null,this.expression.evaluate(this._evaluator)}evaluate(r,o,u,p,h,_,w,E){this._evaluator.globals=r,this._evaluator.feature=o||null,this._evaluator.featureState=u||null,this._evaluator.canonical=p||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=E||null;try{const A=this.expression.evaluate(this._evaluator);if(A==null||typeof A=="number"&&A!=A)return this._defaultValue;if(this._enumValues&&!(A in this._enumValues))throw new Si(`Expected value to be one of ${Object.keys(this._enumValues).map(v=>JSON.stringify(v)).join(", ")}, but found ${JSON.stringify(A)} instead.`);return A}catch(A){return this._warningHistory[A.message]||(this._warningHistory[A.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${A.message}`)),this._defaultValue}}}function kp(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in Bu}function Uu(c,r,o,u){const p=new l_(Bu,[],r?function(_){const w={color:Ms,string:fn,number:er,enum:fn,boolean:Jr,formatted:Ch,resolvedImage:el};return _.type==="array"?_s(w[_.value]||rn,_.length):w[_.type]}(r):void 0,void 0,void 0,o,u),h=p.parse(c,void 0,void 0,void 0,r&&r.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?S_(new M_(h,r,o,u)):ll(p.errors)}class A_{constructor(r,o,u,p){this.kind=r,this._styleExpression=o,this.isLightConstant=u,this.isLineProgressConstant=p,this.isStateDependent=r!=="constant"&&!Dh(o.expression),this.configDependencies=Lh(o.expression)}evaluateWithoutErrorHandling(r,o,u,p,h,_){return this._styleExpression.evaluateWithoutErrorHandling(r,o,u,p,h,_)}evaluate(r,o,u,p,h,_){return this._styleExpression.evaluate(r,o,u,p,h,_)}}class $u{constructor(r,o,u,p,h,_){this.kind=r,this.zoomStops=u,this._styleExpression=o,this.isStateDependent=r!=="camera"&&!Dh(o.expression),this.isLightConstant=h,this.isLineProgressConstant=_,this.configDependencies=Lh(o.expression),this.interpolationType=p}evaluateWithoutErrorHandling(r,o,u,p,h,_){return this._styleExpression.evaluateWithoutErrorHandling(r,o,u,p,h,_)}evaluate(r,o,u,p,h,_){return this._styleExpression.evaluate(r,o,u,p,h,_)}interpolationFactor(r,o,u){return this.interpolationType?po.interpolationFactor(this.interpolationType,r,o,u):0}}function P_(c,r,o,u){if((c=Uu(c,r,o,u)).result==="error")return c;const p=c.value.expression,h=Lu(p);if(!h&&!Vu(r))return ll([new Lo("","data expressions not supported")]);const _=al(p,["zoom","pitch","distance-from-center"]);if(!_&&!E0(r))return ll([new Lo("","zoom expressions not supported")]);const w=al(p,["measure-light"]);if(!w&&!Ap(r))return ll([new Lo("","measure-light expression not supported")]);const E=al(p,["line-progress"]);if(!E&&!function(C){return T_(C.expression,"line-progress")}(r))return ll([new Lo("","line-progress expression not supported")]);const A=r.expression&&r.expression.relaxZoomRestriction,v=Rp(p);return v||_||A?v instanceof Lo?ll([v]):v instanceof po&&!E_(r)?ll([new Lo("",'"interpolate" expressions cannot be used with this property')]):S_(v?new $u(h&&E?"camera":"composite",c.value,v.labels,v instanceof po?v.interpolation:void 0,w,E):new A_(h&&E?"constant":"source",c.value,w,E)):ll([new Lo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Np{constructor(r,o){this._parameters=r,this._specification=o,Yr(this,M0(this._parameters,this._specification))}static deserialize(r){return new Np(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function Rp(c){let r=null;if(c instanceof Tp)r=Rp(c.result);else if(c instanceof Sp){for(const o of c.args)if(r=Rp(o),r)break}else(c instanceof Ra||c instanceof po)&&c.input instanceof Ls&&c.input.name==="zoom"&&(r=c);return r instanceof Lo||c.eachChild(o=>{const u=Rp(o);u instanceof Lo?r=u:r&&u&&r!==u&&(r=new Lo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}var Uh,P0,I0=function(){if(P0)return Uh;P0=1,Uh=r;var c=3;function r(o,u,p){var h=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;var _=new Int32Array(this.arrayBuffer);o=_[0],this.d=(u=_[1])+2*(p=_[2]);for(var w=0;w<this.d*this.d;w++){var E=_[c+w],A=_[c+w+1];h.push(E===A?null:_.subarray(E,A))}var v=_[c+h.length+1];this.keys=_.subarray(_[c+h.length],v),this.bboxes=_.subarray(v),this.insert=this._insertReadonly}else{this.d=u+2*p;for(var C=0;C<this.d*this.d;C++)h.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=o,this.padding=p,this.scale=u/o,this.uid=0;var I=p/u*o;this.min=-I,this.max=o+I}return r.prototype.insert=function(o,u,p,h,_){this._forEachCell(u,p,h,_,this._insertCell,this.uid++),this.keys.push(o),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(h),this.bboxes.push(_)},r.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},r.prototype._insertCell=function(o,u,p,h,_,w){this.cells[_].push(w)},r.prototype.query=function(o,u,p,h,_){var w=this.min,E=this.max;if(o<=w&&u<=w&&E<=p&&E<=h&&!_)return Array.prototype.slice.call(this.keys);var A=[];return this._forEachCell(o,u,p,h,this._queryCell,A,{},_),A},r.prototype._queryCell=function(o,u,p,h,_,w,E,A){var v=this.cells[_];if(v!==null)for(var C=this.keys,I=this.bboxes,M=0;M<v.length;M++){var P=v[M];if(E[P]===void 0){var R=4*P;(A?A(I[R+0],I[R+1],I[R+2],I[R+3]):o<=I[R+2]&&u<=I[R+3]&&p>=I[R+0]&&h>=I[R+1])?(E[P]=!0,w.push(C[P])):E[P]=!1}}},r.prototype._forEachCell=function(o,u,p,h,_,w,E,A){for(var v=this._convertToCellCoord(o),C=this._convertToCellCoord(u),I=this._convertToCellCoord(p),M=this._convertToCellCoord(h),P=v;P<=I;P++)for(var R=C;R<=M;R++){var F=this.d*R+P;if((!A||A(this._convertFromCellCoord(P),this._convertFromCellCoord(R),this._convertFromCellCoord(P+1),this._convertFromCellCoord(R+1)))&&_.call(this,o,u,p,h,F,w,E,A))return}},r.prototype._convertFromCellCoord=function(o){return(o-this.padding)/this.scale},r.prototype._convertToCellCoord=function(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))},r.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var o=this.cells,u=c+this.cells.length+1+1,p=0,h=0;h<this.cells.length;h++)p+=this.cells[h].length;var _=new Int32Array(u+p+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;for(var w=u,E=0;E<o.length;E++){var A=o[E];_[c+E]=w,_.set(A,w),w+=A.length}return _[c+o.length]=w,_.set(this.keys,w),_[c+o.length+1]=w+=this.keys.length,_.set(this.bboxes,w),w+=this.bboxes.length,_.buffer},Uh}(),Gu=N(I0);const jp={};function zt(c,r,o={}){Object.defineProperty(c,"_classRegistryKey",{value:r,writable:!1}),jp[r]={klass:c,omit:o.omit||[]}}zt(Object,"Object"),Gu.serialize=function(c,r){const o=c.toArrayBuffer();return r&&r.add(o),{buffer:o}},Gu.deserialize=function(c){return new Gu(c.buffer)},Object.defineProperty(Gu,"name",{value:"Grid"}),zt(Gu,"Grid"),typeof DOMMatrix<"u"&&zt(DOMMatrix,"DOMMatrix"),zt(_n,"Color"),zt(Error,"Error"),zt(As,"Formatted"),zt(Mh,"FormattedSection"),zt(as,"AJAXError"),zt(Ps,"ResolvedImage"),zt(Np,"StylePropertyFunction"),zt(M_,"StyleExpression",{omit:["_evaluator"]}),zt(Us,"ImageId"),zt(Na,"ImageVariant"),zt($u,"ZoomDependentExpression"),zt(A_,"ZoomConstantExpression"),zt(Ls,"CompoundExpression",{omit:["_evaluate"]});for(const c in Bu)jp[Bu[c]._classRegistryKey]||zt(Bu[c],`Expression${c}`);function I_(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function k_(c){return self.ImageBitmap&&c instanceof ImageBitmap}function Jl(c,r){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp)return c;if(I_(c)||k_(c))return r&&r.add(c),c;if(ArrayBuffer.isView(c))return r&&r.add(c.buffer),c;if(c instanceof ImageData)return r&&r.add(c.data.buffer),c;if(Array.isArray(c)){const o=[];for(const u of c)o.push(Jl(u,r));return o}if(c instanceof Map){const o={$name:"Map",entries:[]};for(const[u,p]of c.entries())o.entries.push(Jl(u),Jl(p));return o}if(c instanceof Set){const o={$name:"Set"};let u=0;for(const p of c.values())o[++u]=Jl(p);return o}if(c instanceof DOMMatrix){const o={$name:"DOMMatrix"},u=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const p of u)o[p]=c[p];return o}if(typeof c=="bigint")return{$name:"BigInt",value:c.toString()};if(typeof c=="object"){const o=c.constructor,u=o._classRegistryKey;if(!u)throw new Error(`Can't serialize object of unregistered class "${o.name}".`);const p=o.serialize?o.serialize(c,r):{};if(!o.serialize){for(const h in c)c.hasOwnProperty(h)&&(jp[u].omit.indexOf(h)>=0||(p[h]=Jl(c[h],r)));c instanceof Error&&(p.message=c.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(p.$name=u),p}throw new Error("can't serialize object of type "+typeof c)}function mo(c){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||I_(c)||k_(c)||ArrayBuffer.isView(c)||c instanceof ImageData)return c;if(Array.isArray(c))return c.map(mo);if(typeof c=="object"){const r=c.$name||"Object";if(r==="Map"){const p=c.entries||[],h=new Map;for(let _=0;_<p.length;_+=2)h.set(mo(p[_]),mo(p[_+1]));return h}if(r==="Set"){const p=new Set;for(const h of Object.keys(c))h!=="$name"&&p.add(mo(c[h]));return p}if(r==="DOMMatrix"){let p;return p=c.is2D?[c.a,c.b,c.c,c.d,c.e,c.f]:[c.m11,c.m12,c.m13,c.m14,c.m21,c.m22,c.m23,c.m24,c.m31,c.m32,c.m33,c.m34,c.m41,c.m42,c.m43,c.m44],new DOMMatrix(p)}if(r==="BigInt")return BigInt(c.value);const{klass:o}=jp[r];if(!o)throw new Error(`Can't deserialize unregistered class "${r}".`);if(o.deserialize)return o.deserialize(c);const u=Object.create(o.prototype);for(const p of Object.keys(c))p!=="$name"&&(u[p]=mo(c[p]));return u}throw new Error("can't deserialize object of type "+typeof c)}const ar={"Latin-1 Supplement":c=>c>=128&&c<=255,Arabic:c=>c>=1536&&c<=1791,"Arabic Supplement":c=>c>=1872&&c<=1919,"Arabic Extended-A":c=>c>=2208&&c<=2303,"Hangul Jamo":c=>c>=4352&&c<=4607,"Unified Canadian Aboriginal Syllabics":c=>c>=5120&&c<=5759,Khmer:c=>c>=6016&&c<=6143,"Unified Canadian Aboriginal Syllabics Extended":c=>c>=6320&&c<=6399,"General Punctuation":c=>c>=8192&&c<=8303,"Letterlike Symbols":c=>c>=8448&&c<=8527,"Number Forms":c=>c>=8528&&c<=8591,"Miscellaneous Technical":c=>c>=8960&&c<=9215,"Control Pictures":c=>c>=9216&&c<=9279,"Optical Character Recognition":c=>c>=9280&&c<=9311,"Enclosed Alphanumerics":c=>c>=9312&&c<=9471,"Geometric Shapes":c=>c>=9632&&c<=9727,"Miscellaneous Symbols":c=>c>=9728&&c<=9983,"Miscellaneous Symbols and Arrows":c=>c>=11008&&c<=11263,"CJK Radicals Supplement":c=>c>=11904&&c<=12031,"Kangxi Radicals":c=>c>=12032&&c<=12255,"Ideographic Description Characters":c=>c>=12272&&c<=12287,"CJK Symbols and Punctuation":c=>c>=12288&&c<=12351,Hiragana:c=>c>=12352&&c<=12447,Katakana:c=>c>=12448&&c<=12543,Bopomofo:c=>c>=12544&&c<=12591,"Hangul Compatibility Jamo":c=>c>=12592&&c<=12687,Kanbun:c=>c>=12688&&c<=12703,"Bopomofo Extended":c=>c>=12704&&c<=12735,"CJK Strokes":c=>c>=12736&&c<=12783,"Katakana Phonetic Extensions":c=>c>=12784&&c<=12799,"Enclosed CJK Letters and Months":c=>c>=12800&&c<=13055,"CJK Compatibility":c=>c>=13056&&c<=13311,"CJK Unified Ideographs Extension A":c=>c>=13312&&c<=19903,"Yijing Hexagram Symbols":c=>c>=19904&&c<=19967,"CJK Unified Ideographs":c=>c>=19968&&c<=40959,"Yi Syllables":c=>c>=40960&&c<=42127,"Yi Radicals":c=>c>=42128&&c<=42191,"Hangul Jamo Extended-A":c=>c>=43360&&c<=43391,"Hangul Syllables":c=>c>=44032&&c<=55215,"Hangul Jamo Extended-B":c=>c>=55216&&c<=55295,"Private Use Area":c=>c>=57344&&c<=63743,"CJK Compatibility Ideographs":c=>c>=63744&&c<=64255,"Arabic Presentation Forms-A":c=>c>=64336&&c<=65023,"Vertical Forms":c=>c>=65040&&c<=65055,"CJK Compatibility Forms":c=>c>=65072&&c<=65103,"Small Form Variants":c=>c>=65104&&c<=65135,"Arabic Presentation Forms-B":c=>c>=65136&&c<=65279,"Halfwidth and Fullwidth Forms":c=>c>=65280&&c<=65519,Osage:c=>c>=66736&&c<=66815,"CJK Unified Ideographs Extension B":c=>c>=131072&&c<=173791};function N_(c){for(const r of c)if(Dp(r.charCodeAt(0)))return!0;return!1}function TS(c){for(const r of c)if(!k0(r.charCodeAt(0)))return!1;return!0}function k0(c){return!(ar.Arabic(c)||ar["Arabic Supplement"](c)||ar["Arabic Extended-A"](c)||ar["Arabic Presentation Forms-A"](c)||ar["Arabic Presentation Forms-B"](c))}function Dp(c){return!(c!==746&&c!==747&&(c<4352||!(ar["Bopomofo Extended"](c)||ar.Bopomofo(c)||ar["CJK Compatibility Forms"](c)&&!(c>=65097&&c<=65103)||ar["CJK Compatibility Ideographs"](c)||ar["CJK Compatibility"](c)||ar["CJK Radicals Supplement"](c)||ar["CJK Strokes"](c)||!(!ar["CJK Symbols and Punctuation"](c)||c>=12296&&c<=12305||c>=12308&&c<=12319||c===12336)||ar["CJK Unified Ideographs Extension A"](c)||ar["CJK Unified Ideographs"](c)||ar["Enclosed CJK Letters and Months"](c)||ar["Hangul Compatibility Jamo"](c)||ar["Hangul Jamo Extended-A"](c)||ar["Hangul Jamo Extended-B"](c)||ar["Hangul Jamo"](c)||ar["Hangul Syllables"](c)||ar.Hiragana(c)||ar["Ideographic Description Characters"](c)||ar.Kanbun(c)||ar["Kangxi Radicals"](c)||ar["Katakana Phonetic Extensions"](c)||ar.Katakana(c)&&c!==12540||!(!ar["Halfwidth and Fullwidth Forms"](c)||c===65288||c===65289||c===65293||c>=65306&&c<=65310||c===65339||c===65341||c===65343||c>=65371&&c<=65503||c===65507||c>=65512&&c<=65519)||!(!ar["Small Form Variants"](c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||ar["Unified Canadian Aboriginal Syllabics"](c)||ar["Unified Canadian Aboriginal Syllabics Extended"](c)||ar["Vertical Forms"](c)||ar["Yijing Hexagram Symbols"](c)||ar["Yi Syllables"](c)||ar["Yi Radicals"](c))))}function R_(c){return!(Dp(c)||function(r){return!!(ar["Latin-1 Supplement"](r)&&(r===167||r===169||r===174||r===177||r===188||r===189||r===190||r===215||r===247)||ar["General Punctuation"](r)&&(r===8214||r===8224||r===8225||r===8240||r===8241||r===8251||r===8252||r===8258||r===8263||r===8264||r===8265||r===8273)||ar["Letterlike Symbols"](r)||ar["Number Forms"](r)||ar["Miscellaneous Technical"](r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||r===9003||r>=9085&&r<=9114||r>=9150&&r<=9165||r===9167||r>=9169&&r<=9179||r>=9186&&r<=9215)||ar["Control Pictures"](r)&&r!==9251||ar["Optical Character Recognition"](r)||ar["Enclosed Alphanumerics"](r)||ar["Geometric Shapes"](r)||ar["Miscellaneous Symbols"](r)&&!(r>=9754&&r<=9759)||ar["Miscellaneous Symbols and Arrows"](r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||ar["CJK Symbols and Punctuation"](r)||ar.Katakana(r)||ar["Private Use Area"](r)||ar["CJK Compatibility Forms"](r)||ar["Small Form Variants"](r)||ar["Halfwidth and Fullwidth Forms"](r)||r===8734||r===8756||r===8757||r>=9984&&r<=10087||r>=10102&&r<=10131||r===65532||r===65533)}(c))}function N0(c){return ar.Arabic(c)||ar["Arabic Supplement"](c)||ar["Arabic Extended-A"](c)||ar["Arabic Presentation Forms-A"](c)||ar["Arabic Presentation Forms-B"](c)}function Lp(c){return c>=1424&&c<=2303||ar["Arabic Presentation Forms-A"](c)||ar["Arabic Presentation Forms-B"](c)}function j_(c,r){return!(!r&&Lp(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||ar.Khmer(c))}function R0(c){for(const r of c)if(Lp(r.charCodeAt(0)))return!0;return!1}const D_="deferred",ja="loading",L_="loaded";let O_=null,$s="unavailable",Ql=null;const $h=function(c){c&&typeof c=="string"&&c.indexOf("NetworkError")>-1&&($s="error"),O_&&O_(c)};function Op(){qu.fire(new Ys("pluginStateChange",{pluginStatus:$s,pluginURL:Ql}))}const qu=new sa,zp=function(){return $s},j0=function(){if($s!==D_||!Ql)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");$s=ja,Op(),Ql&&ka({url:Ql},c=>{c?$h(c):($s=L_,Op())})},zo={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>$s===L_||zo.applyArabicShaping!=null,isLoading:()=>$s===ja,setState(c){$s=c.pluginStatus,Ql=c.pluginURL},isParsed:()=>zo.applyArabicShaping!=null&&zo.processBidirectionalText!=null&&zo.processStyledBidirectionalText!=null,getPluginURL:()=>Ql};class kn{constructor(r,o){this.zoom=r,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.transition=o.transition,this.pitch=o.pitch,this.brightness=o.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(r){return function(o,u){for(const p of o)if(!j_(p.charCodeAt(0),u))return!1;return!0}(r,zo.isLoaded())}}class Hu{constructor(r,o,u,p){this.property=r,this.value=o,this.expression=function(h,_,w,E){if(Pp(h))return new Np(h,_);if(kp(h)||Array.isArray(h)&&h.length>0){const A=P_(h,_,w,E);if(A.result==="error")throw new Error(A.value.map(v=>`${v.key}: ${v.message}`).join(", "));return A.value}{let A=h;return typeof h=="string"&&_.type==="color"&&(A=_n.parse(h)),{kind:"constant",configDependencies:new Set,evaluate:()=>A}}}(o===void 0?r.specification.default:o,r.specification,u,p)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(r,o,u){return this.property.possiblyEvaluate(this,r,o,u)}}class z_{constructor(r,o,u){this.property=r,this.value=new Hu(r,void 0,o,u)}transitioned(r,o){return new Fp(this.property,this.value,o,fi({},r.transition,this.transition),r.now)}untransitioned(){return new Fp(this.property,this.value,null,{},0)}}class F_{constructor(r,o,u){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues),this._scope=o,this._options=u,this.configDependencies=new Set}getValue(r){return Xi(this._values[r].value.value)}setValue(r,o){this._values.hasOwnProperty(r)||(this._values[r]=new z_(this._values[r].property,this._scope,this._options)),this._values[r].value=new Hu(this._values[r].property,o===null?void 0:Xi(o),this._scope,this._options),this._values[r].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[r].value.expression.configDependencies]))}setTransitionOrValue(r,o){o&&(this._options=o);const u=this._properties.properties;if(r)for(const p in r){const h=r[p];if(p.endsWith("-transition")){const _=p.slice(0,-11);u[_]&&this.setTransition(_,h)}else u.hasOwnProperty(p)&&this.setValue(p,h)}}getTransition(r){return Xi(this._values[r].transition)}setTransition(r,o){this._values.hasOwnProperty(r)||(this._values[r]=new z_(this._values[r].property)),this._values[r].transition=Xi(o)||void 0}serialize(){const r={};for(const o of Object.keys(this._values)){const u=this.getValue(o);u!==void 0&&(r[o]=u);const p=this.getTransition(o);p!==void 0&&(r[`${o}-transition`]=p)}return r}transitioned(r,o){const u=new Gh(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].transitioned(r,o._values[p]);return u}untransitioned(){const r=new Gh(this._properties);for(const o of Object.keys(this._values))r._values[o]=this._values[o].untransitioned();return r}}class Fp{constructor(r,o,u,p,h){const _=p.delay||0,w=p.duration||0;h=h||0,this.property=r,this.value=o,this.begin=h+_,this.end=this.begin+w,r.specification.transition&&(p.delay||p.duration)&&(this.prior=u)}possiblyEvaluate(r,o,u){const p=r.now||0,h=this.value.possiblyEvaluate(r,o,u),_=this.prior;if(_){if(p>this.end)return this.prior=null,h;if(this.value.isDataDriven())return this.prior=null,h;if(p<this.begin)return _.possiblyEvaluate(r,o,u);{const w=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(r,o,u),h,dr(w))}}return h}}class Gh{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,o,u){const p=new Yu(this._properties);for(const h of Object.keys(this._values))p._values[h]=this._values[h].possiblyEvaluate(r,o,u);return p}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class Wu{constructor(r,o,u){this._properties=r,this._values=Object.create(r.defaultPropertyValues),this._scope=o,this._options=u,this.configDependencies=new Set}getValue(r){return Xi(this._values[r].value)}setValue(r,o){this._values[r]=new Hu(this._values[r].property,o===null?void 0:Xi(o),this._scope,this._options),this._values[r].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[r].expression.configDependencies]))}serialize(){const r={};for(const o of Object.keys(this._values)){const u=this.getValue(o);u!==void 0&&(r[o]=u)}return r}possiblyEvaluate(r,o,u){const p=new Yu(this._properties);for(const h of Object.keys(this._values))p._values[h]=this._values[h].possiblyEvaluate(r,o,u);return p}}class Zu{constructor(r,o,u){this.property=r,this.value=o,this.parameters=u}isConstant(){return this.value.kind==="constant"}constantOr(r){return this.value.kind==="constant"?this.value.value:r}evaluate(r,o,u,p){return this.property.evaluate(this.value,this.parameters,r,o,u,p)}}class Yu{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class Tt{constructor(r){this.specification=r}possiblyEvaluate(r,o){return r.expression.evaluate(o)}interpolate(r,o,u){const p=Eh[this.specification.type];return p?p(r,o,u):r}}class Ot{constructor(r,o){this.specification=r,this.overrides=o}possiblyEvaluate(r,o,u,p){return new Zu(this,r.expression.kind==="constant"||r.expression.kind==="camera"?{kind:"constant",value:r.expression.evaluate(o,null,{},u,p)}:r.expression,o)}interpolate(r,o,u){if(r.value.kind!=="constant"||o.value.kind!=="constant")return r;if(r.value.value===void 0||o.value.value===void 0)return new Zu(this,{kind:"constant",value:void 0},r.parameters);const p=Eh[this.specification.type];return p?new Zu(this,{kind:"constant",value:p(r.value.value,o.value.value,u)},r.parameters):r}evaluate(r,o,u,p,h,_){return r.kind==="constant"?r.value:r.evaluate(o,u,p,h,_)}}class Xu{constructor(r){this.specification=r}possiblyEvaluate(r,o,u,p){return!!r.expression.evaluate(o,null,{},u,p)}interpolate(){return!1}}class ii{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const o=new kn(0,{});for(const u in r){const p=r[u];p.specification.overridable&&this.overridableProperties.push(u);const h=this.defaultPropertyValues[u]=new Hu(p,void 0),_=this.defaultTransitionablePropertyValues[u]=new z_(p);this.defaultTransitioningPropertyValues[u]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=h.possiblyEvaluate(o)}}}zt(Ot,"DataDrivenProperty"),zt(Tt,"DataConstantProperty"),zt(Xu,"ColorRampProperty");var We=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow","experimental":true},"rain":{"type":"rain","experimental":true},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor","experimental":true},"imports":{"type":"array","value":"import"},"iconsets":{"experimental":true,"type":"iconsets"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"metadata":{"experimental":true,"type":"*"},"selectors":{"experimental":true,"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"experimental":true,"type":"string","required":true},"properties":{"experimental":true,"type":"selectorProperty","required":false},"featureNamespace":{"experimental":true,"type":"string","required":false},"_uniqueFeatureID":{"experimental":true,"type":"boolean","private":true,"required":false}},"selectorProperty":{"experimental":true,"*":{"experimental":true,"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-quality":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]},"experimental":true},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"required":true,"type":"enum","values":{"sprite":1}},"url":{"required":true,"type":"string"}},"iconset_source":{"type":{"required":true,"type":"enum","values":{"source":1}},"source":{"required":true,"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant"},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","experimental":true,"private":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"line-cross-slope":{"type":"number","experimental":true,"expression":{},"property-type":"constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","experimental":true,"private":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.4,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","property-type":"data-constant","default":0.71,"minimum":0,"maximum":5,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.57,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","property-type":"data-constant","default":0.7,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}},"buildingFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","experimental":true,"private":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","transition":true,"experimental":true,"private":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"flat","property-type":"data-constant"},"fill-extrusion-base-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"terrain","property-type":"data-constant"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"experimental":true,"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"*"}}}');function D0(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function Bp(c){if(Array.isArray(c))return c.map(Bp);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const r={};for(const o in c)r[o]=Bp(c[o]);return r}return D0(c)}function B_(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const r of c.slice(1))if(!B_(r)&&typeof r!="boolean")return!1;return!0;default:return!0}}function V_(c,r="",o=null,u="fill"){if(c==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};B_(c)||(c=Vp(c));const p=c;let h=!0;try{h=function(v){if(!Ku(v))return v;let C=Bp(v);return O0(C),C=L0(C),C}(p)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(p,null,2)}
        `)}let _=null,w=null;if(u!=="background"&&u!=="sky"&&u!=="slot"){w=We[`filter_${u}`];const v=Uu(h,w,r,o);if(v.result==="error")throw new Error(v.value.map(C=>`${C.key}: ${C.message}`).join(", "));_=(C,I,M)=>v.value.evaluate(C,I,{},M)}let E=null,A=null;if(h!==p){const v=Uu(p,w,r,o);if(v.result==="error")throw new Error(v.value.map(C=>`${C.key}: ${C.message}`).join(", "));E=(C,I,M,P,R)=>v.value.evaluate(C,I,{},M,void 0,void 0,P,R),A=!Lu(v.value.expression)}return{filter:_,dynamicFilter:E||void 0,needGeometry:z0(h),needFeature:!!A}}function L0(c){if(!Array.isArray(c))return c;const r=function(o){if(ES.has(o[0])){for(let u=1;u<o.length;u++)if(Ku(o[u]))return!0}return o}(c);return r===!0?r:r.map(o=>L0(o))}function O0(c){let r=!1;const o=[];if(c[0]==="case"){for(let u=1;u<c.length-1;u+=2)r=r||Ku(c[u]),o.push(c[u+1]);o.push(c[c.length-1])}else if(c[0]==="match"){r=r||Ku(c[1]);for(let u=2;u<c.length-1;u+=2)o.push(c[u+1]);o.push(c[c.length-1])}else if(c[0]==="step"){r=r||Ku(c[1]);for(let u=1;u<c.length-1;u+=2)o.push(c[u+1])}r&&(c.length=0,c.push("any",...o));for(let u=1;u<c.length;u++)O0(c[u])}function Ku(c){if(!Array.isArray(c))return!1;if((r=c[0])==="pitch"||r==="distance-from-center")return!0;var r;for(let o=1;o<c.length;o++)if(Ku(c[o]))return!0;return!1}const ES=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function CS(c,r){return c<r?-1:c>r?1:0}function z0(c){if(!Array.isArray(c))return!1;if(c[0]==="within"||c[0]==="distance")return!0;for(let r=1;r<c.length;r++)if(z0(c[r]))return!0;return!1}function Vp(c){if(!c)return!0;const r=c[0];return c.length<=1?r!=="any":r==="=="?ec(c[1],c[2],"=="):r==="!="?Fc(ec(c[1],c[2],"==")):r==="<"||r===">"||r==="<="||r===">="?ec(c[1],c[2],r):r==="any"?(o=c.slice(1),["any"].concat(o.map(Vp))):r==="all"?["all"].concat(c.slice(1).map(Vp)):r==="none"?["all"].concat(c.slice(1).map(Vp).map(Fc)):r==="in"?U_(c[1],c.slice(2)):r==="!in"?Fc(U_(c[1],c.slice(2))):r==="has"?$_(c[1]):r!=="!has"||Fc($_(c[1]));var o}function ec(c,r,o){switch(c){case"$type":return[`filter-type-${o}`,r];case"$id":return[`filter-id-${o}`,r];default:return[`filter-${o}`,c,r]}}function U_(c,r){if(r.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(o=>typeof o!=typeof r[0])?["filter-in-large",c,["literal",r.sort(CS)]]:["filter-in-small",c,["literal",r]]}}function $_(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function Fc(c){return["!",c]}const Up="";function Ju(c,r){return r?`${c}${Up}${r}`:c}const cl="-transition",F0=new Set(["fill","line","background","hillshade","raster"]);class es extends sa{constructor(r,o,u,p,h){if(super(),this.id=r.id,this.fqid=Ju(this.id,u),this.type=r.type,this.scope=u,this.lut=p,this.options=h,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,r.type!=="custom"){if(this.metadata=r.metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type&&r.type!=="background"&&r.type!=="sky"&&r.type!=="slot"){this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter;const _=Uu(this.filter,We[`filter_${r.type}`]);_.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,..._.value.configDependencies]))}if(r.slot&&(this.slot=r.slot),o.layout&&(this._unevaluatedLayout=new Wu(o.layout,this.scope,h),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),o.paint){this._transitionablePaint=new F_(o.paint,this.scope,h);for(const _ in r.paint)this.setPaintProperty(_,r.paint[_]);for(const _ in r.layout)this.setLayoutProperty(_,r.layout[_]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Yu(o.paint)}}}onAdd(r){}onRemove(r){}isDraped(r){return!this.is3D(!0)&&F0.has(this.type)}getLayoutProperty(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,o){if(this.type==="custom"&&r==="visibility")return void(this.visibility=o);const u=this._unevaluatedLayout;u._properties.properties[r]&&(u.setValue(r,o),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),r==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(r){return r.endsWith(cl)?this._transitionablePaint.getTransition(r.slice(0,-11)):this._transitionablePaint.getValue(r)}setPaintProperty(r,o){const u=this._transitionablePaint,p=u._properties.properties;if(r.endsWith(cl)){const C=r.slice(0,-11);return p[C]&&u.setTransition(C,o||void 0),!1}if(!p[r])return!1;const h=u._values[r],_=h.value.isDataDriven(),w=h.value;u.setValue(r,o),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),this._handleSpecialPaintPropertyUpdate(r);const E=u._values[r].value,A=E.isDataDriven(),v=r.endsWith("pattern")||r==="line-dasharray";return A||_||v||this._handleOverridablePaintPropertyUpdate(r,w,E)}_handleSpecialPaintPropertyUpdate(r){}getProgramIds(){return null}getDefaultProgramParams(r,o,u){return null}_handleOverridablePaintPropertyUpdate(r,o,u){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,o){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,o)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,o)}serialize(){return na({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(r,o)=>!(r===void 0||o==="layout"&&!Object.keys(r).length||o==="paint"&&!Object.keys(r).length))}is3D(r){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const r in this.paint._values){const o=this.paint.get(r);if(o instanceof Zu&&Vu(o.property.specification)&&(o.value.kind==="source"||o.value.kind==="composite")&&o.value.isStateDependent)return!0}return!1}compileFilter(r){this._filterCompiled||(this._featureFilter=V_(this.filter,this.scope,r),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(r){this._stats&&(r.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(r){}queryIntersectsFeature(r,o,u,p,h,_,w,E,A){}}const MS={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class qh{constructor(r,o){this._structArray=r,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Dn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,o){return r._trim(),o&&(r.isTransferred=!0,o.add(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const o=Object.create(this.prototype);return o.arrayBuffer=r.arrayBuffer,o.length=r.length,o.capacity=r.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...r){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...r){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function nn(c,r=1){let o=0,u=0;return{members:c.map(p=>{const h=MS[p.type].BYTES_PER_ELEMENT,_=o=B0(o,Math.max(r,h)),w=p.components||1;return u=Math.max(u,h),o+=h*w,{name:p.name,type:p.type,components:w,offset:_}}),size:B0(o,Math.max(u,r)),alignment:r}}function B0(c,r){return Math.ceil(c/r)*r}class ul extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o){const u=this.length;return this.resize(u+1),this.emplace(u,r,o)}emplace(r,o,u){const p=2*r;return this.int16[p+0]=o,this.int16[p+1]=u,r}}ul.prototype.bytesPerElement=4,zt(ul,"StructArrayLayout2i4");class Qu extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,u){const p=this.length;return this.resize(p+1),this.emplace(p,r,o,u)}emplace(r,o,u,p){const h=3*r;return this.int16[h+0]=o,this.int16[h+1]=u,this.int16[h+2]=p,r}}Qu.prototype.bytesPerElement=6,zt(Qu,"StructArrayLayout3i6");class dl extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,u,p){const h=this.length;return this.resize(h+1),this.emplace(h,r,o,u,p)}emplace(r,o,u,p,h){const _=4*r;return this.int16[_+0]=o,this.int16[_+1]=u,this.int16[_+2]=p,this.int16[_+3]=h,r}}dl.prototype.bytesPerElement=8,zt(dl,"StructArrayLayout4i8");class Bc extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const o=this.length;return this.resize(o+1),this.emplace(o,r)}emplace(r,o){return this.float32[1*r+0]=o,r}}Bc.prototype.bytesPerElement=4,zt(Bc,"StructArrayLayout1f4");class Hh extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,u){const p=this.length;return this.resize(p+1),this.emplace(p,r,o,u)}emplace(r,o,u,p){const h=4*r,_=2*r;return this.int16[h+0]=o,this.int16[h+1]=u,this.float32[_+1]=p,r}}Hh.prototype.bytesPerElement=8,zt(Hh,"StructArrayLayout2i1f8");class G_ extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,u){const p=this.length;return this.resize(p+1),this.emplace(p,r,o,u)}emplace(r,o,u,p){const h=4*r;return this.int16[h+0]=o,this.int16[h+1]=u,this.int16[h+2]=p,r}}G_.prototype.bytesPerElement=8,zt(G_,"StructArrayLayout3i8");class Fo extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,u,p,h){const _=this.length;return this.resize(_+1),this.emplace(_,r,o,u,p,h)}emplace(r,o,u,p,h,_){const w=5*r;return this.int16[w+0]=o,this.int16[w+1]=u,this.int16[w+2]=p,this.int16[w+3]=h,this.int16[w+4]=_,r}}Fo.prototype.bytesPerElement=10,zt(Fo,"StructArrayLayout5i10");class q_ extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,u,p,h,_,w){const E=this.length;return this.resize(E+1),this.emplace(E,r,o,u,p,h,_,w)}emplace(r,o,u,p,h,_,w,E){const A=6*r,v=12*r,C=3*r;return this.int16[A+0]=o,this.int16[A+1]=u,this.uint8[v+4]=p,this.uint8[v+5]=h,this.uint8[v+6]=_,this.uint8[v+7]=w,this.float32[C+2]=E,r}}q_.prototype.bytesPerElement=12,zt(q_,"StructArrayLayout2i4ub1f12");class ca extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,u){const p=this.length;return this.resize(p+1),this.emplace(p,r,o,u)}emplace(r,o,u,p){const h=3*r;return this.float32[h+0]=o,this.float32[h+1]=u,this.float32[h+2]=p,r}}ca.prototype.bytesPerElement=12,zt(ca,"StructArrayLayout3f12");class tc extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,u,p,h){const _=this.length;return this.resize(_+1),this.emplace(_,r,o,u,p,h)}emplace(r,o,u,p,h,_){const w=6*r,E=3*r;return this.uint16[w+0]=o,this.uint16[w+1]=u,this.uint16[w+2]=p,this.uint16[w+3]=h,this.float32[E+2]=_,r}}tc.prototype.bytesPerElement=12,zt(tc,"StructArrayLayout4ui1f12");class $p extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o,u,p){const h=this.length;return this.resize(h+1),this.emplace(h,r,o,u,p)}emplace(r,o,u,p,h){const _=4*r;return this.uint16[_+0]=o,this.uint16[_+1]=u,this.uint16[_+2]=p,this.uint16[_+3]=h,r}}$p.prototype.bytesPerElement=8,zt($p,"StructArrayLayout4ui8");class Gp extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,u,p,h,_){const w=this.length;return this.resize(w+1),this.emplace(w,r,o,u,p,h,_)}emplace(r,o,u,p,h,_,w){const E=6*r;return this.int16[E+0]=o,this.int16[E+1]=u,this.int16[E+2]=p,this.int16[E+3]=h,this.int16[E+4]=_,this.int16[E+5]=w,r}}Gp.prototype.bytesPerElement=12,zt(Gp,"StructArrayLayout6i12");class H_ extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o,u,p,h,_,w,E,A,v,C,I){const M=this.length;return this.resize(M+1),this.emplace(M,r,o,u,p,h,_,w,E,A,v,C,I)}emplace(r,o,u,p,h,_,w,E,A,v,C,I,M){const P=12*r;return this.int16[P+0]=o,this.int16[P+1]=u,this.int16[P+2]=p,this.int16[P+3]=h,this.uint16[P+4]=_,this.uint16[P+5]=w,this.uint16[P+6]=E,this.uint16[P+7]=A,this.int16[P+8]=v,this.int16[P+9]=C,this.int16[P+10]=I,this.int16[P+11]=M,r}}H_.prototype.bytesPerElement=24,zt(H_,"StructArrayLayout4i4ui4i24");class W_ extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,u,p,h,_){const w=this.length;return this.resize(w+1),this.emplace(w,r,o,u,p,h,_)}emplace(r,o,u,p,h,_,w){const E=10*r,A=5*r;return this.int16[E+0]=o,this.int16[E+1]=u,this.int16[E+2]=p,this.float32[A+2]=h,this.float32[A+3]=_,this.float32[A+4]=w,r}}W_.prototype.bytesPerElement=20,zt(W_,"StructArrayLayout3i3f20");class Vc extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,u,p){const h=this.length;return this.resize(h+1),this.emplace(h,r,o,u,p)}emplace(r,o,u,p,h){const _=4*r;return this.float32[_+0]=o,this.float32[_+1]=u,this.float32[_+2]=p,this.float32[_+3]=h,r}}Vc.prototype.bytesPerElement=16,zt(Vc,"StructArrayLayout4f16");class Z_ extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const o=this.length;return this.resize(o+1),this.emplace(o,r)}emplace(r,o){return this.uint32[1*r+0]=o,r}}Z_.prototype.bytesPerElement=4,zt(Z_,"StructArrayLayout1ul4");class rc extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o){const u=this.length;return this.resize(u+1),this.emplace(u,r,o)}emplace(r,o,u){const p=2*r;return this.uint16[p+0]=o,this.uint16[p+1]=u,r}}rc.prototype.bytesPerElement=4,zt(rc,"StructArrayLayout2ui4");class Y_ extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o,u,p,h,_,w,E,A,v,C,I,M){const P=this.length;return this.resize(P+1),this.emplace(P,r,o,u,p,h,_,w,E,A,v,C,I,M)}emplace(r,o,u,p,h,_,w,E,A,v,C,I,M,P){const R=20*r,F=10*r;return this.int16[R+0]=o,this.int16[R+1]=u,this.int16[R+2]=p,this.int16[R+3]=h,this.int16[R+4]=_,this.float32[F+3]=w,this.float32[F+4]=E,this.float32[F+5]=A,this.float32[F+6]=v,this.int16[R+14]=C,this.uint32[F+8]=I,this.uint16[R+18]=M,this.uint16[R+19]=P,r}}Y_.prototype.bytesPerElement=40,zt(Y_,"StructArrayLayout5i4f1i1ul2ui40");class Wh extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,u,p,h,_,w){const E=this.length;return this.resize(E+1),this.emplace(E,r,o,u,p,h,_,w)}emplace(r,o,u,p,h,_,w,E){const A=8*r;return this.int16[A+0]=o,this.int16[A+1]=u,this.int16[A+2]=p,this.int16[A+4]=h,this.int16[A+5]=_,this.int16[A+6]=w,this.int16[A+7]=E,r}}Wh.prototype.bytesPerElement=16,zt(Wh,"StructArrayLayout3i2i2i16");class X_ extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,o,u,p,h){const _=this.length;return this.resize(_+1),this.emplace(_,r,o,u,p,h)}emplace(r,o,u,p,h,_){const w=4*r,E=8*r;return this.float32[w+0]=o,this.float32[w+1]=u,this.float32[w+2]=p,this.int16[E+6]=h,this.int16[E+7]=_,r}}X_.prototype.bytesPerElement=16,zt(X_,"StructArrayLayout2f1f2i16");class K_ extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,u,p,h,_){const w=this.length;return this.resize(w+1),this.emplace(w,r,o,u,p,h,_)}emplace(r,o,u,p,h,_,w){const E=20*r,A=5*r;return this.uint8[E+0]=o,this.uint8[E+1]=u,this.float32[A+1]=p,this.float32[A+2]=h,this.float32[A+3]=_,this.float32[A+4]=w,r}}K_.prototype.bytesPerElement=20,zt(K_,"StructArrayLayout2ub4f20");class ls extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o,u){const p=this.length;return this.resize(p+1),this.emplace(p,r,o,u)}emplace(r,o,u,p){const h=3*r;return this.uint16[h+0]=o,this.uint16[h+1]=u,this.uint16[h+2]=p,r}}ls.prototype.bytesPerElement=6,zt(ls,"StructArrayLayout3ui6");class qp extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,o,u,p,h,_,w,E,A,v,C,I,M,P,R,F,B,Z,W,G,X){const ee=this.length;return this.resize(ee+1),this.emplace(ee,r,o,u,p,h,_,w,E,A,v,C,I,M,P,R,F,B,Z,W,G,X)}emplace(r,o,u,p,h,_,w,E,A,v,C,I,M,P,R,F,B,Z,W,G,X,ee){const ie=30*r,ge=15*r,fe=60*r;return this.int16[ie+0]=o,this.int16[ie+1]=u,this.int16[ie+2]=p,this.float32[ge+2]=h,this.float32[ge+3]=_,this.uint16[ie+8]=w,this.uint16[ie+9]=E,this.uint32[ge+5]=A,this.uint32[ge+6]=v,this.uint32[ge+7]=C,this.uint16[ie+16]=I,this.uint16[ie+17]=M,this.uint16[ie+18]=P,this.float32[ge+10]=R,this.float32[ge+11]=F,this.uint8[fe+48]=B,this.uint8[fe+49]=Z,this.uint8[fe+50]=W,this.uint32[ge+13]=G,this.int16[ie+28]=X,this.uint8[fe+58]=ee,r}}qp.prototype.bytesPerElement=60,zt(qp,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Hp extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,o,u,p,h,_,w,E,A,v,C,I,M,P,R,F,B,Z,W,G,X,ee,ie,ge,fe,pe,Ce,_e,Me,Re,ke,Oe,Le){const Ge=this.length;return this.resize(Ge+1),this.emplace(Ge,r,o,u,p,h,_,w,E,A,v,C,I,M,P,R,F,B,Z,W,G,X,ee,ie,ge,fe,pe,Ce,_e,Me,Re,ke,Oe,Le)}emplace(r,o,u,p,h,_,w,E,A,v,C,I,M,P,R,F,B,Z,W,G,X,ee,ie,ge,fe,pe,Ce,_e,Me,Re,ke,Oe,Le,Ge){const Ve=20*r,He=40*r,gt=80*r;return this.float32[Ve+0]=o,this.float32[Ve+1]=u,this.int16[He+4]=p,this.int16[He+5]=h,this.int16[He+6]=_,this.int16[He+7]=w,this.int16[He+8]=E,this.int16[He+9]=A,this.int16[He+10]=v,this.int16[He+11]=C,this.int16[He+12]=I,this.uint16[He+13]=M,this.uint16[He+14]=P,this.uint16[He+15]=R,this.uint16[He+16]=F,this.uint16[He+17]=B,this.uint16[He+18]=Z,this.uint16[He+19]=W,this.uint16[He+20]=G,this.uint16[He+21]=X,this.uint16[He+22]=ee,this.uint16[He+23]=ie,this.uint16[He+24]=ge,this.uint16[He+25]=fe,this.uint16[He+26]=pe,this.uint16[He+27]=Ce,this.uint32[Ve+14]=_e,this.float32[Ve+15]=Me,this.float32[Ve+16]=Re,this.float32[Ve+17]=ke,this.float32[Ve+18]=Oe,this.uint8[gt+76]=Le,this.uint16[He+39]=Ge,r}}Hp.prototype.bytesPerElement=80,zt(Hp,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Xs extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,u,p,h){const _=this.length;return this.resize(_+1),this.emplace(_,r,o,u,p,h)}emplace(r,o,u,p,h,_){const w=5*r;return this.float32[w+0]=o,this.float32[w+1]=u,this.float32[w+2]=p,this.float32[w+3]=h,this.float32[w+4]=_,r}}Xs.prototype.bytesPerElement=20,zt(Xs,"StructArrayLayout5f20");class Wp extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,u,p,h,_,w){const E=this.length;return this.resize(E+1),this.emplace(E,r,o,u,p,h,_,w)}emplace(r,o,u,p,h,_,w,E){const A=7*r;return this.float32[A+0]=o,this.float32[A+1]=u,this.float32[A+2]=p,this.float32[A+3]=h,this.float32[A+4]=_,this.float32[A+5]=w,this.float32[A+6]=E,r}}Wp.prototype.bytesPerElement=28,zt(Wp,"StructArrayLayout7f28");class J_ extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,u,p,h,_,w,E,A,v,C){const I=this.length;return this.resize(I+1),this.emplace(I,r,o,u,p,h,_,w,E,A,v,C)}emplace(r,o,u,p,h,_,w,E,A,v,C,I){const M=11*r;return this.float32[M+0]=o,this.float32[M+1]=u,this.float32[M+2]=p,this.float32[M+3]=h,this.float32[M+4]=_,this.float32[M+5]=w,this.float32[M+6]=E,this.float32[M+7]=A,this.float32[M+8]=v,this.float32[M+9]=C,this.float32[M+10]=I,r}}J_.prototype.bytesPerElement=44,zt(J_,"StructArrayLayout11f44");class Q_ extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,u,p,h,_,w,E,A){const v=this.length;return this.resize(v+1),this.emplace(v,r,o,u,p,h,_,w,E,A)}emplace(r,o,u,p,h,_,w,E,A,v){const C=9*r;return this.float32[C+0]=o,this.float32[C+1]=u,this.float32[C+2]=p,this.float32[C+3]=h,this.float32[C+4]=_,this.float32[C+5]=w,this.float32[C+6]=E,this.float32[C+7]=A,this.float32[C+8]=v,r}}Q_.prototype.bytesPerElement=36,zt(Q_,"StructArrayLayout9f36");class ed extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o){const u=this.length;return this.resize(u+1),this.emplace(u,r,o)}emplace(r,o,u){const p=2*r;return this.float32[p+0]=o,this.float32[p+1]=u,r}}ed.prototype.bytesPerElement=8,zt(ed,"StructArrayLayout2f8");class Zh extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,o,u,p){const h=this.length;return this.resize(h+1),this.emplace(h,r,o,u,p)}emplace(r,o,u,p,h){const _=6*r;return this.uint32[3*r+0]=o,this.uint16[_+2]=u,this.uint16[_+3]=p,this.uint16[_+4]=h,r}}Zh.prototype.bytesPerElement=12,zt(Zh,"StructArrayLayout1ul3ui12");class Zp extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const o=this.length;return this.resize(o+1),this.emplace(o,r)}emplace(r,o){return this.uint16[1*r+0]=o,r}}Zp.prototype.bytesPerElement=2,zt(Zp,"StructArrayLayout1ui2");class Yp extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,u,p,h,_,w,E,A,v,C,I,M,P,R,F){const B=this.length;return this.resize(B+1),this.emplace(B,r,o,u,p,h,_,w,E,A,v,C,I,M,P,R,F)}emplace(r,o,u,p,h,_,w,E,A,v,C,I,M,P,R,F,B){const Z=16*r;return this.float32[Z+0]=o,this.float32[Z+1]=u,this.float32[Z+2]=p,this.float32[Z+3]=h,this.float32[Z+4]=_,this.float32[Z+5]=w,this.float32[Z+6]=E,this.float32[Z+7]=A,this.float32[Z+8]=v,this.float32[Z+9]=C,this.float32[Z+10]=I,this.float32[Z+11]=M,this.float32[Z+12]=P,this.float32[Z+13]=R,this.float32[Z+14]=F,this.float32[Z+15]=B,r}}Yp.prototype.bytesPerElement=64,zt(Yp,"StructArrayLayout16f64");class Xp extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,o,u,p,h,_,w){const E=this.length;return this.resize(E+1),this.emplace(E,r,o,u,p,h,_,w)}emplace(r,o,u,p,h,_,w,E){const A=10*r,v=5*r;return this.uint16[A+0]=o,this.uint16[A+1]=u,this.uint16[A+2]=p,this.uint16[A+3]=h,this.float32[v+2]=_,this.float32[v+3]=w,this.float32[v+4]=E,r}}Xp.prototype.bytesPerElement=20,zt(Xp,"StructArrayLayout4ui3f20");class Kp extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r){const o=this.length;return this.resize(o+1),this.emplace(o,r)}emplace(r,o){return this.int16[1*r+0]=o,r}}Kp.prototype.bytesPerElement=2,zt(Kp,"StructArrayLayout1i2");class ey extends Dn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(r){const o=this.length;return this.resize(o+1),this.emplace(o,r)}emplace(r,o){return this.uint8[1*r+0]=o,r}}ey.prototype.bytesPerElement=1,zt(ey,"StructArrayLayout1ub1");class ty extends qh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}ty.prototype.size=40;class Yh extends Y_{get(r){return new ty(this,r)}}zt(Yh,"CollisionBoxArray");class V0 extends qh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(r){this._structArray.uint8[this._pos1+49]=r}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(r){this._structArray.uint8[this._pos1+50]=r}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(r){this._structArray.uint32[this._pos4+13]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(r){this._structArray.uint8[this._pos1+58]=r}}V0.prototype.size=60;class U0 extends qp{get(r){return new V0(this,r)}}zt(U0,"PlacedSymbolArray");class $0 extends qh{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(r){this._structArray.uint32[this._pos4+14]=r}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(r){this._structArray.float32[this._pos4+18]=r}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}$0.prototype.size=80;class G0 extends Hp{get(r){return new $0(this,r)}}zt(G0,"SymbolInstanceArray");class q0 extends Bc{getoffsetX(r){return this.float32[1*r+0]}}zt(q0,"GlyphOffsetArray");class Xh extends ul{getx(r){return this.int16[2*r+0]}gety(r){return this.int16[2*r+1]}}zt(Xh,"SymbolLineVertexArray");class Kh extends qh{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Kh.prototype.size=12;class Ks extends Zh{get(r){return new Kh(this,r)}}zt(Ks,"FeatureIndexArray");class Jh extends rc{geta_centroid_pos0(r){return this.uint16[2*r+0]}geta_centroid_pos1(r){return this.uint16[2*r+1]}}zt(Jh,"FillExtrusionCentroidArray");class H0 extends qh{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}H0.prototype.size=6;class W0 extends Qu{get(r){return new H0(this,r)}}zt(W0,"FillExtrusionWallArray");const AS=nn([{name:"a_pos",components:2,type:"Int16"}],4),PS=nn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Hn{constructor(r=[]){this.segments=r}_prepareSegment(r,o,u,p){let h=this.segments[this.segments.length-1];return r>Hn.MAX_VERTEX_ARRAY_LENGTH&&Kn(`Max vertices per segment is ${Hn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!h||h.vertexLength+r>Hn.MAX_VERTEX_ARRAY_LENGTH||h.sortKey!==p)&&(h={vertexOffset:o,primitiveOffset:u,vertexLength:0,primitiveLength:0},p!==void 0&&(h.sortKey=p),this.segments.push(h)),h}prepareSegment(r,o,u,p){return this._prepareSegment(r,o.length,u.length,p)}get(){return this.segments}destroy(){for(const r of this.segments)for(const o in r.vaos)r.vaos[o].destroy()}static simpleSegment(r,o,u,p){return new Hn([{vertexOffset:r,primitiveOffset:o,vertexLength:u,primitiveLength:p,vaos:{},sortKey:0}])}}function Z0(c,r){return 256*(c=Bt(Math.floor(c),0,255))+Bt(Math.floor(r),0,255)}Hn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,zt(Hn,"SegmentVector");const ry=nn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),IS=nn([{name:"a_dash",components:4,type:"Uint16"}]);class Qh{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(r,o,u,p){this.ids.push(ny(r)),this.positions.push(o,u,p)}eachPosition(r,o){const u=ny(r);let p=0,h=this.ids.length-1;for(;p<h;){const _=p+h>>1;this.ids[_]>=u?h=_:p=_+1}for(;this.ids[p]===u;)o(this.positions[3*p],this.positions[3*p+1],this.positions[3*p+2]),p++}static serialize(r,o){const u=new Float64Array(r.ids),p=new Uint32Array(r.positions);return ef(u,p,0,u.length-1),o&&(o.add(u.buffer),o.add(p.buffer)),{ids:u,positions:p}}static deserialize(r){const o=new Qh;let u;o.ids=r.ids,o.positions=r.positions;for(const p of o.ids)p!==u&&o.uniqueIds.push(p),u=p;return o.indexed=!0,o}}function ny(c){const r=+c;return!isNaN(r)&&Number.MIN_SAFE_INTEGER<=r&&r<=Number.MAX_SAFE_INTEGER?r:ho(String(c))}function ef(c,r,o,u){for(;o<u;){const p=c[o+u>>1];let h=o-1,_=u+1;for(;;){do h++;while(c[h]<p);do _--;while(c[_]>p);if(h>=_)break;Jp(c,h,_),Jp(r,3*h,3*_),Jp(r,3*h+1,3*_+1),Jp(r,3*h+2,3*_+2)}_-o<u-_?(ef(c,r,o,_),o=_+1):(ef(c,r,_+1,u),u=_)}}function Jp(c,r,o){const u=c[r];c[r]=c[o],c[o]=u}zt(Qh,"FeaturePositionMap");class Da{constructor(r){this.gl=r.gl,this.initialized=!1}fetchUniformLocation(r,o){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(r,o),this.initialized=!0),!!this.location}set(r,o,u){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class tf extends Da{constructor(r){super(r),this.current=0}set(r,o,u){this.fetchUniformLocation(r,o)&&this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}}class Ti extends Da{constructor(r){super(r),this.current=0}set(r,o,u){this.fetchUniformLocation(r,o)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class Bo extends Da{constructor(r){super(r),this.current=[0,0]}set(r,o,u){this.fetchUniformLocation(r,o)&&(u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1])))}}class td extends Da{constructor(r){super(r),this.current=[0,0,0]}set(r,o,u){this.fetchUniformLocation(r,o)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2])))}}class rf extends Da{constructor(r){super(r),this.current=[0,0,0,0]}set(r,o,u){this.fetchUniformLocation(r,o)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class Y0 extends Da{constructor(r){super(r),this.current=_n.transparent.toRenderColor(null)}set(r,o,u){this.fetchUniformLocation(r,o)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}const X0=new Float32Array(16);class nf extends Da{constructor(r){super(r),this.current=X0}set(r,o,u){if(this.fetchUniformLocation(r,o)){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let p=1;p<16;p++)if(u[p]!==this.current[p]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}}}const iy=new Float32Array(9),kS=new Float32Array(4);class sy extends Da{constructor(r){super(r),this.current=kS}set(r,o,u){if(this.fetchUniformLocation(r,o)){for(let p=0;p<4;p++)if(u[p]!==this.current[p]){this.current=u,this.gl.uniformMatrix2fv(this.location,!1,u);break}}}}function oy(c){return[Z0(255*c.r,255*c.g),Z0(255*c.b,255*c.a)]}class sf{constructor(r,o,u,p){this.value=r,this.uniformNames=o.map(h=>`u_${h}`),this.type=u,this.context=p}setUniform(r,o,u,p,h){const _=p.constantOr(this.value);o.set(r,h,_ instanceof _n?_.toRenderColor(this.lutExpression&&this.lutExpression.value==="none"?null:this.context.lut):_)}getBinding(r,o){return this.type==="color"?new Y0(r):new Ti(r)}}class Uc{constructor(r,o){this.uniformNames=o.map(u=>`u_${u}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(r){this.pixelRatio=r.pixelRatio||1,this.pattern=r.tl.concat(r.br)}setUniform(r,o,u,p,h){const _=h==="u_pattern"||h==="u_dash"?this.pattern:h==="u_pixel_ratio"?this.pixelRatio:null;_&&o.set(r,h,_)}getBinding(r,o){return o==="u_pattern"||o==="u_dash"?new rf(r):new Ti(r)}}class hl{constructor(r,o,u,p){this.expression=r,this.type=u,this.maxValue=0,this.paintVertexAttributes=o.map(h=>({name:`a_${h}`,type:"Float32",components:u==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(r,o,u,p,h,_,w){const E=this.paintVertexArray.length,A=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new kn(0,{brightness:_}),o,{},h,p,w):this.expression.kind==="constant"&&this.expression.value,v=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new kn(0,{brightness:_}),o,{},h,p,w):this.lutExpression.value)==="none";this.paintVertexArray.resize(r),this._setPaintValue(E,r,A,v?null:this.context.lut)}updatePaintArray(r,o,u,p,h,_,w){const E=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:w},u,p,void 0,h):this.expression.kind==="constant"&&this.expression.value,A=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new kn(0,{brightness:w}),u,p,void 0,h):this.lutExpression.value)==="none";this._setPaintValue(r,o,E,A?null:this.context.lut)}_setPaintValue(r,o,u,p){if(this.type==="color"){const h=oy(u.toRenderColor(p));for(let _=r;_<o;_++)this.paintVertexArray.emplace(_,h[0],h[1])}else{for(let h=r;h<o;h++)this.paintVertexArray.emplace(h,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ua{constructor(r,o,u,p,h,_){this.expression=r,this.uniformNames=o.map(w=>`u_${w}_t`),this.type=u,this.useIntegerZoom=p,this.context=h,this.maxValue=0,this.paintVertexAttributes=o.map(w=>({name:`a_${w}`,type:"Float32",components:u==="color"?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(r,o,u,p,h,_,w){const E=this.expression.evaluate(new kn(this.context.zoom,{brightness:_}),o,{},h,p,w),A=this.expression.evaluate(new kn(this.context.zoom+1,{brightness:_}),o,{},h,p,w),v=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new kn(0,{brightness:_}),o,{},h,p,w):this.lutExpression.value)==="none",C=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(C,r,E,A,v?null:this.context.lut)}updatePaintArray(r,o,u,p,h,_,w){const E=this.expression.evaluate({zoom:this.context.zoom,brightness:w},u,p,void 0,h),A=this.expression.evaluate({zoom:this.context.zoom+1,brightness:w},u,p,void 0,h),v=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new kn(0,{brightness:w}),u,p,void 0,h):this.lutExpression.value)==="none";this._setPaintValue(r,o,E,A,v?null:this.context.lut)}_setPaintValue(r,o,u,p,h){if(this.type==="color"){const _=oy(u.toRenderColor(h)),w=oy(u.toRenderColor(h));for(let E=r;E<o;E++)this.paintVertexArray.emplace(E,_[0],_[1],w[0],w[1])}else{for(let _=r;_<o;_++)this.paintVertexArray.emplace(_,u,p);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(p))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,o,u,p,h){const _=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,w=Bt(this.expression.interpolationFactor(_,this.context.zoom,this.context.zoom+1),0,1);o.set(r,h,w)}getBinding(r,o){return new Ti(r)}}class nc{constructor(r,o,u,p,h){this.expression=r,this.layerId=h,this.paintVertexAttributes=(u==="array"?IS:ry).members;for(let _=0;_<o.length;++_);this.paintVertexArray=new p}populatePaintArray(r,o,u,p){const h=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValues(h,r,o.patterns&&o.patterns[this.layerId],u)}updatePaintArray(r,o,u,p,h,_,w){this._setPaintValues(r,o,u.patterns&&u.patterns[this.layerId],_)}_setPaintValues(r,o,u,p){if(!p||!u)return;const h=p[u];if(!h)return;const{tl:_,br:w,pixelRatio:E}=h;for(let A=r;A<o;A++)this.paintVertexArray.emplace(A,_[0],_[1],w[0],w[1],E)}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class $c{constructor(r,o,u=()=>!0){this.binders={},this._buffers=[],this.context=o;const p=[];for(const h in r.paint._values){const _=r.paint.get(h);if(h.endsWith("-use-theme")||!u(h)||!(_ instanceof Zu&&Vu(_.property.specification)))continue;const w=RS(h,r.type),E=_.value,A=_.property.specification.type,v=!!_.property.useIntegerZoom,C=h==="line-dasharray"||h.endsWith("pattern"),I=r.paint.get(`${h}-use-theme`),M=h==="line-dasharray"&&r.layout.get("line-cap").value.kind!=="constant"||I&&I.value.kind!=="constant";if(E.kind!=="constant"||M)if(E.kind==="source"||M||C){const P=K0(h,A,"source");this.binders[h]=C?new nc(E,w,A,P,r.id):new hl(E,w,A,P),p.push(`/a_${h}`)}else{const P=K0(h,A,"composite");this.binders[h]=new ua(E,w,A,v,o,P),p.push(`/z_${h}`)}else this.binders[h]=C?new Uc(E.value,w):new sf(E.value,w,A,o),p.push(`/u_${h}`);I&&(this.binders[h].lutExpression=I.value)}this.cacheKey=p.sort().join("")}getMaxValue(r){const o=this.binders[r];return o instanceof hl||o instanceof ua?o.maxValue:0}populatePaintArrays(r,o,u,p,h,_,w){for(const E in this.binders){const A=this.binders[E];A.context=this.context,(A instanceof hl||A instanceof ua||A instanceof nc)&&A.populatePaintArray(r,o,u,p,h,_,w)}}setConstantPatternPositions(r){for(const o in this.binders){const u=this.binders[o];u instanceof Uc&&u.setConstantPatternPositions(r)}}updatePaintArrays(r,o,u,p,h,_,w,E,A){let v=!1;const C=Object.keys(r),I=C.length!==0&&!E,M=I?C:o.uniqueIds;this.context.lut=h.lut;for(const P in this.binders){const R=this.binders[P];if(R.context=this.context,(R instanceof hl||R instanceof ua||R instanceof nc)&&R.expression&&R.expression.kind&&R.expression.kind!=="constant"&&(R.expression.isStateDependent===!0||R.expression.isLightConstant===!1)){const F=h.paint.get(P);R.expression=F.value;for(const B of M){const Z=r[B.toString()];o.eachPosition(B,(W,G,X)=>{const ee=p.feature(W);R.updatePaintArray(G,X,ee,Z,_,w,A)})}if(!I)for(const B of u.uniqueIds){const Z=r[B.toString()];u.eachPosition(B,(W,G,X)=>{const ee=p.feature(W);R.updatePaintArray(G,X,ee,Z,_,w,A)})}v=!0}}return v}defines(){const r=[];for(const o in this.binders){const u=this.binders[o];(u instanceof sf||u instanceof Uc)&&r.push(...u.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return r}getBinderAttributes(){const r=[];for(const o in this.binders){const u=this.binders[o];if(u instanceof hl||u instanceof ua||u instanceof nc)for(let p=0;p<u.paintVertexAttributes.length;p++)r.push(u.paintVertexAttributes[p].name)}return r}getBinderUniforms(){const r=[];for(const o in this.binders){const u=this.binders[o];if(u instanceof sf||u instanceof Uc||u instanceof ua)for(const p of u.uniformNames)r.push(p)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r){const o=[];for(const u in this.binders){const p=this.binders[u];if(p instanceof sf||p instanceof Uc||p instanceof ua)for(const h of p.uniformNames)o.push({name:h,property:u,binding:p.getBinding(r,h)})}return o}setUniforms(r,o,u,p,h){for(const{name:_,property:w,binding:E}of u)this.binders[w].setUniform(r,E,h,p.get(w),_)}updatePaintBuffers(){this._buffers=[];for(const r in this.binders){const o=this.binders[r];(o instanceof hl||o instanceof ua||o instanceof nc)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(r){for(const o in this.binders){const u=this.binders[o];(u instanceof hl||u instanceof ua||u instanceof nc)&&u.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const o=this.binders[r];(o instanceof hl||o instanceof ua||o instanceof nc)&&o.destroy()}}}class ic{constructor(r,o,u=()=>!0){this.programConfigurations={};for(const p of r)this.programConfigurations[p.id]=new $c(p,o,u);this.needsUpload=!1,this._featureMap=new Qh,this._featureMapWithoutIds=new Qh,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(r,o,u,p,h,_,w,E){for(const A in this.programConfigurations)this.programConfigurations[A].populatePaintArrays(r,o,p,h,_,w,E);o.id!==void 0?this._featureMap.add(o.id,u,this._bufferOffset,r):(this._featureMapWithoutIds.add(this._idlessCounter,u,this._bufferOffset,r),this._idlessCounter+=1),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,o,u,p,h,_,w){for(const E of u)this.needsUpload=this.programConfigurations[E.id].updatePaintArrays(r,this._featureMap,this._featureMapWithoutIds,o,E,p,h,_,w||0)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const o in this.programConfigurations)this.programConfigurations[o].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}const NS={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function RS(c,r){return NS[c]||[c.replace(`${r}-`,"").replace(/-/g,"_")]}const jS={"line-pattern":{source:tc,composite:tc},"fill-pattern":{source:tc,composite:tc},"fill-extrusion-pattern":{source:tc,composite:tc},"line-dasharray":{source:$p,composite:$p}},Qp={color:{source:ed,composite:Vc},number:{source:Bc,composite:ed}};function K0(c,r,o){const u=jS[c];return u&&u[o]||Qp[r][o]}zt(sf,"ConstantBinder"),zt(Uc,"PatternConstantBinder"),zt(hl,"SourceExpressionBinder"),zt(nc,"PatternCompositeBinder"),zt(ua,"CompositeExpressionBinder"),zt($c,"ProgramConfiguration",{omit:["_buffers"]}),zt(ic,"ProgramConfigurationSet");const Os=Ct/Math.PI/2,rd=5,J0=6,Q0=16383,nd=64,em=[nd,32,16],go=-Os,_o=Os;function id(c,r,o,u=Os){return o=Be(o),[c*Math.sin(o)*u,-r*u,c*Math.cos(o)*u]}function Gc(c,r,o){return id(Math.cos(Be(c)),Math.sin(Be(c)),r,o)}const qc=63710088e-1,ay=2*Math.PI*qc;class sn{constructor(r,o){if(isNaN(r)||isNaN(o))throw new Error(`Invalid LngLat object: (${r}, ${o})`);if(this.lng=+r,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new sn(Xn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const o=Math.PI/180,u=this.lat*o,p=r.lat*o,h=Math.sin(u)*Math.sin(p)+Math.cos(u)*Math.cos(p)*Math.cos((r.lng-this.lng)*o);return qc*Math.acos(Math.min(h,1))}toBounds(r=0){const o=360*r/40075017,u=o/Math.cos(Math.PI/180*this.lat);return new sc({lng:this.lng-u,lat:this.lat-o},{lng:this.lng+u,lat:this.lat+o})}toEcef(r){return Gc(this.lat,this.lng,Os+r*Os/qc)}static convert(r){if(r instanceof sn)return r;if(Array.isArray(r)&&(r.length===2||r.length===3))return new sn(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&typeof r=="object"&&r!==null)return new sn(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class sc{constructor(r,o){if(r)if(o)this.setSouthWest(r).setNorthEast(o);else if(r.length===4){const u=r;this.setSouthWest([u[0],u[1]]).setNorthEast([u[2],u[3]])}else{const u=r;this.setSouthWest(u[0]).setNorthEast(u[1])}}setNorthEast(r){return this._ne=r instanceof sn?new sn(r.lng,r.lat):sn.convert(r),this}setSouthWest(r){return this._sw=r instanceof sn?new sn(r.lng,r.lat):sn.convert(r),this}extend(r){const o=this._sw,u=this._ne;let p,h;if(r instanceof sn)p=r,h=r;else{if(!(r instanceof sc))return Array.isArray(r)?r.length===4||r.every(Array.isArray)?this.extend(sc.convert(r)):this.extend(sn.convert(r)):typeof r=="object"&&r!==null&&r.hasOwnProperty("lat")&&(r.hasOwnProperty("lon")||r.hasOwnProperty("lng"))?this.extend(sn.convert(r)):this;if(p=r._sw,h=r._ne,!p||!h)return this}return o||u?(o.lng=Math.min(p.lng,o.lng),o.lat=Math.min(p.lat,o.lat),u.lng=Math.max(h.lng,u.lng),u.lat=Math.max(h.lat,u.lat)):(this._sw=new sn(p.lng,p.lat),this._ne=new sn(h.lng,h.lat)),this}getCenter(){return new sn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new sn(this.getWest(),this.getNorth())}getSouthEast(){return new sn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:o,lat:u}=sn.convert(r);let p=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&p}static convert(r){if(r)return r instanceof sc?r:new sc(r)}}const DS=0,LS=25.5;function tm(c){return ay*Math.cos(c*Math.PI/180)}function La(c){return(180+c)/360}function xs(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function vs(c,r){return c/tm(r)}function Js(c){return 360*c-180}function cs(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}function ly(c,r){return c*tm(cs(r))}const wi=85.051129;function e1(c){return Math.cos(Be(Bt(c,-wi,wi)))}function oc(c,r){const o=Bt(r,DS,LS),u=Math.pow(2,o);return e1(c)*ay/(512*u)}function OS(c){return 1/Math.cos(c*Math.PI/180)}function g(c,r=0){const o=Math.exp(Math.PI*(1-(c.y+r/Ct)/(1<<c.z)*2));return 80150034*o/(o*o+1)/Ct/(1<<c.z)}class n{constructor(r,o,u=0){this.x=+r,this.y=+o,this.z=+u}static fromLngLat(r,o=0){const u=sn.convert(r);return new n(La(u.lng),xs(u.lat),vs(o,u.lat))}toLngLat(){return new sn(Js(this.x),cs(this.y))}toAltitude(){return ly(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/ay*OS(cs(this.y))}}function l(c,r,o,u,p,h,_,w,E){const A=(r+u)/2,v=(o+p)/2,C=new bt(A,v);w(C),function(I,M,P,R,F,B){const Z=P-F,W=R-B;return Math.abs((R-M)*Z-(P-I)*W)/Math.hypot(Z,W)}(C.x,C.y,h.x,h.y,_.x,_.y)>=E?(l(c,r,o,A,v,h,C,w,E),l(c,A,v,u,p,C,_,w,E)):c.push(_)}function m(c,r,o){let u=c[0],p=u.x,h=u.y;r(u);const _=[u];for(let w=1;w<c.length;w++){const E=c[w],{x:A,y:v}=E;r(E),l(_,p,h,A,v,u,E,r,o),p=A,h=v,u=E}return _}function x(c,r,o,u){if(u(r,o)){const p=r.add(o)._mult(.5);x(c,r,p,u),x(c,p,o,u)}else c.push(o)}function b(c,r){let o=c[0];const u=[o];for(let p=1;p<c.length;p++){const h=c[p];x(u,o,h,r),o=h}return u}const T=Math.pow(2,14)-1,k=-T-1;function j(c,r){const o=Math.round(c.x*r),u=Math.round(c.y*r);return c.x=Bt(o,k,T),c.y=Bt(u,k,T),(o<c.x||o>c.x+1||u<c.y||u>c.y+1)&&Kn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),c}function L(c,r,o){const u=c.loadGeometry(),p=c.extent,h=Ct/p;if(r&&o&&o.projection.isReprojectedInTileSpace){const _=1<<r.z,{scale:w,x:E,y:A,projection:v}=o,C=I=>{const M=Js((r.x+I.x/p)/_),P=cs((r.y+I.y/p)/_),R=v.project(M,P);I.x=(R.x*w-E)*p,I.y=(R.y*w-A)*p};for(let I=0;I<u.length;I++)if(c.type!==1)u[I]=m(u[I],C,1);else{const M=[];for(const P of u[I])P.x<0||P.x>=p||P.y<0||P.y>=p||(C(P),M.push(P));u[I]=M}}for(const _ of u)for(const w of _)j(w,h);return u}function z(c,r){return{type:c.type,id:c.id,properties:c.properties,geometry:r?L(c):[]}}function U(c,r,o,u,p){c.emplaceBack(2*r+(u+1)/2,2*o+(p+1)/2)}function V(c,r,o){c.emplaceBack(r.x,r.y,r.z,o[0]*16384,o[1]*16384,o[2]*16384)}class Y{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=r.index,this.hasPattern=!1,this.projection=r.projection,this.layoutVertexArray=new ul,this.indexArray=new ls,this.segments=new Hn,this.programConfigurations=new ic(r.layers,{zoom:r.zoom,lut:r.lut}),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}updateFootprints(r,o){}populate(r,o,u,p){const h=this.layers[0],_=[];let w=null;h.type==="circle"&&(w=h.layout.get("circle-sort-key"));for(const{feature:A,id:v,index:C,sourceLayerIndex:I}of r){const M=this.layers[0]._featureFilter.needGeometry,P=z(A,M);if(!this.layers[0]._featureFilter.filter(new kn(this.zoom),P,u))continue;const R=w?w.evaluate(P,{},u):void 0,F={id:v,properties:A.properties,type:A.type,sourceLayerIndex:I,index:C,geometry:M?P.geometry:L(A,u,p),patterns:{},sortKey:R};_.push(F)}w&&_.sort((A,v)=>A.sortKey-v.sortKey);let E=null;p.projection.name==="globe"&&(this.globeExtVertexArray=new Gp,E=p.projection);for(const A of _){const{geometry:v,index:C,sourceLayerIndex:I}=A,M=r[C].feature;this.addFeature(A,v,C,o.availableImages,u,E,o.brightness),o.featureIndex.insert(M,v,C,I,this.index)}}update(r,o,u,p,h,_,w){this.programConfigurations.updatePaintArrays(r,o,h,u,p,_,w)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,AS.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,PS.members))),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(r,o,u,p,h,_,w){for(const E of o)for(const A of E){const v=A.x,C=A.y;if(v<0||v>=Ct||C<0||C>=Ct)continue;if(_){const P=_.projectTilePoint(v,C,h),R=_.upVector(h,v,C),F=this.globeExtVertexArray;V(F,P,R),V(F,P,R),V(F,P,R),V(F,P,R)}const I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),M=I.vertexLength;U(this.layoutVertexArray,v,C,-1,-1),U(this.layoutVertexArray,v,C,1,-1),U(this.layoutVertexArray,v,C,1,1),U(this.layoutVertexArray,v,C,-1,1),this.indexArray.emplaceBack(M,M+1,M+2),this.indexArray.emplaceBack(M,M+2,M+3),I.vertexLength+=4,I.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,{},p,h,w)}}function te(c,r){for(let o=0;o<c.length;o++)if(we(r,c[o]))return!0;for(let o=0;o<r.length;o++)if(we(c,r[o]))return!0;return!!me(c,r)}function K(c,r,o){return!!we(c,r)||!!ye(r,c,o)}function ne(c,r){if(c.length===1)return be(r,c[0]);for(let o=0;o<r.length;o++){const u=r[o];for(let p=0;p<u.length;p++)if(we(c,u[p]))return!0}for(let o=0;o<c.length;o++)if(be(r,c[o]))return!0;for(let o=0;o<r.length;o++)if(me(c,r[o]))return!0;return!1}function se(c,r,o){if(c.length>1){if(me(c,r))return!0;for(let u=0;u<r.length;u++)if(ye(r[u],c,o))return!0}for(let u=0;u<c.length;u++)if(ye(c[u],r,o))return!0;return!1}function me(c,r){if(c.length===0||r.length===0)return!1;for(let o=0;o<c.length-1;o++){const u=c[o],p=c[o+1];for(let h=0;h<r.length-1;h++)if(xe(u,p,r[h],r[h+1]))return!0}return!1}function xe(c,r,o,u){return hr(c,o,u)!==hr(r,o,u)&&hr(c,r,o)!==hr(c,r,u)}function ye(c,r,o){const u=o*o;if(r.length===1)return c.distSqr(r[0])<u;for(let p=1;p<r.length;p++)if(Ee(c,r[p-1],r[p])<u)return!0;return!1}function Ee(c,r,o){const u=r.distSqr(o);if(u===0)return c.distSqr(r);const p=((c.x-r.x)*(o.x-r.x)+(c.y-r.y)*(o.y-r.y))/u;return c.distSqr(p<0?r:p>1?o:o.sub(r)._mult(p)._add(r))}function be(c,r){let o,u,p,h=!1;for(let _=0;_<c.length;_++){o=c[_];for(let w=0,E=o.length-1;w<o.length;E=w++)u=o[w],p=o[E],u.y>r.y!=p.y>r.y&&r.x<(p.x-u.x)*(r.y-u.y)/(p.y-u.y)+u.x&&(h=!h)}return h}function we(c,r){let o=!1;for(let u=0,p=c.length-1;u<c.length;p=u++){const h=c[u],_=c[p];h.y>r.y!=_.y>r.y&&r.x<(_.x-h.x)*(r.y-h.y)/(_.y-h.y)+h.x&&(o=!o)}return o}function Te(c,r,o,u,p){for(const _ of c)if(r<=_.x&&o<=_.y&&u>=_.x&&p>=_.y)return!0;const h=[new bt(r,o),new bt(r,p),new bt(u,p),new bt(u,o)];if(c.length>2){for(const _ of h)if(we(c,_))return!0}for(let _=0;_<c.length-1;_++)if(Pe(c[_],c[_+1],h))return!0;return!1}function Pe(c,r,o){const u=o[0],p=o[2];if(c.x<u.x&&r.x<u.x||c.x>p.x&&r.x>p.x||c.y<u.y&&r.y<u.y||c.y>p.y&&r.y>p.y)return!1;const h=hr(c,r,o[0]);return h!==hr(c,r,o[1])||h!==hr(c,r,o[2])||h!==hr(c,r,o[3])}function Ne(c,r,o,u,p,h){let _=r.y-c.y,w=c.x-r.x;if(h=h||0){const E=_*_+w*w;if(E===0)return!0;const A=Math.sqrt(E);_/=A,w/=A}return!((o.x-c.x)*_+(o.y-c.y)*w-h<0||(u.x-c.x)*_+(u.y-c.y)*w-h<0||(p.x-c.x)*_+(p.y-c.y)*w-h<0)}function Ke(c,r,o,u,p,h,_){return!(Ne(c,r,u,p,h,_)||Ne(r,o,u,p,h,_)||Ne(o,c,u,p,h,_)||Ne(u,p,c,r,o,_)||Ne(p,h,c,r,o,_)||Ne(h,u,c,r,o,_))}function $e(c,r,o){const u=r.paint.get(c).value;return u.kind==="constant"?u.value:o.programConfigurations.get(r.id).getMaxValue(c)}function lt(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function dt(c,r,o,u,p){if(!r[0]&&!r[1])return c;const h=bt.convert(r)._mult(p);o==="viewport"&&h._rotate(-u);const _=[];for(let w=0;w<c.length;w++)_.push(c[w].sub(h));return _}function vt(c,r,o,u){const p=bt.convert(c)._mult(u);return r==="viewport"&&p._rotate(-o),p}let Ue,at;zt(Y,"CircleBucket",{omit:["layers"]});var Fe,ot={exports:{}},rt=(Fe||(Fe=1,function(c,r){(function(o){function u(h,_,w){var E=p(256*h,256*(_=Math.pow(2,w)-_-1),w),A=p(256*(h+1),256*(_+1),w);return E[0]+","+E[1]+","+A[0]+","+A[1]}function p(h,_,w){var E=2*Math.PI*6378137/256/Math.pow(2,w);return[h*E-2*Math.PI*6378137/2,_*E-2*Math.PI*6378137/2]}o.getURL=function(h,_,w,E,A,v){return v=v||{},h+"?"+["bbox="+u(w,E,A),"format="+(v.format||"image/png"),"service="+(v.service||"WMS"),"version="+(v.version||"1.1.1"),"request="+(v.request||"GetMap"),"srs="+(v.srs||"EPSG:3857"),"width="+(v.width||256),"height="+(v.height||256),"layers="+_].join("&")},o.getTileBBox=u,o.getMercCoords=p,Object.defineProperty(o,"__esModule",{value:!0})})(r)}(0,ot.exports)),ot.exports);class ht{constructor(r,o,u){this.z=r,this.x=o,this.y=u,this.key=It(0,r,r,o,u)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,o){const u=rt.getTileBBox(this.x,this.y,this.z),p=function(h,_,w){let E,A="";for(let v=h;v>0;v--)E=1<<v-1,A+=(_&E?1:0)+(w&E?2:0);return A}(this.z,this.x,this.y);return r[(this.x+this.y)%r.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",p).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Je{constructor(r,o){this.wrap=r,this.canonical=o,this.key=It(r,o.z,o.z,o.x,o.y)}}class mt{constructor(r,o,u,p,h){this.overscaledZ=r,this.wrap=o,this.canonical=new ht(u,+p,+h),this.key=o===0&&r===u?this.canonical.key:It(o,r,u,p,h)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){const o=this.canonical.z-r;return r>this.canonical.z?new mt(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new mt(r,this.wrap,r,this.canonical.x>>o,this.canonical.y>>o)}calculateScaledKey(r,o=!0){if(this.overscaledZ===r&&o)return this.key;if(r>this.canonical.z)return It(this.wrap*+o,r,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-r;return It(this.wrap*+o,r,r,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(r){if(r.wrap!==this.wrap)return!1;const o=this.canonical.z-r.canonical.z;return r.overscaledZ===0||r.overscaledZ<this.overscaledZ&&r.canonical.z<this.canonical.z&&r.canonical.x===this.canonical.x>>o&&r.canonical.y===this.canonical.y>>o}children(r){if(this.overscaledZ>=r)return[new mt(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const o=this.canonical.z+1,u=2*this.canonical.x,p=2*this.canonical.y;return[new mt(o,this.wrap,o,u,p),new mt(o,this.wrap,o,u+1,p),new mt(o,this.wrap,o,u,p+1),new mt(o,this.wrap,o,u+1,p+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new mt(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new mt(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Je(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function It(c,r,o,u,p){const h=1<<Math.min(o,22);let _=h*(p%h)+u%h;return c&&o<22&&(_+=h*h*((c<0?-2*c-1:2*c)%(1<<2*(22-o)))),16*(32*_+o)+(r-o)}const kt=[c=>{let r=c.canonical.x-1,o=c.wrap;return r<0&&(r=(1<<c.canonical.z)-1,o--),new mt(c.overscaledZ,o,c.canonical.z,r,c.canonical.y)},c=>{let r=c.canonical.x+1,o=c.wrap;return r===1<<c.canonical.z&&(r=0,o++),new mt(c.overscaledZ,o,c.canonical.z,r,c.canonical.y)},c=>new mt(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,(c.canonical.y===0?1<<c.canonical.z:c.canonical.y)-1),c=>new mt(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,c.canonical.y===(1<<c.canonical.z)-1?0:c.canonical.y+1)];zt(ht,"CanonicalTileID"),zt(mt,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Rt=nn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Yt}=Rt,Tr=nn([{name:"a_pos_3",components:3,type:"Int16"}]);var cr=nn([{name:"a_pos",type:"Int16",components:2}]);class yr{constructor(r,o){this.pos=r,this.dir=o}intersectsPlane(r,o,u){const p=de.vec2.dot(o,this.dir);if(Math.abs(p)<1e-6)return!1;const h=((r[0]-this.pos[0])*o[0]+(r[1]-this.pos[1])*o[1])/p;return u[0]=this.pos[0]+this.dir[0]*h,u[1]=this.pos[1]+this.dir[1]*h,!0}}class pr{constructor(r,o){this.pos=r,this.dir=o}intersectsPlane(r,o,u){const p=de.vec3.dot(o,this.dir);if(Math.abs(p)<1e-6)return!1;const h=((r[0]-this.pos[0])*o[0]+(r[1]-this.pos[1])*o[1]+(r[2]-this.pos[2])*o[2])/p;return u[0]=this.pos[0]+this.dir[0]*h,u[1]=this.pos[1]+this.dir[1]*h,u[2]=this.pos[2]+this.dir[2]*h,!0}closestPointOnSphere(r,o,u){if(de.vec3.equals(this.pos,r)||o===0)return u[0]=u[1]=u[2]=0,!1;const[p,h,_]=this.dir,w=this.pos[0]-r[0],E=this.pos[1]-r[1],A=this.pos[2]-r[2],v=p*p+h*h+_*_,C=2*(w*p+E*h+A*_),I=C*C-4*v*(w*w+E*E+A*A-o*o);if(I<0){const M=Math.max(-C/2,0),P=w+p*M,R=E+h*M,F=A+_*M,B=Math.hypot(P,R,F);return u[0]=P*o/B,u[1]=R*o/B,u[2]=F*o/B,!1}{const M=(-C-Math.sqrt(I))/(2*v);if(M<0){const P=Math.hypot(w,E,A);return u[0]=w*o/P,u[1]=E*o/P,u[2]=A*o/P,!1}return u[0]=w+p*M,u[1]=E+h*M,u[2]=A+_*M,!0}}}class Gr{constructor(r,o,u,p,h){this.TL=r,this.TR=o,this.BR=u,this.BL=p,this.horizon=h}static fromInvProjectionMatrix(r,o,u){const p=[-1,1,1],h=[1,1,1],_=[1,-1,1],w=[-1,-1,1],E=de.vec3.transformMat4(p,p,r),A=de.vec3.transformMat4(h,h,r),v=de.vec3.transformMat4(_,_,r),C=de.vec3.transformMat4(w,w,r);return new Gr(E,A,v,C,o/u)}}function on(c,r,o){let u=1/0,p=-1/0;const h=[];for(const _ of c){de.vec3.sub(h,_,r);const w=de.vec3.dot(h,o);u=Math.min(u,w),p=Math.max(p,w)}return[u,p]}function Rn(c,r){let o=!0;for(let u=0;u<c.planes.length;u++){const p=c.planes[u];let h=0;for(let _=0;_<r.length;_++)h+=de.vec3.dot(p,r[_])+p[3]>=0;if(h===0)return 0;h!==r.length&&(o=!1)}return o?2:1}function Lr(c,r){for(const o of c.projections){const u=on(r,c.points[0],o.axis);if(o.projection[1]<u[0]||o.projection[0]>u[1])return 0}return 1}function Wn(c,r){let o=0;const u=[0,0,0,0];for(let p=0;p<c.length;p++)u[0]=c[p][0],u[1]=c[p][1],u[2]=c[p][2],u[3]=1,de.vec4.dot(u,r)>=0&&o++;return o}class Ar{constructor(r,o){this.points=r||new Array(8).fill([0,0,0]),this.planes=o||new Array(6).fill([0,0,0,0]),this.bounds=Xt.fromPoints(this.points),this.projections=[],this.frustumEdges=[de.vec3.sub([],this.points[2],this.points[3]),de.vec3.sub([],this.points[0],this.points[3]),de.vec3.sub([],this.points[4],this.points[0]),de.vec3.sub([],this.points[5],this.points[1]),de.vec3.sub([],this.points[6],this.points[2]),de.vec3.sub([],this.points[7],this.points[3])];for(const u of this.frustumEdges){const p=[0,-u[2],u[1]],h=[u[2],0,-u[0]];this.projections.push({axis:p,projection:on(this.points,this.points[0],p)}),this.projections.push({axis:h,projection:on(this.points,this.points[0],h)})}}static fromInvProjectionMatrix(r,o,u,p){const h=Math.pow(2,u),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(A=>{const v=de.vec4.transformMat4([],A,r),C=1/v[3]/o*h;return de.vec4.mul(v,v,[C,C,p?1/v[3]:C,C])}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(A=>{const v=de.vec3.sub([],_[A[0]],_[A[1]]),C=de.vec3.sub([],_[A[2]],_[A[1]]),I=de.vec3.normalize([],de.vec3.cross([],v,C)),M=-de.vec3.dot(I,_[A[1]]);return I.concat(M)}),E=[];for(let A=0;A<_.length;A++)E.push([_[A][0],_[A][1],_[A][2]]);return new Ar(E,w)}intersectsPrecise(r,o,u){for(let p=0;p<o.length;p++)if(!Wn(r,o[p]))return 0;for(let p=0;p<this.planes.length;p++)if(!Wn(r,this.planes[p]))return 0;for(const p of u)for(const h of this.frustumEdges){const _=de.vec3.cross([],p,h),w=de.vec3.length(_);if(w===0)continue;de.vec3.scale(_,_,1/w);const E=on(this.points,this.points[0],_),A=on(r,this.points[0],_);if(E[0]>A[1]||A[0]>E[1])return 0}return 1}containsPoint(r){for(const o of this.planes){const u=o[3];if(de.vec3.dot([o[0],o[1],o[2]],r)+u<0)return!1}return!0}}class Xt{static fromPoints(r){const o=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(const p of r)de.vec3.min(o,o,p),de.vec3.max(u,u,p);return new Xt(o,u)}static fromTileIdAndHeight(r,o,u){const p=1<<r.canonical.z,h=r.canonical.x,_=r.canonical.y;return new Xt([h/p,_/p,o],[(h+1)/p,(_+1)/p,u])}static applyTransform(r,o){const u=r.getCorners();for(let p=0;p<u.length;++p)de.vec3.transformMat4(u[p],u[p],o);return Xt.fromPoints(u)}static applyTransformFast(r,o){const u=[o[12],o[13],o[14]],p=[...u];for(let h=0;h<3;h++)for(let _=0;_<3;_++){const w=o[4*_+h],E=w*r.min[_],A=w*r.max[_];u[h]+=Math.min(E,A),p[h]+=Math.max(E,A)}return new Xt(u,p)}static projectAabbCorners(r,o){const u=r.getCorners();for(let p=0;p<u.length;++p)de.vec3.transformMat4(u[p],u[p],o);return u}constructor(r,o){this.min=r,this.max=o,this.center=de.vec3.scale([],de.vec3.add([],this.min,this.max),.5)}quadrant(r){const o=[r%2==0,r<2],u=de.vec3.clone(this.min),p=de.vec3.clone(this.max);for(let h=0;h<o.length;h++)u[h]=o[h]?this.min[h]:this.center[h],p[h]=o[h]?this.center[h]:this.max[h];return p[2]=this.max[2],new Xt(u,p)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}distanceZ(r){return Math.max(Math.min(this.max[2],r[2]),this.min[2])-r[2]}getCorners(){const r=this.min,o=this.max;return[[r[0],r[1],r[2]],[o[0],r[1],r[2]],[o[0],o[1],r[2]],[r[0],o[1],r[2]],[r[0],r[1],o[2]],[o[0],r[1],o[2]],[o[0],o[1],o[2]],[r[0],o[1],o[2]]]}intersects(r){return this.intersectsAabb(r.bounds)?Rn(r,this.getCorners()):0}intersectsFlat(r){return this.intersectsAabb(r.bounds)?Rn(r,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(r,o){return o||this.intersects(r)?Lr(r,this.getCorners()):0}intersectsPreciseFlat(r,o){return o||this.intersectsFlat(r)?Lr(r,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(r){for(let o=0;o<3;++o)if(this.min[o]>r.max[o]||r.min[o]>this.max[o])return!1;return!0}intersectsAabbXY(r){return!(this.min[0]>r.max[0]||r.min[0]>this.max[0]||this.min[1]>r.max[1]||r.min[1]>this.max[1])}encapsulate(r){for(let o=0;o<3;o++)this.min[o]=Math.min(this.min[o],r.min[o]),this.max[o]=Math.max(this.max[o],r.max[o])}encapsulatePoint(r){for(let o=0;o<3;o++)this.min[o]=Math.min(this.min[o],r[o]),this.max[o]=Math.max(this.max[o],r[o])}closestPoint(r){return[Math.max(Math.min(this.max[0],r[0]),this.min[0]),Math.max(Math.min(this.max[1],r[1]),this.min[1]),Math.max(Math.min(this.max[2],r[2]),this.min[2])]}}function Hr(c){return c*Os/qc}zt(Xt,"Aabb");const yn=[new Xt([go,go,go],[_o,_o,_o]),new Xt([go,go,go],[0,0,_o]),new Xt([0,go,go],[_o,0,_o]),new Xt([go,0,go],[0,_o,_o]),new Xt([0,0,go],[_o,_o,_o])];function Qr(c,r,o,u=!0){const p=de.vec3.scale([],c._camera.position,c.worldSize),h=[r,o,1,1];de.vec4.transformMat4(h,h,c.pixelMatrixInverse),de.vec4.scale(h,h,1/h[3]);const _=de.vec3.sub([],h,p),w=de.vec3.normalize([],_),E=c.globeMatrix,A=[E[12],E[13],E[14]],v=de.vec3.sub([],A,p),C=de.vec3.length(v),I=de.vec3.normalize([],v),M=c.worldSize/(2*Math.PI),P=de.vec3.dot(I,w),R=Math.asin(M/C);if(R<Math.acos(P)){if(!u)return null;const Ce=[],_e=[];de.vec3.scale(Ce,w,C/P),de.vec3.normalize(_e,de.vec3.sub(_e,Ce,v)),de.vec3.normalize(w,de.vec3.add(w,v,de.vec3.scale(w,_e,Math.tan(R)*C)))}const F=[];new pr(p,w).closestPointOnSphere(A,M,F);const B=de.vec3.normalize([],ql(E,0)),Z=de.vec3.normalize([],ql(E,1)),W=de.vec3.normalize([],ql(E,2)),G=de.vec3.dot(B,F),X=de.vec3.dot(Z,F),ee=de.vec3.dot(W,F),ie=ut(Math.asin(-X/M));let ge=ut(Math.atan2(G,ee));ge=c.center.lng+function(Ce,_e){const Me=(_e-Ce+180)%360-180;return Me<-180?Me+360:Me}(c.center.lng,ge);const fe=La(ge),pe=Bt(xs(ie),0,1);return new n(fe,pe)}class ai{constructor(r,o,u){this.a=de.vec3.sub([],r,u),this.b=de.vec3.sub([],o,u),this.center=u;const p=de.vec3.normalize([],this.a),h=de.vec3.normalize([],this.b);this.angle=Math.acos(de.vec3.dot(p,h))}}function Ei(c,r){if(c.angle===0)return null;let o;return o=c.a[r]===0?1/c.angle*.5*Math.PI:1/c.angle*Math.atan(c.b[r]/c.a[r]/Math.sin(c.angle)-1/Math.tan(c.angle)),o<0||o>1?null:function(u,p,h,_){const w=Math.sin(h);return u*(Math.sin((1-_)*h)/w)+p*(Math.sin(_*h)/w)}(c.a[r],c.b[r],c.angle,Bt(o,0,1))+c.center[r]}function zi(c){if(c.z<=1)return yn[c.z+2*c.y+c.x];const r=Zn(Xr(c));return Xt.fromPoints(r)}function Ui(c,r,o){return de.vec3.scale(c,c,1-o),de.vec3.scaleAndAdd(c,c,r,o)}function yo(c,r,o){for(const u of c)de.vec3.transformMat4(u,u,r),de.vec3.scale(u,u,o)}function Is(c,r,o,u){const p=r/c.worldSize,h=c.globeMatrix;if(o.z<=1){const fe=zi(o).getCorners();return yo(fe,h,p),Xt.fromPoints(fe)}const _=Xr(o,u),w=Zn(_,Os+Hr(c._tileCoverLift));yo(w,h,p);const E=Number.MAX_VALUE,A=[-E,-E,-E],v=[E,E,E];if(_.contains(c.center)){for(const Ce of w)de.vec3.min(v,v,Ce),de.vec3.max(A,A,Ce);A[2]=0;const fe=c.point,pe=[fe.x*p,fe.y*p,0];return de.vec3.min(v,v,pe),de.vec3.max(A,A,pe),new Xt(v,A)}if(c._tileCoverLift>0){for(const fe of w)de.vec3.min(v,v,fe),de.vec3.max(A,A,fe);return new Xt(v,A)}const C=[h[12]*p,h[13]*p,h[14]*p],I=_.getCenter(),M=Bt(c.center.lat,-wi,wi),P=Bt(I.lat,-wi,wi),R=La(c.center.lng),F=xs(M);let B=R-La(I.lng);const Z=F-xs(P);B>.5?B-=1:B<-.5&&(B+=1);let W=0;if(Math.abs(B)>Math.abs(Z))W=B>=0?1:3;else{W=Z>=0?0:2;const fe=[h[4]*p,h[5]*p,h[6]*p],pe=-Math.sin(Be(Z>=0?_.getSouth():_.getNorth()))*Os;de.vec3.scaleAndAdd(C,C,fe,pe)}const G=w[W],X=w[(W+1)%4],ee=new ai(G,X,C),ie=[Ei(ee,0)||G[0],Ei(ee,1)||G[1],Ei(ee,2)||G[2]],ge=Gs(c.zoom);if(ge>0){const fe=function({x:Ce,y:_e,z:Me},Re,ke,Oe,Le){const Ge=1/(1<<Me);let Ve=Ce*Ge,He=Ve+Ge,gt=_e*Ge,ft=gt+Ge,Ft=0;const xt=(Ve+He)/2-Oe;return xt>.5?Ft=-1:xt<-.5&&(Ft=1),Ve=((Ve+Ft)*Re-(Oe*=Re))*ke+Oe,He=((He+Ft)*Re-Oe)*ke+Oe,gt=(gt*Re-(Le*=Re))*ke+Le,ft=(ft*Re-Le)*ke+Le,[[Ve,ft,0],[He,ft,0],[He,gt,0],[Ve,gt,0]]}(o,r,c._pixelsPerMercatorPixel,R,F);for(let Ce=0;Ce<w.length;Ce++)Ui(w[Ce],fe[Ce],ge);const pe=de.vec3.add([],fe[W],fe[(W+1)%4]);de.vec3.scale(pe,pe,.5),Ui(ie,pe,ge)}for(const fe of w)de.vec3.min(v,v,fe),de.vec3.max(A,A,fe);return v[2]=Math.min(G[2],X[2]),de.vec3.min(v,v,ie),de.vec3.max(A,A,ie),new Xt(v,A)}function Xr({x:c,y:r,z:o},u=!1){const p=1/(1<<o),h=new sn(Js(c*p),r===(1<<o)-1&&u?-90:cs((r+1)*p)),_=new sn(Js((c+1)*p),r===0&&u?90:cs(r*p));return new sc(h,_)}function Zn(c,r=Os){const o=Be(c.getNorth()),u=Be(c.getSouth()),p=Math.cos(o),h=Math.cos(u),_=Math.sin(o),w=Math.sin(u),E=c.getWest(),A=c.getEast();return[id(h,w,E,r),id(h,w,A,r),id(p,_,A,r),id(p,_,E,r)]}function an(c,r,o,u){const p=1<<o.z,h=(c/Ct+o.x)/p;return Gc(cs((r/Ct+o.y)/p),Js(h),u)}function Cn({min:c,max:r}){return Q0/Math.max(r[0]-c[0],r[1]-c[1],r[2]-c[2])}const us=new Float64Array(16);function Un(c){const r=Cn(c),o=de.mat4.fromScaling(us,[r,r,r]);return de.mat4.translate(o,o,de.vec3.negate([],c.min))}function Fi(c){const r=de.mat4.fromTranslation(us,c.min),o=1/Cn(c);return de.mat4.scale(r,r,[o,o,o])}function Oa(c){const r=Ct/(2*Math.PI);return c/(2*Math.PI)/r}function Qs(c,r){return Ct/(512*Math.pow(2,c))*Cn(zi(r))}function Vo(c,r,o,u,p){const h=Oa(o),_=[c,r,-o/(2*Math.PI)],w=de.mat4.identity(new Float64Array(16));return de.mat4.translate(w,w,_),de.mat4.scale(w,w,[h,h,h]),de.mat4.rotateX(w,w,Be(-p)),de.mat4.rotateY(w,w,Be(-u)),w}function Gs(c){return Or(rd,J0,c)}function Uo(c,r){const o=Gc(r.lat,r.lng),u=function(h){const _=Gc(h._center.lat,h._center.lng),w=de.vec3.fromValues(0,1,0);let E=de.vec3.cross([],w,_);const A=de.mat4.fromRotation([],-h.angle,_);E=de.vec3.transformMat4(E,E,A),de.mat4.fromRotation(A,-h._pitch,E);const v=de.vec3.normalize([],_);return de.vec3.scale(v,v,Hr(h.cameraToCenterDistance/h.pixelsPerMeter)),de.vec3.transformMat4(v,v,A),de.vec3.add([],_,v)}(c),p=de.vec3.subtract([],u,o);return de.vec3.angle(p,o)}function eo(c,r){return Uo(c,r)>Math.PI/2*1.01}const fl=Be(85),za=Math.cos(fl),pl=Math.sin(fl),cy=de.mat4.create(),sd=c=>{const r=[];return c.paint.get("circle-pitch-alignment")==="map"&&r.push("PITCH_WITH_MAP"),c.paint.get("circle-pitch-scale")==="map"&&r.push("SCALE_WITH_MAP"),r};function rm(c,r,o,u,p,h,_,w,E){if(h&&c.queryGeometry.isAboveHorizon)return!1;h&&(E*=c.pixelToTileUnitsFactor);const A=c.tileID.canonical,v=o.projection.upVectorScale(A,o.center.lat,o.worldSize).metersToTile;for(const C of r)for(const I of C){const M=I.add(w),P=p&&o.elevation?o.elevation.exaggeration()*p.getElevationAt(M.x,M.y,!0):0,R=o.projection.projectTilePoint(M.x,M.y,A);if(P>0){const W=o.projection.upVector(A,M.x,M.y);R.x+=W[0]*v*P,R.y+=W[1]*v*P,R.z+=W[2]*v*P}const F=h?M:uy(R.x,R.y,R.z,u),B=h?c.tilespaceRays.map(W=>LU(W,P)):c.queryGeometry.screenGeometry,Z=de.vec4.transformMat4([],[R.x,R.y,R.z,1],u);if(!_&&h?E*=Z[3]/o.cameraToCenterDistance:_&&!h&&(E*=o.cameraToCenterDistance/Z[3]),h){const W=cs((I.y/Ct+A.y)/(1<<A.z));E/=o.projection.pixelsPerMeter(W,1)/vs(1,W)}if(K(B,F,E))return!0}return!1}function uy(c,r,o,u){const p=de.vec4.transformMat4([],[c,r,o,1],u);return new bt(p[0]/p[3],p[1]/p[3])}const SI=de.vec3.fromValues(0,0,0),DU=de.vec3.fromValues(0,0,1);function LU(c,r){const o=de.vec3.create();return SI[2]=r,c.intersectsPlane(SI,DU,o),new bt(o[0],o[1])}class TI extends Y{}let EI,CI,MI,AI;function PI(c,{width:r,height:o},u,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==r*o*u)throw new RangeError("mismatched image size")}else p=new Uint8Array(r*o*u);return c.width=r,c.height=o,c.data=p,c}function II(c,r,o){const{width:u,height:p}=r;u===c.width&&p===c.height||(zS(c,r,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,u),height:Math.min(c.height,p)},o,null),c.width=u,c.height=p,c.data=r.data)}function zS(c,r,o,u,p,h,_,w){if(p.width===0||p.height===0)return r;if(p.width>c.width||p.height>c.height||o.x>c.width-p.width||o.y>c.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>r.width||p.height>r.height||u.x>r.width-p.width||u.y>r.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const E=c.data,A=r.data,v=h===4&&w;for(let C=0;C<p.height;C++){const I=((o.y+C)*c.width+o.x)*h,M=((u.y+C)*r.width+u.x)*h;if(v)for(let P=0;P<p.width;P++){const R=I+P*h+3,F=M+P*h;A[F+0]=255,A[F+1]=255,A[F+2]=255,A[F+3]=E[R]}else if(_)for(let P=0;P<p.width;P++){const R=I+P*h,F=M+P*h,B=E[R+3],Z=new _n(E[R+0]/255*B,E[R+1]/255*B,E[R+2]/255*B,B).toRenderColor(_).toArray();A[F+0]=Z[0],A[F+1]=Z[1],A[F+2]=Z[2],A[F+3]=Z[3]}else for(let P=0;P<p.width*h;P++)A[M+P]=E[I+P]}return r}zt(TI,"HeatmapBucket",{omit:["layers"]});class od{constructor(r,o){PI(this,r,1,o)}resize(r){II(this,new od(r),1)}clone(){return new od({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,o,u,p,h){zS(r,o,u,p,h,1,null)}}class bs{constructor(r,o){PI(this,r,4,o)}resize(r){II(this,new bs(r),4)}replace(r,o){o?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new bs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,o,u,p,h,_,w){zS(r,o,u,p,h,4,_,w)}}class kI{constructor(r,o){this.width=r.width,this.height=r.height,this.data=o instanceof Uint8Array?new Float32Array(o.buffer):o}}function dy(c){const r={},o=c.resolution||256,u=c.clips?c.clips.length:1,p=c.image||new bs({width:o,height:u}),h=(_,w,E)=>{r[c.evaluationKey]=E;const A=c.expression.evaluate(r);A&&(p.data[_+w+0]=Math.floor(255*A.r/A.a),p.data[_+w+1]=Math.floor(255*A.g/A.a),p.data[_+w+2]=Math.floor(255*A.b/A.a),p.data[_+w+3]=Math.floor(255*A.a))};if(c.clips)for(let _=0,w=0;_<u;++_,w+=4*o)for(let E=0,A=0;E<o;E++,A+=4){const v=E/(o-1),{start:C,end:I}=c.clips[_];h(w,A,C*(1-v)+I*v)}else for(let _=0,w=0;_<o;_++,w+=4)h(0,w,_/(o-1));return p}zt(od,"AlphaImage"),zt(bs,"RGBAImage");const OU=nn([{name:"a_pos",components:2,type:"Int16"}],4),zU=nn([{name:"a_road_z_offset",components:1,type:"Float32"}],4),FU=nn([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),BU=nn([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function hy(c,r,o=2){const u=r&&r.length,p=u?r[0]*o:c.length;let h=NI(c,0,p,o,!0);const _=[];if(!h||h.next===h.prev)return _;let w,E,A;if(u&&(h=function(v,C,I,M){const P=[];for(let R=0,F=C.length;R<F;R++){const B=NI(v,C[R]*M,R<F-1?C[R+1]*M:v.length,M,!1);B===B.next&&(B.steiner=!0),P.push(ZU(B))}P.sort(qU);for(let R=0;R<P.length;R++)I=HU(P[R],I);return I}(c,r,h,o)),c.length>80*o){w=1/0,E=1/0;let v=-1/0,C=-1/0;for(let I=o;I<p;I+=o){const M=c[I],P=c[I+1];M<w&&(w=M),P<E&&(E=P),M>v&&(v=M),P>C&&(C=P)}A=Math.max(v-w,C-E),A=A!==0?32767/A:0}return fy(h,_,o,w,E,A,0),_}function NI(c,r,o,u,p){let h;if(p===function(_,w,E,A){let v=0;for(let C=w,I=E-A;C<E;C+=A)v+=(_[I]-_[C])*(_[C+1]+_[I+1]),I=C;return v}(c,r,o,u)>0)for(let _=r;_<o;_+=u)h=DI(_/u|0,c[_],c[_+1],h);else for(let _=o-u;_>=r;_-=u)h=DI(_/u|0,c[_],c[_+1],h);return h&&t1(h,h.next)&&(my(h),h=h.next),h}function of(c,r){if(!c)return c;r||(r=c);let o,u=c;do if(o=!1,u.steiner||!t1(u,u.next)&&$i(u.prev,u,u.next)!==0)u=u.next;else{if(my(u),u=r=u.prev,u===u.next)break;o=!0}while(o||u!==r);return r}function fy(c,r,o,u,p,h,_){if(!c)return;!_&&h&&function(E,A,v,C){let I=E;do I.z===0&&(I.z=FS(I.x,I.y,A,v,C)),I.prevZ=I.prev,I.nextZ=I.next,I=I.next;while(I!==E);I.prevZ.nextZ=null,I.prevZ=null,function(M){let P,R=1;do{let F,B=M;M=null;let Z=null;for(P=0;B;){P++;let W=B,G=0;for(let ee=0;ee<R&&(G++,W=W.nextZ,W);ee++);let X=R;for(;G>0||X>0&&W;)G!==0&&(X===0||!W||B.z<=W.z)?(F=B,B=B.nextZ,G--):(F=W,W=W.nextZ,X--),Z?Z.nextZ=F:M=F,F.prevZ=Z,Z=F;B=W}Z.nextZ=null,R*=2}while(P>1)}(I)}(c,u,p,h);let w=c;for(;c.prev!==c.next;){const E=c.prev,A=c.next;if(h?UU(c,u,p,h):VU(c))r.push(E.i,c.i,A.i),my(c),c=A.next,w=A.next;else if((c=A)===w){_?_===1?fy(c=$U(of(c),r),r,o,u,p,h,2):_===2&&GU(c,r,o,u,p,h):fy(of(c),r,o,u,p,h,1);break}}}function VU(c){const r=c.prev,o=c,u=c.next;if($i(r,o,u)>=0)return!1;const p=r.x,h=o.x,_=u.x,w=r.y,E=o.y,A=u.y,v=p<h?p<_?p:_:h<_?h:_,C=w<E?w<A?w:A:E<A?E:A,I=p>h?p>_?p:_:h>_?h:_,M=w>E?w>A?w:A:E>A?E:A;let P=u.next;for(;P!==r;){if(P.x>=v&&P.x<=I&&P.y>=C&&P.y<=M&&nm(p,w,h,E,_,A,P.x,P.y)&&$i(P.prev,P,P.next)>=0)return!1;P=P.next}return!0}function UU(c,r,o,u){const p=c.prev,h=c,_=c.next;if($i(p,h,_)>=0)return!1;const w=p.x,E=h.x,A=_.x,v=p.y,C=h.y,I=_.y,M=w<E?w<A?w:A:E<A?E:A,P=v<C?v<I?v:I:C<I?C:I,R=w>E?w>A?w:A:E>A?E:A,F=v>C?v>I?v:I:C>I?C:I,B=FS(M,P,r,o,u),Z=FS(R,F,r,o,u);let W=c.prevZ,G=c.nextZ;for(;W&&W.z>=B&&G&&G.z<=Z;){if(W.x>=M&&W.x<=R&&W.y>=P&&W.y<=F&&W!==p&&W!==_&&nm(w,v,E,C,A,I,W.x,W.y)&&$i(W.prev,W,W.next)>=0||(W=W.prevZ,G.x>=M&&G.x<=R&&G.y>=P&&G.y<=F&&G!==p&&G!==_&&nm(w,v,E,C,A,I,G.x,G.y)&&$i(G.prev,G,G.next)>=0))return!1;G=G.nextZ}for(;W&&W.z>=B;){if(W.x>=M&&W.x<=R&&W.y>=P&&W.y<=F&&W!==p&&W!==_&&nm(w,v,E,C,A,I,W.x,W.y)&&$i(W.prev,W,W.next)>=0)return!1;W=W.prevZ}for(;G&&G.z<=Z;){if(G.x>=M&&G.x<=R&&G.y>=P&&G.y<=F&&G!==p&&G!==_&&nm(w,v,E,C,A,I,G.x,G.y)&&$i(G.prev,G,G.next)>=0)return!1;G=G.nextZ}return!0}function $U(c,r){let o=c;do{const u=o.prev,p=o.next.next;!t1(u,p)&&RI(u,o,o.next,p)&&py(u,p)&&py(p,u)&&(r.push(u.i,o.i,p.i),my(o),my(o.next),o=c=p),o=o.next}while(o!==c);return of(o)}function GU(c,r,o,u,p,h){let _=c;do{let w=_.next.next;for(;w!==_.prev;){if(_.i!==w.i&&YU(_,w)){let E=jI(_,w);return _=of(_,_.next),E=of(E,E.next),fy(_,r,o,u,p,h,0),void fy(E,r,o,u,p,h,0)}w=w.next}_=_.next}while(_!==c)}function qU(c,r){return c.x-r.x}function HU(c,r){const o=function(p,h){let _=h;const w=p.x,E=p.y;let A,v=-1/0;do{if(E<=_.y&&E>=_.next.y&&_.next.y!==_.y){const R=_.x+(E-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(R<=w&&R>v&&(v=R,A=_.x<_.next.x?_:_.next,R===w))return A}_=_.next}while(_!==h);if(!A)return null;const C=A,I=A.x,M=A.y;let P=1/0;_=A;do{if(w>=_.x&&_.x>=I&&w!==_.x&&nm(E<M?w:v,E,I,M,E<M?v:w,E,_.x,_.y)){const R=Math.abs(E-_.y)/(w-_.x);py(_,p)&&(R<P||R===P&&(_.x>A.x||_.x===A.x&&WU(A,_)))&&(A=_,P=R)}_=_.next}while(_!==C);return A}(c,r);if(!o)return r;const u=jI(o,c);return of(u,u.next),of(o,o.next)}function WU(c,r){return $i(c.prev,c,r.prev)<0&&$i(r.next,c,c.next)<0}function FS(c,r,o,u,p){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-o)*p|0)|c<<8))|c<<4))|c<<2))|c<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-u)*p|0)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function ZU(c){let r=c,o=c;do(r.x<o.x||r.x===o.x&&r.y<o.y)&&(o=r),r=r.next;while(r!==c);return o}function nm(c,r,o,u,p,h,_,w){return(p-_)*(r-w)>=(c-_)*(h-w)&&(c-_)*(u-w)>=(o-_)*(r-w)&&(o-_)*(h-w)>=(p-_)*(u-w)}function YU(c,r){return c.next.i!==r.i&&c.prev.i!==r.i&&!function(o,u){let p=o;do{if(p.i!==o.i&&p.next.i!==o.i&&p.i!==u.i&&p.next.i!==u.i&&RI(p,p.next,o,u))return!0;p=p.next}while(p!==o);return!1}(c,r)&&(py(c,r)&&py(r,c)&&function(o,u){let p=o,h=!1;const _=(o.x+u.x)/2,w=(o.y+u.y)/2;do p.y>w!=p.next.y>w&&p.next.y!==p.y&&_<(p.next.x-p.x)*(w-p.y)/(p.next.y-p.y)+p.x&&(h=!h),p=p.next;while(p!==o);return h}(c,r)&&($i(c.prev,c,r.prev)||$i(c,r.prev,r))||t1(c,r)&&$i(c.prev,c,c.next)>0&&$i(r.prev,r,r.next)>0)}function $i(c,r,o){return(r.y-c.y)*(o.x-r.x)-(r.x-c.x)*(o.y-r.y)}function t1(c,r){return c.x===r.x&&c.y===r.y}function RI(c,r,o,u){const p=n1($i(c,r,o)),h=n1($i(c,r,u)),_=n1($i(o,u,c)),w=n1($i(o,u,r));return p!==h&&_!==w||!(p!==0||!r1(c,o,r))||!(h!==0||!r1(c,u,r))||!(_!==0||!r1(o,c,u))||!(w!==0||!r1(o,r,u))}function r1(c,r,o){return r.x<=Math.max(c.x,o.x)&&r.x>=Math.min(c.x,o.x)&&r.y<=Math.max(c.y,o.y)&&r.y>=Math.min(c.y,o.y)}function n1(c){return c>0?1:c<0?-1:0}function py(c,r){return $i(c.prev,c,c.next)<0?$i(c,r,c.next)>=0&&$i(c,c.prev,r)>=0:$i(c,r,c.prev)<0||$i(c,c.next,r)<0}function jI(c,r){const o=BS(c.i,c.x,c.y),u=BS(r.i,r.x,r.y),p=c.next,h=r.prev;return c.next=r,r.prev=c,o.next=p,p.prev=o,u.next=o,o.prev=u,h.next=u,u.prev=h,u}function DI(c,r,o,u){const p=BS(c,r,o);return u?(p.next=u.next,p.prev=u,u.next.prev=p,u.next=p):(p.prev=p,p.next=p),p}function my(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function BS(c,r,o){return{i:c,x:r,y:o,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function i1(c,r){const o=c.length;if(o<=1)return[c];const u=[];let p,h;for(let _=0;_<o;_++){const w=Jn(c[_]);w!==0&&(c[_].area=Math.abs(w),h===void 0&&(h=w<0),h===w<0?(p&&u.push(p),p=[c[_]]):p.push(c[_]))}if(p&&u.push(p),r>1)for(let _=0;_<u.length;_++)u[_].length<=r||(c0(u[_],r,1,u[_].length-1,XU),u[_]=u[_].slice(0,r));return u}function XU(c,r){return r.area-c.area}function LI(c,r,o=1){if(!c)return null;const u=typeof c=="string"?Ps.from(c).getPrimary():c.getPrimary(),p=u.id.toString();return r.has(p)||r.set(p,[]),u.scaleSelf(o),r.get(p).push(u),u.toString()}function VS(c,r,o,u){const p=u.patternDependencies;let h=!1;for(const _ of r){const w=_.paint.get(`${c}-pattern`);w.isConstant()||(h=!0),LI(w.constantOr(null),p,o)&&(h=!0)}return h}function US(c,r,o,u,p,h){const _=h.patternDependencies;for(const w of r){const E=w.paint.get(`${c}-pattern`).value;if(E.kind!=="constant"){let A=E.evaluate({zoom:u},o,{},h.availableImages);A=A&&A.name?A.name:A;const v=LI(A,_,p);v&&(o.patterns[w.id]=v)}}return o}var $S,OI,GS,zI,qS,FI,BI,s1={};function VI(){if(OI)return $S;OI=1;var c=hi();function r(p,h,_,w,E){this.properties={},this.extent=_,this.type=0,this._pbf=p,this._geometry=-1,this._keys=w,this._values=E,p.readFields(o,this,h)}function o(p,h,_){p==1?h.id=_.readVarint():p==2?function(w,E){for(var A=w.readVarint()+w.pos;w.pos<A;){var v=E._keys[w.readVarint()],C=E._values[w.readVarint()];E.properties[v]=C}}(_,h):p==3?h.type=_.readVarint():p==4&&(h._geometry=_.pos)}function u(p){for(var h,_,w=0,E=0,A=p.length,v=A-1;E<A;v=E++)w+=((_=p[v]).x-(h=p[E]).x)*(h.y+_.y);return w}return $S=r,r.types=["Unknown","Point","LineString","Polygon"],r.prototype.loadGeometry=function(){var p=this._pbf;p.pos=this._geometry;for(var h,_=p.readVarint()+p.pos,w=1,E=0,A=0,v=0,C=[];p.pos<_;){if(E<=0){var I=p.readVarint();w=7&I,E=I>>3}if(E--,w===1||w===2)A+=p.readSVarint(),v+=p.readSVarint(),w===1&&(h&&C.push(h),h=[]),h.push(new c(A,v));else{if(w!==7)throw new Error("unknown command "+w);h&&h.push(h[0].clone())}}return h&&C.push(h),C},r.prototype.bbox=function(){var p=this._pbf;p.pos=this._geometry;for(var h=p.readVarint()+p.pos,_=1,w=0,E=0,A=0,v=1/0,C=-1/0,I=1/0,M=-1/0;p.pos<h;){if(w<=0){var P=p.readVarint();_=7&P,w=P>>3}if(w--,_===1||_===2)(E+=p.readSVarint())<v&&(v=E),E>C&&(C=E),(A+=p.readSVarint())<I&&(I=A),A>M&&(M=A);else if(_!==7)throw new Error("unknown command "+_)}return[v,I,C,M]},r.prototype.toGeoJSON=function(p,h,_){var w,E,A=this.extent*Math.pow(2,_),v=this.extent*p,C=this.extent*h,I=this.loadGeometry(),M=r.types[this.type];function P(B){for(var Z=0;Z<B.length;Z++){var W=B[Z];B[Z]=[360*(W.x+v)/A-180,360/Math.PI*Math.atan(Math.exp((180-360*(W.y+C)/A)*Math.PI/180))-90]}}switch(this.type){case 1:var R=[];for(w=0;w<I.length;w++)R[w]=I[w][0];P(I=R);break;case 2:for(w=0;w<I.length;w++)P(I[w]);break;case 3:for(I=function(B){var Z=B.length;if(Z<=1)return[B];for(var W,G,X=[],ee=0;ee<Z;ee++){var ie=u(B[ee]);ie!==0&&(G===void 0&&(G=ie<0),G===ie<0?(W&&X.push(W),W=[B[ee]]):W.push(B[ee]))}return W&&X.push(W),X}(I),w=0;w<I.length;w++)for(E=0;E<I[w].length;E++)P(I[w][E])}I.length===1?I=I[0]:M="Multi"+M;var F={type:"Feature",geometry:{type:M,coordinates:I},properties:this.properties};return"id"in this&&(F.id=this.id),F},$S}function UI(){if(zI)return GS;zI=1;var c=VI();function r(u,p){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=u,this._keys=[],this._values=[],this._features=[],u.readFields(o,this,p),this.length=this._features.length}function o(u,p,h){u===15?p.version=h.readVarint():u===1?p.name=h.readString():u===5?p.extent=h.readVarint():u===2?p._features.push(h.pos):u===3?p._keys.push(h.readString()):u===4&&p._values.push(function(_){for(var w=null,E=_.readVarint()+_.pos;_.pos<E;){var A=_.readVarint()>>3;w=A===1?_.readString():A===2?_.readFloat():A===3?_.readDouble():A===4?_.readVarint64():A===5?_.readVarint():A===6?_.readSVarint():A===7?_.readBoolean():null}return w}(h))}return GS=r,r.prototype.feature=function(u){if(u<0||u>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[u];var p=this._pbf.readVarint()+this._pbf.pos;return new c(this._pbf,p,this.extent,this._keys,this._values)},GS}function $I(){return BI||(BI=1,s1.VectorTile=function(){if(FI)return qS;FI=1;var c=UI();function r(o,u,p){if(o===3){var h=new c(p,p.readVarint()+p.pos);h.length&&(u[h.name]=h)}}return qS=function(o,u){this.layers=o.readFields(r,{},u)},qS}(),s1.VectorTileFeature=VI(),s1.VectorTileLayer=UI()),s1}var ad=$I();const af="3d_elevation_id",GI="level";class KU{constructor(){this._valid=!1}reset(r){return this.feature=r,this._valid=!0,this._geometry=r.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(r,o){return this._valid&&r(o(this._geometry)),this}require(r,o,u){return this.get(r,!0,o,u)}optional(r,o,u){return this.get(r,!1,o,u)}success(){return this._valid}get(r,o,u,p){const h=this.feature.properties.hasOwnProperty(r)?+this.feature.properties[r]:void 0;return this._valid&&h!==void 0?u(p?p(h):h):o&&(this._valid=!1),this}}class qI{constructor(r,o){this.featureFunc=r,this.vertexFunc=o}parseFeature(r,o,u){return this.featureFunc(r,o,u)}parseVertex(r,o,u){return this.vertexFunc(r,o,u)}}const JU=new qI((c,r,o)=>c.reset(r).require(af,u=>{o.id=u}).optional("fixed_height_relative",u=>{o.constantHeight=u},Hc.decodeRelativeHeight).geometry(u=>{o.bounds=u},Hc.computeBounds).success(),(c,r,o)=>c.reset(r).require(af,u=>{o.id=u}).require("elevation_idx",u=>{o.idx=u}).require("extent",u=>{o.extent=u}).require("height_relative",u=>{o.height=u},Hc.decodeRelativeHeight).geometry(u=>{o.position=u},Hc.getPoint).success()),QU=new qI((c,r,o)=>c.reset(r).require(af,u=>{o.id=u}).optional("fixed_height",u=>{o.constantHeight=u},Hc.decodeMetricHeight).geometry(u=>{o.bounds=u},Hc.computeBounds).success(),(c,r,o)=>c.reset(r).require(af,u=>{o.id=u}).require("elevation_idx",u=>{o.idx=u}).require("extent",u=>{o.extent=u}).require("height",u=>{o.height=u},Hc.decodeMetricHeight).geometry(u=>{o.position=u},Hc.getPoint).success());class Hc{static computeBounds(r){const o=new bt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),u=new bt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const p of r[0])o.x>p.x&&(o.x=p.x),o.y>p.y&&(o.y=p.y),u.x<p.x&&(u.x=p.x),u.y<p.y&&(u.y=p.y);return{min:o,max:u}}static getPoint(r){return de.vec2.fromValues(r[0][0].x,r[0][0].y)}static decodeRelativeHeight(r){return 1e-4*r*5}static decodeMetricHeight(r){return 1e-4*r}static parse(r){const o=[],u=[],p=r.length,h=new KU;for(let w=0;w<p;w++){const E=r.feature(w),A=E.properties.hasOwnProperty("version")?String(E.properties.version):void 0,v=(_=A)?_==="1.0.1"?QU:void 0:JU;if(v===void 0){Kn(`Unknown elevation feature version number ${A||"(unknown)"}`);continue}const C=E.properties.hasOwnProperty("type")?E.properties.type:void 0;if(C){if(ad.VectorTileFeature.types[E.type]==="Point"&&C==="curve_point"){const I={};v.parseVertex(h,E,I)&&o.push(I)}else if(ad.VectorTileFeature.types[E.type]==="Polygon"&&C==="curve_meta"){const I={};v.parseFeature(h,E,I)&&u.push(I)}}}var _;return{vertices:o,features:u}}}class HS{constructor(r,o,u,p,h,_){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=r,this.heightRange={min:u,max:u},this.safeArea=o,this.constantHeight=u,this.constantHeight==null&&(this.constantHeight!=null||p.length!==0)){this.vertices=p,this.edges=h,this.edges=this.edges.filter(w=>w.a<this.vertices.length&&w.b<this.vertices.length&&!de.vec2.exactEquals(this.vertices[w.a].position,this.vertices[w.b].position)),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const w of this.vertices)this.vertexProps.push({dir:de.vec2.fromValues(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,w.height),this.heightRange.max=Math.max(this.heightRange.max,w.height);for(const w of this.edges){const E=this.vertices[w.a].position,A=this.vertices[w.b].position,v=de.vec2.subtract(de.vec2.create(),A,E),C=de.vec2.length(v),I=de.vec2.scale(de.vec2.create(),v,1/C);this.edgeProps.push({vec:v,dir:I,len:C});const M=this.vertexProps[w.a].dir,P=this.vertexProps[w.b].dir;de.vec2.add(M,M,I),de.vec2.add(P,P,I)}for(const w of this.vertexProps)w.dir[0]===0&&w.dir[1]===0||de.vec2.normalize(w.dir,w.dir);this.tessellate(_)}}pointElevation(r){if(this.constantHeight!=null)return this.constantHeight;const o=this.getClosestEdge(r);if(o==null)return 0;const[u,p]=o;return((h,_,w)=>(1-w)*h+w*_)(this.vertices[this.edges[u].a].height,this.vertices[this.edges[u].b].height,p)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(r){if(this.edges.length===0)return;let o=0,u=Number.POSITIVE_INFINITY,p=0;const h=de.vec2.fromValues(r.x,r.y);for(let _=0;_<this.edges.length;_++){const w=this.edges[_],E=this.edgeProps[_].dir,A=new yr(h,this.edgeProps[_].dir),v=this.vertices[w.a].position,C=this.vertices[w.b].position,I=de.vec2.create(),M=de.vec2.create(),P=A.intersectsPlane(v,this.vertexProps[w.a].dir,I),R=A.intersectsPlane(C,this.vertexProps[w.b].dir,M);if(!P||!R)continue;const F=de.vec2.subtract(de.vec2.create(),M,I),B=de.vec2.subtract(de.vec2.create(),h,I),Z=de.vec2.dot(F,F),W=Z>0?de.vec2.dot(B,F)/Z:0,G=Bt(W,0,1),X=Math.abs((W-G)*this.edgeProps[_].len),ee=de.vec2.subtract(de.vec2.create(),h,v),ie=X+Math.abs(de.vec2.dot(ee,de.vec2.fromValues(E[1],-E[0])));ie<u&&(o=_,u=ie,p=G)}return[o,p]}tessellate(r){for(let o=this.edges.length-1;o>=0;--o){const u=this.edges[o].a,p=this.edges[o].b,{position:h,height:_,extent:w}=this.vertices[u],{position:E,height:A,extent:v}=this.vertices[p],C=this.vertexProps[u].dir,I=this.vertexProps[p].dir,M=de.vec3.fromValues(h[0]/r,h[1]/r,_),P=de.vec3.fromValues(E[0]/r,E[1]/r,A),R=de.vec3.fromValues(C[1],-C[0],0);de.vec3.scale(R,R,w);const F=de.vec3.fromValues(I[1],-I[0],0);if(de.vec3.scale(F,F,v),this.distSqLines(de.vec3.fromValues(M[0]+.5*R[0],M[1]+.5*R[1],M[2]+.5*R[2]),de.vec3.fromValues(P[0]-.5*F[0],P[1]-.5*F[1],P[2]-.5*F[2]),de.vec3.fromValues(M[0]-.5*R[0],M[1]-.5*R[1],M[2]-.5*R[2]),de.vec3.fromValues(P[0]+.5*F[0],P[1]+.5*F[1],P[2]+.5*F[2]))<=.05*.05)continue;const B=this.vertices.length,Z=de.vec2.add(de.vec2.create(),h,E);this.vertices.push({position:de.vec2.scale(Z,Z,.5),height:.5*(_+A),extent:.5*(w+v)});const W=de.vec2.add(de.vec2.create(),C,I);this.vertexProps.push({dir:de.vec2.normalize(W,W)}),this.edges.splice(o,1),this.edgeProps.splice(o,1),this.edges.push({a:u,b:B}),this.edges.push({a:B,b:p});const G=de.vec2.subtract(de.vec2.create(),this.vertices[B].position,h),X=de.vec2.length(G),ee={vec:G,dir:de.vec2.scale(de.vec2.create(),G,1/X),len:X};this.edgeProps.push(ee),this.edgeProps.push(ee)}}distSqLines(r,o,u,p){const h=de.vec3.subtract(de.vec3.create(),o,r),_=de.vec3.subtract(de.vec3.create(),p,u),w=de.vec3.subtract(de.vec3.create(),r,u),E=de.vec3.dot(h,h),A=de.vec3.dot(h,_),v=de.vec3.dot(h,w),C=de.vec3.dot(_,_),I=de.vec3.dot(_,w),M=E*C-A*A;if(M===0){const Z=de.vec3.dot(w,_)/de.vec3.dot(_,_),W=de.vec3.lerp(de.vec3.create(),u,p,Z);return de.vec3.squaredDistance(W,r)}const P=(A*I-v*C)/M,R=(E*I-A*v)/M,F=de.vec3.lerp(de.vec3.create(),r,o,P),B=de.vec3.lerp(de.vec3.create(),u,p,R);return de.vec3.squaredDistance(F,B)}}class e8{constructor(r,o){this.zScale=1,this.xOffset=0,this.yOffset=0,r.equals(o)||(this.zScale=Math.pow(2,o.z-r.z),this.xOffset=(r.x*this.zScale-o.x)*Ct,this.yOffset=(r.y*this.zScale-o.y)*Ct)}constantElevation(r,o){if(r.constantHeight!=null)return this.computeBiasedHeight(r.constantHeight,o)}pointElevation(r,o,u){const p=this.constantElevation(o,u);return p??(r.x=r.x*this.zScale+this.xOffset,r.y=r.y*this.zScale+this.yOffset,this.computeBiasedHeight(o.pointElevation(r),u))}computeBiasedHeight(r,o){return o<=0?r:r+o*Or(0,o,r>=0?r:Math.abs(.5*r))}}zt(HS,"ElevationFeature");class HI{constructor(){this.polygons=new Map}add(r,...o){this.polygons.has(r)?this.polygons.get(r).push(...o):this.polygons.set(r,o)}merge(r){for(const[o,u]of r.polygons)this.add(o,...u)}}class lf{constructor(){this.portals=[]}static evaluate(r){if(r.length===0)return new lf;let o=[];for(const A of r)o.push(...A.portals);if(o.length===0)return new lf;const u=(A,v)=>A<=0&&v<=0||A>=Ct&&v>=Ct;for(const A of o){const v=A.va,C=A.vb;(u(v.x,C.x)||u(v.y,C.y))&&(A.type="border")}const p=o.filter(A=>A.type!=="unevaluated"),h=o.filter(A=>A.type==="unevaluated");if(h.length===0)return new lf;h.sort((A,v)=>A.hash===v.hash?A.isTunnel===v.isTunnel?0:A.isTunnel?-1:1:A.hash<v.hash?1:-1),o=p.concat(h);let _=p.length,w=_,E=_;do if(w++,w===o.length||o[_].hash!==o[w].hash){if(w-_==2){E<_&&(o[E]=o[_],o[_]=null);const A=o[E],v=o[w-1];A.type=A.isTunnel!==v.isTunnel?"tunnel":"polygon",A.connection={a:A.connection.a,b:v.connection.a},E++}_=w}while(_!==o.length);return o.splice(E),o.sort((A,v)=>A.hash<v.hash?1:-1),{portals:o}}}zt(lf,"ElevationPortalGraph"),zt(HI,"ElevationPolygons");class t8{constructor(r,o,u){this.outPositions=r,this.outNormals=o,this.outIndices=u,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(r,o,u){let p=r[2];u!=null&&(p*=u);const h=this.getVec3Bits(r)<<96n|this.getVec3Bits(o),_=this.vertexLookup.get(h);if(_!=null)return _;const w=this.outPositions.length;this.vertexLookup.set(h,w);const E=Math.trunc(16384*o[0]),A=Math.trunc(16384*o[1]),v=Math.trunc(16384*o[2]);return this.outPositions.emplaceBack(r[0],r[1],p),this.outNormals.emplaceBack(E,A,v),w}addVertices(r,o,...u){const p=[];for(const h of u){const _=this.addVertex(h,r,o);p.push(_)}return p}addTriangles(r,o,u){if(o&&u){const p=u.length===1,h=de.vec3.fromValues(0,0,0);for(let _=0;_<r.length;_+=3){const w=o[r[_+0]],E=o[r[_+1]],A=o[r[_+2]],v=p?u[0]:u[r[_+1]],C=p?u[0]:u[r[_+2]],I=this.addVertex(de.vec3.fromValues(w.x,w.y,p?u[0]:u[r[_+0]]),h),M=this.addVertex(de.vec3.fromValues(E.x,E.y,v),h),P=this.addVertex(de.vec3.fromValues(A.x,A.y,C),h);this.outIndices.emplaceBack(I,M,P)}}else for(let p=0;p<r.length;p+=3)this.outIndices.emplaceBack(r[p+0],r[p+1],r[p+2])}addQuad(r,o){const u=this.addVertices(o,void 0,...r.map(E=>de.vec3.fromValues(E.coord.x,E.coord.y,E.height))),[p,h,_,w]=u;this.addTriangles([p,h,_,_,w,p])}getBits(r){return this.view.setFloat32(0,r),BigInt(this.view.getUint32(0))}getVec3Bits(r){return this.getBits(r[0])<<64n|this.getBits(r[1])<<32n|this.getBits(r[2])}}class ml{constructor(r){this.unevaluatedPortals=new lf,this.portalPolygons=new HI,this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Hh,this.vertexNormals=new G_,this.indexArray=new ls,this.tileToMeters=g(r)}addVertices(r,o){const u=this.unevalVertices.length;for(let p=0;p<r.length;p++)this.unevalVertices.push(r[p]),this.unevalHeights.push(o[p]);return u}addTriangles(r,o,u){const p=u?this.unevalTunnelTriangles:this.unevalTriangles;for(const h of r)p.push(h+o)}addRenderableRing(r,o,u,p,h){const _=[new bt(h.min.x,h.min.y),new bt(h.max.x,h.min.y),new bt(h.max.x,h.max.y),new bt(h.min.x,h.max.y)];for(let w=0;w<u-1;w++){const E=o+w,A=E+1,v=this.unevalVertices[E],C=this.unevalVertices[A];if(!(v.x>=h.min.x&&v.x<=h.max.x&&v.y>=h.min.y&&v.y<=h.max.y||C.x>=h.min.x&&C.x<=h.max.x&&C.y>=h.min.y&&C.y<=h.max.y||Pe(v,C,_))||this.isOnBorder(v.x,C.x)||this.isOnBorder(v.y,C.y))continue;const I=ml.computeEdgeHash(this.unevalVertices[E],this.unevalVertices[A]);let M,P=this.vertexHashLookup.get(ml.computePosHash(v));P!=null?M=P.next:(P=this.vertexHashLookup.get(ml.computePosHash(C)),M=P!=null?P.prev:I),this.unevalEdges.push({polygonIdx:r,a:E,b:A,hash:I,portalHash:M,isTunnel:p,type:"unevaluated"})}}addPortalCandidates(r,o,u,p,h){if(o.length===0)return;this.portalPolygons.add(r,{geometry:o,zLevel:h});const _=o[0];this.vertexHashLookup.clear();let w=ml.computeEdgeHash(_[_.length-2],_[_.length-1]);for(let E=0;E<_.length-1;E++){const A=_[E+0],v=_[E+1],C=de.vec2.fromValues(v.x-A.x,v.y-A.y),I=de.vec2.length(C);if(I===0)continue;let M="unevaluated";const P=p.pointElevation(A),R=p.pointElevation(v);Math.abs(P)<.01&&Math.abs(R)<.01?M="entrance":(this.isOnBorder(A.x,v.x)||this.isOnBorder(A.y,v.y))&&(M="border");const F=ml.computeEdgeHash(A,v);this.unevaluatedPortals.portals.push({connection:{a:r,b:void 0},va:A,vb:v,vab:C,length:I,hash:F,isTunnel:u,type:M});const B=ml.computePosHash(A);this.vertexHashLookup.set(B,{prev:w,next:F}),w=F}}construct(r){if(this.unevalVertices.length===0)return;const o=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),u=C=>{C.primitiveLength=this.indexArray.length-C.primitiveOffset},p=new t8(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(r.portals,this.unevalEdges);const h=o(),_=o(),w=o(),E=(C,I)=>{C.sort((P,R)=>P.type===I&&R.type!==I?-1:P.type!==I&&R.type===I?1:0);const M=C.findIndex(P=>P.type!==I);return M>=0?M:C.length};let A=0;this.unevalEdges.length>0&&(A=E(this.unevalEdges,"none"),this.constructBridgeStructures(p,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:A},this.tileToMeters));const v=o();if(this.unevalEdges.length>0){const C=this.unevalEdges.splice(A),I=E(C,"tunnel")+A;this.unevalEdges.push(...C),this.constructTunnelStructures(p,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:A},{min:A,max:I})}u(w),p.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),u(v),p.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),u(_),p.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),u(h),this.maskSegments=Hn.simpleSegment(0,v.primitiveOffset,0,v.primitiveLength),this.depthSegments=Hn.simpleSegment(0,_.primitiveOffset,0,_.primitiveLength),this.renderableSegments=Hn.simpleSegment(0,w.primitiveOffset,0,w.primitiveLength),this.shadowCasterSegments=Hn.simpleSegment(0,h.primitiveOffset,0,h.primitiveLength)}upload(r){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=r.createVertexBuffer(this.vertexPositions,FU.members),this.vertexBufferNormal=r.createVertexBuffer(this.vertexNormals,BU.members),this.indexBuffer=r.createIndexBuffer(this.indexArray))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableSegments.destroy(),this.shadowCasterSegments.destroy())}computeVertexConnections(r,o,u,p){const h=new Map;for(let _=u;_<p;_++){const w=o[_],E=w.a,A=w.b;h.has(E)||h.set(E,{}),h.has(A)||h.set(A,{});const v=h.get(E),C=h.get(A);r[A]>0&&(v.to=A),r[E]>0&&(C.from=E)}return h}constructBridgeStructures(r,o,u,p,h,_){const w=this.computeVertexConnections(u,p,h.min,h.max),E=1/_,A=.5*E,v=I=>de.vec3.fromValues(o[I].x,o[I].y,u[I]*E),C=I=>{const M=w.get(I),P=M.from,R=M.to;if(!P||!R)return;const F=v(P),B=v(I),Z=v(R),W=de.vec3.fromValues(0,0,0);if(!de.vec3.exactEquals(F,B)){const X=de.vec3.sub(de.vec3.create(),B,F);de.vec3.add(W,W,de.vec3.normalize(X,X))}if(!de.vec3.exactEquals(Z,B)){const X=de.vec3.sub(de.vec3.create(),Z,B);de.vec3.add(W,W,de.vec3.normalize(X,X))}const G=de.vec3.len(W);return G>0?de.vec3.scale(W,W,1/G):void 0};for(let I=h.min;I<h.max;I++){const M=p[I],P=this.prepareEdgePoints(o,u,M,(_t,lr)=>_t>=lr);if(P==null)continue;const R=P[0],F=P[1],B=de.vec3.fromValues(R.coord.x,R.coord.y,E*R.height),Z=de.vec3.fromValues(F.coord.x,F.coord.y,E*F.height);if(de.vec3.exactEquals(B,Z))continue;const W=de.vec3.sub(de.vec3.create(),Z,B);de.vec3.normalize(W,W);const G=_t=>de.vec3.normalize(_t,_t),X=C(M.a)||W,ee=C(M.b)||W,ie=G(de.vec3.fromValues(X[1],-X[0],0)),ge=G(de.vec3.fromValues(ee[1],-ee[0],0)),fe=G(de.vec3.cross(de.vec3.create(),ie,X)),pe=G(de.vec3.cross(de.vec3.create(),ge,ee)),Ce=de.vec3.create(),_e=[de.vec3.add(de.vec3.create(),B,de.vec3.scale(Ce,de.vec3.sub(Ce,ie,fe),A)),de.vec3.add(de.vec3.create(),B,de.vec3.scale(Ce,de.vec3.add(Ce,ie,fe),A)),de.vec3.add(de.vec3.create(),B,de.vec3.scale(Ce,fe,A)),B],Me=[de.vec3.add(de.vec3.create(),Z,de.vec3.scale(Ce,de.vec3.sub(Ce,ge,pe),A)),de.vec3.add(de.vec3.create(),Z,de.vec3.scale(Ce,de.vec3.add(Ce,ge,pe),A)),de.vec3.add(de.vec3.create(),Z,de.vec3.scale(Ce,pe,A)),Z],[Re,ke]=r.addVertices(ie,_,_e[0],_e[1]),[Oe,Le]=r.addVertices(ge,_,Me[0],Me[1]);r.addTriangles([Re,ke,Oe,ke,Le,Oe]);const[Ge,Ve]=r.addVertices(fe,_,_e[1],_e[2]),[He,gt]=r.addVertices(pe,_,Me[1],Me[2]);r.addTriangles([Ge,Ve,He,Ve,gt,He]);const[ft,Ft]=r.addVertices(de.vec3.negate(ie,ie),_,_e[2],_e[3]),[xt,Et]=r.addVertices(de.vec3.negate(ge,ge),_,Me[2],Me[3]);r.addTriangles([ft,Ft,xt,Ft,Et,xt])}}constructTunnelStructures(r,o,u,p,h,_){const w=E=>de.vec3.normalize(E,E);for(let E=h.min;E<h.max;E++){const A=this.prepareEdgePoints(o,u,p[E],(M,P)=>M<=P);if(A==null)continue;const[v,C]=A,I=w(de.vec3.fromValues(C.coord.y-v.coord.y,-(C.coord.x-v.coord.x),0));r.addQuad([v,C,{coord:C.coord,height:p[E].isTunnel?-.1:0},{coord:v.coord,height:p[E].isTunnel?-.1:0}],I)}for(let E=_.min;E<_.max;E++){const A=p[E],v=o[A.a],C=o[A.b],I=w(de.vec3.fromValues(C.y-v.y,-(C.x-v.x),0));r.addQuad([{coord:C,height:0},{coord:v,height:0},{coord:v,height:u[A.a]+4},{coord:C,height:u[A.b]+4}],I),r.addQuad([{coord:v,height:0},{coord:C,height:0},{coord:C,height:u[A.b]+4},{coord:v,height:u[A.a]+4}],I)}}prepareEdgePoints(r,o,u,p){const h=r[u.a],_=r[u.b];let w=o[u.a],E=o[u.b];if(!(w!==0&&p(w,0)||E!==0&&p(E,0)))return;const A=h.clone(),v=_.clone();if(p(w,0)){if(!p(E,0)){const C=E/(E-w);v.x=ur(v.x,A.x,C),v.y=ur(v.y,A.y,C),E=ur(E,w,C)}}else{const C=w/(w-E);A.x=ur(A.x,v.x,C),A.y=ur(A.y,v.y,C),w=ur(w,E,C)}return[{coord:A,height:w},{coord:v,height:E}]}prepareEdges(r,o){if(o.length===0)return;o.sort((w,E)=>w.hash===E.hash?E.polygonIdx-w.polygonIdx:E.hash>w.hash?1:-1);let u=0,p=0,h=0,_=o[u].polygonIdx;do p++,(p===o.length||o[u].hash!==o[p].hash)&&((p-u==1||o[p-1].polygonIdx!==_)&&(h<u&&(o[h]=o[u],o[u]=null),o[h].type="none",h++),u=p,u!==o.length&&(_=o[u].polygonIdx));while(u!==o.length);if(o.splice(h),o.length!==0&&r.length!==0){o.sort((A,v)=>A.hash<v.hash?1:-1);let w=0,E=0;for(;w!==o.length&&E!==r.length;){const A=o[w],v=r[E];A.portalHash>v.hash?w++:v.hash>A.portalHash?E++:(A.type=v.type,w++)}}}isOnBorder(r,o){return r<=0&&o<=0||r>=Ct&&o>=Ct}static computeEdgeHash(r,o){return(r.y===o.y&&r.x>o.x||r.y>o.y)&&([r,o]=[o,r]),BigInt(ml.computePosHash(r))<<32n|BigInt(ml.computePosHash(o))}static computePosHash(r){return((65535&r.x)<<16|65535&r.y)>>>0}}class WS{constructor(r,o){this.layoutVertexArray=new ul,this.indexArray=new ls,this.lineIndexArray=new rc,this.triangleSegments=new Hn,this.lineSegments=new Hn,this.programConfigurations=new ic(r.layers,{zoom:r.zoom,lut:r.lut}),this.uploaded=!1,o&&(this.elevatedLayoutVertexArray=new Bc)}update(r,o,u,p,h,_,w){this.programConfigurations.updatePaintArrays(r,o,h,u,p,_,w)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,OU.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.lineIndexBuffer=r.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=r.createVertexBuffer(this.elevatedLayoutVertexArray,zU.members))),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(r,o,u,p,h,_){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,o,u,p,h,_)}}class ZS{constructor(r){this.zoom=r.zoom,this.pixelRatio=r.pixelRatio,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.bufferData=new WS(r,!1),this.elevationBufferData=new WS(r,!0),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.projection=r.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference")}updateFootprints(r,o){}populate(r,o,u,p){this.hasPattern=VS("fill",this.layers,this.pixelRatio,o);const h=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:w,id:E,index:A,sourceLayerIndex:v}of r){const C=this.layers[0]._featureFilter.needGeometry,I=z(w,C);if(!this.layers[0]._featureFilter.filter(new kn(this.zoom),I,u))continue;const M=h?h.evaluate(I,{},u,o.availableImages):void 0,P={id:E,properties:w.properties,type:w.type,sourceLayerIndex:v,index:A,geometry:C?I.geometry:L(w,u,p),patterns:{},sortKey:M};_.push(P)}h&&_.sort((w,E)=>w.sortKey-E.sortKey);for(const w of _){const{geometry:E,index:A,sourceLayerIndex:v}=w;if(this.hasPattern){const C=US("fill",this.layers,w,this.zoom,this.pixelRatio,o);this.patternFeatures.push(C)}else this.addFeature(w,E,A,u,{},o.availableImages,o.brightness,o.elevationFeatures);o.featureIndex.insert(r[A].feature,E,A,v,this.index)}}update(r,o,u,p,h,_,w){this.bufferData.update(r,o,u,p,h,_,w),this.elevationBufferData.update(r,o,u,p,h,_,w)}addFeatures(r,o,u,p,h,_){for(const w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,o,u,p,_,r.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(r){this.bufferData.upload(r),this.elevationBufferData.upload(r),this.elevatedStructures&&this.elevatedStructures.upload(r)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(r,o,u,p,h,_=[],w,E){const A=i1(o,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(r,A,p,u,E):this.addGeometry(A,this.bufferData),this.bufferData.populatePaintArrays(r,u,h,_,p,w),this.elevationBufferData.populatePaintArrays(r,u,h,_,p,w)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(r){this.elevatedStructures&&this.elevatedStructures.construct(r)}addElevatedRoadFeature(r,o,u,p,h){const _=new Array,w=this.getElevationFeature(r,h);if(w){_.push({polygons:o,elevationFeature:w,elevationTileID:u});for(const E of _)if(E.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new ml(E.elevationTileID));const v=E.elevationFeature.isTunnel();let C=0;r.properties.hasOwnProperty(GI)&&(C=+r.properties[GI]);for(const I of E.polygons)this.elevatedStructures.addPortalCandidates(E.elevationFeature.id,I,v,E.elevationFeature,C)}const A=new e8(u,E.elevationTileID);this.addElevatedGeometry(E.polygons,A,E.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,p)}}else this.addGeometry(o,this.bufferData)}addElevatedGeometry(r,o,u,p,h){const _={elevation:u,elevationSampler:o,bias:p,index:h},[w,E]=this.addGeometry(r,this.elevationBufferData,_);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:w,max:E}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,w),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,E))}addGeometry(r,o,u){let p=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY,_=null;u&&(_=u.elevationSampler.constantElevation(u.elevation,u.bias),_!=null&&(p=_,h=_));const w=(E,A,v)=>{if(u!=null)if(A.push(E),_!=null)o.elevatedLayoutVertexArray.emplaceBack(_),v.push(_);else{const C=u.elevationSampler.pointElevation(E,u.elevation,u.bias);o.elevatedLayoutVertexArray.emplaceBack(C),v.push(C),p=Math.min(p,C),h=Math.max(h,C)}};for(const E of r){let A=0;for(const W of E)A+=W.length;const v=o.triangleSegments.prepareSegment(A,o.layoutVertexArray,o.indexArray),C=v.vertexLength,I=[],M=[],P=[],R=[],F=[],B=o.layoutVertexArray.length;for(const W of E){if(W.length===0)continue;W!==E[0]&&M.push(I.length/2);const G=o.lineSegments.prepareSegment(W.length,o.layoutVertexArray,o.lineIndexArray),X=G.vertexLength;u&&F.push(o.layoutVertexArray.length-B),w(W[0],P,R),o.layoutVertexArray.emplaceBack(W[0].x,W[0].y),o.lineIndexArray.emplaceBack(X+W.length-1,X),I.push(W[0].x),I.push(W[0].y);for(let ee=1;ee<W.length;ee++)w(W[ee],P,R),o.layoutVertexArray.emplaceBack(W[ee].x,W[ee].y),o.lineIndexArray.emplaceBack(X+ee-1,X+ee),I.push(W[ee].x),I.push(W[ee].y);G.vertexLength+=W.length,G.primitiveLength+=W.length}const Z=hy(I,M);for(let W=0;W<Z.length;W+=3)o.indexArray.emplaceBack(C+Z[W],C+Z[W+1],C+Z[W+2]);if(u&&this.elevationMode==="hd-road-base"){const W=u.elevation.isTunnel(),G=u.elevation.safeArea,X=this.elevatedStructures.addVertices(P,R);this.elevatedStructures.addTriangles(Z,X,W);const ee=F.length;if(ee>0){for(let ie=0;ie<ee-1;ie++)this.elevatedStructures.addRenderableRing(u.index,F[ie]+X,F[ie+1]-F[ie],W,G);this.elevatedStructures.addRenderableRing(u.index,F[ee-1]+X,P.length-F[ee-1],W,G)}}v.vertexLength+=A,v.primitiveLength+=Z.length/3}return[p,h]}getElevationFeature(r,o){if(!o)return;const u=+r.properties[af];return u!=null?o.find(p=>p.id===u):void 0}}let WI,ZI,YI,XI;zt(ZS,"FillBucket",{omit:["layers","patternFeatures"]}),zt(WS,"FillBufferData"),zt(ml,"ElevatedStructures");class YS{constructor(r,o,u,p){if(this.triangleCount=o.length/3,this.min=new bt(0,0),this.max=new bt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||r.length===0)return;const[h,_]=[r[0].clone(),r[0].clone()];for(let C=1;C<r.length;++C){const I=r[C];h.x=Math.min(h.x,I.x),h.y=Math.min(h.y,I.y),_.x=Math.max(_.x,I.x),_.y=Math.max(_.y,I.y)}if(p){const C=Math.ceil(Math.max(_.x-h.x,_.y-h.y)/p);u=Math.max(u,C)}if(u===0)return;this.min=h,this.max=_;const w=this.max.sub(this.min);w.x=Math.max(w.x,1),w.y=Math.max(w.y,1);const E=Math.max(w.x,w.y)/u;this.cellsX=Math.max(1,Math.ceil(w.x/E)),this.cellsY=Math.max(1,Math.ceil(w.y/E)),this.xScale=1/E,this.yScale=1/E;const A=[];for(let C=0;C<this.triangleCount;C++){const I=r[o[3*C+0]].sub(this.min),M=r[o[3*C+1]].sub(this.min),P=r[o[3*C+2]].sub(this.min),R=ac(Math.floor(Math.min(I.x,M.x,P.x)),this.xScale,this.cellsX),F=ac(Math.floor(Math.max(I.x,M.x,P.x)),this.xScale,this.cellsX),B=ac(Math.floor(Math.min(I.y,M.y,P.y)),this.yScale,this.cellsY),Z=ac(Math.floor(Math.max(I.y,M.y,P.y)),this.yScale,this.cellsY),W=new bt(0,0),G=new bt(0,0),X=new bt(0,0),ee=new bt(0,0);for(let ie=B;ie<=Z;++ie){W.y=G.y=ie*E,X.y=ee.y=(ie+1)*E;for(let ge=R;ge<=F;++ge)W.x=X.x=ge*E,G.x=ee.x=(ge+1)*E,(Ke(I,M,P,W,G,ee)||Ke(I,M,P,W,ee,X))&&A.push({cellIdx:ie*this.cellsX+ge,triIdx:C})}}if(A.length===0)return;A.sort((C,I)=>C.cellIdx-I.cellIdx||C.triIdx-I.triIdx);let v=0;for(;v<A.length;){const C=A[v].cellIdx,I={start:this.payload.length,len:0};for(;v<A.length&&A[v].cellIdx===C;)++I.len,this.payload.push(A[v++].triIdx);this.cells[C]=I}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(r,o){if(this.triangleCount===0||this.cells.length===0||r.x>this.max.x||this.min.x>r.x||r.y>this.max.y||this.min.y>r.y)return;const u=ac(r.x-this.min.x,this.xScale,this.cellsX),p=ac(r.y-this.min.y,this.yScale,this.cellsY),h=this.cells[p*this.cellsX+u];if(h){this._lazyInitLookup();for(let _=0;_<h.len;_++){const w=this.payload[h.start+_],E=Math.floor(w/8),A=1<<w%8;if(!(this.lookup[E]&A)&&(this.lookup[E]|=A,o.push(w),o.length===this.triangleCount))return}}}query(r,o,u){if(this.triangleCount===0||this.cells.length===0||r.x>this.max.x||this.min.x>o.x||r.y>this.max.y||this.min.y>o.y)return;this._lazyInitLookup();const p=ac(r.x-this.min.x,this.xScale,this.cellsX),h=ac(o.x-this.min.x,this.xScale,this.cellsX),_=ac(r.y-this.min.y,this.yScale,this.cellsY),w=ac(o.y-this.min.y,this.yScale,this.cellsY);for(let E=_;E<=w;E++)for(let A=p;A<=h;A++){const v=this.cells[E*this.cellsX+A];if(v)for(let C=0;C<v.len;C++){const I=this.payload[v.start+C],M=Math.floor(I/8),P=1<<I%8;if(!(this.lookup[M]&P)&&(this.lookup[M]|=P,u.push(I),u.length===this.triangleCount))return}}}}function ac(c,r,o){return Math.max(0,Math.min(o-1,Math.floor(c*r)))}zt(YS,"TriangleGridIndex");class KI{constructor(r){this.zoom=r.zoom,this.layers=r.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=r.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.footprints=[]}updateFootprints(r,o){for(const u of this.footprints)o.push({footprint:u,id:r})}populate(r,o,u,p){const h=[];for(const{feature:_,id:w,index:E,sourceLayerIndex:A}of r){const v=this.layers[0]._featureFilter.needGeometry,C=z(_,v);if(!this.layers[0]._featureFilter.filter(new kn(this.zoom),C,u))continue;const I={id:w,properties:_.properties,type:_.type,sourceLayerIndex:A,index:E,geometry:v?C.geometry:L(_,u,p),patterns:{}};h.push(I)}for(const _ of h){const{geometry:w,index:E,sourceLayerIndex:A}=_;this.addFeature(_,w,E,u,{},o.availableImages,o.brightness),o.featureIndex.insert(r[E].feature,w,E,A,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(r){}update(r,o,u,p,h,_,w){}destroy(){}addFeature(r,o,u,p,h,_=[],w){for(const E of i1(o,2)){const A=[],v=[],C=[],I=new bt(1/0,1/0),M=new bt(-1/0,-1/0);for(const F of E)if(F.length!==0){F!==E[0]&&C.push(v.length/2);for(let B=0;B<F.length;B++)v.push(F[B].x),v.push(F[B].y),A.push(F[B]),I.x=Math.min(I.x,F[B].x),I.y=Math.min(I.y,F[B].y),M.x=Math.max(M.x,F[B].x),M.y=Math.max(M.y,F[B].y)}const P=hy(v,C),R=new YS(A,P,8,256);this.footprints.push({vertices:A,indices:P,grid:R,min:I,max:M})}}}zt(KI,"ClipBucket",{omit:["layers"]});const r8=nn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),n8=nn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),i8=nn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),s8=nn([{name:"a_join_normal_inside",components:3,type:"Int16"}]),o8=nn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),a8=nn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:l8}=r8;class cf extends bt{constructor(r,o,u){super(r,o),this.z=u}}class JI extends cf{constructor(r,o,u,p){super(r,o,u),this.w=p}}function o1(c,r,o,u){const p=[],h=u===0?(_,w,E,A,v,C)=>{_.push(new bt(C,E+(C-w)/(A-w)*(v-E)))}:(_,w,E,A,v,C)=>{_.push(new bt(w+(C-E)/(v-E)*(A-w),C))};for(const _ of c){const w=[];for(const E of _){if(E.length<=2)continue;const A=[];for(let I=0;I<E.length-1;I++){const M=E[I].x,P=E[I].y,R=E[I+1].x,F=E[I+1].y,B=u===0?M:P,Z=u===0?R:F;B<r?Z>r&&h(A,M,P,R,F,r):B>o?Z<o&&h(A,M,P,R,F,o):A.push(E[I]),Z<r&&B>=r&&h(A,M,P,R,F,r),Z>o&&B<=o&&h(A,M,P,R,F,o)}let v=E[E.length-1];const C=u===0?v.x:v.y;C>=r&&C<=o&&A.push(v),A.length&&(v=A[A.length-1],A[0].x===v.x&&A[0].y===v.y||A.push(A[0]),w.push(A))}w.length&&p.push(w)}return p}function QI(c,r,o,u){const p=o==="x"?"y":"x",h=(u-c[o])/(r[o]-c[o]);c[p]=c[p]+(r[p]-c[p])*h,c[o]=u,c.hasOwnProperty("z")&&(c.z=ur(c.z,r.z,h)),c.hasOwnProperty("w")&&(c.w=ur(c.w,r.w,h))}function ek(c,r,o,u){const p=o,h=u;for(const _ of["x","y"]){let w=c,E=r;w[_]>=E[_]&&(w=r,E=c),w[_]<p&&E[_]>p&&QI(w,E,_,p),w[_]<h&&E[_]>h&&QI(E,w,_,h)}}const a1=Number.MAX_SAFE_INTEGER;function tk(c,r,o,u){return c.order<r||c.order===a1||!(c.clipMask&o)||function(p,h){return h.length!==0&&h.find(_=>_===p)===void 0}(u,c.clipScope)}function l1(c,r){return c.x-r.x||c.y-r.y}function rk(c,r){return l1(c.min,r.min)===0&&l1(c.max,r.max)===0}function XS(c,r){return!(c.min.x>r.max.x||c.max.x<r.min.x||c.min.y>r.max.y||c.max.y<r.min.y)}function KS(c,r){if(c.length!==r.length)return!1;for(let o=0;o<c.length;o++)if(c[o].sourceId!==r[o].sourceId||!rk(c[o],r[o])||c[o].order!==r[o].order||c[o].clipMask!==r[o].clipMask||!Vi(c[o].clipScope,r[o].clipScope))return!1;return!0}function nk(c,r,o){const u=1/Ct,p=1/(1<<o.canonical.z),h=(r.x*u+o.canonical.x)*p+o.wrap,_=(r.y*u+o.canonical.y)*p;return{min:new bt((c.x*u+o.canonical.x)*p+o.wrap,(c.y*u+o.canonical.y)*p),max:new bt(h,_)}}function c8(c,r,o){const u=1<<o.canonical.z,p=((r.x-o.wrap)*u-o.canonical.x)*Ct,h=(r.y*u-o.canonical.y)*Ct;return{min:new bt(((c.x-o.wrap)*u-o.canonical.x)*Ct,(c.y*u-o.canonical.y)*Ct),max:new bt(p,h)}}function ik(c,r,o,u,p,h,_){const w=c.indices,E=c.vertices,A=[];for(let v=u;v<u+p;v+=3){const C=r[o[v+0]+h],I=r[o[v+1]+h],M=r[o[v+2]+h],P=Math.min(C.x,I.x,M.x),R=Math.max(C.x,I.x,M.x),F=Math.min(C.y,I.y,M.y),B=Math.max(C.y,I.y,M.y);A.length=0,c.grid.query(new bt(P,F),new bt(R,B),A);for(let Z=0;Z<A.length;Z++){const W=A[Z];if(Ke(E[w[3*W+0]],E[w[3*W+1]],E[w[3*W+2]],C,I,M,_))return!0}}return!1}function sk(c,r,o,u){if(!c||!o)return!1;let p=c.vertices;if(!r.canonical.equals(u.canonical)||r.wrap!==u.wrap){if(o.vertices.length<c.vertices.length)return sk(o,u,c,r);const h=r.canonical,_=u.canonical,w=Math.pow(2,_.z-h.z);p=c.vertices.map(E=>new bt((E.x+h.x*Ct)*w-_.x*Ct,(E.y+h.y*Ct)*w-_.y*Ct))}return ik(o,p,c.indices,0,c.indices.length,0,0)}function ok(c,r,o,u){const p=Math.pow(2,u.z-o.z);return new bt((c+o.x*Ct)*p-u.x*Ct,(r+o.y*Ct)*p-u.y*Ct)}function ak(c,r){const o=[];r.grid.queryPoint(c,o);const u=r.indices,p=r.vertices;for(let h=0;h<o.length;h++){const _=o[h];if(we([p[u[3*_+0]],p[u[3*_+1]],p[u[3*_+2]]],c))return!0}return!1}const JS=[new bt(0,0),new bt(Ct,0),new bt(Ct,Ct),new bt(0,Ct)];function lk(c,r){const o=[];let u=[];if(!r||c.length<2)return[c];if(c.length===2)return Pe(c[0],c[1],JS)?[c]:[];for(let p=0;p<c.length+2;p++){const h=c[p%c.length],_=c[(p+1)%c.length],w=Pe(p===0?c[c.length-1]:c[(p-1)%c.length],h,JS),E=Pe(h,_,JS),A=w||E;A&&u.push(h),A&&E||u.length>0&&(u.length>1&&o.push(u),u=[])}return u.length>1&&o.push(u),o}const QS=ad.VectorTileFeature.types,u8=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],d8=["fill-extrusion-flood-light-ground-radius"],h8=Math.pow(2,13),f8=Math.pow(2,15)-1,ck=new bt(0,1),ld=2147483648;function gy(c,r,o,u,p,h,_,w){c.emplaceBack((r<<1)+_,(o<<1)+h,(Math.floor(u*h8)<<1)+p,Math.round(w))}function _y(c,r,o){c.emplaceBack(r.x*Ct,r.y*Ct,o?1:0)}function c1(c,r,o,u,p,h){c.emplaceBack(r.x,r.y,(o.x<<1)+u,(o.y<<1)+p,h)}function yy(c,r,o){c.emplaceBack(r.x,r.y,r.z,o[0]*16384,o[1]*16384,o[2]*16384)}class uk{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class dk{constructor(){this.centroidXY=new bt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new bt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new bt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new bt(this.max.x-this.min.x,this.max.y-this.min.y)}}class hk{constructor(){this.acc=new bt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(r,o){r.min.x===Number.MAX_VALUE&&(r.min.x=r.max.x=o.x,r.min.y=r.max.y=o.y)}appendEdge(r,o,u){this.accCount++,this.acc._add(o);let p=!!this.borders;o.x<r.min.x?(r.min.x=o.x,p=!0):o.x>r.max.x&&(r.max.x=o.x,p=!0),o.y<r.min.y?(r.min.y=o.y,p=!0):o.y>r.max.y&&(r.max.y=o.y,p=!0),((o.x===0||o.x===Ct)&&o.x===u.x)!=((o.y===0||o.y===Ct)&&o.y===u.y)&&this.processBorderOverlap(o,u),p&&this.checkBorderIntersection(o,u)}checkBorderIntersection(r,o){o.x<0!=r.x<0&&this.addBorderIntersection(0,ur(o.y,r.y,(0-o.x)/(r.x-o.x))),o.x>Ct!=r.x>Ct&&this.addBorderIntersection(1,ur(o.y,r.y,(Ct-o.x)/(r.x-o.x))),o.y<0!=r.y<0&&this.addBorderIntersection(2,ur(o.x,r.x,(0-o.y)/(r.y-o.y))),o.y>Ct!=r.y>Ct&&this.addBorderIntersection(3,ur(o.x,r.x,(Ct-o.y)/(r.y-o.y)))}addBorderIntersection(r,o){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[r];o<u[0]&&(u[0]=o),o>u[1]&&(u[1]=o)}processBorderOverlap(r,o){if(r.x===o.x){if(r.y===o.y)return;const u=r.x===0?0:1;this.addBorderIntersection(u,o.y),this.addBorderIntersection(u,r.y)}else{const u=r.y===0?2:3;this.addBorderIntersection(u,o.x),this.addBorderIntersection(u,r.x)}}centroid(){return this.accCount===0?new bt(0,0):new bt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((r,o)=>r+ +(o[0]!==Number.MAX_VALUE),0):0}}function fk(c,r){const o=c.add(r)._unit(),u=Bt(c.x*o.x+c.y*o.y,-1,1);var p,h,_;return _=Math.acos(u),Math.min(4,Math.max(-4,Math.tan(_)))/4*f8*((p=c).x*(h=r).y-p.y*h.x<0?-1:1)}const p8=[c=>c.x<0,c=>c.x>Ct,c=>c.y<0,c=>c.y>Ct];function m8(c,r,o,u){const p=[4];if(u===0)return p;o._mult(u);const h=c.sub(o),_=r.sub(o),w=[c,r,h,_];for(let E=0;E<4;E++)for(const A of w)if(p8[E](A)){p.push(E);break}return p}class pk{constructor(r){this.vertexArray=new Fo,this.indexArray=new ls,this.programConfigurations=new ic(r.layers,{zoom:r.zoom,lut:r.lut},o=>d8.includes(o)),this._segments=new Hn,this.hiddenByLandmarkVertexArray=new ey,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Hn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(r,o,u,p=!1){const h=r.length;if(h>2){let _=Math.max(0,this._segments.get().length-1);const w=this._segments._prepareSegment(4*h,this.vertexArray.length,2*this._segmentToGroundQuads[_].length);let E;_!==this._segments.get().length-1&&(_++,this._segmentToGroundQuads[_]=[],this._segmentToRegionTriCounts[_]=[0,0,0,0,0]);{const A=r[0],v=r[1];E=fk(A.sub(r[h-1])._perp()._unit(),v.sub(A)._perp()._unit())}for(let A=0;A<h;A++){const v=A===h-1?0:A+1,C=r[A],I=r[v],M=r[v===h-1?0:v+1],P=I.sub(C)._perp()._unit(),R=fk(P,M.sub(I)._perp()._unit()),F=E,B=R;if(eT(C,I,o)||p&&_k(C,o)&&_k(I,o)){E=R;continue}const Z=w.vertexLength;c1(this.vertexArray,C,I,1,1,F),c1(this.vertexArray,C,I,1,0,F),c1(this.vertexArray,C,I,0,1,B),c1(this.vertexArray,C,I,0,0,B),w.vertexLength+=4;const W=m8(C,I,P,u);for(const G of W)this._segmentToGroundQuads[_].push({id:Z,region:G}),this._segmentToRegionTriCounts[_][G]+=2,w.primitiveLength+=2;E=R}}}prepareBorderSegments(){if(!this.hasData())return;const r=this._segments.get(),o=r.length;for(let u=0;u<o;u++)this._segmentToGroundQuads[u].sort((p,h)=>p.region-h.region);for(let u=0;u<o;u++){const p=this._segmentToGroundQuads[u],h=r[u],_=this._segmentToRegionTriCounts[u];_.reduce((E,A)=>E+A,0);let w=0;for(let E=0;E<=4;E++){const A=_[E];if(A!==0){let v=this.regionSegments[E];v||(v=this.regionSegments[E]=new Hn);const C={vertexOffset:h.vertexOffset,primitiveOffset:h.primitiveOffset+w,vertexLength:h.vertexLength,primitiveLength:A};v.get().push(C)}w+=A}for(let E=0;E<p.length;E++){const A=p[E].id;this.indexArray.emplaceBack(A,A+1,A+3),this.indexArray.emplaceBack(A,A+3,A+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(r,o,u,p,h,_){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,r,o,u,p,h,_)}upload(r){this.hasData()&&(this.vertexBuffer=r.createVertexBuffer(this.vertexArray,n8.members),this.indexBuffer=r.createIndexBuffer(this.indexArray))}uploadPaintProperties(r){this.hasData()&&this.programConfigurations.upload(r)}update(r,o,u,p,h,_,w){this.hasData()&&this.programConfigurations.updatePaintArrays(r,o,u,p,h,_,w)}updateHiddenByLandmark(r){if(!this.hasData())return;const o=r.groundVertexCount+r.groundVertexArrayOffset;if(r.groundVertexCount===0)return;const u=r.flags&ld?1:0;for(let p=r.groundVertexArrayOffset;p<o;++p)this.hiddenByLandmarkVertexArray.emplace(p,u);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(r){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=r.createVertexBuffer(this.hiddenByLandmarkVertexArray,o8.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let r=0;r<=4;r++){const o=this.regionSegments[r];o&&o.destroy()}}}}class u1{constructor(r){this.zoom=r.zoom,this.canonical=r.canonical,this.overscaling=r.overscaling,this.layers=r.layers,this.pixelRatio=r.pixelRatio,this.layerIds=this.layers.map(o=>o.fqid),this.index=r.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=r.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new ls,this.footprintVertices=new ul,this.footprintSegments=[],this.layoutVertexArray=new dl,this.centroidVertexArray=new Jh,this.wallVertexArray=new W0,this.indexArray=new ls,this.programConfigurations=new ic(r.layers,{zoom:r.zoom,lut:r.lut},o=>u8.includes(o)),this.segments=new Hn,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.groundEffect=new pk(r),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(r,o){}populate(r,o,u,p){this.features=[],this.hasPattern=VS("fill-extrusion",this.layers,this.pixelRatio,o),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=g(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:h,id:_,index:w,sourceLayerIndex:E}of r){const A=this.layers[0]._featureFilter.needGeometry,v=z(h,A);if(!this.layers[0]._featureFilter.filter(new kn(this.zoom),v,u))continue;const C={id:_,sourceLayerIndex:E,index:w,geometry:A?v.geometry:L(h,u,p),properties:h.properties,type:h.type,patterns:{}},I=this.layoutVertexArray.length,M=QS[C.type]==="Polygon";if(this.hasPattern)this.features.push(US("fill-extrusion",this.layers,C,this.zoom,this.pixelRatio,o));else if(this.wallMode)for(const P of C.geometry)for(const R of lk(P,M))this.addFeature(C,[R],w,u,{},o.availableImages,p,o.brightness);else this.addFeature(C,C.geometry,w,u,{},o.availableImages,p,o.brightness);o.featureIndex.insert(h,C.geometry,w,E,this.index,I)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(r,o,u,p,h,_){for(const w of this.features){const E=QS[w.type]==="Polygon",{geometry:A}=w;if(this.wallMode)for(const v of A)for(const C of lk(v,E))this.addFeature(w,[C],w.index,o,u,p,h,_);else this.addFeature(w,A,w.index,o,u,p,h,_)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(r,o,u,p,h,_,w){this.programConfigurations.updatePaintArrays(r,o,h,u,p,_,w),this.groundEffect.update(r,o,h,u,p,_,w)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,l8),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.wallVertexBuffer=r.createVertexBuffer(this.wallVertexArray,s8.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=r.createVertexBuffer(this.layoutVertexExtArray,a8.members,!0)),this.groundEffect.upload(r)),this.groundEffect.uploadPaintProperties(r),this.programConfigurations.upload(r),this.uploaded=!0}uploadCentroid(r){this.groundEffect.uploadHiddenByLandmark(r),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,i8.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,o,u,p,h,_,w,E){const A=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(r,{})/this.tileToMeter,v=[new bt(0,0),new bt(Ct,Ct)],C=w.projection,I=C.name==="globe",M=this.wallMode||QS[r.type]==="Polygon",P=new hk;P.centroidDataIndex=this.centroidData.length;const R=new dk,F=this.layers[0].paint.get("fill-extrusion-base").evaluate(r,{},p)<=0,B=this.layers[0].paint.get("fill-extrusion-height").evaluate(r,{},p);let Z;if(R.height=B,R.vertexArrayOffset=this.layoutVertexArray.length,R.groundVertexArrayOffset=this.groundEffect.vertexArray.length,I&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Gp),this.wallMode){if(I)return void Kn("Non zero fill-extrusion-line-width is not yet supported on globe.");if(o.length!==1)return;Z=function(pe){const Ce=pe[0].x===pe[pe.length-1].x&&pe[0].y===pe[pe.length-1].y;(function(Et){let _t=0;const lr=Et.length;for(let Dt=0;Dt<lr;Dt++)_t+=(Et[(Dt+1)%lr].x-Et[Dt].x)*(Et[(Dt+1)%lr].y+Et[Dt].y);return _t>=0})(pe)||(pe=pe.reverse());const Me={geometry:[],joinNormals:[],indices:[]},Re=[],ke=[],Oe=[];let Le=pe.length;for(;Le>=2&&pe[Le-1].equals(pe[Le-2]);)Le--;if(Le<(Ce?3:2))return Me;let Ge,Ve,He,gt,ft,Ft=0;for(;Ft<Le-1&&pe[Ft].equals(pe[Ft+1]);)Ft++;Ce&&(Ge=pe[Le-2],ft=pe[Ft].sub(Ge)._unit()._perp());for(let Et=Ft;Et<Le;Et++){if(He=Et===Le-1?Ce?pe[Ft+1]:void 0:pe[Et+1],He&&pe[Et].equals(He))continue;ft&&(gt=ft),Ge&&(Ve=Ge),Ge=pe[Et],ft=He?He.sub(Ge)._unit()._perp():gt,gt=gt||ft;let _t=gt.add(ft);_t.x===0&&_t.y===0||_t._unit();const lr=_t.x*ft.x+_t.y*ft.y,Dt=lr!==0?1/lr:1/0,Zt=gt.x*ft.y-gt.y*ft.x>0;let gr="miter";const jr=2;gr==="miter"&&Dt>jr&&(gr="bevel"),gr==="bevel"&&(Dt>100&&(gr="flipbevel"),Dt<jr&&(gr="miter"));const xr=(Fr,Rr,Ur,en)=>{const Nn=new bt(Fr.x,Fr.y),_r=new bt(Fr.x,Fr.y);Nn.x+=Rr.x*en,Nn.y+=Rr.y*en,_r.x-=Rr.x*Math.max(Ur,1),_r.y-=Rr.y*Math.max(Ur,1),Oe.push(Rr),Re.push(Nn),ke.push(_r)};if(gr==="miter")_t._mult(Dt),xr(Ge,_t,0,0);else if(gr==="flipbevel")_t=ft.mult(-1),xr(Ge,_t,0,0),xr(Ge,_t.mult(-1),0,0);else{const Fr=-Math.sqrt(Dt*Dt-1),Rr=Zt?Fr:0,Ur=Zt?0:Fr;Ve&&xr(Ge,gt,Rr,Ur),He&&xr(Ge,ft,Rr,Ur)}}Me.geometry=[...Re,...ke.reverse(),Re[0]],Me.joinNormals=[...Oe,...Oe.reverse(),Oe[Oe.length-1]];const xt=Me.geometry.length-1;for(let Et=0;Et<xt/2;Et++)if(Et+1<xt/2){let _t=Et,lr=Et+1,Dt=xt-1-Et,Zt=xt-2-Et;_t=_t===0?xt-1:_t-1,lr=lr===0?xt-1:lr-1,Dt=Dt===0?xt-1:Dt-1,Zt=Zt===0?xt-1:Zt-1,Me.indices.push(Dt),Me.indices.push(lr),Me.indices.push(_t),Me.indices.push(Dt),Me.indices.push(Zt),Me.indices.push(lr)}return Me}(o[0]),o=[Z.geometry]}const W=(pe,Ce)=>pe<(Ce.length-1)/2||pe===Ce.length-1,G=this.wallMode?[o]:i1(o,500);for(let pe=G.length-1;pe>=0;pe--){const Ce=G[pe];(Ce.length===0||(X=Ce[0]).every(_e=>_e.x<=0)||X.every(_e=>_e.x>=Ct)||X.every(_e=>_e.y<=0)||X.every(_e=>_e.y>=Ct))&&G.splice(pe,1)}var X;let ee;if(I)ee=bk(G,v,p);else{ee=[];for(const pe of G)ee.push({polygon:pe,bounds:v})}const ie=M?this.edgeRadius:0,ge=ie>0&&this.zoom<17,fe=(pe,Ce)=>{if(pe.length===0)return!1;const _e=pe[pe.length-1];return Ce.x===_e.x&&Ce.y===_e.y};for(const{polygon:pe,bounds:Ce}of ee){let _e=0,Me=0;for(const Le of pe)M&&!Le[0].equals(Le[Le.length-1])&&Le.push(Le[0]),Me+=M?Le.length-1:Le.length;const Re=this.segments.prepareSegment((M?5:4)*Me,this.layoutVertexArray,this.indexArray);R.footprintSegIdx<0&&(R.footprintSegIdx=this.footprintSegments.length),R.polygonSegIdx<0&&(R.polygonSegIdx=this.polygonSegments.length);const ke={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Oe=new uk;if(Oe.vertexOffset=this.footprintVertices.length,Oe.indexOffset=3*this.footprintIndices.length,Oe.ringIndices=[],M){const Le=[],Ge=[];_e=Re.vertexLength;for(let He=0;He<pe.length;He++){const gt=pe[He];gt.length&&He!==0&&Ge.push(Le.length/2);const ft=[];let Ft,xt;Ft=gt[1].sub(gt[0])._perp()._unit(),Oe.ringIndices.push(gt.length-1);for(let Et=1;Et<gt.length;Et++){const _t=gt[Et],lr=gt[Et===gt.length-1?1:Et+1],Dt=_t.clone();if(ie){xt=lr.sub(_t)._perp()._unit();const Zt=Ft.add(xt)._unit(),gr=ie*Math.min(4,1/(Ft.x*Zt.x+Ft.y*Zt.y));Dt.x+=gr*Zt.x,Dt.y+=gr*Zt.y,Dt.x=Math.round(Dt.x),Dt.y=Math.round(Dt.y),Ft=xt}if(!F||ie!==0&&!ge||fe(ft,Dt)||ft.push(Dt),gy(this.layoutVertexArray,Dt.x,Dt.y,0,0,1,1,0),this.wallMode){const Zt=W(Et,gt);_y(this.wallVertexArray,Z.joinNormals[Et],!Zt)}Re.vertexLength++,this.footprintVertices.emplaceBack(_t.x,_t.y),Le.push(_t.x,_t.y),I&&yy(this.layoutVertexExtArray,C.projectTilePoint(Dt.x,Dt.y,p),C.upVector(p,Dt.x,Dt.y))}F&&(ie===0||ge)&&(ft.length!==0&&fe(ft,ft[0])&&ft.pop(),this.groundEffect.addData(ft,Ce,A))}const Ve=this.wallMode?Z.indices:hy(Le,Ge);for(let He=0;He<Ve.length;He+=3)this.footprintIndices.emplaceBack(Oe.vertexOffset+Ve[He+0],Oe.vertexOffset+Ve[He+1],Oe.vertexOffset+Ve[He+2]),this.indexArray.emplaceBack(_e+Ve[He],_e+Ve[He+2],_e+Ve[He+1]),Re.primitiveLength++;Oe.indexCount+=Ve.length,Oe.vertexCount+=this.footprintVertices.length-Oe.vertexOffset}for(let Le=0;Le<pe.length;Le++){const Ge=pe[Le];P.startRing(R,Ge[0]);let Ve=Ge.length>4&&yk(Ge[Ge.length-2],Ge[0],Ge[1]),He=ie?g8(Ge[Ge.length-2],Ge[0],Ge[1],ie):0;const gt=[];let ft,Ft,xt;Ft=Ge[1].sub(Ge[0])._perp()._unit();let Et=!0;for(let _t=1,lr=0;_t<Ge.length;_t++){let Dt=Ge[_t-1],Zt=Ge[_t];const gr=Ge[_t===Ge.length-1?1:_t+1];if(P.appendEdge(R,Zt,Dt),eT(Zt,Dt,Ce)){ie&&(Ft=gr.sub(Zt)._perp()._unit(),Et=!Et);continue}const jr=Zt.sub(Dt)._perp(),xr=jr.x/(Math.abs(jr.x)+Math.abs(jr.y)),Fr=jr.y>0?1:0,Rr=Dt.dist(Zt);if(lr+Rr>32768&&(lr=0),ie){xt=gr.sub(Zt)._perp()._unit();let _r=gk(Dt,Zt,gr,mk(Ft,xt),ie);isNaN(_r)&&(_r=0);const Wr=Zt.sub(Dt)._unit();Dt=Dt.add(Wr.mult(He))._round(),Zt=Zt.add(Wr.mult(-_r))._round(),He=_r,Ft=xt,F&&this.zoom>=17&&(fe(gt,Dt)||gt.push(Dt),fe(gt,Zt)||gt.push(Zt))}const Ur=Re.vertexLength,en=Ge.length>4&&yk(Dt,Zt,gr);let Nn=xk(lr,Ve,Et);if(gy(this.layoutVertexArray,Dt.x,Dt.y,xr,Fr,0,0,Nn),gy(this.layoutVertexArray,Dt.x,Dt.y,xr,Fr,0,1,Nn),this.wallMode){const _r=W(_t-1,Ge),Wr=Z.joinNormals[_t-1];_y(this.wallVertexArray,Wr,_r),_y(this.wallVertexArray,Wr,_r)}if(lr+=Rr,Nn=xk(lr,en,!Et),Ve=en,gy(this.layoutVertexArray,Zt.x,Zt.y,xr,Fr,0,0,Nn),gy(this.layoutVertexArray,Zt.x,Zt.y,xr,Fr,0,1,Nn),this.wallMode){const _r=W(_t,Ge),Wr=Z.joinNormals[_t];_y(this.wallVertexArray,Wr,_r),_y(this.wallVertexArray,Wr,_r)}if(Re.vertexLength+=4,this.indexArray.emplaceBack(Ur+0,Ur+1,Ur+2),this.indexArray.emplaceBack(Ur+1,Ur+3,Ur+2),Re.primitiveLength+=2,ie){const _r=_e+(_t===1?Ge.length-2:_t-2),Wr=_t===1?_e:_r+1;if(this.indexArray.emplaceBack(Ur+1,_r,Ur+3),this.indexArray.emplaceBack(_r,Wr,Ur+3),Re.primitiveLength+=2,ft===void 0&&(ft=Ur),!eT(gr,Ge[_t],Ce)){const $n=_t===Ge.length-1?ft:Re.vertexLength;this.indexArray.emplaceBack(Ur+2,Ur+3,$n),this.indexArray.emplaceBack(Ur+3,$n+1,$n),this.indexArray.emplaceBack(Ur+3,Wr,$n+1),Re.primitiveLength+=3}Et=!Et}if(I){const _r=this.layoutVertexExtArray,Wr=C.projectTilePoint(Dt.x,Dt.y,p),$n=C.projectTilePoint(Zt.x,Zt.y,p),Qn=C.upVector(p,Dt.x,Dt.y),si=C.upVector(p,Zt.x,Zt.y);yy(_r,Wr,Qn),yy(_r,Wr,Qn),yy(_r,$n,si),yy(_r,$n,si)}}M&&(_e+=Ge.length-1),F&&ie&&this.zoom>=17&&(gt.length!==0&&fe(gt,gt[0])&&gt.pop(),this.groundEffect.addData(gt,Ce,A,ie>0))}this.footprintSegments.push(Oe),ke.triangleCount=this.indexArray.length-ke.triangleArrayOffset,this.polygonSegments.push(ke),++R.footprintSegLen,++R.polygonSegLen}if(R.vertexCount=this.layoutVertexArray.length-R.vertexArrayOffset,R.groundVertexCount=this.groundEffect.vertexArray.length-R.groundVertexArrayOffset,R.vertexCount!==0){if(R.centroidXY=P.borders?ck:this.encodeCentroid(P,R),this.centroidData.push(R),P.borders){this.featuresOnBorder.push(P);const pe=this.featuresOnBorder.length-1;for(let Ce=0;Ce<P.borders.length;Ce++)P.borders[Ce][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Ce].push(pe)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,h,_,p,E),this.groundEffect.addPaintPropertiesData(r,u,h,_,p,E),this.maxHeight=Math.max(this.maxHeight,B)}}sortBorders(){for(let r=0;r<this.borderFeatureIndices.length;r++)this.borderFeatureIndices[r].sort((o,u)=>this.featuresOnBorder[o].borders[r][0]-this.featuresOnBorder[u].borders[r][0])}splitToSubtiles(){const r=[];for(let w=0;w<this.centroidData.length;w++){const E=this.centroidData[w],A=+(E.min.y+E.max.y>Ct),v=2*A+(+(E.min.x+E.max.x>Ct)^A);for(let C=0;C<E.polygonSegLen;C++){const I=E.polygonSegIdx+C;r.push({centroidIdx:w,subtile:v,polygonSegmentIdx:I,triangleSegmentIdx:this.polygonSegments[I].triangleSegIdx})}}const o=new ls;r.sort((w,E)=>w.triangleSegmentIdx===E.triangleSegmentIdx?w.subtile-E.subtile:w.triangleSegmentIdx-E.triangleSegmentIdx);let u=0,p=0,h=0;for(const w of r){if(w.triangleSegmentIdx!==u)break;h++}const _=r.length;for(;p!==r.length;){u=r[p].triangleSegmentIdx;let w=0,E=p,A=p;for(let v=E;v<h&&r[v].subtile===w;v++)A++;for(;E!==h;){const v=r[E];w=v.subtile;const C=this.centroidData[v.centroidIdx].min.clone(),I=this.centroidData[v.centroidIdx].max.clone(),M={vertexOffset:this.segments.segments[u].vertexOffset,primitiveOffset:o.length,vertexLength:this.segments.segments[u].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let P=E;P<A;P++){const R=r[P],F=this.polygonSegments[R.polygonSegmentIdx],B=this.centroidData[R.centroidIdx].min,Z=this.centroidData[R.centroidIdx].max,W=this.indexArray.uint16;for(let G=F.triangleArrayOffset;G<F.triangleArrayOffset+F.triangleCount;G++)o.emplaceBack(W[3*G],W[3*G+1],W[3*G+2]);M.primitiveLength+=F.triangleCount,C.x=Math.min(C.x,B.x),C.y=Math.min(C.y,B.y),I.x=Math.max(I.x,Z.x),I.y=Math.max(I.y,Z.y)}M.primitiveLength>0&&this.triangleSubSegments.push({segment:M,min:C,max:I}),E=A;for(let P=E;P<h&&r[P].subtile===r[E].subtile;P++)A++}p=h;for(let v=p;v<_&&r[v].triangleSegmentIdx===r[p].triangleSegmentIdx;v++)h++}o._trim(),this.indexArray=o}getVisibleSegments(r,o,u){const p=new Hn;if(this.wallMode){for(const R of this.triangleSubSegments)p.segments.push(R.segment);return p}let h=0,_=0;const w=1<<r.canonical.z;if(o){const R=o.getMinMaxForTile(r);R&&(h=R.min,_=R.max)}_+=this.maxHeight;const E=r.toUnwrapped();let A;const v=[E.canonical.x/w+E.wrap,E.canonical.y/w],C=[(E.canonical.x+1)/w+E.wrap,(E.canonical.y+1)/w],I=(R,F,B)=>[R[0]*(1-B[0])+F[0]*B[0],R[1]*(1-B[1])+F[1]*B[1]],M=[],P=[];for(const R of this.triangleSubSegments){M[0]=R.min.x/Ct,M[1]=R.min.y/Ct,P[0]=R.max.x/Ct,P[1]=R.max.y/Ct;const F=I(v,C,M),B=I(v,C,P);if(new Xt([F[0],F[1],h],[B[0],B[1],_]).intersectsPrecise(u)===0){A&&(p.segments.push(A),A=void 0);continue}const Z=R.segment;A&&A.vertexOffset!==Z.vertexOffset&&(p.segments.push(A),A=void 0),A?(A.vertexLength+=Z.vertexLength,A.primitiveLength+=Z.primitiveLength):A={vertexOffset:Z.vertexOffset,primitiveLength:Z.primitiveLength,vertexLength:Z.vertexLength,primitiveOffset:Z.primitiveOffset,sortKey:void 0,vaos:{}}}return A&&p.segments.push(A),p}encodeCentroid(r,o){const u=r.centroid(),p=o.span(),h=Math.min(7,Math.round(p.x*this.tileToMeter/10)),_=Math.min(7,Math.round(p.y*this.tileToMeter/10));return new bt(Bt(u.x,1,Ct-1)<<3|h,Bt(u.y,1,Ct-1)<<3|_)}encodeBorderCentroid(r){if(!r.borders)return new bt(0,0);const o=r.borders,u=Number.MAX_VALUE;if(o[0][0]!==u||o[1][0]!==u){const p=o[0][0]!==u?0:1;return new bt(6|(o[0][0]!==u?0:65528),(o[p][0]+o[p][1])/2<<3|6)}{const p=o[2][0]!==u?2:3;return new bt((o[p][0]+o[p][1])/2<<3|6,6|(o[2][0]!==u?0:65528))}}showCentroid(r){const o=this.centroidData[r.centroidDataIndex];o.flags&=ld,o.centroidXY.x=0,o.centroidXY.y=0,this.writeCentroidToBuffer(o)}writeCentroidToBuffer(r){this.groundEffect.updateHiddenByLandmark(r);const o=r.vertexArrayOffset,u=r.vertexCount+r.vertexArrayOffset,p=r.flags&ld?ck:r.centroidXY,h=this.centroidVertexArray.geta_centroid_pos0(o);if(this.centroidVertexArray.geta_centroid_pos1(o)!==p.y||h!==p.x){for(let _=o;_<u;++_)this.centroidVertexArray.emplace(_,p.x,p.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const r of this.centroidData)this.writeCentroidToBuffer(r)}updateReplacement(r,o,u){if(o.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=o.updateTime;const p=o.getReplacementRegionsForTile(r.toUnwrapped());if(KS(this.activeReplacements,p))return;if(this.activeReplacements=p,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const _ of this.centroidData)_.flags&=2147483647;const h=[];for(const _ of this.activeReplacements){if(_.order<u)continue;const w=Math.max(1,Math.pow(2,_.footprintTileId.canonical.z-r.canonical.z));for(const E of this.centroidData)if(!(E.flags&ld||_.min.x>E.max.x||E.min.x>_.max.x||_.min.y>E.max.y||E.min.y>_.max.y))for(let A=0;A<E.footprintSegLen;A++){const v=this.footprintSegments[E.footprintSegIdx+A];if(h.length=0,_8(this.footprintVertices,v.vertexOffset,v.vertexCount,_.footprintTileId.canonical,r.canonical,h),ik(_.footprint,h,this.footprintIndices.uint16,v.indexOffset,v.indexCount,-v.vertexOffset,-w)){E.flags|=ld;break}}}for(const _ of this.centroidData)this.writeCentroidToBuffer(_);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(r,o,u){let p=!1;for(let h=0;h<u.footprintSegLen;h++){const _=this.footprintSegments[u.footprintSegIdx+h];let w=0;for(const E of _.ringIndices){for(let A=w,v=E+w-1;A<E+w;v=A++){const C=this.footprintVertices.int16[2*(A+_.vertexOffset)+0],I=this.footprintVertices.int16[2*(A+_.vertexOffset)+1],M=this.footprintVertices.int16[2*(v+_.vertexOffset)+1];I>o!=M>o&&r<(this.footprintVertices.int16[2*(v+_.vertexOffset)+0]-C)*(o-I)/(M-I)+C&&(p=!p)}w=E}}return p}getHeightAtTileCoord(r,o){let u=Number.NEGATIVE_INFINITY,p=!0;const h=4*(r+Ct)*Ct+(o+Ct);if(this.partLookup.hasOwnProperty(h)){const _=this.partLookup[h];return _?{height:_.height,hidden:!!(_.flags&ld)}:void 0}for(const _ of this.centroidData)r>_.max.x||_.min.x>r||o>_.max.y||_.min.y>o||this.footprintContainsPoint(r,o,_)&&_&&_.height>u&&(u=_.height,this.partLookup[h]=_,p=!!(_.flags&ld));if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:p};this.partLookup[h]=void 0}}function mk(c,r){const o=c.add(r)._unit();return c.x*o.x+c.y*o.y}function g8(c,r,o,u){const p=r.sub(c)._perp()._unit(),h=o.sub(r)._perp()._unit();return gk(c,r,o,mk(p,h),u)}function gk(c,r,o,u,p){const h=Math.sqrt(1-u*u);return Math.min(c.dist(r)/3,r.dist(o)/3,p*h/u)}function eT(c,r,o){return c.x<o[0].x&&r.x<o[0].x||c.x>o[1].x&&r.x>o[1].x||c.y<o[0].y&&r.y<o[0].y||c.y>o[1].y&&r.y>o[1].y}function _k(c,r){return c.x<r[0].x||c.x>r[1].x||c.y<r[0].y||c.y>r[1].y}function yk(c,r,o){if(c.x<0||c.x>=Ct||r.x<0||r.x>=Ct||o.x<0||o.x>=Ct)return!1;const u=o.sub(r),p=u.perp(),h=c.sub(r);return(u.x*h.x+u.y*h.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(h.x*h.x+h.y*h.y))>-.866&&p.x*h.x+p.y*h.y<0}function xk(c,r,o){const u=r?2|c:-3&c;return o?1|u:-2&u}function vk(){const c=Math.PI/32,r=Math.tan(c),o=qc;return o*Math.sqrt(1+2*r*r)-o}function bk(c,r,o){const u=1<<o.z,p=Js(o.x/u),h=Js((o.x+1)/u),_=cs(o.y/u),w=cs((o.y+1)/u);return function(E,A,v,C,I=0,M){const P=[];if(!E.length||!v||!C)return P;const R=(ee,ie)=>{for(const ge of ee)P.push({polygon:ge,bounds:ie})},F=Math.ceil(Math.log2(v)),B=Math.ceil(Math.log2(C)),Z=F-B,W=[];for(let ee=0;ee<Math.abs(Z);ee++)W.push(Z>0?0:1);for(let ee=0;ee<Math.min(F,B);ee++)W.push(0),W.push(1);let G=E;if(G=o1(G,A[0].y-I,A[1].y+I,1),G=o1(G,A[0].x-I,A[1].x+I,0),!G.length)return P;const X=[];for(W.length?X.push({polygons:G,bounds:A,depth:0}):R(G,A);X.length;){const ee=X.pop(),ie=ee.depth,ge=W[ie],fe=ee.bounds[0],pe=ee.bounds[1],Ce=ge===0?fe.x:fe.y,_e=ge===0?pe.x:pe.y,Me=M?M(ge,Ce,_e):.5*(Ce+_e),Re=o1(ee.polygons,Ce-I,Me+I,ge),ke=o1(ee.polygons,Me-I,_e+I,ge);if(Re.length){const Oe=[fe,new bt(ge===0?Me:pe.x,ge===1?Me:pe.y)];W.length>ie+1?X.push({polygons:Re,bounds:Oe,depth:ie+1}):R(Re,Oe)}if(ke.length){const Oe=[new bt(ge===0?Me:fe.x,ge===1?Me:fe.y),pe];W.length>ie+1?X.push({polygons:ke,bounds:Oe,depth:ie+1}):R(ke,Oe)}}return P}(c,r,Math.ceil((h-p)/11.25),Math.ceil((_-w)/11.25),1,(E,A,v)=>{if(E===0)return .5*(A+v);{const C=cs((o.y+A/Ct)/u);return(xs(.5*(cs((o.y+v/Ct)/u)+C))*u-o.y)*Ct}})}function _8(c,r,o,u,p,h){const _=Math.pow(2,u.z-p.z);for(let w=0;w<o;w++){let E=c.int16[2*(w+r)+0],A=c.int16[2*(w+r)+1];E=(E+p.x*Ct)*_-u.x*Ct,A=(A+p.y*Ct)*_-u.y*Ct,h.push(new bt(E,A))}}let wk,Sk;function xy(c,r){return c.x*r.x+c.y*r.y}function Tk(c,r){if(c.length===1){let o=0;const u=r[o++];let p;for(;!p||u.equals(p);)if(p=r[o++],!p)return 1/0;for(;o<r.length;o++){const h=r[o],_=c[0],w=p.sub(u),E=h.sub(u),A=_.sub(u),v=xy(w,w),C=xy(w,E),I=xy(E,E),M=xy(A,w),P=xy(A,E),R=v*I-C*C,F=(I*M-C*P)/R,B=(v*P-C*M)/R,Z=u.z*(1-F-B)+p.z*F+h.z*B;if(isFinite(Z))return Z}return 1/0}{let o=1/0;for(const u of r)o=Math.min(o,u.z);return o}}function Ek(c,r,o,u,p,h,_,w){const E=_*p.getElevationAt(c,r,!0,!0),A=h[0]!==0,v=A?h[1]===0?_*(h[0]/7-450):_*function(C,I,M){const P=Math.floor(I[0]/8),R=Math.floor(I[1]/8),F=10*(I[0]-8*P),B=10*(I[1]-8*R),Z=C.getElevationAt(P,R,!0,!0),W=C.getMeterToDEM(M),G=Math.floor(.5*(F*W-1)),X=Math.floor(.5*(B*W-1)),ee=C.tileCoordToPixel(P,R),ie=2*G+1,ge=2*X+1,fe=function(ke,Oe,Le,Ge,Ve){return[ke.getElevationAtPixel(Oe,Le,!0),ke.getElevationAtPixel(Oe+Ve,Le,!0),ke.getElevationAtPixel(Oe,Le+Ve,!0),ke.getElevationAtPixel(Oe+Ge,Le+Ve,!0)]}(C,ee.x-G,ee.y-X,ie,ge),pe=Math.abs(fe[0]-fe[1]),Ce=Math.abs(fe[2]-fe[3]),_e=Math.abs(fe[0]-fe[2])+Math.abs(fe[1]-fe[3]),Me=Math.min(.25,.5*W*(pe+Ce)/ie),Re=Math.min(.25,.5*W*_e/ge);return Z+Math.max(Me*F,Re*B)}(p,h,w):E;return{base:E+(o===0?-1:o),top:A?Math.max(v+u,E+o+2):E+u}}zt(u1,"FillExtrusionBucket",{omit:["layers","features"]}),zt(dk,"PartData"),zt(uk,"FootprintSegment"),zt(hk,"BorderCentroidData"),zt(pk,"GroundEffect");const y8=nn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),x8=nn([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:v8}=y8,b8=nn([{name:"a_packed",components:3,type:"Float32"}]),{members:w8}=b8,S8=nn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:T8}=S8;class Ck{constructor(r,o){this.width=r,this.height=o,this.nextRow=0,this.image=new od({width:r,height:o}),this.positions={},this.uploaded=!1}getDash(r,o){const u=this.getKey(r,o);return this.positions[u]}trim(){const r=this.width,o=this.height=ra(this.nextRow);this.image.resize({width:r,height:o})}getKey(r,o){return r.join(",")+o}getDashRanges(r,o,u){const p=[];let h=r.length%2==1?-r[r.length-1]*u:0,_=r[0]*u,w=!0;p.push({left:h,right:_,isDash:w,zeroLength:r[0]===0});let E=r[0];for(let A=1;A<r.length;A++){w=!w;const v=r[A];h=E*u,E+=v,_=E*u,p.push({left:h,right:_,isDash:w,zeroLength:v===0})}return p}addRoundDash(r,o,u){const p=o/2;for(let h=-u;h<=u;h++){const _=this.width*(this.nextRow+u+h);let w=0,E=r[w];for(let A=0;A<this.width;A++){A/E.right>1&&(E=r[++w]);const v=Math.abs(A-E.left),C=Math.abs(A-E.right),I=Math.min(v,C);let M;const P=h/u*(p+1);if(E.isDash){const R=p-Math.abs(P);M=Math.sqrt(I*I+R*R)}else M=p-Math.sqrt(I*I+P*P);this.image.data[_+A]=Math.max(0,Math.min(255,M+128))}}}addRegularDash(r,o){for(let E=r.length-1;E>=0;--E){const A=r[E],v=r[E+1];A.zeroLength?r.splice(E,1):v&&v.isDash===A.isDash&&(v.left=A.left,r.splice(E,1))}const u=r[0],p=r[r.length-1];u.isDash===p.isDash&&(u.left=p.left-this.width,p.right=u.right+this.width);const h=this.width*this.nextRow;let _=0,w=r[_];for(let E=0;E<this.width;E++){E/w.right>1&&(w=r[++_]);const A=Math.abs(E-w.left),v=Math.abs(E-w.right),C=Math.min(A,v);this.image.data[h+E]=Math.max(0,Math.min(255,(w.isDash?C:-C)+o+128))}}addDash(r,o){const u=this.getKey(r,o);if(this.positions[u])return this.positions[u];const p=o==="round",h=p?7:0,_=2*h+1;if(this.nextRow+_>this.height)return Kn("LineAtlas out of space"),null;r.length===0&&r.push(1);let w=0;for(let v=0;v<r.length;v++)r[v]<0&&(Kn("Negative value is found in line dasharray, replacing values with 0"),r[v]=0),w+=r[v];if(w!==0){const v=this.width/w,C=this.getDashRanges(r,this.width,v);p?this.addRoundDash(C,v,h):this.addRegularDash(C,o==="square"?.5*v:0)}const E=this.nextRow+h;this.nextRow+=_;const A={tl:[E,h],br:[w,0]};return this.positions[u]=A,A}}zt(Ck,"LineAtlas");const E8=ad.VectorTileFeature.types,C8=Math.cos(Math.PI/180*37.5),M8=Math.cos(Math.PI/180*5);class tT{constructor(r){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.zoom=r.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=r.overscaling,this.pixelRatio=r.pixelRatio,this.layers=r.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=r.index,this.projection=r.projection,this.hasPattern=!1,this.hasZOffset=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(o=>{this.gradients[o.id]={}}),this.layoutVertexArray=new q_,this.layoutVertexArray2=new ca,this.patternVertexArray=new ca,this.indexArray=new ls,this.programConfigurations=new ic(r.layers,{zoom:r.zoom,lut:r.lut}),this.segments=new Hn,this.maxLineLength=0,this.zOffsetVertexArray=new ca,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.tessellationStep=r.tessellationStep?r.tessellationStep:Ct/64}updateFootprints(r,o){}populate(r,o,u,p){this.hasPattern=VS("line",this.layers,this.pixelRatio,o);const h=this.layers[0].layout.get("line-sort-key");this.tileToMeter=g(u);const _=this.layers[0].layout.get("line-z-offset"),w=_.isConstant()&&!_.constantOr(0),E=this.layers[0].layout.get("line-elevation-reference");this.hasZOffset=E==="sea"||E==="ground"||!w&&E==="none",this.hasZOffset&&E==="none"&&Kn(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`);const A=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.hasZOffset&&A!==void 0;const v=[];for(const{feature:P,id:R,index:F,sourceLayerIndex:B}of r){const Z=this.layers[0]._featureFilter.needGeometry,W=z(P,Z);if(!this.layers[0]._featureFilter.filter(new kn(this.zoom),W,u))continue;const G=h?h.evaluate(W,{},u):void 0,X={id:R,properties:P.properties,type:P.type,sourceLayerIndex:B,index:F,geometry:Z?W.geometry:L(P,u,p),patterns:{},sortKey:G};v.push(X)}h&&v.sort((P,R)=>P.sortKey-R.sortKey);const{lineAtlas:C,featureIndex:I}=o,M=this.addConstantDashes(C);for(const P of v){const{geometry:R,index:F,sourceLayerIndex:B}=P;if(M&&this.addFeatureDashes(P,C),this.hasPattern){const Z=US("line",this.layers,P,this.zoom,this.pixelRatio,o);this.patternFeatures.push(Z)}else this.addFeature(P,R,F,u,C.positions,o.availableImages,o.brightness);I.insert(r[F].feature,R,F,B,this.index)}}addConstantDashes(r){let o=!1;for(const u of this.layers){const p=u.paint.get("line-dasharray").value,h=u.layout.get("line-cap").value;if(p.kind!=="constant"||h.kind!=="constant")o=!0;else{const _=h.value,w=p.value;if(!w)continue;r.addDash(w,_)}}return o}addFeatureDashes(r,o){const u=this.zoom;for(const p of this.layers){const h=p.paint.get("line-dasharray").value,_=p.layout.get("line-cap").value;if(h.kind==="constant"&&_.kind==="constant")continue;let w,E;if(h.kind==="constant"){if(w=h.value,!w)continue}else w=h.evaluate({zoom:u},r);E=_.kind==="constant"?_.value:_.evaluate({zoom:u},r),o.addDash(w,E),r.patterns[p.id]=o.getKey(w,E)}}update(r,o,u,p,h,_,w){this.programConfigurations.updatePaintArrays(r,o,h,u,p,_,w)}addFeatures(r,o,u,p,h,_){for(const w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,o,u,p,_)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,w8)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=r.createVertexBuffer(this.patternVertexArray,T8)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=r.createVertexBuffer(this.zOffsetVertexArray,x8.members,!0)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,v8),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&r.properties.hasOwnProperty("mapbox_clip_start")&&r.properties.hasOwnProperty("mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,o,u,p,h,_,w){const E=this.layers[0].layout,A=E.get("line-join").evaluate(r,{}),v=E.get("line-cap").evaluate(r,{}),C=E.get("line-miter-limit"),I=E.get("line-round-limit");this.lineClips=this.lineFeatureClips(r),this.lineFeature=r,this.zOffsetValue=E.get("line-z-offset").value;const M=this.layers[0].paint.get("line-width").value;M.kind!=="constant"&&M.isLineProgressConstant===!1&&(this.variableWidthValue=M);for(const P of o)this.addLine(P,r,p,A,v,C,I);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,h,_,p,w)}addLine(r,o,u,p,h,_,w){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const E=p==="none";if(this.patternJoinNone=this.hasPattern&&E,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let W=0;W<r.length-1;W++)this.totalDistance+=r[W].dist(r[W+1]);this.totalFeatureLength=this.totalDistance/(this.lineClips.end-this.lineClips.start),this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const A=E8[o.type]==="Polygon";let v=r.length;for(;v>=2&&r[v-1].equals(r[v-2]);)v--;let C=0;for(;C<v-1&&r[C].equals(r[C+1]);)C++;if(v<(A?3:2))return;p==="bevel"&&(_=1.05);const I=this.segments.prepareSegment(10*v,this.layoutVertexArray,this.indexArray);let M,P,R,F,B,Z;this.e1=this.e2=-1,A&&(M=r[v-2],B=r[C].sub(M)._unit()._perp());for(let W=C;W<v;W++){if(R=W===v-1?A?r[C+1]:void 0:r[W+1],R&&r[W].equals(R))continue;B&&(F=B),M&&(P=M),M=r[W],Z=this.evaluateLineProgressFeatures(P?P.dist(M):0),B=R?R.sub(M)._unit()._perp():F,F=F||B;const G=P&&R;let X=G?p:A||E?"butt":h;const ee=F.x*B.x+F.y*B.y;if(E){const Re=function(ke){if(ke.patternJoinNone){const Oe=ke.segmentPoints.length/2,Le=ke.lineSoFar-ke.segmentStart;for(let Ge=0;Ge<Oe;++Ge){const Ve=ke.segmentPoints[2*Ge+1],He=Math.round(ke.segmentPoints[2*Ge])+.5+.25*Ve;ke.patternVertexArray.emplaceBack(He,Le,ke.segmentStart),ke.patternVertexArray.emplaceBack(He,Le,ke.segmentStart)}ke.segmentPoints.length=0}ke.e1=ke.e2=-1};if(G&&ee<M8){this.updateDistance(P,M),this.addCurrentVertex(M,F,1,1,I,Z),Re(this),this.addCurrentVertex(M,B,-1,-1,I,Z);continue}if(P){if(!R){this.updateDistance(P,M),this.addCurrentVertex(M,F,1,1,I,Z),Re(this);continue}X="miter"}}let ie=F.add(B);ie.x===0&&ie.y===0||ie._unit();const ge=ie.x*B.x+ie.y*B.y,fe=ge!==0?1/ge:1/0,pe=2*Math.sqrt(2-2*ge),Ce=ge<C8&&P&&R,_e=F.x*B.y-F.y*B.x>0,Me=this.overscaling<=16?15*Ct/(512*this.overscaling):0;if(G&&X==="round"){if(fe<w)X="miter";else if(fe<=2){const Re=rT(M,-10,Ct+10);X=this.hasZOffset&&(Re||this.hasCrossSlope)?"miter":"fakeround"}}if(X==="miter"&&fe>_&&(X="bevel"),X==="bevel"&&(fe>2&&(X="flipbevel"),fe<_&&(X="miter")),P&&!(X==="miter"&&Ce)&&this.updateDistance(P,M),X==="miter")if(Ce){const Re=M.dist(P);if(Re>2*Me){const Oe=M.sub(M.sub(P)._mult(Me/Re)._round());this.updateDistance(P,Oe),this.addCurrentVertex(Oe,F,0,0,I,Z),P=Oe}this.updateDistance(P,M),ie._mult(fe),this.addCurrentVertex(M,ie,0,0,I,Z);const ke=M.dist(R);if(ke>2*Me){const Oe=M.add(R.sub(M)._mult(Me/ke)._round());this.updateDistance(M,Oe),this.addCurrentVertex(Oe,B,0,0,I,Z),M=Oe}}else ie._mult(fe),this.addCurrentVertex(M,ie,0,0,I,Z);else if(X==="flipbevel"){if(fe>100)ie=B.mult(-1);else{const Re=fe*F.add(B).mag()/F.sub(B).mag();ie._perp()._mult(Re*(_e?-1:1))}this.addCurrentVertex(M,ie,0,0,I,Z),this.addCurrentVertex(M,ie.mult(-1),0,0,I,Z)}else if(X==="bevel"||X==="fakeround"){Z!=null&&P&&this.addCurrentVertex(M,F,-1,-1,I,Z);const Re=M.dist(P)<=2*Me&&X!=="bevel",ke=ie.mult(_e?1:-1);ke._mult(fe);const Oe=B.mult(_e?-1:1),Le=F.mult(_e?-1:1),Ge=this.evaluateLineProgressFeatures(this.distance);if(Z==null&&(this.addHalfVertex(M,ke.x,ke.y,!1,!_e,0,I,Ge),Re||this.addHalfVertex(M,ke.x+2*Le.x,ke.y+2*Le.y,!1,_e,0,I,Ge)),X==="fakeround"){const Ve=Math.round(180*pe/Math.PI/20);this.addHalfVertex(M,Le.x,Le.y,!1,_e,0,I,Ge);for(let He=0;He<Ve;He++){let gt=He/Ve;if(gt!==.5){const Ft=gt-.5;gt+=gt*Ft*(gt-1)*((1.0904+ee*(ee*(3.55645-1.43519*ee)-3.2452))*Ft*Ft+(.848013+ee*(.215638*ee-1.06021)))}const ft=Oe.sub(Le)._mult(gt)._add(Le)._unit();this.addHalfVertex(M,ft.x,ft.y,!1,_e,0,I,Ge)}this.addHalfVertex(M,Oe.x,Oe.y,!1,_e,0,I,Ge)}Re||Z!=null||this.addHalfVertex(M,ke.x+2*Oe.x,ke.y+2*Oe.y,!1,_e,0,I,Ge),Z!=null&&R&&this.addCurrentVertex(M,B,1,1,I,Z)}else X==="butt"?this.addCurrentVertex(M,ie,0,0,I,Z):X==="square"?(P||this.addCurrentVertex(M,ie,-1,-1,I,Z),this.addCurrentVertex(M,ie,0,0,I,Z),P&&this.addCurrentVertex(M,ie,1,1,I,Z)):X==="round"&&(P&&(this.addCurrentVertex(M,F,0,0,I,Z),this.addCurrentVertex(M,F,1,1,I,Z,!0)),R&&(this.addCurrentVertex(M,B,-1,-1,I,Z,!0),this.addCurrentVertex(M,B,0,0,I,Z)))}}addVerticesTo(r,o,u,p,h,_,w,E,A,v){const C=(o.w-r.w)/this.tessellationStep|0;let I=0;const M=this.scaledDistance;if(C>1){this.lineSoFar=r.w;const R=(o.x-r.x)/C,F=(o.y-r.y)/C,B=(o.z-r.z)/C,Z=(o.w-r.w)/C;for(let W=1;W<C;++W){r.x+=R,r.y+=F,r.z+=B,this.lineSoFar+=Z,I+=Z;const G=this.evaluateLineProgressFeatures(this.prevDistance+I);this.scaledDistance=(this.prevDistance+I)/this.totalDistance,this.addHalfVertex(r,u,p,v,!1,w,A,G),this.addHalfVertex(r,h,_,v,!0,-E,A,G)}}this.lineSoFar=o.w,this.scaledDistance=M;const P=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(o,u,p,v,!1,w,A,P),this.addHalfVertex(o,h,_,v,!0,-E,A,P)}evaluateLineProgressFeatures(r){if(!this.variableWidthValue&&!this.hasZOffset)return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+r)/this.totalFeatureLength):Kn(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let o=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(o=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.hasZOffset?this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:o}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:o}:{zOffset:0,variableWidth:o}}addCurrentVertex(r,o,u,p,h,_,w=!1){const E=o.x+o.y*u,A=o.y-o.x*u,v=o.y*p-o.x,C=-o.y-o.x*p;if(_!=null){const I=this.hasZOffset,M=-10,P=Ct+10,R=_.zOffset,F=new JI(r.x,r.y,R,this.lineSoFar),B=!!I&&rT(r,M,P),Z=this.lineSoFar,W=this.distance;if(this.currentVertex)if(B){const G=this.currentVertexIsOutside,X=this.currentVertex,ee=new JI(r.x,r.y,R,this.lineSoFar);if(ek(X,ee,M,P),!rT(ee,M,P)){if(G){this.e1=this.e2=-1,this.distance-=X.dist(F),this.lineSoFar=X.w;const ie=this.evaluateLineProgressFeatures(X.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(X,E,A,w,!1,u,h,ie),this.addHalfVertex(X,v,C,w,!0,-p,h,ie),this.prevDistance=this.distance}this.distance=this.prevDistance+X.dist(ee),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(X,ee,E,A,v,C,u,p,h,w),this.distance=W,this.scaledDistance=this.distance/this.totalDistance}}else{const G=this.currentVertex;if(this.currentVertexIsOutside){ek(G,F,M,P),this.e1=this.e2=-1,this.distance-=G.dist(F),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=G.w;const X=this.evaluateLineProgressFeatures(G.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(G,E,A,w,!1,u,h,X),this.addHalfVertex(G,v,C,w,!0,-p,h,X),this.prevDistance=this.distance,this.distance=W,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(G,F,E,A,v,C,u,p,h,w)}else B||(this.addHalfVertex(r,E,A,w,!1,u,h,_),this.addHalfVertex(r,v,C,w,!0,-p,h,_));this.currentVertex=F,this.currentVertexIsOutside=B,this.lineSoFar=Z}else this.addHalfVertex(r,E,A,w,!1,u,h,_),this.addHalfVertex(r,v,C,w,!0,-p,h,_)}addHalfVertex({x:r,y:o},u,p,h,_,w,E,A){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),_||this.segmentPoints.push(this.lineSoFar-this.segmentStart,w)),this.layoutVertexArray.emplaceBack((r<<1)+(h?1:0),(o<<1)+(_?1:0),Math.round(63*u)+128,Math.round(63*p)+128,1+(w===0?0:w<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const C=ur(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,C)}const v=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,v),E.primitiveLength++),_?this.e2=v:this.e1=v,A!=null&&this.zOffsetVertexArray.emplaceBack(A.zOffset,A.variableWidth,A.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(r,o){this.prevDistance=this.distance,this.distance+=r.dist(o),this.updateScaledDistance()}}function rT(c,r,o){return c.x<r||c.x>o||c.y<r||c.y>o}let Mk,Ak;function Pk(c,r,o){return r*(Ct/(c.tileSize*Math.pow(2,o-c.tileID.overscaledZ)))}zt(tT,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const Ik=(c,r,o)=>(1-o)*c+o*r;function kk(c,r){return 1/Pk(c,1,r.tileZoom)}function Nk(c,r,o,u){return c.translatePosMatrix(u||r.tileID.projMatrix,r,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}const Rk=c=>{const r=[];jk(c)&&r.push("RENDER_LINE_DASH"),c.paint.get("line-gradient")&&r.push("RENDER_LINE_GRADIENT");const o=c.paint.get("line-trim-offset");o[0]===0&&o[1]===0||r.push("RENDER_LINE_TRIM_OFFSET"),c.paint.get("line-border-width").constantOr(1)!==0&&r.push("RENDER_LINE_BORDER");const u=c.layout.get("line-join").constantOr("miter")==="none",p=!!c.paint.get("line-pattern").constantOr(1);return u&&p&&r.push("LINE_JOIN_NONE"),r};function jk(c){const r=c.paint.get("line-dasharray").value;return r.value||r.kind!=="constant"}let nT;const Dk=()=>nT||(nT={layout:Mk||(Mk=new ii({"line-cap":new Ot(We.layout_line["line-cap"]),"line-join":new Ot(We.layout_line["line-join"]),"line-miter-limit":new Tt(We.layout_line["line-miter-limit"]),"line-round-limit":new Tt(We.layout_line["line-round-limit"]),"line-sort-key":new Ot(We.layout_line["line-sort-key"]),"line-z-offset":new Ot(We.layout_line["line-z-offset"]),"line-elevation-reference":new Tt(We.layout_line["line-elevation-reference"]),"line-cross-slope":new Tt(We.layout_line["line-cross-slope"]),visibility:new Tt(We.layout_line.visibility),"line-width-unit":new Tt(We.layout_line["line-width-unit"])})),paint:Ak||(Ak=new ii({"line-opacity":new Ot(We.paint_line["line-opacity"]),"line-color":new Ot(We.paint_line["line-color"]),"line-translate":new Tt(We.paint_line["line-translate"]),"line-translate-anchor":new Tt(We.paint_line["line-translate-anchor"]),"line-width":new Ot(We.paint_line["line-width"]),"line-gap-width":new Ot(We.paint_line["line-gap-width"]),"line-offset":new Ot(We.paint_line["line-offset"]),"line-blur":new Ot(We.paint_line["line-blur"]),"line-dasharray":new Ot(We.paint_line["line-dasharray"]),"line-pattern":new Ot(We.paint_line["line-pattern"]),"line-gradient":new Xu(We.paint_line["line-gradient"]),"line-trim-offset":new Tt(We.paint_line["line-trim-offset"]),"line-trim-fade-range":new Tt(We.paint_line["line-trim-fade-range"]),"line-trim-color":new Tt(We.paint_line["line-trim-color"]),"line-emissive-strength":new Tt(We.paint_line["line-emissive-strength"]),"line-border-width":new Ot(We.paint_line["line-border-width"]),"line-border-color":new Ot(We.paint_line["line-border-color"]),"line-occlusion-opacity":new Tt(We.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Ot({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Ot({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Ot({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Ot({type:"string",default:"default","property-type":"data-driven"})}))},nT);class A8 extends Ot{possiblyEvaluate(r,o){return o=new kn(Math.floor(o.zoom),{now:o.now,fadeDuration:o.fadeDuration,transition:o.transition}),super.possiblyEvaluate(r,o)}evaluate(r,o,u,p){return o=fi({},o,{zoom:Math.floor(o.zoom)}),super.evaluate(r,o,u,p)}}let vy;function Lk(c,r){return r>0?r+2*c:c}const P8=nn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),I8=nn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),k8=nn([{name:"a_projected_pos",components:4,type:"Float32"}],4);nn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const N8=nn([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),R8=nn([{name:"a_texb",components:2,type:"Uint16"}]),j8=nn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),D8=nn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);nn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Ok=nn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),L8=nn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);nn([{name:"triangle",components:3,type:"Uint16"}]),nn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),nn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),nn([{type:"Float32",name:"offsetX"}]),nn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var ws=24;const gl=128;function zk(c,r,o,u,p){if(c.kind==="camera")return c.maxSize;if(c.kind==="composite"){const h=r.possiblyEvaluate(new kn(c.maxZoom),o).evaluate(p,{},o),_=r.possiblyEvaluate(new kn(c.minZoom),o).evaluate(p,{},o);return Math.max(h,_)}return r.possiblyEvaluate(new kn(u)).evaluate(p,{},o)}function iT(c,r){const{expression:o}=r;if(o.kind==="constant")return{kind:"constant",layoutSize:o.evaluate(new kn(c+1))};if(o.kind==="source")return{kind:"source"};{const{zoomStops:u,interpolationType:p}=o;let h=0;for(;h<u.length&&u[h]<=c;)h++;h=Math.max(0,h-1);let _=h;for(;_<u.length&&u[_]<c+1;)_++;_=Math.min(u.length-1,_);const w=u[h],E=u[_];return o.kind==="composite"?{kind:"composite",minZoom:w,maxZoom:E,interpolationType:p}:{kind:"camera",minZoom:w,maxZoom:E,minSize:o.evaluate(new kn(w)),maxSize:o.evaluate(new kn(E)),interpolationType:p}}}function d1(c,{uSize:r,uSizeT:o},{lowerSize:u,upperSize:p}){return c.kind==="source"?u/gl:c.kind==="composite"?ur(u/gl,p/gl,o):r}function im(c,r,o=1){let u=0,p=0;if(c.kind==="constant")p=c.layoutSize*o;else if(c.kind!=="source"){const{interpolationType:h,minZoom:_,maxZoom:w}=c,E=h?Bt(po.interpolationFactor(h,r,_,w),0,1):0;c.kind==="camera"?p=ur(c.minSize,c.maxSize,E)*o:u=E*o}return{uSizeT:u,uSize:p}}var O8=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:gl,evaluateSizeForFeature:d1,evaluateSizeForZoom:im,getRasterizedIconSize:zk,getSizeData:iT});function z8(c,r,o){return c.sections.forEach(u=>{u.text=function(p,h,_){const w=h.layout.get("text-transform").evaluate(_,{});return w==="uppercase"?p=p.toLocaleUpperCase():w==="lowercase"&&(p=p.toLocaleLowerCase()),zo.applyArabicShaping&&(p=zo.applyArabicShaping(p)),p}(u.text,r,o)}),c}const by={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function F8(c){return c==="︶"||c==="﹈"||c==="︸"||c==="﹄"||c==="﹂"||c==="︾"||c==="︼"||c==="︺"||c==="︘"||c==="﹀"||c==="︐"||c==="︓"||c==="︔"||c==="｀"||c==="￣"||c==="︑"||c==="︒"}function B8(c){return c==="︵"||c==="﹇"||c==="︷"||c==="﹃"||c==="﹁"||c==="︽"||c==="︻"||c==="︹"||c==="︗"||c==="︿"}var Fk,sT,Bk,oT={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function V8(){return Fk||(Fk=1,oT.read=function(c,r,o,u,p){var h,_,w=8*p-u-1,E=(1<<w)-1,A=E>>1,v=-7,C=o?p-1:0,I=o?-1:1,M=c[r+C];for(C+=I,h=M&(1<<-v)-1,M>>=-v,v+=w;v>0;h=256*h+c[r+C],C+=I,v-=8);for(_=h&(1<<-v)-1,h>>=-v,v+=u;v>0;_=256*_+c[r+C],C+=I,v-=8);if(h===0)h=1-A;else{if(h===E)return _?NaN:1/0*(M?-1:1);_+=Math.pow(2,u),h-=A}return(M?-1:1)*_*Math.pow(2,h-u)},oT.write=function(c,r,o,u,p,h){var _,w,E,A=8*h-p-1,v=(1<<A)-1,C=v>>1,I=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,M=u?0:h-1,P=u?1:-1,R=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(w=isNaN(r)?1:0,_=v):(_=Math.floor(Math.log(r)/Math.LN2),r*(E=Math.pow(2,-_))<1&&(_--,E*=2),(r+=_+C>=1?I/E:I*Math.pow(2,1-C))*E>=2&&(_++,E/=2),_+C>=v?(w=0,_=v):_+C>=1?(w=(r*E-1)*Math.pow(2,p),_+=C):(w=r*Math.pow(2,C-1)*Math.pow(2,p),_=0));p>=8;c[o+M]=255&w,M+=P,w/=256,p-=8);for(_=_<<p|w,A+=p;A>0;c[o+M]=255&_,M+=P,_/=256,A-=8);c[o+M-P]|=128*R}),oT}function Vk(){if(Bk)return sT;Bk=1,sT=r;var c=V8();function r(G){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(G)?G:new Uint8Array(G||0),this.pos=0,this.type=0,this.length=this.buf.length}r.Varint=0,r.Fixed64=1,r.Bytes=2,r.Fixed32=5;var o=4294967296,u=1/o,p=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function h(G){return G.type===r.Bytes?G.readVarint()+G.pos:G.pos+1}function _(G,X,ee){return ee?4294967296*X+(G>>>0):4294967296*(X>>>0)+(G>>>0)}function w(G,X,ee){var ie=X<=16383?1:X<=2097151?2:X<=268435455?3:Math.floor(Math.log(X)/(7*Math.LN2));ee.realloc(ie);for(var ge=ee.pos-1;ge>=G;ge--)ee.buf[ge+ie]=ee.buf[ge]}function E(G,X){for(var ee=0;ee<G.length;ee++)X.writeVarint(G[ee])}function A(G,X){for(var ee=0;ee<G.length;ee++)X.writeSVarint(G[ee])}function v(G,X){for(var ee=0;ee<G.length;ee++)X.writeFloat(G[ee])}function C(G,X){for(var ee=0;ee<G.length;ee++)X.writeDouble(G[ee])}function I(G,X){for(var ee=0;ee<G.length;ee++)X.writeBoolean(G[ee])}function M(G,X){for(var ee=0;ee<G.length;ee++)X.writeFixed32(G[ee])}function P(G,X){for(var ee=0;ee<G.length;ee++)X.writeSFixed32(G[ee])}function R(G,X){for(var ee=0;ee<G.length;ee++)X.writeFixed64(G[ee])}function F(G,X){for(var ee=0;ee<G.length;ee++)X.writeSFixed64(G[ee])}function B(G,X){return(G[X]|G[X+1]<<8|G[X+2]<<16)+16777216*G[X+3]}function Z(G,X,ee){G[ee]=X,G[ee+1]=X>>>8,G[ee+2]=X>>>16,G[ee+3]=X>>>24}function W(G,X){return(G[X]|G[X+1]<<8|G[X+2]<<16)+(G[X+3]<<24)}return r.prototype={destroy:function(){this.buf=null},readFields:function(G,X,ee){for(ee=ee||this.length;this.pos<ee;){var ie=this.readVarint(),ge=ie>>3,fe=this.pos;this.type=7&ie,G(ge,X,this),this.pos===fe&&this.skip(ie)}return X},readMessage:function(G,X){return this.readFields(G,X,this.readVarint()+this.pos)},readFixed32:function(){var G=B(this.buf,this.pos);return this.pos+=4,G},readSFixed32:function(){var G=W(this.buf,this.pos);return this.pos+=4,G},readFixed64:function(){var G=B(this.buf,this.pos)+B(this.buf,this.pos+4)*o;return this.pos+=8,G},readSFixed64:function(){var G=B(this.buf,this.pos)+W(this.buf,this.pos+4)*o;return this.pos+=8,G},readFloat:function(){var G=c.read(this.buf,this.pos,!0,23,4);return this.pos+=4,G},readDouble:function(){var G=c.read(this.buf,this.pos,!0,52,8);return this.pos+=8,G},readVarint:function(G){var X,ee,ie=this.buf;return X=127&(ee=ie[this.pos++]),ee<128?X:(X|=(127&(ee=ie[this.pos++]))<<7,ee<128?X:(X|=(127&(ee=ie[this.pos++]))<<14,ee<128?X:(X|=(127&(ee=ie[this.pos++]))<<21,ee<128?X:function(ge,fe,pe){var Ce,_e,Me=pe.buf;if(Ce=(112&(_e=Me[pe.pos++]))>>4,_e<128||(Ce|=(127&(_e=Me[pe.pos++]))<<3,_e<128)||(Ce|=(127&(_e=Me[pe.pos++]))<<10,_e<128)||(Ce|=(127&(_e=Me[pe.pos++]))<<17,_e<128)||(Ce|=(127&(_e=Me[pe.pos++]))<<24,_e<128)||(Ce|=(1&(_e=Me[pe.pos++]))<<31,_e<128))return _(ge,Ce,fe);throw new Error("Expected varint not more than 10 bytes")}(X|=(15&(ee=ie[this.pos]))<<28,G,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var G=this.readVarint();return G%2==1?(G+1)/-2:G/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var G=this.readVarint()+this.pos,X=this.pos;return this.pos=G,G-X>=12&&p?function(ee,ie,ge){return p.decode(ee.subarray(ie,ge))}(this.buf,X,G):function(ee,ie,ge){for(var fe="",pe=ie;pe<ge;){var Ce,_e,Me,Re=ee[pe],ke=null,Oe=Re>239?4:Re>223?3:Re>191?2:1;if(pe+Oe>ge)break;Oe===1?Re<128&&(ke=Re):Oe===2?(192&(Ce=ee[pe+1]))==128&&(ke=(31&Re)<<6|63&Ce)<=127&&(ke=null):Oe===3?(_e=ee[pe+2],(192&(Ce=ee[pe+1]))==128&&(192&_e)==128&&((ke=(15&Re)<<12|(63&Ce)<<6|63&_e)<=2047||ke>=55296&&ke<=57343)&&(ke=null)):Oe===4&&(_e=ee[pe+2],Me=ee[pe+3],(192&(Ce=ee[pe+1]))==128&&(192&_e)==128&&(192&Me)==128&&((ke=(15&Re)<<18|(63&Ce)<<12|(63&_e)<<6|63&Me)<=65535||ke>=1114112)&&(ke=null)),ke===null?(ke=65533,Oe=1):ke>65535&&(ke-=65536,fe+=String.fromCharCode(ke>>>10&1023|55296),ke=56320|1023&ke),fe+=String.fromCharCode(ke),pe+=Oe}return fe}(this.buf,X,G)},readBytes:function(){var G=this.readVarint()+this.pos,X=this.buf.subarray(this.pos,G);return this.pos=G,X},readPackedVarint:function(G,X){if(this.type!==r.Bytes)return G.push(this.readVarint(X));var ee=h(this);for(G=G||[];this.pos<ee;)G.push(this.readVarint(X));return G},readPackedSVarint:function(G){if(this.type!==r.Bytes)return G.push(this.readSVarint());var X=h(this);for(G=G||[];this.pos<X;)G.push(this.readSVarint());return G},readPackedBoolean:function(G){if(this.type!==r.Bytes)return G.push(this.readBoolean());var X=h(this);for(G=G||[];this.pos<X;)G.push(this.readBoolean());return G},readPackedFloat:function(G){if(this.type!==r.Bytes)return G.push(this.readFloat());var X=h(this);for(G=G||[];this.pos<X;)G.push(this.readFloat());return G},readPackedDouble:function(G){if(this.type!==r.Bytes)return G.push(this.readDouble());var X=h(this);for(G=G||[];this.pos<X;)G.push(this.readDouble());return G},readPackedFixed32:function(G){if(this.type!==r.Bytes)return G.push(this.readFixed32());var X=h(this);for(G=G||[];this.pos<X;)G.push(this.readFixed32());return G},readPackedSFixed32:function(G){if(this.type!==r.Bytes)return G.push(this.readSFixed32());var X=h(this);for(G=G||[];this.pos<X;)G.push(this.readSFixed32());return G},readPackedFixed64:function(G){if(this.type!==r.Bytes)return G.push(this.readFixed64());var X=h(this);for(G=G||[];this.pos<X;)G.push(this.readFixed64());return G},readPackedSFixed64:function(G){if(this.type!==r.Bytes)return G.push(this.readSFixed64());var X=h(this);for(G=G||[];this.pos<X;)G.push(this.readSFixed64());return G},skip:function(G){var X=7&G;if(X===r.Varint)for(;this.buf[this.pos++]>127;);else if(X===r.Bytes)this.pos=this.readVarint()+this.pos;else if(X===r.Fixed32)this.pos+=4;else{if(X!==r.Fixed64)throw new Error("Unimplemented type: "+X);this.pos+=8}},writeTag:function(G,X){this.writeVarint(G<<3|X)},realloc:function(G){for(var X=this.length||16;X<this.pos+G;)X*=2;if(X!==this.length){var ee=new Uint8Array(X);ee.set(this.buf),this.buf=ee,this.length=X}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(G){this.realloc(4),Z(this.buf,G,this.pos),this.pos+=4},writeSFixed32:function(G){this.realloc(4),Z(this.buf,G,this.pos),this.pos+=4},writeFixed64:function(G){this.realloc(8),Z(this.buf,-1&G,this.pos),Z(this.buf,Math.floor(G*u),this.pos+4),this.pos+=8},writeSFixed64:function(G){this.realloc(8),Z(this.buf,-1&G,this.pos),Z(this.buf,Math.floor(G*u),this.pos+4),this.pos+=8},writeVarint:function(G){(G=+G||0)>268435455||G<0?function(X,ee){var ie,ge;if(X>=0?(ie=X%4294967296|0,ge=X/4294967296|0):(ge=~(-X/4294967296),4294967295^(ie=~(-X%4294967296))?ie=ie+1|0:(ie=0,ge=ge+1|0)),X>=18446744073709552e3||X<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");ee.realloc(10),function(fe,pe,Ce){Ce.buf[Ce.pos++]=127&fe|128,fe>>>=7,Ce.buf[Ce.pos++]=127&fe|128,fe>>>=7,Ce.buf[Ce.pos++]=127&fe|128,fe>>>=7,Ce.buf[Ce.pos++]=127&fe|128,Ce.buf[Ce.pos]=127&(fe>>>=7)}(ie,0,ee),function(fe,pe){var Ce=(7&fe)<<4;pe.buf[pe.pos++]|=Ce|((fe>>>=3)?128:0),fe&&(pe.buf[pe.pos++]=127&fe|((fe>>>=7)?128:0),fe&&(pe.buf[pe.pos++]=127&fe|((fe>>>=7)?128:0),fe&&(pe.buf[pe.pos++]=127&fe|((fe>>>=7)?128:0),fe&&(pe.buf[pe.pos++]=127&fe|((fe>>>=7)?128:0),fe&&(pe.buf[pe.pos++]=127&fe)))))}(ge,ee)}(G,this):(this.realloc(4),this.buf[this.pos++]=127&G|(G>127?128:0),G<=127||(this.buf[this.pos++]=127&(G>>>=7)|(G>127?128:0),G<=127||(this.buf[this.pos++]=127&(G>>>=7)|(G>127?128:0),G<=127||(this.buf[this.pos++]=G>>>7&127))))},writeSVarint:function(G){this.writeVarint(G<0?2*-G-1:2*G)},writeBoolean:function(G){this.writeVarint(!!G)},writeString:function(G){G=String(G),this.realloc(4*G.length),this.pos++;var X=this.pos;this.pos=function(ie,ge,fe){for(var pe,Ce,_e=0;_e<ge.length;_e++){if((pe=ge.charCodeAt(_e))>55295&&pe<57344){if(!Ce){pe>56319||_e+1===ge.length?(ie[fe++]=239,ie[fe++]=191,ie[fe++]=189):Ce=pe;continue}if(pe<56320){ie[fe++]=239,ie[fe++]=191,ie[fe++]=189,Ce=pe;continue}pe=Ce-55296<<10|pe-56320|65536,Ce=null}else Ce&&(ie[fe++]=239,ie[fe++]=191,ie[fe++]=189,Ce=null);pe<128?ie[fe++]=pe:(pe<2048?ie[fe++]=pe>>6|192:(pe<65536?ie[fe++]=pe>>12|224:(ie[fe++]=pe>>18|240,ie[fe++]=pe>>12&63|128),ie[fe++]=pe>>6&63|128),ie[fe++]=63&pe|128)}return fe}(this.buf,G,this.pos);var ee=this.pos-X;ee>=128&&w(X,ee,this),this.pos=X-1,this.writeVarint(ee),this.pos+=ee},writeFloat:function(G){this.realloc(4),c.write(this.buf,G,this.pos,!0,23,4),this.pos+=4},writeDouble:function(G){this.realloc(8),c.write(this.buf,G,this.pos,!0,52,8),this.pos+=8},writeBytes:function(G){var X=G.length;this.writeVarint(X),this.realloc(X);for(var ee=0;ee<X;ee++)this.buf[this.pos++]=G[ee]},writeRawMessage:function(G,X){this.pos++;var ee=this.pos;G(X,this);var ie=this.pos-ee;ie>=128&&w(ee,ie,this),this.pos=ee-1,this.writeVarint(ie),this.pos+=ie},writeMessage:function(G,X,ee){this.writeTag(G,r.Bytes),this.writeRawMessage(X,ee)},writePackedVarint:function(G,X){X.length&&this.writeMessage(G,E,X)},writePackedSVarint:function(G,X){X.length&&this.writeMessage(G,A,X)},writePackedBoolean:function(G,X){X.length&&this.writeMessage(G,I,X)},writePackedFloat:function(G,X){X.length&&this.writeMessage(G,v,X)},writePackedDouble:function(G,X){X.length&&this.writeMessage(G,C,X)},writePackedFixed32:function(G,X){X.length&&this.writeMessage(G,M,X)},writePackedSFixed32:function(G,X){X.length&&this.writeMessage(G,P,X)},writePackedFixed64:function(G,X){X.length&&this.writeMessage(G,R,X)},writePackedSFixed64:function(G,X){X.length&&this.writeMessage(G,F,X)},writeBytesField:function(G,X){this.writeTag(G,r.Bytes),this.writeBytes(X)},writeFixed32Field:function(G,X){this.writeTag(G,r.Fixed32),this.writeFixed32(X)},writeSFixed32Field:function(G,X){this.writeTag(G,r.Fixed32),this.writeSFixed32(X)},writeFixed64Field:function(G,X){this.writeTag(G,r.Fixed64),this.writeFixed64(X)},writeSFixed64Field:function(G,X){this.writeTag(G,r.Fixed64),this.writeSFixed64(X)},writeVarintField:function(G,X){this.writeTag(G,r.Varint),this.writeVarint(X)},writeSVarintField:function(G,X){this.writeTag(G,r.Varint),this.writeSVarint(X)},writeStringField:function(G,X){this.writeTag(G,r.Bytes),this.writeString(X)},writeFloatField:function(G,X){this.writeTag(G,r.Fixed32),this.writeFloat(X)},writeDoubleField:function(G,X){this.writeTag(G,r.Fixed64),this.writeDouble(X)},writeBooleanField:function(G,X){this.writeVarintField(G,!!X)}},sT}var h1=N(Vk());const aT=3;function U8(c,r,o){r.glyphs=[],c===1&&o.readMessage($8,r)}function $8(c,r,o){if(c===3){const{id:u,bitmap:p,width:h,height:_,left:w,top:E,advance:A}=o.readMessage(G8,{});r.glyphs.push({id:u,bitmap:new od({width:h+2*aT,height:_+2*aT},p),metrics:{width:h,height:_,left:w,top:E,advance:A}})}else c===4?r.ascender=o.readSVarint():c===5&&(r.descender=o.readSVarint())}function G8(c,r,o){c===1?r.id=o.readVarint():c===2?r.bitmap=o.readBytes():c===3?r.width=o.readVarint():c===4?r.height=o.readVarint():c===5?r.left=o.readSVarint():c===6?r.top=o.readSVarint():c===7&&(r.advance=o.readVarint())}const Uk=aT,xo={horizontal:1,vertical:2,horizontalOnly:3};class wy{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(r,o){const u=new wy;return u.scale=r||1,u.fontStack=o,u}static forImage(r){const o=new wy;return o.image=r,o}}class sm{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,o,u){const p=new sm;for(let h=0;h<r.sections.length;h++){const _=r.sections[h];_.image?p.addImageSection(_,u):p.addTextSection(_,o)}return p}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSections(){return this.sections}getSectionIndex(r){return this.sectionIndex[r]}getCodePoint(r){return this.text.codePointAt(r)}verticalizePunctuation(r){this.text=function(o,u){let p="";for(let h=0;h<o.length;h++){const _=o.charCodeAt(h+1)||null,w=o.charCodeAt(h-1)||null;p+=!u&&(_&&R_(_)&&!by[o[h+1]]||w&&R_(w)&&!by[o[h-1]])||!by[o[h]]?o[h]:by[o[h]]}return p}(this.text,r)}trim(){let r=0;for(let u=0;u<this.text.length&&f1[this.text.charCodeAt(u)];u++)r++;let o=this.text.length;for(let u=this.text.length-1;u>=0&&u>=r&&f1[this.text.charCodeAt(u)];u--)o--;this.text=this.text.substring(r,o),this.sectionIndex=this.sectionIndex.slice(r,o)}substring(r,o){const u=new sm;return u.text=this.text.substring(r,o),u.sectionIndex=this.sectionIndex.slice(r,o),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((r,o)=>Math.max(r,this.sections[o].scale),0)}addTextSection(r,o){this.text+=r.text,this.sections.push(wy.forText(r.scale,r.fontStack||o));const u=this.sections.length-1;for(let p=0;p<r.text.length;++p)this.sectionIndex.push(u)}addImageSection(r,o){const u=r.image?r.image.getPrimary():null;if(!u)return void Kn("Can't add FormattedSection with an empty image.");u.scaleSelf(o);const p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCodePoint(p),this.sections.push(wy.forImage(u)),this.sectionIndex.push(this.sections.length-1)):Kn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function lT(c,r,o,u,p,h,_,w,E,A,v,C,I,M,P,R=1){const F=sm.fromFeature(c,p,R);C===xo.vertical&&F.verticalizePunctuation(I);let B=[];const Z=function(ie,ge,fe,pe,Ce,_e){if(!ie)return[];const Me=[],Re=function(Ge,Ve,He,gt,ft,Ft){let xt=0;for(let Et=0;Et<Ge.length();Et++){const _t=Ge.getSection(Et);xt+=$k(Ge.getCodePoint(Et),_t,gt,ft,Ve,Ft)}return xt/Math.max(1,Math.ceil(xt/He))}(ie,ge,fe,pe,Ce,_e),ke=ie.text.indexOf("​")>=0;let Oe=0;for(let Ge=0;Ge<ie.length();Ge++){const Ve=ie.getSection(Ge),He=ie.getCodePoint(Ge);if(f1[He]||(Oe+=$k(He,Ve,pe,Ce,ge,_e)),Ge<ie.length()-1){const gt=!((Le=He)<11904||!(ar["Bopomofo Extended"](Le)||ar.Bopomofo(Le)||ar["CJK Compatibility Forms"](Le)||ar["CJK Compatibility Ideographs"](Le)||ar["CJK Compatibility"](Le)||ar["CJK Radicals Supplement"](Le)||ar["CJK Strokes"](Le)||ar["CJK Symbols and Punctuation"](Le)||ar["CJK Unified Ideographs Extension A"](Le)||ar["CJK Unified Ideographs"](Le)||ar["Enclosed CJK Letters and Months"](Le)||ar["Halfwidth and Fullwidth Forms"](Le)||ar.Hiragana(Le)||ar["Ideographic Description Characters"](Le)||ar["Kangxi Radicals"](Le)||ar["Katakana Phonetic Extensions"](Le)||ar.Katakana(Le)||ar["Vertical Forms"](Le)||ar["Yi Radicals"](Le)||ar["Yi Syllables"](Le)));(q8[He]||gt||Ve.image)&&Me.push(qk(Ge+1,Oe,Re,Me,H8(He,ie.getCodePoint(Ge+1),gt&&ke),!1))}}var Le;return Hk(qk(ie.length(),Oe,Re,Me,0,!0))}(F,A,h,r,u,M),{processBidirectionalText:W,processStyledBidirectionalText:G}=zo;if(W&&F.sections.length===1){const ie=W(F.toString(),Z);for(const ge of ie){const fe=new sm;fe.text=ge,fe.sections=F.sections;for(let pe=0;pe<ge.length;pe++)fe.sectionIndex.push(0);B.push(fe)}}else if(G){const ie=G(F.text,F.sectionIndex,Z);for(const ge of ie){const fe=new sm;fe.text=ge[0],fe.sectionIndex=ge[1],fe.sections=F.sections,B.push(fe)}}else B=function(ie,ge){const fe=[],pe=ie.text;let Ce=0;for(const _e of ge)fe.push(ie.substring(Ce,_e)),Ce=_e;return Ce<pe.length&&fe.push(ie.substring(Ce,pe.length)),fe}(F,Z);const X=[],ee={positionedLines:X,text:F.toString(),top:v[1],bottom:v[1],left:v[0],right:v[0],writingMode:C,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(ie,ge,fe,pe,Ce,_e,Me,Re,ke,Oe,Le,Ge){let Ve=0,He=0,gt=0;const ft=Re==="right"?1:Re==="left"?0:.5;let Ft=!1;for(const Zt of Ce){const gr=Zt.getSections();for(const jr of gr){if(jr.image)continue;const xr=ge[jr.fontStack];if(xr&&(Ft=xr.ascender!==void 0&&xr.descender!==void 0,!Ft))break}if(!Ft)break}let xt=0;for(const Zt of Ce){Zt.trim();const gr=Zt.getMaxScale(),jr=(gr-1)*ws,xr={positionedGlyphs:[],lineOffset:0};ie.positionedLines[xt]=xr;const Fr=xr.positionedGlyphs;let Rr=0;if(!Zt.length()){He+=_e,++xt;continue}let Ur=0,en=0;for(let _r=0;_r<Zt.length();_r++){const Wr=Zt.getSection(_r),$n=Zt.getSectionIndex(_r),Qn=Zt.getCodePoint(_r);let si=Wr.scale,li=null,Mn=null,Gi=null,qs=ws,Ci=0;ke===xo.vertical&&((Et=Qn)===12312||Et===12313||Et===12316||Et===12540||Et===12448)&&(ke=xo.horizontal);const Ri=!(ke===xo.horizontal||!Le&&!Dp(Qn)||Le&&(f1[Qn]||N0(Qn)));if(Wr.image){const ks=pe.get(Wr.image.toString());if(!ks)continue;Gi=Wr.image,ie.iconsInText=ie.iconsInText||!0,Mn=ks.paddedRect;const ds=ks.displaySize;si=si*ws/Ge,li={width:ds[0],height:ds[1],left:0,top:-Uk,advance:Ri?ds[1]:ds[0],localGlyph:!1},Ci=Ft?-li.height*si:gr*ws-17-ds[1]*si,qs=li.advance;const ha=(Ri?ds[0]:ds[1])*si-ws*gr;ha>0&&ha>Rr&&(Rr=ha)}else{const ks=fe[Wr.fontStack];if(!ks)continue;ks[Qn]&&(Mn=ks[Qn]);const ds=ge[Wr.fontStack];if(!ds)continue;const ha=ds.glyphs[Qn];if(!ha)continue;if(li=ha.metrics,qs=Qn!==8203?ws:0,Ft){const pd=ds.ascender!==void 0?Math.abs(ds.ascender):0,Ba=ds.descender!==void 0?Math.abs(ds.descender):0,bl=(pd+Ba)*si;Ur<bl&&(Ur=bl,en=(pd-Ba)/2*si),Ci=-pd*si}else Ci=(gr-si)*ws-17}Ri?(ie.verticalizable=!0,Fr.push({glyph:Qn,image:Gi,x:Ve,y:He+Ci,vertical:Ri,scale:si,localGlyph:li.localGlyph,fontStack:Wr.fontStack,sectionIndex:$n,metrics:li,rect:Mn}),Ve+=qs*si+Oe):(Fr.push({glyph:Qn,image:Gi,x:Ve,y:He+Ci,vertical:Ri,scale:si,localGlyph:li.localGlyph,fontStack:Wr.fontStack,sectionIndex:$n,metrics:li,rect:Mn}),Ve+=li.advance*si+Oe)}Fr.length!==0&&(gt=Math.max(Ve-Oe,gt),Ft?Wk(Fr,ft,Rr,en,_e*gr/2):Wk(Fr,ft,Rr,0,_e/2)),Ve=0;const Nn=_e*gr+Rr;xr.lineOffset=Math.max(Rr,jr),He+=Nn,++xt}var Et;const _t=He,{horizontalAlign:lr,verticalAlign:Dt}=cT(Me);(function(Zt,gr,jr,xr,Fr,Rr){const Ur=(gr-jr)*Fr,en=-Rr*xr;for(const Nn of Zt)for(const _r of Nn.positionedGlyphs)_r.x+=Ur,_r.y+=en})(ie.positionedLines,ft,lr,Dt,gt,_t),ie.top+=-Dt*_t,ie.bottom=ie.top+_t,ie.left+=-lr*gt,ie.right=ie.left+gt,ie.hasBaseline=Ft}(ee,r,o,u,B,_,w,E,C,A,I,P),!function(ie){for(const ge of ie)if(ge.positionedGlyphs.length!==0)return!1;return!0}(X))return ee}const f1={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},q8={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function $k(c,r,o,u,p,h){if(r.image){const _=u.get(r.image.toString());return _?_.displaySize[0]*r.scale*ws/h+p:0}{const _=o[r.fontStack],w=_&&_.glyphs[c];return w?w.metrics.advance*r.scale+p:0}}function Gk(c,r,o,u){const p=Math.pow(c-r,2);return u?c<r?p/2:2*p:p+Math.abs(o)*o}function H8(c,r,o){let u=0;return c===10&&(u-=1e4),o&&(u+=150),c!==40&&c!==65288||(u+=50),r!==41&&r!==65289||(u+=50),u}function qk(c,r,o,u,p,h){let _=null,w=Gk(r,o,p,h);for(const E of u){const A=Gk(r-E.x,o,p,h)+E.badness;A<=w&&(_=E,w=A)}return{index:c,x:r,priorBreak:_,badness:w}}function Hk(c){return c?Hk(c.priorBreak).concat(c.index):[]}function cT(c){let r=.5,o=.5;switch(c){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0}return{horizontalAlign:r,verticalAlign:o}}function Wk(c,r,o,u,p){if(!(r||o||u||p))return;const h=c.length-1,_=c[h],w=(_.x+_.metrics.advance*_.scale)*r;for(let E=0;E<=h;E++)c[E].x-=w,c[E].y+=o+u+p}function W8(c,r,o,u){const{horizontalAlign:p,verticalAlign:h}=cT(u),_=o[0]-c.displaySize[0]*p,w=o[1]-c.displaySize[1]*h;return{imagePrimary:c,imageSecondary:r,top:w,bottom:w+c.displaySize[1],left:_,right:_+c.displaySize[0]}}function Zk(c,r,o,u,p,h){const _=c.imagePrimary;let w;if(_.content){const F=_.content,B=_.pixelRatio||1;w=[F[0]/B,F[1]/B,_.displaySize[0]-F[2]/B,_.displaySize[1]-F[3]/B]}const E=r.left*h,A=r.right*h;let v,C,I,M;o==="width"||o==="both"?(M=p[0]+E-u[3],C=p[0]+A+u[1]):(M=p[0]+(E+A-_.displaySize[0])/2,C=M+_.displaySize[0]);const P=r.top*h,R=r.bottom*h;return o==="height"||o==="both"?(v=p[1]+P-u[0],I=p[1]+R+u[2]):(v=p[1]+(P+R-_.displaySize[1])/2,I=v+_.displaySize[1]),{imagePrimary:_,imageSecondary:void 0,top:v,right:C,bottom:I,left:M,collisionPadding:w}}class Wc extends bt{constructor(r,o,u,p,h){super(r,o),this.angle=p,this.z=u,h!==void 0&&(this.segment=h)}clone(){return new Wc(this.x,this.y,this.z,this.angle,this.segment)}}function Yk(c,r,o,u,p){if(r.segment===void 0)return!0;let h=r,_=r.segment+1,w=0;for(;w>-o/2;){if(_--,_<0)return!1;w-=c[_].dist(h),h=c[_]}w+=c[_].dist(c[_+1]),_++;const E=[];let A=0;for(;w<o/2;){const v=c[_],C=c[_+1];if(!C)return!1;let I=c[_-1].angleTo(v)-v.angleTo(C);for(I=Math.abs((I+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:w,angleDelta:I}),A+=I;w-E[0].distance>u;)A-=E.shift().angleDelta;if(A>p)return!1;_++,w+=v.dist(C)}return!0}function Xk(c){let r=0;for(let o=0;o<c.length-1;o++)r+=c[o].dist(c[o+1]);return r}function Kk(c,r,o){return c?.6*r*o:0}function Jk(c,r){return Math.max(c?c.right-c.left:0,r?r.right-r.left:0)}function Z8(c,r,o,u,p,h){const _=Kk(o,p,h),w=Jk(o,u)*h;let E=0;const A=Xk(c)/2;for(let v=0;v<c.length-1;v++){const C=c[v],I=c[v+1],M=C.dist(I);if(E+M>A){const P=(A-E)/M,R=ur(C.x,I.x,P),F=ur(C.y,I.y,P),B=new Wc(R,F,0,I.angleTo(C),v);return!_||Yk(c,B,w,_,r)?B:void 0}E+=M}}function Y8(c,r,o,u,p,h,_,w,E){const A=Kk(u,h,_),v=Jk(u,p),C=v*_,I=c[0].x===0||c[0].x===E||c[0].y===0||c[0].y===E;return r-C<r/4&&(r=C+r/4),Qk(c,I?r/2*w%r:(v/2+2*h)*_*w%r,r,A,o,C,I,!1,E)}function Qk(c,r,o,u,p,h,_,w,E){const A=h/2,v=Xk(c);let C=0,I=r-o,M=[];for(let P=0;P<c.length-1;P++){const R=c[P],F=c[P+1],B=R.dist(F),Z=F.angleTo(R);for(;I+o<C+B;){I+=o;const W=(I-C)/B,G=ur(R.x,F.x,W),X=ur(R.y,F.y,W);if(G>=0&&G<E&&X>=0&&X<E&&I-A>=0&&I+A<=v){const ee=new Wc(G,X,0,Z,P);u&&!Yk(c,ee,h,u,p)||M.push(ee)}}C+=B}return w||M.length||_||(M=Qk(c,C/2,o,u,p,h,_,!0,E)),M}function eN(c,r,o,u,p){const h=[];for(let _=0;_<c.length;_++){const w=c[_];let E;for(let A=0;A<w.length-1;A++){let v=w[A],C=w[A+1];v.x<r&&C.x<r||(v.x<r?v=new bt(r,v.y+(r-v.x)/(C.x-v.x)*(C.y-v.y))._round():C.x<r&&(C=new bt(r,v.y+(r-v.x)/(C.x-v.x)*(C.y-v.y))._round()),v.y<o&&C.y<o||(v.y<o?v=new bt(v.x+(o-v.y)/(C.y-v.y)*(C.x-v.x),o)._round():C.y<o&&(C=new bt(v.x+(o-v.y)/(C.y-v.y)*(C.x-v.x),o)._round()),v.x>=u&&C.x>=u||(v.x>=u?v=new bt(u,v.y+(u-v.x)/(C.x-v.x)*(C.y-v.y))._round():C.x>=u&&(C=new bt(u,v.y+(u-v.x)/(C.x-v.x)*(C.y-v.y))._round()),v.y>=p&&C.y>=p||(v.y>=p?v=new bt(v.x+(p-v.y)/(C.y-v.y)*(C.x-v.x),p)._round():C.y>=p&&(C=new bt(v.x+(p-v.y)/(C.y-v.y)*(C.x-v.x),p)._round()),E&&v.equals(E[E.length-1])||(E=[v],h.push(E)),E.push(C)))))}}return h}function tN(c){let r=0,o=0;for(const _ of c)r+=_.w*_.h,o=Math.max(o,_.w);c.sort((_,w)=>w.h-_.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),o),h:1/0}];let p=0,h=0;for(const _ of c)for(let w=u.length-1;w>=0;w--){const E=u[w];if(!(_.w>E.w||_.h>E.h)){if(_.x=E.x,_.y=E.y,h=Math.max(h,_.y+_.h),p=Math.max(p,_.x+_.w),_.w===E.w&&_.h===E.h){const A=u.pop();w<u.length&&(u[w]=A)}else _.h===E.h?(E.x+=_.w,E.w-=_.w):_.w===E.w?(E.y+=_.h,E.h-=_.h):(u.push({x:E.x+_.w,y:E.y,w:E.w-_.w,h:_.h}),E.y+=_.h,E.h-=_.h);break}}return{w:p,h,fill:r/(p*h)||0}}zt(Wc,"Anchor");const om=1;class Sy{static getImagePositionScale(r,o,u){if(o&&r&&r.options&&r.options.transform){const p=r.options.transform;return{x:p.a,y:p.d}}return{x:u,y:u}}constructor(r,o,u,p){this.paddedRect=r;const{pixelRatio:h,version:_,stretchX:w,stretchY:E,content:A,sdf:v,usvg:C}=o;this.pixelRatio=h,this.stretchX=w,this.stretchY=E,this.content=A,this.version=_,this.padding=u,this.sdf=v,this.scale=Sy.getImagePositionScale(p,C,h)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function rN(c,r,o){const u=Na.parse(c),p=function(h,_,w=[1,1]){return{x:0,y:0,w:(h.data?h.data.width:h.width*w[0])+2*_,h:(h.data?h.data.height:h.height*w[1])+2*_}}(r,o,[u.options.transform.a,u.options.transform.d]);return{bin:p,imagePosition:new Sy(p,r,o,u),imageVariant:u}}class nN{constructor(r,o,u){const p=new Map,h=new Map;this.haveRenderCallbacks=[];const _=[];this.addImages(r,p,om,_),this.addImages(o,h,2,_);const{w,h:E}=tN(_),A=new bs({width:w||1,height:E||1});for(const[v,C]of r.entries()){const I=p.get(v).paddedRect;bs.copy(C.data,A,{x:0,y:0},{x:I.x+om,y:I.y+om},C.data,u,C.sdf)}for(const[v,C]of o.entries()){const I=h.get(v),M=I.paddedRect;let P=I.padding;const R=M.x+P,F=M.y+P,B=C.data.width,Z=C.data.height;P=P>1?P-1:P,bs.copy(C.data,A,{x:0,y:0},{x:R,y:F},C.data,u),bs.copy(C.data,A,{x:0,y:Z-P},{x:R,y:F-P},{width:B,height:P},u),bs.copy(C.data,A,{x:0,y:0},{x:R,y:F+Z},{width:B,height:P},u),bs.copy(C.data,A,{x:B-P,y:0},{x:R-P,y:F},{width:P,height:Z},u),bs.copy(C.data,A,{x:0,y:0},{x:R+B,y:F},{width:P,height:Z},u),bs.copy(C.data,A,{x:B-P,y:Z-P},{x:R-P,y:F-P},{width:P,height:P},u),bs.copy(C.data,A,{x:0,y:Z-P},{x:R+B,y:F-P},{width:P,height:P},u),bs.copy(C.data,A,{x:0,y:0},{x:R+B,y:F+Z},{width:P,height:P},u),bs.copy(C.data,A,{x:B-P,y:0},{x:R-P,y:F+Z},{width:P,height:P},u)}this.lut=u,this.image=A,this.iconPositions=p,this.patternPositions=h}addImages(r,o,u,p){for(const[h,_]of r.entries()){const{bin:w,imagePosition:E,imageVariant:A}=rN(h,_,u);o.set(h,E),p.push(w),_.hasRenderCallback&&this.haveRenderCallbacks.push(A.id)}}patchUpdatedImages(r,o,u){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(p=>r.hasImage(p,u)),r.dispatchRenderCallbacks(this.haveRenderCallbacks,u);for(const p of r.getUpdatedImages(u)){for(const h of this.iconPositions.keys()){const _=Na.parse(h);if(Us.isEqual(_.id,p)){const w=r.getImage(p,u);this.patchUpdatedImage(this.iconPositions.get(h),w,o)}}for(const h of this.patternPositions.keys()){const _=Na.parse(h);if(Us.isEqual(_.id,p)){const w=r.getImage(p,u);this.patchUpdatedImage(this.patternPositions.get(h),w,o)}}}}patchUpdatedImage(r,o,u){if(!r||!o||r.version===o.version)return;r.version=o.version;const[p,h]=r.tl,_=r.sdf;if(this.lut||_){const w={width:o.data.width,height:o.data.height},E=new bs(w);bs.copy(o.data,E,{x:0,y:0},{x:0,y:0},w,this.lut,_),u.update(E,{position:{x:p,y:h}})}else u.update(o.data,{position:{x:p,y:h}})}}zt(Sy,"ImagePosition"),zt(nN,"ImageAtlas");const Ty=1e20;function iN(c,r,o,u,p,h,_,w,E){for(let A=r;A<r+u;A++)sN(c,o*h+A,h,p,_,w,E);for(let A=o;A<o+p;A++)sN(c,A*h+r,1,u,_,w,E)}function sN(c,r,o,u,p,h,_){h[0]=0,_[0]=-Ty,_[1]=Ty,p[0]=c[r];for(let w=1,E=0,A=0;w<u;w++){p[w]=c[r+w*o];const v=w*w;do{const C=h[E];A=(p[w]-p[C]+v-C*C)/(w-C)/2}while(A<=_[E]&&--E>-1);E++,h[E]=w,_[E]=A,_[E+1]=Ty}for(let w=0,E=0;w<u;w++){for(;_[E+1]<w;)E++;const A=h[E],v=w-A;c[r+w*o]=p[A]+v*v}}const _l=2,uT={none:0,ideographs:1,all:2};class am{constructor(r,o,u){this.requestManager=r,this.localGlyphMode=o,this.localFontFamily=u,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(r,o){this.urls[o]=r}getGlyphs(r,o,u){const p=[],h=this.urls[o]||oe.GLYPHS_URL;for(const _ in r)for(const w of r[_])p.push({stack:_,id:w});Bn(p,({stack:_,id:w},E)=>{let A=this.entries[_];A||(A=this.entries[_]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let v=A.glyphs[w];if(v!==void 0)return void E(null,{stack:_,id:w,glyph:v});if(v=this._tinySDF(A,_,w),v)return A.glyphs[w]=v,void E(null,{stack:_,id:w,glyph:v});const C=Math.floor(w/256);if(256*C>65535)return Kn("glyphs > 65535 not supported"),void E(null,{stack:_,id:w,glyph:v});if(A.ranges[C])return void E(null,{stack:_,id:w,glyph:v});let I=A.requests[C];I||(I=A.requests[C]=[],am.loadGlyphRange(_,C,h,this.requestManager,(M,P)=>{if(P){A.ascender=P.ascender,A.descender=P.descender;for(const R in P.glyphs)this._doesCharSupportLocalGlyph(+R)||(A.glyphs[+R]=P.glyphs[+R]);A.ranges[C]=!0}for(const R of I)R(M,P);delete A.requests[C]})),I.push((M,P)=>{M?E(M):P&&E(null,{stack:_,id:w,glyph:P.glyphs[w]||null})})},(_,w)=>{if(_)u(_);else if(w){const E={};for(const{stack:A,id:v,glyph:C}of w)E[A]===void 0&&(E[A]={}),E[A].glyphs===void 0&&(E[A].glyphs={}),E[A].glyphs[v]=C&&{id:C.id,bitmap:C.bitmap.clone(),metrics:C.metrics},E[A].ascender=this.entries[A].ascender,E[A].descender=this.entries[A].descender;u(null,E)}})}_doesCharSupportLocalGlyph(r){return this.localGlyphMode!==uT.none&&(this.localGlyphMode===uT.all?!!this.localFontFamily:!!this.localFontFamily&&(ar["CJK Unified Ideographs"](r)||ar["Hangul Syllables"](r)||ar.Hiragana(r)||ar.Katakana(r)||ar["CJK Symbols and Punctuation"](r)||ar["CJK Unified Ideographs Extension A"](r)||ar["CJK Unified Ideographs Extension B"](r)||ar.Osage(r)))}_tinySDF(r,o,u){const p=this.localFontFamily;if(!p||!this._doesCharSupportLocalGlyph(u))return;let h=r.tinySDF;if(!h){let R="400";/bold/i.test(o)?R="900":/medium/i.test(o)?R="500":/light/i.test(o)&&(R="200"),h=r.tinySDF=new am.TinySDF({fontFamily:p,fontWeight:R,fontSize:24*_l,buffer:3*_l,radius:8*_l}),h.fontWeight=R}if(this.localGlyphs[h.fontWeight][u])return this.localGlyphs[h.fontWeight][u];const _=String.fromCodePoint(u),{data:w,width:E,height:A,glyphWidth:v,glyphHeight:C,glyphLeft:I,glyphTop:M,glyphAdvance:P}=h.draw(_);return this.localGlyphs[h.fontWeight][u]={id:u,bitmap:new od({width:E,height:A},w),metrics:{width:v/_l,height:C/_l,left:I/_l,top:M/_l-27,advance:P/_l,localGlyph:!0}}}}am.loadGlyphRange=function(c,r,o,u,p){const h=256*r,_=h+255,w=u.transformRequest(u.normalizeGlyphsURL(o).replace("{fontstack}",c).replace("{range}",`${h}-${_}`),Ji.Glyphs);ka(w,(E,A)=>{if(E)p(E);else if(A){const v={},C=function(I){return new h1(I).readFields(U8,{})}(A);for(const I of C.glyphs)v[I.id]=I;p(null,{glyphs:v,ascender:C.ascender,descender:C.descender})}})},am.TinySDF=class{constructor({fontSize:c=24,buffer:r=3,radius:o=8,cutoff:u=.25,fontFamily:p="sans-serif",fontWeight:h="normal",fontStyle:_="normal"}={}){this.buffer=r,this.cutoff=u,this.radius=o;const w=this.size=c+4*r,E=this._createCanvas(w),A=this.ctx=E.getContext("2d",{willReadFrequently:!0});A.font=`${_} ${h} ${c}px ${p}`,A.textBaseline="alphabetic",A.textAlign="left",A.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(c){const r=document.createElement("canvas");return r.width=r.height=c,r}draw(c){const{width:r,actualBoundingBoxAscent:o,actualBoundingBoxDescent:u,actualBoundingBoxLeft:p,actualBoundingBoxRight:h}=this.ctx.measureText(c),_=Math.ceil(o),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(h-p))),E=Math.min(this.size-this.buffer,_+Math.ceil(u)),A=w+2*this.buffer,v=E+2*this.buffer,C=Math.max(A*v,0),I=new Uint8ClampedArray(C),M={data:I,width:A,height:v,glyphWidth:w,glyphHeight:E,glyphTop:_,glyphLeft:0,glyphAdvance:r};if(w===0||E===0)return M;const{ctx:P,buffer:R,gridInner:F,gridOuter:B}=this;P.clearRect(R,R,w,E),P.fillText(c,R,R+_);const Z=P.getImageData(R,R,w,E);B.fill(Ty,0,C),F.fill(0,0,C);for(let W=0;W<E;W++)for(let G=0;G<w;G++){const X=Z.data[4*(W*w+G)+3]/255;if(X===0)continue;const ee=(W+R)*A+G+R;if(X===1)B[ee]=0,F[ee]=Ty;else{const ie=.5-X;B[ee]=ie>0?ie*ie:0,F[ee]=ie<0?ie*ie:0}}iN(B,0,0,A,v,A,this.f,this.v,this.z),iN(F,R,R,w,E,A,this.f,this.v,this.z);for(let W=0;W<C;W++){const G=Math.sqrt(B[W])-Math.sqrt(F[W]);I[W]=Math.round(255-255*(G/this.radius+this.cutoff))}return M}};const cd=om;function oN(c,r){return c+r[1]-r[0]}function aN(c,r,o,u,p=1){const h=[],_=c.imagePrimary,w=_.pixelRatio,E=_.paddedRect.w-2*cd,A=_.paddedRect.h-2*cd,v=(c.right-c.left)*p,C=(c.bottom-c.top)*p,I=_.stretchX||[[0,E]],M=_.stretchY||[[0,A]],P=I.reduce(oN,0),R=M.reduce(oN,0),F=E-P,B=A-R;let Z=0,W=P,G=0,X=R,ee=0,ie=F,ge=0,fe=B;if(_.content&&u){const Ce=_.content;Z=p1(I,0,Ce[0]),G=p1(M,0,Ce[1]),W=p1(I,Ce[0],Ce[2]),X=p1(M,Ce[1],Ce[3]),ee=Ce[0]-Z,ge=Ce[1]-G,ie=Ce[2]-Ce[0]-W,fe=Ce[3]-Ce[1]-X}const pe=(Ce,_e,Me,Re)=>{const ke=m1(Ce.stretch-Z,W,v,c.left*p),Oe=g1(Ce.fixed-ee,ie,Ce.stretch,P),Le=m1(_e.stretch-G,X,C,c.top*p),Ge=g1(_e.fixed-ge,fe,_e.stretch,R),Ve=m1(Me.stretch-Z,W,v,c.left*p),He=g1(Me.fixed-ee,ie,Me.stretch,P),gt=m1(Re.stretch-G,X,C,c.top*p),ft=g1(Re.fixed-ge,fe,Re.stretch,R),Ft=new bt(ke,Le),xt=new bt(Ve,Le),Et=new bt(Ve,gt),_t=new bt(ke,gt),lr=new bt(Oe/w,Ge/w),Dt=new bt(He/w,ft/w),Zt=r*Math.PI/180;if(Zt){const Ur=Math.sin(Zt),en=Math.cos(Zt),Nn=[en,-Ur,Ur,en];Ft._matMult(Nn),xt._matMult(Nn),_t._matMult(Nn),Et._matMult(Nn)}const gr=Ce.stretch+Ce.fixed,jr=Me.stretch+Me.fixed,xr=_e.stretch+_e.fixed,Fr=Re.stretch+Re.fixed,Rr=c.imageSecondary;return{tl:Ft,tr:xt,bl:_t,br:Et,texPrimary:{x:_.paddedRect.x+cd+gr,y:_.paddedRect.y+cd+xr,w:jr-gr,h:Fr-xr},texSecondary:Rr?{x:Rr.paddedRect.x+cd+gr,y:Rr.paddedRect.y+cd+xr,w:jr-gr,h:Fr-xr}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:lr,pixelOffsetBR:Dt,minFontScaleX:ie/w/v,minFontScaleY:fe/w/C,isSDF:o}};if(u&&(_.stretchX||_.stretchY)){const Ce=lN(I,F,P),_e=lN(M,B,R);for(let Me=0;Me<Ce.length-1;Me++){const Re=Ce[Me],ke=Ce[Me+1];for(let Oe=0;Oe<_e.length-1;Oe++)h.push(pe(Re,_e[Oe],ke,_e[Oe+1]))}}else h.push(pe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:E+1},{fixed:0,stretch:A+1}));return h}function p1(c,r,o){let u=0;for(const p of c)u+=Math.max(r,Math.min(o,p[1]))-Math.max(r,Math.min(o,p[0]));return u}function lN(c,r,o){const u=[{fixed:-cd,stretch:0}];for(const[p,h]of c){const _=u[u.length-1];u.push({fixed:p-_.stretch,stretch:_.stretch}),u.push({fixed:p-_.stretch,stretch:_.stretch+(h-p)})}return u.push({fixed:r+cd,stretch:o}),u}function m1(c,r,o,u){return c/r*o+u}function g1(c,r,o,u){return c-r*o/u}function X8(c,r,o,u){const p=r+c.positionedLines[u].lineOffset;return u===0?o+p/2:o+(p+(r+c.positionedLines[u-1].lineOffset))/2}function K8(c,r=1,o=!1){let u=1/0,p=1/0,h=-1/0,_=-1/0;const w=c[0];for(let M=0;M<w.length;M++){const P=w[M];(!M||P.x<u)&&(u=P.x),(!M||P.y<p)&&(p=P.y),(!M||P.x>h)&&(h=P.x),(!M||P.y>_)&&(_=P.y)}const E=Math.min(h-u,_-p);let A=E/2;const v=new Nh([],J8);if(E===0)return new bt(u,p);for(let M=u;M<h;M+=E)for(let P=p;P<_;P+=E)v.push(new lm(M+A,P+A,A,c));let C=function(M){let P=0,R=0,F=0;const B=M[0];for(let Z=0,W=B.length,G=W-1;Z<W;G=Z++){const X=B[Z],ee=B[G],ie=X.x*ee.y-ee.x*X.y;R+=(X.x+ee.x)*ie,F+=(X.y+ee.y)*ie,P+=3*ie}return new lm(R/P,F/P,0,M)}(c),I=v.length;for(;v.length;){const M=v.pop();(M.d>C.d||!C.d)&&(C=M,o&&console.log("found best %d after %d probes",Math.round(1e4*M.d)/1e4,I)),M.max-C.d<=r||(A=M.h/2,v.push(new lm(M.p.x-A,M.p.y-A,A,c)),v.push(new lm(M.p.x+A,M.p.y-A,A,c)),v.push(new lm(M.p.x-A,M.p.y+A,A,c)),v.push(new lm(M.p.x+A,M.p.y+A,A,c)),I+=4)}return o&&(console.log(`num probes: ${I}`),console.log(`best distance: ${C.d}`)),C.p}function J8(c,r){return r.max-c.max}class lm{constructor(r,o,u,p){this.p=new bt(r,o),this.h=u,this.d=function(h,_){let w=!1,E=1/0;for(let A=0;A<_.length;A++){const v=_[A];for(let C=0,I=v.length,M=I-1;C<I;M=C++){const P=v[C],R=v[M];P.y>h.y!=R.y>h.y&&h.x<(R.x-P.x)*(h.y-P.y)/(R.y-P.y)+P.x&&(w=!w),E=Math.min(E,Ee(h,P,R))}}return(w?1:-1)*Math.sqrt(E)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}}const dT=Number.POSITIVE_INFINITY,Q8=Math.sqrt(2);function cN(c,[r,o]){let u=0,p=0;if(o===dT){r<0&&(r=0);const h=r/Q8;switch(c){case"top-right":case"top-left":p=h-7;break;case"bottom-right":case"bottom-left":p=7-h;break;case"bottom":p=7-r;break;case"top":p=r-7}switch(c){case"top-right":case"bottom-right":u=-h;break;case"top-left":case"bottom-left":u=h;break;case"left":u=r;break;case"right":u=-r}}else{switch(r=Math.abs(r),o=Math.abs(o),c){case"top-right":case"top-left":case"top":p=o-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-o}switch(c){case"top-right":case"bottom-right":case"right":u=-r;break;case"top-left":case"bottom-left":case"left":u=r}}return[u,p]}function uN(c,r,o,u,p,h,_,w){if(!c)return;const E=zk(r,o,u,p,h);return c.scaleSelf(E*w*_)}function dN(c,r,o,u,p,h,_,w){return{iconPrimary:uN(c.getPrimary(),r,o,u,p,h,_,w),iconSecondary:uN(c.getSecondary(),r,o,u,p,h,_,w)}}function hN(c,r,o,u){if(!c)return;const p=r.get(o.toString());if(c.imagePrimary=p,u){const h=r.get(u.toString());c.imageSecondary=h}}function e$(c,r){for(const o in c.horizontal)fN(c.horizontal[o],r);fN(c.vertical,r)}function fN(c,r){if(c){for(const o of c.positionedLines)for(const u of o.positionedGlyphs)if(u.image!==null){const p=u.image.toString();u.rect=r.get(p).paddedRect}}}function hT(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function t$(c,r,o,u,p,h,_,w,E){const A=fT(h.horizontal)||h.vertical,v=o.get("icon-text-fit-padding").evaluate(u,{},p);let C,I=r;return r&&E!=="none"&&(c.allowVerticalPlacement&&h.vertical&&(C=Zk(r,h.vertical,E,v,w,_)),A&&(I=Zk(r,A,E,v,w,_))),{defaultShapedIcon:I,verticallyShapedIcon:C}}function r$(c,r,o,u,p,h,_,w,E,A,v,C,I,M,P,R,F,B,Z,W){let G=_.textMaxSize.evaluate(r,{},I);G===void 0?G=w*_.textScaleFactor:G*=_.textScaleFactor;const X=c.layers[0].layout,ee=fT(o.horizontal)||o.vertical,ie=M.name==="globe",ge=ws,fe=c.tilePixelRatio*G/ge,pe=(Oe=c.overscaling,c.zoom>18&&Oe>2&&(Oe>>=1),Math.max(Ct/(512*Oe),1)*X.get("symbol-spacing")),Ce=X.get("text-padding")*c.tilePixelRatio,_e=X.get("icon-padding")*c.tilePixelRatio,Me=Be(X.get("text-max-angle")),Re=X.get("icon-rotation-alignment")==="map"&&W!=="point",ke=pe/2;var Oe;c.hasAnyIconTextFit===!1&&F!=="none"&&(c.hasAnyIconTextFit=!0);const Le=r.properties?+r.properties[af]:null,Ge=Le&&c.elevationFeatureIdToIndex?c.elevationFeatureIdToIndex.get(Le):65535,Ve=(He,gt,ft)=>{if(gt.x<0||gt.x>=Ct||gt.y<0||gt.y>=Ct)return;let Ft=null;if(ie){const{x:xt,y:Et,z:_t}=M.projectTilePoint(gt.x,gt.y,ft);Ft={anchor:new Wc(xt,Et,_t,0,void 0),up:M.upVector(ft,gt.x,gt.y)}}(function(xt,Et,_t,lr,Dt,Zt,gr,jr,xr,Fr,Rr,Ur,en,Nn,_r,Wr,$n,Qn,si,li,Mn,Gi,qs,Ci,Ri,ks,ds,ha,pd){const Ba=xt.addToLineVertexArray(Et,lr);let bl,md,gd,pf,YR,XR,KR,JR=0,QR=0,ej=0,tj=0,HT=-1,WT=-1;const lc={};let rj=ho("");const mf=_t?_t.anchor:Et,ZT=ha!=="none";let YT=0,XT=0;if(xr._unevaluatedLayout.getValue("text-radial-offset")===void 0?[YT,XT]=xr.layout.get("text-offset").evaluate(Mn,{},Ri).map(fa=>fa*ws):(YT=xr.layout.get("text-radial-offset").evaluate(Mn,{},Ri)*ws,XT=dT),xt.allowVerticalPlacement&&Dt.vertical){const fa=Dt.vertical;if(_r)XR=pT(fa),jr&&(KR=pT(jr));else{const vo=xr.layout.get("text-rotate").evaluate(Mn,{},Ri)+90;gd=_1(Fr,mf,Et,Rr,Ur,en,fa,Nn,vo,Wr),jr&&(pf=_1(Fr,mf,Et,Rr,Ur,en,jr,Qn,vo))}}if(Zt){const fa=xt.iconSizeData,vo=xr.layout.get("icon-rotate").evaluate(Mn,{},Ri),$y=aN(Zt,vo,qs,ZT,Gi.iconScaleFactor),JT=jr?aN(jr,vo,qs,ZT,Gi.iconScaleFactor):void 0;md=_1(Fr,mf,Et,Rr,Ur,en,Zt,Qn,vo,null),JR=4*$y.length;let gf=null;fa.kind==="source"?(gf=[gl*xr.layout.get("icon-size").evaluate(Mn,{},Ri)*Gi.iconScaleFactor],gf[0]>ud&&Kn(`${xt.layerIds[0]}: Value for "icon-size" is >= ${Ey}. Reduce your "icon-size".`)):fa.kind==="composite"&&(gf=[gl*Gi.compositeIconSizes[0].evaluate(Mn,{},Ri)*Gi.iconScaleFactor,gl*Gi.compositeIconSizes[1].evaluate(Mn,{},Ri)*Gi.iconScaleFactor],(gf[0]>ud||gf[1]>ud)&&Kn(`${xt.layerIds[0]}: Value for "icon-size" is >= ${Ey}. Reduce your "icon-size".`)),xt.addSymbols(xt.icon,$y,gf,li,si,Mn,!1,_t,Et,Ba.lineStartIndex,Ba.lineLength,-1,Ci,Ri,ks,ds),HT=xt.icon.placedSymbolArray.length-1,JT&&(QR=4*JT.length,xt.addSymbols(xt.icon,JT,gf,li,si,Mn,xo.vertical,_t,Et,Ba.lineStartIndex,Ba.lineLength,-1,Ci,Ri,ks,ds),WT=xt.icon.placedSymbolArray.length-1)}for(const fa in Dt.horizontal){const vo=Dt.horizontal[fa];bl||(rj=ho(vo.text),_r?YR=pT(vo):bl=_1(Fr,mf,Et,Rr,Ur,en,vo,Nn,xr.layout.get("text-rotate").evaluate(Mn,{},Ri),Wr));const $y=vo.positionedLines.length===1;if(ej+=pN(xt,_t,Et,vo,gr,xr,_r,Mn,Wr,Ba,Dt.vertical?xo.horizontal:xo.horizontalOnly,$y?Object.keys(Dt.horizontal):[fa],lc,HT,Gi,Ci,Ri,ks),$y)break}Dt.vertical&&(tj+=pN(xt,_t,Et,Dt.vertical,gr,xr,_r,Mn,Wr,Ba,xo.vertical,["vertical"],lc,WT,Gi,Ci,Ri,ks));let _d=-1;const KT=(fa,vo)=>fa?Math.max(fa,vo):vo;_d=KT(YR,_d),_d=KT(XR,_d),_d=KT(KR,_d);const j7=_d>-1?1:0;xt.glyphOffsetArray.length>=65535&&Kn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Mn.sortKey!==void 0&&xt.addToSortKeyRanges(xt.symbolInstances.length,Mn.sortKey),xt.symbolInstances.emplaceBack(Et.x,Et.y,mf.x,mf.y,mf.z,lc.right>=0?lc.right:-1,lc.center>=0?lc.center:-1,lc.left>=0?lc.left:-1,lc.vertical>=0?lc.vertical:-1,HT,WT,rj,bl!==void 0?bl:xt.collisionBoxArray.length,bl!==void 0?bl+1:xt.collisionBoxArray.length,gd!==void 0?gd:xt.collisionBoxArray.length,gd!==void 0?gd+1:xt.collisionBoxArray.length,md!==void 0?md:xt.collisionBoxArray.length,md!==void 0?md+1:xt.collisionBoxArray.length,pf||xt.collisionBoxArray.length,pf?pf+1:xt.collisionBoxArray.length,Rr,ej,tj,JR,QR,j7,0,YT,XT,_d,0,ZT?1:0,pd)})(c,gt,Ft,He,o,u,h,p,c.layers[0],c.collisionBoxArray,r.index,r.sourceLayerIndex,c.index,Ce,Z,A,0,_e,Re,B,r,_,v,C,I,P,R,F,Ge)};if(W==="line")for(const He of eN(r.geometry,0,0,Ct,Ct)){const gt=Y8(He,pe,Me,o.vertical||ee,u,ge,fe,c.overscaling,Ct);for(const ft of gt)ee&&n$(c,ee.text,ke,ft)||Ve(He,ft,I)}else if(W==="line-center"){for(const He of r.geometry)if(He.length>1){const gt=Z8(He,Me,o.vertical||ee,u,ge,fe);gt&&Ve(He,gt,I)}}else if(r.type==="Polygon")for(const He of i1(r.geometry,0)){const gt=K8(He,16);Ve(He[0],new Wc(gt.x,gt.y,0,0,void 0),I)}else if(r.type==="LineString")for(const He of r.geometry)Ve(He,new Wc(He[0].x,He[0].y,0,0,void 0),I);else if(r.type==="Point")for(const He of r.geometry)for(const gt of He)Ve([gt],new Wc(gt.x,gt.y,0,0,void 0),I)}const Ey=255,ud=Ey*gl;function pN(c,r,o,u,p,h,_,w,E,A,v,C,I,M,P,R,F,B){const Z=function(X,ee,ie,ge,fe,pe,Ce,_e){const Me=[];if(ee.positionedLines.length===0)return Me;const Re=ge.layout.get("text-rotate").evaluate(pe,{})*Math.PI/180,ke=function(He){const gt=He[0],ft=He[1],Ft=gt*ft;return Ft>0?[gt,-ft]:Ft<0?[-gt,ft]:gt===0?[ft,gt]:[ft,-gt]}(ie);let Oe=Math.abs(ee.top-ee.bottom);for(const He of ee.positionedLines)Oe-=He.lineOffset;const Le=ee.positionedLines.length,Ge=Oe/Le;let Ve=ee.top-ie[1];for(let He=0;He<Le;++He){const gt=ee.positionedLines[He];Ve=X8(ee,Ge,Ve,He);for(const ft of gt.positionedGlyphs){if(!ft.rect)continue;const Ft=ft.rect||{};let xt=Uk+1,Et=!0,_t=1,lr=0;if(ft.image){const Mn=Ce.get(ft.image.toString());if(!Mn)continue;if(Mn.sdf){Kn("SDF images are not supported in formatted text and will be ignored.");continue}Et=!1,_t=Mn.pixelRatio,xt=om/_t}const Dt=(fe||_e)&&ft.vertical,Zt=ft.metrics.advance*ft.scale/2,gr=ft.metrics,jr=ft.rect;if(jr===null)continue;_e&&ee.verticalizable&&(lr=ft.image?Zt-ft.metrics.width*ft.scale/2:0);const xr=fe?[ft.x+Zt,ft.y]:[0,0];let Fr=[0,0],Rr=[0,0],Ur=!1;fe||(Dt?(Rr=[ft.x+Zt+ke[0],ft.y+ke[1]-lr],Ur=!0):Fr=[ft.x+Zt+ie[0],ft.y+ie[1]-lr]);const en=jr.w*ft.scale/(_t*(ft.localGlyph?_l:1)),Nn=jr.h*ft.scale/(_t*(ft.localGlyph?_l:1));let _r,Wr,$n,Qn;if(Dt){const Mn=ft.y-Ve,Gi=new bt(-Zt,Zt-Mn),qs=-Math.PI/2,Ci=new bt(...Rr);_r=new bt(-Zt+Fr[0],Fr[1]),_r._rotateAround(qs,Gi)._add(Ci),_r.x+=-Mn+Zt,_r.y-=(gr.left-xt)*ft.scale;const Ri=ft.image?gr.advance*ft.scale:ws*ft.scale,ks=String.fromCodePoint(ft.glyph);F8(ks)?_r.x+=(1-xt)*ft.scale:B8(ks)?_r.x+=Ri-gr.height*ft.scale+(-xt-1)*ft.scale:_r.x+=ft.image||gr.width+2*xt===jr.w&&gr.height+2*xt===jr.h?(Ri-Nn)/2:(Ri-(gr.height+2*xt)*ft.scale)/2,Wr=new bt(_r.x,_r.y-en),$n=new bt(_r.x+Nn,_r.y),Qn=new bt(_r.x+Nn,_r.y-en)}else{const Mn=(gr.left-xt)*ft.scale-Zt+Fr[0],Gi=(-gr.top-xt)*ft.scale+Fr[1],qs=Mn+en,Ci=Gi+Nn;_r=new bt(Mn,Gi),Wr=new bt(qs,Gi),$n=new bt(Mn,Ci),Qn=new bt(qs,Ci)}if(Re){let Mn;Mn=fe?new bt(0,0):Ur?new bt(ke[0],ke[1]):new bt(ie[0],ie[1]),_r._rotateAround(Re,Mn),Wr._rotateAround(Re,Mn),$n._rotateAround(Re,Mn),Qn._rotateAround(Re,Mn)}const si=new bt(0,0),li=new bt(0,0);Me.push({tl:_r,tr:Wr,bl:$n,br:Qn,texPrimary:Ft,texSecondary:void 0,writingMode:ee.writingMode,glyphOffset:xr,sectionIndex:ft.sectionIndex,isSDF:Et,pixelOffsetTL:si,pixelOffsetBR:li,minFontScaleX:0,minFontScaleY:0})}}return Me}(0,u,E,h,_,w,p,c.allowVerticalPlacement),W=c.textSizeData;let G=null;W.kind==="source"?(G=[gl*h.layout.get("text-size").evaluate(w,{},F)*P.textScaleFactor],G[0]>ud&&Kn(`${c.layerIds[0]}: Value for "text-size" is >= ${Ey}. Reduce your "text-size".`)):W.kind==="composite"&&(G=[gl*P.compositeTextSizes[0].evaluate(w,{},F)*P.textScaleFactor,gl*P.compositeTextSizes[1].evaluate(w,{},F)*P.textScaleFactor],(G[0]>ud||G[1]>ud)&&Kn(`${c.layerIds[0]}: Value for "text-size" is >= ${Ey}. Reduce your "text-size".`)),c.addSymbols(c.text,Z,G,E,_,w,v,r,o,A.lineStartIndex,A.lineLength,M,R,F,B,!1);for(const X of C)I[X]=c.text.placedSymbolArray.length-1;return 4*Z.length}function fT(c){for(const r in c)return c[r];return null}function _1(c,r,o,u,p,h,_,w,E,A){let v=_.top,C=_.bottom,I=_.left,M=_.right;const P=_.collisionPadding;if(P&&(I-=P[0],v-=P[1],M+=P[2],C+=P[3]),E){const R=new bt(I,v),F=new bt(M,v),B=new bt(I,C),Z=new bt(M,C),W=Be(E);let G=new bt(0,0);A&&(G=new bt(A[0],A[1])),R._rotateAround(W,G),F._rotateAround(W,G),B._rotateAround(W,G),Z._rotateAround(W,G),I=Math.min(R.x,F.x,B.x,Z.x),M=Math.max(R.x,F.x,B.x,Z.x),v=Math.min(R.y,F.y,B.y,Z.y),C=Math.max(R.y,F.y,B.y,Z.y)}return c.emplaceBack(r.x,r.y,r.z,o.x,o.y,I,v,M,C,w,u,p,h),c.length-1}function pT(c){c.collisionPadding&&(c.top-=c.collisionPadding[1],c.bottom+=c.collisionPadding[3]);const r=c.bottom-c.top;return r>0?Math.max(10,r):null}function n$(c,r,o,u){const p=c.compareText;if(r in p){const h=p[r];for(let _=h.length-1;_>=0;_--)if(u.dist(h[_])<o)return!0}else p[r]=[];return p[r].push(u),!1}function mN(c,r){const o=c.fovAboveCenter,u=c.elevation?c.elevation.getMinElevationBelowMSL()*r:0,p=(c._camera.position[2]*c.worldSize-u)/Math.cos(c._pitch),h=Math.sin(o)*p/Math.sin(Math.max(Math.PI/2-c._pitch-o,.01));let _=Math.sin(c._pitch)*h+p;const w=p*(1/c._horizonShift);if(!c.elevation||c.elevation.exaggeration()===0){let E=Math.max(c.zoom-17,0);c.isOrthographic&&(E/=10),_*=1+E}return Math.min(1.01*_,w)}function Cy(c,r){if(!r.isReprojectedInTileSpace)return{scale:1<<c.z,x:c.x,y:c.y,x2:c.x+1,y2:c.y+1,projection:r};const o=Math.pow(2,-c.z),u=c.x*o,p=(c.x+1)*o,h=c.y*o,_=(c.y+1)*o,w=Js(u),E=Js(p),A=cs(h),v=cs(_),C=r.project(w,A),I=r.project(E,A),M=r.project(E,v),P=r.project(w,v);let R=Math.min(C.x,I.x,M.x,P.x),F=Math.min(C.y,I.y,M.y,P.y),B=Math.max(C.x,I.x,M.x,P.x),Z=Math.max(C.y,I.y,M.y,P.y);const W=o/16;function G(ee,ie,ge,fe,pe,Ce){const _e=(ge+pe)/2,Me=(fe+Ce)/2,Re=r.project(Js(_e),cs(Me)),ke=Math.max(0,R-Re.x,F-Re.y,Re.x-B,Re.y-Z);R=Math.min(R,Re.x),B=Math.max(B,Re.x),F=Math.min(F,Re.y),Z=Math.max(Z,Re.y),ke>W&&(G(ee,Re,ge,fe,_e,Me),G(Re,ie,_e,Me,pe,Ce))}G(C,I,u,h,p,h),G(I,M,p,h,p,_),G(M,P,p,_,u,_),G(P,C,u,_,u,h),R-=W,F-=W,B+=W,Z+=W;const X=1/Math.max(B-R,Z-F);return{scale:X,x:R*X,y:F*X,x2:B*X,y2:Z*X,projection:r}}function gN(c,{x:r,y:o},u=0){return new bt(((r-u)*c.scale-c.x)*Ct,(o*c.scale-c.y)*Ct)}const i$=de.mat4.identity(new Float32Array(16));class dd{constructor(r){this.spec=r,this.name=r.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(r,o){return{x:0,y:0,z:0}}unproject(r,o){return new sn(0,0)}projectTilePoint(r,o,u){return{x:r,y:o,z:0}}locationPoint(r,o,u,p=!0){return r._coordinatePoint(r.locationCoordinate(o,u),p)}pixelsPerMeter(r,o){return vs(1,r)*o}pixelSpaceConversion(r,o,u){return 1}farthestPixelDistance(r){return mN(r,r.pixelsPerMeter)}pointCoordinate(r,o,u,p){const h=r.horizonLineFromTop(!1),_=new bt(o,Math.max(h,u));return r.rayIntersectionCoordinate(r.pointRayIntersection(_,p))}pointCoordinate3D(r,o,u){const p=new bt(o,u);if(r.elevation)return r.elevation.pointCoordinate(p);{const h=this.pointCoordinate(r,p.x,p.y,0);return[h.x,h.y,h.z]}}isPointAboveHorizon(r,o){if(r.elevation&&r.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(r,o.x,o.y);const u=r.horizonLineFromTop();return o.y<u}createInversionMatrix(r,o){return i$}createTileMatrix(r,o,u){let p,h,_;const w=u.canonical,E=de.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const A=Cy(w,this);p=1,h=A.x+u.wrap*A.scale,_=A.y,de.mat4.scale(E,E,[p/A.scale,p/A.scale,r.pixelsPerMeter/o])}else p=o/r.zoomScale(w.z),h=(w.x+Math.pow(2,w.z)*u.wrap)*p,_=w.y*p;return de.mat4.translate(E,E,[h,_,0]),de.mat4.scale(E,E,[p/Ct,p/Ct,1]),E}upVector(r,o,u){return[0,0,1]}upVectorScale(r,o,u){return{metersToTile:1}}}class s$ extends dd{constructor(r){super(r),this.range=[4,7],this.center=r.center||[-96,37.5];const[o,u]=this.parallels=r.parallels||[29.5,45.5],p=Math.sin(Be(o));this.n=(p+Math.sin(Be(u)))/2,this.c=1+p*(2*this.n-p),this.r0=Math.sqrt(this.c)/this.n}project(r,o){const{n:u,c:p,r0:h}=this,_=Be(r-this.center[0]),w=Be(o),E=Math.sqrt(p-2*u*Math.sin(w))/u;return{x:E*Math.sin(_*u),y:E*Math.cos(_*u)-h,z:0}}unproject(r,o){const{n:u,c:p,r0:h}=this,_=h+o;let w=Math.atan2(r,Math.abs(_))*Math.sign(_);_*u<0&&(w-=Math.PI*Math.sign(r)*Math.sign(_));const E=Be(this.center[0])*u;w=Xn(w,-Math.PI-E,Math.PI-E);const A=Bt(ut(w/u)+this.center[0],-180,180),v=Math.asin(Bt((p-(r*r+_*_)*u*u)/(2*u),-1,1)),C=Bt(ut(v),-wi,wi);return new sn(A,C)}}const My=1.340264,Ay=-.081106,Py=893e-6,Iy=.003796,y1=Math.sqrt(3)/2;class o$ extends dd{project(r,o){o=o/180*Math.PI,r=r/180*Math.PI;const u=Math.asin(y1*Math.sin(o)),p=u*u,h=p*p*p;return{x:.5*(r*Math.cos(u)/(y1*(My+3*Ay*p+h*(7*Py+9*Iy*p)))/Math.PI+.5),y:1-.5*(u*(My+Ay*p+h*(Py+Iy*p))/Math.PI+1),z:0}}unproject(r,o){r=(2*r-.5)*Math.PI;let u=o=(2*(1-o)-1)*Math.PI,p=u*u,h=p*p*p;for(let v,C,I,M=0;M<12&&(C=u*(My+Ay*p+h*(Py+Iy*p))-o,I=My+3*Ay*p+h*(7*Py+9*Iy*p),v=C/I,u=Bt(u-v,-Math.PI/3,Math.PI/3),p=u*u,h=p*p*p,!(Math.abs(v)<1e-12));++M);const _=y1*r*(My+3*Ay*p+h*(7*Py+9*Iy*p))/Math.cos(u),w=Math.asin(Math.sin(u)/y1),E=Bt(180*_/Math.PI,-180,180),A=Bt(180*w/Math.PI,-wi,wi);return new sn(E,A)}}class a$ extends dd{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0}project(r,o){return{x:.5+r/360,y:.5-o/360,z:0}}unproject(r,o){const u=360*(r-.5),p=Bt(360*(.5-o),-wi,wi);return new sn(u,p)}}const cm=Math.PI/2;function x1(c){return Math.tan((cm+c)/2)}class l$ extends dd{constructor(r){super(r),this.center=r.center||[0,30];const[o,u]=this.parallels=r.parallels||[30,30];let p=Be(o),h=Be(u);this.southernCenter=p+h<0,this.southernCenter&&(p=-p,h=-h);const _=Math.cos(p),w=x1(p);this.n=p===h?Math.sin(p):Math.log(_/Math.cos(h))/Math.log(x1(h)/w),this.f=_*Math.pow(x1(p),this.n)/this.n}project(r,o){o=Be(o),this.southernCenter&&(o=-o),r=Be(r-this.center[0]);const u=1e-6,{n:p,f:h}=this;h>0?o<-cm+u&&(o=-cm+u):o>cm-u&&(o=cm-u);const _=h/Math.pow(x1(o),p);let w=_*Math.sin(p*r),E=h-_*Math.cos(p*r);return w=.5*(w/Math.PI+.5),E=.5*(E/Math.PI+.5),{x:w,y:this.southernCenter?E:1-E,z:0}}unproject(r,o){r=(2*r-.5)*Math.PI,this.southernCenter&&(o=1-o),o=(2*(1-o)-.5)*Math.PI;const{n:u,f:p}=this,h=p-o,_=Math.sign(h),w=Math.sign(u)*Math.sqrt(r*r+h*h);let E=Math.atan2(r,Math.abs(h))*_;h*u<0&&(E-=Math.PI*Math.sign(r)*_);const A=Bt(ut(E/u)+this.center[0],-180,180),v=Bt(ut(2*Math.atan(Math.pow(p/w,1/u))-cm),-wi,wi);return new sn(A,this.southernCenter?-v:v)}}class _N extends dd{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(r,o){return{x:La(r),y:xs(o),z:0}}unproject(r,o){const u=Js(r),p=cs(o);return new sn(u,p)}}const yN=Be(wi);class c$ extends dd{project(r,o){const u=(o=Be(o))*o,p=u*u;return{x:.5*((r=Be(r))*(.8707-.131979*u+p*(p*(.003971*u-.001529*p)-.013791))/Math.PI+.5),y:1-.5*(o*(1.007226+u*(.015085+p*(.028874*u-.044475-.005916*p)))/Math.PI+1),z:0}}unproject(r,o){r=(2*r-.5)*Math.PI;let u=o=(2*(1-o)-1)*Math.PI,p=25,h=0,_=u*u;do{_=u*u;const A=_*_;h=(u*(1.007226+_*(.015085+A*(.028874*_-.044475-.005916*A)))-o)/(1.007226+_*(.045255+A*(.259866*_-.311325-.005916*11*A))),u=Bt(u-h,-yN,yN)}while(Math.abs(h)>1e-6&&--p>0);_=u*u;const w=Bt(ut(r/(.8707+_*(_*(_*_*_*(.003971-.001529*_)-.013791)-.131979))),-180,180),E=ut(u);return new sn(w,E)}}const xN=Be(wi);class u$ extends dd{project(r,o){o=Be(o),r=Be(r);const u=Math.cos(o),p=2/Math.PI,h=Math.acos(u*Math.cos(r/2)),_=Math.sin(h)/h,w=.5*(r*p+2*u*Math.sin(r/2)/_)||0,E=.5*(o+Math.sin(o)/_)||0;return{x:.5*(w/Math.PI+.5),y:1-.5*(E/Math.PI+1),z:0}}unproject(r,o){let u=r=(2*r-.5)*Math.PI,p=o=(2*(1-o)-1)*Math.PI,h=25;const _=1e-6;let w=0,E=0;do{const A=Math.cos(p),v=Math.sin(p),C=2*v*A,I=v*v,M=A*A,P=Math.cos(u/2),R=Math.sin(u/2),F=2*P*R,B=R*R,Z=1-M*P*P,W=Z?1/Z:0,G=Z?Math.acos(A*P)*Math.sqrt(1/Z):0,X=.5*(2*G*A*R+2*u/Math.PI)-r,ee=.5*(G*v+p)-o,ie=.5*W*(M*B+G*A*P*I)+1/Math.PI,ge=W*(F*C/4-G*v*R),fe=.125*W*(C*R-G*v*M*F),pe=.5*W*(I*P+G*B*A)+.5,Ce=ge*fe-pe*ie;w=(ee*ge-X*pe)/Ce,E=(X*fe-ee*ie)/Ce,u=Bt(u-w,-Math.PI,Math.PI),p=Bt(p-E,-xN,xN)}while((Math.abs(w)>_||Math.abs(E)>_)&&--h>0);return new sn(ut(u),ut(p))}}class vN extends dd{constructor(r){super(r),this.center=r.center||[0,0],this.parallels=r.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Be(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(r,o){const{scale:u,cosPhi:p}=this;return{x:Be(r)*p*u+.5,y:-Math.sin(Be(o))/p*u+.5,z:0}}unproject(r,o){const{scale:u,cosPhi:p}=this,h=-(o-.5)/u,_=Bt(ut((r-.5)/u)/p,-180,180),w=Math.asin(Bt(h*p,-1,1)),E=Bt(ut(w),-wi,wi);return new sn(_,E)}}class d$ extends _N{constructor(r){super(r),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(r,o,u){const p=an(r,o,u),h=Un(zi(u));return de.vec3.transformMat4(p,p,h),{x:p[0],y:p[1],z:p[2]}}locationPoint(r,o,u){const p=Gc(o.lat,o.lng),h=de.vec3.normalize([],p),_=u?r._centerAltitude+u:r.elevation?r.elevation.getAtPointOrZero(r.locationCoordinate(o),r._centerAltitude):r._centerAltitude,w=vs(1,0)*Ct*_;de.vec3.scaleAndAdd(p,p,h,w);const E=de.mat4.identity(new Float64Array(16));return de.mat4.multiply(E,r.pixelMatrix,r.globeMatrix),de.vec3.transformMat4(p,p,E),new bt(p[0],p[1])}pixelsPerMeter(r,o){return vs(1,0)*o}pixelSpaceConversion(r,o,u){const p=vs(1,r)*o,h=ur(vs(1,45)*o,p,u);return this.pixelsPerMeter(r,o)/h}createTileMatrix(r,o,u){const p=Fi(zi(u.canonical));return de.mat4.multiply(new Float64Array(16),r.globeMatrix,p)}createInversionMatrix(r,o){const{center:u}=r,p=Un(zi(o));return de.mat4.rotateY(p,p,Be(u.lng)),de.mat4.rotateX(p,p,Be(u.lat)),de.mat4.scale(p,p,[r._pixelsPerMercatorPixel,r._pixelsPerMercatorPixel,1]),Float32Array.from(p)}pointCoordinate(r,o,u,p){return Qr(r,o,u,!0)||new n(0,0)}pointCoordinate3D(r,o,u){const p=this.pointCoordinate(r,o,u,0);return[p.x,p.y,p.z]}isPointAboveHorizon(r,o){return!Qr(r,o.x,o.y,!1)}farthestPixelDistance(r){const o=function(p,h){const _=p.cameraToCenterDistance,w=p._centerAltitude*h,E=p._camera,A=p._camera.forward(),v=de.vec3.add([],de.vec3.scale([],A,-_),[0,0,w]),C=p.worldSize/(2*Math.PI),I=[0,0,-C],M=p.width/p.height,P=Math.tan(p.fovAboveCenter),R=de.vec3.scale([],E.up(),P),F=de.vec3.scale([],E.right(),P*M),B=de.vec3.normalize([],de.vec3.add([],de.vec3.add([],A,R),F)),Z=[];let W;if(new pr(v,B).closestPointOnSphere(I,C,Z)){const G=de.vec3.add([],Z,I),X=de.vec3.sub([],G,v);W=Math.cos(p.fovAboveCenter)*de.vec3.length(X)}else{const G=de.vec3.sub([],v,I),X=de.vec3.sub([],I,v);de.vec3.normalize(X,X);const ee=de.vec3.length(G)-C;W=Math.sqrt(ee*(ee+2*C));const ie=Math.acos(W/(C+ee))-Math.acos(de.vec3.dot(A,X));W*=Math.cos(ie)}return 1.01*W}(r,this.pixelsPerMeter(r.center.lat,r.worldSize)),u=Gs(r.zoom);if(u>0){const p=mN(r,vs(1,r.center.lat)*r.worldSize),h=r.worldSize/(2*Math.PI),_=Math.max(r.width,r.height)/r.worldSize*Math.PI;return ur(o,p+h*(1-Math.cos(_)),Math.pow(u,10))}return o}upVector(r,o,u){return an(o,u,r,1)}upVectorScale(r){return{metersToTile:Hr(Cn(zi(r)))}}}function bN(c){const r=c.parallels,o=!!r&&Math.abs(r[0]+r[1])<.01;switch(c.name){case"mercator":return new _N(c);case"equirectangular":return new a$(c);case"naturalEarth":return new c$(c);case"equalEarth":return new o$(c);case"winkelTripel":return new u$(c);case"albers":return o?new vN(c):new s$(c);case"lambertConformalConic":return o?new vN(c):new l$(c);case"globe":return new d$(c)}throw new Error(`Invalid projection name: ${c.name}`)}const h$=ad.VectorTileFeature.types,f$=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function v1(c,r,o,u,p,h,_,w,E,A,v,C,I){const M=w?Math.min(ud,Math.round(w[0])):0,P=w?Math.min(ud,Math.round(w[1])):0;c.emplaceBack(r,o,Math.round(32*u),Math.round(32*p),h,_,(M<<1)+(E?1:0),P,16*A,16*v,256*C,256*I)}function b1(c,r,o){c.emplaceBack(r,o)}function w1(c,r,o,u,p,h,_){c.emplaceBack(r,o,u,p,h,_)}function S1(c,r,o,u,p){c.emplaceBack(r,o,u,p),c.emplaceBack(r,o,u,p),c.emplaceBack(r,o,u,p),c.emplaceBack(r,o,u,p)}function p$(c){for(const r of c.sections)if(R0(r.text))return!0;return!1}class mT{constructor(r){this.layoutVertexArray=new H_,this.indexArray=new ls,this.programConfigurations=r,this.segments=new Hn,this.dynamicLayoutVertexArray=new Vc,this.opacityVertexArray=new Z_,this.placedSymbolArray=new U0,this.iconTransitioningVertexArray=new rc,this.globeExtVertexArray=new W_,this.zOffsetVertexArray=new Bc}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(r,o,u,p,h){this.isEmpty()||(u&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,P8.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,k8.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,f$,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=r.createVertexBuffer(this.iconTransitioningVertexArray,R8.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,I8.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||h)&&(this.zOffsetVertexBuffer=r.createVertexBuffer(this.zOffsetVertexArray,N8.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||p)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}zt(mT,"SymbolBuffers");class gT{constructor(r,o,u){this.layoutVertexArray=new r,this.layoutAttributes=o,this.indexArray=new u,this.segments=new Hn,this.collisionVertexArray=new K_,this.collisionVertexArrayExt=new Vc}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,j8.members,!0),this.collisionVertexBufferExt=r.createVertexBuffer(this.collisionVertexArrayExt,D8.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}zt(gT,"CollisionBuffers");class T1{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.lut=r.lut,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(_=>_.fqid),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=de.mat4.identity([]),this.placementViewportMatrix=de.mat4.identity([]);const o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=iT(this.zoom,o["text-size"]),this.iconSizeData=iT(this.zoom,o["icon-size"]);const u=this.layers[0].layout,p=u.get("symbol-sort-key"),h=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=h!=="viewport-y"&&p.constantOr(1)!==void 0,this.sortFeaturesByY=(h==="viewport-y"||h==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(_=>xo[_]),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=r.sourceID,this.projection=r.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new mT(new ic(this.layers,{zoom:this.zoom,lut:this.lut},r=>r.startsWith("text")||r.startsWith("symbol"))),this.icon=new mT(new ic(this.layers,{zoom:this.zoom,lut:this.lut},r=>r.startsWith("icon")||r.startsWith("symbol"))),this.glyphOffsetArray=new q0,this.lineVertexArray=new Xh,this.symbolInstances=new G0}calculateGlyphDependencies(r,o,u,p,h){for(const _ of r){const w=_.codePointAt(0);if(w===void 0)break;if(o[w]=!0,p&&h&&w<=65535){const E=by[_];E&&(o[E.charCodeAt(0)]=!0)}}}updateFootprints(r,o){}updateReplacement(r,o){if(o.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=o.updateTime;const u=o.getReplacementRegionsForTile(r.toUnwrapped(),!0);return!KS(this.activeReplacements,u)&&(this.activeReplacements=u,!0)}populate(r,o,u,p){const h=this.layers[0],_=h.layout,w=this.projection.name==="globe",E=_.get("text-font"),A=_.get("text-field"),v=_.get("icon-image"),[C,I]=_.get("icon-size-scale-range"),M=Bt(o.scaleFactor||1,C,I),P=(A.value.kind!=="constant"||A.value.value instanceof As&&!A.value.value.isEmpty()||A.value.value.toString().length>0)&&(E.value.kind!=="constant"||E.value.value.length>0),R=v.value.kind!=="constant"||!!v.value.value||Object.keys(v.parameters).length>0,F=_.get("symbol-sort-key");if(this.features=[],!P&&!R)return;const B=o.iconDependencies,Z=o.glyphDependencies,W=o.availableImages,G=new kn(this.zoom);for(const{feature:X,id:ee,index:ie,sourceLayerIndex:ge}of r){const fe=h._featureFilter.needGeometry,pe=z(X,fe);if(!h._featureFilter.filter(G,pe,u))continue;if(fe||(pe.geometry=L(X,u,p)),w&&X.type!==1&&u.z<=5){const ke=pe.geometry,Oe=.98078528056,Le=(Ge,Ve)=>{const He=an(Ge.x,Ge.y,u,1),gt=an(Ve.x,Ve.y,u,1);return de.vec3.dot(He,gt)<Oe};for(let Ge=0;Ge<ke.length;Ge++)ke[Ge]=b(ke[Ge],Le)}let Ce,_e;if(P){const ke=h.getValueAndResolveTokens("text-field",pe,u,W),Oe=As.factory(ke);p$(Oe)&&(this.hasRTLText=!0),(!this.hasRTLText||zp()==="unavailable"||this.hasRTLText&&zo.isParsed())&&(Ce=z8(Oe,h,pe))}if(R){const ke=h.getValueAndResolveTokens("icon-image",pe,u,W);_e=ke instanceof Ps?ke:Ps.build(ke)}if(!Ce&&!_e)continue;const Me=this.sortFeaturesByKey?F.evaluate(pe,{},u):void 0,Re={id:ee,text:Ce,icon:_e,index:ie,sourceLayerIndex:ge,geometry:pe.geometry,properties:X.properties,type:h$[X.type],sortKey:Me};if(this.features.push(Re),_e){const ke=this.layers[0]._unevaluatedLayout._values,{iconPrimary:Oe,iconSecondary:Le}=dN(_e,this.iconSizeData,ke["icon-size"],u,this.zoom,Re,this.pixelRatio,M),Ge=Oe.id.toString();if(B.has(Ge)?B.get(Ge).push(Oe):B.set(Ge,[Oe]),Le){const Ve=Le.id.toString();B.has(Ve)?B.get(Ve).push(Le):B.set(Ve,[Le])}}if(Ce){const ke=E.evaluate(pe,{},u).join(","),Oe=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(xo.vertical)>=0;for(const Le of Ce.sections)if(Le.image){const Ge=Le.image.getPrimary().scaleSelf(this.pixelRatio),Ve=Ge.id.toString(),He=B.get(Ve)||[];He.push(Ge),B.set(Ve,He)}else{const Ge=N_(Ce.toString()),Ve=Le.fontStack||ke,He=Z[Ve]=Z[Ve]||{};this.calculateGlyphDependencies(Le.text,He,Oe,this.allowVerticalPlacement,Ge)}}}if(_.get("symbol-placement")==="line"&&(this.features=function(X){const ee={},ie={},ge=[];let fe=0;function pe(Re){ge.push(X[Re]),fe++}function Ce(Re,ke,Oe){const Le=ie[Re];return delete ie[Re],ie[ke]=Le,ge[Le].geometry[0].pop(),ge[Le].geometry[0]=ge[Le].geometry[0].concat(Oe[0]),Le}function _e(Re,ke,Oe){const Le=ee[ke];return delete ee[ke],ee[Re]=Le,ge[Le].geometry[0].shift(),ge[Le].geometry[0]=Oe[0].concat(ge[Le].geometry[0]),Le}function Me(Re,ke,Oe){const Le=Oe?ke[0][ke[0].length-1]:ke[0][0];return`${Re}:${Le.x}:${Le.y}`}for(let Re=0;Re<X.length;Re++){const ke=X[Re],Oe=ke.geometry,Le=ke.text?ke.text.toString():null;if(!Le){pe(Re);continue}const Ge=Me(Le,Oe),Ve=Me(Le,Oe,!0);if(Ge in ie&&Ve in ee&&ie[Ge]!==ee[Ve]){const He=_e(Ge,Ve,Oe),gt=Ce(Ge,Ve,ge[He].geometry);delete ee[Ge],delete ie[Ve],ie[Me(Le,ge[gt].geometry,!0)]=gt,ge[He].geometry=null}else Ge in ie?Ce(Ge,Ve,Oe):Ve in ee?_e(Ge,Ve,Oe):(pe(Re),ee[Ge]=fe-1,ie[Ve]=fe-1)}return ge.filter(Re=>Re.geometry)}(this.features)),_.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",o.elevationFeatures){!this.elevationFeatures&&o.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const X of o.elevationFeatures)this.elevationFeatureIdToIndex.set(X.id,this.elevationFeatures.length),this.elevationFeatures.push(X)}}else _.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((X,ee)=>X.sortKey-ee.sortKey)}update(r,o,u,p,h,_,w){this.text.programConfigurations.updatePaintArrays(r,o,h,u,p,_,w),this.icon.programConfigurations.updatePaintArrays(r,o,h,u,p,_,w)}updateRoadElevation(){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let r=!1;for(let o=0;o<this.symbolInstances.length;o++){const u=this.symbolInstances.get(o);if(u.elevationFeatureIndex===65535)continue;const p=this.elevationFeatures[u.elevationFeatureIndex];if(p){const h=.05+p.pointElevation(new bt(u.tileAnchorX,u.tileAnchorY));u.zOffset!==h&&(r=!0,u.zOffset=h)}}r&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const r=(h,_,w)=>{u+=_,u>h.length&&h.resize(u);for(let E=-_;E<0;E++)h.emplace(E+u,w)},o=(h,_,w)=>{p+=_,p>h.length&&h.resize(p);for(let E=-_;E<0;E++)h.emplace(E+p,w)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let u=0,p=0;for(let h=0;h<this.symbolInstances.length;h++){const _=this.symbolInstances.get(h),{numHorizontalGlyphVertices:w,numVerticalGlyphVertices:E,numIconVertices:A}=_,v=_.zOffset,C=A>0;if((w>0||E>0)&&(r(this.text.zOffsetVertexArray,w,v),r(this.text.zOffsetVertexArray,E,v)),C){const{placedIconSymbolIndex:I,verticalPlacedIconSymbolIndex:M}=_;I>=0&&o(this.icon.zOffsetVertexArray,A,v),M>=0&&o(this.icon.zOffsetVertexArray,_.numVerticalIconVertices,v)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=bN(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,o){const u=this.lineVertexArray.length;if(r.segment!==void 0)for(const{x:p,y:h}of o)this.lineVertexArray.emplaceBack(p,h);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(r,o,u,p,h,_,w,E,A,v,C,I,M,P,R,F){const B=r.indexArray,Z=r.layoutVertexArray,W=r.globeExtVertexArray,G=r.segments.prepareSegment(4*o.length,Z,B,this.canOverlap?_.sortKey:void 0),X=this.glyphOffsetArray.length,ee=G.vertexLength,ie=this.allowVerticalPlacement&&w===xo.vertical?Math.PI/2:0,ge=_.text&&_.text.sections;for(let pe=0;pe<o.length;pe++){const{tl:Ce,tr:_e,bl:Me,br:Re,texPrimary:ke,texSecondary:Oe,pixelOffsetTL:Le,pixelOffsetBR:Ge,minFontScaleX:Ve,minFontScaleY:He,glyphOffset:gt,isSDF:ft,sectionIndex:Ft}=o[pe],xt=G.vertexLength,Et=gt[1];if(v1(Z,A.x,A.y,Ce.x,Et+Ce.y,ke.x,ke.y,u,ft,Le.x,Le.y,Ve,He),v1(Z,A.x,A.y,_e.x,Et+_e.y,ke.x+ke.w,ke.y,u,ft,Ge.x,Le.y,Ve,He),v1(Z,A.x,A.y,Me.x,Et+Me.y,ke.x,ke.y+ke.h,u,ft,Le.x,Ge.y,Ve,He),v1(Z,A.x,A.y,Re.x,Et+Re.y,ke.x+ke.w,ke.y+ke.h,u,ft,Ge.x,Ge.y,Ve,He),E){const{x:_t,y:lr,z:Dt}=E.anchor,[Zt,gr,jr]=E.up;w1(W,_t,lr,Dt,Zt,gr,jr),w1(W,_t,lr,Dt,Zt,gr,jr),w1(W,_t,lr,Dt,Zt,gr,jr),w1(W,_t,lr,Dt,Zt,gr,jr),S1(r.dynamicLayoutVertexArray,_t,lr,Dt,ie)}else S1(r.dynamicLayoutVertexArray,A.x,A.y,A.z,ie);if(F){const _t=Oe||ke;b1(r.iconTransitioningVertexArray,_t.x,_t.y),b1(r.iconTransitioningVertexArray,_t.x+_t.w,_t.y),b1(r.iconTransitioningVertexArray,_t.x,_t.y+_t.h),b1(r.iconTransitioningVertexArray,_t.x+_t.w,_t.y+_t.h)}B.emplaceBack(xt,xt+1,xt+2),B.emplaceBack(xt+1,xt+2,xt+3),G.vertexLength+=4,G.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(gt[0]),pe!==o.length-1&&Ft===o[pe+1].sectionIndex||r.programConfigurations.populatePaintArrays(Z.length,_,_.index,{},M,P,R,ge&&ge[Ft])}const fe=E?E.anchor:A;r.placedSymbolArray.emplaceBack(fe.x,fe.y,fe.z,A.x,A.y,X,this.glyphOffsetArray.length-X,ee,v,C,A.segment,u?u[0]:0,u?u[1]:0,p[0],p[1],w,0,!1,0,I,0)}_commitLayoutVertex(r,o,u,p,h,_,w){r.emplaceBack(o,u,p,h,_,Math.round(w.x),Math.round(w.y))}_addCollisionDebugVertices(r,o,u,p,h,_,w){const E=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),A=E.vertexLength,v=w.tileAnchorX,C=w.tileAnchorY;for(let M=0;M<4;M++)u.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(u.collisionVertexArrayExt,o,r.padding,w.zOffset),this._commitLayoutVertex(u.layoutVertexArray,p,h,_,v,C,new bt(r.x1,r.y1)),this._commitLayoutVertex(u.layoutVertexArray,p,h,_,v,C,new bt(r.x2,r.y1)),this._commitLayoutVertex(u.layoutVertexArray,p,h,_,v,C,new bt(r.x2,r.y2)),this._commitLayoutVertex(u.layoutVertexArray,p,h,_,v,C,new bt(r.x1,r.y2)),E.vertexLength+=4;const I=u.indexArray;I.emplaceBack(A,A+1),I.emplaceBack(A+1,A+2),I.emplaceBack(A+2,A+3),I.emplaceBack(A+3,A),E.primitiveLength+=4}_addTextDebugCollisionBoxes(r,o,u,p,h,_){for(let w=p;w<h;w++){const E=u.get(w),A=this.getSymbolInstanceTextSize(r,_,o,w);this._addCollisionDebugVertices(E,A,this.textCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(r,o,u,p,h,_){for(let w=p;w<h;w++){const E=u.get(w),A=this.getSymbolInstanceIconSize(r,o,_.placedIconSymbolIndex);this._addCollisionDebugVertices(E,A,this.iconCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,_)}}generateCollisionDebugBuffers(r,o,u){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new gT(Wh,Ok.members,rc),this.iconCollisionBox=new gT(Wh,Ok.members,rc);const p=im(this.iconSizeData,r),h=im(this.textSizeData,r,u);for(let _=0;_<this.symbolInstances.length;_++){const w=this.symbolInstances.get(_);this._addTextDebugCollisionBoxes(h,r,o,w.textBoxStartIndex,w.textBoxEndIndex,w),this._addTextDebugCollisionBoxes(h,r,o,w.verticalTextBoxStartIndex,w.verticalTextBoxEndIndex,w),this._addIconDebugCollisionBoxes(p,r,o,w.iconBoxStartIndex,w.iconBoxEndIndex,w),this._addIconDebugCollisionBoxes(p,r,o,w.verticalIconBoxStartIndex,w.verticalIconBoxEndIndex,w)}}getSymbolInstanceTextSize(r,o,u,p){const h=this.text.placedSymbolArray.get(o.rightJustifiedTextSymbolIndex>=0?o.rightJustifiedTextSymbolIndex:o.centerJustifiedTextSymbolIndex>=0?o.centerJustifiedTextSymbolIndex:o.leftJustifiedTextSymbolIndex>=0?o.leftJustifiedTextSymbolIndex:o.verticalPlacedTextSymbolIndex>=0?o.verticalPlacedTextSymbolIndex:p),_=d1(this.textSizeData,r,h)/ws;return this.tilePixelRatio*_}getSymbolInstanceIconSize(r,o,u){const p=this.icon.placedSymbolArray.get(u),h=d1(this.iconSizeData,r,p);return this.tilePixelRatio*h}_commitDebugCollisionVertexUpdate(r,o,u,p){r.emplaceBack(o,-u,-u,p),r.emplaceBack(o,u,-u,p),r.emplaceBack(o,u,u,p),r.emplaceBack(o,-u,u,p)}_updateTextDebugCollisionBoxes(r,o,u,p,h,_,w){for(let E=p;E<h;E++){const A=u.get(E),v=this.getSymbolInstanceTextSize(r,_,o,E);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,v,A.padding,_.zOffset)}}_updateIconDebugCollisionBoxes(r,o,u,p,h,_,w){for(let E=p;E<h;E++){const A=u.get(E),v=this.getSymbolInstanceIconSize(r,o,_.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,v,A.padding,_.zOffset)}}updateCollisionDebugBuffers(r,o,u,p){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const h=im(this.iconSizeData,r,p),_=im(this.textSizeData,r,u);for(let w=0;w<this.symbolInstances.length;w++){const E=this.symbolInstances.get(w);this._updateTextDebugCollisionBoxes(_,r,o,E.textBoxStartIndex,E.textBoxEndIndex,E,u),this._updateTextDebugCollisionBoxes(_,r,o,E.verticalTextBoxStartIndex,E.verticalTextBoxEndIndex,E,u),this._updateIconDebugCollisionBoxes(h,r,o,E.iconBoxStartIndex,E.iconBoxEndIndex,E,p),this._updateIconDebugCollisionBoxes(h,r,o,E.verticalIconBoxStartIndex,E.verticalIconBoxEndIndex,E,p)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(r,o,u,p,h,_,w,E,A){const v={};if(o<u){const{x1:C,y1:I,x2:M,y2:P,padding:R,projectedAnchorX:F,projectedAnchorY:B,projectedAnchorZ:Z,tileAnchorX:W,tileAnchorY:G,featureIndex:X}=r.get(o);v.textBox={x1:C,y1:I,x2:M,y2:P,padding:R,projectedAnchorX:F,projectedAnchorY:B,projectedAnchorZ:Z,tileAnchorX:W,tileAnchorY:G},v.textFeatureIndex=X}if(p<h){const{x1:C,y1:I,x2:M,y2:P,padding:R,projectedAnchorX:F,projectedAnchorY:B,projectedAnchorZ:Z,tileAnchorX:W,tileAnchorY:G,featureIndex:X}=r.get(p);v.verticalTextBox={x1:C,y1:I,x2:M,y2:P,padding:R,projectedAnchorX:F,projectedAnchorY:B,projectedAnchorZ:Z,tileAnchorX:W,tileAnchorY:G},v.verticalTextFeatureIndex=X}if(_<w){const{x1:C,y1:I,x2:M,y2:P,padding:R,projectedAnchorX:F,projectedAnchorY:B,projectedAnchorZ:Z,tileAnchorX:W,tileAnchorY:G,featureIndex:X}=r.get(_);v.iconBox={x1:C,y1:I,x2:M,y2:P,padding:R,projectedAnchorX:F,projectedAnchorY:B,projectedAnchorZ:Z,tileAnchorX:W,tileAnchorY:G},v.iconFeatureIndex=X}if(E<A){const{x1:C,y1:I,x2:M,y2:P,padding:R,projectedAnchorX:F,projectedAnchorY:B,projectedAnchorZ:Z,tileAnchorX:W,tileAnchorY:G,featureIndex:X}=r.get(E);v.verticalIconBox={x1:C,y1:I,x2:M,y2:P,padding:R,projectedAnchorX:F,projectedAnchorY:B,projectedAnchorZ:Z,tileAnchorX:W,tileAnchorY:G},v.verticalIconFeatureIndex=X}return v}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let o=0;o<this.symbolInstances.length;o++){const u=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(r,o){const u=r.placedSymbolArray.get(o),p=u.vertexStartIndex+4*u.numGlyphs;for(let h=u.vertexStartIndex;h<p;h+=4)r.indexArray.emplaceBack(h,h+1,h+2),r.indexArray.emplaceBack(h+1,h+2,h+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const o=Math.sin(r),u=Math.cos(r),p=[],h=[],_=[];for(let w=0;w<this.symbolInstances.length;++w){_.push(w);const E=this.symbolInstances.get(w);p.push(0|Math.round(o*E.tileAnchorX+u*E.tileAnchorY)),h.push(E.featureIndex)}return _.sort((w,E)=>p[w]-p[E]||h[E]-h[w]),_}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let r=0;r<this.symbolInstances.length;++r)this.symbolInstanceIndexesSortedZOffset.push(r)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((r,o)=>this.symbolInstances.get(o).zOffset-this.symbolInstances.get(r).zOffset)}addToSortKeyRanges(r,o){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===o?u.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const o of this.symbolInstanceIndexes){const u=this.symbolInstances.get(o);this.featureSortOrder.push(u.featureIndex);const{rightJustifiedTextSymbolIndex:p,centerJustifiedTextSymbolIndex:h,leftJustifiedTextSymbolIndex:_,verticalPlacedTextSymbolIndex:w,placedIconSymbolIndex:E,verticalPlacedIconSymbolIndex:A}=u;p>=0&&this.addIndicesForPlacedSymbol(this.text,p),h>=0&&h!==p&&this.addIndicesForPlacedSymbol(this.text,h),_>=0&&_!==h&&_!==p&&this.addIndicesForPlacedSymbol(this.text,_),w>=0&&this.addIndicesForPlacedSymbol(this.text,w),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E),A>=0&&this.addIndicesForPlacedSymbol(this.icon,A)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let wN,SN,_T;zt(T1,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),T1.addDynamicAttributes=S1;class TN{constructor(r){this.type=r.property.overrides?r.property.overrides.runtimeType:Eu,this.defaultValue=r}evaluate(r){if(r.formattedSection){const o=this.defaultValue.property.overrides;if(o&&o.hasOverride(r.formattedSection))return o.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}zt(TN,"FormatSectionOverride",{omit:["defaultValue"]});const yT=()=>_T||(_T={layout:wN||(wN=new ii({"symbol-placement":new Tt(We.layout_symbol["symbol-placement"]),"symbol-spacing":new Tt(We.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Tt(We.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ot(We.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Tt(We.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Tt(We.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Tt(We.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Tt(We.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Tt(We.layout_symbol["icon-ignore-placement"]),"icon-optional":new Tt(We.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Tt(We.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ot(We.layout_symbol["icon-size"]),"icon-size-scale-range":new Tt(We.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Ot(We.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ot(We.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ot(We.layout_symbol["icon-image"]),"icon-rotate":new Ot(We.layout_symbol["icon-rotate"]),"icon-padding":new Tt(We.layout_symbol["icon-padding"]),"icon-keep-upright":new Tt(We.layout_symbol["icon-keep-upright"]),"icon-offset":new Ot(We.layout_symbol["icon-offset"]),"icon-anchor":new Ot(We.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Tt(We.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Tt(We.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Tt(We.layout_symbol["text-rotation-alignment"]),"text-field":new Ot(We.layout_symbol["text-field"]),"text-font":new Ot(We.layout_symbol["text-font"]),"text-size":new Ot(We.layout_symbol["text-size"]),"text-size-scale-range":new Tt(We.layout_symbol["text-size-scale-range"]),"text-max-width":new Ot(We.layout_symbol["text-max-width"]),"text-line-height":new Ot(We.layout_symbol["text-line-height"]),"text-letter-spacing":new Ot(We.layout_symbol["text-letter-spacing"]),"text-justify":new Ot(We.layout_symbol["text-justify"]),"text-radial-offset":new Ot(We.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Tt(We.layout_symbol["text-variable-anchor"]),"text-anchor":new Ot(We.layout_symbol["text-anchor"]),"text-max-angle":new Tt(We.layout_symbol["text-max-angle"]),"text-writing-mode":new Tt(We.layout_symbol["text-writing-mode"]),"text-rotate":new Ot(We.layout_symbol["text-rotate"]),"text-padding":new Tt(We.layout_symbol["text-padding"]),"text-keep-upright":new Tt(We.layout_symbol["text-keep-upright"]),"text-transform":new Ot(We.layout_symbol["text-transform"]),"text-offset":new Ot(We.layout_symbol["text-offset"]),"text-allow-overlap":new Tt(We.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Tt(We.layout_symbol["text-ignore-placement"]),"text-optional":new Tt(We.layout_symbol["text-optional"]),visibility:new Tt(We.layout_symbol.visibility)})),paint:SN||(SN=new ii({"icon-opacity":new Ot(We.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Ot(We.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Ot(We.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Ot(We.paint_symbol["text-emissive-strength"]),"icon-color":new Ot(We.paint_symbol["icon-color"]),"icon-halo-color":new Ot(We.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ot(We.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ot(We.paint_symbol["icon-halo-blur"]),"icon-translate":new Tt(We.paint_symbol["icon-translate"]),"icon-translate-anchor":new Tt(We.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Ot(We.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Ot(We.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Ot(We.paint_symbol["text-occlusion-opacity"]),"text-color":new Ot(We.paint_symbol["text-color"],{runtimeType:Ms,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new Ot(We.paint_symbol["text-halo-color"]),"text-halo-width":new Ot(We.paint_symbol["text-halo-width"]),"text-halo-blur":new Ot(We.paint_symbol["text-halo-blur"]),"text-translate":new Tt(We.paint_symbol["text-translate"]),"text-translate-anchor":new Tt(We.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Tt(We.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Tt(We.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Tt(We.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Tt(We.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Ot(We.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Ot({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Ot({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Ot({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Ot({type:"string",default:"default","property-type":"data-driven"})}))},_T);class E1 extends es{constructor(r,o,u,p){super(r,yT(),o,u,p),this._colorAdjustmentMatrix=de.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=r.paint!==void 0&&("icon-occlusion-opacity"in r.paint||"text-occlusion-opacity"in r.paint)}recalculate(r,o){super.recalculate(r,o),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const p=[];for(const h of u)p.indexOf(h)<0&&p.push(h);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(r,o,u,p){return this._saturation===r&&this._contrast===o&&this._brightnessMin===u&&this._brightnessMax===p||(this._colorAdjustmentMatrix=function(h,_,w,E){h=tt(h),_=Sh(_);const A=de.mat4.create(),v=h/3,C=1-2*v,I=[C,v,v,0,v,C,v,0,v,v,C,0,0,0,0,1],M=.5-.5*_,P=E-w;return de.mat4.multiply(A,[P,0,0,0,0,P,0,0,0,0,P,0,w,w,w,1],[_,0,0,0,0,_,0,0,0,0,_,0,M,M,M,1]),de.mat4.multiply(A,A,I),A}(r,o,u,p),this._saturation=r,this._contrast=o,this._brightnessMin=u,this._brightnessMax=p),this._colorAdjustmentMatrix}getValueAndResolveTokens(r,o,u,p){const h=this.layout.get(r).evaluate(o,{},u,p),_=this._unevaluatedLayout._values[r];return _.isDataDriven()||kp(_.value)||!h?h:function(w,E){return E.replace(/{([^{}]+)}/g,(A,v)=>v in w?String(w[v]):"")}(o.properties,h)}createBucket(r){return new T1(r)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const r of yT().paint.overridableProperties){if(!E1.hasPaintOverride(this.layout,r))continue;const o=this.paint.get(r),u=new TN(o),p=new M_(u,o.property.specification,this.scope,this.options);let h=null;h=o.value.kind==="constant"||o.value.kind==="source"?new A_("source",p):new $u("composite",p,o.value.zoomStops,o.value._interpolationType),this.paint._values[r]=new Zu(o.property,h,o.parameters)}}_handleOverridablePaintPropertyUpdate(r,o,u){return!(!this.layout||o.isDataDriven()||u.isDataDriven())&&E1.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,o){const u=r.get("text-field"),p=yT().paint.properties[o];let h=!1;const _=w=>{for(const E of w)if(p.overrides&&p.overrides.hasOverride(E))return void(h=!0)};if(u.value.kind==="constant"&&u.value.value instanceof As)_(u.value.value.sections);else if(u.value.kind==="source"){const w=A=>{h||(A instanceof tl&&ki(A.value)===Ch?_(A.value.sections):A instanceof Pu?_(A.sections):A.eachChild(w))},E=u.value;E._styleExpression&&w(E._styleExpression.expression)}return h}getProgramIds(){return["symbol"]}getDefaultProgramParams(r,o,u){return{config:new $c(this,{zoom:o,lut:u}),overrideFog:!1}}}let EN,CN,MN,AN;var xT=nn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function vT(c){switch(c){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function bT(c){switch(c){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class wT{constructor(r,o,u,p){this.context=r,this.format=u,this.useMipmap=p&&p.useMipmap,this.texture=r.gl.createTexture(),this.update(o,{premultiply:p&&p.premultiply})}update(r,o){const u=r&&r instanceof HTMLVideoElement&&r.width===0?r.videoWidth:r.width,p=r&&r instanceof HTMLVideoElement&&r.height===0?r.videoHeight:r.height,{context:h}=this,{gl:_}=h,{x:w,y:E}=o&&o.position?o.position:{x:0,y:0},A=w+u,v=E+p;!this.size||this.size[0]===A&&this.size[1]===v||(_.bindTexture(_.TEXTURE_2D,null),_.deleteTexture(this.texture),this.texture=_.createTexture(),this.size=null),_.bindTexture(_.TEXTURE_2D,this.texture),h.pixelStoreUnpackFlipY.set(!1),h.pixelStoreUnpack.set(1),h.pixelStoreUnpackPremultiplyAlpha.set(this.format===_.RGBA8&&(!o||o.premultiply!==!1));const C=r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||ImageBitmap&&r instanceof ImageBitmap;if(!this.size&&A>0&&v>0){const I=this.useMipmap?Math.floor(Math.log2(Math.max(A,v)))+1:1;_.texStorage2D(_.TEXTURE_2D,I,this.format,A,v),this.size=[A,v]}if(this.size)if(C)_.texSubImage2D(_.TEXTURE_2D,0,w,E,vT(this.format),bT(this.format),r);else{const I=r.data;I&&_.texSubImage2D(_.TEXTURE_2D,0,w,E,u,p,vT(this.format),bT(this.format),I)}this.useMipmap&&_.generateMipmap(_.TEXTURE_2D)}bind(r,o,u=!1){const{context:p}=this,{gl:h}=p;h.bindTexture(h.TEXTURE_2D,this.texture),r!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,r),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap&&!u?r===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_LINEAR:r),this.minFilter=r),o!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,o),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,o),this.wrapS=o)}bindExtraParam(r,o,u,p){const{context:h}=this,{gl:_}=h;_.bindTexture(_.TEXTURE_2D,this.texture),o!==this.magFilter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,o),this.magFilter=o),r!==this.minFilter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,this.useMipmap?r===_.NEAREST?_.NEAREST_MIPMAP_NEAREST:_.LINEAR_MIPMAP_LINEAR:r),this.minFilter=r),u!==this.wrapS&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,u),this.wrapS=u),p!==this.wrapT&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,p),this.wrapT=p)}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}class C1{constructor(r,o){this.context=r,this.texture=o}bind(r,o){const{context:u}=this,{gl:p}=u;p.bindTexture(p.TEXTURE_2D,this.texture),r!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,r),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,r),this.minFilter=r),o!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,o),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,o),this.wrapS=o)}}function M1(c,r,o,u,p,h,_,w){const E=[c,r,1,o,u,1,p,h,1],A=[_,w,1],v=de.mat3.adjoint([],E),[C,I,M]=de.vec3.transformMat3(A,A,v);return de.mat3.multiply(E,E,[C,0,0,0,I,0,0,0,M])}function PN(c,r,o,u,p,h,_,w){const E=function(A,v,C,I,M,P,R,F){const B=M1(0,0,1,0,1,1,0,1),Z=M1(A,v,C,I,M,P,R,F),W=de.mat3.adjoint([],B);return de.mat3.multiply(Z,Z,W)}(c,r,o,u,p,h,_,w);return[E[2]/E[8]/Ct,E[5]/E[8]/Ct]}function A1(c){return[c[0],Math.min(Math.max(c[1],-wi),wi)]}class IN extends sa{constructor(r,o,u,p){super(),this.id=r,this.dispatcher=u,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(p),this.options=o,this._dirty=!1}load(r,o){if(this._loaded=o||!1,this.fire(new Ys("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return r&&(this.coordinates=r),this._loaded=!0,void this._finishLoading();this._imageRequest=Yg(this.map._requestManager.transformRequest(this.url,Ji.Image),(u,p)=>{this._imageRequest=null,this._loaded=!0,u?this.fire(new Tu(u)):p&&(this.image=p instanceof HTMLImageElement?et.getImageData(p):p,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,r&&(this.coordinates=r),this._finishLoading())})}loaded(){return this._loaded}updateImage(r){return r.url?(this._imageRequest&&r.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=r.url,this.load(r.coordinates,this._loaded),this):this}setTexture(r){if(!(r.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new C1(this.map.painter.context,r.handle),this.width=r.dimensions[0],this.height=r.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Ys("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(r){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof C1||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(r){if(this.coordinates=r,this._boundsArray=void 0,this._unsupportedCoords=!1,!r.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let o=r[0][1],u=r[0][1];for(const h of r)h[1]>u&&(u=h[1]),h[1]<o&&(o=h[1]);const p=(u+o)/2;if(p>wi?this.onNorthPole=!0:p<-wi&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const h=r.map(n.fromLngLat);this.tileID=function(_){let w=1/0,E=1/0,A=-1/0,v=-1/0;for(const R of _)w=Math.min(w,R.x),E=Math.min(E,R.y),A=Math.max(A,R.x),v=Math.max(v,R.y);const C=Math.max(A-w,v-E),I=Math.max(0,Math.floor(-Math.log(C)/Math.LN2)),M=Math.pow(2,I);let P=Math.floor((w+A)/2*M);return P>1&&(P-=1),new ht(I,P,Math.floor((E+v)/2*M))}(h),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Ys("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(r){for(const B in this.tiles){const Z=this.tiles[B];Z.state!=="loaded"&&(Z.state="loaded",Z.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const o=Cy(new ht(0,0,0),this.map.transform.projection),u=[o.projection.project(this.coordinates[0][0],this.coordinates[0][1]),o.projection.project(this.coordinates[1][0],this.coordinates[1][1]),o.projection.project(this.coordinates[2][0],this.coordinates[2][1]),o.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(B){const Z=B[1].x-B[0].x,W=B[1].y-B[0].y,G=B[2].x-B[1].x,X=B[2].y-B[1].y,ee=B[3].x-B[2].x,ie=B[3].y-B[2].y,ge=B[0].x-B[3].x,fe=B[0].y-B[3].y,pe=Z*X-G*W,Ce=G*ie-ee*X,_e=ee*fe-ge*ie,Me=ge*W-Z*fe;return pe>0&&Ce>0&&_e>0&&Me>0||pe<0&&Ce<0&&_e<0&&Me<0}(u))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const p=Cy(this.tileID,this.map.transform.projection),[h,_,w,E]=this.coordinates.map(B=>{const Z=p.projection.project(B[0],B[1]);return gN(p,Z)._round()});this.perspectiveTransform=PN(h.x,h.y,_.x,_.y,w.x,w.y,E.x,E.y);const A=this._boundsArray=new dl;A.emplaceBack(h.x,h.y,0,0),A.emplaceBack(_.x,_.y,Ct,0),A.emplaceBack(E.x,E.y,0,Ct),A.emplaceBack(w.x,w.y,Ct,Ct),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=r.createVertexBuffer(A,xT.members),this.boundsSegments=Hn.simpleSegment(0,0,4,2);const v=[],C=[A1((I=this.coordinates)[0]),A1(I[1]),A1(I[2]),A1(I[3])];var I;const[M,P,R,F]=function(B){let Z=B[0][0],W=Z,G=B[0][1],X=G;for(let ee=1;ee<B.length;ee++)B[ee][0]<Z?Z=B[ee][0]:B[ee][0]>W&&(W=B[ee][0]),B[ee][1]<G?G=B[ee][1]:B[ee][1]>X&&(X=B[ee][1]);return[Z,G,W-Z,X-G]}(C);{const B=new dl,[Z,W,G,X]=function(Le){let Ge=Le[0].x,Ve=Ge,He=Le[0].y,gt=He;for(let ft=1;ft<Le.length;ft++)Le[ft].x<Ge?Ge=Le[ft].x:Le[ft].x>Ve&&(Ve=Le[ft].x),Le[ft].y<He?He=Le[ft].y:Le[ft].y>gt&&(gt=Le[ft].y);return[Ge,He,Ve-Ge,gt-He]}(u),ee=Le=>[(Le.x-Z)/G,(Le.y-W)/X],[ie,ge,fe,pe]=u.map(ee),Ce=function(Le,Ge,Ve,He,gt,ft,Ft,xt){const Et=M1(0,0,1,0,1,1,0,1),_t=M1(Le,Ge,Ve,He,gt,ft,Ft,xt),lr=de.mat3.adjoint([],_t);return de.mat3.multiply(Et,Et,lr)}(ie[0],ie[1],ge[0],ge[1],fe[0],fe[1],pe[0],pe[1]);this.elevatedGlobePerspectiveTransform=PN(ie[0],ie[1],ge[0],ge[1],fe[0],fe[1],pe[0],pe[1]);const _e=(Le,Ge)=>{v.push(Le.lng);const Ve=Math.round((Le.lng-M)/R*Ct),He=Math.round((Le.lat-P)/F*Ct),gt=ee(Ge),ft=de.vec3.transformMat3([],[gt[0],gt[1],1],Ce),Ft=Math.round(ft[0]/ft[2]*Ct),xt=Math.round(ft[1]/ft[2]*Ct);B.emplaceBack(Ve,He,Ft,xt)},Me=u[3].x-u[0].x,Re=u[3].y-u[0].y,ke=u[2].x-u[1].x,Oe=u[2].y-u[1].y;for(let Le=0;Le<65;Le++){const Ge=Le/64,Ve=[u[0].x+Ge*Me,u[0].y+Ge*Re],He=[u[1].x+Ge*ke,u[1].y+Ge*Oe],gt=He[0]-Ve[0],ft=He[1]-Ve[1];for(let Ft=0;Ft<65;Ft++){const xt=Ft/64,Et={x:Ve[0]+gt*xt,y:Ve[1]+ft*xt,z:0};_e(o.projection.unproject(Et.x,Et.y),Et)}}this.elevatedGlobeVertexBuffer=r.createVertexBuffer(B,xT.members)}{this.maxLongitudeTriangleSize=0;let B=[],Z=new ls;const W=(G,X,ee)=>{Z.emplaceBack(G,X,ee);const ie=v[G],ge=v[X],fe=v[ee],pe=Math.min(Math.min(ie,ge),fe),Ce=Math.max(Math.max(ie,ge),fe)-pe;Ce>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ce),B.push(pe+Ce/2)};for(let G=0;G<64;G++)for(let X=0;X<64;X++){const ee=65*G+X,ie=ee+1,ge=ee+65,fe=ge+1;W(ee,ge,ie),W(ie,ge,fe)}[B,Z]=function(G,X){const ee=Array.from({length:G.length},(fe,pe)=>pe);ee.sort((fe,pe)=>G[fe]-G[pe]);const ie=[],ge=new ls;for(let fe=0;fe<ee.length;fe++){const pe=ee[fe];ie.push(G[pe]);const Ce=3*pe,_e=Ce+1;ge.emplaceBack(X.uint16[Ce],X.uint16[_e],X.uint16[_e+1])}return[ie,ge]}(B,Z),this.elevatedGlobeTrianglesCenterLongitudes=B,this.elevatedGlobeIndexBuffer=r.createIndexBuffer(Z)}this.elevatedGlobeSegments=Hn.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,R/Ct,0,F/Ct,0,0,P,M,0])}prepare(){const r=Object.keys(this.tiles).length!==0;if(this.tileID&&!r)return;const o=this.map.painter.context,u=o.gl;!this._dirty||this.texture instanceof C1||(this.texture?this.texture.update(this.image):(this.texture=new wT(o,this.image,u.RGBA8),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._dirty=!1),r&&this._prepareData(o)}loadTile(r,o){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},o(null)):(r.state="errored",o(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(r){const o=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!o)return null;const u=this.elevatedGlobeTrianglesCenterLongitudes;let p=(h=r+180)+360*Math.round((u[0]-h)/360);var h;const _=new Hn,w=(C,I)=>{_.segments.push({vertexOffset:0,primitiveOffset:C,vertexLength:o.segments[0].vertexLength,primitiveLength:I,sortKey:void 0,vaos:{}})},E=.51*this.maxLongitudeTriangleSize;if(Math.abs(u[0]-p)<=E){const C=ap(u,0,u.length,p+E);return C===u.length||w(C,op(u,C+1,u.length,p+360-E)-C),_}p<u[0]&&(p+=360);const A=op(u,0,u.length,p-E);if(A===u.length)return w(0,u.length),_;w(0,A-0);const v=ap(u,A+1,u.length,p+E);return v!==u.length&&w(v,u.length-v),_}}const m$=(Math.pow(256,2)-1)/16907520;class kN extends es{constructor(r,o,u,p){super(r,{layout:MN||(MN=new ii({visibility:new Tt(We.layout_raster.visibility)})),paint:AN||(AN=new ii({"raster-opacity":new Tt(We.paint_raster["raster-opacity"]),"raster-color":new Xu(We.paint_raster["raster-color"]),"raster-color-mix":new Tt(We.paint_raster["raster-color-mix"]),"raster-color-range":new Tt(We.paint_raster["raster-color-range"]),"raster-hue-rotate":new Tt(We.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Tt(We.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Tt(We.paint_raster["raster-brightness-max"]),"raster-saturation":new Tt(We.paint_raster["raster-saturation"]),"raster-contrast":new Tt(We.paint_raster["raster-contrast"]),"raster-resampling":new Tt(We.paint_raster["raster-resampling"]),"raster-fade-duration":new Tt(We.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Tt(We.paint_raster["raster-emissive-strength"]),"raster-array-band":new Tt(We.paint_raster["raster-array-band"]),"raster-elevation":new Tt(We.paint_raster["raster-elevation"]),"raster-color-use-theme":new Ot({type:"string",default:"default","property-type":"data-driven"})}))},o,u,p),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(r){return!(r&&r._source instanceof IN&&(r._source.onNorthPole||r._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(r){r!=="raster-color"&&r!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(r){if(!this.hasColorMap()||!this._curRampRange)return;const o=this._transitionablePaint._values["raster-color"].value.expression,[u,p]=r||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(u)&&isNaN(p)||u===this._curRampRange[0]&&p===this._curRampRange[1]||(this.colorRamp=dy({expression:o,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:u,end:p}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[u,p])}}let NN,RN,jN,DN,LN;class ON extends es{constructor(r,o,u,p){super(r,{layout:NN||(NN=new ii({visibility:new Tt(We["layout_raster-particle"].visibility)})),paint:RN||(RN=new ii({"raster-particle-array-band":new Tt(We["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Tt(We["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Xu(We["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Tt(We["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Tt(We["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Tt(We["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Tt(We["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Tt(We["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Ot({type:"string",default:"default","property-type":"data-driven"})}))},o,u,p),this._updateColorRamp(),this.lastInvalidatedAt=et.now()}onRemove(r){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(r){return!1}_handleSpecialPaintPropertyUpdate(r){r!=="raster-particle-color"&&r!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),r==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const r=this._transitionablePaint._values["raster-particle-color"].value.expression,o=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=dy({expression:r,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:o}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=et.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class g$ extends es{constructor(r,o){super(r,{},o,null),this.implementation=r,r.slot&&(this.slot=r.slot)}is3D(r){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(r){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)}onRemove(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)}}function ST(c,r,o){const u=[0,0,1],p=de.quat.identity([]);return de.quat.rotateY(p,p,o?-Be(c)+Math.PI:Be(c)),de.quat.rotateX(p,p,-Be(r)),de.vec3.transformQuat(u,u,p),de.vec3.normalize(u,u)}function zN(c,r){const o=P1(c.projection,c.zoom,c.width,c.height),u=function(h,_,w,E,A){const v=new sn(w.lng-180*hd,w.lat),C=new sn(w.lng+180*hd,w.lat),I=h.project(v.lng,v.lat),M=h.project(C.lng,C.lat),P=-Math.atan2(M.y-I.y,M.x-I.x),R=n.fromLngLat(w);R.y=Bt(R.y,-1+hd,1-hd);const F=R.toLngLat(),B=h.project(F.lng,F.lat),Z=n.fromLngLat(F);Z.x+=hd;const W=Z.toLngLat(),G=h.project(W.lng,W.lat),X=BN(G.x-B.x,G.y-B.y,P),ee=n.fromLngLat(F);ee.y+=hd;const ie=ee.toLngLat(),ge=h.project(ie.lng,ie.lat),fe=BN(ge.x-B.x,ge.y-B.y,P),pe=Math.abs(X.x)/Math.abs(fe.y),Ce=de.mat4.identity([]);de.mat4.rotateZ(Ce,Ce,-P*(1-(A?0:E)));const _e=de.mat4.identity([]);return de.mat4.scale(_e,_e,[1,1-(1-pe)*E,1]),_e[4]=-fe.x/fe.y*E,de.mat4.rotateZ(_e,_e,P),de.mat4.multiply(_e,Ce,_e),_e}(c.projection,0,c.center,o,r),p=FN(c);return de.mat4.scale(u,u,[p,p,1]),u}function FN(c){const r=c.projection,o=P1(c.projection,c.zoom,c.width,c.height),u=TT(r,c.center),p=TT(r,sn.convert(r.center));return Math.pow(2,u*o+(1-o)*p)}function P1(c,r,o,u,p=1/0){const h=c.range;if(!h)return 0;const _=Math.min(p,Math.max(o,u)),w=Math.log(_/1024)/Math.LN2;return Or(h[0]+w,h[1]+w,r)}const hd=1/4e4;function TT(c,r){const o=Bt(r.lat,-wi,wi),u=new sn(r.lng-180*hd,o),p=new sn(r.lng+180*hd,o),h=c.project(u.lng,o),_=c.project(p.lng,o),w=n.fromLngLat(u),E=n.fromLngLat(p),A=_.x-h.x,v=_.y-h.y,C=E.x-w.x,I=E.y-w.y,M=Math.sqrt((C*C+I*I)/(A*A+v*v));return Math.log(M)/Math.LN2}function BN(c,r,o){const u=Math.cos(o),p=Math.sin(o);return{x:c*u-r*p,y:c*p+r*u}}function VN(c,r,o){de.mat4.identity(c),de.mat4.rotateZ(c,c,Be(r[2])),de.mat4.rotateX(c,c,Be(r[0])),de.mat4.rotateY(c,c,Be(r[1])),de.mat4.scale(c,c,o),de.mat4.multiply(c,c,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function I1(c,r,o,u,p,h,_,w){const E=[o[0]-r[0],o[1]-r[1],0],A=[u[0]-r[0],u[1]-r[1],0];if(de.vec3.length(E)<1e-12||de.vec3.length(A)<1e-12)return de.quat.identity(c);const v=de.vec3.cross([],E,A);de.vec3.normalize(v,v),de.vec3.subtract(A,u,r),E[2]=(h-p)*w,A[2]=(_-p)*w;const C=E;return de.vec3.cross(C,E,A),de.vec3.normalize(C,C),de.quat.rotationTo(c,v,C)}function ET(c,r,o=!1){const u=Gs(r.zoom),p=function(h,_,w){const E=_.worldSize,A=[h[12],h[13],h[14]],v=cs(A[1]/E),C=Js(A[0]/E),I=de.mat4.identity([]),M=vs(1,v)*E,P=vs(1,0)*E*oc(v,_.zoom),R=1/Oa(E);let F=P*R;if(w){const G=P1(_.projection,_.zoom,_.width,_.height,1024);F=R*_.projection.pixelSpaceConversion(_.center.lat,E,G)}const B=Gc(v,C);de.vec3.add(B,B,de.vec3.scale([],de.vec3.normalize([],B),M*F*A[2]));const Z=function(G){const X=[G[0],G[1],G[2]];let ee=[0,1,0];const ie=de.vec3.cross([],ee,X);return de.vec3.cross(ee,X,ie),de.vec3.squaredLength(ee)===0&&(ee=[0,1,0],de.vec3.cross(ie,X,ee)),de.vec3.normalize(ie,ie),de.vec3.normalize(ee,ee),de.vec3.normalize(X,X),[ie[0],ie[1],ie[2],0,ee[0],ee[1],ee[2],0,X[0],X[1],X[2],0,G[0],G[1],G[2],1]}(B);de.mat4.scale(I,I,[F,F,F*M]),de.mat4.translate(I,I,[-A[0],-A[1],-A[2]]);const W=de.mat4.multiply([],_.globeMatrix,Z);return de.mat4.multiply(W,W,I),de.mat4.multiply(W,W,h),W}(c,r,o);if(u>0){const h=function(_,w){const E=w.worldSize,A=vs(1,0)*E*oc(w.center.lat,w.zoom)/Oa(E),v=vs(1,w.center.lat)*E,C=de.mat4.identity([]);return de.mat4.rotateY(C,C,Be(w.center.lng)),de.mat4.rotateX(C,C,Be(w.center.lat)),de.mat4.translate(C,C,[0,0,Os]),de.mat4.scale(C,C,[A,A,A*v]),de.mat4.translate(C,C,[w.point.x-.5*E,w.point.y-.5*E,0]),de.mat4.multiply(C,C,_),de.mat4.multiply(C,w.globeMatrix,C)}(c,r);return function(_,w,E){const A=(P,R,F)=>{const B=de.vec3.length(P),Z=de.vec3.length(R),W=Ui(P,R,F);return de.vec3.scale(W,W,1/de.vec3.length(W)*ur(B,Z,F))},v=A([_[0],_[1],_[2]],[w[0],w[1],w[2]],E),C=A([_[4],_[5],_[6]],[w[4],w[5],w[6]],E),I=A([_[8],_[9],_[10]],[w[8],w[9],w[10]],E),M=Ui([_[12],_[13],_[14]],[w[12],w[13],w[14]],E);return[v[0],v[1],v[2],0,C[0],C[1],C[2],0,I[0],I[1],I[2],0,M[0],M[1],M[2],1]}(p,h,u)}return p}function UN(c,r,o,u){const p=Xt.projectAabbCorners(u,o);let h=Number.MAX_VALUE,_=-1;for(let A=0;A<p.length;++A){const v=p[A];v[0]=(.5*v[0]+.5)*r.width,v[1]=(.5-.5*v[1])*r.height,v[2]<h&&(_=A,h=v[2])}const w=A=>new bt(p[A][0],p[A][1]);let E;switch(_){case 0:case 6:E=[w(1),w(5),w(4),w(7),w(3),w(2),w(1)];break;case 1:case 7:E=[w(0),w(4),w(5),w(6),w(2),w(3),w(0)];break;case 3:case 5:E=[w(1),w(0),w(4),w(7),w(6),w(2),w(1)];break;default:E=[w(1),w(5),w(6),w(7),w(3),w(0),w(1)]}if(te(c,E))return h}const _$=nn([{name:"a_pos_3f",components:3,type:"Float32"}]),y$=nn([{name:"a_color_3f",components:3,type:"Float32"}]),x$=nn([{name:"a_color_4f",components:4,type:"Float32"}]),v$=nn([{name:"a_uv_2f",components:2,type:"Float32"}]),b$=nn([{name:"a_normal_3f",components:3,type:"Float32"}]),w$=nn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),S$=nn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),$N={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class k1{constructor(r,o,u,p){this.message=(r?`${r}: `:"")+u,p&&(this.identifier=p),o!=null&&o.__line__&&(this.line=o.__line__)}}function GN(c,r){const o=c.indexOf("://")===-1;try{return new URL(c,o&&r?"http://example.com":void 0),!0}catch{return!1}}class qN{constructor(r,o){this.feature=r,this.instancedDataOffset=o,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class HN{constructor(){this.instancedDataArray=new Yp,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class CT{constructor(r){this.zoom=r.zoom,this.canonical=r.canonical,this.layers=r.layers,this.layerIds=this.layers.map(o=>o.fqid),this.projection=r.projection,this.index=r.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(r,o){}populate(r,o,u,p){this.tileToMeter=g(u);const h=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:_,id:w,index:E,sourceLayerIndex:A}of r){const v=w??(_.properties&&_.properties.hasOwnProperty("id")?_.properties.id:void 0),C=z(_,h);if(!this.layers[0]._featureFilter.filter(new kn(this.zoom),C,u))continue;const I={id:v,sourceLayerIndex:A,index:E,geometry:h?C.geometry:L(_,u,p),properties:_.properties,type:_.type,patterns:{}},M=this.addFeature(I,I.geometry,C);M&&o.featureIndex.insert(_,I.geometry,E,A,this.index,this.instancesPerModel[M].instancedDataArray.length,Ct/32)}this.lookup=null}update(r,o,u,p){for(const h in this.instancesPerModel){const _=this.instancesPerModel[h];for(const w in r)_.idToFeaturesIndex.hasOwnProperty(w)&&(this.evaluate(_.features[_.idToFeaturesIndex[w]],r[w],_,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let r=!1;for(const o in this.instancesPerModel){const u=this.instancesPerModel[o];for(const p of u.features){const h=this.layers[0],_=p.feature,w=this.canonical,E=h.paint.get("model-rotation").evaluate(_,{},w),A=h.paint.get("model-scale").evaluate(_,{},w),v=h.paint.get("model-translation").evaluate(_,{},w);de.vec3.exactEquals(p.rotation,E)&&de.vec3.exactEquals(p.scale,A)&&de.vec3.exactEquals(p.translation,v)||(this.evaluate(p,p.featureStates,u,!0),r=!0)}}return r}updateReplacement(r,o,u,p){if(o.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=o.updateTime;const h=o.getReplacementRegionsForTile(r.toUnwrapped(),!0);if(KS(this.activeReplacements,h))return!1;this.activeReplacements=h;let _=!1;for(const w in this.instancesPerModel){const E=this.instancesPerModel[w],A=E.instancedDataArray;for(const v of E.features){const C=v.instancedDataOffset,I=v.instancedDataCount;for(let M=0;M<I;M++){const P=16*(M+C);let R=A.float32[P+0];const F=R>Ct;R=F?R-Ct:R;const B=Math.floor(R),Z=A.float32[P+1];let W=!1;for(const G of this.activeReplacements)if(!tk(G,u,$N.Model,p)&&!(G.min.x>B||B>G.max.x||G.min.y>Z||Z>G.max.y)&&(W=ak(ok(B,Z,r.canonical,G.footprintTileId.canonical),G.footprint),W))break;A.float32[P]=W?R+Ct:R,_=_||W!==F}}}return _}isEmpty(){for(const r in this.instancesPerModel)if(this.instancesPerModel[r].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(r){if(!this.uploaded)for(const o in this.instancesPerModel){const u=this.instancesPerModel[o];u.instancedDataArray.length<0||u.instancedDataArray.length===0||(u.instancedDataBuffer?u.instancedDataBuffer.updateData(u.instancedDataArray):u.instancedDataBuffer=r.createVertexBuffer(u.instancedDataArray,w$.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const o in this.instancesPerModel){const u=this.instancesPerModel[o];u.instancedDataArray.length!==0&&u.instancedDataBuffer&&u.instancedDataBuffer.destroy()}const r=this.layers[0].modelManager;if(r&&this.modelUris)for(const o of this.modelUris)r.removeModel(o,"")}addFeature(r,o,u){const p=this.layers[0],h=p.layout.get("model-id").evaluate(u,{},this.canonical);if(!h)return Kn(`modelId is not evaluated for layer ${p.id} and it is not going to get rendered.`),h;GN(h,!1)&&(this.modelUris.includes(h)||this.modelUris.push(h)),this.instancesPerModel[h]||(this.instancesPerModel[h]=new HN);const _=this.instancesPerModel[h],w=_.instancedDataArray,E=new qN(u,w.length);for(const A of o)for(const v of A){if(v.x<0||v.x>=Ct||v.y<0||v.y>=Ct)continue;const C=(this.lookupDim-1)/Ct,I=this.lookupDim*(v.y*C|0)+v.x*C|0;if(this.lookup){if(this.lookup[I]!==0)continue;this.lookup[I]=1}this.instanceCount++;const M=w.length;w.resize(M+1),_.instancesEvaluatedElevation.push(0),w.float32[16*M]=v.x,w.float32[16*M+1]=v.y}return E.instancedDataCount=_.instancedDataArray.length-E.instancedDataOffset,E.instancedDataCount>0&&(r.id&&(_.idToFeaturesIndex[r.id]=_.features.length),_.features.push(E),this.evaluate(E,{},_,!1)),h}getModelUris(){return this.modelUris}evaluate(r,o,u,p){const h=this.layers[0],_=r.feature,w=this.canonical,E=r.rotation=h.paint.get("model-rotation").evaluate(_,o,w),A=r.scale=h.paint.get("model-scale").evaluate(_,o,w),v=r.translation=h.paint.get("model-translation").evaluate(_,o,w),C=h.paint.get("model-color").evaluate(_,o,w);C.a=h.paint.get("model-color-mix-intensity").evaluate(_,o,w);const I=[];this.maxVerticalOffset<v[2]&&(this.maxVerticalOffset=v[2]),this.maxScale=Math.max(Math.max(this.maxScale,A[0]),Math.max(A[1],A[2])),VN(I,E,A);const M=Math.round(100*C.a)+C.b/1.05;for(let P=0;P<r.instancedDataCount;++P){const R=r.instancedDataOffset+P,F=16*R,B=u.instancedDataArray.float32;let Z=0;p&&(Z=B[F+6]-u.instancesEvaluatedElevation[R]);const W=0|B[F+1];B[F]=(0|B[F])+C.r/1.05,B[F+1]=W+C.g/1.05,B[F+2]=M,B[F+3]=1/(w.z>10?this.tileToMeter:g(w,W)),B[F+4]=v[0],B[F+5]=v[1],B[F+6]=v[2]+Z,B[F+7]=I[0],B[F+8]=I[1],B[F+9]=I[2],B[F+10]=I[4],B[F+11]=I[5],B[F+12]=I[6],B[F+13]=I[8],B[F+14]=I[9],B[F+15]=I[10],u.instancesEvaluatedElevation[R]=v[2]}}}let WN,ZN;zt(CT,"ModelBucket",{omit:["layers"]}),zt(HN,"PerModelAttributes"),zt(qN,"ModelFeature");const uf=64,um={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function YN(c,r,o,u,p,h,_,w,E,A=!1){const v=o.zoom,C=o.project(u),I=oc(u.lat,v),M=1/I;de.mat4.identity(c),de.mat4.translate(c,c,[C.x+_[0]*M,C.y+_[1]*M,_[2]]);let P=1,R=1;const F=o.worldSize;if(A){if(o.projection.name==="mercator"){let G=0;o.elevation&&(G=o.elevation.getAtPointOrZero(new n(C.x/F,C.y/F),0));const X=de.vec4.transformMat4([],[C.x,C.y,G,1],o.projMatrix)[3]/o.cameraToCenterDistance;P=X,R=X*oc(o.center.lat,v)}else if(o.projection.name==="globe"){const G=ET(c,o),X=de.mat4.multiply([],o.projMatrix,G),ee=[0,0,0,1];de.vec4.transformMat4(ee,ee,X);const ie=ee[3]/o.cameraToCenterDistance,ge=Gs(v),fe=o.projection.pixelsPerMeter(u.lat,F)*oc(u.lat,v),pe=o.projection.pixelsPerMeter(o.center.lat,F)*oc(o.center.lat,v);P=ie/ur(fe,e1(o.center.lat),ge),R=ie*I/fe,P*=pe,R*=pe}}else P=M;de.mat4.scale(c,c,[P,P,R]);const B=[...c],Z=r.orientation,W=[];if(VN(W,[Z[0]+p[0],Z[1]+p[1],Z[2]+p[2]],h),de.mat4.multiply(c,B,W),w&&o.elevation){let G=0;const X=[];if(E&&o.elevation){G=function(ge,fe,pe,Ce,_e){const Me=fe.elevation;if(!Me)return 0;const Re=Xt.projectAabbCorners(pe,Ce),ke=vs(1,_e.lat)*fe.worldSize,Oe=function(lr,Dt){const Zt=[0,0,1],gr=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const jr of gr){const xr=lr[jr.corners[0]],Fr=lr[jr.corners[1]],Rr=lr[jr.corners[2]],Ur=[Fr[0]-xr[0],Fr[1]-xr[1],Dt*(Fr[2]-xr[2])],en=de.vec3.cross(Ur,Ur,[Rr[0]-xr[0],Rr[1]-xr[1],Dt*(Rr[2]-xr[2])]);de.vec3.normalize(en,en),jr.dotProductWithUp=de.vec3.dot(en,Zt)}return gr.sort((jr,xr)=>jr.dotProductWithUp-xr.dotProductWithUp),gr[0].corners}(Re,ke),Le=Re[Oe[0]],Ge=Re[Oe[1]],Ve=Re[Oe[2]],He=Re[Oe[3]],gt=Me.getAtPointOrZero(new n(Le[0]/fe.worldSize,Le[1]/fe.worldSize),0),ft=Me.getAtPointOrZero(new n(Ge[0]/fe.worldSize,Ge[1]/fe.worldSize),0),Ft=Me.getAtPointOrZero(new n(Ve[0]/fe.worldSize,Ve[1]/fe.worldSize),0),xt=Me.getAtPointOrZero(new n(He[0]/fe.worldSize,He[1]/fe.worldSize),0),Et=(gt+xt)/2,_t=(ft+Ft)/2;return Et>_t?ft<Ft?I1(ge,Ge,He,Le,ft,xt,gt,ke):I1(ge,Ve,Le,He,Ft,gt,xt,ke):gt<xt?I1(ge,Le,Ge,Ve,gt,ft,Ft,ke):I1(ge,He,Ve,Ge,xt,Ft,ft,ke),Math.max(Et,_t)}(X,o,r.aabb,c,u);const ee=de.mat4.fromQuat([],X),ie=de.mat4.multiply([],ee,W);de.mat4.multiply(c,B,ie)}else G=o.elevation.getAtPointOrZero(new n(C.x/F,C.y/F),0);G!==0&&(c[14]+=G)}}function ky(c,r,o=!1){c.uploaded||(c.gfxTexture=new wT(r,c.image,o?r.gl.R8:r.gl.RGBA8,{useMipmap:c.sampler.minFilter>=r.gl.NEAREST_MIPMAP_NEAREST}),c.uploaded=!0,c.image=null)}function T$(c,r,o){c.indexBuffer=r.createIndexBuffer(c.indexArray,!1,!0),c.vertexBuffer=r.createVertexBuffer(c.vertexArray,_$.members,!1,!0),c.normalArray&&(c.normalBuffer=r.createVertexBuffer(c.normalArray,b$.members,!1,!0)),c.texcoordArray&&(c.texcoordBuffer=r.createVertexBuffer(c.texcoordArray,v$.members,!1,!0)),c.colorArray&&(c.colorBuffer=r.createVertexBuffer(c.colorArray,(c.colorArray.bytesPerElement===12?y$:x$).members,!1,!0)),c.featureArray&&(c.pbrBuffer=r.createVertexBuffer(c.featureArray,S$.members,!0)),c.segments=Hn.simpleSegment(0,0,c.vertexArray.length,c.indexArray.length);const u=c.material;u.pbrMetallicRoughness.baseColorTexture&&ky(u.pbrMetallicRoughness.baseColorTexture,r),u.pbrMetallicRoughness.metallicRoughnessTexture&&ky(u.pbrMetallicRoughness.metallicRoughnessTexture,r),u.normalTexture&&ky(u.normalTexture,r),u.occlusionTexture&&ky(u.occlusionTexture,r,o),u.emissionTexture&&ky(u.emissionTexture,r)}function MT(c,r,o){if(c.meshes)for(const u of c.meshes)T$(u,r,o);if(c.children)for(const u of c.children)MT(u,r,o)}function N1(c){if(c.meshes)for(const r of c.meshes)r.indexArray.destroy(),r.vertexArray.destroy(),r.colorArray&&r.colorArray.destroy(),r.normalArray&&r.normalArray.destroy(),r.texcoordArray&&r.texcoordArray.destroy(),r.featureArray&&r.featureArray.destroy();if(c.children)for(const r of c.children)N1(r)}function AT(c){if(c.meshes)for(const o of c.meshes)o.vertexBuffer&&(o.vertexBuffer.destroy(),o.indexBuffer.destroy(),o.normalBuffer&&o.normalBuffer.destroy(),o.texcoordBuffer&&o.texcoordBuffer.destroy(),o.colorBuffer&&o.colorBuffer.destroy(),o.pbrBuffer&&o.pbrBuffer.destroy(),o.segments.destroy(),o.material&&((r=o.material).pbrMetallicRoughness.baseColorTexture&&r.pbrMetallicRoughness.baseColorTexture.gfxTexture&&r.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),r.pbrMetallicRoughness.metallicRoughnessTexture&&r.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&r.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),r.normalTexture&&r.normalTexture.gfxTexture&&r.normalTexture.gfxTexture.destroy(),r.emissionTexture&&r.emissionTexture.gfxTexture&&r.emissionTexture.gfxTexture.destroy(),r.occlusionTexture&&r.occlusionTexture.gfxTexture&&r.occlusionTexture.gfxTexture.destroy()));var r;if(c.children)for(const o of c.children)AT(o)}class dm{constructor(r,o,u){this._demTile=r,this._dem=this._demTile.dem,this._scale=o,this._offset=u}static create(r,o,u){const p=u||r.findDEMTileFor(o);if(!p||!p.dem)return;const h=p.dem,_=p.tileID,w=1<<o.canonical.z-_.canonical.z;return new dm(p,h.dim/Ct/w,[(o.canonical.x/w-_.canonical.x)*h.dim,(o.canonical.y/w-_.canonical.y)*h.dim])}tileCoordToPixel(r,o){const u=o*this._scale+this._offset[1],p=Math.floor(r*this._scale+this._offset[0]),h=Math.floor(u);return new bt(p,h)}getElevationAt(r,o,u,p){const h=r*this._scale+this._offset[0],_=o*this._scale+this._offset[1],w=Math.floor(h),E=Math.floor(_),A=this._dem;return p=!!p,u?ur(ur(A.get(w,E,p),A.get(w,E+1,p),_-E),ur(A.get(w+1,E,p),A.get(w+1,E+1,p),_-E),h-w):A.get(w,E,p)}getElevationAtPixel(r,o,u){return this._dem.get(r,o,!!u)}getMeterToDEM(r){return(1<<this._demTile.tileID.canonical.z)*vs(1,r)*this._dem.stride}}const PT=new Float32Array(262144),df=new Uint8Array(262144);function XN(c){let r=0;if(c.meshes)for(const o of c.meshes)r=Math.max(r,o.aabb.max[2]);if(c.children)for(const o of c.children)r=Math.max(r,XN(o));return r}function KN(c,r,o){if(c.meshes)for(const u of c.meshes){if(u.aabb.min[0]===1/0)continue;const p=Xt.applyTransform(u.aabb,c.matrix);o.insert(r,p.min[0],p.min[1],p.max[0],p.max[1])}if(c.children)for(const u of c.children)KN(u,r,o)}const JN=["","wall","door","roof","window","lamp","logo"];class QN{constructor(r){this.node=r,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:r.id,geometry:[],properties:{height:XN(r)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Xt([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let r=0;const o=new Xt([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const u of this.node.meshes)this.node.lightMeshIndex!==r&&(u.transformedAabb=Xt.applyTransformFast(u.aabb,this.node.matrix),o.encapsulate(u.transformedAabb)),r++;this.aabb=o}return this.aabb}}class R1{constructor(r,o,u,p,h,_,w){this.id=u,this.layers=r,this.layerIds=this.layers.map(E=>E.fqid),this.stateDependentLayerIds=this.layers.filter(E=>E.isStateDependent()).map(E=>E.id),this.modelTraits|=um.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,p&&(this.modelTraits|=um.HasMapboxMeshFeatures),h&&(this.modelTraits|=um.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=_,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const E of o)this.nodesInfo.push(new QN(E)),KN(E,w.featureIndexArray.length,w.grid),w.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,w.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(r,o){for(const u of this.getNodesInfo()){const p=u.node;p.footprint&&o.push({footprint:p.footprint,id:r})}}update(r){const o=Object.keys(r).length!==0;if(o&&!this.stateDependentLayers.length)return;const u=o?this.stateDependentLayers:this.layers;if(!Vi(r,this.states))for(const p of u)this.evaluate(p,r);this.states=structuredClone(r)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(r){if(!this.needsUpload)return;const o=this.getNodesInfo();for(const u of o){const p=u.node;this.uploaded?this.updatePbrBuffer(p):MT(p,r,!0)}for(const u of o)N1(u.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(r){let o=!1;if(!r.meshes)return o;for(const u of r.meshes)u.pbrBuffer&&(u.pbrBuffer.updateData(u.featureArray),o=!0);return o}needsReEvaluation(r,o,u){const p=r.transform.projectionOptions,h=r.style.getBrightness(),_=this.brightness!==h;if(!this.uploaded||this.dirty||p.name!==this.projection.name||Ny(u.paint.get("model-color").value,_)||Ny(u.paint.get("model-color-mix-intensity").value,_)||Ny(u.paint.get("model-roughness").value,_)||Ny(u.paint.get("model-emissive-strength").value,_)||Ny(u.paint.get("model-height-based-emissive-strength-multiplier").value,_)){this.projection=p,this.brightness=h;const w=this.getNodesInfo();for(const E of w)E.state=null;return!0}return!1}evaluateScale(r,o){if(r.transform.zoom===this.zoom)return;this.zoom=r.transform.zoom;const u=this.getNodesInfo(),p=this.id.canonical;for(const h of u){const _=h.feature;h.evaluatedScale=o.paint.get("model-scale").evaluate(_,{},p)}}evaluate(r,o){const u=this.getNodesInfo();for(const p of u){if(!p.node.meshes)continue;const h=p.feature,_=o&&o[h.id];if(Vi(_,p.state))continue;p.state=structuredClone(_);const w=p.node.meshes&&p.node.meshes[0].featureData,E=p.evaluatedColor[2],A=p.evaluatedRMEA[2],v=this.id.canonical;if(p.hasTranslucentParts=!1,w){for(let C=0;C<JN.length;C++){const I=JN[C];I.length&&(h.properties.part=I);const M=r.paint.get("model-color").evaluate(h,_,v).toRenderColor(null),P=r.paint.get("model-color-mix-intensity").evaluate(h,_,v);p.evaluatedColor[C]=[M.r,M.g,M.b,P],p.evaluatedRMEA[C][0]=r.paint.get("model-roughness").evaluate(h,_,v),p.evaluatedRMEA[C][2]=r.paint.get("model-emissive-strength").evaluate(h,_,v),p.evaluatedRMEA[C][3]=M.a,p.emissionHeightBasedParams[C]=r.paint.get("model-height-based-emissive-strength-multiplier").evaluate(h,_,v),!p.hasTranslucentParts&&M.a<1&&(p.hasTranslucentParts=!0)}delete h.properties.part,C$(p,E!==p.evaluatedColor[2]||A!==p.evaluatedRMEA[2],this.modelTraits)}else p.evaluatedRMEA[0][2]=r.paint.get("model-emissive-strength").evaluate(h,_,v);p.evaluatedScale=r.paint.get("model-scale").evaluate(h,_,v),this.updatePbrBuffer(p.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(r,o,u,p){const h=r.findDEMTileFor(u);if(h&&(h.tileID.canonical!==this.terrainTile||o!==this.terrainExaggeration)){if(h.dem&&h.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=h.tileID.overscaledZ;const _=dm.create(r,u,h);if(!_)return;this.modelTraits&um.HasMapboxMeshFeatures&&this.updateDEM(r,_,u,p);for(const w of this.getNodesInfo()){const E=w.node;if(!E.footprint||!E.footprint.vertices||!E.footprint.vertices.length)continue;const A=E.footprint.vertices;let v=_.getElevationAt(A[0].x,A[0].y,!0,!0);for(let C=1;C<A.length;C++)v=Math.min(v,_.getElevationAt(A[C].x,A[C].y,!0,!0));E.elevation=v}}this.terrainTile=h.tileID.canonical,this.terrainExaggeration=o}}updateDEM(r,o,u,p){let h=o._dem._modifiedForSources[p];if(h===void 0&&(o._dem._modifiedForSources[p]=[],h=o._dem._modifiedForSources[p]),h.includes(u.canonical))return;const _=o._dem.dim;h.push(u.canonical);let w=!1;for(const E of this.getNodesInfo()){const A=E.node;if(!A.footprint||!A.footprint.grid)continue;const v=A.footprint.grid,C=o.tileCoordToPixel(v.min.x,v.min.y),I=o.tileCoordToPixel(v.max.x,v.max.y),M=Math.min(Math.min(_-I.y,C.x),Math.min(C.y,_-I.x));if(M<0)continue;const P=Bt(M,2,5);let R=Math.max(0,C.x-P),F=Math.max(0,C.y-P),B=Math.min(I.x+P,_-1),Z=Math.min(I.y+P,_-1);for(let ee=F;ee<=Z;++ee)for(let ie=R;ie<=B;++ie)df[ee*_+ie]=255;let W=0,G=0;for(let ee=0;ee<v.cellsY;++ee)for(let ie=0;ie<v.cellsX;++ie){if(!v.cells[ee*v.cellsX+ie])continue;const ge=o.tileCoordToPixel(v.min.x+ie/v.xScale,v.min.y+ee/v.yScale),fe=o.tileCoordToPixel(v.min.x+(ie+1)/v.xScale,v.min.y+(ee+1)/v.yScale);for(let pe=ge.y;pe<=Math.min(fe.y+1,_-1);++pe)for(let Ce=ge.x;Ce<=Math.min(fe.x+1,_-1);++Ce)df[pe*_+Ce]===255&&(df[pe*_+Ce]=0,W+=o.getElevationAtPixel(Ce,pe),G++)}const X=W/G;R=Math.max(1,C.x-P),F=Math.max(1,C.y-P),B=Math.min(I.x+P,_-2),Z=Math.min(I.y+P,_-2),w=!0;for(let ee=F;ee<=Z;++ee)for(let ie=R;ie<=B;++ie)df[ee*_+ie]===0&&(PT[ee*_+ie]=o._dem.set(ie,ee,X));for(let ee=1;ee<P;++ee){R=Math.max(1,C.x-ee),F=Math.max(1,C.y-ee),B=Math.min(I.x+ee,_-2),Z=Math.min(I.y+ee,_-2);for(let ie=F;ie<=Z;++ie)for(let ge=R;ge<=B;++ge){const fe=ie*_+ge;if(df[fe]===255){let pe=0,Ce=0,_e=-1,Me=-1;for(let Re=-1;Re<=1;++Re)for(let ke=-1;ke<=1;++ke){const Oe=(ie+Re)*_+ge+ke;if(df[Oe]>=ee)continue;const Le=PT[Oe],Ge=Math.abs(Le);Ge>Ce&&(pe=Le,Ce=Ge,_e=ke,Me=Re)}if(Ce>.1){const Re=1-(ee+.5*Math.abs(_e*Me))/P;let ke=o._dem.get(ge,ie)+pe*Re;const Oe=o._dem.get(ge+_e,ie+Me),Le=o._dem.get(ge-_e,ie-Me,!0);(ke-Oe)*(ke-Le)>0&&(ke=(Oe+Le)/2),PT[fe]=o._dem.set(ge,ie,ke),df[fe]=ee}}}}}w&&(o._demTile.needsDEMTextureUpload=!0,o._dem._timestamp=et.now())}setFilter(r){this.filter=r?V_(r):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(r=>this.filter.filter(new kn(this.id.overscaledZ),r.feature,this.id.canonical)):this.nodesInfo}destroy(){const r=this.getNodesInfo();for(const o of r)N1(o.node),AT(o.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(r,o){if(o.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=o.updateTime;const u=o.getReplacementRegionsForTile(r.toUnwrapped()),p=this.getNodesInfo();for(let h=0;h<this.nodesInfo.length;h++){const _=p[h].node;p[h].hiddenByReplacement=!!_.footprint&&!u.find(w=>w.footprint===_.footprint)}}getHeightAtTileCoord(r,o){const u=this.getNodesInfo(),p=[],h=[0,0,0],_=de.mat4.identity([]);for(let w=0;w<this.nodesInfo.length;w++){const E=u[w],A=E.node.meshes[0],v=A.transformedAabb;if(r<v.min[0]||o<v.min[1]||r>v.max[0]||o>v.max[1])continue;if(E.node.hidden===!0)return{height:1/0,maxHeight:E.feature.properties.height,hidden:!1,verticalScale:E.evaluatedScale[2]};de.mat4.invert(_,E.node.matrix),h[0]=r,h[1]=o,de.vec3.transformMat4(h,h,_);const C=(h[0]-A.aabb.min[0])/(A.aabb.max[0]-A.aabb.min[0])*uf|0,I=Math.min(63,(h[1]-A.aabb.min[1])/(A.aabb.max[1]-A.aabb.min[1])*uf|0)*uf+Math.min(63,C),M=A.heightmap[I];if(!(M<0&&E.node.footprint))return E.hiddenByReplacement?void 0:{height:M,maxHeight:E.feature.properties.height,hidden:!1,verticalScale:E.evaluatedScale[2]};if(E.node.footprint.grid.query(new bt(r,o),new bt(r,o),p),p.length>0)return{height:void 0,maxHeight:E.feature.properties.height,hidden:E.hiddenByReplacement,verticalScale:E.evaluatedScale[2]}}}}function Ny(c,r){return!c.isLightConstant&&r}function E$(c,r,o,u,p,h,_,w){let E=(61440&r|(61440&r)>>4)>>8,A=(3840&r|(3840&r)>>4)>>4,v=240&r|(240&r)>>4;o[3]>0&&(E=ur(E,255*o[0],o[3]),A=ur(A,255*o[1],o[3]),v=ur(v,255*o[2],o[3]));const C=E<<8|A,I=v<<8|Math.floor(255*u[3]),M=function(ee){const ie=Bt(ee,0,2);return Math.min(Math.round(.5*ie*255),255)}(u[2])<<8|15*u[0]<<4|15*u[1],P=Bt(p[0],0,1),R=Bt(p[1],0,1),F=Bt(p[2],0,1),B=Bt(p[3],0,1);let Z,W,G,X;if(P!==R&&_!==h&&R!==P){const ee=_-h;W=1/(ee*(R-P)),G=-(h+ee*P)/(ee*(R-P));const ie=Bt(p[4],-1,1);X=Math.pow(10,ie),Z=255*F<<8|255*B}else Z=65535,W=0,G=1,X=1;if(c.emplaceBack(C,I,M,Z,W,G,X),w){const ee=w.length;w.clear();for(let ie=0;ie<ee;ie++)w.emplaceBack(C,I,M,Z,W,G,X)}}function C$(c,r,o){const u=c.node;let p=0;const h=o&um.HasMeshoptCompression;for(const _ of u.meshes){if(u.lights&&u.lightMeshIndex===p||!_.featureData)continue;_.featureArray=new Xp,_.featureArray.reserve(_.featureData.length);let w=r;for(const E of _.featureData){const A=h?65535&E:E>>16&65535,v=h?E>>16&65535:65535&E,C=(15&v)<8?15&v:0,I=c.evaluatedRMEA[C],M=c.evaluatedColor[C],P=c.emissionHeightBasedParams[C];let R;if(w&&C===2&&u.lights&&(R=new Xp,R.resize(10*u.lights.length)),E$(_.featureArray,A,M,I,P,_.aabb.min[2],_.aabb.max[2],R),R&&w){w=!1;const F=u.meshes[u.lightMeshIndex];F.featureArray=R,F.featureArray._trim()}}_.featureArray._trim(),p++}}function eR(c,r,o,u){const p=1<<c.z;r.lat=cs((u/Ct+c.y)/p),r.lng=Js((o/Ct+c.x)/p)}zt(R1,"Tiled3dModelBucket",{omit:["layers"]}),zt(QN,"Tiled3dModelFeature");const M$={circle:class extends es{constructor(c,r,o,u){super(c,{layout:Ue||(Ue=new ii({"circle-sort-key":new Ot(We.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Tt(We.layout_circle["circle-elevation-reference"]),visibility:new Tt(We.layout_circle.visibility)})),paint:at||(at=new ii({"circle-radius":new Ot(We.paint_circle["circle-radius"]),"circle-color":new Ot(We.paint_circle["circle-color"]),"circle-blur":new Ot(We.paint_circle["circle-blur"]),"circle-opacity":new Ot(We.paint_circle["circle-opacity"]),"circle-translate":new Tt(We.paint_circle["circle-translate"]),"circle-translate-anchor":new Tt(We.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Tt(We.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Tt(We.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ot(We.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ot(We.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ot(We.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Tt(We.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Ot({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Ot({type:"string",default:"default","property-type":"data-driven"})}))},r,o,u)}createBucket(c){return new Y(c)}queryRadius(c){const r=c;return $e("circle-radius",this,r)+$e("circle-stroke-width",this,r)+lt(this.paint.get("circle-translate"))}queryIntersectsFeature(c,r,o,u,p,h,_,w){const E=vt(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),h.angle,c.pixelToTileUnitsFactor),A=this.paint.get("circle-radius").evaluate(r,o)+this.paint.get("circle-stroke-width").evaluate(r,o);return rm(c,u,h,_,w,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",E,A)}getProgramIds(){return["circle"]}getDefaultProgramParams(c,r,o){const u=sd(this);return{config:new $c(this,{zoom:r,lut:o}),defines:u,overrideFog:!1}}},heatmap:class extends es{createBucket(c){return new TI(c)}constructor(c,r,o,u){super(c,{layout:EI||(EI=new ii({visibility:new Tt(We.layout_heatmap.visibility)})),paint:CI||(CI=new ii({"heatmap-radius":new Ot(We.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ot(We.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Tt(We.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Xu(We.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Tt(We.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Ot({type:"string",default:"default","property-type":"data-driven"})}))},r,o,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=dy({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(c){return $e("heatmap-radius",this,c)}queryIntersectsFeature(c,r,o,u,p,h,_,w){const E=this.paint.get("heatmap-radius").evaluate(r,o);return rm(c,u,h,_,w,!0,!0,new bt(0,0),E)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(c,r,o){return c==="heatmap"?{config:new $c(this,{zoom:r,lut:o}),overrideFog:!1}:{}}},hillshade:class extends es{constructor(c,r,o,u){super(c,{layout:MI||(MI=new ii({visibility:new Tt(We.layout_hillshade.visibility)})),paint:AI||(AI=new ii({"hillshade-illumination-direction":new Tt(We.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Tt(We.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Tt(We.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Tt(We.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Tt(We.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Tt(We.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Tt(We.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Ot({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Ot({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Ot({type:"string",default:"default","property-type":"data-driven"})}))},r,o,u)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(c,r,o){return{overrideFog:!1}}},fill:class extends es{constructor(c,r,o,u){super(c,{layout:WI||(WI=new ii({"fill-sort-key":new Ot(We.layout_fill["fill-sort-key"]),visibility:new Tt(We.layout_fill.visibility),"fill-elevation-reference":new Tt(We.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Ot(We.layout_fill["fill-construct-bridge-guard-rail"])})),paint:ZI||(ZI=new ii({"fill-antialias":new Tt(We.paint_fill["fill-antialias"]),"fill-opacity":new Ot(We.paint_fill["fill-opacity"]),"fill-color":new Ot(We.paint_fill["fill-color"]),"fill-outline-color":new Ot(We.paint_fill["fill-outline-color"]),"fill-translate":new Tt(We.paint_fill["fill-translate"]),"fill-translate-anchor":new Tt(We.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ot(We.paint_fill["fill-pattern"]),"fill-emissive-strength":new Tt(We.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Ot(We.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Ot(We.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Ot(We.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Ot({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Ot({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Ot({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Ot({type:"string",default:"default","property-type":"data-driven"})}))},r,o,u)}getProgramIds(){const c=this.paint.get("fill-pattern"),r=c&&c.constantOr(1),o=[r?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&o.push(r&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),o}getDefaultProgramParams(c,r,o){return{config:new $c(this,{zoom:r,lut:o}),overrideFog:!1}}recalculate(c,r){super.recalculate(c,r);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(c){return new ZS(c)}queryRadius(){return lt(this.paint.get("fill-translate"))}queryIntersectsFeature(c,r,o,u,p,h){return!c.queryGeometry.isAboveHorizon&&ne(dt(c.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),h.angle,c.pixelToTileUnitsFactor),u)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(c){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const r=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return c!=null?r&&!c:r}},"fill-extrusion":class extends es{constructor(c,r,o,u){super(c,{layout:wk||(wk=new ii({visibility:new Tt(We["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Tt(We["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:Sk||(Sk=new ii({"fill-extrusion-opacity":new Tt(We["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ot(We["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Tt(We["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Tt(We["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ot(We["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ot(We["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ot(We["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Tt(We["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Tt(We["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Tt(We["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Tt(We["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Tt(We["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Tt(We["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Tt(We["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Tt(We["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Tt(We["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Tt(We["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Ot(We["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Ot(We["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Tt(We["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Tt(We["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Tt(We["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Tt(We["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Ot(We["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Ot(We["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Tt(We["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Ot({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Ot({type:"string",default:"default","property-type":"data-driven"})}))},r,o,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(c){return new u1(c)}queryRadius(){return lt(this.paint.get("fill-extrusion-translate"))}is3D(c){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(c,r,o,u,p,h,_,w,E){const A=vt(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),h.angle,c.pixelToTileUnitsFactor),v=this.paint.get("fill-extrusion-height").evaluate(r,o),C=this.paint.get("fill-extrusion-base").evaluate(r,o),I=[0,0],M=w&&h.elevation,P=h.elevation?h.elevation.exaggeration():1,R=c.tile.getBucket(this);if(M&&R instanceof u1){const G=R.centroidVertexArray,X=E+1;X<G.length&&(I[0]=G.geta_centroid_pos0(X),I[1]=G.geta_centroid_pos1(X))}if(I[0]===0&&I[1]===1)return!1;h.projection.name==="globe"&&(u=bk([u],[new bt(0,0),new bt(Ct,Ct)],c.tileID.canonical).map(G=>G.polygon).flat());const F=M?w:null,[B,Z]=function(G,X,ee,ie,ge,fe,pe,Ce,_e,Me,Re){return G.projection.name==="globe"?function(ke,Oe,Le,Ge,Ve,He,gt,ft,Ft,xt,Et){const _t=[],lr=[],Dt=ke.projection.upVectorScale(Et,ke.center.lat,ke.worldSize).metersToTile,Zt=[0,0,0,1],gr=[0,0,0,1],jr=(Fr,Rr,Ur,en)=>{Fr[0]=Rr,Fr[1]=Ur,Fr[2]=en,Fr[3]=1},xr=vk();Le>0&&(Le+=xr),Ge+=xr;for(const Fr of Oe){const Rr=[],Ur=[];for(const en of Fr){const Nn=en.x+Ve.x,_r=en.y+Ve.y,Wr=ke.projection.projectTilePoint(Nn,_r,Et),$n=ke.projection.upVector(Et,en.x,en.y);let Qn=Le,si=Ge;if(gt){const li=Ek(Nn,_r,Le,Ge,gt,ft,Ft,xt);Qn+=li.base,si+=li.top}Le!==0?jr(Zt,Wr.x+$n[0]*Dt*Qn,Wr.y+$n[1]*Dt*Qn,Wr.z+$n[2]*Dt*Qn):jr(Zt,Wr.x,Wr.y,Wr.z),jr(gr,Wr.x+$n[0]*Dt*si,Wr.y+$n[1]*Dt*si,Wr.z+$n[2]*Dt*si),de.vec3.transformMat4(Zt,Zt,He),de.vec3.transformMat4(gr,gr,He),Rr.push(new cf(Zt[0],Zt[1],Zt[2])),Ur.push(new cf(gr[0],gr[1],gr[2]))}_t.push(Rr),lr.push(Ur)}return[_t,lr]}(G,X,ee,ie,ge,fe,pe,Ce,_e,Me,Re):pe?function(ke,Oe,Le,Ge,Ve,He,gt,ft,Ft){const xt=[],Et=[],_t=[0,0,0,1];for(const lr of ke){const Dt=[],Zt=[];for(const gr of lr){const jr=gr.x+Ge.x,xr=gr.y+Ge.y,Fr=Ek(jr,xr,Oe,Le,He,gt,ft,Ft);_t[0]=jr,_t[1]=xr,_t[2]=Fr.base,_t[3]=1,de.vec4.transformMat4(_t,_t,Ve),_t[3]=Math.max(_t[3],1e-5);const Rr=new cf(_t[0]/_t[3],_t[1]/_t[3],_t[2]/_t[3]);_t[0]=jr,_t[1]=xr,_t[2]=Fr.top,_t[3]=1,de.vec4.transformMat4(_t,_t,Ve),_t[3]=Math.max(_t[3],1e-5);const Ur=new cf(_t[0]/_t[3],_t[1]/_t[3],_t[2]/_t[3]);Dt.push(Rr),Zt.push(Ur)}xt.push(Dt),Et.push(Zt)}return[xt,Et]}(X,ee,ie,ge,fe,pe,Ce,_e,Me):function(ke,Oe,Le,Ge,Ve){const He=[],gt=[],ft=Ve[8]*Oe,Ft=Ve[9]*Oe,xt=Ve[10]*Oe,Et=Ve[11]*Oe,_t=Ve[8]*Le,lr=Ve[9]*Le,Dt=Ve[10]*Le,Zt=Ve[11]*Le;for(const gr of ke){const jr=[],xr=[];for(const Fr of gr){const Rr=Fr.x+Ge.x,Ur=Fr.y+Ge.y,en=Ve[0]*Rr+Ve[4]*Ur+Ve[12],Nn=Ve[1]*Rr+Ve[5]*Ur+Ve[13],_r=Ve[2]*Rr+Ve[6]*Ur+Ve[14],Wr=Ve[3]*Rr+Ve[7]*Ur+Ve[15],$n=en+ft,Qn=Nn+Ft,si=_r+xt,li=Math.max(Wr+Et,1e-5),Mn=en+_t,Gi=Nn+lr,qs=_r+Dt,Ci=Math.max(Wr+Zt,1e-5);jr.push(new cf($n/li,Qn/li,si/li)),xr.push(new cf(Mn/Ci,Gi/Ci,qs/Ci))}He.push(jr),gt.push(xr)}return[He,gt]}(X,ee,ie,ge,fe)}(h,u,C,v,A,_,F,I,P,h.center.lat,c.tileID.canonical),W=c.queryGeometry;return function(G,X,ee){let ie=1/0;ne(ee,X)&&(ie=Tk(ee,X[0]));for(let ge=0;ge<X.length;ge++){const fe=X[ge],pe=G[ge];for(let Ce=0;Ce<fe.length-1;Ce++){const _e=fe[Ce],Me=[_e,fe[Ce+1],pe[Ce+1],pe[Ce],_e];te(ee,Me)&&(ie=Math.min(ie,Tk(ee,Me)))}}return ie!==1/0&&ie}(B,Z,W.isPointQuery()?W.screenBounds:W.screenGeometry)}},line:class extends es{constructor(c,r,o,u){const p=Dk();super(c,p,r,o,u),p.layout&&(this.layout=new Yu(p.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(c){if(c==="line-gradient"){const r=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=r._styleExpression&&r._styleExpression.expression instanceof Ra,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(c,r){super.recalculate(c,r),this.paint._values["line-floorwidth"]=(()=>{if(vy)return vy;const o=Dk();return vy=new A8(o.paint.properties["line-width"].specification),vy.useIntegerZoom=!0,vy})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)}createBucket(c){return new tT(c)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(c,r,o){const u=Rk(this);return{config:new $c(this,{zoom:r,lut:o}),defines:u,overrideFog:!1}}queryRadius(c){const r=c,o=Lk($e("line-width",this,r),$e("line-gap-width",this,r)),u=$e("line-offset",this,r);return o/2+Math.abs(u)+lt(this.paint.get("line-translate"))}queryIntersectsFeature(c,r,o,u,p,h){if(c.queryGeometry.isAboveHorizon)return!1;const _=dt(c.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),h.angle,c.pixelToTileUnitsFactor),w=c.pixelToTileUnitsFactor/2*Lk(this.paint.get("line-width").evaluate(r,o),this.paint.get("line-gap-width").evaluate(r,o)),E=this.paint.get("line-offset").evaluate(r,o);return E&&(u=function(A,v){const C=[],I=new bt(0,0);for(let M=0;M<A.length;M++){const P=A[M],R=[];for(let F=0;F<P.length;F++){const B=P[F],Z=P[F+1],W=F===0?I:B.sub(P[F-1])._unit()._perp(),G=F===P.length-1?I:Z.sub(B)._unit()._perp(),X=W._add(G)._unit();X._mult(1/(X.x*G.x+X.y*G.y)),R.push(X._mult(v)._add(B))}C.push(R)}return C}(u,E*c.pixelToTileUnitsFactor)),function(A,v,C){for(let I=0;I<v.length;I++){const M=v[I];if(A.length>=3){for(let P=0;P<M.length;P++)if(we(A,M[P]))return!0}if(se(A,M,C))return!0}return!1}(_,u,w)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(c){return!this.hasElevatedBuckets}},symbol:E1,background:class extends es{constructor(c,r,o,u){super(c,{layout:EN||(EN=new ii({visibility:new Tt(We.layout_background.visibility)})),paint:CN||(CN=new ii({"background-pitch-alignment":new Tt(We.paint_background["background-pitch-alignment"]),"background-color":new Tt(We.paint_background["background-color"]),"background-pattern":new Tt(We.paint_background["background-pattern"]),"background-opacity":new Tt(We.paint_background["background-opacity"]),"background-emissive-strength":new Tt(We.paint_background["background-emissive-strength"]),"background-color-use-theme":new Ot({type:"string",default:"default","property-type":"data-driven"})}))},r,o,u)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(c,r,o){return{overrideFog:!1}}is3D(c){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:kN,"raster-particle":ON,sky:class extends es{constructor(c,r,o,u){super(c,{layout:jN||(jN=new ii({visibility:new Tt(We.layout_sky.visibility)})),paint:DN||(DN=new ii({"sky-type":new Tt(We.paint_sky["sky-type"]),"sky-atmosphere-sun":new Tt(We.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Tt(We.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Tt(We.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Tt(We.paint_sky["sky-gradient-radius"]),"sky-gradient":new Xu(We.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Tt(We.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Tt(We.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Tt(We.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Ot({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Ot({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Ot({type:"string",default:"default","property-type":"data-driven"})}))},r,o,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="sky-gradient"?this._updateColorRamp():c!=="sky-atmosphere-sun"&&c!=="sky-atmosphere-halo-color"&&c!=="sky-atmosphere-color"&&c!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=dy({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(c){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const r=c.style.light.properties.get("position");return this._lightPosition.azimuthal!==r.azimuthal||this._lightPosition.polar!==r.polar}return!1}getCenter(c,r){if(this.paint.get("sky-type")==="atmosphere"){const u=this.paint.get("sky-atmosphere-sun"),p=!u,h=c.style.light,_=h.properties.get("position");return p&&h.properties.get("anchor")==="viewport"&&Kn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),p?ST(_.azimuthal,90-_.polar,r):ST(u[0],90-u[1],r)}const o=this.paint.get("sky-gradient-center");return ST(o[0],90-o[1],r)}isSky(){return!0}markSkyboxValid(c){this._skyboxInvalidated=!1,this._lightPosition=c.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const c=this.paint.get("sky-type");return c==="atmosphere"?["skyboxCapture","skybox"]:c==="gradient"?["skyboxGradient"]:null}},slot:class extends es{constructor(c,r,o,u){super(c,{paint:LN||(LN=new ii({}))},r,null)}},model:class extends es{constructor(c,r,o,u){super(c,{layout:WN||(WN=new ii({visibility:new Tt(We.layout_model.visibility),"model-id":new Ot(We.layout_model["model-id"])})),paint:ZN||(ZN=new ii({"model-opacity":new Ot(We.paint_model["model-opacity"]),"model-rotation":new Ot(We.paint_model["model-rotation"]),"model-scale":new Ot(We.paint_model["model-scale"]),"model-translation":new Ot(We.paint_model["model-translation"]),"model-color":new Ot(We.paint_model["model-color"]),"model-color-mix-intensity":new Ot(We.paint_model["model-color-mix-intensity"]),"model-type":new Tt(We.paint_model["model-type"]),"model-cast-shadows":new Tt(We.paint_model["model-cast-shadows"]),"model-receive-shadows":new Tt(We.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Tt(We.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Ot(We.paint_model["model-emissive-strength"]),"model-roughness":new Ot(We.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Ot(We.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Tt(We.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Tt(We.paint_model["model-front-cutoff"]),"model-color-use-theme":new Ot({type:"string",default:"default","property-type":"data-driven"})}))},r,o,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(c){return new CT(c)}getProgramIds(){return["model"]}is3D(c){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(c){return c instanceof R1?Ct-1:0}queryIntersectsFeature(c,r,o,u,p,h){if(!this.modelManager)return!1;const _=this.modelManager,w=c.tile.getBucket(this);if(!(w&&w instanceof CT))return!1;for(const E in w.instancesPerModel){const A=w.instancesPerModel[E],v=r.id!==void 0?r.id:r.properties&&r.properties.hasOwnProperty("id")?r.properties.id:void 0;if(A.idToFeaturesIndex.hasOwnProperty(v)){const C=A.features[A.idToFeaturesIndex[v]],I=_.getModel(E,this.scope);if(!I)return!1;let M=de.mat4.create();const P=new sn(0,0),R=w.canonical;let F=Number.MAX_VALUE;for(let B=0;B<C.instancedDataCount;++B){const Z=16*(C.instancedDataOffset+B),W=A.instancedDataArray.float32,G=[W[Z+4],W[Z+5],W[Z+6]];eR(R,P,W[Z],0|W[Z+1]),YN(M,I,h,P,C.rotation,C.scale,G,!1,!1,!1),h.projection.name==="globe"&&(M=ET(M,h));const X=de.mat4.multiply([],h.projMatrix,M),ee=c.queryGeometry,ie=UN(ee.isPointQuery()?ee.screenBounds:ee.screenGeometry,h,X,I.aabb);ie!=null&&(F=Math.min(ie,F))}return F!==Number.MAX_VALUE&&F}}return!1}_handleOverridablePaintPropertyUpdate(c,r,o){return!(!this.layout||r.isDataDriven()||o.isDataDriven()||c!=="model-color"&&c!=="model-color-mix-intensity"&&c!=="model-rotation"&&c!=="model-scale"&&c!=="model-translation"&&c!=="model-emissive-strength")}_isPropertyZoomDependent(c){const r=this._transitionablePaint._values[c];return r!=null&&r.value!=null&&r.value.expression!=null&&r.value.expression instanceof $u}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends es{constructor(c,r,o,u){super(c,{layout:YI||(YI=new ii({"clip-layer-types":new Tt(We.layout_clip["clip-layer-types"]),"clip-layer-scope":new Tt(We.layout_clip["clip-layer-scope"])})),paint:XI||(XI=new ii({}))},r,o,u)}recalculate(c,r){super.recalculate(c,r)}createBucket(c){return new KI(c)}is3D(c){return!0}}};class A${constructor(r){this._callback=r,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class P${constructor(){this.tasks={},this.taskQueue=[],Pa(["process"],this),this.invoker=new A$(this.process),this.nextId=0}add(r,o){const u=this.nextId++,p=function({type:h,isSymbolTile:_,zoom:w}){return w=w||0,h==="message"?0:h!=="maybePrepare"||_?h!=="parseTile"||_?h==="parseTile"&&_?300-w:h==="maybePrepare"&&_?400-w:500:200-w:100-w}(o);if(p===0){try{r()}finally{}return null}return this.tasks[u]={fn:r,metadata:o,priority:p,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;const r=this.pick();if(r===null)return;const o=this.tasks[r];if(delete this.tasks[r],this.taskQueue.length&&this.invoker.trigger(),!o)return;o.fn()}finally{}}pick(){let r=null,o=1/0;for(let p=0;p<this.taskQueue.length;p++){const h=this.tasks[this.taskQueue[p]];h.priority<o&&(o=h.priority,r=p)}if(r===null)return null;const u=this.taskQueue[r];return this.taskQueue.splice(r,1),u}remove(){this.invoker.remove()}}class tR{constructor(r,o,u){this.target=r,this.parent=o,this.mapId=u,this.callbacks={},this.cancelCallbacks={},Pa(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new P$}send(r,o,u,p,h=!1,_){const w=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(u.metadata=_,this.callbacks[w]=u);const E=new Set;return this.target.postMessage({id:w,type:r,hasCallback:!!u,targetMapId:p,mustQueue:h,sourceMapId:this.mapId,data:Jl(o,E)},E),{cancel:()=>{u&&delete this.callbacks[w],this.target.postMessage({id:w,type:"<cancel>",targetMapId:p,sourceMapId:this.mapId})}}}receive(r){const o=r.data;if(!o)return;const u=o.id;if(u&&(!o.targetMapId||this.mapId===o.targetMapId))if(o.type==="<cancel>"){const p=this.cancelCallbacks[u];delete this.cancelCallbacks[u],p&&p.cancel()}else if(o.mustQueue||xi()){const p=this.callbacks[u],h=this.scheduler.add(()=>this.processTask(u,o),p&&p.metadata||{type:"message"});h&&(this.cancelCallbacks[u]=h)}else this.processTask(u,o)}processTask(r,o){if(delete this.cancelCallbacks[r],o.type==="<response>"){const u=this.callbacks[r];delete this.callbacks[r],u&&(o.error?u(mo(o.error)):u(null,mo(o.data)))}else{const u=new Set,p=o.hasCallback?(_,w)=>{this.target.postMessage({id:r,type:"<response>",sourceMapId:this.mapId,error:_?Jl(_):null,data:Jl(w,u)},u)}:()=>{},h=mo(o.data);if(this.parent[o.type])this.parent[o.type](o.sourceMapId,h,p);else if(this.parent.getWorkerSource){const _=o.type.split(".");this.parent.getWorkerSource(o.sourceMapId,_[0],h.source,h.scope)[_[1]](h,p)}else p(new Error(`Could not find function ${o.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var Ry={workerUrl:"",workerClass:null,workerParams:void 0};const IT="mapboxgl_preloaded_worker_pool";class hf{constructor(){this.active={}}acquire(r,o=hf.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<o;)this.workers.push(Ry.workerClass!=null?new Ry.workerClass:new self.Worker(Ry.workerUrl,Ry.workerParams));return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],this.workers&&this.numActive()===0&&(this.workers.forEach(o=>{o.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[IT]}numActive(){return Object.keys(this.active).length}}hf.workerCount=2;class hm{constructor(r,o,u="Worker",p=hf.workerCount){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=Es();const h=this.workerPool.acquire(this.id,p);for(let _=0;_<h.length;_++){const w=new hm.Actor(h[_],o,this.id);w.name=`${u} ${_}`,this.actors.push(w)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,o,u){Bn(this.actors,(p,h)=>{p.send(r,o,h)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}let jy,kT;function j1(){return jy||(jy=new hf),jy}hm.Actor=tR;const NT=new _n(0,0,0);var RT=(c=>(c[c.PATH_RULE_UNSPECIFIED=0]="PATH_RULE_UNSPECIFIED",c[c.PATH_RULE_NON_ZERO=1]="PATH_RULE_NON_ZERO",c[c.PATH_RULE_EVEN_ODD=2]="PATH_RULE_EVEN_ODD",c))(RT||{}),D1=(c=>(c[c.LINE_CAP_UNSPECIFIED=0]="LINE_CAP_UNSPECIFIED",c[c.LINE_CAP_BUTT=1]="LINE_CAP_BUTT",c[c.LINE_CAP_ROUND=2]="LINE_CAP_ROUND",c[c.LINE_CAP_SQUARE=3]="LINE_CAP_SQUARE",c))(D1||{}),Dy=(c=>(c[c.LINE_JOIN_UNSPECIFIED=0]="LINE_JOIN_UNSPECIFIED",c[c.LINE_JOIN_MITER=1]="LINE_JOIN_MITER",c[c.LINE_JOIN_MITER_CLIP=2]="LINE_JOIN_MITER_CLIP",c[c.LINE_JOIN_ROUND=3]="LINE_JOIN_ROUND",c[c.LINE_JOIN_BEVEL=4]="LINE_JOIN_BEVEL",c))(Dy||{}),rR=(c=>(c[c.PAINT_ORDER_UNSPECIFIED=0]="PAINT_ORDER_UNSPECIFIED",c[c.PAINT_ORDER_FILL_AND_STROKE=1]="PAINT_ORDER_FILL_AND_STROKE",c[c.PAINT_ORDER_STROKE_AND_FILL=2]="PAINT_ORDER_STROKE_AND_FILL",c))(rR||{}),fm=(c=>(c[c.PATH_COMMAND_UNSPECIFIED=0]="PATH_COMMAND_UNSPECIFIED",c[c.PATH_COMMAND_MOVE=1]="PATH_COMMAND_MOVE",c[c.PATH_COMMAND_LINE=2]="PATH_COMMAND_LINE",c[c.PATH_COMMAND_QUAD=3]="PATH_COMMAND_QUAD",c[c.PATH_COMMAND_CUBIC=4]="PATH_COMMAND_CUBIC",c[c.PATH_COMMAND_CLOSE=5]="PATH_COMMAND_CLOSE",c))(fm||{}),nR=(c=>(c[c.MASK_TYPE_UNSPECIFIED=0]="MASK_TYPE_UNSPECIFIED",c[c.MASK_TYPE_LUMINANCE=1]="MASK_TYPE_LUMINANCE",c[c.MASK_TYPE_ALPHA=2]="MASK_TYPE_ALPHA",c))(nR||{});function I$(c,r,o){c===1&&r.icons.push(function(u,p){return function(h){if(h.usvg_tree.height||(h.usvg_tree.height=h.usvg_tree.width),!h.metadata)return h;const{metadata:_}=h;if(_.content_area){const{content_area:w}=_;w.top==null&&(w.top=w.left),w.width==null&&(w.width=h.usvg_tree.width),w.height==null&&(w.height=w.width)}return _.stretch_x&&_.stretch_x.length&&iR(_,"x"),_.stretch_y&&_.stretch_y.length&&iR(_,"y"),h}(u.readFields(k$,{name:void 0},p))}(o,o.readVarint()+o.pos))}function iR(c,r){const o=[],u=c[`stretch_${r}`];let p=null;for(let h=0;h<u.length;h++)p===null?p=o.length===0?u[0]:o[o.length-1][1]+u[h]:(o.push([p,p+u[h]]),p=null);c[`stretch_${r}_areas`]=o}function k$(c,r,o){c===1?r.name=o.readString():c===2?r.metadata=function(u,p){return u.readFields(N$,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},p)}(o,o.readVarint()+o.pos):c===3&&(r.usvg_tree=function(u,p){return u.readFields(D$,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},p)}(o,o.readVarint()+o.pos),r.data="usvg_tree")}function N$(c,r,o){c===1?r.stretch_x=o.readPackedVarint():c===2?r.stretch_y=o.readPackedVarint():c===3?r.content_area=function(u,p){return u.readFields(R$,{left:0},p)}(o,o.readVarint()+o.pos):c===4&&r.variables.push(function(u,p){return u.readFields(j$,{name:void 0},p)}(o,o.readVarint()+o.pos))}function R$(c,r,o){c===1?r.left=o.readVarint():c===2?r.width=o.readVarint():c===3?r.top=o.readVarint():c===4&&(r.height=o.readVarint())}function j$(c,r,o){c===1?r.name=o.readString():c===2&&(r.rgb_color=z1(o.readVarint()),r.value="rgb_color")}function D$(c,r,o){c===1?r.width=r.height=o.readVarint():c===2?r.height=o.readVarint():c===3?r.children.push(L1(o,o.readVarint()+o.pos)):c===4?r.linear_gradients.push(function(u,p){return u.readFields(U$,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},p)}(o,o.readVarint()+o.pos)):c===5?r.radial_gradients.push(function(u,p){return u.readFields(G$,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},p)}(o,o.readVarint()+o.pos)):c===7?r.clip_paths.push(function(u,p){return u.readFields(q$,{children:[]},p)}(o,o.readVarint()+o.pos)):c===8&&r.masks.push(function(u,p){const h=u.readFields(H$,{left:0,width:20,mask_type:1,children:[]},p);return h.height==null&&(h.height=h.width),h.top==null&&(h.top=h.left),h}(o,o.readVarint()+o.pos))}function L1(c,r){return c.readFields(L$,{},r)}function L$(c,r,o){c===1?(r.group=function(u,p){return u.readFields(O$,{opacity:255,children:[]},p)}(o,o.readVarint()+o.pos),r.node="group"):c===2&&(r.path=function(u,p){return u.readFields(F$,{paint_order:1,commands:[],step:1,diffs:[],rule:1},p)}(o,o.readVarint()+o.pos),r.node="path")}function O$(c,r,o){c===1?r.transform=O1(o,o.readVarint()+o.pos):c===2?r.opacity=o.readVarint():c===5?r.clip_path_idx=o.readVarint():c===6?r.mask_idx=o.readVarint():c===7&&r.children.push(L1(o,o.readVarint()+o.pos))}function O1(c,r){return c.readFields(z$,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},r)}function z$(c,r,o){c===1?r.sx=o.readFloat():c===2?r.ky=o.readFloat():c===3?r.kx=o.readFloat():c===4?r.sy=o.readFloat():c===5?r.tx=o.readFloat():c===6&&(r.ty=o.readFloat())}function F$(c,r,o){c===1?r.fill=function(u,p){return u.readFields(B$,{rgb_color:NT,paint:"rgb_color",opacity:255},p)}(o,o.readVarint()+o.pos):c===2?r.stroke=function(u,p){return u.readFields(V$,{rgb_color:NT,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},p)}(o,o.readVarint()+o.pos):c===3?r.paint_order=o.readVarint():c===5?o.readPackedVarint(r.commands):c===6?r.step=o.readFloat():c===7?o.readPackedSVarint(r.diffs):c===8&&(r.rule=o.readVarint())}function B$(c,r,o){c===1?(r.rgb_color=z1(o.readVarint()),r.paint="rgb_color"):c===2?(r.linear_gradient_idx=o.readVarint(),r.paint="linear_gradient_idx"):c===3?(r.radial_gradient_idx=o.readVarint(),r.paint="radial_gradient_idx"):c===5&&(r.opacity=o.readVarint())}function z1(c){return new _n((c>>16&255)/255,(c>>8&255)/255,(255&c)/255,1)}function V$(c,r,o){c===1?(r.rgb_color=z1(o.readVarint()),r.paint="rgb_color"):c===2?(r.linear_gradient_idx=o.readVarint(),r.paint="linear_gradient_idx"):c===3?(r.radial_gradient_idx=o.readVarint(),r.paint="radial_gradient_idx"):c===5?o.readPackedFloat(r.dasharray):c===6?r.dashoffset=o.readFloat():c===7?r.miterlimit=o.readFloat():c===8?r.opacity=o.readVarint():c===9?r.width=o.readFloat():c===10?r.linecap=o.readVarint():c===11&&(r.linejoin=o.readVarint())}function U$(c,r,o){c===1?r.transform=O1(o,o.readVarint()+o.pos):c===2?r.spread_method=o.readVarint():c===3?r.stops.push(sR(o,o.readVarint()+o.pos)):c===4?r.x1=o.readFloat():c===5?r.y1=o.readFloat():c===6?r.x2=o.readFloat():c===7&&(r.y2=o.readFloat())}function sR(c,r){return c.readFields($$,{offset:0,opacity:255,rgb_color:NT},r)}function $$(c,r,o){c===1?r.offset=o.readFloat():c===2?r.opacity=o.readVarint():c===3&&(r.rgb_color=z1(o.readVarint()))}function G$(c,r,o){c===1?r.transform=O1(o,o.readVarint()+o.pos):c===2?r.spread_method=o.readVarint():c===3?r.stops.push(sR(o,o.readVarint()+o.pos)):c===4?r.cx=o.readFloat():c===5?r.cy=o.readFloat():c===6?r.r=o.readFloat():c===7?r.fx=o.readFloat():c===8?r.fy=o.readFloat():c===9&&(r.fr=o.readFloat())}function q$(c,r,o){c===1?r.transform=O1(o,o.readVarint()+o.pos):c===2?r.clip_path_idx=o.readVarint():c===3&&r.children.push(L1(o,o.readVarint()+o.pos))}function H$(c,r,o){c===1?r.left=r.top=o.readFloat():c===2?r.width=r.height=o.readFloat():c===3?r.top=o.readFloat():c===4?r.height=o.readFloat():c===5?r.mask_type=o.readVarint():c===6?r.mask_idx=o.readVarint():c===7&&r.children.push(L1(o,o.readVarint()+o.pos))}class W${static calculate(r={},o=[]){const u=new Map,p=new Map;if(Object.keys(r).length===0)return u;o.forEach(h=>{p.set(h.name,h.rgb_color||new _n(0,0,0))});for(const[h,_]of Object.entries(r))p.has(h)?u.set(p.get(h).toStringPremultipliedAlpha(),_):console.warn(`Ignoring unknown image variable "${h}"`);return u}}function pm(c,r=255,o){const u=r/255,p=c.toStringPremultipliedAlpha(),h=o.has(p)?o.get(p).clone():c.clone();return h.a*=u,h.toString()}function Ly(c,r){if(!st()){const o=document.createElement("canvas");return o.width=c,o.height=r,o}return new OffscreenCanvas(c,r)}function Z$(c,r){const o=W$.calculate(r.params,c.metadata?c.metadata.variables:[]),u=c.usvg_tree,p=u.width,h=u.height,_=r.transform?r.transform:new DOMMatrix,w=Math.max(1,Math.round(p*_.a)),E=Math.max(1,Math.round(h*_.d)),A=new DOMMatrix([w/p,0,0,E/h,0,0]),v=Ly(w,E).getContext("2d");return jT(v,A,u,u,o),v.getImageData(0,0,w,E)}function jT(c,r,o,u,p){for(const h of u.children)oR(c,r,o,h,p)}function oR(c,r,o,u,p){u.group?(c.save(),function(h,_,w,E,A){const v=E.mask_idx!=null?w.masks[E.mask_idx]:null,C=E.clip_path_idx!=null?w.clip_paths[E.clip_path_idx]:null;if(E.transform&&(_=F1(E.transform).preMultiplySelf(_)),!function(P,R,F){return P.opacity!==255||R||F}(E,C!=null,v!=null))return void jT(h,_,w,E,A);const I=Ly(h.canvas.width,h.canvas.height),M=I.getContext("2d");jT(M,_,w,E,A),C&&fR(M,_,w,C),v&&pR(M,_,w,v,A),h.globalAlpha=E.opacity/255,h.drawImage(I,0,0)}(c,r,o,u.group,p),c.restore()):u.path&&(c.save(),function(h,_,w,E,A){const v=mR(E);h.setTransform(_),E.paint_order===rR.PAINT_ORDER_FILL_AND_STROKE?(aR(h,w,E,v,A),cR(h,w,E,v,A)):(cR(h,w,E,v,A),aR(h,w,E,v,A))}(c,r,o,u.path,p),c.restore())}function aR(c,r,o,u,p){const h=o.fill;if(!h)return;const _=h.opacity/255;switch(h.paint){case"rgb_color":c.fillStyle=pm(h.rgb_color,h.opacity,p);break;case"linear_gradient_idx":c.fillStyle=uR(c,r.linear_gradients[h.linear_gradient_idx],_,p);break;case"radial_gradient_idx":c.fillStyle=dR(c,r.radial_gradients[h.radial_gradient_idx],_,p)}c.fill(u,lR(o))}function lR(c){return c.rule===RT.PATH_RULE_NON_ZERO?"nonzero":c.rule===RT.PATH_RULE_EVEN_ODD?"evenodd":void 0}function cR(c,r,o,u,p){const h=o.stroke;if(!h)return;c.lineWidth=h.width,c.miterLimit=h.miterlimit,c.setLineDash(h.dasharray),c.lineDashOffset=h.dashoffset;const _=h.opacity/255;switch(h.paint){case"rgb_color":c.strokeStyle=pm(h.rgb_color,h.opacity,p);break;case"linear_gradient_idx":c.strokeStyle=uR(c,r.linear_gradients[h.linear_gradient_idx],_,p);break;case"radial_gradient_idx":c.strokeStyle=dR(c,r.radial_gradients[h.radial_gradient_idx],_,p)}switch(h.linejoin){case Dy.LINE_JOIN_MITER_CLIP:case Dy.LINE_JOIN_MITER:c.lineJoin="miter";break;case Dy.LINE_JOIN_ROUND:c.lineJoin="round";break;case Dy.LINE_JOIN_BEVEL:c.lineJoin="bevel"}switch(h.linecap){case D1.LINE_CAP_BUTT:c.lineCap="butt";break;case D1.LINE_CAP_ROUND:c.lineCap="round";break;case D1.LINE_CAP_SQUARE:c.lineCap="square"}c.stroke(u)}function uR(c,r,o,u){if(r.stops.length===1){const I=r.stops[0];return pm(I.rgb_color,I.opacity*o,u)}const p=F1(r.transform),{x1:h,y1:_,x2:w,y2:E}=r,A=p.transformPoint(new DOMPoint(h,_)),v=p.transformPoint(new DOMPoint(w,E)),C=c.createLinearGradient(A.x,A.y,v.x,v.y);for(const I of r.stops)C.addColorStop(I.offset,pm(I.rgb_color,I.opacity*o,u));return C}function dR(c,r,o,u){if(r.stops.length===1){const I=r.stops[0];return pm(I.rgb_color,I.opacity*o,u)}const p=F1(r.transform),{fx:h,fy:_,cx:w,cy:E}=r,A=p.transformPoint(new DOMPoint(h,_)),v=p.transformPoint(new DOMPoint(w,E)),C=c.createRadialGradient(A.x,A.y,0,v.x,v.y,r.r*((p.a+p.d)/2));for(const I of r.stops)C.addColorStop(I.offset,pm(I.rgb_color,I.opacity*o,u));return C}function hR(c,r,o,u){const p=u.transform?F1(u.transform).preMultiplySelf(r):r,h=Ly(c.canvas.width,c.canvas.height),_=h.getContext("2d");for(const E of u.children)if(E.group)hR(_,p,o,E.group);else if(E.path){const A=E.path,v=new Path2D;v.addPath(mR(A),p),_.fill(v,lR(A))}const w=u.clip_path_idx!=null?o.clip_paths[u.clip_path_idx]:null;w&&fR(_,p,o,w),c.globalCompositeOperation="source-over",c.drawImage(h,0,0)}function fR(c,r,o,u){const p=Ly(c.canvas.width,c.canvas.height);hR(p.getContext("2d"),r,o,u),c.globalCompositeOperation="destination-in",c.drawImage(p,0,0)}function pR(c,r,o,u,p){if(u.children.length===0)return;const h=u.mask_idx!=null?o.masks[u.mask_idx]:null;h&&pR(c,r,o,h,p);const _=c.canvas.width,w=c.canvas.height,E=Ly(_,w),A=E.getContext("2d"),v=u.width,C=u.height,I=u.left,M=u.top,P=new Path2D,R=new Path2D;R.rect(I,M,v,C),P.addPath(R,r),A.clip(P);for(const Z of u.children)oR(A,r,o,Z,p);const F=A.getImageData(0,0,_,w),B=F.data;if(u.mask_type===nR.MASK_TYPE_LUMINANCE)for(let Z=0;Z<B.length;Z+=4)B[Z+3]=B[Z+3]/255*(.2126*B[Z]+.7152*B[Z+1]+.0722*B[Z+2]);A.putImageData(F,0,0),c.globalCompositeOperation="destination-in",c.drawImage(E,0,0)}function F1(c){return c?new DOMMatrix([c.sx,c.ky,c.kx,c.sy,c.tx,c.ty]):new DOMMatrix}function mR(c){const r=new Path2D,o=c.step;let u=c.diffs[0]*o,p=c.diffs[1]*o;r.moveTo(u,p);for(let h=0,_=2;h<c.commands.length;h++)switch(c.commands[h]){case fm.PATH_COMMAND_MOVE:u+=c.diffs[_++]*o,p+=c.diffs[_++]*o,r.moveTo(u,p);break;case fm.PATH_COMMAND_LINE:u+=c.diffs[_++]*o,p+=c.diffs[_++]*o,r.lineTo(u,p);break;case fm.PATH_COMMAND_QUAD:{const w=u+c.diffs[_++]*o,E=p+c.diffs[_++]*o;u=w+c.diffs[_++]*o,p=E+c.diffs[_++]*o,r.quadraticCurveTo(w,E,u,p);break}case fm.PATH_COMMAND_CUBIC:{const w=u+c.diffs[_++]*o,E=p+c.diffs[_++]*o,A=w+c.diffs[_++]*o,v=E+c.diffs[_++]*o;u=A+c.diffs[_++]*o,p=v+c.diffs[_++]*o,r.bezierCurveTo(w,E,A,v,u,p);break}case fm.PATH_COMMAND_CLOSE:r.closePath()}return r}class B1{constructor(r){this.capacity=r,this.cache=new Map}get(r){if(!this.cache.has(r))return;const o=this.cache.get(r);return this.cache.delete(r),this.cache.set(r,o),o}put(r,o){this.cache.has(r)?this.cache.delete(r):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(r,o)}delete(r){this.cache.delete(r)}}zt(B1,"LRUCache");class DT{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(r){return new bs(r,r.data)}getFromCache(r,o,u){return this.cacheMap.has(u)||this.cacheMap.set(u,new B1(150)),this.cacheMap.get(u).get(Ju(r.toString(),o))}setInCache(r,o,u,p){this.cacheDependenciesMap.has(p)||this.cacheDependenciesMap.set(p,new Map),this.cacheMap.has(p)||this.cacheMap.set(p,new B1(150));const h=this.cacheDependenciesMap.get(p),_=Ju(r.id.toString(),u);h.get(_)||h.set(_,new Set);const w=this.cacheMap.get(p),E=r.toString();h.get(_).add(E),w.put(Ju(r.toString(),u),o)}removeImagesFromCacheByIds(r,o,u=0){if(!this.cacheMap.has(u)||!this.cacheDependenciesMap.has(u))return;const p=this.cacheMap.get(u),h=this.cacheDependenciesMap.get(u);for(const _ of r){const w=Ju(_.toString(),o);if(h.has(w)){for(const E of h.get(w))p.delete(E);h.delete(w)}}}rasterize(r,o,u,p,h=Z$){const _=this.getFromCache(r,u,p);if(_)return _.clone();const w=h(o.icon,r.options),E=DT._getImage(w);return this.setInCache(r,E,u,p),E.clone()}}class gR{constructor(r){this.size=r,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(r,o){const u=this.toIdx(r,o);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(r,o){return this.leaves[this.toIdx(r,o)]}toIdx(r,o){return o*this.size+r}}function _R(c,r,o,u){let p=0,h=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(u[_])<1e-15){if(o[_]<c[_]||o[_]>r[_])return null}else{const w=1/u[_];let E=(c[_]-o[_])*w,A=(r[_]-o[_])*w;if(E>A){const v=E;E=A,A=v}if(E>p&&(p=E),A<h&&(h=A),p>h)return null}return p}function yR(c,r,o,u,p,h,_,w,E,A,v){const C=u-c,I=p-r,M=h-o,P=_-c,R=w-r,F=E-o,B=v[1]*F-v[2]*R,Z=v[2]*P-v[0]*F,W=v[0]*R-v[1]*P,G=C*B+I*Z+M*W;if(Math.abs(G)<1e-15)return null;const X=1/G,ee=A[0]-c,ie=A[1]-r,ge=A[2]-o,fe=(ee*B+ie*Z+ge*W)*X;if(fe<0||fe>1)return null;const pe=ie*M-ge*I,Ce=ge*C-ee*M,_e=ee*I-ie*C,Me=(v[0]*pe+v[1]*Ce+v[2]*_e)*X;return Me<0||fe+Me>1?null:(P*pe+R*Ce+F*_e)*X}function xR(c,r,o){return(c-r)/(o-r)}function vR(c,r,o,u,p,h,_,w,E){const A=1<<o,v=h-u,C=_-p,I=(c+1)/A*v+u,M=(r+0)/A*C+p,P=(r+1)/A*C+p;w[0]=(c+0)/A*v+u,w[1]=M,E[0]=I,E[1]=P}class bR{constructor(r){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=r,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const o=function(h){const _=Math.ceil(Math.log2(h.dim/8)),w=[];let E=Math.ceil(Math.pow(2,_));const A=1/E,v=(M,P,R,F,B)=>{const Z=F?1:0,W=(M+1)*R-Z,G=P*R,X=(P+1)*R-Z;B[0]=M*R,B[1]=G,B[2]=W,B[3]=X};let C=new gR(E);const I=[];for(let M=0;M<E*E;M++){v(M%E,Math.floor(M/E),A,!1,I);const P=fd(I[0],I[1],h),R=fd(I[2],I[1],h),F=fd(I[2],I[3],h),B=fd(I[0],I[3],h);C.minimums.push(Math.min(P,R,F,B)),C.maximums.push(Math.max(P,R,F,B)),C.leaves.push(1)}for(w.push(C),E/=2;E>=1;E/=2){const M=w[w.length-1];C=new gR(E);for(let P=0;P<E*E;P++){v(P%E,Math.floor(P/E),2,!0,I);const R=M.getElevation(I[0],I[1]),F=M.getElevation(I[2],I[1]),B=M.getElevation(I[2],I[3]),Z=M.getElevation(I[0],I[3]),W=M.isLeaf(I[0],I[1]),G=M.isLeaf(I[2],I[1]),X=M.isLeaf(I[2],I[3]),ee=M.isLeaf(I[0],I[3]),ie=Math.min(R.min,F.min,B.min,Z.min),ge=Math.max(R.max,F.max,B.max,Z.max),fe=W&&G&&X&&ee;C.maximums.push(ge),C.minimums.push(ie),C.leaves.push(ge-ie<=5&&fe?1:0)}w.push(C)}return w}(this.dem),u=o.length-1,p=o[u];this._addNode(p.minimums[0],p.maximums[0],p.leaves[0]),this._construct(o,0,0,u,0)}raycastRoot(r,o,u,p,h,_,w=1){return _R([r,o,-100],[u,p,this.maximums[0]*w],h,_)}raycast(r,o,u,p,h,_,w=1){if(!this.nodeCount)return null;const E=this.raycastRoot(r,o,u,p,h,_,w);if(E==null)return null;const A=[],v=[],C=[],I=[],M=[{idx:0,t:E,nodex:0,nodey:0,depth:0}];for(;M.length>0;){const{idx:P,t:R,nodex:F,nodey:B,depth:Z}=M.pop();if(this.leaves[P]){vR(F,B,Z,r,o,u,p,C,I);const G=1<<Z,X=(F+0)/G,ee=(F+1)/G,ie=(B+0)/G,ge=(B+1)/G,fe=fd(X,ie,this.dem)*w,pe=fd(ee,ie,this.dem)*w,Ce=fd(ee,ge,this.dem)*w,_e=fd(X,ge,this.dem)*w,Me=yR(C[0],C[1],fe,I[0],C[1],pe,I[0],I[1],Ce,h,_),Re=yR(I[0],I[1],Ce,C[0],I[1],_e,C[0],C[1],fe,h,_),ke=Math.min(Me!==null?Me:Number.MAX_VALUE,Re!==null?Re:Number.MAX_VALUE);if(ke!==Number.MAX_VALUE)return ke;{const Oe=de.vec3.scaleAndAdd([],h,_,R);if(wR(fe,pe,_e,Ce,xR(Oe[0],C[0],I[0]),xR(Oe[1],C[1],I[1]))>=Oe[2])return R}continue}let W=0;for(let G=0;G<this._siblingOffset.length;G++){vR((F<<1)+this._siblingOffset[G][0],(B<<1)+this._siblingOffset[G][1],Z+1,r,o,u,p,C,I),C[2]=-100,I[2]=this.maximums[this.childOffsets[P]+G]*w;const X=_R(C,I,h,_);if(X!=null){const ee=X;A[G]=ee;let ie=!1;for(let ge=0;ge<W&&!ie;ge++)ee>=A[v[ge]]&&(v.splice(ge,0,G),ie=!0);ie||(v[W]=G),W++}}for(let G=0;G<W;G++){const X=v[G];M.push({idx:this.childOffsets[P]+X,t:A[X],nodex:(F<<1)+this._siblingOffset[X][0],nodey:(B<<1)+this._siblingOffset[X][1],depth:Z+1})}}return null}_addNode(r,o,u){return this.minimums.push(r),this.maximums.push(o),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(r,o,u,p,h){if(r[p].isLeaf(o,u)===1)return;this.childOffsets[h]||(this.childOffsets[h]=this.nodeCount);const _=p-1,w=r[_];let E=0,A=0;for(let v=0;v<this._siblingOffset.length;v++){const C=2*o+this._siblingOffset[v][0],I=2*u+this._siblingOffset[v][1],M=w.getElevation(C,I),P=w.isLeaf(C,I),R=this._addNode(M.min,M.max,P);P&&(E|=1<<v),A||(A=R)}for(let v=0;v<this._siblingOffset.length;v++)E&1<<v||this._construct(r,2*o+this._siblingOffset[v][0],2*u+this._siblingOffset[v][1],_,A+v)}}function wR(c,r,o,u,p,h){return ur(ur(c,o,h),ur(r,u,h),p)}function fd(c,r,o){const u=o.dim,p=Bt(c*u-.5,0,u-1),h=Bt(r*u-.5,0,u-1),_=Math.floor(p),w=Math.floor(h),E=Math.min(_+1,u-1),A=Math.min(w+1,u-1);return wR(o.get(_,w),o.get(E,w),o.get(_,A),o.get(E,A),p-_,h-w)}const Y$={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function X$(c,r,o){return(256*c*256+256*r+o)/10-1e4}function K$(c,r,o){return 256*c+r+o/256-32768}class V1{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(r,o,u,p=!1){if(this.uid=r,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return void Kn(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=o.height;const h=this.dim=o.height-2,_=new Uint32Array(o.data.buffer);if(this.pixels=new Uint8Array(o.data.buffer),this.floatView=new Float32Array(o.data.buffer),this.borderReady=p,this._modifiedForSources={},!p){for(let E=0;E<h;E++)_[this._idx(-1,E)]=_[this._idx(0,E)],_[this._idx(h,E)]=_[this._idx(h-1,E)],_[this._idx(E,-1)]=_[this._idx(E,0)],_[this._idx(E,h)]=_[this._idx(E,h-1)];_[this._idx(-1,-1)]=_[this._idx(0,0)],_[this._idx(h,-1)]=_[this._idx(h-1,0)],_[this._idx(-1,h)]=_[this._idx(0,h-1)],_[this._idx(h,h)]=_[this._idx(h-1,h-1)]}const w=u==="terrarium"?K$:X$;for(let E=0;E<_.length;++E){const A=4*E;this.floatView[E]=w(this.pixels[A],this.pixels[A+1],this.pixels[A+2])}this._timestamp=et.now()}_buildQuadTree(){this._tree=new bR(this)}get(r,o,u=!1){u&&(r=Bt(r,-1,this.dim),o=Bt(o,-1,this.dim));const p=this._idx(r,o);return this.floatView[p]}set(r,o,u){const p=this._idx(r,o),h=this.floatView[p];return this.floatView[p]=u,u-h}static getUnpackVector(r){return Y$[r]}_idx(r,o){if(r<-1||r>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(r+1)}static pack(r,o){const u=[0,0,0,0],p=V1.getUnpackVector(o);let h=Math.floor((r+p[3])/p[2]);return u[2]=h%256,h=Math.floor(h/256),u[1]=h%256,h=Math.floor(h/256),u[0]=h,u}getPixels(){return new kI({width:this.stride,height:this.stride},this.pixels)}backfillBorder(r,o,u){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let p=o*this.dim,h=o*this.dim+this.dim,_=u*this.dim,w=u*this.dim+this.dim;switch(o){case-1:p=h-1;break;case 1:h=p+1}switch(u){case-1:_=w-1;break;case 1:w=_+1}const E=-o*this.dim,A=-u*this.dim;for(let v=_;v<w;v++)for(let C=p;C<h;C++){const I=4*this._idx(C,v),M=4*this._idx(C+E,v+A);this.pixels[I+0]=r.pixels[M+0],this.pixels[I+1]=r.pixels[M+1],this.pixels[I+2]=r.pixels[M+2],this.pixels[I+3]=r.pixels[M+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function J$(c,r,o){c===1?r.headerLength=o.readFixed32():c===2?r.x=o.readVarint():c===3?r.y=o.readVarint():c===4?r.z=o.readVarint():c===5&&r.layers.push(function(u,p){return u.readFields(n7,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},p)}(o,o.readVarint()+o.pos))}function Q$(c,r,o){c===1?(r.delta_filter=function(u,p){return u.readFields(e7,{blockSize:0},p)}(o,o.readVarint()+o.pos),r.filter="delta_filter"):c===2?(o.readVarint(),r.filter="zigzag_filter"):c===3?(o.readVarint(),r.filter="bitshuffle_filter"):c===4&&(o.readVarint(),r.filter="byteshuffle_filter")}function e7(c,r,o){c===1&&(r.blockSize=o.readVarint())}function t7(c,r,o){c===1?(o.readVarint(),r.codec="gzip_data"):c===2?(o.readVarint(),r.codec="jpeg_image"):c===3?(o.readVarint(),r.codec="webp_image"):c===4&&(o.readVarint(),r.codec="png_image")}function r7(c,r,o){let u=0,p=0;c===1?r.firstByte=o.readFixed64():c===2?r.lastByte=o.readFixed64():c===3?r.filters.push(function(h,_){return h.readFields(Q$,{},_)}(o,o.readVarint()+o.pos)):c===4?r.codec=function(h,_){return h.readFields(t7,{},_)}(o,o.readVarint()+o.pos):c===5?p=o.readFloat():c===6?u=o.readFloat():c===7?r.bands.push(o.readString()):c===8?r.offset=o.readDouble():c===9&&(r.scale=o.readDouble()),r.offset===0&&(r.offset=p),r.scale===0&&(r.scale=u)}function n7(c,r,o){c===1?r.version=o.readVarint():c===2?r.name=o.readString():c===3?r.units=o.readString():c===4?r.tileSize=o.readVarint():c===5?r.buffer=o.readVarint():c===6?r.pixelFormat=o.readVarint():c===7&&r.dataIndex.push(function(u,p){return u.readFields(r7,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},p)}(o,o.readVarint()+o.pos))}function i7(c,r,o){if(c===2)(function(u,p,h){u.readFields(s7,h,p)})(o,o.readVarint()+o.pos,r);else if(c===3)throw new Error("Not implemented")}function s7(c,r,o){if(c===1){let u=0;const p=o.readVarint()+o.pos;for(;o.pos<p;)r[u++]=o.readVarint()}}function o7(c,r){if(r.length!==4)throw new Error(`Expected data of dimension 4 but got ${r.length}.`);let o=r[3];for(let u=2;u>=1;u--){const p=u===1?1:0,h=u===2?1:0;for(let _=0;_<r[0];_++){const w=r[1]*_;for(let E=p;E<r[1];E++){const A=r[2]*(E+w);for(let v=h;v<r[2];v++){const C=r[3]*(v+A);for(let I=0;I<r[3];I++){const M=C+I;c[M]+=c[M-o]}}}}o*=r[u]}return c}function a7(c){for(let r=0,o=c.length;r<o;r++)c[r]=c[r]>>>1^-(1&c[r]);return c}function l7(c,r){switch(r){case"uint32":return c;case"uint16":for(let o=0;o<c.length;o+=2){const u=c[o],p=c[o+1];c[o]=(240&u)>>4|(61440&u)>>8|(240&p)<<4|61440&p,c[o+1]=15&u|(3840&u)>>4|(15&p)<<8|(3840&p)<<4}return c;case"uint8":for(let o=0;o<c.length;o+=4){const u=c[o],p=c[o+1],h=c[o+2],_=c[o+3];c[o+0]=(192&u)>>6|(192&p)>>4|(192&h)>>2|192&_,c[o+1]=(48&u)>>4|(48&p)>>2|48&h|(48&_)<<2,c[o+2]=(12&u)>>2|12&p|(12&h)<<2|(12&_)<<4,c[o+3]=3&u|(3&p)<<2|(3&h)<<4|(3&_)<<6}return c;default:throw new Error(`Invalid pixel format, "${r}"`)}}zt(V1,"DEMData"),zt(bR,"DemMinMaxQuadTree",{omit:["dem"]});var da=Uint8Array,Oy=Uint16Array,c7=Int32Array,SR=new da([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),TR=new da([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),u7=new da([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ER=function(c,r){for(var o=new Oy(31),u=0;u<31;++u)o[u]=r+=1<<c[u-1];var p=new c7(o[30]);for(u=1;u<30;++u)for(var h=o[u];h<o[u+1];++h)p[h]=h-o[u]<<5|u;return{b:o,r:p}},CR=ER(SR,2),MR=CR.b,d7=CR.r;MR[28]=258,d7[258]=28;for(var h7=ER(TR,0).b,AR=new Oy(32768),Ni=0;Ni<32768;++Ni){var mm=(43690&Ni)>>1|(21845&Ni)<<1;AR[Ni]=((65280&(mm=(61680&(mm=(52428&mm)>>2|(13107&mm)<<2))>>4|(3855&mm)<<4))>>8|(255&mm)<<8)>>1}var zy=function(c,r,o){for(var u=c.length,p=0,h=new Oy(r);p<u;++p)c[p]&&++h[c[p]-1];var _,w=new Oy(r);for(p=1;p<r;++p)w[p]=w[p-1]+h[p-1]<<1;_=new Oy(1<<r);var E=15-r;for(p=0;p<u;++p)if(c[p])for(var A=p<<4|c[p],v=r-c[p],C=w[c[p]-1]++<<v,I=C|(1<<v)-1;C<=I;++C)_[AR[C]>>E]=A;return _},Fy=new da(288);for(Ni=0;Ni<144;++Ni)Fy[Ni]=8;for(Ni=144;Ni<256;++Ni)Fy[Ni]=9;for(Ni=256;Ni<280;++Ni)Fy[Ni]=7;for(Ni=280;Ni<288;++Ni)Fy[Ni]=8;var PR=new da(32);for(Ni=0;Ni<32;++Ni)PR[Ni]=5;var f7=zy(Fy,9),p7=zy(PR,5),LT=function(c){for(var r=c[0],o=1;o<c.length;++o)c[o]>r&&(r=c[o]);return r},yl=function(c,r,o){var u=r/8|0;return(c[u]|c[u+1]<<8)>>(7&r)&o},OT=function(c,r){var o=r/8|0;return(c[o]|c[o+1]<<8|c[o+2]<<16)>>(7&r)},m7=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],xl=function(c,r,o){var u=new Error(r||m7[c]);if(u.code=c,Error.captureStackTrace&&Error.captureStackTrace(u,xl),!o)throw u;return u},g7=new da(0),_7=typeof TextDecoder<"u"&&new TextDecoder;try{_7.decode(g7,{stream:!0})}catch{}const y7={gzip_data:"gzip"};class Fa extends Error{constructor(r){super(r),this.name="MRTError"}}const x7={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},IR={uint32:1,uint16:2,uint8:4},v7={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let zT;class U1{constructor(r=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=r}getLayer(r){const o=this.layers[r];if(!o)throw new Fa(`Layer '${r}' not found`);return o}getHeaderLength(r){const o=new Uint8Array(r),u=new DataView(r);if(o[0]!==13)throw new Fa("File is not a valid MRT.");return u.getUint32(1,!0)}parseHeader(r){const o=new Uint8Array(r),u=this.getHeaderLength(r);if(o.length<u)throw new Fa(`Expected header with length >= ${u} but got buffer of length ${o.length}`);const p=function(h,_){return h.readFields(J$,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new zT(o.subarray(0,u)));if(!isNaN(this.x)&&(this.x!==p.x||this.y!==p.y||this.z!==p.z))throw new Fa(`Invalid attempt to parse header ${p.z}/${p.x}/${p.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=p.x,this.y=p.y,this.z=p.z;for(const h of p.layers)this.layers[h.name]=new kR(h,{cacheSize:this._cacheSize});return this}createDecodingTask(r){const o=[],u=this.getLayer(r.layerName);for(let p of r.blockIndices){const h=u.dataIndex[p],_=h.firstByte-r.firstByte,w=h.lastByte-r.firstByte;if(u._blocksInProgress.has(p))continue;const E={layerName:u.name,firstByte:_,lastByte:w,pixelFormat:u.pixelFormat,blockIndex:p,blockShape:[h.bands.length].concat(u.bandShape),buffer:u.buffer,codec:h.codec.codec,filters:h.filters.map(A=>A.filter)};u._blocksInProgress.add(p),o.push(E)}return new NR(o,()=>{o.forEach(p=>u._blocksInProgress.delete(p.blockIndex))},(p,h)=>{if(o.forEach(_=>u._blocksInProgress.delete(_.blockIndex)),p)throw p;h.forEach(_=>{this.getLayer(_.layerName).processDecodedData(_)})})}}class kR{constructor({version:r,name:o,units:u,tileSize:p,pixelFormat:h,buffer:_,dataIndex:w},E){if(this.version=r,this.version!==1)throw new Fa(`Cannot parse raster layer encoded with MRT version ${r}`);this.name=o,this.units=u,this.tileSize=p,this.buffer=_,this.pixelFormat=x7[h],this.dataIndex=w,this.bandShape=[p+2*_,p+2*_,IR[this.pixelFormat]],this._decodedBlocks=new B1(E?E.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return IR[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:r})=>r).flat()}processDecodedData(r){const o=r.blockIndex.toString();this._decodedBlocks.get(o)||this._decodedBlocks.put(o,r.data)}getBlockForBand(r){let o=0;switch(typeof r){case"string":for(const[u,p]of this.dataIndex.entries()){for(const[h,_]of p.bands.entries())if(_===r)return{bandIndex:o+h,blockIndex:u,blockBandIndex:h};o+=p.bands.length}break;case"number":for(const[u,p]of this.dataIndex.entries()){if(r>=o&&r<o+p.bands.length)return{bandIndex:r,blockIndex:u,blockBandIndex:r-o};o+=p.bands.length}break;default:throw new Fa(`Invalid band \`${JSON.stringify(r)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(r){let o=1/0,u=-1/0;const p=[],h=new Set;for(const _ of r){const{blockIndex:w}=this.getBlockForBand(_);if(w<0)throw new Fa(`Invalid band: ${JSON.stringify(_)}`);const E=this.dataIndex[w];p.includes(w)||p.push(w),h.add(w),o=Math.min(o,E.firstByte),u=Math.max(u,E.lastByte)}if(h.size>this.cacheSize)throw new Fa(`Number of blocks to decode (${h.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:o,lastByte:u,blockIndices:p}}hasBand(r){const{blockIndex:o}=this.getBlockForBand(r);return o>=0}hasDataForBand(r){const{blockIndex:o}=this.getBlockForBand(r);return o>=0&&!!this._decodedBlocks.get(o.toString())}getBandView(r){const{blockIndex:o,blockBandIndex:u}=this.getBlockForBand(r);if(o<0)throw new Fa(`Band not found: ${JSON.stringify(r)}`);const p=this._decodedBlocks.get(o.toString());if(!p)throw new Fa(`Data for band ${JSON.stringify(r)} of layer "${this.name}" not decoded.`);const h=this.dataIndex[o],_=this.bandShape.reduce((A,v)=>A*v,1),w=u*_,E=p.subarray(w,w+_);return{data:E,bytes:new Uint8Array(E.buffer).subarray(E.byteOffset,E.byteOffset+E.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:h.offset,scale:h.scale}}}U1.setPbf=function(c){zT=c};class NR{constructor(r,o,u){this.tasks=r,this._onCancel=o,this._onComplete=u,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(r,o){this._finalized||(this._onComplete(r,o),this._finalized=!0)}}U1.performDecoding=function(c,r){const o=new Uint8Array(c);return Promise.all(r.tasks.map(u=>{const{layerName:p,firstByte:h,lastByte:_,pixelFormat:w,blockShape:E,blockIndex:A,filters:v,codec:C}=u,I=o.subarray(h,_+1),M=new Uint32Array(E[0]*E[1]*E[2]);let P;if(C!=="gzip_data")throw new Fa(`Unhandled codec: ${C}`);return P=function(R,F){if(!globalThis.DecompressionStream&&F==="gzip_data")return Promise.resolve(((G=function(ie){ie[0]==31&&ie[1]==139&&ie[2]==8||xl(6,"invalid gzip data");var ge=ie[3],fe=10;4&ge&&(fe+=2+(ie[10]|ie[11]<<8));for(var pe=(ge>>3&1)+(ge>>4&1);pe>0;pe-=!ie[fe++]);return fe+(2&ge)}(W=R))+8>W.length&&xl(6,"invalid gzip data"),function(ie,ge,fe,pe){var Ce=ie.length;if(!Ce||ge.f&&!ge.l)return fe||new da(0);var _e=!fe,Me=_e||ge.i!=2,Re=ge.i;_e&&(fe=new da(3*Ce));var ke,Oe,Le=function(md){var gd=fe.length;if(md>gd){var pf=new da(Math.max(2*gd,md));pf.set(fe),fe=pf}},Ge=ge.f||0,Ve=ge.p||0,He=ge.b||0,gt=ge.l,ft=ge.d,Ft=ge.m,xt=ge.n,Et=8*Ce;do{if(!gt){Ge=yl(ie,Ve,1);var _t=yl(ie,Ve+1,3);if(Ve+=3,!_t){var lr=ie[(_r=4+((Ve+7)/8|0))-4]|ie[_r-3]<<8,Dt=_r+lr;if(Dt>Ce){Re&&xl(0);break}Me&&Le(He+lr),fe.set(ie.subarray(_r,Dt),He),ge.b=He+=lr,ge.p=Ve=8*Dt,ge.f=Ge;continue}if(_t==1)gt=f7,ft=p7,Ft=9,xt=5;else if(_t==2){var Zt=yl(ie,Ve,31)+257,gr=yl(ie,Ve+10,15)+4,jr=Zt+yl(ie,Ve+5,31)+1;Ve+=14;for(var xr=new da(jr),Fr=new da(19),Rr=0;Rr<gr;++Rr)Fr[u7[Rr]]=yl(ie,Ve+3*Rr,7);Ve+=3*gr;var Ur=LT(Fr),en=(1<<Ur)-1,Nn=zy(Fr,Ur);for(Rr=0;Rr<jr;){var _r,Wr=Nn[yl(ie,Ve,en)];if(Ve+=15&Wr,(_r=Wr>>4)<16)xr[Rr++]=_r;else{var $n=0,Qn=0;for(_r==16?(Qn=3+yl(ie,Ve,3),Ve+=2,$n=xr[Rr-1]):_r==17?(Qn=3+yl(ie,Ve,7),Ve+=3):_r==18&&(Qn=11+yl(ie,Ve,127),Ve+=7);Qn--;)xr[Rr++]=$n}}var si=xr.subarray(0,Zt),li=xr.subarray(Zt);Ft=LT(si),xt=LT(li),gt=zy(si,Ft),ft=zy(li,xt)}else xl(1);if(Ve>Et){Re&&xl(0);break}}Me&&Le(He+131072);for(var Mn=(1<<Ft)-1,Gi=(1<<xt)-1,qs=Ve;;qs=Ve){var Ci=($n=gt[OT(ie,Ve)&Mn])>>4;if((Ve+=15&$n)>Et){Re&&xl(0);break}if($n||xl(2),Ci<256)fe[He++]=Ci;else{if(Ci==256){qs=Ve,gt=null;break}var Ri=Ci-254;Ci>264&&(Ri=yl(ie,Ve,(1<<(ha=SR[Rr=Ci-257]))-1)+MR[Rr],Ve+=ha);var ks=ft[OT(ie,Ve)&Gi],ds=ks>>4;if(ks||xl(3),Ve+=15&ks,li=h7[ds],ds>3){var ha=TR[ds];li+=OT(ie,Ve)&(1<<ha)-1,Ve+=ha}if(Ve>Et){Re&&xl(0);break}Me&&Le(He+131072);var pd=He+Ri;if(He<li){var Ba=0-li,bl=Math.min(li,pd);for(Ba+He<0&&xl(3);He<bl;++He)fe[He]=(void 0)[Ba+He]}for(;He<pd;++He)fe[He]=fe[He-li]}}ge.l=gt,ge.p=qs,ge.b=He,ge.f=Ge,gt&&(Ge=1,ge.m=Ft,ge.d=ft,ge.n=xt)}while(!Ge);return He!=fe.length&&_e?(ke=fe,((Oe=He)==null||Oe>ke.length)&&(Oe=ke.length),new da(ke.subarray(0,Oe))):fe.subarray(0,He)}(W.subarray(G,-8),{i:2},new da(((B=W)[(Z=B.length)-4]|B[Z-3]<<8|B[Z-2]<<16|B[Z-1]<<24)>>>0))));var B,Z,W,G;const X=y7[F];if(!X)throw new Error(`Unhandled codec: ${F}`);const ee=new globalThis.DecompressionStream(X);return new Response(new Blob([R]).stream().pipeThrough(ee)).arrayBuffer().then(ie=>new Uint8Array(ie))}(I,C).then(R=>(function(F,B){F.readFields(i7,B)}(new zT(R),M),new v7[w](M.buffer))),P.then(R=>{for(let F=v.length-1;F>=0;F--)switch(v[F]){case"delta_filter":o7(R,E);break;case"zigzag_filter":a7(R);break;case"bitshuffle_filter":l7(R,w);break;default:throw new Fa(`Unhandled filter "${v[F]}"`)}return{layerName:p,blockIndex:A,data:R}}).catch(R=>{throw R})}))},zt(NR,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),zt(U1,"MapboxRasterTile"),zt(kR,"MapboxRasterLayer",{omit:["_blocksInProgress"]});let By,FT,vl,gm,BT,_m=null;function RR(){return xi()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:FT||oe.DRACO_URL}function jR(){if(xi()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(gm)return gm;const c=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return gm=WebAssembly.validate(c)?oe.MESHOPT_SIMD_URL:oe.MESHOPT_URL,gm}const $1={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},b7={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Vy={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function DR(c,r,o){const u=o.json.bufferViews.length,p=o.buffers.length;r.bufferView=u,o.json.bufferViews[u]={buffer:p,byteLength:c.byteLength},o.buffers[p]=c}const VT="KHR_draco_mesh_compression";function w7(c,r){const o=c.extensions&&c.extensions[VT];if(!o)return;const u=new vl.Decoder,p=FR(r,o.bufferView),h=new vl.Mesh;if(!u.DecodeArrayToMesh(p,p.byteLength,h))throw new Error("Failed to decode Draco mesh");const _=r.json.accessors[c.indices],w=$1[_.componentType],E=_.count*w.BYTES_PER_ELEMENT,A=vl._malloc(E);w===Uint16Array?u.GetTrianglesUInt16Array(h,E,A):u.GetTrianglesUInt32Array(h,E,A),DR(vl.memory.buffer.slice(A,A+E),_,r),vl._free(A);for(const v of Object.keys(o.attributes)){const C=u.GetAttributeByUniqueId(h,o.attributes[v]),I=r.json.accessors[c.attributes[v]],M=b7[I.componentType],P=I.count*Vy[I.type]*$1[I.componentType].BYTES_PER_ELEMENT,R=vl._malloc(P);u.GetAttributeDataArrayForAllPoints(h,C,vl[M],P,R),DR(vl.memory.buffer.slice(R,R+P),I,r),vl._free(R)}u.destroy(),h.destroy(),delete c.extensions[VT]}const G1="EXT_meshopt_compression";function S7(c,r){if(!c.extensions||!c.extensions[G1])return;const o=c.extensions[G1],u=new Uint8Array(r.buffers[o.buffer],o.byteOffset||0,o.byteLength||0),p=new Uint8Array(o.count*o.byteStride);BT.decodeGltfBuffer(p,o.count,o.byteStride,u,o.mode,o.filter),c.buffer=r.buffers.length,c.byteOffset=0,r.buffers[c.buffer]=p.buffer,delete c.extensions[G1]}const LR=1179937895,OR=new TextDecoder("utf8");function zR(c,r){return new URL(c,r).href}function T7(c,r,o,u){return fetch(zR(c.uri,u)).then(p=>p.arrayBuffer()).then(p=>{r.buffers[o]=p})}function FR(c,r){const o=c.json.bufferViews[r];return new Uint8Array(c.buffers[o.buffer],o.byteOffset||0,o.byteLength)}function E7(c,r,o,u){if(c.uri){const p=zR(c.uri,u);return fetch(p).then(h=>h.blob()).then(h=>createImageBitmap(h)).then(h=>{r.images[o]=h})}if(c.bufferView!==void 0){const p=FR(r,c.bufferView),h=new Blob([p],{type:c.mimeType});return createImageBitmap(h).then(_=>{r.images[o]=_})}}function BR(c,r=0,o){const u={json:null,images:[],buffers:[]};if(new Uint32Array(c,r,1)[0]===LR){const v=new Uint32Array(c,r);let C=2;const I=(v[C++]>>2)-3,M=v[C++]>>2;if(C++,u.json=JSON.parse(OR.decode(v.subarray(C,C+M))),C+=M,C<I){const P=v[C++];C++;const R=r+(C<<2);u.buffers[0]=c.slice(R,R+P)}}else u.json=JSON.parse(OR.decode(new Uint8Array(c,r)));const{buffers:p,images:h,meshes:_,extensionsUsed:w,bufferViews:E}=u.json;let A=Promise.resolve();if(p){const v=[];for(let C=0;C<p.length;C++){const I=p[C];I.uri?v.push(T7(I,u,C,o)):u.buffers[C]||(u.buffers[C]=null)}A=Promise.all(v)}return A.then(()=>{const v=[],C=w&&w.includes(VT),I=w&&w.includes(G1);if(C&&v.push(function(){if(!vl)return By??(By=function(M){let P,R=null;function F(){P=new Uint8Array(R.buffer)}function B(){throw new Error("Unexpected Draco error.")}const Z={a:{a:B,d:function(W,G,X){return P.copyWithin(W,G,G+X)},c:function(W){const G=P.length,X=Math.max(W>>>0,Math.ceil(1.2*G)),ee=Math.ceil((X-G)/65536);try{return R.grow(ee),F(),!0}catch{return!1}},b:B}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(M,Z):M.then(W=>W.arrayBuffer()).then(W=>WebAssembly.instantiate(W,Z))).then(W=>{const{Rb:G,Qb:X,P:ee,T:ie,X:ge,Ja:fe,La:pe,Qa:Ce,Va:_e,Wa:Me,eb:Re,jb:ke,f:Oe,e:Le,yb:Ge,zb:Ve,Ab:He,Bb:gt,Db:ft,Gb:Ft}=W.instance.exports;R=Le;const xt=(()=>{let Et=0,_t=0,lr=0,Dt=0;return Zt=>{lr&&(G(Dt),G(Et),_t+=lr,lr=Et=0),Et||(_t+=128,Et=X(_t));const gr=Zt.length+7&-8;let jr=Et;gr>=_t&&(lr=gr,jr=Dt=X(gr));for(let xr=0;xr<Zt.length;xr++)P[jr+xr]=Zt[xr];return jr}})();return F(),Oe(),{memory:Le,_free:G,_malloc:X,Mesh:class{constructor(){this.ptr=ee()}destroy(){ie(this.ptr)}},Decoder:class{constructor(){this.ptr=fe()}destroy(){ke(this.ptr)}DecodeArrayToMesh(Et,_t,lr){const Dt=xt(Et),Zt=pe(this.ptr,Dt,_t,lr.ptr);return!!ge(Zt)}GetAttributeByUniqueId(Et,_t){return{ptr:Ce(this.ptr,Et.ptr,_t)}}GetTrianglesUInt16Array(Et,_t,lr){_e(this.ptr,Et.ptr,_t,lr)}GetTrianglesUInt32Array(Et,_t,lr){Me(this.ptr,Et.ptr,_t,lr)}GetAttributeDataArrayForAllPoints(Et,_t,lr,Dt,Zt){Re(this.ptr,Et.ptr,_t.ptr,lr,Dt,Zt)}},DT_INT8:Ge(),DT_UINT8:Ve(),DT_INT16:He(),DT_UINT16:gt(),DT_UINT32:ft(),DT_FLOAT32:Ft()}})}(fetch(RR())),By.then(M=>{vl=M,By=void 0}))}()),I&&v.push(function(){if(BT)return;const M=function(P){let R;const F=WebAssembly.instantiateStreaming(P,{}).then(W=>{R=W.instance,R.exports.__wasm_call_ctors()}),B={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Z={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:F,supported:!0,decodeGltfBuffer(W,G,X,ee,ie,ge){(function(fe,pe,Ce,_e,Me,Re,ke){const Oe=fe.exports.sbrk,Le=_e+3&-4,Ge=Oe(Le*Me),Ve=Oe(Re.length),He=new Uint8Array(fe.exports.memory.buffer);He.set(Re,Ve);const gt=pe(Ge,_e,Me,Ve,Re.length);if(gt===0&&ke&&ke(Ge,Le,Me),Ce.set(He.subarray(Ge,Ge+_e*Me)),Oe(Ge-Oe(0)),gt!==0)throw new Error(`Malformed buffer data: ${gt}`)})(R,R.exports[Z[ie]],W,G,X,ee,R.exports[B[ge]])}}}(fetch(jR()));return M.ready.then(()=>{BT=M})}()),h)for(let M=0;M<h.length;M++)v.push(E7(h[M],u,M,o));return(v.length?Promise.all(v):Promise.resolve()).then(()=>{if(C&&_)for(const{primitives:M}of _)for(const P of M)w7(P,u);if(I&&_&&E)for(const M of E)S7(M,u);return u})})}function ff(c,r){const o=c.json.bufferViews[r.bufferView],u=$1[r.componentType];return new u(c.buffers[o.buffer],(r.byteOffset||0)+(o.byteOffset||0),r.count*(o.byteStride&&o.byteStride!==Vy[r.type]*u.BYTES_PER_ELEMENT?o.byteStride/u.BYTES_PER_ELEMENT:Vy[r.type]))}function UT(c,r,o,u){const p=$1[r.componentType],h=function(v){switch(v){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(p),_=c.json.bufferViews[r.bufferView],w=_.byteStride?_.byteStride/p.BYTES_PER_ELEMENT:Vy[r.type],E=o.float32,A=E.length/o.capacity;for(let v=0,C=0;v<r.count*w;v+=w,C+=A)for(let I=0;I<A;I++)E[C+I]=u[v+I]*h;o._trim()}function C7(c,r,o){const u=c.indices,p=c.attributes,h={};h.indexArray=new ls;const _=r.json.accessors[u],w=_.count/3;h.indexArray.reserve(w);const E=ff(r,_);for(let I=0;I<w;I++)h.indexArray.emplaceBack(E[3*I],E[3*I+1],E[3*I+2]);h.indexArray._trim(),h.vertexArray=new ca;const A=r.json.accessors[p.POSITION];h.vertexArray.reserve(A.count);const v=ff(r,A);for(let I=0;I<A.count;I++)h.vertexArray.emplaceBack(v[3*I],v[3*I+1],v[3*I+2]);if(h.vertexArray._trim(),h.aabb=new Xt(A.min,A.max),h.centroid=function(I,M){const P=[0,0,0],R=I.length;if(R>0){for(let F=0;F<R;F++){const B=3*I[F];P[0]+=M[B],P[1]+=M[B+1],P[2]+=M[B+2]}P[0]/=R,P[1]/=R,P[2]/=R}return P}(E,v),p.COLOR_0!==void 0){const I=r.json.accessors[p.COLOR_0],M=Vy[I.type],P=ff(r,I);h.colorArray=M===3?new ca:new Vc,h.colorArray.resize(I.count),UT(r,I,h.colorArray,P)}if(p.NORMAL!==void 0){h.normalArray=new ca;const I=r.json.accessors[p.NORMAL];h.normalArray.resize(I.count);const M=ff(r,I);UT(r,I,h.normalArray,M)}if(p.TEXCOORD_0!==void 0&&o.length>0){h.texcoordArray=new ed;const I=r.json.accessors[p.TEXCOORD_0];h.texcoordArray.resize(I.count);const M=ff(r,I);UT(r,I,h.texcoordArray,M)}if(p._FEATURE_ID_RGBA4444!==void 0){const I=r.json.accessors[p._FEATURE_ID_RGBA4444];r.json.extensionsUsed&&r.json.extensionsUsed.includes("EXT_meshopt_compression")&&(h.featureData=ff(r,I))}p._FEATURE_RGBA4444!==void 0&&(h.featureData=new Uint32Array(ff(r,r.json.accessors[p._FEATURE_RGBA4444]).buffer));const C=c.material;return h.material=function(I,M){const{emissiveFactor:P=[0,0,0],alphaMode:R="OPAQUE",alphaCutoff:F=.5,normalTexture:B,occlusionTexture:Z,emissiveTexture:W,doubleSided:G}=I,{baseColorFactor:X=[1,1,1,1],metallicFactor:ee=1,roughnessFactor:ie=1,baseColorTexture:ge,metallicRoughnessTexture:fe}=I.pbrMetallicRoughness||{},pe=Z?M[Z.index]:void 0;if(Z&&Z.extensions&&Z.extensions.KHR_texture_transform&&pe){const Ce=Z.extensions.KHR_texture_transform;pe.offsetScale=[Ce.offset[0],Ce.offset[1],Ce.scale[0],Ce.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new _n(...X),metallicFactor:ee,roughnessFactor:ie,baseColorTexture:ge?M[ge.index]:void 0,metallicRoughnessTexture:fe?M[fe.index]:void 0},doubleSided:G,emissiveFactor:P,alphaMode:R,alphaCutoff:F,normalTexture:B?M[B.index]:void 0,occlusionTexture:pe,emissionTexture:W?M[W.index]:void 0,defined:I.defined===void 0}}(C!==void 0?r.json.materials[C]:{defined:!1},o),h}function VR(c,r,o){const{matrix:u,rotation:p,translation:h,scale:_,mesh:w,extras:E,children:A}=c,v={};if(v.matrix=u||de.mat4.fromRotationTranslationScale([],p||[0,0,0,1],h||[0,0,0],_||[1,1,1]),w!==void 0){v.meshes=o[w];const C=v.anchor=[0,0];for(const I of v.meshes){const{min:M,max:P}=I.aabb;C[0]+=M[0]+P[0],C[1]+=M[1]+P[1]}C[0]=Math.floor(C[0]/v.meshes.length/2),C[1]=Math.floor(C[1]/v.meshes.length/2)}if(E&&(E.id&&(v.id=E.id),E.lights&&(v.lights=function(C){if(!C.length)return[];const I=function(B){const Z=atob(B),W=new Uint8Array(Z.length);for(let G=0;G<Z.length;G++)W[G]=Z.codePointAt(G);return W}(C),M=[],P=I.length/24,R=new Uint16Array(I.buffer),F=new Float32Array(I.buffer);for(let B=0;B<P;B++){const Z=R[2*B*6]/30,W=R[2*B*6+1]/30,G=R[2*B*6+10]/100,X=F[6*B+1],ee=F[6*B+2],ie=F[6*B+3],ge=F[6*B+4],fe=ie-X,pe=ge-ee,Ce=Math.hypot(fe,pe);M.push({pos:[X+.5*fe,ee+.5*pe,W],normal:[pe/Ce,-fe/Ce,0],width:Ce,height:Z,depth:G,points:[X,ee,ie,ge]})}return M}(E.lights))),A){const C=[];for(const I of A)C.push(VR(r.json.nodes[I],r,o));v.children=C}return v}function M7(c){if(c.vertices.length===0||c.indices.length===0)return null;const r=new YS(c.vertices,c.indices,8,256),[o,u]=[r.min.clone(),r.max.clone()];return{vertices:c.vertices,indices:c.indices,grid:r,min:o,max:u}}function A7(c){if(!c.extras||!c.extras.ground)return null;const r=c.extras.ground;if(!r||!Array.isArray(r)||r.length===0)return null;const o=r[0];if(!o||!Array.isArray(o)||o.length===0)return null;const u=[];for(const _ of o){if(!Array.isArray(_)||_.length!==2)continue;const w=_[0],E=_[1];typeof w=="number"&&typeof E=="number"&&u.push(new bt(w,E))}if(u.length<3)return null;u.length>1&&u[u.length-1].equals(u[0])&&u.pop();let p=0;for(let _=0;_<u.length;_++){const w=u[_],E=u[(_+1)%u.length],A=u[(_+2)%u.length];p+=(w.x-E.x)*(A.y-E.y)-(A.x-E.x)*(w.y-E.y)}p>0&&u.reverse();const h=hy(u.flatMap(_=>[_.x,_.y]),[]);return h.length===0?null:{vertices:u,indices:h}}function P7(c,r){const o=[],u=[];let p=0;const h=[];for(const _ of c){p=o.length;const w=_.vertexArray.float32,E=_.indexArray.uint16;for(let A=0;A<_.vertexArray.length;A++)h[0]=w[3*A+0],h[1]=w[3*A+1],h[2]=w[3*A+2],de.vec3.transformMat4(h,h,r),o.push(new bt(h[0],h[1]));for(let A=0;A<3*_.indexArray.length;A++)u.push(E[A]+p)}if(u.length%3!=0)return null;for(let _=0;_<u.length;_+=3){const w=o[u[_+0]],E=o[u[_+1]],A=o[u[_+2]];(w.x-E.x)*(A.y-E.y)-(A.x-E.x)*(w.y-E.y)>0&&([u[_+1],u[_+2]]=[u[_+2],u[_+1]])}return{vertices:o,indices:u}}function UR(c){const r=function(E,A){const v=[],C=WebGL2RenderingContext;if(E.json.textures)for(const I of E.json.textures){const M={magFilter:C.LINEAR,minFilter:C.NEAREST,wrapS:C.REPEAT,wrapT:C.REPEAT};I.sampler!==void 0&&Object.assign(M,E.json.samplers[I.sampler]),v.push({image:A[I.source],sampler:M,uploaded:!1})}return v}(c,c.images),o=function(E,A){const v=[];for(const C of E.json.meshes){const I=[];for(const M of C.primitives)I.push(C7(M,E,A));v.push(I)}return v}(c,r),{scenes:u,scene:p,nodes:h}=c.json,_=u?u[p||0].nodes:h,w=[];for(const E of _)w.push(VR(h[E],c,o));return function(E,A,v){const C={},I=new Set;for(let M=0;M<E.length;M++){const P=v[A[M]];if(!P.extras)continue;const R=P.extras["mapbox:footprint:version"],F=P.extras["mapbox:footprint:id"];(R||F)&&I.add(M),R==="1.0.0"&&F&&(C[F]=M)}for(let M=0;M<E.length;M++){if(I.has(M))continue;const P=E[M],R=v[A[M]];if(!R.extras)continue;let F=null;P.id in C&&(F=P7(E[C[P.id]].meshes,P.matrix)),F||(F=A7(R)),F&&(P.footprint=M7(F))}if(I.size>0){const M=Array.from(I.values()).sort((P,R)=>P-R);for(let P=M.length-1;P>=0;P--)E.splice(M[P],1)}}(w,_,c.json.nodes),w}function I7(c){c.heightmap=new Float32Array(4096),c.heightmap.fill(-1);const r=c.vertexArray.float32,o=c.aabb.min[0]-1,u=c.aabb.min[1]-1,p=uf/(c.aabb.max[0]-o+2),h=uf/(c.aabb.max[1]-u+2);for(let _=0;_<r.length;_+=3){const w=r[_+2],E=(r[_+0]-o)*p|0,A=(r[_+1]-u)*h|0;w>c.heightmap[A*uf+E]&&(c.heightmap[A*uf+E]=w)}}function k7(c,r){const o={};o.indexArray=new ls,o.indexArray.reserve(4*c.length),o.vertexArray=new ca,o.vertexArray.reserve(10*c.length),o.colorArray=new Vc,o.vertexArray.reserve(10*c.length);let u=0;for(const _ of c){const w=Math.min(10,Math.max(4,1.3*_.height))*r,E=[-_.normal[1],_.normal[0],0],A=Math.min(.29,.1*_.width/_.depth),v=_.width-2*_.depth*r*(A+.01),C=de.vec3.scaleAndAdd([],_.pos,E,v/2),I=de.vec3.scaleAndAdd([],_.pos,E,-v/2),M=[C[0],C[1],C[2]+_.height],P=[I[0],I[1],I[2]+_.height],R=de.vec3.scaleAndAdd([],_.normal,E,A);de.vec3.scale(R,R,w);const F=de.vec3.scaleAndAdd([],_.normal,E,-A);de.vec3.scale(F,F,w),de.vec3.add(R,C,R),de.vec3.add(F,I,F),C[2]+=.1,I[2]+=.1,o.vertexArray.emplaceBack(R[0],R[1],R[2]),o.vertexArray.emplaceBack(F[0],F[1],F[2]),o.vertexArray.emplaceBack(C[0],C[1],C[2]),o.vertexArray.emplaceBack(I[0],I[1],I[2]),o.vertexArray.emplaceBack(M[0],M[1],M[2]),o.vertexArray.emplaceBack(P[0],P[1],P[2]),o.vertexArray.emplaceBack(C[0],C[1],C[2]),o.vertexArray.emplaceBack(I[0],I[1],I[2]),o.vertexArray.emplaceBack(R[0],R[1],R[2]),o.vertexArray.emplaceBack(F[0],F[1],F[2]);const B=v/w/2;o.colorArray.emplaceBack(-B-A,-1,B,.8),o.colorArray.emplaceBack(B+A,-1,B,.8),o.colorArray.emplaceBack(-B,0,B,1.3),o.colorArray.emplaceBack(B,0,B,1.3),o.colorArray.emplaceBack(B+A,-.8,B,.7),o.colorArray.emplaceBack(B+A,-.8,B,.7),o.colorArray.emplaceBack(0,0,B,1.3),o.colorArray.emplaceBack(0,0,B,1.3),o.colorArray.emplaceBack(B+A,-1.2,B,.8),o.colorArray.emplaceBack(B+A,-1.2,B,.8),o.indexArray.emplaceBack(6+u,4+u,8+u),o.indexArray.emplaceBack(7+u,9+u,5+u),o.indexArray.emplaceBack(0+u,1+u,2+u),o.indexArray.emplaceBack(1+u,3+u,2+u),u+=10}const p={defined:!0,emissiveFactor:[0,0,0]},h={};return h.baseColorFactor=_n.white,p.pbrMetallicRoughness=h,o.material=p,o.aabb=new Xt([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),o}class $R{constructor(r){this._stringToNumber={},this._numberToString=[];for(let o=0;o<r.length;o++){const u=r[o];this._stringToNumber[u]=o,this._numberToString[o]=u}}encode(r){return this._stringToNumber[r]}decode(r){return this._numberToString[r]}}const N7=["id","tile","layer","source","sourceLayer","state"];class ym{constructor(r,o,u,p,h){this.type="Feature",this._vectorTileFeature=r,this._z=o,this._x=u,this._y=p,this.properties=r.properties,this.id=h}clone(){const r=new ym(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(r.state=Object.assign({},this.state)),this.layer&&(r.layer=Object.assign({},this.layer)),this.source&&(r.source=this.source),this.sourceLayer&&(r.sourceLayer=this.sourceLayer),r}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const o of N7)this[o]!==void 0&&(r[o]=this[o]);return r}}class GR{constructor(r,o){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new Gu(Ct,16,0),this.featureIndexArray=new Ks,this.promoteId=o,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(r,o,u,p,h,_=0,w=0){const E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,p,h,_);const A=this.grid;for(let v=0;v<o.length;v++){const C=o[v],I=[1/0,1/0,-1/0,-1/0];for(let M=0;M<C.length;M++){const P=C[M];I[0]=Math.min(I[0],P.x),I[1]=Math.min(I[1],P.y),I[2]=Math.max(I[2],P.x),I[3]=Math.max(I[3],P.y)}w!==0&&(I[0]-=w,I[1]-=w,I[2]+=w,I[3]+=w),I[0]<Ct&&I[1]<Ct&&I[2]>=0&&I[3]>=0&&A.insert(E,I[0],I[1],I[2],I[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new ad.VectorTile(new h1(this.rawTileData)).layers,this.sourceLayerCoder=new $R(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const r in this.vtLayers)this.vtFeatures[r]=[]}return this.vtLayers}query(r,o){const{tilespaceGeometry:u,transform:p,tileTransform:h,pixelPosMatrix:_,availableImages:w}=o;this.loadVTLayers(),this.serializedLayersCache.clear();const E=u.bufferedTilespaceBounds,A=this.grid.query(E.min.x,E.min.y,E.max.x,E.max.y,(M,P,R,F)=>Te(u.bufferedTilespaceGeometry,M,P,R,F));A.sort(R7);let v=null;p.elevation&&A.length>0&&(v=dm.create(p.elevation,this.tileID));const C={};let I;for(let M=0;M<A.length;M++){const P=A[M];if(P===I)continue;I=P;const R=this.featureIndexArray.get(P);let F=null;this.is3DTile?this.loadMatchingModelFeature(C,R,r,u,p):this.loadMatchingFeature(C,R,r,w,(B,Z,W,G=0)=>(F||(F=L(B,this.tileID.canonical,h)),Z.queryIntersectsFeature(u,B,W,F,this.z,p,_,v,G)))}return C}loadMatchingFeature(r,o,u,p,h){const{featureIndex:_,bucketIndex:w,sourceLayerIndex:E,layoutVertexArrayOffset:A}=o,v=this.bucketLayerIDs[w],C=u.layers,I=Object.keys(C);if(I.length&&!function(B,Z){for(let W=0;W<B.length;W++)if(Z.indexOf(B[W])>=0)return!0;return!1}(I,v))return;const M=u.sourceCache,P=this.sourceLayerCoder.decode(E),R=this.vtLayers[P].feature(_),F=this.getId(R,P);for(let B=0;B<v.length;B++){const Z=v[B];if(!C[Z])continue;const{styleLayer:W,targets:G}=C[Z];let X={};F!==void 0&&(X=M.getFeatureState(W.sourceLayer,F));const ee=!h||h(R,W,X,A);if(!ee)continue;const ie=new ym(R,this.z,this.x,this.y,F);ie.tile=this.tileID.canonical,ie.state=X;let ge=this.serializedLayersCache.get(Z);ge||(ge=W.serialize(),ge.id=Z,this.serializedLayersCache.set(Z,ge)),ie.source=ge.source,ie.sourceLayer=ge["source-layer"],ie.layer=fi({},ge),ie.layer.paint=qR(ge.paint,W.paint,R,X,p),ie.layer.layout=qR(ge.layout,W.layout,R,X,p);let fe=!1;for(const pe of G){this.updateFeatureProperties(ie,pe);const{filter:Ce}=pe;if(Ce){if(R.properties=ie.properties,Ce.needGeometry){const _e=z(R,!0);if(!Ce.filter(new kn(this.tileID.overscaledZ),_e,this.tileID.canonical))continue}else if(!Ce.filter(new kn(this.tileID.overscaledZ),R))continue}fe=!0,pe.targetId&&this.addFeatureVariant(ie,pe)}fe&&this.appendToResult(r,Z,_,ie,ee)}}loadMatchingModelFeature(r,o,u,p,h){const _=this.bucketLayerIDs[0][0],w=u.layers;if(!w[_])return;const{styleLayer:E,targets:A}=w[_];if(E.type!=="model")return;const v=p.tile,C=o.featureIndex,I=v.getBucket(E);if(!(I&&I instanceof R1))return;const M=function(ge,fe,pe,Ce){const _e=ge.getNodesInfo()[fe];if(_e.hiddenByReplacement||!_e.node.meshes)return;let Me=Number.MAX_VALUE;const Re=_e.node,ke=pe.tile,Oe=Ce.calculatePosMatrix(ke.tileID.toUnwrapped(),Ce.worldSize),Le=_e.evaluatedScale;let Ge=0;Ce.elevation&&Re.elevation&&(Ge=Re.elevation*Ce.elevation.exaggeration()),de.mat4.translate(Oe,Oe,[(Re.anchor?Re.anchor[0]:0)*(Le[0]-1),(Re.anchor?Re.anchor[1]:0)*(Le[1]-1),Ge]),de.mat4.scale(Oe,Oe,Le);const Ve=pe.queryGeometry,He=Ve.isPointQuery()?Ve.screenBounds:Ve.screenGeometry,gt=function(Ft){const xt=de.mat4.multiply([],Oe,Ft.matrix);de.mat4.multiply(xt,Ce.expandedFarZProjMatrix,xt);for(let Et=0;Et<Ft.meshes.length;++Et){const _t=Ft.meshes[Et];if(Et===Ft.lightMeshIndex)continue;const lr=UN(He,Ce,xt,_t.aabb);lr!=null&&(Me=Math.min(lr,Me))}if(Ft.children)for(const Et of Ft.children)gt(Et)};if(gt(Re),Me===Number.MAX_VALUE)return;const ft=new sn(0,0);return eR(ke.tileID.canonical,ft,_e.node.anchor[0],_e.node.anchor[1]),{intersectionZ:Me,position:ft,feature:_e.feature}}(I,C,p,h);if(!M)return;const{z:P,x:R,y:F}=v.tileID.canonical,{feature:B,intersectionZ:Z,position:W}=M;let G={};B.id!==void 0&&(G=u.sourceCache.getFeatureState(E.sourceLayer,B.id));const X=new ym({},P,R,F,B.id);X.tile=this.tileID.canonical,X.state=G,X.properties=B.properties,X.geometry={type:"Point",coordinates:[W.lng,W.lat]};let ee=this.serializedLayersCache.get(_);ee||(ee=E.serialize(),ee.id=_,this.serializedLayersCache.set(_,ee)),X.source=ee.source,X.sourceLayer=ee["source-layer"],X.layer=fi({},ee);let ie=!1;for(const ge of A){this.updateFeatureProperties(X,ge);const{filter:fe}=ge;if(fe){if(B.properties=X.properties,fe.needGeometry){if(!fe.filter(new kn(this.tileID.overscaledZ),B,this.tileID.canonical))continue}else if(!fe.filter(new kn(this.tileID.overscaledZ),B))continue}ie=!0,ge.targetId&&this.addFeatureVariant(X,ge)}ie&&this.appendToResult(r,_,C,X,Z)}updateFeatureProperties(r,o,u){if(o.properties){const p={};for(const h in o.properties){const _=o.properties[h].evaluate({zoom:this.z},r._vectorTileFeature,r.state,r.tile,u);_!=null&&(p[h]=_)}r.properties=p}}addFeatureVariant(r,o,u){const p={target:o.target,namespace:o.namespace,uniqueFeatureID:o.uniqueFeatureID};o.properties&&(p.properties=r.properties),r.variants=r.variants||{},r.variants[o.targetId]=r.variants[o.targetId]||[],r.variants[o.targetId].push(p)}appendToResult(r,o,u,p,h){let _=r[o];_===void 0&&(_=r[o]=[]),_.push({featureIndex:u,feature:p,intersectionZ:h})}lookupSymbolFeatures(r,o,u,p,h){const _={};this.loadVTLayers();for(const w of r)this.loadMatchingFeature(_,{bucketIndex:o,sourceLayerIndex:u,featureIndex:w,layoutVertexArrayOffset:0},p,h);return _}loadFeature(r){const{featureIndex:o,sourceLayerIndex:u}=r;this.loadVTLayers();const p=this.sourceLayerCoder.decode(u),h=this.vtFeatures[p];if(h[o])return h[o];const _=this.vtLayers[p].feature(o);return h[o]=_,_}hasLayer(r){for(const o of this.bucketLayerIDs)for(const u of o)if(r===u)return!0;return!1}getId(r,o){let u=r.id;if(this.promoteId){const p=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[o];if(p!=null)if(Array.isArray(p)){if(!this.promoteIdExpression){const h=Uu(p);if(h.result!=="success"){const _=h.value.map(w=>`${w.key}: ${w.message}`).join(", ");return void Kn(`Failed to create expression for promoteId: ${_}`)}this.promoteIdExpression=h.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new hp),u=this.promoteIdExpression.evaluate({zoom:0},r)}else u=r.properties[p];typeof u=="boolean"&&(u=Number(u))}return u}}function qR(c,r,o,u,p){return co(c,(h,_)=>{const w=r instanceof Yu?r.get(_):null;return w&&w.evaluate?w.evaluate(o,u,p):w})}function R7(c,r){return r-c}zt(GR,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const HR=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class $T{static from(r){if(!(r instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[o,u]=new Uint8Array(r,0,2);if(o!==219)throw new Error("Data does not appear to be in a KDBush format.");const p=u>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);const h=HR[15&u];if(!h)throw new Error("Unrecognized array type.");const[_]=new Uint16Array(r,2,1),[w]=new Uint32Array(r,4,1);return new $T(w,_,h,r)}constructor(r,o=64,u=Float64Array,p){if(isNaN(r)||r<0)throw new Error(`Unpexpected numItems value: ${r}.`);this.numItems=+r,this.nodeSize=Math.min(Math.max(+o,2),65535),this.ArrayType=u,this.IndexArrayType=r<65536?Uint16Array:Uint32Array;const h=HR.indexOf(this.ArrayType),_=2*r*this.ArrayType.BYTES_PER_ELEMENT,w=r*this.IndexArrayType.BYTES_PER_ELEMENT,E=(8-w%8)%8;if(h<0)throw new Error(`Unexpected typed array class: ${u}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+w+E,2*r),this._pos=2*r,this._finished=!0):(this.data=new ArrayBuffer(8+_+w+E),this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+w+E,2*r),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+h]),new Uint16Array(this.data,2,1)[0]=o,new Uint32Array(this.data,4,1)[0]=r)}add(r,o){const u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=r,this.coords[this._pos++]=o,u}finish(){const r=this._pos>>1;if(r!==this.numItems)throw new Error(`Added ${r} items when expected ${this.numItems}.`);return GT(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(r,o,u,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:_,nodeSize:w}=this,E=[0,h.length-1,0],A=[];for(;E.length;){const v=E.pop()||0,C=E.pop()||0,I=E.pop()||0;if(C-I<=w){for(let F=I;F<=C;F++){const B=_[2*F],Z=_[2*F+1];B>=r&&B<=u&&Z>=o&&Z<=p&&A.push(h[F])}continue}const M=I+C>>1,P=_[2*M],R=_[2*M+1];P>=r&&P<=u&&R>=o&&R<=p&&A.push(h[M]),(v===0?r<=P:o<=R)&&(E.push(I),E.push(M-1),E.push(1-v)),(v===0?u>=P:p>=R)&&(E.push(M+1),E.push(C),E.push(1-v))}return A}within(r,o,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:h,nodeSize:_}=this,w=[0,p.length-1,0],E=[],A=u*u;for(;w.length;){const v=w.pop()||0,C=w.pop()||0,I=w.pop()||0;if(C-I<=_){for(let F=I;F<=C;F++)ZR(h[2*F],h[2*F+1],r,o)<=A&&E.push(p[F]);continue}const M=I+C>>1,P=h[2*M],R=h[2*M+1];ZR(P,R,r,o)<=A&&E.push(p[M]),(v===0?r-u<=P:o-u<=R)&&(w.push(I),w.push(M-1),w.push(1-v)),(v===0?r+u>=P:o+u>=R)&&(w.push(M+1),w.push(C),w.push(1-v))}return E}}function GT(c,r,o,u,p,h){if(p-u<=o)return;const _=u+p>>1;WR(c,r,_,u,p,h),GT(c,r,o,u,_-1,1-h),GT(c,r,o,_+1,p,1-h)}function WR(c,r,o,u,p,h){for(;p>u;){if(p-u>600){const A=p-u+1,v=o-u+1,C=Math.log(A),I=.5*Math.exp(2*C/3),M=.5*Math.sqrt(C*I*(A-I)/A)*(v-A/2<0?-1:1);WR(c,r,o,Math.max(u,Math.floor(o-v*I/A+M)),Math.min(p,Math.floor(o+(A-v)*I/A+M)),h)}const _=r[2*o+h];let w=u,E=p;for(Uy(c,r,u,o),r[2*p+h]>_&&Uy(c,r,u,p);w<E;){for(Uy(c,r,w,E),w++,E--;r[2*w+h]<_;)w++;for(;r[2*E+h]>_;)E--}r[2*u+h]===_?Uy(c,r,u,E):(E++,Uy(c,r,E,p)),E<=o&&(u=E+1),o<=E&&(p=E-1)}}function Uy(c,r,o,u){qT(c,o,u),qT(r,2*o,2*u),qT(r,2*o+1,2*u+1)}function qT(c,r,o){const u=c[r];c[r]=c[o],c[o]=u}function ZR(c,r,o,u){const p=c-o,h=r-u;return p*p+h*h}s.$=Ls,s.A=Ys,s.B=Na,s.C=Ju,s.D=hm,s.E=sa,s.F=2,s.G=Sy,s.H=tN,s.I=Us,s.J=class extends k1{},s.K=rl,s.L=Yr,s.M=D0,s.N=E_,s.O=Vu,s.P=bt,s.Q=E0,s.R=Ji,s.S=kp,s.T=wT,s.U=Bp,s.V=k1,s.W=P_,s.X=Uu,s.Y=Dh,s.Z=al,s._=Lu,s.a=function(c){return oe.API_CDN_URL_REGEX.test(c)},s.a$=z,s.a0=Do,s.a1=B_,s.a2=Pp,s.a3=Ap,s.a4=function(c){const r=c.value;let o=[];if(!r)return o;const u=rl(r);return u!=="string"?(o=o.concat([new k1(c.key,r,`string expected, "${u}" found`)]),o):(GN(r,!0)||(o=o.concat([new k1(c.key,r,`invalid url "${r}"`)])),o)},s.a5=We,s.a6=F_,s.a7=ii,s.a8=Tt,s.a9=class{constructor(c){this.specification=c}possiblyEvaluate(c,r){return Vn(c.expression.evaluate(r))}interpolate(c,r,o){return{x:ur(c.x,r.x,o),y:ur(c.y,r.y,o),z:ur(c.z,r.z,o),azimuthal:ur(c.azimuthal,r.azimuthal,o),polar:ur(c.polar,r.polar,o)}}},s.aA=function(c,r){const o={};for(let u=0;u<r.length;u++){const p=r[u];p in c&&(o[p]=c[p])}return o},s.aB=sc,s.aC=xs,s.aD=class{constructor(c){this.entries={},this.scheduler=c}request(c,r,o,u){const p=this.entries[c]=this.entries[c]||{callbacks:[]};if(p.result){const[h,_]=p.result;return this.scheduler?this.scheduler.add(()=>{u(h,_)},r):u(h,_),()=>{}}return p.callbacks.push(u),p.cancel||(p.cancel=o((h,_)=>{p.result=[h,_];for(const w of p.callbacks)this.scheduler?this.scheduler.add(()=>{w(h,_)},r):w(h,_);setTimeout(()=>delete this.entries[c],3e3)})),()=>{p.result||(p.callbacks=p.callbacks.filter(h=>h!==u),p.callbacks.length||(p.cancel(),delete this.entries[c]))}}},s.aE=function(c,r,o){const u=JSON.stringify(c.request);return c.data&&(this.deduped.entries[u]={result:[null,c.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:c.isSymbolTile,zoom:c.tileZoom},p=>{const h=ka(c.request,(_,w,E,A)=>{_?p(_):w&&p(null,{vectorTile:o?void 0:new ad.VectorTile(new h1(w)),rawData:w,cacheControl:E,expires:A})});return()=>{h.cancel(),p()}},r)},s.aF=function(c){mn++,mn>kr&&(c.getActor().send("enforceCacheSizeLimit",Cr),mn=0)},s.aG=function(c){return c<=1?1:Math.pow(2,Math.floor(Math.log(c)/Math.LN2))},s.aH=mt,s.aI=kN,s.aJ=ON,s.aK=IN,s.aL=function(c,r){const o=document.createElement("video");o.muted=!0,o.onloadstart=function(){r(null,o)};for(let u=0;u<c.length;u++){const p=document.createElement("source");Zg(c[u])||(o.crossOrigin="Anonymous"),p.src=c[u],o.appendChild(p)}return{cancel:()=>{}}},s.aM=C1,s.aN=function(c){return fetch(c).then(r=>r.arrayBuffer()).then(r=>BR(r,0,c))},s.aO=UR,s.aP=class{constructor(c,r,o,u){this.id=c,this.position=r!=null?new sn(r[0],r[1]):new sn(0,0),this.orientation=o??[0,0,0],this.nodes=u,this.uploaded=!1,this.aabb=new Xt([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(c,r){if(de.mat4.multiply(c.matrix,r,c.matrix),c.meshes)for(const o of c.meshes){const u=Xt.applyTransformFast(o.aabb,c.matrix);this.aabb.encapsulate(u)}if(c.children)for(const o of c.children)this._applyTransformations(o,c.matrix)}computeBoundsAndApplyParent(){const c=de.mat4.identity([]);for(const r of this.nodes)this._applyTransformations(r,c)}computeModelMatrix(c,r,o,u,p,h,_=!1){YN(this.matrix,this,c.transform,this.position,r,o,u,p,h,_)}upload(c){if(!this.uploaded){for(const r of this.nodes)MT(r,c);for(const r of this.nodes)N1(r);this.uploaded=!0}}destroy(){for(const c of this.nodes)AT(c)}},s.aQ=Pa,s.aR=Cy,s.aS=Js,s.aT=cs,s.aU=dl,s.aV=ls,s.aW=Es,s.aX=Yh,s.aY=T1,s.aZ=function(){zo.isLoading()||zo.isLoaded()||zp()!=="deferred"||j0()},s.a_=V_,s.aa=kn,s.ab=$u,s.ac=n,s.ad=de,s.ae=Or,s.af=Yu,s.ag=Gs,s.ah=ur,s.ai=Ct,s.aj=a0,s.ak=Be,s.al=_n,s.am=class{constructor(c){this.specification=c}possiblyEvaluate(c,r){return function([o,u]){const p=Vn([1,o,u]);return{x:p.x,y:p.y,z:p.z}}(c.expression.evaluate(r))}interpolate(c,r,o){return{x:ur(c.x,r.x,o),y:ur(c.y,r.y,o),z:ur(c.z,r.z,o)}}},s.an=function(c,r,o=0,u=!0){const p=new bt(o,o),h=c.sub(p),_=r.add(p),w=[h,new bt(_.x,h.y),_,new bt(h.x,_.y)];return u&&w.push(h.clone()),w},s.ao=function(c,r){const o=[];for(let u=0;u<c.length;u++){const p=Xn(u-1,-1,c.length-1),h=Xn(u+1,-1,c.length-1),_=c[u],w=c[h],E=c[p].sub(_).unit(),A=w.sub(_).unit(),v=A.angleWithSep(E.x,E.y),C=E.add(A).unit().mult(-1*r/Math.sin(v/2));o.push(_.add(C))}return o},s.ap=gN,s.aq=Te,s.ar=function(c,r,o=0){return de.vec3.fromValues(((r.x-o)*c.scale-c.x)*Ct,(r.y*c.scale-c.y)*Ct,ly(r.z,r.y))},s.as=pr,s.at=Pk,s.au=function(c){let r=1/0,o=1/0,u=-1/0,p=-1/0;for(const h of c)r=Math.min(r,h.x),o=Math.min(o,h.y),u=Math.max(u,h.x),p=Math.max(p,h.y);return{min:new bt(r,o),max:new bt(u,p)}},s.av=La,s.aw=we,s.ax=m,s.ay=Bt,s.az=Os,s.b=function(c){return oe.API_FONTS_REGEX.test(c)},s.b$=P1,s.b0=ym,s.b1=gs,s.b2=tT,s.b3=ZS,s.b4=L,s.b5=ul,s.b6=Zp,s.b7=cr,s.b8=Hn,s.b9=hy,s.bA=ak,s.bB=hT,s.bC=cN,s.bD=cT,s.bE=$T,s.bF=Xn,s.bG=ql,s.bH=vs,s.bI=function(c,r,o){c[4*r+0]=o[0],c[4*r+1]=o[1],c[4*r+2]=o[2],c[4*r+3]=o[3]},s.bJ=nf,s.bK=Bo,s.bL=td,s.bM=Ti,s.bN=tf,s.bO=sn,s.bP=bN,s.bQ=Je,s.bR=Ar,s.bS=FN,s.bT=ht,s.bU=Is,s.bV=function(c,r,o,u,p,h,_,w,E){if(E.name==="globe")return Is(c,r,new ht(o,u,p),!1);const A=Cy({z:o,x:u,y:p},E);return new Xt([(h+A.x/A.scale)*r,r*(A.y/A.scale),_],[(h+A.x2/A.scale)*r,r*(A.y2/A.scale),w])},s.bW=function(c,r,o){let u=0;for(let p=0;p<2;++p)c[p]>0&&(u+=(c[p]-0)*(c[p]-0)),r[p]<0&&(u+=(0-r[p])*(0-r[p]));return u},s.bX=wi,s.bY=J0,s.bZ=function(c){const r=de.mat4.identity(new Float64Array(16));de.mat4.multiply(r,c.pixelMatrix,c.globeMatrix);const o=[0,go,0],u=[0,_o,0];return de.vec3.transformMat4(o,o,r),de.vec3.transformMat4(u,u,r),[o[0]>0&&o[0]<=c.width&&o[1]>0&&o[1]<=c.height&&!eo(c,new sn(c.center.lat,90)),u[0]>0&&u[0]<=c.width&&u[1]>0&&u[1]<=c.height&&!eo(c,new sn(c.center.lat,-90))]},s.b_=function(c,r){const{scale:o}=c.tileTransform,u=o*Ct/(c.tileSize*Math.pow(2,r.zoom-c.tileID.overscaledZ+c.tileID.canonical.z));return de.mat2.scale(new Float32Array(4),r.inverseAdjustmentMatrix,[u,u])},s.ba=xT,s.bb=function(c,r){const o=Gs(r.zoom);if(o===0)return zi(c);const u=Xr(c),p=Zn(u),h=La(u.getWest())*r.worldSize,_=La(u.getEast())*r.worldSize,w=xs(u.getNorth())*r.worldSize,E=xs(u.getSouth())*r.worldSize,A=[h,w,0],v=[_,w,0],C=[h,E,0],I=[_,E,0],M=de.mat4.invert([],r.globeMatrix);return de.vec3.transformMat4(A,A,M),de.vec3.transformMat4(v,v,M),de.vec3.transformMat4(C,C,M),de.vec3.transformMat4(I,I,M),p[0]=Ui(p[0],C,o),p[1]=Ui(p[1],I,o),p[2]=Ui(p[2],v,o),p[3]=Ui(p[3],A,o),Xt.fromPoints(p)},s.bc=Un,s.bd=an,s.be=Ui,s.bf=Qu,s.bg=Tr,s.bh=U1,s.bi=h1,s.bj=ka,s.bk=function(c,r){const o=[];for(const u in c)u in r||o.push(u);return o},s.bl=Bn,s.bm=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.bn=Vi,s.bo=function(c,r){const{x:o,y:u}=c.point,p=Vo(o,u,c.worldSize/c._pixelsPerMercatorPixel,0,0);return de.mat4.multiply(p,p,Fi(zi(r)))},s.bp=im,s.bq=xo,s.br=d1,s.bs=function(c,r,o,u,p){const h=5*r+2;c.float32[h+0]=o,c.float32[h+1]=u,c.float32[h+2]=p},s.bt=S1,s.bu=eN,s.bv=te,s.bw=ws,s.bx=tk,s.by=$N,s.bz=ok,s.c=ve,s.c$=Rk,s.c0=zN,s.c1=function(c){const r=zN(c,!0);return de.mat2.invert([],[r[0],r[1],r[4],r[5]])},s.c2=Gr,s.c3=function(c){const{x:r,y:o}=c.point,{lng:u,lat:p}=c._center;return Vo(r,o,c.worldSize,u,p)},s.c4=ut,s.c5=It,s.c6=rd,s.c7=function(c){const r=Math.round((c+45+360)%360/90)%4;return St[r]},s.c8=45,s.c9=l0,s.cA=Y0,s.cB=class extends Da{constructor(c){super(c),this.current=iy}set(c,r,o){if(this.fetchUniformLocation(c,r)){for(let u=0;u<9;u++)if(o[u]!==this.current[u]){this.current=o,this.gl.uniformMatrix3fv(this.location,!1,o);break}}}},s.cC=dr,s.cD=function(c,r,o){const u=Gs(o.zoom),p=c.style.map._antialias,h=c.terrain&&c.terrain.exaggeration()>0;return u===0&&!p&&!h},s.cE=function(c){const r=c.pixelsPerMeter,o=r/vs(1,c.center.lat),u=de.mat4.identity(new Float64Array(16));return de.mat4.translate(u,u,[c.point.x,c.point.y,0]),de.mat4.scale(u,u,[o,o,r]),Float32Array.from(u)},s.cF=Xr,s.cG=function(c){const r=wi-5;c=Bt(c,-r,r)/r*90;const o=Math.pow(Math.abs(Math.sin(Be(c))),3);return Math.round(o*(em.length-1))},s.cH=function(c,r,o,u){const p=r.getNorth(),h=r.getSouth(),_=r.getWest(),w=r.getEast(),E=1<<c.z,A=w-_,v=p-h,C=A/nd,I=-v/em[o],M=[0,C,0,I,0,0,p,_,0];if(c.z>0){const P=180/u;de.mat3.multiply(M,M,[P/A+1,0,0,0,P/v+1,0,-.5*P/C,.5*P/I,1])}return M[2]=E,M[5]=c.x,M[8]=c.y,M},s.cI=zi,s.cJ=function(c,r,o){const u=de.mat4.identity(new Float64Array(16)),p=(r/(1<<c)-.5)*Math.PI*2;return de.mat4.rotateY(u,o.globeMatrix,p),Float32Array.from(u)},s.cK=class{isDataAvailableAtPoint(c){const r=this._source();if(this.isUsingMockSource()||!r||c.y<0||c.y>1)return!1;const o=r.getSource().maxzoom,u=1<<o,p=Math.floor(c.x),h=Math.floor((c.x-p)*u),_=Math.floor(c.y*u),w=this.findDEMTileFor(new mt(o,p,o,h,_));return!(!w||!w.dem)}getAtPointOrZero(c,r=0){return this.getAtPoint(c,r)||0}getAtPoint(c,r,o=!0){if(this.isUsingMockSource())return null;r==null&&(r=null);const u=this._source();if(!u||c.y<0||c.y>1)return r;const p=u.getSource().maxzoom,h=1<<p,_=Math.floor(c.x),w=c.x-_,E=new mt(p,_,p,Math.floor(w*h),Math.floor(c.y*h)),A=this.findDEMTileFor(E);if(!A||!A.dem)return r;const v=A.dem,C=1<<A.tileID.canonical.z,I=(w*C-A.tileID.canonical.x)*v.dim,M=(c.y*C-A.tileID.canonical.y)*v.dim,P=Math.floor(I),R=Math.floor(M);return(o?this.exaggeration():1)*ur(ur(v.get(P,R),v.get(P,R+1),M-R),ur(v.get(P+1,R),v.get(P+1,R+1),M-R),I-P)}getAtTileOffset(c,r,o){const u=1<<c.canonical.z;return this.getAtPointOrZero(new n(c.wrap+(c.canonical.x+r/Ct)/u,(c.canonical.y+o/Ct)/u))}getAtTileOffsetFunc(c,r,o,u){return p=>{const h=this.getAtTileOffset(c,p.x,p.y),_=u.upVector(c.canonical,p.x,p.y),w=u.upVectorScale(c.canonical,r,o).metersToTile;return de.vec3.scale(_,_,h*w),_}}getForTilePoints(c,r,o,u){if(this.isUsingMockSource())return!1;const p=dm.create(this,c,u);return!!p&&(r.forEach(h=>{h[2]=this.exaggeration()*p.getElevationAt(h[0],h[1],o)}),!0)}getMinMaxForTile(c){if(this.isUsingMockSource())return null;const r=this.findDEMTileFor(c);if(!r||!r.dem)return null;const o=r.dem.tree,u=r.tileID,p=1<<c.canonical.z-u.canonical.z;let h=c.canonical.x/p-u.canonical.x,_=c.canonical.y/p-u.canonical.y,w=0;for(let E=0;E<c.canonical.z-u.canonical.z&&!o.leaves[w];E++){h*=2,_*=2;const A=2*Math.floor(_)+Math.floor(h);w=o.childOffsets[w]+A,h%=1,_%=1}return{min:this.exaggeration()*o.minimums[w],max:this.exaggeration()*o.maximums[w]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(c,r,o){throw new Error("Pure virtual method called.")}pointCoordinate(c){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(c){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const c=this.visibleDemTiles;if(c.length===0)return null;let r=!1,o=Number.MAX_VALUE,u=Number.MIN_VALUE;for(const p of c){const h=this.getMinMaxForTile(p.tileID);h&&(o=Math.min(o,h.min),u=Math.max(u,h.max),r=!0)}return r?{min:o,max:u}:null}},s.cL=kI,s.cM=Hr,s.cN=function(c,r){return[Math.pow(c[0],2.2)*r,Math.pow(c[1],2.2)*r,Math.pow(c[2],2.2)*r]},s.cO=Qs,s.cP=tt,s.cQ=Sh,s.cR=256,s.cS=function(c,r){const o=[0,0,0],u=Un(zi(r.canonical));return de.vec3.transformMat4(o,o,u),de.vec3.transformMat4(o,o,c),o},s.cT=c=>({u_camera_to_center_distance:new Ti(c),u_extrude_scale:new sy(c),u_device_pixel_ratio:new Ti(c),u_matrix:new nf(c),u_inv_rot_matrix:new nf(c),u_merc_center:new Bo(c),u_tile_id:new td(c),u_zoom_transition:new Ti(c),u_up_dir:new td(c),u_emissive_strength:new Ti(c)}),s.cU=c=>({u_matrix:new nf(c),u_pixels_to_tile_units:new sy(c),u_device_pixel_ratio:new Ti(c),u_width_scale:new Ti(c),u_floor_width_scale:new Ti(c),u_units_to_pixels:new Bo(c),u_dash_image:new tf(c),u_gradient_image:new tf(c),u_image_height:new Ti(c),u_texsize:new Bo(c),u_tile_units_to_pixels:new Ti(c),u_alpha_discard_threshold:new Ti(c),u_trim_offset:new Bo(c),u_trim_fade_range:new Bo(c),u_trim_color:new rf(c),u_emissive_strength:new Ti(c),u_zbias_factor:new Ti(c),u_tile_to_meter:new Ti(c)}),s.cV=c=>({u_matrix:new nf(c),u_texsize:new Bo(c),u_pixels_to_tile_units:new sy(c),u_device_pixel_ratio:new Ti(c),u_width_scale:new Ti(c),u_floor_width_scale:new Ti(c),u_image:new tf(c),u_units_to_pixels:new Bo(c),u_tile_units_to_pixels:new Ti(c),u_alpha_discard_threshold:new Ti(c),u_trim_offset:new Bo(c),u_trim_fade_range:new Bo(c),u_trim_color:new rf(c),u_emissive_strength:new Ti(c),u_zbias_factor:new Ti(c),u_tile_to_meter:new Ti(c)}),s.cW=X_,s.cX=L8,s.cY=O8,s.cZ=sd,s.c_=(c,r,o,u,p,h)=>{const _=c.transform,w=_.projection.name==="globe";let E;if(h.paint.get("circle-pitch-alignment")==="map")if(w){const v=Qs(_.zoom,r.canonical)*_._pixelsPerMercatorPixel;E=Float32Array.from([v,0,0,v])}else E=_.calculatePixelsToTileUnitsMatrix(o);else E=new Float32Array([_.pixelsToGLUnits[0],0,0,_.pixelsToGLUnits[1]]);const A={u_camera_to_center_distance:c.transform.getCameraToCenterDistance(_.projection),u_matrix:c.translatePosMatrix(r.projMatrix,o,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_device_pixel_ratio:et.devicePixelRatio,u_extrude_scale:E,u_inv_rot_matrix:cy,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:h.paint.get("circle-emissive-strength")};if(w){A.u_inv_rot_matrix=u,A.u_merc_center=p,A.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],A.u_zoom_transition=Gs(_.zoom);const v=p[0]*Ct,C=p[1]*Ct;A.u_up_dir=_.projection.upVector(new ht(0,0,0),v,C)}return A},s.ca=tm,s.cb=rf,s.cc=function(c,r,o){const u=Math.sqrt(c*c+r*r+o*o),p=u>0?Math.acos(o/u)*os:0;let h=c!==0||r!==0?Math.atan2(-r,-c)*os+90:0;return h<0&&(h+=360),[u,h,p]},s.cd=g,s.ce=Xt,s.cf=Vn,s.cg=function(c){return[Math.pow(c[0],1/2.2),Math.pow(c[1],1/2.2),Math.pow(c[2],1/2.2)]},s.ch=function(c,r){return c.readFields(I$,{icons:[]},r)},s.ci=function(c){return c({pluginStatus:$s,pluginURL:Ql}),qu.on("pluginStateChange",c),c},s.cj=j1,s.ck=am,s.cl=uT,s.cm=bu,s.cn=$h,s.co=Lt,s.cp=ho,s.cq=Xi,s.cr=function(c){const r=c.indexOf(Up);return r>=0?c.slice(0,r):c},s.cs=function(c){return c.indexOf(Up)>=0},s.ct=function(c){const r=c.indexOf(Up);return r>=0?c.slice(r+1):""},s.cu=function(c){const r=[],o=c.id;return o===void 0&&r.push({message:`layers.${o}: missing required property "id"`}),c.render===void 0&&r.push({message:`layers.${o}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&r.push({message:`layers.${o}: property "renderingMode" must be either "2d" or "3d"`}),r},s.cv=function(c,r,o,u){return c.type==="custom"?new g$(c,r):new M$[c.type](c,r,o,u)},s.cw=na,s.cx=class extends ym{constructor(c,r){super(c._vectorTileFeature,c._z,c._x,c._y,c.id),c.state&&(this.state=Object.assign({},c.state)),this.target=r.target,this.namespace=r.namespace,r.properties&&(this.properties=r.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=c.source,this.sourceLayer=c.sourceLayer,this.layer=c.layer)}toJSON(){const c=super.toJSON();return c.target=this.target,c.namespace=this.namespace,c}},s.cy=qu,s.cz=jo,s.d=function(c){return oe.API_TILEJSON_REGEX.test(c)},s.d$=$R,s.d0=Ps,s.d1=(c,r,o,u,p,h,_,w)=>{const E=c.transform,A=E.pitch<15?Ik(.07,.7,Bt((14-E.zoom)/5,0,1)):.07,v=o.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:Nk(c,r,o,u),u_texsize:r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:E.calculatePixelsToTileUnitsMatrix(r),u_device_pixel_ratio:p,u_width_scale:h,u_floor_width_scale:_,u_image:0,u_tile_units_to_pixels:kk(r,E),u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:w,u_trim_fade_range:o.paint.get("line-trim-fade-range"),u_trim_color:o.paint.get("line-trim-color").toRenderColor(v?null:o.lut).toArray01(),u_emissive_strength:o.paint.get("line-emissive-strength"),u_zbias_factor:A,u_tile_to_meter:g(r.tileID.canonical,0)}},s.d2=(c,r,o,u,p,h,_,w,E)=>{const A=c.transform,v=A.calculatePixelsToTileUnitsMatrix(r),C=o.paint.get("line-trim-color-use-theme").constantOr("default")==="none",I=A.pitch<15?Ik(.07,.7,Bt((14-A.zoom)/5,0,1)):.07;return{u_matrix:Nk(c,r,o,u),u_pixels_to_tile_units:v,u_device_pixel_ratio:h,u_width_scale:_,u_floor_width_scale:w,u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:p,u_texsize:jk(o)&&r.lineAtlasTexture?r.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:kk(r,c.transform),u_alpha_discard_threshold:0,u_trim_offset:E,u_trim_fade_range:o.paint.get("line-trim-fade-range"),u_trim_color:o.paint.get("line-trim-color").toRenderColor(C?null:o.lut).toArray01(),u_emissive_strength:o.paint.get("line-emissive-strength"),u_zbias_factor:I,u_tile_to_meter:g(r.tileID.canonical,0)}},s.d3=ra,s.d4=dy,s.d5=ly,s.d6=vk,s.d7=kt,s.d8=u1,s.d9=ld,s.dA=a1,s.dB=or,s.dC=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},s.dD=tr,s.dE=OS,s.dF=Gc,s.dG=function([c,r,o]){const u=Math.hypot(c,r,o),p=Math.atan2(c,o),h=.5*Math.PI-Math.acos(-r/u);return new sn(ut(p),ut(h))},s.dH=TT,s.dI=function(c){const r=c.navigator?c.navigator.userAgent:null;return!!function(o){if(Ia==null){const u=o.navigator?o.navigator.userAgent:null;Ia=!!o.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return Ia}(c)&&r&&(r.match("Version/15.4")||r.match("Version/15.5")||r.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},s.dJ=function(c,r){Cr=c,kr=r},s.dK=eo,s.dL=Uo,s.dM=function(c){const r=[0,0,0],o=de.mat4.identity(new Float64Array(16));return de.mat4.multiply(o,c.pixelMatrix,c.globeMatrix),de.vec3.transformMat4(r,r,o),new bt(r[0],r[1])},s.dN=function(c,r,o=!1){if($s===D_||$s===ja||$s===L_)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ql=et.resolveURL(c),$s=D_,O_=r,Op(),o||j0()},s.dO=zp,s.dP=function(){j1().acquire(IT)},s.dQ=function(){const c=jy;c&&(c.isPreloaded()&&c.numActive()===1?(c.release(IT),jy=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},s.dR=hf,s.dS=function(c){const r=ri();if(!r)return;const o=r.delete(Vt);c&&o.catch(c).then(()=>c())},s.dT=Ry,s.dU=RR,s.dV=function(c){FT=et.resolveURL(c),_m||(_m=new hm(j1(),new sa)),_m.broadcast("setDracoUrl",FT)},s.dW=jR,s.dX=function(c){gm=et.resolveURL(c),_m||(_m=new hm(j1(),new sa)),_m.broadcast("setMeshoptUrl",gm)},s.dY=zt,s.dZ=od,s.d_=_l,s.da=450,s.db=7,s.dc=m$,s.dd=nn,s.de=Kp,s.df=256,s.dg=Fi,s.dh=ca,s.di=Xs,s.dj=Wp,s.dk=function(c,r,o,u,p){return Bt((c-r)/(o-r)*(p-u)+u,u,p)},s.dl=b_,s.dm=oc,s.dn=class{constructor(c,r,o,u){this.context=c,this.format=u,this.size=o,this.texture=c.gl.createTexture();const[p,h,_]=this.size,{gl:w}=c;w.bindTexture(w.TEXTURE_3D,this.texture),c.pixelStoreUnpackFlipY.set(!1),c.pixelStoreUnpack.set(1),c.pixelStoreUnpackPremultiplyAlpha.set(!1),w.texImage3D(w.TEXTURE_3D,0,this.format,p,h,_,0,vT(this.format),bT(this.format),r.data)}bind(c,r){const{context:o}=this,{gl:u}=o;u.bindTexture(u.TEXTURE_3D,this.texture),c!==this.minFilter&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MAG_FILTER,c),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MIN_FILTER,c),this.minFilter=c),r!==this.wrapS&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_S,r),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_T,r),this.wrapS=r)}destroy(){const{gl:c}=this.context;c.deleteTexture(this.texture),this.texture=null}},s.dp=ET,s.dq=[1,1,1],s.dr=dm,s.ds=um,s.dt=rc,s.du=ed,s.dv=qc,s.dw=Q_,s.dx=J_,s.dy=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new bt(1/0,1/0),max:new bt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(c,r=!1){const o=nk(new bt(0,0),new bt(Ct,Ct),c),u=[];if(r&&!XS(o,this._globalClipBounds))return u;for(const p of this._activeRegions){if(p.hiddenByOverlap||!XS(o,p))continue;const h=c8(p.min,p.max,c);u.push({min:h.min,max:h.max,sourceId:this._sourceIds[p.priority],footprint:p.footprint,footprintTileId:p.tileId,order:p.order,clipMask:p.clipMask,clipScope:p.clipScope})}return u}setSources(c){this._setSources(c.map(r=>({getSourceId:()=>r.cache.id,getFootprints:()=>{const o=[];for(const u of r.cache.getVisibleCoordinates()){const p=r.cache.getTile(u).buckets[r.layer];p&&p.updateFootprints(u.toUnwrapped(),o)}return o},getOrder:()=>r.order,getClipMask:()=>r.clipMask,getClipScope:()=>r.clipScope})))}_addSource(c){const r=c.getFootprints();if(r.length===0)return;const o=c.getOrder(),u=c.getClipMask(),p=c.getClipScope();for(const h of r){if(!h.footprint)continue;const _=nk(h.footprint.min,h.footprint.max,h.id);this._activeRegions.push({min:_.min,max:_.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:h.id,footprint:h.footprint,order:o,clipMask:u,clipScope:p})}this._sourceIds.push(c.getSourceId())}_computeReplacement(){this._activeRegions.sort((r,o)=>r.priority-o.priority||l1(r.min,o.min)||l1(r.max,o.max)||r.order-o.order||r.clipMask-o.clipMask||function(u,p){const h=(_,w)=>_+w;return u.length-p.length||u.reduce(h,"").localeCompare(p.reduce(h,""))}(r.clipScope,o.clipScope));let c=this._activeRegions.length!==this._prevRegions.length;if(!c){let r=0;for(;!c&&r!==this._activeRegions.length;){const o=this._activeRegions[r],u=this._prevRegions[r];c=o.priority!==u.priority||!rk(o,u)||o.order!==u.order||o.clipMask!==u.clipMask||!Vi(o.clipScope,u.clipScope),++r}}if(c){++this._updateTime;for(const o of this._activeRegions)o.order!==a1&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,o.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,o.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,o.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,o.max.y));const r=o=>{const u=this._activeRegions;if(o>=u.length)return o;const p=u[o].priority;for(;o<u.length&&u[o].priority===p;)++o;return o};if(this._sourceIds.length>1){let o=0,u=r(o);for(;o!==u;){let p=o;const h=o;for(;p!==u;){const _=this._activeRegions[p];_.hiddenByOverlap=!1;for(let w=0;w<h;w++){const E=this._activeRegions[w];if(!E.hiddenByOverlap&&_.order===a1&&XS(_,E)&&(_.hiddenByOverlap=sk(_.footprint,_.tileId,E.footprint,E.tileId),_.hiddenByOverlap))break}++p}o=u,u=r(o)}}}}_setSources(c){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let r=c.length-1;r>=0;r--)this._addSource(c[r]);this._computeReplacement()}},s.dz=class{constructor(c){this._createGrid(c),this._createPoles(c)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const c of this._poleSegments)c.destroy();for(const c of this._gridSegments)c.withSkirts.destroy(),c.withoutSkirts.destroy()}_fillGridMeshWithLods(c,r){const o=new ul,u=new ls,p=[],h=c+1+2,_=r[0]+1,w=r[0]+1+(1+r.length),E=(A,v,C)=>{let I=A===h-1?A-2:A===0?A:A-1;return I+=C?24575:0,[I,v]};for(let A=0;A<h;++A)o.emplaceBack(...E(A,0,!0));for(let A=0;A<_;++A)for(let v=0;v<h;++v)o.emplaceBack(...E(v,A,(v===0||v===h-1)&&!0));for(let A=0;A<r.length;++A){const v=r[A];for(let C=0;C<h;++C)o.emplaceBack(...E(C,v,!0))}for(let A=0;A<r.length;++A){const v=u.length,C=r[A]+1+2,I=new ls;for(let R=0;R<C-1;R++){const F=R===C-2,B=F?h*(w-r.length+A-R):h;for(let Z=0;Z<h-1;Z++){const W=R*h+Z;R===0||F||Z===0||Z===h-2?(I.emplaceBack(W+1,W,W+B),I.emplaceBack(W+B,W+B+1,W+1)):(u.emplaceBack(W+1,W,W+B),u.emplaceBack(W+B,W+B+1,W+1))}}const M=Hn.simpleSegment(0,v,o.length,u.length-v);for(let R=0;R<I.uint16.length;R+=3)u.emplaceBack(I.uint16[R],I.uint16[R+1],I.uint16[R+2]);const P=Hn.simpleSegment(0,v,o.length,u.length-v);p.push({withoutSkirts:M,withSkirts:P})}return{vertices:o,indices:u,segments:p}}_createGrid(c){const r=this._fillGridMeshWithLods(nd,em);this._gridSegments=r.segments,this._gridBuffer=c.createVertexBuffer(r.vertices,cr.members),this._gridIndexBuffer=c.createIndexBuffer(r.indices,!0)}_createPoles(c){const r=new ls;for(let _=0;_<=nd;_++)r.emplaceBack(0,_+1,_+2);this._poleIndexBuffer=c.createIndexBuffer(r,!0);const o=new Xs,u=new Xs,p=new Xs,h=new Xs;this._poleSegments=[];for(let _=0,w=0;_<rd;_++){const E=360/(1<<_);o.emplaceBack(0,-Os,0,.5,0),u.emplaceBack(0,-Os,0,.5,1),p.emplaceBack(0,-Os,0,.5,.5),h.emplaceBack(0,-Os,0,.5,.5);for(let A=0;A<=nd;A++){let v=A/nd,C=0;const I=ur(0,E,v),[M,P,R]=id(za,pl,I,Os);o.emplaceBack(M,P,R,v,C),u.emplaceBack(M,P,R,v,1-C);const F=Be(I);v=.5+.5*Math.sin(F),C=.5+.5*Math.cos(F),p.emplaceBack(M,P,R,v,C),h.emplaceBack(M,P,R,v,1-C)}this._poleSegments.push(Hn.simpleSegment(w,0,66,64)),w+=66}this._poleNorthVertexBuffer=c.createVertexBuffer(o,Yt,!1),this._poleSouthVertexBuffer=c.createVertexBuffer(u,Yt,!1),this._texturedPoleNorthVertexBuffer=c.createVertexBuffer(p,Yt,!1),this._texturedPoleSouthVertexBuffer=c.createVertexBuffer(h,Yt,!1)}getGridBuffers(c,r){return[this._gridBuffer,this._gridIndexBuffer,r?this._gridSegments[c].withSkirts:this._gridSegments[c].withoutSkirts]}getPoleBuffers(c,r){return[r?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,r?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[c]]}},s.e=oe,s.e0=GR,s.e1=Ck,s.e2=af,s.e3="hd_road_elevation",s.e4=class{static parseFrom(c,r){const o=Hc.parse(c);if(!o)return[];let{vertices:u,features:p}=o;const h=1/g(r);p.sort((A,v)=>A.id-v.id),u.sort((A,v)=>A.id-v.id||A.idx-v.idx),u=u.filter((A,v,C)=>v===C.findIndex(I=>I.id===A.id&&I.idx===A.idx));const _=new Array;let w=0;const E=u.length;for(const A of p){if(A.constantHeight){_.push(new HS(A.id,A.bounds,A.constantHeight));continue}for(;w!==E&&u[w].id<A.id;)w++;if(w===E||u[w].id!==A.id)continue;const v=new Array,C=new Array,I=w;for(;w!==E&&u[w].id===A.id;){const M=u[w];if(v.push({position:M.position,height:M.height,extent:M.extent}),w!==I&&u[w-1].idx===M.idx-1){const P=w-I;C.push({a:P-1,b:P})}w++}_.push(new HS(A.id,A.bounds,void 0,v,C,h))}return _}},s.e5=co,s.e6=lf,s.e7=rN,s.e8=om,s.e9=function(c,r,o,u,p,h,_,w=1,E){c.createArrays(),c.tilePixelRatio=Ct/(512*c.overscaling),c.compareText={},c.iconsNeedLinear=!1;const A=c.layers[0].layout,v=c.layers[0]._unevaluatedLayout._values,C={};C.scaleFactor=w,C.textSizeScaleRange=A.get("text-size-scale-range"),C.iconSizeScaleRange=A.get("icon-size-scale-range");const[I,M]=C.textSizeScaleRange,[P,R]=C.iconSizeScaleRange;C.textScaleFactor=Bt(C.scaleFactor,I,M),C.iconScaleFactor=Bt(C.scaleFactor,P,R);const F=v["text-size"],B=v["icon-size"];if(c.textSizeData.kind==="composite"){const{minZoom:ie,maxZoom:ge}=c.textSizeData;C.compositeTextSizes=[F.possiblyEvaluate(new kn(ie),h),F.possiblyEvaluate(new kn(ge),h)]}if(c.iconSizeData.kind==="composite"){const{minZoom:ie,maxZoom:ge}=c.iconSizeData;C.compositeIconSizes=[B.possiblyEvaluate(new kn(ie),h),B.possiblyEvaluate(new kn(ge),h)]}C.layoutTextSize=F.possiblyEvaluate(new kn(_+1),h),C.layoutIconSize=B.possiblyEvaluate(new kn(_+1),h),C.textMaxSize=F.possiblyEvaluate(new kn(18),h);const Z=A.get("symbol-placement"),W=A.get("text-rotation-alignment")==="map"&&Z!=="point",G=A.get("text-size");let X=!1;const ee=[];for(const ie of c.features){const ge=A.get("text-font").evaluate(ie,{},h).join(","),fe=G.evaluate(ie,{},h)*C.textScaleFactor,pe=C.layoutTextSize.evaluate(ie,{},h)*C.textScaleFactor,Ce=C.layoutIconSize.evaluate(ie,{},h)*C.iconScaleFactor,_e={horizontal:{},vertical:void 0},Me=ie.text;let Re,ke=[0,0];if(Me){const _t=Me.toString(),lr=A.get("text-letter-spacing").evaluate(ie,{},h)*ws,Dt=A.get("text-line-height").evaluate(ie,{},h)*ws,Zt=TS(_t)?lr:0,gr=A.get("text-anchor").evaluate(ie,{},h),jr=A.get("text-variable-anchor");if(!jr){const en=A.get("text-radial-offset").evaluate(ie,{},h);ke=en?cN(gr,[en*ws,dT]):A.get("text-offset").evaluate(ie,{},h).map(Nn=>Nn*ws)}let xr=W?"center":A.get("text-justify").evaluate(ie,{},h);const Fr=Z==="point",Rr=Fr?A.get("text-max-width").evaluate(ie,{},h)*ws:1/0,Ur=en=>{c.allowVerticalPlacement&&N_(_t)&&(_e.vertical=lT(Me,r,o,p,ge,Rr,Dt,gr,en,Zt,ke,xo.vertical,!0,pe,fe,E))};if(!W&&jr){const en=xr==="auto"?jr.map(_r=>hT(_r)):[xr];let Nn=!1;for(let _r=0;_r<en.length;_r++){const Wr=en[_r];if(!_e.horizontal[Wr])if(Nn)_e.horizontal[Wr]=_e.horizontal[0];else{const $n=lT(Me,r,o,p,ge,Rr,Dt,"center",Wr,Zt,ke,xo.horizontal,!1,pe,fe,E);$n&&(_e.horizontal[Wr]=$n,Nn=$n.positionedLines.length===1)}}Ur("left")}else{if(xr==="auto"&&(xr=hT(gr)),Fr||A.get("text-writing-mode").indexOf("horizontal")>=0||!N_(_t)){const en=lT(Me,r,o,p,ge,Rr,Dt,gr,xr,Zt,ke,xo.horizontal,!1,pe,fe,E);en&&(_e.horizontal[xr]=en)}Ur(Fr?"left":xr)}}let Oe,Le,Ge,Ve,He,gt=!1;if(ie.icon&&ie.icon.hasPrimary()){const _t=dN(ie.icon,c.iconSizeData,v["icon-size"],h,c.zoom,ie,E,C.iconScaleFactor);Oe=_t.iconPrimary,Le=_t.iconSecondary;const lr=Oe.toString(),Dt=u.get(lr);Dt&&(Ge=A.get("icon-offset").evaluate(ie,{},h),Ve=A.get("icon-anchor").evaluate(ie,{},h),He=A.get("icon-text-fit").evaluate(ie,{},h),Re=W8(p.get(lr),Le?p.get(Le.toString()):void 0,Ge,Ve),gt=Dt.sdf,c.sdfIcons===void 0?c.sdfIcons=Dt.sdf:c.sdfIcons!==Dt.sdf&&Kn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Dt.pixelRatio!==c.pixelRatio||A.get("icon-rotate").constantOr(1)!==0)&&(c.iconsNeedLinear=!0))}X=X||!(!ie.icon||!ie.icon.hasSecondary());const ft=fT(_e.horizontal)||_e.vertical;c.iconsInText||(c.iconsInText=!!ft&&ft.iconsInText);const Ft=pe*C.textScaleFactor/ws,{defaultShapedIcon:xt,verticallyShapedIcon:Et}=t$(c,Re,A,ie,h,_e,Ft,Ge,He);Re=xt,ee.push({feature:ie,shapedTextOrientations:_e,shapedText:ft,shapedIcon:Re,iconPrimary:Oe,iconSecondary:Le,iconOffset:Ge,iconAnchor:Ve,verticallyShapedIcon:Et,layoutTextSize:pe,layoutIconSize:Ce,textOffset:ke,isSDFIcon:gt,iconTextFit:He})}return{featureData:ee,sizes:C,hasAnySecondaryIcon:X,textAlongLine:W,symbolPlacement:Z}},s.ea=nN,s.eb=function(c,r,o,u,p,h,_,w,E,A){const{featureData:v,hasAnySecondaryIcon:C,sizes:I,textAlongLine:M,symbolPlacement:P}=r;for(const R of v){const{shapedIcon:F,verticallyShapedIcon:B,feature:Z,shapedTextOrientations:W,shapedText:G,layoutTextSize:X,textOffset:ee,isSDFIcon:ie,iconPrimary:ge,iconSecondary:fe,iconTextFit:pe,iconOffset:Ce}=R;hN(F,A.iconPositions,ge,fe),hN(B,A.iconPositions,ge,fe),e$(W,A.iconPositions),(G||F)&&r$(c,Z,W,F,B,E,I,X,0,ee,ie,u,p,_,w,C,pe,Ce,M,P)}o&&c.generateCollisionDebugBuffers(h,c.collisionBoxArray,I.textScaleFactor)},s.ec=ad,s.ed=V1,s.ee=hi,s.ef=$I,s.eg=Vk,s.eh=N,s.ei=function(c){let r=0;if(new Uint32Array(c,0,1)[0]!==LR){const o=new Uint32Array(c,0,7),[,,u,p,h,_]=o;r=o.byteLength+p+h+_+h,(u!==c.byteLength||r>=c.byteLength)&&Kn("Invalid b3dm header information.")}return BR(c,r)},s.ej=function(c,r){const o=UR(c);for(const u of o){for(const p of u.meshes)I7(p);u.lights&&(u.lightMeshIndex=u.meshes.length,u.meshes.push(k7(u.lights,r)))}return o},s.ek=R1,s.el=tR,s.em=zo,s.en=function(c){Vr(),Dr!=null&&Dr.then(r=>{r.keys().then(o=>{for(let u=0;u<o.length-c;u++)r.delete(o[u])})})},s.f=function(c){return c.indexOf("mapbox:")===0},s.g=function(c,r){return jo(fi(c,{method:"GET"}),r)},s.h=ue,s.i=function(c){return oe.API_STYLE_REGEX.test(c)&&!ve(c)},s.j=function(c){return decodeURIComponent(atob(c).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join(""))},s.k=function(c){return btoa(encodeURIComponent(c).replace(/%([0-9A-F]{2})/g,(r,o)=>String.fromCharCode(+("0x"+o))))},s.l=fi,s.m=gn,s.n=function(c,r){return jo(fi(c,{type:"json"}),r)},s.o=Yg,s.p=function(c,r){return jo(fi(c,{method:"POST"}),r)},s.q=et,s.r=bs,s.s=function(c){try{const r=self[c];return r.setItem("_mapbox_test_",1),r.removeItem("_mapbox_test_"),!0}catch{return!1}},s.t=st,s.u=function(){return function c(r){return r?(r^Math.random()*(16>>r/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,c)}()},s.v=function(c){return!!c&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(c)},s.w=Kn,s.x=function(){return kT||(kT=new hf),kT},s.y=DT,s.z=Tu}),y(["./shared"],function(s){function N(tt){const oe=tt?tt.url.toString():void 0;return oe?performance.getEntriesByName(oe):[]}function D(tt){if(typeof tt=="number"||typeof tt=="boolean"||typeof tt=="string"||tt==null)return JSON.stringify(tt);if(Array.isArray(tt)){let ue="[";for(const ve of tt)ue+=`${D(ve)},`;return`${ue}]`}let oe="{";for(const ue of Object.keys(tt).sort())oe+=`${ue}:${D(tt[ue])},`;return`${oe}}`}function O(tt){let oe="";for(const ue of s.bm)(tt.type!=="model"||ue!=="minzoom"&&ue!=="maxzoom")&&(oe+=`/${D(tt[ue])}`);return oe}class ${constructor(oe){this.keyCache={},this._layers={},this._layerConfigs={},oe&&this.replace(oe)}replace(oe,ue){this._layerConfigs={},this._layers={},this.update(oe,[],ue)}update(oe,ue,ve){this._options=ve;for(const Ae of oe)this._layerConfigs[Ae.id]=Ae,(this._layers[Ae.id]=s.cv(Ae,this.scope,null,this._options)).compileFilter(ve),this.keyCache[Ae.id]&&delete this.keyCache[Ae.id];for(const Ae of ue)delete this.keyCache[Ae],delete this._layerConfigs[Ae],delete this._layers[Ae];this.familiesBySource={};const Ie=function(Ae,De){const Ye={};for(let Qe=0;Qe<Ae.length;Qe++){const st=Ae[Qe];let et=De&&De[st.id];!et&&(et=O(st),st.type==="line"&&st.paint)&&function Lt(Vt){return typeof Vt=="string"&&Vt==="line-progress"||(Array.isArray(Vt)?Vt.some(Lt):!(!Vt||typeof Vt!="object")&&Object.values(Vt).some(Lt))}(st.paint["line-width"])&&(et+=`/${D(st.paint["line-width"])}`),De&&(De[st.id]=et);let wt=Ye[et];wt||(wt=Ye[et]=[]),wt.push(st)}const ze=[];for(const Qe in Ye)ze.push(Ye[Qe]);return ze}(Object.values(this._layerConfigs),this.keyCache);for(const Ae of Ie){const De=Ae.map(wt=>this._layers[wt.id]),Ye=De[0];if(Ye.visibility==="none")continue;const ze=Ye.source||"";let Qe=this.familiesBySource[ze];Qe||(Qe=this.familiesBySource[ze]={});const st=Ye.sourceLayer||"_geojsonTileLayer";let et=Qe[st];et||(et=Qe[st]=[]),et.push(De)}}}const q=1*s.d_;class J{constructor(oe){const ue={},ve=[];for(const Ye in oe){const ze=oe[Ye],Qe=ue[Ye]={};for(const st in ze.glyphs){const et=ze.glyphs[+st];if(!et||et.bitmap.width===0||et.bitmap.height===0)continue;const wt=et.metrics.localGlyph?q:1,Lt={x:0,y:0,w:et.bitmap.width+2*wt,h:et.bitmap.height+2*wt};ve.push(Lt),Qe[st]=Lt}}const{w:Ie,h:Ae}=s.H(ve),De=new s.dZ({width:Ie||1,height:Ae||1});for(const Ye in oe){const ze=oe[Ye];for(const Qe in ze.glyphs){const st=ze.glyphs[+Qe];if(!st||st.bitmap.width===0||st.bitmap.height===0)continue;const et=ue[Ye][Qe],wt=st.metrics.localGlyph?q:1;s.dZ.copy(st.bitmap,De,{x:0,y:0},{x:et.x+wt,y:et.y+wt},st.bitmap)}}this.image=De,this.positions=ue}}s.dY(J,"GlyphAtlas");class re{constructor(oe){this.tileID=new s.aH(oe.tileID.overscaledZ,oe.tileID.wrap,oe.tileID.canonical.z,oe.tileID.canonical.x,oe.tileID.canonical.y),this.tileZoom=oe.tileZoom,this.uid=oe.uid,this.zoom=oe.zoom,this.lut=oe.lut,this.canonical=oe.tileID.canonical,this.pixelRatio=oe.pixelRatio,this.tileSize=oe.tileSize,this.source=oe.source,this.scope=oe.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=oe.showCollisionBoxes,this.collectResourceTiming=!!oe.request&&oe.request.collectResourceTiming,this.promoteId=oe.promoteId,this.isSymbolTile=oe.isSymbolTile,this.tileTransform=s.aR(oe.tileID.canonical,oe.projection),this.projection=oe.projection,this.worldview=oe.worldview,this.localizableLayerIds=oe.localizableLayerIds,this.brightness=oe.brightness,this.extraShadowCaster=!!oe.extraShadowCaster,this.tessellationStep=oe.tessellationStep,this.scaleFactor=oe.scaleFactor}parse(oe,ue,ve,Ie,Ae){this.status="parsing",this.data=oe,this.collisionBoxArray=new s.aX;const De=new s.d$(Object.keys(oe.layers).sort()),Ye=new s.e0(this.tileID,this.promoteId);Ye.bucketLayerIDs=[];const ze={},Qe=new s.e1(256,256),st={featureIndex:Ye,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Qe,availableImages:ve,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},et=ue.familiesBySource[this.source];for(const Vr in et){const mn=oe.layers[Vr];if(!mn)continue;let gn=!1,vn=!1,vi=!1;for(const Ds of et[Vr])Ds[0].type==="symbol"?gn=!0:vn=!0,Ds[0].is3D()&&Ds[0].type!=="model"&&(vi=!0);if(this.extraShadowCaster&&!vi||this.isSymbolTile===!0&&!gn||this.isSymbolTile===!1&&!vn)continue;mn.version===1&&s.w(`Vector tile source "${this.source}" layer "${Vr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ki=De.encode(Vr),Cs=[];let Ro=!1;for(let Ds=0,Ji=0;Ds<mn.length;Ds++){const as=mn.feature(Ds),bu=Ye.getId(as,Vr);if(this.localizableLayerIds&&this.localizableLayerIds.has(Vr)){const jo=as.properties?as.properties.worldview:null;if(this.worldview&&typeof jo=="string")if(jo==="all")as.properties.$localized=!0;else{if(!jo.split(",").includes(this.worldview))continue;as.properties.$localized=!0,as.properties.worldview=this.worldview}}!Ro&&as.properties&&as.properties.hasOwnProperty(s.e2)&&(Ro=!0),Cs.push({feature:as,id:bu,index:Ji,sourceLayerIndex:Ki}),Ji++}Ro&&!st.elevationFeatures&&oe.layers.hasOwnProperty(s.e3)&&(st.elevationFeatures=s.e4.parseFrom(oe.layers[s.e3],this.canonical));for(const Ds of et[Vr]){const Ji=Ds[0];(!this.extraShadowCaster||Ji.is3D()&&Ji.type!=="model")&&(this.isSymbolTile!==void 0&&Ji.type==="symbol"!==this.isSymbolTile||Ji.minzoom&&this.zoom<Math.floor(Ji.minzoom)||Ji.maxzoom&&this.zoom>=Ji.maxzoom||Ji.visibility!=="none"&&(Q(Ds,this.zoom,st.brightness,ve),(ze[Ji.id]=Ji.createBucket({index:Ye.bucketLayerIDs.length,layers:Ds,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ki,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(Cs,st,this.tileID.canonical,this.tileTransform),Ye.bucketLayerIDs.push(Ds.map(as=>s.C(as.id,as.scope)))))}}let wt,Lt,Vt,Cr,kr,Nr;Qe.trim();const Dr={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},jn=()=>{if(wt)return this.status="done",Ae(wt);if(this.extraShadowCaster)this.status="done",Ae(null,{buckets:Object.values(ze).filter(Vr=>!Vr.isEmpty()),featureIndex:Ye,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:st.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Lt&&Vt&&Cr){const Vr=new J(Lt),mn=new Map;for(const[vi,Ki]of Vt.entries()){const{imagePosition:Cs}=s.e7(vi,Ki,s.e8);mn.set(vi,Cs)}const gn={};for(const vi in ze){const Ki=ze[vi];Ki instanceof s.aY&&(Q(Ki.layers,this.zoom,st.brightness,ve),gn[vi]=s.e9(Ki,Lt,Vr.positions,Vt,mn,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio))}const vn={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Ie,Vt,kr,()=>{vn.iconsPending=!1,ri(gn,Vr,vn)}),this.rasterizeIfNeeded(Ie,Cr,Nr,()=>{vn.patternsPending=!1,ri(gn,Vr,vn)})}},ri=(Vr,mn,gn,vn)=>{if(gn.iconsPending||gn.patternsPending)return;const vi=new s.ea(Vt,Cr,this.lut);for(const Ki in ze){const Cs=ze[Ki];if(Ki in Vr)s.eb(Cs,Vr[Ki],this.showCollisionBoxes,ve,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Vt,vi);else if(Cs.hasPattern&&(Cs instanceof s.b2||Cs instanceof s.b3||Cs instanceof s.d8)){Q(Cs.layers,this.zoom,st.brightness,ve);const Ro=Object.fromEntries(vi.patternPositions);Cs.addFeatures(st,this.tileID.canonical,Ro,ve,this.tileTransform,this.brightness)}}this.status="done",Ae(null,{buckets:Object.values(ze).filter(Ki=>!Ki.isEmpty()),featureIndex:Ye,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:mn.image,lineAtlas:Qe,imageAtlas:vi,brightness:st.brightness})};if(!this.extraShadowCaster){const Vr=s.e5(st.glyphDependencies,vn=>Object.keys(vn).map(Number));Object.keys(Vr).length?Ie.send("getGlyphs",{uid:this.uid,stacks:Vr,scope:this.scope},(vn,vi)=>{wt||(wt=vn,Lt=vi,jn())},void 0,!1,Dr):Lt={};const mn=Array.from(st.iconDependencies.keys()).map(vn=>s.I.parse(vn));mn.length?Ie.send("getImages",{images:mn,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(vn,vi)=>{wt||(wt=vn,Vt=new Map,kr=this.updateImageMapAndGetImageTaskQueue(Vt,vi,st.iconDependencies),jn())},void 0,!1,Dr):(Vt=new Map,kr=new Map);const gn=Array.from(st.patternDependencies.keys()).map(vn=>s.I.parse(vn));gn.length?Ie.send("getImages",{images:gn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(vn,vi)=>{wt||(wt=vn,Cr=new Map,Nr=this.updateImageMapAndGetImageTaskQueue(Cr,vi,st.patternDependencies),jn())},void 0,!1,Dr):(Cr=new Map,Nr=new Map)}if(st.elevationFeatures&&st.elevationFeatures.length>0){const Vr=[];for(const gn of Object.values(ze))if(gn instanceof s.b3){const vn=gn.getUnevaluatedPortalGraph();vn&&Vr.push(vn)}const mn=s.e6.evaluate(Vr);for(const gn of Object.values(ze))gn instanceof s.b3&&gn.setEvaluatedPortalGraph(mn)}jn()}rasterizeIfNeeded(oe,ue,ve,Ie){Array.from(ue.values()).some(Ae=>Ae.usvg)?this.rasterize(oe,ue,ve,Ie):Ie()}updateImageMapAndGetImageTaskQueue(oe,ue,ve){const Ie=new Map;for(const Ae of ue.keys()){const De=ve.get(Ae)||[];for(const Ye of De){const ze=Ye.toString(),Qe=ue.get(Ye.id.toString());Qe.usvg?Ie.has(ze)||(Ie.set(ze,Ye),oe.set(ze,Object.assign({},Qe))):oe.set(ze,Qe)}}return Ie}rasterize(oe,ue,ve,Ie){this.rasterizeTask=oe.send("rasterizeImages",{scope:this.scope,tasks:ve},(Ae,De)=>{if(!Ae)for(const[Ye,ze]of De.entries()){const Qe=Object.assign(ue.get(Ye),{data:ze});ue.set(Ye,Qe)}Ie()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function Q(tt,oe,ue,ve){const Ie=new s.aa(oe,{brightness:ue});for(const Ae of tt)Ae.recalculate(Ie,ve)}class ce extends s.E{constructor(oe,ue,ve,Ie,Ae,De){super(),this.actor=oe,this.layerIndex=ue,this.availableImages=ve,this.loadVectorData=Ae||s.aE,this.loading={},this.loaded={},this.deduped=new s.aD(oe.scheduler),this.isSpriteLoaded=Ie,this.scheduler=oe.scheduler,this.brightness=De}loadTile(oe,ue){const ve=oe.uid,Ie=oe&&oe.request,Ae=Ie&&Ie.collectResourceTiming,De=this.loading[ve]=new re(oe);De.abort=this.loadVectorData(oe,(Ye,ze)=>{const Qe=!this.loading[ve];if(delete this.loading[ve],De.cancelRasterize(),Qe||Ye||!ze)return De.status="done",Qe||(this.loaded[ve]=De),ue(Ye);const st=ze.rawData,et={};ze.expires&&(et.expires=ze.expires),ze.cacheControl&&(et.cacheControl=ze.cacheControl),De.vectorTile=ze.vectorTile||new s.ec.VectorTile(new s.bi(st));const wt=()=>{De.parse(De.vectorTile,this.layerIndex,this.availableImages,this.actor,(Lt,Vt)=>{if(Lt||!Vt)return ue(Lt);const Cr={};if(Ae){const kr=N(Ie);kr.length>0&&(Cr.resourceTiming=JSON.parse(JSON.stringify(kr)))}ue(null,s.l({rawTileData:st.slice(0)},Vt,et,Cr))})};this.isSpriteLoaded?wt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(wt,{type:"parseTile",isSymbolTile:oe.isSymbolTile,zoom:oe.tileZoom}):wt()}),this.loaded=this.loaded||{},this.loaded[ve]=De})}reloadTile(oe,ue){const ve=this.loaded,Ie=oe.uid;if(ve&&ve[Ie]){const Ae=ve[Ie];Ae.scaleFactor=oe.scaleFactor,Ae.showCollisionBoxes=oe.showCollisionBoxes,Ae.projection=oe.projection,Ae.brightness=oe.brightness,Ae.tileTransform=s.aR(oe.tileID.canonical,oe.projection),Ae.extraShadowCaster=oe.extraShadowCaster,Ae.lut=oe.lut;const De=(Ye,ze)=>{const Qe=Ae.reloadCallback;Qe&&(delete Ae.reloadCallback,Ae.parse(Ae.vectorTile,this.layerIndex,this.availableImages,this.actor,Qe)),ue(Ye,ze)};Ae.status==="parsing"?Ae.reloadCallback=De:Ae.status==="done"&&(Ae.vectorTile?Ae.parse(Ae.vectorTile,this.layerIndex,this.availableImages,this.actor,De):De())}else ue(null,void 0)}abortTile(oe,ue){const ve=oe.uid,Ie=this.loading[ve];Ie&&(Ie.abort&&Ie.abort(),delete this.loading[ve]),ue()}removeTile(oe,ue){const ve=this.loaded,Ie=oe.uid;ve&&ve[Ie]&&delete ve[Ie],ue()}}class le{loadTile(oe,ue){const{uid:ve,encoding:Ie,rawImageData:Ae,padding:De}=oe,Ye=ImageBitmap&&Ae instanceof ImageBitmap?this.getImageData(Ae,De):Ae;ue(null,new s.ed(ve,Ye,Ie,De<1))}reloadTile(oe,ue){ue(null,null)}abortTile(oe,ue){ue()}removeTile(oe,ue){ue()}getImageData(oe,ue){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(oe.width,oe.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=oe.width,this.offscreenCanvas.height=oe.height,this.offscreenCanvasContext.drawImage(oe,0,0,oe.width,oe.height);const ve=this.offscreenCanvasContext.getImageData(-ue,-ue,oe.width+2*ue,oe.height+2*ue);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ve}}s.bh.setPbf(s.bi);class ae{constructor(oe){this._mrt=new s.bh(oe.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=oe.uid,this.tileID=oe.tileID,this.source=oe.source}parse(oe,ue){const ve=this._mrt;this.status="parsing",this._entireBuffer=oe;try{ve.parseHeader(oe),this._isHeaderLoaded=!0;const Ie=[];for(const Ae in ve.layers){const De=ve.getLayer(Ae),Ye=De.getDataRange(De.getBandList()),ze=ve.createDecodingTask(Ye),Qe=oe.slice(Ye.firstByte,Ye.lastByte+1),st=s.bh.performDecoding(Qe,ze).then(et=>ze.complete(null,et)).catch(et=>ze.complete(et,null));Ie.push(st)}Promise.allSettled(Ie).then(()=>ue(null,ve))}catch(Ie){ue(Ie)}}}class he{constructor(oe){this.actor=oe,this.loading={},this.loaded={}}loadTile(oe,ue){const ve=oe.uid,Ie=oe.request,Ae=this.loading[ve]=new ae(oe),{cancel:De}=s.bj(Ie,(Ye,ze,Qe,st)=>{const et=!this.loading[ve];if(delete this.loading[ve],et||Ye||!ze)return Ae.status="done",et||(this.loaded[ve]=Ae),ue(Ye);Ae.parse(ze,(wt,Lt)=>{if(wt||!Lt)return ue(wt);ue(null,Lt,Qe,st)}),this.loaded[ve]=Ae});Ae.abort=De}reloadTile(oe,ue){ue(null,void 0)}abortTile(oe,ue){const ve=oe.uid,Ie=this.loading[ve];Ie&&(Ie.abort&&Ie.abort(),delete this.loading[ve]),ue()}removeTile(oe,ue){const ve=oe.uid;this.loaded[ve]&&delete this.loaded[ve],ue()}decodeRasterArray({task:oe,buffer:ue},ve){s.bh.performDecoding(ue,oe).then(Ie=>ve(null,Ie)).catch(Ie=>ve(Ie))}}const Se=s.ec.VectorTileFeature.prototype.toGeoJSON;class je{constructor(oe){this._feature=oe,this.extent=s.ai,this.type=oe.type,this.properties=oe.tags,"id"in oe&&!isNaN(oe.id)&&(this.id=parseInt(oe.id,10))}loadGeometry(){if(this._feature.type===1){const oe=[];for(const ue of this._feature.geometry)oe.push([new s.P(ue[0],ue[1])]);return oe}{const oe=[];for(const ue of this._feature.geometry){const ve=[];for(const Ie of ue)ve.push(new s.P(Ie[0],Ie[1]));oe.push(ve)}return oe}}toGeoJSON(oe,ue,ve){return Se.call(this,oe,ue,ve)}}class it{constructor(oe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.ai,this.length=oe.length,this._features=oe}feature(oe){return new je(this._features[oe])}}const qe=64/4096,ct=128;class pt{constructor(){this.features=new Map}clear(){this.features.clear()}load(oe=[],ue){for(const ve of oe){const Ie=ve.id;if(Ie==null)continue;let Ae=this.features.get(Ie);Ae&&this.updateCache(Ae,ue),ve.geometry?(Ae=yt(ve),this.updateCache(Ae,ue),this.features.set(Ie,Ae)):this.features.delete(Ie),this.updateCache(Ae,ue)}}updateCache(oe,ue){for(const{canonical:ve,uid:Ie}of Object.values(ue)){const{z:Ae,x:De,y:Ye}=ve;Ze(oe,Math.pow(2,Ae),De,Ye)&&delete ue[Ie]}}getTile(oe,ue,ve){const Ie=Math.pow(2,oe),Ae=[];for(const De of this.features.values())Ze(De,Ie,ue,ve)&&Ae.push(Pt(De,Ie,ue,ve));return{features:Ae}}getFeatures(){return[...this.features.values()]}}function Ze({minX:tt,minY:oe,maxX:ue,maxY:ve},Ie,Ae,De){return tt<(Ae+1+qe)/Ie&&oe<(De+1+qe)/Ie&&ue>(Ae-qe)/Ie&&ve>(De-qe)/Ie}function yt(tt){const{id:oe,geometry:ue,properties:ve}=tt;if(!ue)return;if(ue.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Ie,coordinates:Ae}=ue,De={id:oe,type:1,geometry:[],tags:ve,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Ye=De.geometry;if(Ie==="Point")Mt(Ae,Ye,De);else if(Ie==="MultiPoint")for(const ze of Ae)Mt(ze,Ye,De);else if(Ie==="LineString")De.type=2,Jt(Ae,Ye,De);else if(Ie==="MultiLineString")De.type=2,jt(Ae,Ye,De);else if(Ie==="Polygon")De.type=3,jt(Ae,Ye,De,!0);else{if(Ie!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");De.type=3;for(const ze of Ae)jt(ze,Ye,De,!0)}return De}function Mt([tt,oe],ue,ve){const Ie=s.av(tt);let Ae=s.aC(oe);Ae=Ae<0?0:Ae>1?1:Ae,ue.push(Ie,Ae),ve.minX=Math.min(ve.minX,Ie),ve.minY=Math.min(ve.minY,Ae),ve.maxX=Math.max(ve.maxX,Ie),ve.maxY=Math.max(ve.maxY,Ae)}function Jt(tt,oe,ue,ve=!1,Ie=!1){const Ae=[];for(const De of tt)Mt(De,Ae,ue);oe.push(Ae),ve&&function(De,Ye){let ze=0;for(let Qe=0,st=De.length,et=st-2;Qe<st;et=Qe,Qe+=2)ze+=(De[Qe]-De[et])*(De[Qe+1]+De[et+1]);if(ze>0===Ye)for(let Qe=0,st=De.length;Qe<st/2;Qe+=2){const et=De[Qe],wt=De[Qe+1];De[Qe]=De[st-2-Qe],De[Qe+1]=De[st-1-Qe],De[st-2-Qe]=et,De[st-1-Qe]=wt}}(Ae,Ie)}function jt(tt,oe,ue,ve=!1){for(let Ie=0;Ie<tt.length;Ie++)Jt(tt[Ie],oe,ue,ve,Ie===0)}function Pt(tt,oe,ue,ve){const{id:Ie,type:Ae,geometry:De,tags:Ye}=tt,ze=[];if(Ae===1)(function(Qe,st,et,wt,Lt){for(let Vt=0;Vt<Qe.length;Vt+=2){const Cr=Math.round(s.ai*(Qe[Vt+0]*st-et)),kr=Math.round(s.ai*(Qe[Vt+1]*st-wt));Lt.push([Cr,kr])}})(De,oe,ue,ve,ze);else for(const Qe of De)Wt(Qe,oe,ue,ve,ze);return{id:Ie,type:Ae,geometry:ze,tags:Ye}}function Wt(tt,oe,ue,ve,Ie){const Ae=-ct,De=s.ai+ct;let Ye;for(let ze=0;ze<tt.length-2;ze+=2){let Qe=Math.round(s.ai*(tt[ze+0]*oe-ue)),st=Math.round(s.ai*(tt[ze+1]*oe-ve)),et=Math.round(s.ai*(tt[ze+2]*oe-ue)),wt=Math.round(s.ai*(tt[ze+3]*oe-ve));const Lt=et-Qe,Vt=wt-st;Qe<Ae&&et<Ae||(Qe<Ae?(st+=Math.round(Vt*((Ae-Qe)/Lt)),Qe=Ae):et<Ae&&(wt=st+Math.round(Vt*((Ae-Qe)/Lt)),et=Ae),st<Ae&&wt<Ae||(st<Ae?(Qe+=Math.round(Lt*((Ae-st)/Vt)),st=Ae):wt<Ae&&(et=Qe+Math.round(Lt*((Ae-st)/Vt)),wt=Ae),Qe>=De&&et>=De||(Qe>=De?(st+=Math.round(Vt*((De-Qe)/Lt)),Qe=De):et>=De&&(wt=st+Math.round(Vt*((De-Qe)/Lt)),et=De),st>=De&&wt>=De||(st>=De?(Qe+=Math.round(Lt*((De-st)/Vt)),st=De):wt>=De&&(et=Qe+Math.round(Lt*((De-st)/Vt)),wt=De),Ye&&Qe===Ye[Ye.length-1][0]&&st===Ye[Ye.length-1][1]||(Ye=[[Qe,st]],Ie.push(Ye)),Ye.push([et,wt])))))}}var Nt,Xe,nt,Qt={exports:{}},rr=function(){if(nt)return Qt.exports;nt=1;var tt=s.eg(),oe=function(){if(Xe)return Nt;Xe=1;var st=s.ee(),et=s.ef().VectorTileFeature;function wt(Vt,Cr){this.options=Cr||{},this.features=Vt,this.length=Vt.length}function Lt(Vt,Cr){this.id=typeof Vt.id=="number"?Vt.id:void 0,this.type=Vt.type,this.rawGeometry=Vt.type===1?[Vt.geometry]:Vt.geometry,this.properties=Vt.tags,this.extent=Cr||4096}return Nt=wt,wt.prototype.feature=function(Vt){return new Lt(this.features[Vt],this.options.extent)},Lt.prototype.loadGeometry=function(){var Vt=this.rawGeometry;this.geometry=[];for(var Cr=0;Cr<Vt.length;Cr++){for(var kr=Vt[Cr],Nr=[],Dr=0;Dr<kr.length;Dr++)Nr.push(new st(kr[Dr][0],kr[Dr][1]));this.geometry.push(Nr)}return this.geometry},Lt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Vt=this.geometry,Cr=1/0,kr=-1/0,Nr=1/0,Dr=-1/0,jn=0;jn<Vt.length;jn++)for(var ri=Vt[jn],Vr=0;Vr<ri.length;Vr++){var mn=ri[Vr];Cr=Math.min(Cr,mn.x),kr=Math.max(kr,mn.x),Nr=Math.min(Nr,mn.y),Dr=Math.max(Dr,mn.y)}return[Cr,Nr,kr,Dr]},Lt.prototype.toGeoJSON=et.prototype.toGeoJSON,Nt}();function ue(st){var et=new tt;return function(wt,Lt){for(var Vt in wt.layers)Lt.writeMessage(3,ve,wt.layers[Vt])}(st,et),et.finish()}function ve(st,et){var wt;et.writeVarintField(15,st.version||1),et.writeStringField(1,st.name||""),et.writeVarintField(5,st.extent||4096);var Lt={keys:[],values:[],keycache:{},valuecache:{}};for(wt=0;wt<st.length;wt++)Lt.feature=st.feature(wt),et.writeMessage(2,Ie,Lt);var Vt=Lt.keys;for(wt=0;wt<Vt.length;wt++)et.writeStringField(3,Vt[wt]);var Cr=Lt.values;for(wt=0;wt<Cr.length;wt++)et.writeMessage(4,Qe,Cr[wt])}function Ie(st,et){var wt=st.feature;wt.id!==void 0&&et.writeVarintField(1,wt.id),et.writeMessage(2,Ae,st),et.writeVarintField(3,wt.type),et.writeMessage(4,ze,wt)}function Ae(st,et){var wt=st.feature,Lt=st.keys,Vt=st.values,Cr=st.keycache,kr=st.valuecache;for(var Nr in wt.properties){var Dr=wt.properties[Nr],jn=Cr[Nr];if(Dr!==null){jn===void 0&&(Lt.push(Nr),Cr[Nr]=jn=Lt.length-1),et.writeVarint(jn);var ri=typeof Dr;ri!=="string"&&ri!=="boolean"&&ri!=="number"&&(Dr=JSON.stringify(Dr));var Vr=ri+":"+Dr,mn=kr[Vr];mn===void 0&&(Vt.push(Dr),kr[Vr]=mn=Vt.length-1),et.writeVarint(mn)}}}function De(st,et){return(et<<3)+(7&st)}function Ye(st){return st<<1^st>>31}function ze(st,et){for(var wt=st.loadGeometry(),Lt=st.type,Vt=0,Cr=0,kr=wt.length,Nr=0;Nr<kr;Nr++){var Dr=wt[Nr],jn=1;Lt===1&&(jn=Dr.length),et.writeVarint(De(1,jn));for(var ri=Lt===3?Dr.length-1:Dr.length,Vr=0;Vr<ri;Vr++){Vr===1&&Lt!==1&&et.writeVarint(De(2,ri-1));var mn=Dr[Vr].x-Vt,gn=Dr[Vr].y-Cr;et.writeVarint(Ye(mn)),et.writeVarint(Ye(gn)),Vt+=mn,Cr+=gn}Lt===3&&et.writeVarint(De(7,1))}}function Qe(st,et){var wt=typeof st;wt==="string"?et.writeStringField(1,st):wt==="boolean"?et.writeBooleanField(7,st):wt==="number"&&(st%1!=0?et.writeDoubleField(3,st):st<0?et.writeSVarintField(6,st):et.writeVarintField(5,st))}return Qt.exports=ue,Qt.exports.fromVectorTileJs=ue,Qt.exports.fromGeojsonVt=function(st,et){et=et||{};var wt={};for(var Lt in st)wt[Lt]=new oe(st[Lt].features,et),wt[Lt].name=Lt,wt[Lt].version=et.version,wt[Lt].extent=et.extent;return ue({layers:wt})},Qt.exports.GeoJSONWrapper=oe,Qt.exports}(),mr=s.eh(rr);const Ut={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:tt=>tt},hn=Math.fround||(Gn=new Float32Array(1),tt=>(Gn[0]=+tt,Gn[0]));var Gn;const At=3,qt=5,Br=6;class xn{constructor(oe){this.options=Object.assign(Object.create(Ut),oe),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(oe){const{log:ue,minZoom:ve,maxZoom:Ie}=this.options;ue&&console.time("total time");const Ae=`prepare ${oe.length} points`;ue&&console.time(Ae),this.points=oe;const De=[];for(let ze=0;ze<oe.length;ze++){const Qe=oe[ze];if(!Qe.geometry)continue;const[st,et]=Qe.geometry.coordinates,wt=hn(pn(st)),Lt=hn(hi(et));De.push(wt,Lt,1/0,ze,-1,1),this.options.reduce&&De.push(0)}let Ye=this.trees[Ie+1]=this._createTree(De);ue&&console.timeEnd(Ae);for(let ze=Ie;ze>=ve;ze--){const Qe=+Date.now();Ye=this.trees[ze]=this._createTree(this._cluster(Ye,ze)),ue&&console.log("z%d: %d clusters in %dms",ze,Ye.numItems,+Date.now()-Qe)}return ue&&console.timeEnd("total time"),this}getClusters(oe,ue){let ve=((oe[0]+180)%360+360)%360-180;const Ie=Math.max(-90,Math.min(90,oe[1]));let Ae=oe[2]===180?180:((oe[2]+180)%360+360)%360-180;const De=Math.max(-90,Math.min(90,oe[3]));if(oe[2]-oe[0]>=360)ve=-180,Ae=180;else if(ve>Ae){const et=this.getClusters([ve,Ie,180,De],ue),wt=this.getClusters([-180,Ie,Ae,De],ue);return et.concat(wt)}const Ye=this.trees[this._limitZoom(ue)],ze=Ye.range(pn(ve),hi(De),pn(Ae),hi(Ie)),Qe=Ye.data,st=[];for(const et of ze){const wt=this.stride*et;st.push(Qe[wt+qt]>1?de(Qe,wt,this.clusterProps):this.points[Qe[wt+At]])}return st}getChildren(oe){const ue=this._getOriginId(oe),ve=this._getOriginZoom(oe),Ie="No cluster with the specified id.",Ae=this.trees[ve];if(!Ae)throw new Error(Ie);const De=Ae.data;if(ue*this.stride>=De.length)throw new Error(Ie);const Ye=this.options.radius/(this.options.extent*Math.pow(2,ve-1)),ze=Ae.within(De[ue*this.stride],De[ue*this.stride+1],Ye),Qe=[];for(const st of ze){const et=st*this.stride;De[et+4]===oe&&Qe.push(De[et+qt]>1?de(De,et,this.clusterProps):this.points[De[et+At]])}if(Qe.length===0)throw new Error(Ie);return Qe}getLeaves(oe,ue,ve){const Ie=[];return this._appendLeaves(Ie,oe,ue=ue||10,ve=ve||0,0),Ie}getTile(oe,ue,ve){const Ie=this.trees[this._limitZoom(oe)],Ae=Math.pow(2,oe),{extent:De,radius:Ye}=this.options,ze=Ye/De,Qe=(ve-ze)/Ae,st=(ve+1+ze)/Ae,et={features:[]};return this._addTileFeatures(Ie.range((ue-ze)/Ae,Qe,(ue+1+ze)/Ae,st),Ie.data,ue,ve,Ae,et),ue===0&&this._addTileFeatures(Ie.range(1-ze/Ae,Qe,1,st),Ie.data,Ae,ve,Ae,et),ue===Ae-1&&this._addTileFeatures(Ie.range(0,Qe,ze/Ae,st),Ie.data,-1,ve,Ae,et),et.features.length?et:null}getClusterExpansionZoom(oe){let ue=this._getOriginZoom(oe)-1;for(;ue<=this.options.maxZoom;){const ve=this.getChildren(oe);if(ue++,ve.length!==1)break;oe=ve[0].properties.cluster_id}return ue}_appendLeaves(oe,ue,ve,Ie,Ae){const De=this.getChildren(ue);for(const Ye of De){const ze=Ye.properties;if(ze&&ze.cluster?Ae+ze.point_count<=Ie?Ae+=ze.point_count:Ae=this._appendLeaves(oe,ze.cluster_id,ve,Ie,Ae):Ae<Ie?Ae++:oe.push(Ye),oe.length===ve)break}return Ae}_createTree(oe){const ue=new s.bE(oe.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ve=0;ve<oe.length;ve+=this.stride)ue.add(oe[ve],oe[ve+1]);return ue.finish(),ue.data=oe,ue}_addTileFeatures(oe,ue,ve,Ie,Ae,De){for(const Ye of oe){const ze=Ye*this.stride,Qe=ue[ze+qt]>1;let st,et,wt;if(Qe)st=bn(ue,ze,this.clusterProps),et=ue[ze],wt=ue[ze+1];else{const Cr=this.points[ue[ze+At]];st=Cr.properties;const[kr,Nr]=Cr.geometry.coordinates;et=pn(kr),wt=hi(Nr)}const Lt={type:1,geometry:[[Math.round(this.options.extent*(et*Ae-ve)),Math.round(this.options.extent*(wt*Ae-Ie))]],tags:st};let Vt;Vt=Qe||this.options.generateId?ue[ze+At]:this.points[ue[ze+At]].id,Vt!==void 0&&(Lt.id=Vt),De.features.push(Lt)}}_limitZoom(oe){return Math.max(this.options.minZoom,Math.min(Math.floor(+oe),this.options.maxZoom+1))}_cluster(oe,ue){const{radius:ve,extent:Ie,reduce:Ae,minPoints:De}=this.options,Ye=ve/(Ie*Math.pow(2,ue)),ze=oe.data,Qe=[],st=this.stride;for(let et=0;et<ze.length;et+=st){if(ze[et+2]<=ue)continue;ze[et+2]=ue;const wt=ze[et],Lt=ze[et+1],Vt=oe.within(ze[et],ze[et+1],Ye),Cr=ze[et+qt];let kr=Cr;for(const Nr of Vt){const Dr=Nr*st;ze[Dr+2]>ue&&(kr+=ze[Dr+qt])}if(kr>Cr&&kr>=De){let Nr,Dr=wt*Cr,jn=Lt*Cr,ri=-1;const Vr=(et/st<<5)+(ue+1)+this.points.length;for(const mn of Vt){const gn=mn*st;if(ze[gn+2]<=ue)continue;ze[gn+2]=ue;const vn=ze[gn+qt];Dr+=ze[gn]*vn,jn+=ze[gn+1]*vn,ze[gn+4]=Vr,Ae&&(Nr||(Nr=this._map(ze,et,!0),ri=this.clusterProps.length,this.clusterProps.push(Nr)),Ae(Nr,this._map(ze,gn)))}ze[et+4]=Vr,Qe.push(Dr/kr,jn/kr,1/0,Vr,-1,kr),Ae&&Qe.push(ri)}else{for(let Nr=0;Nr<st;Nr++)Qe.push(ze[et+Nr]);if(kr>1)for(const Nr of Vt){const Dr=Nr*st;if(!(ze[Dr+2]<=ue)){ze[Dr+2]=ue;for(let jn=0;jn<st;jn++)Qe.push(ze[Dr+jn])}}}}return Qe}_getOriginId(oe){return oe-this.points.length>>5}_getOriginZoom(oe){return(oe-this.points.length)%32}_map(oe,ue,ve){if(oe[ue+qt]>1){const De=this.clusterProps[oe[ue+Br]];return ve?Object.assign({},De):De}const Ie=this.points[oe[ue+At]].properties,Ae=this.options.map(Ie);return ve&&Ae===Ie?Object.assign({},Ae):Ae}}function de(tt,oe,ue){return{type:"Feature",id:tt[oe+At],properties:bn(tt,oe,ue),geometry:{type:"Point",coordinates:[(ve=tt[oe],360*(ve-.5)),bt(tt[oe+1])]}};var ve}function bn(tt,oe,ue){const ve=tt[oe+qt],Ie=ve>=1e4?`${Math.round(ve/1e3)}k`:ve>=1e3?Math.round(ve/100)/10+"k":ve,Ae=tt[oe+Br],De=Ae===-1?{}:Object.assign({},ue[Ae]);return Object.assign(De,{cluster:!0,cluster_id:tt[oe+At],point_count:ve,point_count_abbreviated:Ie})}function pn(tt){return tt/360+.5}function hi(tt){const oe=Math.sin(tt*Math.PI/180),ue=.5-.25*Math.log((1+oe)/(1-oe))/Math.PI;return ue<0?0:ue>1?1:ue}function bt(tt){const oe=(180-360*tt)*Math.PI/180;return 360*Math.atan(Math.exp(oe))/Math.PI-90}function Vi(tt,oe,ue,ve){let Ie=ve;const Ae=oe+(ue-oe>>1);let De,Ye=ue-oe;const ze=tt[oe],Qe=tt[oe+1],st=tt[ue],et=tt[ue+1];for(let wt=oe+3;wt<ue;wt+=3){const Lt=ni(tt[wt],tt[wt+1],ze,Qe,st,et);if(Lt>Ie)De=wt,Ie=Lt;else if(Lt===Ie){const Vt=Math.abs(wt-Ae);Vt<Ye&&(De=wt,Ye=Vt)}}Ie>ve&&(De-oe>3&&Vi(tt,oe,De,ve),tt[De+2]=Ie,ue-De>3&&Vi(tt,De,ue,ve))}function ni(tt,oe,ue,ve,Ie,Ae){let De=Ie-ue,Ye=Ae-ve;if(De!==0||Ye!==0){const ze=((tt-ue)*De+(oe-ve)*Ye)/(De*De+Ye*Ye);ze>1?(ue=Ie,ve=Ae):ze>0&&(ue+=De*ze,ve+=Ye*ze)}return De=tt-ue,Ye=oe-ve,De*De+Ye*Ye}function os(tt,oe,ue,ve){const Ie={id:tt??null,type:oe,geometry:ue,tags:ve,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(oe==="Point"||oe==="MultiPoint"||oe==="LineString")Be(Ie,ue);else if(oe==="Polygon")Be(Ie,ue[0]);else if(oe==="MultiLineString")for(const Ae of ue)Be(Ie,Ae);else if(oe==="MultiPolygon")for(const Ae of ue)Be(Ie,Ae[0]);return Ie}function Be(tt,oe){for(let ue=0;ue<oe.length;ue+=3)tt.minX=Math.min(tt.minX,oe[ue]),tt.minY=Math.min(tt.minY,oe[ue+1]),tt.maxX=Math.max(tt.maxX,oe[ue]),tt.maxY=Math.max(tt.maxY,oe[ue+1])}function ut(tt,oe,ue,ve){if(!oe.geometry)return;const Ie=oe.geometry.coordinates;if(Ie&&Ie.length===0)return;const Ae=oe.geometry.type,De=Math.pow(ue.tolerance/((1<<ue.maxZoom)*ue.extent),2);let Ye=[],ze=oe.id;if(ue.promoteId?ze=oe.properties[ue.promoteId]:ue.generateId&&(ze=ve||0),Ae==="Point")St(Ie,Ye);else if(Ae==="MultiPoint")for(const Qe of Ie)St(Qe,Ye);else if(Ae==="LineString")dr(Ie,Ye,De,!1);else if(Ae==="MultiLineString"){if(ue.lineMetrics){for(const Qe of Ie)Ye=[],dr(Qe,Ye,De,!1),tt.push(os(ze,"LineString",Ye,oe.properties));return}or(Ie,Ye,De,!1)}else if(Ae==="Polygon")or(Ie,Ye,De,!0);else{if(Ae!=="MultiPolygon"){if(Ae==="GeometryCollection"){for(const Qe of oe.geometry.geometries)ut(tt,{id:ze,geometry:Qe,properties:oe.properties},ue,ve);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Qe of Ie){const st=[];or(Qe,st,De,!0),Ye.push(st)}}tt.push(os(ze,Ae,Ye,oe.properties))}function St(tt,oe){oe.push(tr(tt[0]),Bt(tt[1]),0)}function dr(tt,oe,ue,ve){let Ie,Ae,De=0;for(let ze=0;ze<tt.length;ze++){const Qe=tr(tt[ze][0]),st=Bt(tt[ze][1]);oe.push(Qe,st,0),ze>0&&(De+=ve?(Ie*st-Qe*Ae)/2:Math.sqrt(Math.pow(Qe-Ie,2)+Math.pow(st-Ae,2))),Ie=Qe,Ae=st}const Ye=oe.length-3;oe[2]=1,Vi(oe,0,Ye,ue),oe[Ye+2]=1,oe.size=Math.abs(De),oe.start=0,oe.end=oe.size}function or(tt,oe,ue,ve){for(let Ie=0;Ie<tt.length;Ie++){const Ae=[];dr(tt[Ie],Ae,ue,ve),oe.push(Ae)}}function tr(tt){return tt/360+.5}function Bt(tt){const oe=Math.sin(tt*Math.PI/180),ue=.5-.25*Math.log((1+oe)/(1-oe))/Math.PI;return ue<0?0:ue>1?1:ue}function Or(tt,oe,ue,ve,Ie,Ae,De,Ye){if(ve/=oe,Ae>=(ue/=oe)&&De<ve)return tt;if(De<ue||Ae>=ve)return null;const ze=[];for(const Qe of tt){const st=Qe.geometry;let et=Qe.type;const wt=Ie===0?Qe.minX:Qe.minY,Lt=Ie===0?Qe.maxX:Qe.maxY;if(wt>=ue&&Lt<ve){ze.push(Qe);continue}if(Lt<ue||wt>=ve)continue;let Vt=[];if(et==="Point"||et==="MultiPoint")Xn(st,Vt,ue,ve,Ie);else if(et==="LineString")Bn(st,Vt,ue,ve,Ie,!1,Ye.lineMetrics);else if(et==="MultiLineString")ms(st,Vt,ue,ve,Ie,!1);else if(et==="Polygon")ms(st,Vt,ue,ve,Ie,!0);else if(et==="MultiPolygon")for(const Cr of st){const kr=[];ms(Cr,kr,ue,ve,Ie,!0),kr.length&&Vt.push(kr)}if(Vt.length){if(Ye.lineMetrics&&et==="LineString"){for(const Cr of Vt)ze.push(os(Qe.id,et,Cr,Qe.tags));continue}et!=="LineString"&&et!=="MultiLineString"||(Vt.length===1?(et="LineString",Vt=Vt[0]):et="MultiLineString"),et!=="Point"&&et!=="MultiPoint"||(et=Vt.length===3?"Point":"MultiPoint"),ze.push(os(Qe.id,et,Vt,Qe.tags))}}return ze.length?ze:null}function Xn(tt,oe,ue,ve,Ie){for(let Ae=0;Ae<tt.length;Ae+=3){const De=tt[Ae+Ie];De>=ue&&De<=ve&&Es(oe,tt[Ae],tt[Ae+1],tt[Ae+2])}}function Bn(tt,oe,ue,ve,Ie,Ae,De){let Ye=fi(tt);const ze=Ie===0?ra:Pa;let Qe,st,et=tt.start;for(let kr=0;kr<tt.length-3;kr+=3){const Nr=tt[kr],Dr=tt[kr+1],jn=tt[kr+2],ri=tt[kr+3],Vr=tt[kr+4],mn=Ie===0?Nr:Dr,gn=Ie===0?ri:Vr;let vn=!1;De&&(Qe=Math.sqrt(Math.pow(Nr-ri,2)+Math.pow(Dr-Vr,2))),mn<ue?gn>ue&&(st=ze(Ye,Nr,Dr,ri,Vr,ue),De&&(Ye.start=et+Qe*st)):mn>ve?gn<ve&&(st=ze(Ye,Nr,Dr,ri,Vr,ve),De&&(Ye.start=et+Qe*st)):Es(Ye,Nr,Dr,jn),gn<ue&&mn>=ue&&(st=ze(Ye,Nr,Dr,ri,Vr,ue),vn=!0),gn>ve&&mn<=ve&&(st=ze(Ye,Nr,Dr,ri,Vr,ve),vn=!0),!Ae&&vn&&(De&&(Ye.end=et+Qe*st),oe.push(Ye),Ye=fi(tt)),De&&(et+=Qe)}let wt=tt.length-3;const Lt=tt[wt],Vt=tt[wt+1],Cr=Ie===0?Lt:Vt;Cr>=ue&&Cr<=ve&&Es(Ye,Lt,Vt,tt[wt+2]),wt=Ye.length-3,Ae&&wt>=3&&(Ye[wt]!==Ye[0]||Ye[wt+1]!==Ye[1])&&Es(Ye,Ye[0],Ye[1],Ye[2]),Ye.length&&oe.push(Ye)}function fi(tt){const oe=[];return oe.size=tt.size,oe.start=tt.start,oe.end=tt.end,oe}function ms(tt,oe,ue,ve,Ie,Ae){for(const De of tt)Bn(De,oe,ue,ve,Ie,Ae,!1)}function Es(tt,oe,ue,ve){tt.push(oe,ue,ve)}function ra(tt,oe,ue,ve,Ie,Ae){const De=(Ae-oe)/(ve-oe);return Es(tt,Ae,ue+(Ie-ue)*De,1),De}function Pa(tt,oe,ue,ve,Ie,Ae){const De=(Ae-ue)/(Ie-ue);return Es(tt,oe+(ve-oe)*De,Ae,1),De}function co(tt,oe){const ue=[];for(let ve=0;ve<tt.length;ve++){const Ie=tt[ve],Ae=Ie.type;let De;if(Ae==="Point"||Ae==="MultiPoint"||Ae==="LineString")De=na(Ie.geometry,oe);else if(Ae==="MultiLineString"||Ae==="Polygon"){De=[];for(const Ye of Ie.geometry)De.push(na(Ye,oe))}else if(Ae==="MultiPolygon"){De=[];for(const Ye of Ie.geometry){const ze=[];for(const Qe of Ye)ze.push(na(Qe,oe));De.push(ze)}}ue.push(os(Ie.id,Ae,De,Ie.tags))}return ue}function na(tt,oe){const ue=[];ue.size=tt.size,tt.start!==void 0&&(ue.start=tt.start,ue.end=tt.end);for(let ve=0;ve<tt.length;ve+=3)ue.push(tt[ve]+oe,tt[ve+1],tt[ve+2]);return ue}function Xi(tt,oe){if(tt.transformed)return tt;const ue=1<<tt.z,ve=tt.x,Ie=tt.y;for(const Ae of tt.features){const De=Ae.geometry,Ye=Ae.type;if(Ae.geometry=[],Ye===1)for(let ze=0;ze<De.length;ze+=2)Ae.geometry.push(Vs(De[ze],De[ze+1],oe,ue,ve,Ie));else for(let ze=0;ze<De.length;ze++){const Qe=[];for(let st=0;st<De[ze].length;st+=2)Qe.push(Vs(De[ze][st],De[ze][st+1],oe,ue,ve,Ie));Ae.geometry.push(Qe)}}return tt.transformed=!0,tt}function Vs(tt,oe,ue,ve,Ie,Ae){return[Math.round(ue*(tt*ve-Ie)),Math.round(ue*(oe*ve-Ae))]}function Kn(tt,oe,ue,ve,Ie){const Ae=oe===Ie.maxZoom?0:Ie.tolerance/((1<<oe)*Ie.extent),De={features:[],numPoints:0,numSimplified:0,numFeatures:tt.length,source:null,x:ue,y:ve,z:oe,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ye of tt)hr(De,Ye,Ae,Ie);return De}function hr(tt,oe,ue,ve){const Ie=oe.geometry,Ae=oe.type,De=[];if(tt.minX=Math.min(tt.minX,oe.minX),tt.minY=Math.min(tt.minY,oe.minY),tt.maxX=Math.max(tt.maxX,oe.maxX),tt.maxY=Math.max(tt.maxY,oe.maxY),Ae==="Point"||Ae==="MultiPoint")for(let Ye=0;Ye<Ie.length;Ye+=3)De.push(Ie[Ye],Ie[Ye+1]),tt.numPoints++,tt.numSimplified++;else if(Ae==="LineString")Jn(De,Ie,tt,ue,!1,!1);else if(Ae==="MultiLineString"||Ae==="Polygon")for(let Ye=0;Ye<Ie.length;Ye++)Jn(De,Ie[Ye],tt,ue,Ae==="Polygon",Ye===0);else if(Ae==="MultiPolygon")for(let Ye=0;Ye<Ie.length;Ye++){const ze=Ie[Ye];for(let Qe=0;Qe<ze.length;Qe++)Jn(De,ze[Qe],tt,ue,!0,Qe===0)}if(De.length){let Ye=oe.tags||null;if(Ae==="LineString"&&ve.lineMetrics){Ye={};for(const Qe in oe.tags)Ye[Qe]=oe.tags[Qe];Ye.mapbox_clip_start=Ie.start/Ie.size,Ye.mapbox_clip_end=Ie.end/Ie.size}const ze={geometry:De,type:Ae==="Polygon"||Ae==="MultiPolygon"?3:Ae==="LineString"||Ae==="MultiLineString"?2:1,tags:Ye};oe.id!==null&&(ze.id=oe.id),tt.features.push(ze)}}function Jn(tt,oe,ue,ve,Ie,Ae){const De=ve*ve;if(ve>0&&oe.size<(Ie?De:ve))return void(ue.numPoints+=oe.length/3);const Ye=[];for(let ze=0;ze<oe.length;ze+=3)(ve===0||oe[ze+2]>De)&&(ue.numSimplified++,Ye.push(oe[ze],oe[ze+1])),ue.numPoints++;Ie&&function(ze,Qe){let st=0;for(let et=0,wt=ze.length,Lt=wt-2;et<wt;Lt=et,et+=2)st+=(ze[et]-ze[Lt])*(ze[et+1]+ze[Lt+1]);if(st>0===Qe)for(let et=0,wt=ze.length;et<wt/2;et+=2){const Lt=ze[et],Vt=ze[et+1];ze[et]=ze[wt-2-et],ze[et+1]=ze[wt-1-et],ze[wt-2-et]=Lt,ze[wt-1-et]=Vt}}(Ye,Ae),tt.push(Ye)}const Vn={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class xi{constructor(oe,ue){const ve=(ue=this.options=function(Ae,De){for(const Ye in De)Ae[Ye]=De[Ye];return Ae}(Object.create(Vn),ue)).debug;if(ve&&console.time("preprocess data"),ue.maxZoom<0||ue.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ue.promoteId&&ue.generateId)throw new Error("promoteId and generateId cannot be used together.");let Ie=function(Ae,De){const Ye=[];if(Ae.type==="FeatureCollection")for(let ze=0;ze<Ae.features.length;ze++)ut(Ye,Ae.features[ze],De,ze);else ut(Ye,Ae.type==="Feature"?Ae:{geometry:Ae},De);return Ye}(oe,ue);this.tiles={},this.tileCoords=[],ve&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ue.indexMaxZoom,ue.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ie=function(Ae,De){const Ye=De.buffer/De.extent;let ze=Ae;const Qe=Or(Ae,1,-1-Ye,Ye,0,-1,2,De),st=Or(Ae,1,1-Ye,2+Ye,0,-1,2,De);return(Qe||st)&&(ze=Or(Ae,1,-Ye,1+Ye,0,-1,2,De)||[],Qe&&(ze=co(Qe,1).concat(ze)),st&&(ze=ze.concat(co(st,-1)))),ze}(Ie,ue),Ie.length&&this.splitTile(Ie,0,0,0),ve&&(Ie.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(oe,ue,ve,Ie,Ae,De,Ye){const ze=[oe,ue,ve,Ie],Qe=this.options,st=Qe.debug;for(;ze.length;){Ie=ze.pop(),ve=ze.pop(),ue=ze.pop(),oe=ze.pop();const et=1<<ue,wt=gs(ue,ve,Ie);let Lt=this.tiles[wt];if(!Lt&&(st>1&&console.time("creation"),Lt=this.tiles[wt]=Kn(oe,ue,ve,Ie,Qe),this.tileCoords.push({z:ue,x:ve,y:Ie}),st)){st>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ue,ve,Ie,Lt.numFeatures,Lt.numPoints,Lt.numSimplified),console.timeEnd("creation"));const vn=`z${ue}`;this.stats[vn]=(this.stats[vn]||0)+1,this.total++}if(Lt.source=oe,Ae==null){if(ue===Qe.indexMaxZoom||Lt.numPoints<=Qe.indexMaxPoints)continue}else{if(ue===Qe.maxZoom||ue===Ae)continue;if(Ae!=null){const vn=Ae-ue;if(ve!==De>>vn||Ie!==Ye>>vn)continue}}if(Lt.source=null,oe.length===0)continue;st>1&&console.time("clipping");const Vt=.5*Qe.buffer/Qe.extent,Cr=.5-Vt,kr=.5+Vt,Nr=1+Vt;let Dr=null,jn=null,ri=null,Vr=null,mn=Or(oe,et,ve-Vt,ve+kr,0,Lt.minX,Lt.maxX,Qe),gn=Or(oe,et,ve+Cr,ve+Nr,0,Lt.minX,Lt.maxX,Qe);oe=null,mn&&(Dr=Or(mn,et,Ie-Vt,Ie+kr,1,Lt.minY,Lt.maxY,Qe),jn=Or(mn,et,Ie+Cr,Ie+Nr,1,Lt.minY,Lt.maxY,Qe),mn=null),gn&&(ri=Or(gn,et,Ie-Vt,Ie+kr,1,Lt.minY,Lt.maxY,Qe),Vr=Or(gn,et,Ie+Cr,Ie+Nr,1,Lt.minY,Lt.maxY,Qe),gn=null),st>1&&console.timeEnd("clipping"),ze.push(Dr||[],ue+1,2*ve,2*Ie),ze.push(jn||[],ue+1,2*ve,2*Ie+1),ze.push(ri||[],ue+1,2*ve+1,2*Ie),ze.push(Vr||[],ue+1,2*ve+1,2*Ie+1)}}getTile(oe,ue,ve){oe=+oe,ue=+ue,ve=+ve;const Ie=this.options,{extent:Ae,debug:De}=Ie;if(oe<0||oe>24)return null;const Ye=1<<oe,ze=gs(oe,ue=ue+Ye&Ye-1,ve);if(this.tiles[ze])return Xi(this.tiles[ze],Ae);De>1&&console.log("drilling down to z%d-%d-%d",oe,ue,ve);let Qe,st=oe,et=ue,wt=ve;for(;!Qe&&st>0;)st--,et>>=1,wt>>=1,Qe=this.tiles[gs(st,et,wt)];return Qe&&Qe.source?(De>1&&(console.log("found parent tile z%d-%d-%d",st,et,wt),console.time("drilling down")),this.splitTile(Qe.source,st,et,wt,oe,ue,ve),De>1&&console.timeEnd("drilling down"),this.tiles[ze]?Xi(this.tiles[ze],Ae):null):null}}function gs(tt,oe,ue){return 32*((1<<tt)*ue+oe)+tt}function Ia(tt,oe){const ue=tt.tileID.canonical;if(!this._geoJSONIndex)return void oe(null,null);const ve=this._geoJSONIndex.getTile(ue.z,ue.x,ue.y);if(!ve)return void oe(null,null);const Ie=new it(ve.features);let Ae=mr(Ie);Ae.byteOffset===0&&Ae.byteLength===Ae.buffer.byteLength||(Ae=new Uint8Array(Ae)),oe(null,{vectorTile:Ie,rawData:Ae.buffer})}class ql extends ce{constructor(oe,ue,ve,Ie,Ae,De){super(oe,ue,ve,Ie,Ia,De),Ae&&(this.loadGeoJSON=Ae),this._dynamicIndex=new pt}loadData(oe,ue){const ve=oe&&oe.request,Ie=ve&&ve.collectResourceTiming;this.loadGeoJSON(oe,(Ae,De)=>{if(Ae||!De)return ue(Ae);if(typeof De!="object")return ue(new Error(`Input data given to '${oe.source}' is not a valid GeoJSON object.`));{try{if(oe.filter){const ze=s.X(oe.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ze.result==="error")throw new Error(ze.value.map(Qe=>`${Qe.key}: ${Qe.message}`).join(", "));De.features=De.features.filter(Qe=>ze.value.evaluate({zoom:0},Qe))}oe.dynamic?(De.type==="Feature"&&(De={type:"FeatureCollection",features:[De]}),oe.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(De.features,this.loaded),oe.cluster&&(De.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=oe.cluster?new xn(function({superclusterOptions:ze,clusterProperties:Qe}){if(!Qe||!ze)return ze;const st={},et={},wt={accumulated:null,zoom:0},Lt={properties:null},Vt=Object.keys(Qe);for(const Cr of Vt){const[kr,Nr]=Qe[Cr],Dr=s.X(Nr),jn=s.X(typeof kr=="string"?[kr,["accumulated"],["get",Cr]]:kr);st[Cr]=Dr.value,et[Cr]=jn.value}return ze.map=Cr=>{Lt.properties=Cr;const kr={};for(const Nr of Vt)kr[Nr]=st[Nr].evaluate(wt,Lt);return kr},ze.reduce=(Cr,kr)=>{Lt.properties=kr;for(const Nr of Vt)wt.accumulated=Cr[Nr],Cr[Nr]=et[Nr].evaluate(wt,Lt)},ze}(oe)).load(De.features):oe.dynamic?this._dynamicIndex:function(ze,Qe){return new xi(ze,Qe)}(De,oe.geojsonVtOptions)}catch(ze){return ue(ze)}const Ye={};if(Ie){const ze=N(ve);ze&&(Ye.resourceTiming={},Ye.resourceTiming[oe.source]=JSON.parse(JSON.stringify(ze)))}ue(null,Ye)}})}reloadTile(oe,ue){const ve=this.loaded;return ve&&ve[oe.uid]?oe.partial?ue(null,void 0):super.reloadTile(oe,ue):this.loadTile(oe,ue)}loadGeoJSON(oe,ue){if(oe.request)s.n(oe.request,ue);else{if(typeof oe.data!="string")return ue(new Error(`Input data given to '${oe.source}' is not a valid GeoJSON object.`));try{return ue(null,JSON.parse(oe.data))}catch{return ue(new Error(`Input data given to '${oe.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(oe,ue){try{ue(null,this._geoJSONIndex.getClusterExpansionZoom(oe.clusterId))}catch(ve){ue(ve)}}getClusterChildren(oe,ue){try{ue(null,this._geoJSONIndex.getChildren(oe.clusterId))}catch(ve){ue(ve)}}getClusterLeaves(oe,ue){try{ue(null,this._geoJSONIndex.getLeaves(oe.clusterId,oe.limit,oe.offset))}catch(ve){ue(ve)}}}class op{constructor(oe,ue){this.tileID=new s.aH(oe.tileID.overscaledZ,oe.tileID.wrap,oe.tileID.canonical.z,oe.tileID.canonical.x,oe.tileID.canonical.y),this.tileZoom=oe.tileZoom,this.uid=oe.uid,this.zoom=oe.zoom,this.canonical=oe.tileID.canonical,this.pixelRatio=oe.pixelRatio,this.tileSize=oe.tileSize,this.source=oe.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=oe.projection,this.brightness=ue}parse(oe,ue,ve,Ie){this.status="parsing";const Ae=new s.aH(ve.tileID.overscaledZ,ve.tileID.wrap,ve.tileID.canonical.z,ve.tileID.canonical.x,ve.tileID.canonical.y),De=[],Ye=ue.familiesBySource[ve.source],ze=new s.e0(Ae,ve.promoteId);return ze.bucketLayerIDs=[],ze.is3DTile=!0,s.ei(oe).then(Qe=>{if(!Qe)return Ie(new Error("Could not parse tile"));const st=s.ej(Qe,1/s.cd(ve.tileID.canonical)),et=Qe.json.extensionsUsed&&Qe.json.extensionsUsed.includes("MAPBOX_mesh_features")||Qe.json.asset.extras&&Qe.json.asset.extras.MAPBOX_mesh_features,wt=Qe.json.extensionsUsed&&Qe.json.extensionsUsed.includes("EXT_meshopt_compression"),Lt=new s.aa(this.zoom,{brightness:this.brightness});for(const Vt in Ye)for(const Cr of Ye[Vt]){const kr=Cr[0];ze.bucketLayerIDs.push(Cr.map(Dr=>s.C(Dr.id,Dr.scope))),kr.recalculate(Lt,[]);const Nr=new s.ek(Cr,st,Ae,et,wt,this.brightness,ze);et||(Nr.needsUpload=!0),De.push(Nr),Nr.evaluate(kr)}this.status="done",Ie(null,{buckets:De,featureIndex:ze,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Qe=>Ie(new Error(Qe.message)))}}class ap{constructor(oe,ue,ve,Ie,Ae,De){this.actor=oe,this.layerIndex=ue,this.availableImages=ve,this.brightness=De,this.loading={},this.loaded={}}loadTile(oe,ue){const ve=oe.uid,Ie=this.loading[ve]=new op(oe,this.brightness);s.bj(oe.request,(Ae,De)=>{const Ye=!this.loading[ve];return delete this.loading[ve],Ye||Ae?(Ie.status="done",Ye||(this.loaded[ve]=Ie),ue(Ae)):De&&De.byteLength!==0?void Ie.parse(De,this.layerIndex,oe,(ze,Qe)=>{Ie.status="done",this.loaded=this.loaded||{},this.loaded[ve]=Ie,ze||!Qe?ue(ze):ue(null,Qe)}):(Ie.status="done",this.loaded[ve]=Ie,ue())})}reloadTile(oe,ue){const ve=this.loaded,Ie=oe.uid;if(ve&&ve[Ie]){const Ae=ve[Ie];Ae.projection=oe.projection,Ae.brightness=oe.brightness;const De=(Ye,ze)=>{Ae.reloadCallback&&(delete Ae.reloadCallback,this.loadTile(oe,ue)),ue(Ye,ze)};Ae.status==="parsing"?Ae.reloadCallback=De:Ae.status==="done"&&this.loadTile(oe,ue)}}abortTile(oe,ue){const ve=oe.uid;this.loading[ve]&&delete this.loading[ve],ue()}removeTile(oe,ue){const ve=this.loaded,Ie=oe.uid;ve&&ve[Ie]&&delete ve[Ie],ue()}}class Sh{constructor(oe){this.self=oe,this.actor=new s.el(oe,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.imageRasterizer=new s.y,this.projections={},this.defaultProjection=s.bP({name:"mercator"}),this.workerSourceTypes={vector:ce,geojson:ql,"raster-dem":le,"raster-array":he,"batched-model":ap},this.workerSources={},this.self.registerWorkerSource=(ue,ve)=>{if(this.workerSourceTypes[ue])throw new Error(`Worker source with name "${ue}" already registered.`);this.workerSourceTypes[ue]=ve},this.self.registerRTLTextPlugin=ue=>{if(s.em.isParsed())throw new Error("RTL text plugin already registered.");s.em.applyArabicShaping=ue.applyArabicShaping,s.em.processBidirectionalText=ue.processBidirectionalText,s.em.processStyledBidirectionalText=ue.processStyledBidirectionalText}}clearCaches(oe,ue,ve){delete this.layerIndexes[oe],delete this.availableImages[oe],delete this.workerSources[oe],ve()}checkIfReady(oe,ue,ve){ve()}setReferrer(oe,ue){this.referrer=ue}spriteLoaded(oe,{scope:ue,isLoaded:ve}){if(this.isSpriteLoaded[oe]||(this.isSpriteLoaded[oe]={}),this.isSpriteLoaded[oe][ue]=ve,this.workerSources[oe]&&this.workerSources[oe][ue])for(const Ie in this.workerSources[oe][ue]){const Ae=this.workerSources[oe][ue][Ie];for(const De in Ae){const Ye=Ae[De];Ye instanceof ce&&(Ye.isSpriteLoaded=ve,Ye.fire(new s.A("isSpriteLoaded")))}}}setImages(oe,{scope:ue,images:ve},Ie){if(this.availableImages[oe]||(this.availableImages[oe]={}),this.availableImages[oe][ue]=ve,this.workerSources[oe]&&this.workerSources[oe][ue]){for(const Ae in this.workerSources[oe][ue]){const De=this.workerSources[oe][ue][Ae];for(const Ye in De)De[Ye].availableImages=ve}Ie()}else Ie()}setProjection(oe,ue){this.projections[oe]=s.bP(ue)}setBrightness(oe,ue,ve){this.brightness=ue,ve()}setLayers(oe,ue,ve){this.getLayerIndex(oe,ue.scope).replace(ue.layers,ue.options),ve()}updateLayers(oe,ue,ve){this.getLayerIndex(oe,ue.scope).update(ue.layers,ue.removedIds,ue.options),ve()}loadTile(oe,ue,ve){ue.projection=this.projections[oe]||this.defaultProjection,this.getWorkerSource(oe,ue.type,ue.source,ue.scope).loadTile(ue,ve)}decodeRasterArray(oe,ue,ve){this.getWorkerSource(oe,ue.type,ue.source,ue.scope).decodeRasterArray(ue,ve)}reloadTile(oe,ue,ve){ue.projection=this.projections[oe]||this.defaultProjection,this.getWorkerSource(oe,ue.type,ue.source,ue.scope).reloadTile(ue,ve)}abortTile(oe,ue,ve){this.getWorkerSource(oe,ue.type,ue.source,ue.scope).abortTile(ue,ve)}removeTile(oe,ue,ve){this.getWorkerSource(oe,ue.type,ue.source,ue.scope).removeTile(ue,ve)}removeSource(oe,ue,ve){if(!(this.workerSources[oe]&&this.workerSources[oe][ue.scope]&&this.workerSources[oe][ue.scope][ue.type]&&this.workerSources[oe][ue.scope][ue.type][ue.source]))return;const Ie=this.workerSources[oe][ue.scope][ue.type][ue.source];delete this.workerSources[oe][ue.scope][ue.type][ue.source],Ie.removeSource!==void 0?Ie.removeSource(ue,ve):ve()}loadWorkerSource(oe,ue,ve){try{this.self.importScripts(ue.url),ve()}catch(Ie){ve(Ie.toString())}}syncRTLPluginState(oe,ue,ve){try{s.em.setState(ue);const Ie=s.em.getPluginURL();if(s.em.isLoaded()&&!s.em.isParsed()&&Ie!=null){this.self.importScripts(Ie);const Ae=s.em.isParsed();ve(Ae?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Ie}`),Ae)}}catch(Ie){ve(Ie.toString())}}setDracoUrl(oe,ue){this.dracoUrl=ue}getAvailableImages(oe,ue){this.availableImages[oe]||(this.availableImages[oe]={});let ve=this.availableImages[oe][ue];return ve||(ve=[]),ve}getLayerIndex(oe,ue){this.layerIndexes[oe]||(this.layerIndexes[oe]={});let ve=this.layerIndexes[oe][ue];return ve||(ve=this.layerIndexes[oe][ue]=new $,ve.scope=ue),ve}getWorkerSource(oe,ue,ve,Ie){const Ae=this.workerSources;return Ae[oe]||(Ae[oe]={}),Ae[oe][Ie]||(Ae[oe][Ie]={}),Ae[oe][Ie][ue]||(Ae[oe][Ie][ue]={}),this.isSpriteLoaded[oe]||(this.isSpriteLoaded[oe]={}),Ae[oe][Ie][ue][ve]||(Ae[oe][Ie][ue][ve]=new this.workerSourceTypes[ue]({send:(De,Ye,ze,Qe,st,et)=>{this.actor.send(De,Ye,ze,oe,st,et)},scheduler:this.actor.scheduler},this.getLayerIndex(oe,Ie),this.getAvailableImages(oe,Ie),this.isSpriteLoaded[oe][Ie],void 0,this.brightness)),Ae[oe][Ie][ue][ve]}rasterizeImages(oe,ue,ve){const Ie=new Map;for(const[Ae,{image:De,imageVariant:Ye}]of ue.tasks.entries()){const ze=this.imageRasterizer.rasterize(Ye,De,ue.scope,oe);Ie.set(Ae,ze)}ve(void 0,Ie)}removeRasterizedImages(oe,ue,ve){this.imageRasterizer.removeImagesFromCacheByIds(ue.imageIds,ue.scope,oe),ve()}enforceCacheSizeLimit(oe,ue){s.en(ue)}getWorkerPerformanceMetrics(oe,ue,ve){ve(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Sh(self)),Sh}),y(["./shared"],function(s){var N="3.11.1";const D={create:"create",load:"load",fullLoad:"fullLoad"},O={mark(g){performance.mark(g)},measure(g,n,l){performance.measure(g,n,l)}};function $(g){const n=g.name.split("?")[0];return s.a(n)&&n.includes("mapbox-gl.js")?"javascript":s.a(n)&&n.includes("mapbox-gl.css")?"css":s.b(n)?"fontRange":s.c(n)?"sprite":s.i(n)?"style":s.d(n)?"tilejson":"other"}var q,J={},re=function(){if(q)return J;function g(m){return!n(m)}function n(m){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var b,T,k=new Blob([""],{type:"text/javascript"}),j=URL.createObjectURL(k);try{T=new Worker(j),b=!0}catch{b=!1}return T&&T.terminate(),URL.revokeObjectURL(j),b}()?function(){var b=document.createElement("canvas");b.width=b.height=1;var T=b.getContext("2d");if(!T)return!1;var k=T.getImageData(0,0,1,1);return k&&k.width===b.width}()?(l[x=m&&m.failIfMajorPerformanceCaveat]===void 0&&(l[x]=function(b){var T,k=function(j){var L=document.createElement("canvas"),z=Object.create(g.webGLContextAttributes);return z.failIfMajorPerformanceCaveat=j,L.getContext("webgl2",z)}(b);if(!k)return!1;try{T=k.createShader(k.VERTEX_SHADER)}catch{return!1}return!(!T||k.isContextLost())&&(k.shaderSource(T,"void main() {}"),k.compileShader(T),k.getShaderParameter(T,k.COMPILE_STATUS)===!0)}(x)),l[x]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var x}q=1,J.supported=g,J.notSupportedReason=n;var l={};return g.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},J}();function Q(g,n,l){const m=document.createElement(g);return n!=null&&(m.className=n),l&&l.appendChild(m),m}function ce(g,n,l){const m=document.createElementNS("http://www.w3.org/2000/svg",g);for(const x of Object.keys(n))m.setAttributeNS(null,x,String(n[x]));return l&&l.appendChild(m),m}const le=typeof document<"u"?document.documentElement&&document.documentElement.style:null,ae=le&&le.userSelect!==void 0?"userSelect":"WebkitUserSelect";let he;function Se(){le&&ae&&(he=le[ae],le[ae]="none")}function je(){le&&ae&&(le[ae]=he)}function it(g){g.preventDefault(),g.stopPropagation(),window.removeEventListener("click",it,!0)}function qe(){window.addEventListener("click",it,!0),window.setTimeout(()=>{window.removeEventListener("click",it,!0)},0)}function ct(g,n){const l=g.getBoundingClientRect();return yt(g,l,n)}function pt(g,n){const l=g.getBoundingClientRect(),m=[];for(let x=0;x<n.length;x++)m.push(yt(g,l,n[x]));return m}function Ze(g){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&g.button===2&&g.ctrlKey?0:g.button}function yt(g,n,l){const m=g.offsetWidth===n.width?1:g.offsetWidth/n.width;return new s.P((l.clientX-n.left)*m,(l.clientY-n.top)*m)}const Mt="01",Jt="NO_ACCESS_TOKEN";class jt{constructor(n,l,m){this._transformRequestFn=n,this._customAccessToken=l,this._silenceAuthErrors=!!m,this._createSkuToken()}_createSkuToken(){const n=function(){let l="";for(let m=0;m<10;m++)l+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Mt,l].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(n,l){return this._transformRequestFn&&this._transformRequestFn(n,l)||{url:n}}normalizeStyleURL(n,l){if(!s.f(n))return n;const m=Wt(n);return m.params.push(`sdk=js-${N}`),m.path=`/styles/v1${m.path}`,this._makeAPIURL(m,this._customAccessToken||l)}normalizeGlyphsURL(n,l){if(!s.f(n))return n;const m=Wt(n);return m.path=`/fonts/v1${m.path}`,this._makeAPIURL(m,this._customAccessToken||l)}normalizeModelURL(n,l){if(!s.f(n))return n;const m=Wt(n);return m.path=`/models/v1${m.path}`,this._makeAPIURL(m,this._customAccessToken||l)}normalizeSourceURL(n,l,m,x){if(!s.f(n))return n;const b=Wt(n);return b.path=`/v4/${b.authority}.json`,b.params.push("secure"),m&&b.params.push(`language=${m}`),x&&b.params.push(`worldview=${x}`),this._makeAPIURL(b,this._customAccessToken||l)}normalizeIconsetURL(n,l){const m=Wt(n);return s.f(n)?(m.path=`/styles/v1${m.path}/iconset.pbf`,this._makeAPIURL(m,this._customAccessToken||l)):Nt(m)}normalizeSpriteURL(n,l,m,x){const b=Wt(n);return s.f(n)?(b.path=`/styles/v1${b.path}/sprite${l}${m}`,this._makeAPIURL(b,this._customAccessToken||x)):(b.path+=`${l}${m}`,Nt(b))}normalizeTileURL(n,l,m){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!s.f(n))return n;const x=Wt(n);x.path=x.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${l||m&&x.authority!=="raster"&&m===512?"@2x":""}${s.m.supported?".webp":"$1"}`),x.authority==="raster"?x.path=`/${s.e.RASTER_URL_PREFIX}${x.path}`:x.authority==="rasterarrays"?x.path=`/${s.e.RASTERARRAYS_URL_PREFIX}${x.path}`:x.authority==="3dtiles"?x.path=`/${s.e.TILES3D_URL_PREFIX}${x.path}`:(x.path=x.path.replace(/^.+\/v4\//,"/"),x.path=`/${s.e.TILE_URL_VERSION}${x.path}`);const b=this._customAccessToken||function(T){for(const k of T){const j=k.match(/^access_token=(.*)$/);if(j)return j[1]}return null}(x.params)||s.e.ACCESS_TOKEN;return s.e.REQUIRE_ACCESS_TOKEN&&b&&this._skuToken&&x.params.push(`sku=${this._skuToken}`),this._makeAPIURL(x,b)}canonicalizeTileURL(n,l){const m=Wt(n);if(!m.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!m.path.match(/\.[\w]+$/))return n;let x="mapbox://";m.path.match(/^\/raster\/v1\//)?x+=`raster/${m.path.replace(`/${s.e.RASTER_URL_PREFIX}/`,"")}`:m.path.match(/^\/rasterarrays\/v1\//)?x+=`rasterarrays/${m.path.replace(`/${s.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:x+=`tiles/${m.path.replace(`/${s.e.TILE_URL_VERSION}/`,"")}`;let b=m.params;return l&&(b=b.filter(T=>!T.match(/^access_token=/))),b.length&&(x+=`?${b.join("&")}`),x}canonicalizeTileset(n,l){const m=!!l&&s.f(l),x=[];for(const b of n.tiles||[])s.h(b)?x.push(this.canonicalizeTileURL(b,m)):x.push(b);return x}_makeAPIURL(n,l){const m="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",x=Wt(s.e.API_URL);if(n.protocol=x.protocol,n.authority=x.authority,n.protocol==="http"){const b=n.params.indexOf("secure");b>=0&&n.params.splice(b,1)}if(x.path!=="/"&&(n.path=`${x.path}${n.path}`),!s.e.REQUIRE_ACCESS_TOKEN)return Nt(n);if(l=l||s.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!l)throw new Error(`An API access token is required to use Mapbox GL. ${m}`);if(l[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${m}`)}return n.params=n.params.filter(b=>b.indexOf("access_token")===-1),n.params.push(`access_token=${l||""}`),Nt(n)}}const Pt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Wt(g){const n=g.match(Pt);if(!n)throw new Error("Unable to parse URL object");return{protocol:n[1],authority:n[2],path:n[3]||"/",params:n[4]?n[4].split("&"):[]}}function Nt(g){const n=g.params.length?`?${g.params.join("&")}`:"";return`${g.protocol}://${g.authority}${g.path}${n}`}const Xe="mapbox.eventData";function nt(g){if(!g)return null;const n=g.split(".");if(!n||n.length!==3)return null;try{return JSON.parse(s.j(n[1]))}catch{return null}}class Qt{constructor(n){this.type=n,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(n){const l=nt(s.e.ACCESS_TOKEN);let m="";return m=l&&l.u?s.k(l.u):s.e.ACCESS_TOKEN||"",n?`${Xe}.${n}:${m}`:`${Xe}:${m}`}fetchEventData(){const n=s.s("localStorage"),l=this.getStorageKey(),m=this.getStorageKey("uuid");if(n)try{const x=localStorage.getItem(l);x&&(this.eventData=JSON.parse(x));const b=localStorage.getItem(m);b&&(this.anonId=b)}catch{s.w("Unable to read from LocalStorage")}}saveEventData(){const n=s.s("localStorage"),l=this.getStorageKey(),m=this.getStorageKey("uuid"),x=this.anonId;if(n&&x)try{localStorage.setItem(m,x),Object.keys(this.eventData).length>=1&&localStorage.setItem(l,JSON.stringify(this.eventData))}catch{s.w("Unable to write to LocalStorage")}}processRequests(n){}postEvent(n,l,m,x){if(!s.e.EVENTS_URL)return;const b=Wt(s.e.EVENTS_URL);b.params.push(`access_token=${x||s.e.ACCESS_TOKEN||""}`);const T={event:this.type,created:new Date(n).toISOString()},k=l?s.l(T,l):T,j={url:Nt(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([k])};this.pendingRequest=s.p(j,L=>{this.pendingRequest=null,m(L),this.saveEventData(),this.processRequests(x)})}queueRequest(n,l){this.queue.push(n),this.processRequests(l)}}const rr=new class extends Qt{constructor(g){super("appUserTurnstile"),this._customAccessToken=g}postTurnstileEvent(g,n){s.e.EVENTS_URL&&s.e.ACCESS_TOKEN&&Array.isArray(g)&&g.some(l=>s.f(l)||s.h(l))&&this.queueRequest(Date.now(),n)}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const n=nt(s.e.ACCESS_TOKEN),l=n?n.u:s.e.ACCESS_TOKEN;let m=l!==this.eventData.tokenU;s.v(this.anonId)||(this.anonId=s.u(),m=!0);const x=this.queue.shift();if(this.eventData.lastSuccess){const b=new Date(this.eventData.lastSuccess),T=new Date(x),k=(x-this.eventData.lastSuccess)/864e5;m=m||k>=1||k<-1||b.getDate()!==T.getDate()}else m=!0;m?this.postEvent(x,{sdkIdentifier:"mapbox-gl-js",sdkVersion:N,skuId:Mt,"enabled.telemetry":!1,userId:this.anonId},b=>{b||(this.eventData.lastSuccess=x,this.eventData.tokenU=l)},g):this.processRequests()}},mr=rr.postTurnstileEvent.bind(rr),Ut=new class extends Qt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(g,n,l,m){this.skuToken=n,this.errorCb=m,s.e.EVENTS_URL&&(l||s.e.ACCESS_TOKEN?this.queueRequest({id:g,timestamp:Date.now()},l):this.errorCb(new Error(Jt)))}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:l}=this.queue.shift();n&&this.success[n]||(this.anonId||this.fetchEventData(),s.v(this.anonId)||(this.anonId=s.u()),this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:N,skuId:Mt,skuToken:this.skuToken,userId:this.anonId},m=>{m?this.errorCb(m):n&&(this.success[n]=!0)},g))}remove(){this.errorCb=null}},hn=Ut.postMapLoadEvent.bind(Ut),Gn=new class extends Qt{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(g){let n=this.mapInstanceIdMap.get(g);return n||(n=s.u(),this.mapInstanceIdMap.set(g,n)),n}getEventId(g){const n=this.eventIdPerMapInstanceMap.get(g)||0;return this.eventIdPerMapInstanceMap.set(g,n+1),n}postStyleLoadEvent(g,n){const{map:l,style:m,importedStyles:x}=n;if(!s.e.EVENTS_URL||!g&&!s.e.ACCESS_TOKEN)return;const b=this.getMapInstanceId(l),T={mapInstanceId:b,eventId:this.getEventId(b),style:m};x.length&&(T.importedStyles=x),this.queueRequest({timestamp:Date.now(),payload:T},g)}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,payload:l}=this.queue.shift();this.postEvent(n,l,()=>{},g)}},At=Gn.postStyleLoadEvent.bind(Gn),qt=new class extends Qt{constructor(){super("gljs.performance")}postPerformanceEvent(g,n){s.e.EVENTS_URL&&(g||s.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:n},g)}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,performanceData:l}=this.queue.shift(),m=function(x){const b=performance.getEntriesByType("resource"),T=performance.getEntriesByType("mark"),k=function(Y){const te={};if(Y){for(const K in Y)if(K!=="other")for(const ne of Y[K]){const se=`${K}ResolveRangeMin`,me=`${K}ResolveRangeMax`,xe=`${K}RequestCount`,ye=`${K}RequestCachedCount`;te[se]=Math.min(te[se]||1/0,ne.startTime),te[me]=Math.max(te[me]||-1/0,ne.responseEnd);const Ee=be=>{te[be]===void 0&&(te[be]=0),++te[be]};ne.transferSize!==void 0&&ne.transferSize===0&&Ee(ye),Ee(xe)}}return te}(function(Y,te){const K={};if(Y)for(const ne of Y){const se=te(ne);K[se]===void 0&&(K[se]=[]),K[se].push(ne)}return K}(b,$)),j=window.devicePixelRatio,L=navigator.connection||navigator.mozConnection||navigator.webkitConnection,z=L?L.effectiveType:void 0,U={counters:[],metadata:[],attributes:[]},V=(Y,te,K)=>{K!=null&&Y.push({name:te,value:K.toString()})};for(const Y in k)V(U.counters,Y,k[Y]);if(x.interactionRange[0]!==1/0&&x.interactionRange[1]!==-1/0&&(V(U.counters,"interactionRangeMin",x.interactionRange[0]),V(U.counters,"interactionRangeMax",x.interactionRange[1])),T)for(const Y of Object.keys(D)){const te=D[Y],K=T.find(ne=>ne.name===te);K&&V(U.counters,te,K.startTime)}return V(U.counters,"visibilityHidden",x.visibilityHidden),V(U.attributes,"style",function(Y){if(Y)for(const te of Y){const K=te.name.split("?")[0];if(s.i(K)){const ne=K.split("/").slice(-2);if(ne.length===2)return`mapbox://styles/${ne[0]}/${ne[1]}`}}}(b)),V(U.attributes,"terrainEnabled",x.terrainEnabled?"true":"false"),V(U.attributes,"fogEnabled",x.fogEnabled?"true":"false"),V(U.attributes,"projection",x.projection),V(U.attributes,"zoom",x.zoom),V(U.metadata,"devicePixelRatio",j),V(U.metadata,"connectionEffectiveType",z),V(U.metadata,"navigatorUserAgent",navigator.userAgent),V(U.metadata,"screenWidth",window.screen.width),V(U.metadata,"screenHeight",window.screen.height),V(U.metadata,"windowWidth",window.innerWidth),V(U.metadata,"windowHeight",window.innerHeight),V(U.metadata,"mapWidth",x.width/j),V(U.metadata,"mapHeight",x.height/j),V(U.metadata,"webglRenderer",x.renderer),V(U.metadata,"webglVendor",x.vendor),V(U.metadata,"sdkVersion",N),V(U.metadata,"sdkIdentifier","mapbox-gl-js"),U}(l);for(const x of m.metadata);for(const x of m.counters);for(const x of m.attributes);this.postEvent(n,m,()=>{},g)}},Br=qt.postPerformanceEvent.bind(qt),xn=new class extends Qt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(g,n,l,m){if(!s.e.API_URL||!s.e.SESSION_PATH)return;const x=Wt(s.e.API_URL+s.e.SESSION_PATH);x.params.push(`sku=${n||""}`),x.params.push(`access_token=${m||s.e.ACCESS_TOKEN||""}`);const b={url:Nt(x),headers:{"Content-Type":"text/plain"}};this.pendingRequest=s.g(b,T=>{this.pendingRequest=null,l(T),this.saveEventData(),this.processRequests(m)})}getSessionAPI(g,n,l,m){this.skuToken=n,this.errorCb=m,s.e.SESSION_PATH&&s.e.API_URL&&(l||s.e.ACCESS_TOKEN?this.queueRequest({id:g,timestamp:Date.now()},l):this.errorCb(new Error(Jt)))}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:l}=this.queue.shift();n&&this.success[n]||this.getSession(l,this.skuToken,m=>{m?this.errorCb(m):n&&(this.success[n]=!0)},g)}remove(){this.errorCb=null}},de=xn.getSessionAPI.bind(xn),bn=new Set;function pn(g,n){n?bn.add(g):bn.delete(g)}class hi{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(n,l){this._updatedSourceCaches[n]=l,this.setDirty()}discardSourceCacheUpdate(n){delete this._updatedSourceCaches[n]}updateLayer(n){const l=n.scope;this._updatedLayers[l]=this._updatedLayers[l]||new Set,this._updatedLayers[l].add(n.id),this.setDirty()}removeLayer(n){const l=n.scope;this._removedLayers[l]=this._removedLayers[l]||{},this._updatedLayers[l]=this._updatedLayers[l]||new Set,this._removedLayers[l][n.id]=n,this._updatedLayers[l].delete(n.id),this._updatedPaintProps.delete(n.fqid),this.setDirty()}getRemovedLayer(n){return this._removedLayers[n.scope]?this._removedLayers[n.scope][n.id]:null}discardLayerRemoval(n){this._removedLayers[n.scope]&&delete this._removedLayers[n.scope][n.id]}getLayerUpdatesByScope(){const n={};for(const l in this._updatedLayers)n[l]=n[l]||{},n[l].updatedIds=Array.from(this._updatedLayers[l].values());for(const l in this._removedLayers)n[l]=n[l]||{},n[l].removedIds=Object.keys(this._removedLayers[l]);return n}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(n){this._updatedPaintProps.add(n.fqid),this.setDirty()}getUpdatedImages(n){return this._updatedImages[n]?Array.from(this._updatedImages[n].values()):[]}updateImage(n,l){this._updatedImages[l]=this._updatedImages[l]||new Set,this._updatedImages[l].add(s.I.toString(n)),this.setDirty()}resetUpdatedImages(n){this._updatedImages[n]&&this._updatedImages[n].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function bt(g){const{userImage:n}=g;return!!(n&&n.render&&n.render())&&(g.data.replace(new Uint8Array(n.data.buffer)),!0)}class Vi extends s.E{constructor(n){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=n,n!=="raster"&&s.t()&&(this.imageRasterizerDispatcher=new s.D(s.x(),this,"Image Rasterizer Worker",1))}addScope(n){this.loaded.set(n,!1),this.imageProviders.set(n,new Map),this.images.set(n,new Map),this.updatedImages.set(n,new Set),this.callbackDispatchedThisFrame.set(n,new Set),this.patterns.set(n,new Map),this.atlasImage.set(n,new s.r({width:1,height:1}))}removeScope(n){this.loaded.delete(n),this.imageProviders.delete(n),this.images.delete(n),this.updatedImages.delete(n),this.callbackDispatchedThisFrame.delete(n),this.patterns.delete(n),this.atlasImage.delete(n);const l=this.atlasTexture.get(n);l&&(l.destroy(),this.atlasTexture.delete(n))}addImageProvider(n,l){this.imageProviders.has(l)||this.imageProviders.set(l,new Map),this.imageProviders.get(l).set(n.id,n)}removeImageProvider(n,l){this.imageProviders.has(l)&&this.imageProviders.get(l).delete(n)}getPendingImageProviders(){const n=[];for(const l of this.imageProviders.values())for(const m of l.values())m.hasPendingRequests()&&n.push(m);return n}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new s.y),this._imageRasterizer}isLoaded(){for(const n of this.loaded.keys())if(!this.loaded.get(n))return!1;return!0}setLoaded(n,l){if(this.loaded.get(l)!==n&&(this.loaded.set(l,n),n)){for(const{ids:m,callback:x}of this.requestors)this._notify(m,l,x);this.requestors=[]}}hasImage(n,l){return!!this.getImage(n,l)}getImage(n,l){return this.images.get(l).get(n.toString())}addImage(n,l,m){this._validate(n,m)&&this.images.get(l).set(n.toString(),m)}_validate(n,l){let m=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new s.z(new Error(`Image "${n.name}" has invalid "stretchX" value`))),m=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new s.z(new Error(`Image "${n.name}" has invalid "stretchY" value`))),m=!1),this._validateContent(l.content,l)||(this.fire(new s.z(new Error(`Image "${n.name}" has invalid "content" value`))),m=!1),m}_validateStretch(n,l){if(!n)return!0;let m=0;for(const x of n){if(x[0]<m||x[1]<x[0]||l<x[1])return!1;m=x[1]}return!0}_validateContent(n,l){return n?n.length!==4||!l.usvg&&(n[0]<0||l.data.width<n[0]||n[1]<0||l.data.height<n[1]||n[2]<0||l.data.width<n[2]||n[3]<0||l.data.height<n[3])?!1:!(n[2]<n[0]||n[3]<n[1]):!0}updateImage(n,l,m){const x=this.images.get(l).get(n.toString());m.version=x.version+1,this.images.get(l).set(n.toString(),m),this.updatedImages.get(l).add(n),this.removeFromImageRasterizerCache(n,l)}clearUpdatedImages(n){this.updatedImages.get(n).clear()}removeFromImageRasterizerCache(n,l){if(this.spriteFormat!=="raster")if(s.t()){const m={imageIds:[n],scope:l};this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",m)}else this.imageRasterizer.removeImagesFromCacheByIds([n],l)}removeImage(n,l){const m=this.images.get(l),x=m.get(n.toString());m.delete(n.toString()),this.patterns.get(l).delete(n.toString()),this.removeFromImageRasterizerCache(n,l),x.userImage&&x.userImage.onRemove&&x.userImage.onRemove()}listImages(n){return Array.from(this.images.get(n).keys()).map(l=>s.I.from(l))}getImages(n,l,m){const x=[],b=[],T=this.imageProviders.get(l);for(const z of n){if(!z.iconsetId){x.push(z);continue}const U=T.get(z.iconsetId);U&&(this.getImage(z,l)?b.push(z):U.addPendingRequest(z))}if(x.length===0)return void this._notify(b,l,m);let k=!0;const j=!!this.loaded.get(l),L=this.images.get(l);if(!j)for(const z of x)L.has(z.toString())||(k=!1);j||k?this._notify(x,l,m):this.requestors.push({ids:x,scope:l,callback:m})}rasterizeImages({scope:n,tasks:l},m){const x=new Map;for(const[b,T]of l.entries()){const k=this.getImage(T.id,n);k&&x.set(b,{image:k,imageVariant:T})}this._rasterizeImages(n,x,m)}_rasterizeImages(n,l,m){if(s.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImages",{tasks:l,scope:n},m);else{const x=new Map;for(const[b,{image:T,imageVariant:k}]of l.entries())x.set(b,this.imageRasterizer.rasterize(k,T,n,0));m(void 0,x)}}getUpdatedImages(n){return this.updatedImages.get(n)||new Set}_notify(n,l,m){const x=this.images.get(l),b=new Map;for(const T of n){const k=x.get(T.toString());if(!k){if(T.iconsetId)continue;s.w(`Image "${T.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`),this.fire(new s.A("styleimagemissing",{id:T.name}));continue}const j={data:k.usvg?null:k.data.clone(),pixelRatio:k.pixelRatio,sdf:k.sdf,usvg:k.usvg,version:k.version,stretchX:k.stretchX,stretchY:k.stretchY,content:k.content,hasRenderCallback:!!(k.userImage&&k.userImage.render)};k.usvg&&Object.assign(j,{width:k.icon.usvg_tree.width,height:k.icon.usvg_tree.height}),b.set(s.I.toString(T),j)}m(null,b)}getPixelSize(n){const{width:l,height:m}=this.atlasImage.get(n);return{width:l,height:m}}getPattern(n,l,m){const x=n.toString(),b=this.patterns.get(l),T=b.get(x),k=this.getImage(n,l);if(!k)return null;if(T){if(T.position.version===k.version)return T.position;T.position.version=k.version}else{if(k.usvg&&!k.data){const j=this.getPatternInFlightId(x,l);if(this.patternsInFlight.has(j))return null;this.patternsInFlight.add(j);const L=new s.B(n).scaleSelf(s.q.devicePixelRatio),z=new Map([[L.toString(),{image:k,imageVariant:L}]]);return this._rasterizeImages(l,z,(U,V)=>this.storePatternImage(L,l,k,m,V)),null}this.storePattern(n,l,k)}return this._updatePatternAtlas(l,m),b.get(x).position}getPatternInFlightId(n,l){return s.C(n,l)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(n,l,m,x,b){const T=n.toString(),k=b?b.get(T):void 0;k&&(m.data=k,this.storePattern(n.id,l,m),this._updatePatternAtlas(l,x),this.patternsInFlight.delete(this.getPatternInFlightId(n.id.toString(),l)))}storePattern(n,l,m){const x={w:m.data.width+2*s.F,h:m.data.height+2*s.F,x:0,y:0},b=new s.G(x,m,s.F);this.patterns.get(l).set(n.toString(),{bin:x,position:b})}bind(n,l){const m=n.gl;let x=this.atlasTexture.get(l);x?this.dirty&&(x.update(this.atlasImage.get(l)),this.dirty=!1):(x=new s.T(n,this.atlasImage.get(l),m.RGBA8),this.atlasTexture.set(l,x)),x.bind(m.LINEAR,m.CLAMP_TO_EDGE)}_updatePatternAtlas(n,l){const m=this.patterns.get(n),x=Array.from(m.values()).map(({bin:L})=>L),{w:b,h:T}=s.H(x),k=this.atlasImage.get(n);k.resize({width:b||1,height:T||1});const j=this.images.get(n);for(const[L,{bin:z,position:U}]of m.entries()){let V=U.padding;const Y=z.x+V,te=z.y+V,K=j.get(L).data,ne=K.width,se=K.height;V=V>1?V-1:V,s.r.copy(K,k,{x:0,y:0},{x:Y,y:te},{width:ne,height:se},l),s.r.copy(K,k,{x:0,y:se-V},{x:Y,y:te-V},{width:ne,height:V},l),s.r.copy(K,k,{x:0,y:0},{x:Y,y:te+se},{width:ne,height:V},l),s.r.copy(K,k,{x:ne-V,y:0},{x:Y-V,y:te},{width:V,height:se},l),s.r.copy(K,k,{x:0,y:0},{x:Y+ne,y:te},{width:V,height:se},l),s.r.copy(K,k,{x:ne-V,y:se-V},{x:Y-V,y:te-V},{width:V,height:V},l),s.r.copy(K,k,{x:0,y:se-V},{x:Y+ne,y:te-V},{width:V,height:V},l),s.r.copy(K,k,{x:0,y:0},{x:Y+ne,y:te+se},{width:V,height:V},l),s.r.copy(K,k,{x:ne-V,y:0},{x:Y-V,y:te+se},{width:V,height:V},l)}this.dirty=!0}beginFrame(){for(const n of this.images.keys())this.callbackDispatchedThisFrame.set(n,new Set)}dispatchRenderCallbacks(n,l){const m=this.images.get(l);for(const x of n){if(this.callbackDispatchedThisFrame.get(l).has(x.toString()))continue;this.callbackDispatchedThisFrame.get(l).add(x.toString());const b=m.get(x.toString());bt(b)&&this.updateImage(x,l,b)}}}function ni(g){const n=g.key,l=g.value,m=g.valueSpec||{},x=g.objectElementValidators||{},b=g.style,T=g.styleSpec;let k=[];const j=s.K(l);if(j!=="object")return[new s.V(n,l,`object expected, ${j} found`)];for(const L in l){const z=L.split(".")[0];let U;x[z]?U=x[z]:m[z]?U=hr:x["*"]?U=x["*"]:m["*"]&&(U=hr),U?k=k.concat(U({key:(n&&`${n}.`)+L,value:l[L],valueSpec:m[z]||m["*"],style:b,styleSpec:T,object:l,objectKey:L},l)):k.push(new s.J(n,l[L],`unknown property "${L}"`))}for(const L in m)x[L]||m[L].required&&m[L].default===void 0&&l[L]===void 0&&k.push(new s.V(n,l,`missing required property "${L}"`));return k}function os(g){const n=g.value,l=g.valueSpec,m=g.style,x=g.styleSpec,b=g.key,T=g.arrayElementValidator||hr;if(s.K(n)!=="array")return[new s.V(b,n,`array expected, ${s.K(n)} found`)];if(l.length&&n.length!==l.length)return[new s.V(b,n,`array length ${l.length} expected, length ${n.length} found`)];if(l["min-length"]&&n.length<l["min-length"])return[new s.V(b,n,`array length at least ${l["min-length"]} expected, length ${n.length} found`)];let k={type:l.value,values:l.values,minimum:l.minimum,maximum:l.maximum,function:void 0};x.$version<7&&(k.function=l.function),s.K(l.value)==="object"&&(k=l.value);let j=[];for(let L=0;L<n.length;L++)j=j.concat(T({array:n,arrayIndex:L,value:n[L],valueSpec:k,style:m,styleSpec:x,key:`${b}[${L}]`},!0));return j}function Be(g){const n=g.key,l=g.value,m=g.valueSpec;let x=s.K(l);if(x==="number"&&l!=l&&(x="NaN"),x!=="number")return[new s.V(n,l,`number expected, ${x} found`)];if("minimum"in m){let b=m.minimum;if(s.K(m.minimum)==="array"&&(b=m.minimum[g.arrayIndex]),l<b)return[new s.V(n,l,`${l} is less than the minimum value ${b}`)]}if("maximum"in m){let b=m.maximum;if(s.K(m.maximum)==="array"&&(b=m.maximum[g.arrayIndex]),l>b)return[new s.V(n,l,`${l} is greater than the maximum value ${b}`)]}return[]}function ut(g){const n=g.valueSpec,l=s.M(g.value.type);let m,x,b,T={};const k=l!=="categorical"&&g.value.property===void 0,j=!k,L=s.K(g.value.stops)==="array"&&s.K(g.value.stops[0])==="array"&&s.K(g.value.stops[0][0])==="object",z=ni({key:g.key,value:g.value,valueSpec:g.styleSpec.function,style:g.style,styleSpec:g.styleSpec,objectElementValidators:{stops:function(Y){if(l==="identity")return[new s.V(Y.key,Y.value,'identity function may not have a "stops" property')];let te=[];const K=Y.value;return te=te.concat(os({key:Y.key,value:K,valueSpec:Y.valueSpec,style:Y.style,styleSpec:Y.styleSpec,arrayElementValidator:U})),s.K(K)==="array"&&K.length===0&&te.push(new s.V(Y.key,K,"array must have at least one stop")),te},default:function(Y){return hr({key:Y.key,value:Y.value,valueSpec:n,style:Y.style,styleSpec:Y.styleSpec})}}});return l==="identity"&&k&&z.push(new s.V(g.key,g.value,'missing required property "property"')),l==="identity"||g.value.stops||z.push(new s.V(g.key,g.value,'missing required property "stops"')),l==="exponential"&&g.valueSpec.expression&&!s.N(g.valueSpec)&&z.push(new s.V(g.key,g.value,"exponential functions not supported")),g.styleSpec.$version>=8&&(j&&!s.O(g.valueSpec)?z.push(new s.V(g.key,g.value,"property functions not supported")):k&&!s.Q(g.valueSpec)&&z.push(new s.V(g.key,g.value,"zoom functions not supported"))),l!=="categorical"&&!L||g.value.property!==void 0||z.push(new s.V(g.key,g.value,'"property" property is required')),z;function U(Y){let te=[];const K=Y.value,ne=Y.key;if(s.K(K)!=="array")return[new s.V(ne,K,`array expected, ${s.K(K)} found`)];if(K.length!==2)return[new s.V(ne,K,`array length 2 expected, length ${K.length} found`)];if(L){if(s.K(K[0])!=="object")return[new s.V(ne,K,`object expected, ${s.K(K[0])} found`)];if(K[0].zoom===void 0)return[new s.V(ne,K,"object stop key must have zoom")];if(K[0].value===void 0)return[new s.V(ne,K,"object stop key must have value")];const se=s.M(K[0].zoom);if(typeof se!="number")return[new s.V(ne,K[0].zoom,"stop zoom values must be numbers")];if(b&&b>se)return[new s.V(ne,K[0].zoom,"stop zoom values must appear in ascending order")];se!==b&&(b=se,x=void 0,T={}),te=te.concat(ni({key:`${ne}[0]`,value:K[0],valueSpec:{zoom:{}},style:Y.style,styleSpec:Y.styleSpec,objectElementValidators:{zoom:Be,value:V}}))}else te=te.concat(V({key:`${ne}[0]`,value:K[0],valueSpec:{},style:Y.style,styleSpec:Y.styleSpec},K));return s.S(s.U(K[1]))?te.concat([new s.V(`${ne}[1]`,K[1],"expressions are not allowed in function stops.")]):te.concat(hr({key:`${ne}[1]`,value:K[1],valueSpec:n,style:Y.style,styleSpec:Y.styleSpec}))}function V(Y,te){const K=s.K(Y.value),ne=s.M(Y.value),se=Y.value!==null?Y.value:te;if(m){if(K!==m)return[new s.V(Y.key,se,`${K} stop domain type must match previous stop domain type ${m}`)]}else m=K;if(K!=="number"&&K!=="string"&&K!=="boolean"&&typeof ne!="number"&&typeof ne!="string"&&typeof ne!="boolean")return[new s.V(Y.key,se,"stop domain value must be a number, string, or boolean")];if(K!=="number"&&l!=="categorical"){let me=`number expected, ${K} found`;return s.O(n)&&l===void 0&&(me+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new s.V(Y.key,se,me)]}return l!=="categorical"||K!=="number"||typeof ne=="number"&&isFinite(ne)&&Math.floor(ne)===ne?l!=="categorical"&&K==="number"&&typeof ne=="number"&&typeof x=="number"&&x!==void 0&&ne<x?[new s.V(Y.key,se,"stop domain values must appear in ascending order")]:(x=ne,l==="categorical"&&ne in T?[new s.V(Y.key,se,"stop domain values must be unique")]:(T[ne]=!0,[])):[new s.V(Y.key,se,`integer expected, found ${String(ne)}`)]}}function St(g){const n=(g.expressionContext==="property"?s.W:s.X)(s.U(g.value),g.valueSpec);if(n.result==="error")return n.value.map(m=>new s.V(`${g.key}${m.key}`,g.value,m.message));const l=n.value.expression||n.value._styleExpression.expression;if(g.expressionContext==="property"&&g.propertyKey==="text-font"&&!l.outputDefined())return[new s.V(g.key,g.value,`Invalid data expression for "${g.propertyKey}". Output values must be contained as literals within the expression.`)];if(g.expressionContext==="property"&&g.propertyType==="layout"&&!s.Y(l))return[new s.V(g.key,g.value,'"feature-state" data expressions are not supported with layout properties.')];if(g.expressionContext==="filter")return dr(l,g);if(g.expressionContext&&g.expressionContext.indexOf("cluster")===0){if(!s.Z(l,["zoom","feature-state"]))return[new s.V(g.key,g.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(g.expressionContext==="cluster-initial"&&!s._(l))return[new s.V(g.key,g.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function dr(g,n){const l=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(n.valueSpec&&n.valueSpec.expression)for(const x of n.valueSpec.expression.parameters)l.delete(x);if(l.size===0)return[];const m=[];return g instanceof s.$&&l.has(g.name)?[new s.V(n.key,n.value,`["${g.name}"] expression is not supported in a filter for a ${n.object.type} layer with id: ${n.object.id}`)]:(g.eachChild(x=>{m.push(...dr(x,n))}),m)}function or(g){const n=g.key,l=g.value,m=g.valueSpec,x=[];return Array.isArray(m.values)?m.values.indexOf(s.M(l))===-1&&x.push(new s.V(n,l,`expected one of [${m.values.join(", ")}], ${JSON.stringify(l)} found`)):Object.keys(m.values).indexOf(s.M(l))===-1&&x.push(new s.V(n,l,`expected one of [${Object.keys(m.values).join(", ")}], ${JSON.stringify(l)} found`)),x}function tr(g){return s.a1(s.U(g.value))?St(s.L({},g,{expressionContext:"filter",valueSpec:g.styleSpec[`filter_${g.layerType||"fill"}`]})):Bt(g)}function Bt(g){const n=g.value,l=g.key;if(s.K(n)!=="array")return[new s.V(l,n,`array expected, ${s.K(n)} found`)];const m=g.styleSpec;let x,b=[];if(n.length<1)return[new s.V(l,n,"filter array must have at least 1 element")];switch(b=b.concat(or({key:`${l}[0]`,value:n[0],valueSpec:m.filter_operator,style:g.style,styleSpec:g.styleSpec})),s.M(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&s.M(n[1])==="$type"&&b.push(new s.V(l,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&b.push(new s.V(l,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(x=s.K(n[1]),x!=="string"&&b.push(new s.V(`${l}[1]`,n[1],`string expected, ${x} found`)));for(let T=2;T<n.length;T++)x=s.K(n[T]),s.M(n[1])==="$type"?b=b.concat(or({key:`${l}[${T}]`,value:n[T],valueSpec:m.geometry_type,style:g.style,styleSpec:g.styleSpec})):x!=="string"&&x!=="number"&&x!=="boolean"&&b.push(new s.V(`${l}[${T}]`,n[T],`string, number, or boolean expected, ${x} found`));break;case"any":case"all":case"none":for(let T=1;T<n.length;T++)b=b.concat(Bt({key:`${l}[${T}]`,value:n[T],style:g.style,styleSpec:g.styleSpec}));break;case"has":case"!has":x=s.K(n[1]),n.length!==2?b.push(new s.V(l,n,`filter array for "${n[0]}" operator must have 2 elements`)):x!=="string"&&b.push(new s.V(`${l}[1]`,n[1],`string expected, ${x} found`))}return b}function Or(g,n){const l=g.key,m=g.style,x=g.layer,b=g.styleSpec,T=g.value,k=g.objectKey,j=b[`${n}_${g.layerType}`];if(!j)return[];const L=k.match(/^(.*)-use-theme$/);if(n==="paint"&&L&&j[L[1]])return s.S(T)?[].concat(hr({key:g.key,value:T,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:m,styleSpec:b,expressionContext:"property",propertyType:n,propertyKey:k})):hr({key:l,value:T,valueSpec:{type:"string"},style:m,styleSpec:b});const z=k.match(/^(.*)-transition$/);if(n==="paint"&&z&&j[z[1]]&&j[z[1]].transition)return hr({key:l,value:T,valueSpec:b.transition,style:m,styleSpec:b});const U=g.valueSpec||j[k];if(!U)return[new s.J(l,T,`unknown property "${k}"`)];let V;if(s.K(T)==="string"&&s.O(U)&&!U.tokens&&(V=/^{([^}]+)}$/.exec(T))){const te=`\`{ "type": "identity", "property": ${V?JSON.stringify(V[1]):'"_"'} }\``;return[new s.V(l,T,`"${k}" does not support interpolation syntax
Use an identity property function instead: ${te}.`)]}const Y=[];if(g.layerType==="symbol")k!=="text-field"||!m||m.glyphs||m.imports||Y.push(new s.V(l,T,'use of "text-field" requires a style "glyphs" property')),k==="text-font"&&s.a2(s.U(T))&&s.M(T.type)==="identity"&&Y.push(new s.V(l,T,'"text-font" does not support identity functions'));else if(g.layerType==="model"&&n==="paint"&&x&&x.layout&&x.layout.hasOwnProperty("model-id")&&s.O(U)&&(s.a3(U)||s.Q(U))){const te=s.W(s.U(T),U),K=te.value.expression||te.value._styleExpression.expression;K&&!s.Z(K,["measure-light"])&&(k==="model-emissive-strength"&&s._(K)&&s.Y(K)||Y.push(new s.V(l,T,`${k} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return Y.concat(hr({key:g.key,value:T,valueSpec:U,style:m,styleSpec:b,expressionContext:"property",propertyType:n,propertyKey:k}))}function Xn(g){return Or(g,"paint")}function Bn(g){return Or(g,"layout")}function fi(g){let n=[];const l=g.value,m=g.key,x=g.style,b=g.styleSpec;l.type||l.ref||n.push(new s.V(m,l,'either "type" or "ref" is required'));let T=s.M(l.type);const k=s.M(l.ref);if(l.id){const j=s.M(l.id);for(let L=0;L<g.arrayIndex;L++){const z=x.layers[L];s.M(z.id)===j&&n.push(new s.V(m,l.id,`duplicate layer id "${l.id}", previously used at line ${z.id.__line__}`))}}if("ref"in l){let j;["type","source","source-layer","filter","layout"].forEach(L=>{L in l&&n.push(new s.V(m,l[L],`"${L}" is prohibited for ref layers`))}),x.layers.forEach(L=>{s.M(L.id)===k&&(j=L)}),j?j.ref?n.push(new s.V(m,l.ref,"ref cannot reference another ref layer")):T=s.M(j.type):typeof k=="string"&&n.push(new s.V(m,l.ref,`ref layer "${k}" not found`))}else if(T!=="background"&&T!=="sky"&&T!=="slot")if(l.source){const j=x.sources&&x.sources[l.source],L=j&&s.M(j.type);j?L==="vector"&&T==="raster"?n.push(new s.V(m,l.source,`layer "${l.id}" requires a raster source`)):L==="raster"&&T!=="raster"?n.push(new s.V(m,l.source,`layer "${l.id}" requires a vector source`)):L!=="vector"||l["source-layer"]?L==="raster-dem"&&T!=="hillshade"?n.push(new s.V(m,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):L!=="raster-array"||["raster","raster-particle"].includes(T)?T!=="line"||!l.paint||!l.paint["line-gradient"]&&!l.paint["line-trim-offset"]||L==="geojson"&&j.lineMetrics?T==="raster-particle"&&L!=="raster-array"&&n.push(new s.V(m,l.source,`layer "${l.id}" requires a 'raster-array' source.`)):n.push(new s.V(m,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):n.push(new s.V(m,l.source,"raster-array source can only be used with layer type 'raster'.")):n.push(new s.V(m,l,`layer "${l.id}" must specify a "source-layer"`)):n.push(new s.V(m,l.source,`source "${l.source}" not found`))}else n.push(new s.V(m,l,'missing required property "source"'));return n=n.concat(ni({key:m,value:l,valueSpec:b.layer,style:g.style,styleSpec:g.styleSpec,objectElementValidators:{"*":()=>[],type:()=>hr({key:`${m}.type`,value:l.type,valueSpec:b.layer.type,style:g.style,styleSpec:g.styleSpec,object:l,objectKey:"type"}),filter:j=>tr(s.L({layerType:T},j)),layout:j=>ni({layer:l,key:j.key,value:j.value,valueSpec:{},style:j.style,styleSpec:j.styleSpec,objectElementValidators:{"*":L=>Bn(s.L({layerType:T},L))}}),paint:j=>ni({layer:l,key:j.key,value:j.value,valueSpec:{},style:j.style,styleSpec:j.styleSpec,objectElementValidators:{"*":L=>Xn(s.L({layerType:T,layer:l},L))}})}})),n}function ms(g){const n=g.value,l=g.key,m=s.K(n);return m!=="string"?[new s.V(l,n,`string expected, ${m} found`)]:[]}const Es={promoteId:function g({key:n,value:l}){if(s.K(l)==="string")return ms({key:n,value:l});if(Array.isArray(l)){const m=[],x=s.U(l),b=s.X(x);return b.result==="error"&&b.value.forEach(T=>{m.push(new s.V(`${n}${T.key}`,null,`${T.message}`))}),s.Z(b.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||m.push(new s.V(`${n}`,null,"promoteId expression should be only feature dependent")),m}{const m=[];for(const x in l)m.push(...g({key:`${n}.${x}`,value:l[x]}));return m}}};function ra(g){const n=g.value,l=g.key,m=g.styleSpec,x=g.style;if(!n.type)return[new s.V(l,n,'"type" is required')];const b=s.M(n.type);let T=[];switch(["vector","raster","raster-dem","raster-array"].includes(b)&&(n.url||n.tiles||T.push(new s.J(l,n,'Either "url" or "tiles" is required.'))),b){case"vector":case"raster":case"raster-dem":case"raster-array":return T=T.concat(ni({key:l,value:n,valueSpec:m[`source_${b.replace("-","_")}`],style:g.style,styleSpec:m,objectElementValidators:Es})),T;case"geojson":if(T=ni({key:l,value:n,valueSpec:m.source_geojson,style:x,styleSpec:m,objectElementValidators:Es}),n.cluster)for(const k in n.clusterProperties){const[j,L]=n.clusterProperties[k],z=typeof j=="string"?[j,["accumulated"],["get",k]]:j;T.push(...St({key:`${l}.${k}.map`,value:L,expressionContext:"cluster-map"})),T.push(...St({key:`${l}.${k}.reduce`,value:z,expressionContext:"cluster-reduce"}))}return T;case"video":return ni({key:l,value:n,valueSpec:m.source_video,style:x,styleSpec:m});case"image":return ni({key:l,value:n,valueSpec:m.source_image,style:x,styleSpec:m});case"canvas":return[new s.V(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return or({key:`${l}.type`,value:n.type,valueSpec:{values:Pa(m)},style:x,styleSpec:m})}}function Pa(g){return g.source.reduce((n,l)=>{const m=g[l];return m.type.type==="enum"&&(n=n.concat(Object.keys(m.type.values))),n},[])}function co(g){const n=g.value,l=g.styleSpec,m=l.light,x=g.style;let b=[];const T=s.K(n);if(n===void 0)return b;if(T!=="object")return b=b.concat([new s.V("light",n,`object expected, ${T} found`)]),b;for(const k in n){const j=k.match(/^(.*)-transition$/),L=k.match(/^(.*)-use-theme$/);b=b.concat(L&&m[L[1]]?hr({key:k,value:n[k],valueSpec:{type:"string"},style:x,styleSpec:l}):j&&m[j[1]]&&m[j[1]].transition?hr({key:k,value:n[k],valueSpec:l.transition,style:x,styleSpec:l}):m[k]?hr({key:k,value:n[k],valueSpec:m[k],style:x,styleSpec:l}):[new s.V(k,n[k],`unknown property "${k}"`)])}return b}function na(g){const n=g.value;let l=[];if(!n)return l;const m=s.K(n);if(m!=="object")return l=l.concat([new s.V("light-3d",n,`object expected, ${m} found`)]),l;const x=g.styleSpec,b=x["light-3d"],T=g.key,k=g.style,j=g.style.lights;for(const U of["type","id"])if(!(U in n))return l=l.concat([new s.V("light-3d",n,`missing property ${U} on light`)]),l;if(n.type&&j)for(let U=0;U<g.arrayIndex;U++){const V=s.M(n.type),Y=j[U];s.M(Y.type)===V&&l.push(new s.V(T,n.id,`duplicate light type "${n.type}", previously defined at line ${Y.id.__line__}`))}const L=`properties_light_${n.type}`;if(!(L in x))return l=l.concat([new s.V("light-3d",n,`Invalid light type ${n.type}`)]),l;const z=x[L];for(const U in n)if(U==="properties"){const V=n[U],Y=s.K(V);if(Y!=="object")return l=l.concat([new s.V("properties",V,`object expected, ${Y} found`)]),l;for(const te in V)l=l.concat(z[te]?hr({key:te,value:V[te],valueSpec:z[te],style:k,styleSpec:x}):[new s.J(g.key,V[te],`unknown property "${te}"`)])}else{const V=U.match(/^(.*)-transition$/),Y=U.match(/^(.*)-use-theme$/);l=l.concat(Y&&b[Y[1]]?hr({key:U,value:n[U],valueSpec:{type:"string"},style:k,styleSpec:x}):V&&b[V[1]]&&b[V[1]].transition?hr({key:U,value:n[U],valueSpec:x.transition,style:k,styleSpec:x}):b[U]?hr({key:U,value:n[U],valueSpec:b[U],style:k,styleSpec:x}):[new s.J(U,n[U],`unknown property "${U}"`)])}return l}function Xi(g){const n=g.value,l=g.key,m=g.style,x=g.styleSpec,b=x.terrain;let T=[];const k=s.K(n);if(n===void 0||k==="null")return T;if(k!=="object")return T=T.concat([new s.V("terrain",n,`object expected, ${k} found`)]),T;for(const j in n){const L=j.match(/^(.*)-transition$/),z=j.match(/^(.*)-use-theme$/);T=T.concat(z&&b[z[1]]?hr({key:j,value:n[j],valueSpec:{type:"string"},style:m,styleSpec:x}):L&&b[L[1]]&&b[L[1]].transition?hr({key:j,value:n[j],valueSpec:x.transition,style:m,styleSpec:x}):b[j]?hr({key:j,value:n[j],valueSpec:b[j],style:m,styleSpec:x}):[new s.J(j,n[j],`unknown property "${j}"`)])}if(n.source){const j=m.sources&&m.sources[n.source],L=j&&s.M(j.type);j?L!=="raster-dem"&&T.push(new s.V(l,n.source,`terrain cannot be used with a source of type ${String(L)}, it only be used with a "raster-dem" source type`)):T.push(new s.V(l,n.source,`source "${n.source}" not found`))}else T.push(new s.V(l,n,'terrain is missing required property "source"'));return T}function Vs(g){const n=g.value,l=g.style,m=g.styleSpec,x=m.fog;let b=[];const T=s.K(n);if(n===void 0)return b;if(T!=="object")return b=b.concat([new s.V("fog",n,`object expected, ${T} found`)]),b;for(const k in n){const j=k.match(/^(.*)-transition$/),L=k.match(/^(.*)-use-theme$/);b=b.concat(L&&x[L[1]]?hr({key:k,value:n[k],valueSpec:{type:"string"},style:l,styleSpec:m}):j&&x[j[1]]&&x[j[1]].transition?hr({key:k,value:n[k],valueSpec:m.transition,style:l,styleSpec:m}):x[k]?hr({key:k,value:n[k],valueSpec:x[k],style:l,styleSpec:m}):[new s.J(k,n[k],`unknown property "${k}"`)])}return b}const Kn={"*":()=>[],array:os,boolean:function(g){const n=g.value,l=g.key,m=s.K(n);return m!=="boolean"?[new s.V(l,n,`boolean expected, ${m} found`)]:[]},number:Be,color:function(g){const n=g.key,l=g.value,m=s.K(l);return m!=="string"?[new s.V(n,l,`color expected, ${m} found`)]:s.a0.parseCSSColor(l)===null?[new s.V(n,l,`color expected, "${l}" found`)]:[]},enum:or,filter:tr,function:ut,layer:fi,object:ni,source:ra,model:s.a4,light:co,"light-3d":na,terrain:Xi,fog:Vs,string:ms,formatted:function(g){return ms(g).length===0?[]:St(g)},resolvedImage:function(g){return ms(g).length===0?[]:St(g)},projection:function(g){const n=g.value,l=g.styleSpec,m=l.projection,x=g.style;let b=[];const T=s.K(n);if(T==="object")for(const k in n)b=b.concat(hr({key:k,value:n[k],valueSpec:m[k],style:x,styleSpec:l}));else T!=="string"&&(b=b.concat([new s.V("projection",n,`object or string expected, ${T} found`)]));return b},import:function(g){const{value:n,styleSpec:l}=g,{data:m,...x}=n;Object.defineProperty(x,"__line__",{value:n.__line__,enumerable:!1});let b=ni(s.L({},g,{value:x,valueSpec:l.import}));return s.M(x.id)===""&&b.push(new s.V(`${g.key}.id`,x,"import id can't be an empty string")),m&&(b=b.concat(Vn(m,l,{key:`${g.key}.data`}))),b},iconset:function(g){const n=g.value,l=g.key,m=g.styleSpec,x=g.style;if(!n.type)return[new s.V(l,n,'"type" is required')];const b=s.M(n.type);let T=[];if(T=T.concat(ni({key:l,value:n,valueSpec:m[`iconset_${b}`],style:x,styleSpec:m})),b==="source"&&n.source){const k=x.sources&&x.sources[n.source],j=k&&s.M(k.type);k?j!=="raster-array"&&T.push(new s.V(l,n.source,`iconset cannot be used with a source of type ${String(j)}, it only be used with a "raster-array" source type`)):T.push(new s.V(l,n.source,`source "${n.source}" not found`))}return T}};function hr(g,n=!1){const l=g.value,m=g.valueSpec,x=g.styleSpec;if(m.expression&&s.a2(s.M(l)))return ut(g);if(m.expression&&s.S(s.U(l)))return St(g);if(m.type&&Kn[m.type]){const b=Kn[m.type](g);return n===!0&&b.length>0&&s.K(g.value)==="array"?St(g):b}return ni(s.L({},g,{valueSpec:m.type?x[m.type]:m}))}function Jn(g){const n=g.value,l=g.key,m=ms(g);return m.length||(n.indexOf("{fontstack}")===-1&&m.push(new s.V(l,n,'"glyphs" url must include a "{fontstack}" token')),n.indexOf("{range}")===-1&&m.push(new s.V(l,n,'"glyphs" url must include a "{range}" token'))),m}function Vn(g,n=s.a5,l={}){return hr({key:l.key||"",value:g,valueSpec:n.$root,styleSpec:n,style:g,objectElementValidators:{glyphs:Jn,"*":()=>[]}})}function xi(g,n=s.a5){return De(Vn(g,n))}const gs=g=>De(ra(g)),Ia=g=>De(co(g)),ql=g=>De(na(g)),op=g=>De(Xi(g)),ap=g=>De(Vs(g)),Sh=g=>De(function(n){const l=n.value,m=n.style,x=n.styleSpec,b=x.snow;let T=[];const k=s.K(l);if(l===void 0)return T;if(k!=="object")return T=T.concat([new s.V("snow",l,`object expected, ${k} found`)]),T;for(const j in l){const L=j.match(/^(.*)-transition$/);T=T.concat(L&&b[L[1]]&&b[L[1]].transition?hr({key:j,value:l[j],valueSpec:x.transition,style:m,styleSpec:x}):b[j]?hr({key:j,value:l[j],valueSpec:b[j],style:m,styleSpec:x}):[new s.J(j,l[j],`unknown property "${j}"`)])}return T}(g)),tt=g=>De(function(n){const l=n.value,m=n.style,x=n.styleSpec,b=x.rain;let T=[];const k=s.K(l);if(l===void 0)return T;if(k!=="object")return T=T.concat([new s.V("rain",l,`object expected, ${k} found`)]),T;for(const j in l){const L=j.match(/^(.*)-transition$/);T=T.concat(L&&b[L[1]]&&b[L[1]].transition?hr({key:j,value:l[j],valueSpec:x.transition,style:m,styleSpec:x}):b[j]?hr({key:j,value:l[j],valueSpec:b[j],style:m,styleSpec:x}):[new s.J(j,l[j],`unknown property "${j}"`)])}return T}(g)),oe=g=>De(fi(g)),ue=g=>De(tr(g)),ve=g=>De(Xn(g)),Ie=g=>De(Bn(g)),Ae=g=>De(s.a4(g));function De(g){return g.slice().sort((n,l)=>n.line&&l.line?n.line-l.line:0)}function Ye(g,n){let l=!1;if(n&&n.length)for(const m of n)m instanceof s.J?s.w(m.message):(g.fire(new s.z(new Error(m.message))),l=!0);return l}let ze;class Qe extends s.E{constructor(n,l="flat"){super(),this._transitionable=new s.a6(ze||(ze=new s.a7({anchor:new s.a8(s.a5.light.anchor),position:new s.a9(s.a5.light.position),color:new s.a8(s.a5.light.color),intensity:new s.a8(s.a5.light.intensity)}))),this.setLight(n,l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,l,m={}){this._validate(Ia,n,m)||(this._transitionable.setTransitionOrValue(n),this.id=l)}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,l,m){return(!m||m.validate!==!1)&&Ye(this,n.call(xi,s.l({value:l,style:{glyphs:!0,sprite:!0},styleSpec:s.a5})))}}let st=class extends s.E{constructor(g,n,l,m){super(),this.scope=l,this._transitionable=new s.a6(new s.a7({source:new s.a8(s.a5.terrain.source),exaggeration:new s.a8(s.a5.terrain.exaggeration)}),l,m),this._transitionable.setTransitionOrValue(g,m),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=n}get(){return this._transitionable.serialize()}set(g,n){this._transitionable.setTransitionOrValue(g,n)}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}getExaggeration(g){return this._transitioning.possiblyEvaluate(new s.aa(g)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const g=this._transitionable._values.exaggeration;if(!g)return null;const n=g.value.expression;if(!n)return null;let l=-1,m=-1,x=1;for(const b of n.zoomStops)x=n.evaluate(new s.aa(b)),x>.01?(l=b,m=-1):m=b;return x<.01&&l>0&&m>l?[l,m]:null}isZoomDependent(){const g=this._transitionable._values.exaggeration;return g!=null&&g.value!=null&&g.value.expression!=null&&g.value.expression instanceof s.ab}};const et=45,wt=65,Lt=.05;function Vt(g,n,l,m){const x=s.ae(et,wt,l),[b,T]=Cr(g,m);let k=1-Math.min(1,Math.exp((n-b)/(T-b)*-6));return k*=k*k,k=Math.min(1,1.00747*k),k*x*g.alpha}function Cr(g,n){const l=.5/Math.tan(.5*n);return[g.range[0]+l,g.range[1]+l]}function kr(g,n,l,m,x){const b=s.ad.vec3.transformMat4([],[n,l,m],x.mercatorFogMatrix);return Vt(g,s.ad.vec3.length(b),x.pitch,x._fov)}function Nr(g,n,l,m,x,b,T){const k=[[l,m,0],[x,m,0],[x,b,0],[l,b,0]];let j=Number.MAX_VALUE,L=-Number.MAX_VALUE;for(const z of k){const U=s.ad.vec3.transformMat4([],z,n),V=s.ad.vec3.length(U);j=Math.min(j,V),L=Math.max(L,V)}return[Vt(g,j,T.pitch,T._fov),Vt(g,L,T.pitch,T._fov)]}class Dr extends s.E{constructor(n,l,m,x){super();const b=new s.a7({range:new s.a8(s.a5.fog.range),color:new s.a8(s.a5.fog.color),"color-use-theme":new s.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new s.a8(s.a5.fog["high-color"]),"high-color-use-theme":new s.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new s.a8(s.a5.fog["space-color"]),"space-color-use-theme":new s.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new s.a8(s.a5.fog["horizon-blend"]),"star-intensity":new s.a8(s.a5.fog["star-intensity"]),"vertical-range":new s.a8(s.a5.fog["vertical-range"])});this._transitionable=new s.a6(b,m,new Map(x)),this.set(n,x),this._transitioning=this._transitionable.untransitioned(),this._transform=l,this.properties=new s.af(b),this.scope=m}get state(){const n=this._transform,l=n.projection.name==="globe",m=s.ag(n.zoom),x=this.properties.get("range"),b=[.5,3];return{range:l?[s.ah(b[0],x[0],m),s.ah(b[1],x[1],m)]:x,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,l,m={}){if(this._validate(ap,n,m))return;const x=s.l({},n);for(const b of Object.keys(s.a5.fog))x[b]===void 0&&(x[b]=s.a5.fog[b].default);this._options=x,this._transitionable.setTransitionOrValue(this._options,l)}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const l=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.ae(et,wt,n))*l.a}getOpacityAtLatLng(n,l){return this._transform.projection.supportsFog?function(m,x,b){const T=s.ac.fromLngLat(x),k=b.elevation?b.elevation.getAtPointOrZero(T):0;return kr(m,T.x,T.y,k,b)}(this.state,n,l):0}getOpacityForTile(n){if(!this._transform.projection.supportsFog)return[1,1];const l=this._transform.calculateFogTileMatrix(n.toUnwrapped());return Nr(this.state,l,0,0,s.ai,s.ai,this._transform)}getOpacityForBounds(n,l,m,x,b){return this._transform.projection.supportsFog?Nr(this.state,n,l,m,x,b,this._transform):[1,1]}getFovAdjustedRange(n){return this._transform.projection.supportsFog?Cr(this.state,n):[0,1]}isVisibleOnFrustum(n){if(!this._transform.projection.supportsFog)return!1;const l=[4,5,6,7];for(const m of l){const x=n.points[m];let b;if(x[2]>=0)b=x;else{const T=n.points[m-4];b=s.aj(T,x,T[2]/(T[2]-x[2]))}if(kr(this.state,b[0],b[1],0,this._transform)>=Lt)return!0}return!1}updateConfig(n){this._transitionable.setTransitionOrValue(this._options,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,l,m){return(!m||m.validate!==!1)&&Ye(this,n.call(xi,s.l({value:l,style:{glyphs:!0,sprite:!0},styleSpec:s.a5})))}}let jn,ri,Vr,mn,gn=class extends s.E{constructor(g,n,l,m){super();const x=jn||(jn=new s.a7({density:new s.a8(s.a5.snow.density),intensity:new s.a8(s.a5.snow.intensity),color:new s.a8(s.a5.snow.color),opacity:new s.a8(s.a5.snow.opacity),vignette:new s.a8(s.a5.snow.vignette),"vignette-color":new s.a8(s.a5.snow["vignette-color"]),"center-thinning":new s.a8(s.a5.snow["center-thinning"]),direction:new s.a8(s.a5.snow.direction),"flake-size":new s.a8(s.a5.snow["flake-size"])}));this._transitionable=new s.a6(x,l,new Map(m)),this.set(g,m),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.af(x),this.scope=l}get state(){const g=this.properties.get("opacity"),n=this.properties.get("color"),l=this.properties.get("direction"),m=s.ak(l[0]),x=-Math.max(s.ak(l[1]),.01),b=[Math.cos(m)*Math.cos(x),Math.sin(m)*Math.cos(x),Math.sin(x)],T=this.properties.get("vignette"),k=this.properties.get("vignette-color");return k.a=T,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.al(n.r,n.g,n.b,n.a*g),direction:b,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:k}}get(){return this._transitionable.serialize()}set(g,n,l={}){if(this._validate(Sh,g,l))return;const m=s.l({},g);for(const x of Object.keys(s.a5.snow))m[x]===void 0&&(m[x]=s.a5.snow[x].default);this._options=m,this._transitionable.setTransitionOrValue(this._options,n)}updateConfig(g){this._transitionable.setTransitionOrValue(this._options,new Map(g))}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}_validate(g,n,l){return(!l||l.validate!==!1)&&Ye(this,g.call(xi,s.l({value:n,style:{glyphs:!0,sprite:!0},styleSpec:s.a5})))}},vn=class extends s.E{constructor(g,n,l,m){super();const x=ri||(ri=new s.a7({density:new s.a8(s.a5.rain.density),intensity:new s.a8(s.a5.rain.intensity),color:new s.a8(s.a5.rain.color),opacity:new s.a8(s.a5.rain.opacity),vignette:new s.a8(s.a5.rain.vignette),"vignette-color":new s.a8(s.a5.rain["vignette-color"]),"center-thinning":new s.a8(s.a5.rain["center-thinning"]),direction:new s.a8(s.a5.rain.direction),"droplet-size":new s.a8(s.a5.rain["droplet-size"]),"distortion-strength":new s.a8(s.a5.rain["distortion-strength"])}));this._transitionable=new s.a6(x,l,new Map(m)),this.set(g,m),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.af(x),this.scope=l}get state(){const g=this.properties.get("opacity"),n=this.properties.get("color"),l=this.properties.get("direction"),m=s.ak(l[0]),x=-Math.max(s.ak(l[1]),.01),b=[Math.cos(m)*Math.cos(x),Math.sin(m)*Math.cos(x),Math.sin(x)],T=this.properties.get("vignette-color");return T.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.al(n.r,n.g,n.b,n.a*g),direction:b,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:T}}get(){return this._transitionable.serialize()}set(g,n,l={}){if(this._validate(tt,g,l))return;const m=s.l({},g);for(const x of Object.keys(s.a5.rain))m[x]===void 0&&(m[x]=s.a5.rain[x].default);this._options=m,this._transitionable.setTransitionOrValue(this._options,n)}updateConfig(g){this._transitionable.setTransitionOrValue(this._options,new Map(g))}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}_validate(g,n,l){return(!l||l.validate!==!1)&&Ye(this,g.call(xi,s.l({value:n,style:{glyphs:!0,sprite:!0},styleSpec:s.a5})))}};class vi extends s.E{constructor(n,l,m,x){super(),this.scope=m,this._options=n,this.properties=new s.af(l),this._transitionable=new s.a6(l,m,new Map(x)),this._transitionable.setTransitionOrValue(n.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(n){this._transitionable.setTransitionOrValue(this._options.properties,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(n,l){this._options=n,this._transitionable.setTransitionOrValue(n.properties,l)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class Ki{constructor(n,l,m,x){this.screenBounds=n,this.cameraPoint=l,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=m,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,x)}static createFromScreenPoints(n,l){let m,x;if(n instanceof s.P||typeof n[0]=="number"){const b=s.P.convert(n);m=[b],x=l.isPointAboveHorizon(b)}else{const b=s.P.convert(n[0]),T=s.P.convert(n[1]);m=[b,T],x=s.an(b,T).every(k=>l.isPointAboveHorizon(k))}return new Ki(m,l.getCameraPoint(),x,l)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(n){return s.an(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const l=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],x=s.an(l,m,0,!1);return this.cameraPoint.y>m.y&&(this.cameraPoint.x>l.x&&this.cameraPoint.x<m.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=m.x?x[2]=this.cameraPoint:this.cameraPoint.x<=l.x&&(x[3]=this.cameraPoint)),s.ao(x,n)}bufferedCameraGeometryGlobe(n){const l=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],x=s.an(l,m,n),b=this.cameraPoint.clone();switch(3*((b.y>l.y)+(b.y>m.y))+((b.x>l.x)+(b.x>m.x))){case 0:x[0]=b,x[4]=b.clone();break;case 1:x.splice(1,0,b);break;case 2:x[1]=b;break;case 3:x.splice(4,0,b);break;case 5:x.splice(2,0,b);break;case 6:x[3]=b;break;case 7:x.splice(3,0,b);break;case 8:x[2]=b}return x}containsTile(n,l,m,x=0){const b=n.queryPadding/l._pixelsPerMercatorPixel+1,T=m?this._bufferedCameraMercator(b,l):this._bufferedScreenMercator(b,l);let k=n.tileID.wrap+(T.unwrapped?x:0);const j=T.polygon.map(ne=>s.ap(n.tileTransform,ne,k));if(!s.aq(j,0,0,s.ai,s.ai))return;k=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?x:0);const L=this.screenGeometryMercator.polygon.map(ne=>s.ar(n.tileTransform,ne,k)),z=L.map(ne=>new s.P(ne[0],ne[1])),U=l.getFreeCameraOptions().position||new s.ac(0,0,0),V=s.ar(n.tileTransform,U,k),Y=L.map(ne=>{const se=s.ad.vec3.sub(ne,ne,V);return s.ad.vec3.normalize(se,se),new s.as(V,se)}),te=s.at(n,1,l.zoom)*l._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:z,tilespaceRays:Y,bufferedTilespaceGeometry:j,bufferedTilespaceBounds:(K=s.au(j),K.min.x=s.ay(K.min.x,0,s.ai),K.min.y=s.ay(K.min.y,0,s.ai),K.max.x=s.ay(K.max.x,0,s.ai),K.max.y=s.ay(K.max.y,0,s.ai),K),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:te};var K}_bufferedScreenMercator(n,l){const m=Ds(n);if(this._screenRaycastCache[m])return this._screenRaycastCache[m];{let x;return x=l.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(n),l):{polygon:this.bufferedScreenGeometry(n).map(b=>l.pointCoordinate3D(b)),unwrapped:!0},this._screenRaycastCache[m]=x,x}}_bufferedCameraMercator(n,l){const m=Ds(n);if(this._cameraRaycastCache[m])return this._cameraRaycastCache[m];{let x;return x=l.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),l):{polygon:this.bufferedCameraGeometry(n).map(b=>l.pointCoordinate3D(b)),unwrapped:!0},this._cameraRaycastCache[m]=x,x}}_projectAndResample(n,l){const m=function(b,T){const k=s.ad.mat4.multiply([],T.pixelMatrix,T.globeMatrix),j=[0,-s.az,0,1],L=[0,s.az,0,1],z=[0,0,0,1];s.ad.vec4.transformMat4(j,j,k),s.ad.vec4.transformMat4(L,L,k),s.ad.vec4.transformMat4(z,z,k);const U=new s.P(j[0]/j[3],j[1]/j[3]),V=new s.P(L[0]/L[3],L[1]/L[3]),Y=s.aw(b,U)&&j[3]<z[3],te=s.aw(b,V)&&L[3]<z[3];if(!Y&&!te)return null;const K=function(we,Te,Pe){for(let Ne=1;Ne<we.length;Ne++){const Ke=Ro(Te.pointCoordinate3D(we[Ne-1]).x),$e=Ro(Te.pointCoordinate3D(we[Ne]).x);if(Pe<0){if(Ke<$e)return{idx:Ne,t:-Ke/($e-1-Ke)}}else if($e<Ke)return{idx:Ne,t:(1-Ke)/($e+1-Ke)}}return null}(b,T,Y?-1:1);if(!K)return null;const{idx:ne,t:se}=K;let me=ne>1?Cs(b.slice(0,ne),T):[],xe=ne<b.length?Cs(b.slice(ne),T):[];me=me.map(we=>new s.P(Ro(we.x),we.y)),xe=xe.map(we=>new s.P(Ro(we.x),we.y));const ye=[...me];ye.length===0&&ye.push(xe[xe.length-1]);const Ee=s.ah(ye[ye.length-1].y,(xe.length===0?me[0]:xe[0]).y,se);let be;return be=Y?[new s.P(0,Ee),new s.P(0,0),new s.P(1,0),new s.P(1,Ee)]:[new s.P(1,Ee),new s.P(1,1),new s.P(0,1),new s.P(0,Ee)],ye.push(...be),xe.length===0?ye.push(me[0]):ye.push(...xe),{polygon:ye.map(we=>new s.ac(we.x,we.y)),unwrapped:!1}}(n,l);if(m)return m;const x=function(b,T){let k=!1,j=-1/0,L=0;for(let U=0;U<b.length-1;U++)b[U].x>j&&(j=b[U].x,L=U);for(let U=0;U<b.length-1;U++){const V=(L+U)%(b.length-1),Y=b[V],te=b[V+1];Math.abs(Y.x-te.x)>.5&&(Y.x<te.x?(Y.x+=1,V===0&&(b[b.length-1].x+=1)):(te.x+=1,V+1===b.length-1&&(b[0].x+=1)),k=!0)}const z=s.av(T.center.lng);return k&&z<Math.abs(z-1)&&b.forEach(U=>{U.x-=1}),{polygon:b,unwrapped:k}}(Cs(n,l).map(b=>new s.P(Ro(b.x),b.y)),l);return{polygon:x.polygon.map(b=>new s.ac(b.x,b.y)),unwrapped:x.unwrapped}}}function Cs(g,n){return s.ax(g,l=>{const m=n.pointCoordinate3D(l);l.x=m.x,l.y=m.y},1/256)}function Ro(g){return g<0?1+g%1:g%1}function Ds(g){return 100*g|0}function Ji(g,n,l,m,x){const b=function(k,j){if(k)return x(k);if(j){if(g.url&&j.tiles&&g.tiles&&delete g.tiles,j.variants){if(!Array.isArray(j.variants))return x(new Error("variants must be an array"));for(const z of j.variants){if(z==null||typeof z!="object"||z.constructor!==Object)return x(new Error("variant must be an object"));if(!Array.isArray(z.capabilities))return x(new Error("capabilities must be an array"));if(z.capabilities.length===1&&z.capabilities[0]==="meshopt"){j=s.l(j,z);break}}}const L=s.aA(s.l({},j,g),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);L.tiles=n.canonicalizeTileset(L,g.url),x(null,L)}},T=function(k,j,L){if(!k)return null;if(!j&&!L)return k;L=L||k.worldview_default;const z=Object.values(k.language||{});if(z.length===0)return null;const U=Object.values(k.worldview||{});if(U.length===0)return null;const V=z.every(te=>te===j),Y=U.every(te=>te===L);return V&&Y?k:j in(k.language_options||{})||L in(k.worldview_options||{})?null:k.language_options&&k.worldview_options?k:null}(g.data,l,m);return T?s.q.frame(()=>b(null,T)):g.url?s.n(n.transformRequest(n.normalizeSourceURL(g.url,null,l,m),s.R.Source),b):s.q.frame(()=>{const{data:k,...j}=g;b(null,j)})}class as{constructor(n,l,m){this.bounds=s.aB.convert(this.validateBounds(n)),this.minzoom=l||0,this.maxzoom=m||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const l=Math.pow(2,n.z),m=Math.floor(s.av(this.bounds.getWest())*l),x=Math.floor(s.aC(this.bounds.getNorth())*l),b=Math.ceil(s.av(this.bounds.getEast())*l),T=Math.ceil(s.aC(this.bounds.getSouth())*l);return n.x>=m&&n.x<b&&n.y>=x&&n.y<T}}class bu extends s.E{constructor(n,l,m,x){if(super(),this.id=n,this.dispatcher=m,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.l(this,s.aA(l,["url","scheme","tileSize","promoteId"])),this._options=s.l({type:"vector"},l),this._collectResourceTiming=!!l.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x),this._tileWorkers={},this._deduped=new s.aD}load(n){this._loaded=!1,this.fire(new s.A("dataloading",{dataType:"source"}));const l=Array.isArray(this.map._language)?this.map._language.join():this.map._language,m=this.map.getWorldview();this._tileJSONRequest=Ji(this._options,this.map._requestManager,l,m,(x,b)=>{if(this._tileJSONRequest=null,this._loaded=!0,x)l&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${l}`),m&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${m}`),this.fire(new s.z(x));else if(b){if(s.l(this,b),this.hasWorldviews=!!b.worldview_options,b.worldview_default&&(this.worldviewDefault=b.worldview_default),b.vector_layers){this.vectorLayers=b.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const T of b.vector_layers)this.vectorLayerIds.push(T.id),b.worldview&&b.worldview[T.source]&&this.localizableLayerIds.add(T.id)}b.bounds&&(this.tileBounds=new as(b.bounds,this.minzoom,this.maxzoom)),mr(b.tiles,this.map._requestManager._customAccessToken),this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))}n&&n(x)})}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=s.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(n))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(n){this.cancelTileJSONRequest()}serialize(){return s.l({},this._options)}loadTile(n,l){const m=n.tileID.canonical.url(this.tiles,this.scheme),x=this.map._requestManager.normalizeTileURL(m),b=this.map._requestManager.transformRequest(x,s.R.Tile),T=this.map.style?this.map.style.getLut(this.scope):null,k=T?{image:T.image.clone()}:null,j={request:b,data:void 0,uid:n.uid,tileID:n.tileID,tileZoom:n.tileZoom,zoom:n.tileID.overscaledZ,maxZoom:this.maxzoom,lut:k,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:s.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:n.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:n.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&s.f(m)&&(j.worldview=this.map.getWorldview()||this.worldviewDefault,j.localizableLayerIds=this.localizableLayerIds),j.request.collectResourceTiming=this._collectResourceTiming,n.actor&&n.state!=="expired")n.state==="loading"?n.reloadCallback=l:n.request=n.actor.send("reloadTile",j,L.bind(this));else if(n.actor=this._tileWorkers[x]=this._tileWorkers[x]||this.dispatcher.getActor(),this.dispatcher.ready)n.request=n.actor.send("loadTile",j,L.bind(this),void 0,!0);else{const z=s.aE.call({deduped:this._deduped},j,(U,V)=>{U||!V?L.call(this,U):(j.data={cacheControl:V.cacheControl,expires:V.expires,rawData:V.rawData.slice(0)},n.actor&&n.actor.send("loadTile",j,L.bind(this),void 0,!0))},!0);n.request={cancel:z}}function L(z,U){return delete n.request,n.aborted?l(null):z&&z.status!==404?l(z):(U&&U.resourceTiming&&(n.resourceTiming=U.resourceTiming),this.map._refreshExpiredTiles&&U&&n.setExpiryData(U),n.loadVectorData(U,this.map.painter),s.aF(this.dispatcher),l(null),void(n.reloadCallback&&(this.loadTile(n,n.reloadCallback),n.reloadCallback=null)))}}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(n,l){n.actor&&n.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope}),n.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class jo extends s.E{constructor(n,l,m,x){super(),this.id=n,this.dispatcher=m,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.l({type:"raster"},l),s.l(this,s.aA(l,["url","scheme","tileSize"]))}load(n){this._loaded=!1,this.fire(new s.A("dataloading",{dataType:"source"})),this._tileJSONRequest=Ji(this._options,this.map._requestManager,null,null,(l,m)=>{this._tileJSONRequest=null,this._loaded=!0,l?this.fire(new s.z(l)):m&&(s.l(this,m),m.raster_layers&&(this.rasterLayers=m.raster_layers,this.rasterLayerIds=this.rasterLayers.map(x=>x.id)),m.bounds&&(this.tileBounds=new as(m.bounds,this.minzoom,this.maxzoom)),mr(m.tiles),this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))),n&&n(l)})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=s.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(n))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(n){this.cancelTileJSONRequest()}serialize(){return s.l({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,l){const m=s.q.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),m,this.tileSize);n.request=s.o(this.map._requestManager.transformRequest(x,s.R.Tile),(b,T,k,j)=>(delete n.request,n.aborted?(n.state="unloaded",l(null)):b?(n.state="errored",l(b)):T?(this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:k,expires:j}),n.setTexture(T,this.map.painter),n.state="loaded",s.aF(this.dispatcher),void l(null)):l(null)))}abortTile(n,l){n.request&&(n.request.cancel(),delete n.request),l&&l()}unloadTile(n,l){n.texture&&n.texture instanceof s.T?(n.destroy(!0),n.texture&&n.texture instanceof s.T&&this.map.painter.saveTileTexture(n.texture)):n.destroy(),l&&l()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ka extends jo{constructor(n,l,m,x){super(n,l,m,x),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._options=s.l({type:"raster-array"},l)}triggerRepaint(n){const l=this.map.painter._terrain,m=this.map.style.getSourceCache(this.id);l&&l.enabled&&m&&l._clearRenderCacheForTile(m.id,n.tileID),this.map.triggerRepaint()}loadTile(n,l){const m=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),x=this.map._requestManager.transformRequest(m,s.R.Tile),b={request:x,uid:n.uid,tileID:n.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};n.source=this.id,n.scope=this.scope,n.requestParams=x,n.actor||(n.actor=this.dispatcher.getActor());const T=(k,j,L,z)=>{if(delete n.request,n.aborted)return n.state="unloaded",l(null);if(k)return k.name==="AbortError"?void 0:(n.state="errored",l(k));if(this.map._refreshExpiredTiles&&j&&n.setExpiryData({cacheControl:L,expires:z}),this.partial)n.state="empty";else{if(!j)return l(null);n.state="loaded",n._isHeaderLoaded=!0,n._mrt=j}l(null)};n.request=this.partial?n.fetchHeader(void 0,T.bind(this)):n.actor.send("loadTile",b,T.bind(this),void 0,!0)}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(n,l){const m=n.texture;m&&m instanceof s.T?(n.destroy(!0),this.map.painter.saveTileTexture(m)):(n.destroy(),n.flushQueues(),n._isHeaderLoaded=!1,delete n._mrt,delete n.textureDescriptor),n.fbo&&(n.fbo.destroy(),delete n.fbo),delete n.request,delete n.requestParams,delete n.neighboringTiles,n.state="unloaded"}prepareTile(n,l,m){n._isHeaderLoaded&&(n.state!=="empty"&&(n.state="reloading"),n.fetchBand(l,m,(x,b)=>{if(x)return n.state="errored",this.fire(new s.z(x)),void this.triggerRepaint(n);b&&(n._isHeaderLoaded=!0,n.setTexture(b,this.map.painter),n.state="loaded",this.triggerRepaint(n))}))}getInitialBand(n){if(!this.rasterLayers)return 0;const l=this.rasterLayers.find(({id:b})=>b===n),m=l&&l.fields,x=m&&m.bands&&m.bands;return x?x[0]:0}getTextureDescriptor(n,l,m){if(!n)return;const x=l.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!x)return;let b=null;l instanceof s.aI?b=l.paint.get("raster-array-band"):l instanceof s.aJ&&(b=l.paint.get("raster-particle-array-band"));const T=b||this.getInitialBand(x);if(T!=null)if(n.textureDescriptor){if(!n.updateNeeded(x,T)||m)return Object.assign({},n.textureDescriptor,{texture:n.texture})}else this.prepareTile(n,x,T)}getImages(n,l){const m=new Map;for(const x of n)for(const b of l){const[T,k]=b.split("/"),j=x.getLayer(T);if(!j||!j.hasBand(k)||!j.hasDataForBand(k))continue;const{bytes:L,tileSize:z,buffer:U}=j.getBandView(k),V=z+2*U,Y={data:new s.r({width:V,height:V},L),pixelRatio:2,sdf:!1,usvg:!1,version:0};m.set(b,Y)}return m}}const Zg={vector:bu,raster:jo,"raster-dem":class extends jo{constructor(g,n,l,m){super(g,n,l,m),this.type="raster-dem",this.maxzoom=22,this._options=s.l({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(g,n){const l=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function m(x,b){x&&(g.state="errored",n(x)),b&&(g.dem=b,g.dem.onDeserialize(),g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0,g.state="loaded",n(null))}g.request=s.o(this.map._requestManager.transformRequest(l,s.R.Tile),(function(x,b,T,k){if(delete g.request,g.aborted)g.state="unloaded",n(null);else if(x)g.state="errored",n(x);else if(b){this.map._refreshExpiredTiles&&g.setExpiryData({cacheControl:T,expires:k});const j=ImageBitmap&&b instanceof ImageBitmap&&s.t(),L=1-(b.width-s.aG(b.width))/2;L<1||g.neighboringTiles||(g.neighboringTiles=this._getNeighboringTiles(g.tileID));const z=j?b:s.q.getImageData(b,L),U={uid:g.uid,tileID:g.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:z,encoding:this.encoding,padding:L};g.actor&&g.state!=="expired"||(g.actor=this.dispatcher.getActor(),g.actor.send("loadTile",U,m.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(g){const n=g.canonical,l=Math.pow(2,n.z),m=(n.x-1+l)%l,x=n.x===0?g.wrap-1:g.wrap,b=(n.x+1+l)%l,T=n.x+1===l?g.wrap+1:g.wrap,k={};return k[new s.aH(g.overscaledZ,x,n.z,m,n.y).key]={backfilled:!1},k[new s.aH(g.overscaledZ,T,n.z,b,n.y).key]={backfilled:!1},n.y>0&&(k[new s.aH(g.overscaledZ,x,n.z,m,n.y-1).key]={backfilled:!1},k[new s.aH(g.overscaledZ,g.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},k[new s.aH(g.overscaledZ,T,n.z,b,n.y-1).key]={backfilled:!1}),n.y+1<l&&(k[new s.aH(g.overscaledZ,x,n.z,m,n.y+1).key]={backfilled:!1},k[new s.aH(g.overscaledZ,g.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},k[new s.aH(g.overscaledZ,T,n.z,b,n.y+1).key]={backfilled:!1}),k}},"raster-array":ka,geojson:class extends s.E{constructor(g,n,l,m){super(),this.id=g,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=l.getActor(),this.setEventedParent(m),this._data=n.data,this._options=s.l({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.minzoom!==void 0&&(this.minzoom=n.minzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const x=s.ai/this.tileSize;this.workerOptions=s.l({source:this.id,scope:this.scope,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*x,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*x,extent:s.ai,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:s.ai,radius:(n.clusterRadius!==void 0?n.clusterRadius:50)*x,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter,dynamic:n.dynamic},n.workerOptions)}onAdd(g){this.map=g,this.setData(this._data)}setData(g){return this._data=g,this._updateWorkerData(),this}updateData(g){if(!this._options.dynamic)return this.fire(new s.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof g!="string"&&(g.type==="Feature"&&(g={type:"FeatureCollection",features:[g]}),g.type!=="FeatureCollection"))return this.fire(new s.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof g!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const n=new Map;for(const l of this._data.features)n.set(l.id,l);for(const l of g.features)n.set(l.id,l);this._data.features=[...n.values()]}else this._data=g;return this._updateWorkerData(!0),this}getClusterExpansionZoom(g,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:g,source:this.id,scope:this.scope},n),this}getClusterChildren(g,n){return this.actor.send("geojson.getClusterChildren",{clusterId:g,source:this.id,scope:this.scope},n),this}getClusterLeaves(g,n,l,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:g,limit:n,offset:l},m),this}_updateWorkerData(g=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.A("dataloading",{dataType:"source"})),this._loaded=!1;const n=s.l({append:g},this.workerOptions);n.scope=this.scope;const l=this._data;typeof l=="string"?(n.request=this.map._requestManager.transformRequest(s.q.resolveURL(l),s.R.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(l),this._pendingLoad=this.actor.send(`${this.type}.loadData`,n,(m,x)=>{if(this._loaded=!0,this._pendingLoad=null,m)this.fire(new s.z(m));else{const b={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&x&&x.resourceTiming&&x.resourceTiming[this.id]&&(b.resourceTiming=x.resourceTiming[this.id]),g&&(this._partialReload=!0),this.fire(new s.A("data",b)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(g),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const g=s.C(this.id,this.scope);this.map.style.clearSource(g),this._updateWorkerData()}loadTile(g,n){const l=g.actor?"reloadTile":"loadTile";g.actor=this.actor;const m=this.map.style?this.map.style.getLut(this.scope):null,x=m?{image:m.image.clone()}:null,b=this._partialReload,T={type:this.type,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:x,scope:this.scope,pixelRatio:s.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,scaleFactor:this.map.getScaleFactor(),partial:b};g.request=this.actor.send(l,T,(k,j)=>b&&!j?(g.state="loaded",n(null)):(delete g.request,g.destroy(),g.aborted?n(null):k?n(k):(g.loadVectorData(j,this.map.painter,l==="reloadTile"),n(null))),void 0,l==="loadTile")}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.aborted=!0}unloadTile(g,n){this.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id,scope:this.scope}),g.destroy()}onRemove(g){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends s.aK{constructor(g,n,l,m){super(g,n,l,m),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const g=this.options;this.urls=[];for(const n of g.urls)this.urls.push(this.map._requestManager.transformRequest(n,s.R.Source).url);s.aL(this.urls,(n,l)=>{this._loaded=!0,n?this.fire(new s.z(n)):l&&(this.video=l,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(g){if(this.video){const n=this.video.seekable;g<n.start(0)||g>n.end(0)?this.fire(new s.z(new s.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=g}}getVideo(){return this.video}onAdd(g){this.map||(this.map=g,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const g=this.map.painter.context,n=g.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new s.T(g,this.video,n.RGBA8),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(g)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:s.aK,model:class extends s.E{constructor(g,n,l,m){super(),this.id=g,this.type="model",this.models=[],this._loaded=!1,this._options=n}load(){const g=[];for(const n in this._options.models){const l=this._options.models[n],m=s.aN(this.map._requestManager.transformRequest(l.uri,s.R.Model).url).then(x=>{if(!x)return;const b=s.aO(x),T=new s.aP(n,l.position,l.orientation,b);T.computeBoundsAndApplyParent(),this.models.push(T)}).catch(x=>{this.fire(new s.z(new Error(`Could not load model ${n} from ${l.uri}: ${x.message}`)))});g.push(m)}return Promise.allSettled(g).then(()=>{this._loaded=!0,this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(n=>{this.fire(new s.z(new Error(`Could not load models: ${n.message}`)))})}onAdd(g){this.map=g,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(g,n){}serialize(){return{type:"model"}}},"batched-model":class extends s.E{constructor(g,n,l,m){super(),this.type="batched-model",this.id=g,this.tileSize=512,this._options=n,this.tiles=this._options.tiles,this.maxzoom=n.maxzoom||19,this.minzoom=n.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=l,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(m)}onAdd(g){this.map=g,this.load()}reload(){this.cancelTileJSONRequest();const g=s.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(g))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(g){this._loaded=!1,this.fire(new s.A("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,l=this.map.getWorldview();this._tileJSONRequest=Ji(this._options,this.map._requestManager,n,l,(m,x)=>{this._tileJSONRequest=null,this._loaded=!0,m?(n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),l&&l.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${l}`),this.fire(new s.z(m))):x&&(s.l(this,x),x.bounds&&(this.tileBounds=new as(x.bounds,this.minzoom,this.maxzoom)),mr(x.tiles,this.map._requestManager._customAccessToken),this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))),g&&g(m)})}hasTransition(){return!1}hasTile(g){return!this.tileBounds||this.tileBounds.contains(g.canonical)}loaded(){return this._loaded}loadTile(g,n){const l=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme)),m={request:this.map._requestManager.transformRequest(l,s.R.Tile),data:void 0,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,tileSize:this.tileSize*g.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:g.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:s.q.devicePixelRatio,promoteId:this.promoteId};if(g.actor&&g.state!=="expired")if(g.state==="loading")g.reloadCallback=n;else{if(g.buckets){const b=Object.values(g.buckets);for(const T of b)T.dirty=!0;return void(g.state="loaded")}g.request=g.actor.send("reloadTile",m,x.bind(this))}else g.actor=this.dispatcher.getActor(),g.request=g.actor.send("loadTile",m,x.bind(this),void 0,!0);function x(b,T){return g.aborted?n(null):b&&b.status!==404?n(b):(this.map._refreshExpiredTiles&&T&&g.setExpiryData(T),g.loadModelData(T,this.map.painter),g.state="loaded",void n(null))}}serialize(){return s.l({},this._options)}},canvas:class extends s.aK{constructor(g,n,l,m){super(g,n,l,m),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(x=>!Array.isArray(x)||x.length!==2||x.some(b=>typeof b!="number"))||this.fire(new s.z(new s.V(`sources.${g}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.z(new s.V(`sources.${g}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new s.z(new s.V(`sources.${g}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new s.z(new s.V(`sources.${g}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.z(new s.V(`sources.${g}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(g){this.map=g,this.load(),this.canvas&&this.animate&&this.play()}onRemove(g){this.pause()}prepare(){let g=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,g=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,g=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context;this.texture?!g&&!this._playing||this.texture instanceof s.aM||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.T(n,this.canvas,n.gl.RGBA8,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const g of[this.canvas.width,this.canvas.height])if(isNaN(g)||g<=0)return!0;return!1}},custom:class extends s.E{constructor(g,n,l,m){super(),this.id=g,this.type="custom",this._dataType="raster",this._dispatcher=l,this._implementation=n,this.setEventedParent(m),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new as(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),s.l(this,s.aA(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.aA(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(g){this.map=g,this._loaded=!1,this.fire(new s.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(g),this.load()}onRemove(g){this._implementation.onRemove&&this._implementation.onRemove(g)}hasTile(g){if(this._implementation.hasTile){const{x:n,y:l,z:m}=g.canonical;return this._implementation.hasTile({x:n,y:l,z:m})}return!this.tileBounds||this.tileBounds.contains(g.canonical)}loadTile(g,n){const{x:l,y:m,z:x}=g.tileID.canonical,b=new AbortController;g.request=Promise.resolve(this._implementation.loadTile({x:l,y:m,z:x},{signal:b.signal})).then((function(T){return delete g.request,g.aborted?(g.state="unloaded",n(null)):T===void 0?(g.state="errored",n(null)):T===null?(this.loadTileData(g,{width:this.tileSize,height:this.tileSize,data:null}),g.state="loaded",n(null)):function(k){return k instanceof ImageData||k instanceof HTMLCanvasElement||k instanceof ImageBitmap||k instanceof HTMLImageElement}(T)?(this.loadTileData(g,T),g.state="loaded",void n(null)):(g.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(T=>{T.name!=="AbortError"&&(g.state="errored",n(T))}),g.request.cancel=()=>b.abort()}loadTileData(g,n){g.setTexture(n,this.map.painter)}unloadTile(g,n){if(g.texture&&g.texture instanceof s.T?(g.destroy(!0),g.texture&&g.texture instanceof s.T&&this.map.painter.saveTileTexture(g.texture)):g.destroy(),this._implementation.unloadTile){const{x:l,y:m,z:x}=g.tileID.canonical;this._implementation.unloadTile({x:l,y:m,z:x})}n&&n()}abortTile(g,n){g.request&&g.request.cancel&&(g.request.cancel(),delete g.request),n&&n()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(g=>({x:g.canonical.x,y:g.canonical.y,z:g.canonical.z}))}_clearTiles(){const g=s.C(this.id,this.scope);this.map.style.clearSource(g)}_update(){this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))}}},lp=function(g,n,l,m){const x=new Zg[n.type](g,n,l,m);if(x.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${x.id}`);return s.aQ(["load","abort","unload","serialize","prepare"],x),x};function Th(g,n,l=""){return`${l}:${n.id||""}:${n.layer.id}:${function(m){if("layerId"in m)return`layer:${m.layerId}`;{const{featuresetId:x,importId:b}=m;return`featureset:${x}${b?`:import:${b}`:""}`}}(g.target)}`}function wu(g,n,l,m=""){if(g.uniqueFeatureID){const x=Th(g,n,m);if(l.has(x))return!0;l.add(x)}return!1}function Yg(g,n,l,m,x=!1){const b=n.sourceCache.transform,T=n.sourceCache.tilesIn(g,n.has3DLayers,x);T.sort(Xg);const k=[];for(const j of T){const L=j.tile.queryRenderedFeatures(n,j,l,m,b,x);Object.keys(L).length&&k.push({wrappedTileID:j.tile.tileID.wrapped().key,queryResults:L})}return k.length===0?{}:function(j){const L={},z={};for(const U of j){const V=U.queryResults,Y=U.wrappedTileID,te=z[Y]=z[Y]||{};for(const K in V){const ne=V[K],se=te[K]=te[K]||{},me=L[K]=L[K]||[];for(const xe of ne)se[xe.featureIndex]||(se[xe.featureIndex]=!0,me.push(xe))}}return L}(k)}function i0(g,n,l,m,x){const b={},T=m.queryRenderedSymbols(g),k=[];for(const j of Object.keys(T).map(Number))k.push(x[j]);k.sort(Xg);for(const j of k){const L=j.featureIndex.lookupSymbolFeatures(T[j.bucketInstanceId],j.bucketIndex,j.sourceLayerIndex,n,l);for(const z in L){const U=b[z]=b[z]||[],V=L[z];V.sort((Y,te)=>{const K=j.featureSortOrder;if(K){const ne=K.indexOf(Y.featureIndex);return K.indexOf(te.featureIndex)-ne}return te.featureIndex-Y.featureIndex});for(const Y of V)U.push(Y)}}return b}function s0(g,n){const l=g.getRenderableIds().map(b=>g.getTileByID(b)),m=[],x={};for(let b=0;b<l.length;b++){const T=l[b],k=T.tileID.canonical.key;x[k]||(x[k]=!0,T.querySourceFeatures(m,n))}return m}function Xg(g,n){const l=g.tileID,m=n.tileID;return l.overscaledZ-m.overscaledZ||l.canonical.y-m.canonical.y||l.wrap-m.wrap||l.canonical.x-m.canonical.x}function Su(g,n){const l={};if(!n)return l;for(const m of g){const x=m.layerIds.map(b=>n.getLayer(b)).filter(Boolean);if(x.length!==0){m.layers=x,m.stateDependentLayerIds&&(m.stateDependentLayers=m.stateDependentLayerIds.map(b=>x.filter(T=>T.id===b)[0]));for(const b of x)l[b.fqid]=m}}return l}const uo=32,ia=33,Hl=new Uint16Array(8184);for(let g=0;g<2046;g++){let n=g+2,l=0,m=0,x=0,b=0,T=0,k=0;for(1&n?x=b=T=uo:l=m=k=uo;(n>>=1)>1;){const L=l+x>>1,z=m+b>>1;1&n?(x=l,b=m,l=T,m=k):(l=x,m=b,x=T,b=k),T=L,k=z}const j=4*g;Hl[j+0]=l,Hl[j+1]=m,Hl[j+2]=x,Hl[j+3]=b}const ho=new Uint16Array(2178),Ys=new Uint8Array(1089),Tu=new Uint16Array(1089);function Kg(g){return g===0?-.03125:g===32?.03125:0}const cp={type:2,extent:s.ai,loadGeometry:()=>[[new s.P(0,0),new s.P(s.ai+1,0),new s.P(s.ai+1,s.ai+1),new s.P(0,s.ai+1),new s.P(0,0)]]};class sa{constructor(n,l,m,x,b){this.tileID=n,this.uid=s.aW(),this.uses=0,this.tileSize=l,this.tileZoom=m,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=b,x&&x.style&&(this._lastUpdatedBrightness=x.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",x&&x.transform&&(this.projection=x.transform.projection)}registerFadeDuration(n){const l=n+this.timeAdded;l<s.q.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=s.aR(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(n,l,m){if(this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=Su(n.buckets,l.style),this.hasSymbolBuckets=!1;for(const x in this.buckets){const b=this.buckets[x];if(b instanceof s.aY){if(this.hasSymbolBuckets=!0,!m)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const x in this.buckets){const b=this.buckets[x];if(b instanceof s.aY&&b.hasRTLText){this.hasRTLText=!0,s.aZ();break}}this.queryPadding=0;for(const x in this.buckets){const b=this.buckets[x],T=l.style.getOwnLayer(x);if(!T)continue;const k=T.queryRadius(b);this.queryPadding=Math.max(this.queryPadding,k)}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage),n.lineAtlas&&(this.lineAtlas=n.lineAtlas),this._lastUpdatedBrightness=n.brightness}else this.collisionBoxArray=new s.aX}unloadVectorData(){if(this.hasData()){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(n,l,m){n&&(n.resourceTiming&&(this.resourceTiming=n.resourceTiming),this.buckets=Object.assign({},this.buckets,Su(n.buckets,l.style)),n.featureIndex&&(this.latestFeatureIndex=n.featureIndex))}getBucket(n){return this.buckets[n.fqid]}upload(n){for(const x in this.buckets){const b=this.buckets[x];b.uploadPending()&&b.upload(n)}const l=n.gl,m=this.imageAtlas;m&&!m.uploaded&&(this.imageAtlasTexture=new s.T(n,m.image,l.RGBA8,{useMipmap:!!m.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new s.T(n,this.glyphAtlasImage,l.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new s.T(n,this.lineAtlas.image,l.R8),this.lineAtlas.uploaded=!0)}prepare(n,l,m){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture,m),!l||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const x=l.style.getBrightness();(this._lastUpdatedBrightness||x)&&(this._lastUpdatedBrightness&&x&&Math.abs(this._lastUpdatedBrightness-x)<.001||(this.updateBuckets(l,this._lastUpdatedBrightness!==x),this._lastUpdatedBrightness=x))}queryRenderedFeatures(n,l,m,x,b,T){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const k=function(j,L){const z=s.ad.mat4.fromScaling([],[.5*j.width,.5*-j.height,1]);return s.ad.mat4.translate(z,z,[1,-1,0]),s.ad.mat4.multiply(z,z,j.calculateProjMatrix(L.toUnwrapped())),Float32Array.from(z)}(b,this.tileID);return this.latestFeatureIndex.query(n,{tilespaceGeometry:l,pixelPosMatrix:k,transform:x,availableImages:m,tileTransform:this.tileTransform})}querySourceFeatures(n,l){const m=this.latestFeatureIndex;if(!m||!m.rawTileData)return;const x=m.loadVTLayers(),b=l?l.sourceLayer:"",T=x._geojsonTileLayer||x[b];if(!T)return;const k=s.a_(l&&l.filter),{z:j,x:L,y:z}=this.tileID.canonical,U={z:j,x:L,y:z};for(let V=0;V<T.length;V++){const Y=T.feature(V);if(k.needGeometry){const ne=s.a$(Y,!0);if(!k.filter(new s.aa(this.tileID.overscaledZ),ne,this.tileID.canonical))continue}else if(!k.filter(new s.aa(this.tileID.overscaledZ),Y))continue;const te=m.getId(Y,b),K=new s.b0(Y,j,L,z,te);K.tile=U,n.push(K)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(n){const l=this.expirationTime;if(n.cacheControl){const m=s.b1(n.cacheControl);m["max-age"]&&(this.expirationTime=Date.now()+1e3*m["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){const m=Date.now();let x=!1;if(this.expirationTime>m)x=!1;else if(l)if(this.expirationTime<l)x=!0;else{const b=this.expirationTime-l;b?this.expirationTime=m+Math.max(b,3e4):x=!0}else x=!0;x?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(n){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&n&&this.updateBuckets(n)}updateBuckets(n,l){if(!this.latestFeatureIndex||!n.style)return;const m=this.latestFeatureIndex.loadVTLayers(),x=n.style.listImages(),b=n.style.getBrightness();for(const T in this.buckets){if(!n.style.hasLayer(T))continue;const k=this.buckets[T],j=k.layers[0],L=j.sourceLayer||"_geojsonTileLayer",z=m[L],U=n.style.getLayerSourceCache(j);let V={};U&&(V=U._state.getState(L,void 0));const Y=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},te=Object.keys(V).length>0&&!l;te&&!k.stateDependentLayers.length&&!l||k.update(V,z,x,Y,te?k.stateDependentLayers:k.layers,l,b),(k instanceof s.b2||k instanceof s.b3)&&n._terrain&&n._terrain.enabled&&U&&k.uploadPending()&&n._terrain._clearRenderCacheForTile(U.id,this.tileID);const K=n&&n.style&&n.style.getOwnLayer(T);K&&(this.queryPadding=Math.max(this.queryPadding,K.queryRadius(k)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=s.q.now()+n}setTexture(n,l){const m=l.context,x=m.gl;this.texture=this.texture||l.getTileTexture(n.width),this.texture&&this.texture instanceof s.T?this.texture.update(n):(this.texture=new s.T(m,n,x.RGBA8,{useMipmap:!0}),this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE))}setDependencies(n,l){const m={};for(const x of l)m[x]=!0;this.dependencies[n]=m}hasDependency(n,l){for(const m of n){const x=this.dependencies[m];if(x){for(const b of l)if(x[b])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(n,l){if(!l||l.name==="mercator"||this._tileDebugBuffer)return;const m=s.b4(cp,this.tileID.canonical,this.tileTransform)[0],x=new s.b5,b=new s.b6;for(let T=0;T<m.length;T++){const{x:k,y:j}=m[T];x.emplaceBack(k,j),b.emplaceBack(T)}b.emplaceBack(0),this._tileDebugIndexBuffer=n.createIndexBuffer(b),this._tileDebugBuffer=n.createVertexBuffer(x,s.b7.members),this._tileDebugSegments=s.b8.simpleSegment(0,0,x.length,b.length)}_makeTileBoundsBuffers(n,l){if(this._tileBoundsBuffer||!l||l.name==="mercator")return;const m=s.b4(cp,this.tileID.canonical,this.tileTransform)[0];let x,b;if(this.isRaster){const T=function(k,j){const L=s.aR(k,j),z=Math.pow(2,k.z);for(let ne=0;ne<ia;ne++)for(let se=0;se<ia;se++){const me=s.aS((k.x+(se+Kg(se))/uo)/z),xe=s.aT((k.y+(ne+Kg(ne))/uo)/z),ye=j.project(me,xe),Ee=ne*ia+se;ho[2*Ee+0]=Math.round((ye.x*L.scale-L.x)*s.ai),ho[2*Ee+1]=Math.round((ye.y*L.scale-L.y)*s.ai)}Ys.fill(0),Tu.fill(0);for(let ne=2045;ne>=0;ne--){const se=4*ne,me=Hl[se+0],xe=Hl[se+1],ye=Hl[se+2],Ee=Hl[se+3],be=me+ye>>1,we=xe+Ee>>1,Te=be+we-xe,Pe=we+me-be,Ne=xe*ia+me,Ke=Ee*ia+ye,$e=we*ia+be,lt=Math.hypot((ho[2*Ne+0]+ho[2*Ke+0])/2-ho[2*$e+0],(ho[2*Ne+1]+ho[2*Ke+1])/2-ho[2*$e+1])>=16;Ys[$e]=Ys[$e]||(lt?1:0),ne<1022&&(Ys[$e]=Ys[$e]||Ys[(xe+Pe>>1)*ia+(me+Te>>1)]||Ys[(Ee+Pe>>1)*ia+(ye+Te>>1)])}const U=new s.aU,V=new s.aV;let Y=0;function te(ne,se){const me=se*ia+ne;return Tu[me]===0&&(U.emplaceBack(ho[2*me+0],ho[2*me+1],ne*s.ai/uo,se*s.ai/uo),Tu[me]=++Y),Tu[me]-1}function K(ne,se,me,xe,ye,Ee){const be=ne+me>>1,we=se+xe>>1;if(Math.abs(ne-ye)+Math.abs(se-Ee)>1&&Ys[we*ia+be])K(ye,Ee,ne,se,be,we),K(me,xe,ye,Ee,be,we);else{const Te=te(ne,se),Pe=te(me,xe),Ne=te(ye,Ee);V.emplaceBack(Te,Pe,Ne)}}return K(0,0,uo,uo,uo,0),K(uo,uo,0,0,0,uo),{vertices:U,indices:V}}(this.tileID.canonical,l);x=T.vertices,b=T.indices}else{x=new s.aU,b=new s.aV;for(const{x:k,y:j}of m)x.emplaceBack(k,j,0,0);const T=s.b9(x.int16,void 0,4);for(let k=0;k<T.length;k+=3)b.emplaceBack(T[k],T[k+1],T[k+2])}this._tileBoundsBuffer=n.createVertexBuffer(x,s.ba.members),this._tileBoundsIndexBuffer=n.createIndexBuffer(b),this._tileBoundsSegments=s.b8.simpleSegment(0,0,x.length,b.length)}_makeGlobeTileDebugBuffers(n,l){const m=l.projection;if(!m||m.name!=="globe"||l.freezeTileCoverage)return;const x=this.tileID.canonical,b=s.bb(x,l),T=s.bc(b),k=s.ag(l.zoom);let j;k>0&&(j=s.ad.mat4.invert(new Float64Array(16),l.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(n,x,l,T,j,k),this._makeGlobeTileDebugTextBuffer(n,x,l,T,j,k)}_globePoint(n,l,m,x,b,T,k){let j=s.bd(n,l,m);if(T){const L=1<<m.z,z=s.av(x.center.lng),U=s.aC(x.center.lat),V=(m.x+.5)/L-z;let Y=0;V>.5?Y=-1:V<-.5&&(Y=1);let te=(n/s.ai+m.x)/L+Y,K=(l/s.ai+m.y)/L;te=(te-z)*x._pixelsPerMercatorPixel+z,K=(K-U)*x._pixelsPerMercatorPixel+U;const ne=[te*x.worldSize,K*x.worldSize,0];s.ad.vec3.transformMat4(ne,ne,T),j=s.be(j,ne,k)}return s.ad.vec3.transformMat4(j,j,b)}_makeGlobeTileDebugBorderBuffer(n,l,m,x,b,T){const k=new s.b5,j=new s.b6,L=new s.bf,z=(V,Y,te,K,ne)=>{const se=(te-V)/(ne-1),me=(K-Y)/(ne-1),xe=k.length;for(let ye=0;ye<ne;ye++){const Ee=V+ye*se,be=Y+ye*me;k.emplaceBack(Ee,be);const we=this._globePoint(Ee,be,l,m,x,b,T);L.emplaceBack(we[0],we[1],we[2]),j.emplaceBack(xe+ye)}},U=s.ai;z(0,0,U,0,16),z(U,0,U,U,16),z(U,U,0,U,16),z(0,U,0,0,16),this._tileDebugIndexBuffer=n.createIndexBuffer(j),this._tileDebugBuffer=n.createVertexBuffer(k,s.b7.members),this._globeTileDebugBorderBuffer=n.createVertexBuffer(L,s.bg.members),this._tileDebugSegments=s.b8.simpleSegment(0,0,k.length,j.length)}_makeGlobeTileDebugTextBuffer(n,l,m,x,b,T){const k=s.ai/4,j=new s.b5,L=new s.aV,z=new s.bf,U=25;L.reserve(32),j.reserve(U),z.reserve(U);const V=(Y,te)=>U*Y+te;for(let Y=0;Y<U;Y++){const te=Y*k;for(let K=0;K<U;K++){const ne=K*k;j.emplaceBack(ne,te);const se=this._globePoint(ne,te,l,m,x,b,T);z.emplaceBack(se[0],se[1],se[2])}}for(let Y=0;Y<4;Y++)for(let te=0;te<4;te++){const K=V(Y,te),ne=V(Y,te+1),se=V(Y+1,te),me=V(Y+1,te+1);L.emplaceBack(K,ne,se),L.emplaceBack(se,ne,me)}this._tileDebugTextIndexBuffer=n.createIndexBuffer(L),this._tileDebugTextBuffer=n.createVertexBuffer(j,s.b7.members),this._globeTileDebugTextBuffer=n.createVertexBuffer(z,s.bg.members),this._tileDebugTextSegments=s.b8.simpleSegment(0,0,U,32)}destroy(n=!1){for(const l in this.buckets)this.buckets[l].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!n&&this.texture&&this.texture instanceof s.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}s.bh.setPbf(s.bi);class Us extends sa{constructor(n,l,m,x,b){super(n,l,m,x,b),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(n){return this._mrt&&this._mrt.getLayer(n)}setTexture(n,l){const m=l.context,x=m.gl;this.texture=this.texture||l.getTileTexture(n.width),this.texture&&this.texture instanceof s.T?this.texture.update(n,{premultiply:!1}):this.texture=new s.T(m,n,x.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(n=16384,l){const m=this._mrt=new s.bh(30),x=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(n-1)}});return this.entireBuffer=null,this.request=s.bj(x,(b,T,k,j)=>{if(b)l(b);else try{const L=m.getHeaderLength(T);if(L>n)return void(this.request=this.fetchHeader(L,l));m.parseHeader(T),this._isHeaderLoaded=!0;let z=0;for(const U of Object.values(m.layers))z=Math.max(z,U.dataIndex[U.dataIndex.length-1].lastByte);T.byteLength>=z&&(this.entireBuffer=T),l(null,this.entireBuffer||T,k,j)}catch(L){l(L)}}),this.request}fetchBand(n,l,m){const x=this._mrt;if(!this._isHeaderLoaded||!x)return void m(new Error("Tile header is not ready"));const b=this.actor;if(!b)return void m(new Error("Can't fetch tile band without an actor"));let T;const k=(U,V)=>{T.complete(U,V),U?m(U):(this.updateTextureDescriptor(n,l),m(null,this.textureDescriptor&&this.textureDescriptor.img))},j=(U,V)=>{if(U)return m(U);const Y=b.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:V,task:T},k,void 0,!0);this._workQueue.push(()=>{Y&&Y.cancel(),T.cancel()})},L=x.getLayer(n);if(!L)return void m(new Error(`Unknown sourceLayer "${n}"`));if(L.hasDataForBand(l))return this.updateTextureDescriptor(n,l),void m(null,this.textureDescriptor?this.textureDescriptor.img:null);const z=L.getDataRange([l]);if(T=x.createDecodingTask(z),!T||T.tasks.length)if(this.flushQueues(),this.entireBuffer)j(null,this.entireBuffer.slice(z.firstByte,z.lastByte+1));else{const U=Object.assign({},this.requestParams,{headers:{Range:`bytes=${z.firstByte}-${z.lastByte}`}}),V=s.bj(U,j);this._fetchQueue.push(()=>{V.cancel(),T.cancel()})}else m(null)}updateNeeded(n,l){return(!this.textureDescriptor||this.textureDescriptor.band!==l||this.textureDescriptor.layer!==n)&&this.state!=="errored"}updateTextureDescriptor(n,l){if(!this._mrt)return;const m=this._mrt.getLayer(n);if(!m||!m.hasBand(l)||!m.hasDataForBand(l))return;const{bytes:x,tileSize:b,buffer:T,offset:k,scale:j}=m.getBandView(l),L=b+2*T,z=new s.r({width:L,height:L},x),U=this.texture;U&&U instanceof s.T&&U.update(z,{premultiply:!1}),this.textureDescriptor={layer:n,band:l,img:z,buffer:T,offset:k,tileSize:b,format:m.pixelFormat,mix:[j,256*j,65536*j,16777216*j]}}}class o0{constructor(n,l){this.max=n,this.onRemove=l,this.reset()}reset(){for(const n in this.data)for(const l of this.data[n])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(n,l,m){const x=n.wrapped().key;this.data[x]===void 0&&(this.data[x]=[]);const b={value:l,timeout:void 0};if(m!==void 0&&(b.timeout=setTimeout(()=>{this.remove(n,b)},m)),this.data[x].push(b),this.order.push(x),this.order.length>this.max){const T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const l=this.data[n].shift();return l.timeout&&clearTimeout(l.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),l.value}getByKey(n){const l=this.data[n];return l?l[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,l){if(!this.has(n))return this;const m=n.wrapped().key,x=l===void 0?0:this.data[m].indexOf(l),b=this.data[m][x];return this.data[m].splice(x,1),b.timeout&&clearTimeout(b.timeout),this.data[m].length===0&&delete this.data[m],this.onRemove(b.value),this.order.splice(this.order.indexOf(m),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(n){const l=[];for(const m in this.data)for(const x of this.data[m])n(x.value)||l.push(x);for(const m of l)this.remove(m.value.tileID,m)}}class Jg{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,l,m){const x=String(l);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][x]=this.stateChanges[n][x]||{},s.l(this.stateChanges[n][x],m),this.deletedStates[n]===null){this.deletedStates[n]={};for(const b in this.state[n])b!==x&&(this.deletedStates[n][b]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][x]===null){this.deletedStates[n][x]={};for(const b in this.state[n][x])m[b]||(this.deletedStates[n][x][b]=null)}else for(const b in m)this.deletedStates[n]&&this.deletedStates[n][x]&&this.deletedStates[n][x][b]===null&&delete this.deletedStates[n][x][b]}removeFeatureState(n,l,m){if(this.deletedStates[n]===null)return;const x=String(l);if(this.deletedStates[n]=this.deletedStates[n]||{},m&&l!==void 0)this.deletedStates[n][x]!==null&&(this.deletedStates[n][x]=this.deletedStates[n][x]||{},this.deletedStates[n][x][m]=null);else if(l!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][x])for(m in this.deletedStates[n][x]={},this.stateChanges[n][x])this.deletedStates[n][x][m]=null;else this.deletedStates[n][x]=null;else this.deletedStates[n]=null}getState(n,l){const m=this.state[n]||{},x=this.stateChanges[n]||{},b=this.deletedStates[n];if(b===null)return{};if(l!==void 0){const k=String(l),j=s.l({},m[k],x[k]);if(b){const L=b[l];if(L===null)return{};for(const z in L)delete j[z]}return j}const T=s.l({},m,x);if(b)for(const k in b)delete T[k];return T}initializeTileState(n,l){n.refreshFeatureState(l)}coalesceChanges(n,l){const m={};for(const x in this.stateChanges){this.state[x]=this.state[x]||{};const b={};for(const T in this.stateChanges[x])this.state[x][T]||(this.state[x][T]={}),s.l(this.state[x][T],this.stateChanges[x][T]),b[T]=this.state[x][T];m[x]=b}for(const x in this.deletedStates){this.state[x]=this.state[x]||{};const b={};if(this.deletedStates[x]===null)for(const T in this.state[x])b[T]={},this.state[x][T]={};else for(const T in this.deletedStates[x]){if(this.deletedStates[x][T]===null)this.state[x][T]={};else if(this.state[x][T])for(const k of Object.keys(this.deletedStates[x][T]))delete this.state[x][T][k];b[T]=this.state[x][T]}m[x]=m[x]||{},s.l(m[x],b)}if(this.stateChanges={},this.deletedStates={},Object.keys(m).length!==0)for(const x in n)n[x].refreshFeatureState(l)}}class Do extends s.E{constructor(n,l,m){super(),this.id=n,this._onlySymbols=m,l.on("data",x=>{x.dataType==="source"&&x.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&x.dataType==="source"&&x.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),l.on("error",()=>{this._sourceErrored=!0}),this._source=l,this._tiles={},this._cache=new o0(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Jg,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(n){this.map=n,this._minTileCacheSize=this._minTileCacheSize===void 0&&n?n._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&n?n._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const n in this._tiles)if(!this._tiles[n].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(n,l){return n.isSymbolTile=this._onlySymbols,n.isExtraShadowCaster=this._shadowCasterTiles[n.tileID.key],this._source.loadTile(n,l)}_unloadTile(n){if(this._source.unloadTile)return this._source.unloadTile(n)}_abortTile(n){if(this._source.abortTile)return this._source.abortTile(n)}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const l in this._tiles){const m=this._tiles[l];m.upload(n),m.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(n=>n.tileID).sort(_n).map(n=>n.key)}getRenderableIds(n,l){const m=[];for(const x in this._tiles)this._isIdRenderable(+x,n,l)&&m.push(this._tiles[x]);return n?m.sort((x,b)=>{const T=x.tileID,k=b.tileID,j=new s.P(T.canonical.x,T.canonical.y)._rotate(this.transform.angle),L=new s.P(k.canonical.x,k.canonical.y)._rotate(this.transform.angle);return T.overscaledZ-k.overscaledZ||L.y-j.y||L.x-j.x}).map(x=>x.tileID.key):m.map(x=>x.tileID).sort(_n).map(x=>x.key)}hasRenderableParent(n){const l=this.findLoadedParent(n,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(n,l,m){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(l||!this._tiles[n].holdingForFade())&&(m||!this._shadowCasterTiles[n])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const n in this._tiles)this._tiles[n].state!=="errored"&&this._reloadTile(+n,"reloading")}}_reloadTile(n,l){const m=this._tiles[n];m&&(m.state!=="loading"&&(m.state=l),this._loadTile(m,this._tileLoaded.bind(this,m,n,l)))}_tileLoaded(n,l,m,x){if(x)if(n.state="errored",x.status!==404)this._source.fire(new s.z(x,{tile:n}));else{if(this._source.fire(new s.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:n})),!(n.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const b=this.map.painter.terrain;this.update(this.transform,b.getScaledDemTileSize(),!0),b.resetTileLookupCache(this.id)}else this.update(this.transform)}else n.timeAdded=s.q.now(),m==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(l,n),this._source.type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null),this._source.fire(new s.A("data",{dataType:"source",tile:n,coord:n.tileID,sourceCacheId:this.id}))}_backfillDEM(n){const l=this.getRenderableIds();for(let x=0;x<l.length;x++){const b=l[x];if(n.neighboringTiles&&n.neighboringTiles[b]){const T=this.getTileByID(b);m(n,T),m(T,n)}}function m(x,b){if(!x.dem||x.dem.borderReady)return;x.needsHillshadePrepare=!0,x.needsDEMTextureUpload=!0;let T=b.tileID.canonical.x-x.tileID.canonical.x;const k=b.tileID.canonical.y-x.tileID.canonical.y,j=Math.pow(2,x.tileID.canonical.z),L=b.tileID.key;T===0&&k===0||Math.abs(k)>1||(Math.abs(T)>1&&(Math.abs(T+j)===1?T+=j:Math.abs(T-j)===1&&(T-=j)),b.dem&&x.dem&&(x.dem.backfillBorder(b.dem,T,k),x.neighboringTiles&&x.neighboringTiles[L]&&(x.neighboringTiles[L].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,l,m,x){for(const b in this._tiles){let T=this._tiles[b];if(x[b]||!T.hasData()||T.tileID.overscaledZ<=l||T.tileID.overscaledZ>m)continue;let k=T.tileID;for(;T&&T.tileID.overscaledZ>l+1;){const L=T.tileID.scaledTo(T.tileID.overscaledZ-1);T=this._tiles[L.key],T&&T.hasData()&&(k=L)}let j=k;for(;j.overscaledZ>l;)if(j=j.scaledTo(j.overscaledZ-1),n[j.key]){x[k.key]=k;break}}}findLoadedParent(n,l){if(n.key in this._loadedParentTiles){const m=this._loadedParentTiles[n.key];return m&&m.tileID.overscaledZ>=l?m:null}for(let m=n.overscaledZ-1;m>=l;m--){const x=n.scaledTo(m),b=this._getLoadedTile(x);if(b)return b}}_getLoadedTile(n){const l=this._tiles[n.key];return l&&l.hasData()?l:this._cache.getByKey(this._source.reparseOverscaled?n.wrapped().key:n.canonical.key)}updateCacheSize(n,l){l=l||this._source.tileSize;const m=Math.ceil(n.width/l)+1,x=Math.ceil(n.height/l)+1,b=Math.floor(m*x*5),T=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,b):b,k=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,T):T;this._cache.setMaxSize(k)}handleWrapJump(n){const l=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,l){const m={};for(const x in this._tiles){const b=this._tiles[x];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+l),m[b.tileID.key]=b}this._tiles=m;for(const x in this._timers)clearTimeout(this._timers[x]),delete this._timers[x];for(const x in this._tiles)this._setTileReloadTimer(+x,this._tiles[x])}}update(n,l,m,x){if(this.transform=n,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!m)return;this.updateCacheSize(n,l),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const b=this._source.type==="batched-model";let T,k=this._source.maxzoom;const j=this.map&&this.map.painter?this.map.painter._terrain:null;if(j&&j.sourceCache===this&&j.attenuationRange()){const U=j.attenuationRange()[0],V=Math.floor(U)-Math.log2(j.getDemUpscale());k>V&&(k=V)}if(this.used||this.usedForTerrain){if(this._source.tileID)T=n.getVisibleUnwrappedCoordinates(this._source.tileID).map(U=>new s.aH(U.canonical.z,U.wrap,U.canonical.z,U.canonical.x,U.canonical.y));else if(this.tileCoverLift!==0){const U=n.clone();U.tileCoverLift=this.tileCoverLift,T=U.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:k,roundZoom:this._source.roundZoom&&!m,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:b}),this._source.minzoom<=1&&n.projection.name==="globe"&&(T.push(new s.aH(1,0,1,0,0)),T.push(new s.aH(1,0,1,1,0)),T.push(new s.aH(1,0,1,0,1)),T.push(new s.aH(1,0,1,1,1)))}else if(T=n.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:k,roundZoom:this._source.roundZoom&&!m,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:b}),this._source.hasTile){const U=this._source.hasTile.bind(this._source);T=T.filter(V=>U(V))}}else T=[];if(T.length>0&&this.castsShadows&&x&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Qg(this._source.type)){const U=n.coveringZoomLevel({tileSize:l||this._source.tileSize,roundZoom:this._source.roundZoom&&!m}),V=Math.min(U,this._source.maxzoom);if(b){const Y=n.extendTileCover(T,V);for(const te of Y)T.push(te)}else{const Y=n.extendTileCover(T,V,x);for(const te of Y)this._shadowCasterTiles[te.key]=!0,T.push(te)}}const L=this._updateRetainedTiles(T);if(Qg(this._source.type)&&T.length!==0){const U={},V={},Y=Object.keys(L);for(const K of Y){const ne=L[K],se=this._tiles[K];if(!se||se.fadeEndTime&&se.fadeEndTime<=s.q.now())continue;const me=this.findLoadedParent(ne,Math.max(ne.overscaledZ-Do.maxOverzooming,this._source.minzoom));me&&(this._addTile(me.tileID),U[me.tileID.key]=me.tileID),V[K]=ne}const te=T[T.length-1].overscaledZ;for(const K in this._tiles){const ne=this._tiles[K];if(L[K]||!ne.hasData())continue;let se=ne.tileID;for(;se.overscaledZ>te;){se=se.scaledTo(se.overscaledZ-1);const me=this._tiles[se.key];if(me&&me.hasData()&&V[se.key]){L[K]=ne.tileID;break}}}for(const K in U)L[K]||(this._coveredTiles[K]=!0,L[K]=U[K])}for(const U in L)this._tiles[U].clearFadeHold();const z=s.bk(this._tiles,L);for(const U of z){const V=this._tiles[U];V.hasSymbolBuckets&&!V.holdingForFade()?V.setHoldDuration(this.map._fadeDuration):V.hasSymbolBuckets&&!V.symbolFadeFinished()||this._removeTile(+U)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(+n)}_updateRetainedTiles(n){const l={};if(n.length===0)return l;const m={},x=n.reduce((L,z)=>Math.min(L,z.overscaledZ),1/0),b=n[0].overscaledZ,T=Math.max(b-Do.maxOverzooming,this._source.minzoom),k=Math.max(b+Do.maxUnderzooming,this._source.minzoom),j={};for(const L of n){const z=this._addTile(L);l[L.key]=L,z.hasData()||x<this._source.maxzoom&&(j[L.key]=L)}this._retainLoadedChildren(j,x,k,l);for(const L of n){let z=this._tiles[L.key];if(z.hasData())continue;if(L.canonical.z>=this._source.maxzoom){const V=L.children(this._source.maxzoom)[0],Y=this.getTile(V);if(Y&&Y.hasData()){l[V.key]=V;continue}}else{const V=L.children(this._source.maxzoom);if(l[V[0].key]&&l[V[1].key]&&l[V[2].key]&&l[V[3].key])continue}let U=z.wasRequested();for(let V=L.overscaledZ-1;V>=T;--V){const Y=L.scaledTo(V);if(m[Y.key]||(m[Y.key]=!0,z=this.getTile(Y),!z&&U&&(z=this._addTile(Y)),z&&(l[Y.key]=Y,U=z.wasRequested(),z.hasData())))break}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const n in this._tiles){const l=[];let m,x=this._tiles[n].tileID;for(;x.overscaledZ>0;){if(x.key in this._loadedParentTiles){m=this._loadedParentTiles[x.key];break}l.push(x.key);const b=x.scaledTo(x.overscaledZ-1);if(m=this._getLoadedTile(b),m)break;x=b}for(const b of l)this._loadedParentTiles[b]=m}}_addTile(n){let l=this._tiles[n.key];if(l)return l.isExtraShadowCaster!==!0||this._shadowCasterTiles[n.key]||this._reloadTile(n.key,"reloading"),l;l=this._cache.getAndRemove(n),l&&(this._setTileReloadTimer(n.key,l),l.tileID=n,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,l)));const m=!!l;if(!m){const x=this.map?this.map.painter:null,b=this._source.tileSize*n.overscaleFactor();l=this._source.type==="raster-array"?new Us(n,b,this.transform.tileZoom,x,this._isRaster):new sa(n,b,this.transform.tileZoom,x,this._isRaster),this._loadTile(l,this._tileLoaded.bind(this,l,n.key,l.state))}return l?(l.uses++,this._tiles[n.key]=l,m||this._source.fire(new s.A("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l):null}_setTileReloadTimer(n,l){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);const m=l.getExpiryTimeout();m&&(this._timers[n]=setTimeout(()=>{this._reloadTile(n,"expired"),delete this._timers[n]},m))}_removeTile(n){const l=this._tiles[n];l&&(l.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),l.uses>0||(l.hasData()&&l.state!=="reloading"||l.state==="empty"?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const n in this._tiles)this._removeTile(+n);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(n,l,m){const x=[],b=this.transform;if(!b)return x;const T=b.projection.name==="globe",k=s.av(b.center.lng);for(const j in this._tiles){const L=this._tiles[j];if(m&&L.clearQueryDebugViz(),L.holdingForFade())continue;let z;if(T){const U=L.tileID.canonical;if(U.z===0){const V=[Math.abs(s.ay(k,...ur(U,-1))-k),Math.abs(s.ay(k,...ur(U,1))-k)];z=[0,2*V.indexOf(Math.min(...V))-1]}else{const V=[Math.abs(s.ay(k,...ur(U,-1))-k),Math.abs(s.ay(k,...ur(U,0))-k),Math.abs(s.ay(k,...ur(U,1))-k)];z=[V.indexOf(Math.min(...V))-1]}}else z=[0];for(const U of z){const V=n.containsTile(L,b,l,U);V&&x.push(V)}}return x}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(n){return this._getRenderableCoordinates(n)}_getRenderableCoordinates(n,l){const m=this.getRenderableIds(n,l).map(b=>this._tiles[b].tileID),x=this.transform.projection.name==="globe";for(const b of m)b.projMatrix=this.transform.calculateProjMatrix(b.toUnwrapped()),b.expandedProjMatrix=x?this.transform.calculateProjMatrix(b.toUnwrapped(),!1,!0):b.projMatrix;return m}sortCoordinatesByDistance(n){const l=n.slice(),m=this.transform._camera.position,x=this.transform._camera.forward(),b={};for(const T of l){const k=1/(1<<T.canonical.z);b[T.key]=((T.canonical.x+.5)*k+T.wrap-m[0])*x[0]+((T.canonical.y+.5)*k-m[1])*x[1]-m[2]*x[2]}return l.sort((T,k)=>b[T.key]-b[k.key]),l}hasTransition(){if(this._source.hasTransition())return!0;if(Qg(this._source.type))for(const n in this._tiles){const l=this._tiles[n];if(l.fadeEndTime!==void 0&&l.fadeEndTime>=s.q.now())return!0}return!1}setFeatureState(n,l,m){this._state.updateState(n=n||"_geojsonTileLayer",l,m)}removeFeatureState(n,l,m){this._state.removeFeatureState(n=n||"_geojsonTileLayer",l,m)}getFeatureState(n,l){return this._state.getState(n=n||"_geojsonTileLayer",l)}setDependencies(n,l,m){const x=this._tiles[n];x&&x.setDependencies(l,m)}reloadTilesForDependencies(n,l){for(const m in this._tiles)this._tiles[m].hasDependency(n,l)&&this._reloadTile(+m,"reloading");this._cache.filter(m=>!m.hasDependency(n,l))}_preloadTiles(n,l){if(!this._sourceLoaded){const j=()=>{this._sourceLoaded&&(this._source.off("data",j),this._preloadTiles(n,l))};return void this._source.on("data",j)}const m=new Map,x=Array.isArray(n)?n:[n],b=this.map.painter.terrain,T=this.usedForTerrain&&b?b.getScaledDemTileSize():this._source.tileSize;for(const j of x){const L=j.coveringTiles({tileSize:T,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const z of L)m.set(z.key,z);this.usedForTerrain&&j.updateElevation(!1)}const k=Array.from(m.values());s.bl(k,(j,L)=>{const z=new sa(j,this._source.tileSize*j.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(z,U=>{this._source.type==="raster-dem"&&z.dem&&this._backfillDEM(z),L(U,z)})},l)}}function _n(g,n){const l=Math.abs(2*g.wrap)-+(g.wrap<0),m=Math.abs(2*n.wrap)-+(n.wrap<0);return g.overscaledZ-n.overscaledZ||m-l||n.canonical.y-g.canonical.y||n.canonical.x-g.canonical.x}function Qg(g){return g==="raster"||g==="image"||g==="video"||g==="custom"}function ur(g,n){const l=1<<g.z;return[g.x/l+n,(g.x+1)/l+n]}Do.maxOverzooming=10,Do.maxUnderzooming=3;class a0{constructor(n){this.style=n,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const n=!1,l=!1;for(const m in this.style._mergedLayers){const x=this.style._mergedLayers[m];if(x.type==="fill-extrusion")this.layers.push({layer:x,visible:n,visibilityChanged:l});else if(x.type==="model"){const b=this.style.getLayerSource(x);b&&b.type==="batched-model"&&this.layers.push({layer:x,visible:n,visibilityChanged:l})}}}onNewFrame(n){this.layersGotHidden=!1;for(const l of this.layers){const m=l.layer;let x=!1;m.type==="fill-extrusion"?x=!m.isHidden(n)&&m.paint.get("fill-extrusion-opacity")>0:m.type==="model"&&(x=!m.isHidden(n)&&m.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!x&&l.visible,l.visible=x}}updateZOffset(n,l){this.currentBuildingBuckets=[];for(const x of this.layers){const b=x.layer,T=this.style.getLayerSourceCache(b);let k=1;b.type==="fill-extrusion"&&(k=x.visible?b.paint.get("fill-extrusion-vertical-scale"):0);let j=T?T.getTile(l):null;if(!j&&T&&l.canonical.z>T.getSource().minzoom){let L=l.scaledTo(Math.min(T.getSource().maxzoom,l.overscaledZ-1));for(;L.overscaledZ>=T.getSource().minzoom&&(j=T.getTile(L),!j&&L.overscaledZ!==0);)L=L.scaledTo(L.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:j?j.getBucket(b):null,tileID:j?j.tileID:l,verticalScale:k})}n.hasAnyZOffset=!1;let m=!1;for(let x=0;x<n.symbolInstances.length;x++){const b=n.symbolInstances.get(x),T=b.zOffset,k=this._getHeightAtTileOffset(l,b.tileAnchorX,b.tileAnchorY);b.zOffset=k!==Number.NEGATIVE_INFINITY?k:T,m||T===b.zOffset||(m=!0),n.hasAnyZOffset||b.zOffset===0||(n.hasAnyZOffset=!0)}m&&(n.zOffsetBuffersNeedUpload=!0,n.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(n,l,m,x){let b=l,T=m;if(n.canonical.z!==x.canonical.z){const k=x.canonical,j=1/(1<<n.canonical.z-k.z);b=(l+n.canonical.x*s.ai)*j-k.x*s.ai|0,T=(m+n.canonical.y*s.ai)*j-k.y*s.ai|0}return{tileX:b,tileY:T}}_getHeightAtTileOffset(n,l,m){let x,b;for(let T=0;T<this.layers.length;++T){if(this.layers[T].layer.type!=="fill-extrusion")continue;const{bucket:k,tileID:j,verticalScale:L}=this.currentBuildingBuckets[T];if(!k)continue;const{tileX:z,tileY:U}=this._mapCoordToOverlappingTile(n,l,m,j),V=k.getHeightAtTileCoord(z,U);V&&V.height!==void 0&&(V.hidden?x=V.height:b=Math.max(V.height*L,b||0))}if(b!==void 0)return b;for(let T=0;T<this.layers.length;++T){const k=this.layers[T];if(k.layer.type!=="model"||!k.visible)continue;const{bucket:j,tileID:L}=this.currentBuildingBuckets[T];if(!j)continue;const{tileX:z,tileY:U}=this._mapCoordToOverlappingTile(n,l,m,L),V=j.getHeightAtTileCoord(z,U);if(V&&!V.hidden)return V.height===void 0&&x!==void 0?Math.min(V.maxHeight,x)*V.verticalScale:V.height?V.height*V.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function l0(g,n){const l={};for(const m in g)m!=="ref"&&(l[m]=g[m]);return s.bm.forEach(m=>{m in n&&(l[m]=n[m])}),l}function Eh(g){g=g.slice();const n=Object.create(null);for(let l=0;l<g.length;l++)n[g[l].id]=g[l];for(let l=0;l<g.length;l++)"ref"in g[l]&&(g[l]=l0(g[l],n[g[l].ref]));return g}const Yr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Lo(g,n,l){l.push({command:Yr.addSource,args:[g,n[g]]})}function up(g,n,l){n.push({command:Yr.removeSource,args:[g]}),l[g]=!0}function Eu(g,n,l,m){up(g,l,m),Lo(g,n,l)}function er(g,n,l){let m;for(m in g[l])if(g[l].hasOwnProperty(m)&&m!=="data"&&!s.bn(g[l][m],n[l][m]))return!1;for(m in n[l])if(n[l].hasOwnProperty(m)&&m!=="data"&&!s.bn(g[l][m],n[l][m]))return!1;return!0}function fn(g,n,l,m,x,b){let T;for(T in n=n||{},g=g||{})g.hasOwnProperty(T)&&(s.bn(g[T],n[T])||l.push({command:b,args:[m,T,n[T],x]}));for(T in n)n.hasOwnProperty(T)&&!g.hasOwnProperty(T)&&(s.bn(g[T],n[T])||l.push({command:b,args:[m,T,n[T],x]}))}function Jr(g){return g.id}function Ms(g,n){return g[n.id]=n,g}class Cu{constructor(n,l){this.reset(n,l)}reset(n,l){this.points=n||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=s.ay(n,0,1);let l=1,m=this._distances[l];const x=n*this.paddedLength+this.padding;for(;m<x&&l<this._distances.length;)m=this._distances[++l];const b=l-1,T=this._distances[b],k=m-T,j=k>0?(x-T)/k:0;return this.points[b].mult(1-j).add(this.points[l].mult(j))}}class rn{constructor(n,l,m){const x=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(n/m),this.yCellCount=Math.ceil(l/m);for(let T=0;T<this.xCellCount*this.yCellCount;T++)x.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=l,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,l,m,x,b){this._forEachCell(l,m,x,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(l),this.bboxes.push(m),this.bboxes.push(x),this.bboxes.push(b)}insertCircle(n,l,m,x){this._forEachCell(l-x,m-x,l+x,m+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(l),this.circles.push(m),this.circles.push(x)}_insertBoxCell(n,l,m,x,b,T){this.boxCells[b].push(T)}_insertCircleCell(n,l,m,x,b,T){this.circleCells[b].push(T)}_query(n,l,m,x,b,T){if(m<0||n>this.width||x<0||l>this.height)return!b&&[];const k=[];if(n<=0&&l<=0&&this.width<=m&&this.height<=x){if(b)return!0;for(let j=0;j<this.boxKeys.length;j++)k.push({key:this.boxKeys[j],x1:this.bboxes[4*j],y1:this.bboxes[4*j+1],x2:this.bboxes[4*j+2],y2:this.bboxes[4*j+3]});for(let j=0;j<this.circleKeys.length;j++){const L=this.circles[3*j],z=this.circles[3*j+1],U=this.circles[3*j+2];k.push({key:this.circleKeys[j],x1:L-U,y1:z-U,x2:L+U,y2:z+U})}return T?k.filter(T):k}return this._forEachCell(n,l,m,x,this._queryCell,k,{hitTest:b,seenUids:{box:{},circle:{}}},T),b?k.length>0:k}_queryCircle(n,l,m,x,b){const T=n-m,k=n+m,j=l-m,L=l+m;if(k<0||T>this.width||L<0||j>this.height)return!x&&[];const z=[];return this._forEachCell(T,j,k,L,this._queryCellCircle,z,{hitTest:x,circle:{x:n,y:l,radius:m},seenUids:{box:{},circle:{}}},b),x?z.length>0:z}query(n,l,m,x,b){return this._query(n,l,m,x,!1,b)}hitTest(n,l,m,x,b){return this._query(n,l,m,x,!0,b)}hitTestCircle(n,l,m,x){return this._queryCircle(n,l,m,!0,x)}_queryCell(n,l,m,x,b,T,k,j){const L=k.seenUids,z=this.boxCells[b];if(z!==null){const V=this.bboxes;for(const Y of z)if(!L.box[Y]){L.box[Y]=!0;const te=4*Y;if(n<=V[te+2]&&l<=V[te+3]&&m>=V[te+0]&&x>=V[te+1]&&(!j||j(this.boxKeys[Y]))){if(k.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[Y],x1:V[te],y1:V[te+1],x2:V[te+2],y2:V[te+3]})}}}const U=this.circleCells[b];if(U!==null){const V=this.circles;for(const Y of U)if(!L.circle[Y]){L.circle[Y]=!0;const te=3*Y;if(this._circleAndRectCollide(V[te],V[te+1],V[te+2],n,l,m,x)&&(!j||j(this.circleKeys[Y]))){if(k.hitTest)return T.push(!0),!0;{const K=V[te],ne=V[te+1],se=V[te+2];T.push({key:this.circleKeys[Y],x1:K-se,y1:ne-se,x2:K+se,y2:ne+se})}}}}}_queryCellCircle(n,l,m,x,b,T,k,j){const L=k.circle,z=k.seenUids,U=this.boxCells[b];if(U!==null){const Y=this.bboxes;for(const te of U)if(!z.box[te]){z.box[te]=!0;const K=4*te;if(this._circleAndRectCollide(L.x,L.y,L.radius,Y[K+0],Y[K+1],Y[K+2],Y[K+3])&&(!j||j(this.boxKeys[te])))return T.push(!0),!0}}const V=this.circleCells[b];if(V!==null){const Y=this.circles;for(const te of V)if(!z.circle[te]){z.circle[te]=!0;const K=3*te;if(this._circlesCollide(Y[K],Y[K+1],Y[K+2],L.x,L.y,L.radius)&&(!j||j(this.circleKeys[te])))return T.push(!0),!0}}}_forEachCell(n,l,m,x,b,T,k,j){const L=this._convertToXCellCoord(n),z=this._convertToYCellCoord(l),U=this._convertToXCellCoord(m),V=this._convertToYCellCoord(x);for(let Y=L;Y<=U;Y++)for(let te=z;te<=V;te++)if(b.call(this,n,l,m,x,this.xCellCount*te+Y,T,k,j))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,l,m,x,b,T){const k=x-n,j=b-l,L=m+T;return L*L>k*k+j*j}_circleAndRectCollide(n,l,m,x,b,T,k){const j=(T-x)/2,L=Math.abs(n-(x+j));if(L>j+m)return!1;const z=(k-b)/2,U=Math.abs(l-(b+z));if(U>z+m)return!1;if(L<=j||U<=z)return!0;const V=L-j,Y=U-z;return V*V+Y*Y<=m*m}}const Qa={unknown:0,flipRequired:1,flipNotRequired:2},Ch=Math.tan(85*Math.PI/180);function el(g,n,l,m,x,b,T){const k=s.ad.mat4.create();if(l)if(b.name==="globe"){const j=s.bo(x,n);s.ad.mat4.multiply(k,k,j)}else{const j=s.ad.mat2.invert([],T);k[0]=j[0],k[1]=j[1],k[4]=j[2],k[5]=j[3],m||s.ad.mat4.rotateZ(k,k,x.angle)}else s.ad.mat4.multiply(k,x.labelPlaneMatrix,g);return k}function _s(g,n,l,m,x,b,T){const k=el(g,n,l,m,x,b,T);return b.name==="globe"&&l||(k[2]=k[6]=k[10]=k[14]=0),k}function bi(g,n,l,m,x,b,T){if(l){if(b.name==="globe"){const k=el(g,n,l,m,x,b,T);return s.ad.mat4.invert(k,k),s.ad.mat4.multiply(k,g,k),k}{const k=s.ad.mat4.clone(g),j=s.ad.mat4.identity([]);return j[0]=T[0],j[1]=T[1],j[4]=T[2],j[5]=T[3],s.ad.mat4.multiply(k,k,j),m||s.ad.mat4.rotateZ(k,k,-x.angle),k}}return x.glCoordMatrix}function oa(g,n,l,m){const x=[g,n,l,1];l?s.ad.vec4.transformMat4(x,x,m):ki(x,x,m);const b=x[3];return x[0]/=b,x[1]/=b,x[2]/=b,x}function Mu(g,n){return Math.min(.5+g/n*.5,1.5)}function e_(g,n){const l=g[0]/g[3],m=g[1]/g[3];return l>=-n[0]&&l<=n[0]&&m>=-n[1]&&m<=n[1]}function Au(g,n,l,m,x,b,T,k,j,L){const z=l.transform,U=m?g.textSizeData:g.iconSizeData,V=s.bp(U,l.transform.zoom),Y=z.projection.name==="globe",te=[256/l.width*2+1,256/l.height*2+1],K=m?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;K.clear();let ne=null;Y&&(ne=m?g.text.globeExtVertexArray:g.icon.globeExtVertexArray);const se=g.lineVertexArray,me=m?g.text.placedSymbolArray:g.icon.placedSymbolArray,xe=l.transform.width/l.transform.height;let ye,Ee=!1;for(let be=0;be<me.length;be++){const we=me.get(be),{numGlyphs:Te,writingMode:Pe}=we;if(Pe!==s.bq.vertical||Ee||ye===s.bq.horizontal||(Ee=!0),ye=Pe,(we.hidden||Pe===s.bq.vertical)&&!Ee){aa(Te,K);continue}Ee=!1;const Ne=new s.P(we.tileAnchorX,we.tileAnchorY);let{x:Ke,y:$e,z:lt}=z.projection.projectTilePoint(Ne.x,Ne.y,L.canonical);if(j){const[kt,Rt,Yt]=j(Ne);Ke+=kt,$e+=Rt,lt+=Yt}const dt=[Ke,$e,lt,1];if(s.ad.vec4.transformMat4(dt,dt,n),!e_(dt,te)){aa(Te,K);continue}const vt=dt[3],Ue=Mu(l.transform.getCameraToCenterDistance(z.projection),vt),at=s.br(U,V,we),Fe=T?at/Ue:at*Ue,ot=oa(Ke,$e,lt,x);if(ot[3]<=0){aa(Te,K);continue}let rt={};const ht=s.ak(g.layers[0].layout.get("text-max-angle")),Je=Math.cos(ht),mt=T?null:j,It=As(we,Fe,!1,k,n,x,b,g.glyphOffsetArray,se,K,ne,ot,Ne,rt,xe,mt,z.projection,L,T,Je);Ee=It.useVertical,mt&&It.needsFlipping&&(rt={}),(It.notEnoughRoom||Ee||It.needsFlipping&&As(we,Fe,!0,k,n,x,b,g.glyphOffsetArray,se,K,ne,ot,Ne,rt,xe,mt,z.projection,L,T,Je).notEnoughRoom)&&aa(Te,K)}m?(g.text.dynamicLayoutVertexBuffer.updateData(K),ne&&g.text.globeExtVertexBuffer&&g.text.globeExtVertexBuffer.updateData(ne)):(g.icon.dynamicLayoutVertexBuffer.updateData(K),ne&&g.icon.globeExtVertexBuffer&&g.icon.globeExtVertexBuffer.updateData(ne))}function dp(g,n,l,m,x,b,T,k,j,L,z,U,V,Y,te,K,ne){const{lineStartIndex:se,glyphStartIndex:me,segment:xe}=k,ye=me+k.numGlyphs,Ee=se+k.lineLength,be=n.getoffsetX(me),we=n.getoffsetX(ye-1),Te=Ah(g*be,l,m,x,b,T,xe,se,Ee,j,L,z,U,V,!0,Y,te,K,ne);if(!Te)return null;const Pe=Ah(g*we,l,m,x,b,T,xe,se,Ee,j,L,z,U,V,!0,Y,te,K,ne);return Pe?{first:Te,last:Pe}:null}function Mh(g,n,l,m){return g===s.bq.horizontal&&Math.abs(m)>Math.abs(l)?{useVertical:!0}:g===s.bq.vertical?m>0?{needsFlipping:!0}:null:n!==Qa.unknown&&function(x,b){return x===0||Math.abs(b/x)>Ch}(l,m)?n===Qa.flipRequired?{needsFlipping:!0}:null:l<0?{needsFlipping:!0}:null}function As(g,n,l,m,x,b,T,k,j,L,z,U,V,Y,te,K,ne,se,me,xe){const ye=n/24,Ee=g.lineOffsetX*ye,be=g.lineOffsetY*ye,{lineStartIndex:we,glyphStartIndex:Te,numGlyphs:Pe,segment:Ne,writingMode:Ke,flipState:$e}=g,lt=we+g.lineLength,dt=vt=>{if(z){const[ot,rt,ht]=vt.up,Je=L.length;s.bs(z,Je+0,ot,rt,ht),s.bs(z,Je+1,ot,rt,ht),s.bs(z,Je+2,ot,rt,ht),s.bs(z,Je+3,ot,rt,ht)}const[Ue,at,Fe]=vt.point;s.bt(L,Ue,at,Fe,vt.angle)};if(Pe>1){const vt=dp(ye,k,Ee,be,l,U,V,g,j,b,Y,K,!1,ne,se,me,xe);if(!vt)return{notEnoughRoom:!0};if(m&&!l){let[Ue,at,Fe]=vt.first.point,[ot,rt,ht]=vt.last.point;[Ue,at]=oa(Ue,at,Fe,T),[ot,rt]=oa(ot,rt,ht,T);const Je=Mh(Ke,$e,(ot-Ue)*te,rt-at);if(g.flipState=Je&&Je.needsFlipping?Qa.flipRequired:Qa.flipNotRequired,Je)return Je}dt(vt.first);for(let Ue=Te+1;Ue<Te+Pe-1;Ue++){const at=Ah(ye*k.getoffsetX(Ue),Ee,be,l,U,V,Ne,we,lt,j,b,Y,K,!1,!1,ne,se,me,xe);if(!at)return L.length-=4*(Ue-Te),{notEnoughRoom:!0};dt(at)}dt(vt.last)}else{if(m&&!l){const Ue=oa(V.x,V.y,0,x),at=we+Ne+1,Fe=new s.P(j.getx(at),j.gety(at)),ot=oa(Fe.x,Fe.y,0,x),rt=ot[3]>0?ot:Ps(V,Fe,Ue,1,x,void 0,ne,se.canonical),ht=Mh(Ke,$e,(rt[0]-Ue[0])*te,rt[1]-Ue[1]);if(g.flipState=ht&&ht.needsFlipping?Qa.flipRequired:Qa.flipNotRequired,ht)return ht}const vt=Ah(ye*k.getoffsetX(Te),Ee,be,l,U,V,Ne,we,lt,j,b,Y,K,!1,!1,ne,se,me,xe);if(!vt)return{notEnoughRoom:!0};dt(vt)}return{}}function Na(g,n,l,m,x){const{x:b,y:T,z:k}=m.projectTilePoint(g.x,g.y,n);if(!x)return oa(b,T,k,l);const[j,L,z]=x(g);return oa(b+j,T+L,k+z,l)}function Ps(g,n,l,m,x,b,T,k){const j=Na(g.sub(n)._unit()._add(g),k,x,T,b);return s.ad.vec3.sub(j,l,j),s.ad.vec3.normalize(j,j),s.ad.vec3.scaleAndAdd(j,l,j,m)}function Ah(g,n,l,m,x,b,T,k,j,L,z,U,V,Y,te,K,ne,se,me){const xe=m?g-n:g+n;let ye=xe>0?1:-1,Ee=0;m&&(ye*=-1,Ee=Math.PI),ye<0&&(Ee+=Math.PI);let be=k+T+(ye>0?0:1)|0,we=x,Te=x,Pe=0,Ne=0;const Ke=Math.abs(xe),$e=[],lt=[];let dt=b,vt=dt,Ue=s.ad.vec3.zero([]);const at=()=>Ps(vt,dt,Te,Ke-Pe+1,z,V,K,ne.canonical);for(;Pe+Ne<=Ke;){if(be+=ye,be<k||be>=j)return null;if(Te=we,vt=dt,$e.push(Te),Y&&lt.push(vt),dt=new s.P(L.getx(be),L.gety(be)),we=U[be],!we){const Yt=Na(dt,ne.canonical,z,K,V);we=Yt[3]>0?U[be]=Yt:at()}Pe+=Ne;const kt=s.ad.vec3.sub([],we,Te),Rt=s.ad.vec3.distance(Te,we);if(l&&Rt>0&&Ne>0&&s.ad.vec3.dot(Ue,kt)/(Ne*Rt)<me)return null;Ne=Rt,Ue=kt}te&&V&&(U[be]&&(we=at(),Ne=s.ad.vec3.distance(Te,we),Ue=s.ad.vec3.sub([],we,Te)),U[be]=we);const Fe=(Ke-Pe)/Ne,ot=dt.sub(vt)._mult(Fe)._add(vt),rt=s.ad.vec3.scaleAndAdd([],Te,Ue,Fe);let ht=[0,0,1],Je=Ue[0],mt=Ue[1];if(se&&(ht=K.upVector(ne.canonical,ot.x,ot.y),ht[0]!==0||ht[1]!==0||ht[2]!==1)){const kt=[ht[2],0,-ht[0]],Rt=s.ad.vec3.cross([],ht,kt);s.ad.vec3.normalize(kt,kt),s.ad.vec3.normalize(Rt,Rt),Je=s.ad.vec3.dot(Ue,kt),mt=s.ad.vec3.dot(Ue,Rt)}if(l){const kt=s.ad.vec3.cross([],ht,Ue);s.ad.vec3.normalize(kt,kt),s.ad.vec3.scaleAndAdd(rt,rt,kt,l*ye)}const It=Ee+Math.atan2(mt,Je);return $e.push(rt),Y&&lt.push(ot),{point:rt,angle:It,path:$e,tilePath:lt,up:ht}}function aa(g,n){const l=n.length,m=l+4*g;n.resize(m),n.float32.fill(-1/0,4*l,4*m)}function ki(g,n,l){const m=n[0],x=n[1];return g[0]=l[0]*m+l[4]*x+l[12],g[1]=l[1]*m+l[5]*x+l[13],g[3]=l[3]*m+l[7]*x+l[15],g}const Qi=100;class tl{constructor(n,l,m=new rn(n.width+200,n.height+200,25),x=new rn(n.width+200,n.height+200,25)){this.transform=n,this.grid=m,this.ignoredGrid=x,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+Qi,this.screenBottomBoundary=n.height+Qi,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=l}placeCollisionBox(n,l,m,x,b,T,k,j){let L=m.projectedAnchorX,z=m.projectedAnchorY,U=m.projectedAnchorZ;const V=m.elevation,Y=m.tileID,te=n.getProjection();if(V&&Y){const[be,we,Te]=te.upVector(Y.canonical,m.tileAnchorX,m.tileAnchorY),Pe=te.upVectorScale(Y.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;L+=be*V*Pe,z+=we*V*Pe,U+=Te*V*Pe}const K=this.projectAndGetPerspectiveRatio(k,L,z,U,m.tileID,te.name==="globe"||!!V||this.transform.pitch>0,te),ne=T*K.perspectiveRatio,se=(m.x1*l+x.x-m.padding)*ne+K.point.x,me=(m.y1*l+x.y-m.padding)*ne+K.point.y,xe=(m.x2*l+x.x+m.padding)*ne+K.point.x,ye=(m.y2*l+x.y+m.padding)*ne+K.point.y,Ee=K.perspectiveRatio<=.55||K.occluded;return!this.isInsideGrid(se,me,xe,ye)||!b&&this.grid.hitTest(se,me,xe,ye,j)||Ee?{box:[],offscreen:!1,occluded:K.occluded}:{box:[se,me,xe,ye],offscreen:this.isOffscreen(se,me,xe,ye),occluded:!1}}placeCollisionCircles(n,l,m,x,b,T,k,j,L,z,U,V,Y,te,K){const ne=[],se=this.transform.elevation,me=n.getProjection(),xe=se?se.getAtTileOffsetFunc(K,this.transform.center.lat,this.transform.worldSize,me):null,ye=new s.P(m.tileAnchorX,m.tileAnchorY);let{x:Ee,y:be,z:we}=me.projectTilePoint(ye.x,ye.y,K.canonical);if(xe){const[ht,Je,mt]=xe(ye);Ee+=ht,be+=Je,we+=mt}const Te=me.name==="globe",Pe=this.projectAndGetPerspectiveRatio(k,Ee,be,we,K,Te||!!se||this.transform.pitch>0,me),{perspectiveRatio:Ne}=Pe,Ke=(U?T/Ne:T*Ne)/s.bw,$e=oa(Ee,be,we,j),lt=m.lineOffsetX*Ke,dt=m.lineOffsetY*Ke,vt=s.ak(n.layers[0].layout.get("text-max-angle")),Ue=Math.cos(vt),at=Pe.signedDistanceFromCamera>0?dp(Ke,b,lt,dt,!1,$e,ye,m,x,j,{},se&&!U?xe:null,U&&!!se,me,K,U,Ue):null;let Fe=!1,ot=!1,rt=!0;if(at&&!Pe.occluded){const ht=.5*Y*Ne+te,Je=new s.P(-100,-100),mt=new s.P(this.screenRightBoundary,this.screenBottomBoundary),It=new Cu,{first:kt,last:Rt}=at,Yt=kt.path.length;let Tr=[];for(let pr=Yt-1;pr>=1;pr--)Tr.push(kt.path[pr]);for(let pr=1;pr<Rt.path.length;pr++)Tr.push(Rt.path[pr]);const cr=2.5*ht;L&&(Tr=Tr.map(([pr,Gr,on],Rn)=>(xe&&!Te&&(on=xe(Rn<Yt-1?kt.tilePath[Yt-1-Rn]:Rt.tilePath[Rn-Yt+2])[2]),oa(pr,Gr,on,L))),Tr.some(pr=>pr[3]<=0)&&(Tr=[]));let yr=[];if(Tr.length>0){let pr=1/0,Gr=-1/0,on=1/0,Rn=-1/0;for(const Lr of Tr)pr=Math.min(pr,Lr[0]),on=Math.min(on,Lr[1]),Gr=Math.max(Gr,Lr[0]),Rn=Math.max(Rn,Lr[1]);Gr>=Je.x&&pr<=mt.x&&Rn>=Je.y&&on<=mt.y&&(yr=[Tr.map(Lr=>new s.P(Lr[0],Lr[1]))],(pr<Je.x||Gr>mt.x||on<Je.y||Rn>mt.y)&&(yr=s.bu(yr,Je.x,Je.y,mt.x,mt.y)))}for(const pr of yr){It.reset(pr,.25*ht);let Gr=0;Gr=It.length<=.5*ht?1:Math.ceil(It.paddedLength/cr)+1;for(let on=0;on<Gr;on++){const Rn=on/Math.max(Gr-1,1),Lr=It.lerp(Rn),Wn=Lr.x+Qi,Ar=Lr.y+Qi;ne.push(Wn,Ar,ht,0);const Xt=Wn-ht,Hr=Ar-ht,yn=Wn+ht,Qr=Ar+ht;if(rt=rt&&this.isOffscreen(Xt,Hr,yn,Qr),ot=ot||this.isInsideGrid(Xt,Hr,yn,Qr),!l&&this.grid.hitTestCircle(Wn,Ar,ht,V)&&(Fe=!0,!z))return{circles:[],offscreen:!1,collisionDetected:Fe,occluded:!1}}}}return{circles:!z&&Fe||!ot?[]:ne,offscreen:rt,collisionDetected:Fe,occluded:Pe.occluded}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const l=[];let m=1/0,x=1/0,b=-1/0,T=-1/0;for(const z of n){const U=new s.P(z.x+Qi,z.y+Qi);m=Math.min(m,U.x),x=Math.min(x,U.y),b=Math.max(b,U.x),T=Math.max(T,U.y),l.push(U)}const k=this.grid.query(m,x,b,T).concat(this.ignoredGrid.query(m,x,b,T)),j={},L={};for(const z of k){const U=z.key;if(j[U.bucketInstanceId]===void 0&&(j[U.bucketInstanceId]={}),j[U.bucketInstanceId][U.featureIndex])continue;const V=[new s.P(z.x1,z.y1),new s.P(z.x2,z.y1),new s.P(z.x2,z.y2),new s.P(z.x1,z.y2)];s.bv(l,V)&&(j[U.bucketInstanceId][U.featureIndex]=!0,L[U.bucketInstanceId]===void 0&&(L[U.bucketInstanceId]=[]),L[U.bucketInstanceId].push(U.featureIndex))}return L}insertCollisionBox(n,l,m,x,b){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:x,collisionGroupID:b},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,l,m,x,b){const T=l?this.ignoredGrid:this.grid,k={bucketInstanceId:m,featureIndex:x,collisionGroupID:b};for(let j=0;j<n.length;j+=4)T.insertCircle(k,n[j],n[j+1],n[j+2])}projectAndGetPerspectiveRatio(n,l,m,x,b,T,k){const j=[l,m,x,1];let L=!1;x||this.transform.pitch>0?(s.ad.vec4.transformMat4(j,j,n),this.fogState&&b&&k.name!=="globe"&&(L=function(V,Y,te,K,ne,se){const me=se.calculateFogTileMatrix(ne),xe=[Y,te,K];return s.ad.vec3.transformMat4(xe,xe,me),Vt(V,s.ad.vec3.length(xe),se.pitch,se._fov)}(this.fogState,l,m,x,b.toUnwrapped(),this.transform)>.9)):ki(j,j,n);const z=j[3];return{point:new s.P((j[0]/z+1)/2*this.transform.width+Qi,(-j[1]/z+1)/2*this.transform.height+Qi),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(k)/z*.5,1.5),signedDistanceFromCamera:z,occluded:T&&j[2]>z||L}}isOffscreen(n,l,m,x){return m<Qi||n>=this.screenRightBoundary||x<Qi||l>this.screenBottomBoundary}isInsideGrid(n,l,m,x){return m>=0&&n<this.gridRightBoundary&&x>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const n=s.ad.mat4.identity([]);return s.ad.mat4.translate(n,n,[-100,-100,0]),n}}function Si(g,n,l){const m=n.createTileMatrix(g,g.worldSize,l.toUnwrapped());return s.ad.mat4.multiply(new Float32Array(16),g.projMatrix,m)}function t_(g,n,l){if(n.projection.name===l.projection.name)return g.projMatrix;const m=l.clone();return m.setProjection(n.projection),Si(m,n.getProjection(),g)}function fo(g,n,l){return n.name===l.projection.name?g.projMatrix:Si(l,n,g)}class Pu{constructor(n,l,m,x){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?l:-l))):x&&m?1:0,this.placed=m}isHidden(){return this.opacity===0&&!this.placed}}class Wl{constructor(n,l,m,x,b,T=!1){this.text=new Pu(n?n.text:null,l,m,b),this.icon=new Pu(n?n.icon:null,l,x,b),this.clipped=T}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class rl{constructor(n,l,m,x=!1){this.text=n,this.icon=l,this.skipFade=m,this.clipped=x}}class eS{constructor(){this.invProjMatrix=s.ad.mat4.create(),this.viewportMatrix=s.ad.mat4.create(),this.circles=[]}}class nl{constructor(n,l,m,x,b){this.bucketInstanceId=n,this.featureIndex=l,this.sourceLayerIndex=m,this.bucketIndex=x,this.tileID=b}}class tS{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const l=++this.maxGroupID;this.collisionGroups[n]={ID:l,predicate:m=>m.collisionGroupID===l}}return this.collisionGroups[n]}}function hp(g,n,l,m,x){const{horizontalAlign:b,verticalAlign:T}=s.bD(g),k=-(b-.5)*n,j=-(T-.5)*l,L=s.bC(g,m);return new s.P(k+L[0]*x,j+L[1]*x)}function Ls(g,n,l,m,x){const b=new s.P(g,n);return l&&b._rotate(m?x:-x),b}class rS{constructor(n,l,m,x,b,T){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new tl(this.transform,b),this.buildingIndex=T,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new tS(m),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,l,m,x,b=1){const T=m.getBucket(l),k=m.latestFeatureIndex;if(!T||!k||l.fqid!==T.layerIds[0])return;const j=T.layers[0].layout,L=T.layers[0].paint,z=m.collisionBoxArray,U=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),V=m.tileSize/s.ai,Y=m.tileID.toUnwrapped();this.transform.setProjection(T.projection);const te=(K=m.tileID,ne=T.getProjection(),se=this.transform,ne.name===this.projection?se.calculateProjMatrix(K.toUnwrapped()):Si(se,ne,K));var K,ne,se;const me=j.get("text-pitch-alignment")==="map",xe=j.get("text-rotation-alignment")==="map";l.compileFilter(l.options);const ye=l.dynamicFilter(),Ee=l.dynamicFilterNeedsFeature(),be=this.transform.calculatePixelsToTileUnitsMatrix(m),we=_s(te,m.tileID.canonical,me,xe,this.transform,T.getProjection(),be);let Te=null;if(me){const at=bi(te,m.tileID.canonical,me,xe,this.transform,T.getProjection(),be);Te=s.ad.mat4.multiply([],this.transform.labelPlaneMatrix,at)}let Pe=null;ye&&m.latestFeatureIndex&&(Pe={unwrappedTileID:Y,dynamicFilter:ye,dynamicFilterNeedsFeature:Ee}),this.retainedQueryData[T.bucketInstanceId]=new nl(T.bucketInstanceId,k,T.sourceLayerIndex,T.index,m.tileID);const[Ne,Ke]=T.layers[0].layout.get("text-size-scale-range"),$e=s.ay(b,Ne,Ke),[lt,dt]=j.get("icon-size-scale-range"),vt=s.ay(b,lt,dt),Ue={bucket:T,layout:j,paint:L,posMatrix:te,textLabelPlaneMatrix:we,labelToScreenMatrix:Te,clippingData:Pe,scale:U,textPixelRatio:V,holdingForFade:m.holdingForFade(),collisionBoxArray:z,partiallyEvaluatedTextSize:s.bp(T.textSizeData,this.transform.zoom,$e),partiallyEvaluatedIconSize:s.bp(T.iconSizeData,this.transform.zoom,vt),collisionGroup:this.collisionGroups.get(T.sourceID),latestFeatureIndex:m.latestFeatureIndex};if(x)for(const at of T.sortKeyRanges){const{sortKey:Fe,symbolInstanceStart:ot,symbolInstanceEnd:rt}=at;n.push({sortKey:Fe,symbolInstanceStart:ot,symbolInstanceEnd:rt,parameters:Ue})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:Ue})}attemptAnchorPlacement(n,l,m,x,b,T,k,j,L,z,U,V,Y,te,K,ne,se,me){const{textOffset0:xe,textOffset1:ye,crossTileID:Ee}=V,be=[xe,ye],we=hp(n,m,x,be,b),Te=this.collisionIndex.placeCollisionBox(te,b,l,Ls(we.x,we.y,T,k,this.transform.angle),U,j,L,z.predicate);if(ne){const Pe=te.getSymbolInstanceIconSize(me,this.transform.zoom,V.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(te,Pe,ne,Ls(we.x,we.y,T,k,this.transform.angle),U,j,L,z.predicate).box.length===0)return}if(Te.box.length>0){let Pe;return this.prevPlacement&&this.prevPlacement.variableOffsets[Ee]&&this.prevPlacement.placements[Ee]&&this.prevPlacement.placements[Ee].text&&(Pe=this.prevPlacement.variableOffsets[Ee].anchor),this.variableOffsets[Ee]={textOffset:be,width:m,height:x,anchor:n,textScale:b,prevAnchor:Pe},this.markUsedJustification(te,n,V,K),te.allowVerticalPlacement&&(this.markUsedOrientation(te,K,V),this.placedOrientations[Ee]=K),{shift:we,placedGlyphBoxes:Te}}}placeLayerBucketPart(n,l,m,x,b=1){const{bucket:T,layout:k,paint:j,posMatrix:L,textLabelPlaneMatrix:z,labelToScreenMatrix:U,clippingData:V,textPixelRatio:Y,holdingForFade:te,collisionBoxArray:K,partiallyEvaluatedTextSize:ne,partiallyEvaluatedIconSize:se,collisionGroup:me,latestFeatureIndex:xe}=n.parameters,ye=k.get("text-optional"),Ee=k.get("icon-optional"),be=k.get("text-allow-overlap"),we=k.get("icon-allow-overlap"),Te=k.get("text-rotation-alignment")==="map",Pe=k.get("text-pitch-alignment")==="map",Ne=j.get("symbol-z-offset"),Ke=k.get("symbol-elevation-reference")==="sea",[$e,lt]=k.get("text-size-scale-range"),[dt,vt]=k.get("icon-size-scale-range"),Ue=s.ay(b,$e,lt),at=s.ay(b,dt,vt);this.transform.setProjection(T.projection);let Fe=be&&(we||!T.hasIconData()||Ee),ot=we&&(be||!T.hasTextData()||ye);const rt=!Ne.isConstant();!T.collisionArrays&&K&&T.deserializeCollisionBoxes(K),m&&x&&T.updateCollisionDebugBuffers(this.transform.zoom,K,Ue,at);const ht=(Je,mt,It)=>{const{crossTileID:kt,numVerticalGlyphVertices:Rt}=Je;let Yt=null;if(V&&V.dynamicFilterNeedsFeature||rt){const Xr=this.retainedQueryData[T.bucketInstanceId];Yt=xe.loadFeature({featureIndex:Je.featureIndex,bucketIndex:Xr.bucketIndex,sourceLayerIndex:Xr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(V&&!(0,V.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},Yt,this.retainedQueryData[T.bucketInstanceId].tileID.canonical,new s.P(Je.tileAnchorX,Je.tileAnchorY),this.transform.calculateDistanceTileData(V.unwrappedTileID)))return this.placements[kt]=new rl(!1,!1,!1,!0),void l.add(kt);const Tr=Ne.evaluate(Yt,{});if(l.has(kt))return;if(te)return void(this.placements[kt]=new rl(!1,!1,!1));let cr=!1,yr=!1,pr=!0,Gr=!1,on=!1,Rn=null,Lr={box:null,offscreen:null,occluded:null},Wn={box:null,offscreen:null,occluded:null},Ar=null,Xt=null,Hr=null,yn=0,Qr=0,ai=0;It.textFeatureIndex?yn=It.textFeatureIndex:Je.useRuntimeCollisionCircles&&(yn=Je.featureIndex),It.verticalTextFeatureIndex&&(Qr=It.verticalTextFeatureIndex);const Ei=Xr=>{Xr.tileID=this.retainedQueryData[T.bucketInstanceId].tileID;const Zn=this.transform.elevation;Xr.elevation=Ke?Tr:Tr+(Zn?Zn.getAtTileOffset(Xr.tileID,Xr.tileAnchorX,Xr.tileAnchorY):0),Xr.elevation+=Je.zOffset},zi=It.textBox;if(zi){Ei(zi);const Xr=an=>{let Cn=s.bq.horizontal;if(T.allowVerticalPlacement&&!an&&this.prevPlacement){const us=this.prevPlacement.placedOrientations[kt];us&&(this.placedOrientations[kt]=us,Cn=us,this.markUsedOrientation(T,Cn,Je))}return Cn},Zn=(an,Cn)=>{if(T.allowVerticalPlacement&&Rt>0&&It.verticalTextBox){for(const us of T.writingModes)if(us===s.bq.vertical?(Lr=Cn(),Wn=Lr):Lr=an(),Lr&&Lr.box&&Lr.box.length)break}else Lr=an()};if(k.get("text-variable-anchor")){let an=k.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[kt]){const Un=this.prevPlacement.variableOffsets[kt];an.indexOf(Un.anchor)>0&&(an=an.filter(Fi=>Fi!==Un.anchor),an.unshift(Un.anchor))}const Cn=(Un,Fi,Oa)=>{const Qs=T.getSymbolInstanceTextSize(ne,Je,this.transform.zoom,mt),Vo=(Un.x2-Un.x1)*Qs+2*Un.padding,Gs=(Un.y2-Un.y1)*Qs+2*Un.padding,Uo=Je.hasIconTextFit&&!we?Fi:null;Uo&&Ei(Uo);let eo={box:[],offscreen:!1,occluded:!1};const fl=be?2*an.length:an.length;for(let za=0;za<fl;++za){const pl=this.attemptAnchorPlacement(an[za%an.length],Un,Vo,Gs,Qs,Te,Pe,Y,L,me,za>=an.length,Je,mt,T,Oa,Uo,ne,se);if(pl&&(eo=pl.placedGlyphBoxes,eo&&eo.box&&eo.box.length)){cr=!0,Rn=pl.shift;break}}return eo};Zn(()=>Cn(zi,It.iconBox,s.bq.horizontal),()=>{const Un=It.verticalTextBox;return Un&&Ei(Un),T.allowVerticalPlacement&&!(Lr&&Lr.box&&Lr.box.length)&&Rt>0&&Un?Cn(Un,It.verticalIconBox,s.bq.vertical):{box:null,offscreen:null,occluded:null}}),Lr&&(cr=Lr.box,pr=Lr.offscreen,Gr=Lr.occluded);const us=Xr(!(!Lr||!Lr.box));if(!cr&&this.prevPlacement){const Un=this.prevPlacement.variableOffsets[kt];Un&&(this.variableOffsets[kt]=Un,this.markUsedJustification(T,Un.anchor,Je,us))}}else{const an=(Cn,us)=>{const Un=T.getSymbolInstanceTextSize(ne,Je,this.transform.zoom,mt,b),Fi=this.collisionIndex.placeCollisionBox(T,Un,Cn,new s.P(0,0),be,Y,L,me.predicate);return Fi&&Fi.box&&Fi.box.length&&(this.markUsedOrientation(T,us,Je),this.placedOrientations[kt]=us),Fi};Zn(()=>an(zi,s.bq.horizontal),()=>{const Cn=It.verticalTextBox;return T.allowVerticalPlacement&&Rt>0&&Cn?(Ei(Cn),an(Cn,s.bq.vertical)):{box:null,offscreen:null,occluded:null}}),Xr(!!(Lr&&Lr.box&&Lr.box.length))}}if(Ar=Lr,cr=Ar&&Ar.box&&Ar.box.length>0,pr=Ar&&Ar.offscreen,Gr=Ar&&Ar.occluded,Je.useRuntimeCollisionCircles){const Xr=T.text.placedSymbolArray.get(Je.centerJustifiedTextSymbolIndex>=0?Je.centerJustifiedTextSymbolIndex:Je.verticalPlacedTextSymbolIndex),Zn=s.br(T.textSizeData,ne,Xr),an=k.get("text-padding");Xt=this.collisionIndex.placeCollisionCircles(T,be,Xr,T.lineVertexArray,T.glyphOffsetArray,Zn,L,z,U,m,Pe,me.predicate,Je.collisionCircleDiameter*Zn/s.bw,an,this.retainedQueryData[T.bucketInstanceId].tileID),cr=be||Xt.circles.length>0&&!Xt.collisionDetected,pr=pr&&Xt.offscreen,Gr=Xt.occluded}if(It.iconFeatureIndex&&(ai=It.iconFeatureIndex),It.iconBox){const Xr=Zn=>{Ei(Zn);const an=Je.hasIconTextFit&&Rn?Ls(Rn.x,Rn.y,Te,Pe,this.transform.angle):new s.P(0,0),Cn=T.getSymbolInstanceIconSize(se,this.transform.zoom,Je.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(T,Cn,Zn,an,we,Y,L,me.predicate)};Wn&&Wn.box&&Wn.box.length&&It.verticalIconBox?(Hr=Xr(It.verticalIconBox),yr=Hr.box.length>0):(Hr=Xr(It.iconBox),yr=Hr.box.length>0),pr=pr&&Hr.offscreen,on=Hr.occluded}const Ui=ye||Je.numHorizontalGlyphVertices===0&&Rt===0,yo=Ee||Je.numIconVertices===0;if(Ui||yo?yo?Ui||(yr=yr&&cr):cr=yr&&cr:yr=cr=yr&&cr,cr&&Ar&&Ar.box&&this.collisionIndex.insertCollisionBox(Ar.box,k.get("text-ignore-placement"),T.bucketInstanceId,Wn&&Wn.box&&Qr?Qr:yn,me.ID),yr&&Hr&&this.collisionIndex.insertCollisionBox(Hr.box,k.get("icon-ignore-placement"),T.bucketInstanceId,ai,me.ID),Xt&&(cr&&this.collisionIndex.insertCollisionCircles(Xt.circles,k.get("text-ignore-placement"),T.bucketInstanceId,yn,me.ID),m)){const Xr=T.bucketInstanceId;let Zn=this.collisionCircleArrays[Xr];Zn===void 0&&(Zn=this.collisionCircleArrays[Xr]=new eS);for(let an=0;an<Xt.circles.length;an+=4)Zn.circles.push(Xt.circles[an+0]),Zn.circles.push(Xt.circles[an+1]),Zn.circles.push(Xt.circles[an+2]),Zn.circles.push(Xt.collisionDetected?1:0)}const Is=T.projection.name!=="globe";Fe=Fe&&(Is||!Gr),ot=ot&&(Is||!on),this.placements[kt]=new rl(cr||Fe,yr||ot,pr||T.justReloaded),l.add(kt)};if(T.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(T,this.retainedQueryData[T.bucketInstanceId].tileID),T.elevationType==="road"&&T.updateRoadElevation(),T.updateZOffset(),T.sortFeaturesByY){const Je=T.getSortedSymbolIndexes(this.transform.angle);for(let mt=Je.length-1;mt>=0;--mt){const It=Je[mt];ht(T.symbolInstances.get(It),It,T.collisionArrays[It])}T.hasAnyZOffset&&s.w(`${T.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(T.hasAnyZOffset){const Je=T.getSortedIndexesByZOffset();for(let mt=0;mt<Je.length;++mt){const It=Je[mt];ht(T.symbolInstances.get(It),It,T.collisionArrays[It])}}else for(let Je=n.symbolInstanceStart;Je<n.symbolInstanceEnd;Je++)ht(T.symbolInstances.get(Je),Je,T.collisionArrays[Je]);if(m&&T.bucketInstanceId in this.collisionCircleArrays){const Je=this.collisionCircleArrays[T.bucketInstanceId];s.ad.mat4.invert(Je.invProjMatrix,L),Je.viewportMatrix=this.collisionIndex.getViewportMatrix()}T.justReloaded=!1}markUsedJustification(n,l,m,x){const{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:T,rightJustifiedTextSymbolIndex:k,verticalPlacedTextSymbolIndex:j,crossTileID:L}=m,z=s.bB(l),U=x===s.bq.vertical?j:z==="left"?b:z==="center"?T:z==="right"?k:-1;b>=0&&(n.text.placedSymbolArray.get(b).crossTileID=U>=0&&b!==U?0:L),T>=0&&(n.text.placedSymbolArray.get(T).crossTileID=U>=0&&T!==U?0:L),k>=0&&(n.text.placedSymbolArray.get(k).crossTileID=U>=0&&k!==U?0:L),j>=0&&(n.text.placedSymbolArray.get(j).crossTileID=U>=0&&j!==U?0:L)}markUsedOrientation(n,l,m){const x=l===s.bq.horizontal||l===s.bq.horizontalOnly?l:0,b=l===s.bq.vertical?l:0,{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:k,rightJustifiedTextSymbolIndex:j,verticalPlacedTextSymbolIndex:L}=m,z=n.text.placedSymbolArray;T>=0&&(z.get(T).placedOrientation=x),k>=0&&(z.get(k).placedOrientation=x),j>=0&&(z.get(j).placedOrientation=x),L>=0&&(z.get(L).placedOrientation=b)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let m=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const x=l?l.symbolFadeChange(n):1,b=l?l.opacities:{},T=l?l.variableOffsets:{},k=l?l.placedOrientations:{};for(const j in this.placements){const L=this.placements[j],z=b[j];z?(this.opacities[j]=new Wl(z,x,L.text,L.icon,null,L.clipped),m=m||L.text!==z.text.placed||L.icon!==z.icon.placed):(this.opacities[j]=new Wl(null,x,L.text,L.icon,L.skipFade,L.clipped),m=m||L.text||L.icon)}for(const j in b){const L=b[j];if(!this.opacities[j]){const z=new Wl(L,x,!1,!1);z.isHidden()||(this.opacities[j]=z,m=m||L.text.placed||L.icon.placed)}}for(const j in T)this.variableOffsets[j]||!this.opacities[j]||this.opacities[j].isHidden()||(this.variableOffsets[j]=T[j]);for(const j in k)this.placedOrientations[j]||!this.opacities[j]||this.opacities[j].isHidden()||(this.placedOrientations[j]=k[j]);m?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:n)}updateLayerOpacities(n,l,m,x){const b=new Set;for(const T of l){const k=T.getBucket(n);k&&T.latestFeatureIndex&&n.fqid===k.layerIds[0]&&(this.updateBucketOpacities(k,b,T,T.collisionBoxArray,m,x,T.tileID,n.scope),k.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(k,T.tileID),k.elevationType==="road"&&k.updateRoadElevation(),k.updateZOffset())}}updateBucketOpacities(n,l,m,x,b,T,k,j){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const L=n.layers[0].layout,z=n.layers[0].paint,U=!!n.layers[0].dynamicFilter(),V=new Wl(null,0,!1,!1,!0),Y=L.get("text-allow-overlap"),te=L.get("icon-allow-overlap"),K=L.get("text-variable-anchor"),ne=L.get("text-rotation-alignment")==="map",se=L.get("text-pitch-alignment")==="map",me=z.get("symbol-z-offset"),xe=L.get("symbol-elevation-reference")==="sea",ye=!me.isConstant(),Ee=new Wl(null,0,Y&&(te||!n.hasIconData()||L.get("icon-optional")),te&&(Y||!n.hasTextData()||L.get("text-optional")),!0);!n.collisionArrays&&x&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(x);const be=(Te,Pe,Ne)=>{for(let Ke=0;Ke<Pe/4;Ke++)Te.opacityVertexArray.emplaceBack(Ne)};let we=0;T&&n.updateReplacement(k,T);for(let Te=0;Te<n.symbolInstances.length;Te++){const Pe=n.symbolInstances.get(Te),{numHorizontalGlyphVertices:Ne,numVerticalGlyphVertices:Ke,crossTileID:$e,numIconVertices:lt,tileAnchorX:dt,tileAnchorY:vt}=Pe;let Ue=null;const at=this.retainedQueryData[n.bucketInstanceId];ye&&Pe&&at&&(Ue=m.latestFeatureIndex.loadFeature({featureIndex:Pe.featureIndex,bucketIndex:at.bucketIndex,sourceLayerIndex:at.sourceLayerIndex,layoutVertexArrayOffset:0}));const Fe=me.evaluate(Ue,{}),ot=l.has($e);let rt=this.opacities[$e];ot?rt=V:rt||(rt=Ee,this.opacities[$e]=rt),l.add($e);const ht=Ne>0||Ke>0,Je=lt>0,mt=this.placedOrientations[$e],It=mt===s.bq.vertical,kt=mt===s.bq.horizontal||mt===s.bq.horizontalOnly;!ht&&!Je||rt.isHidden()||we++;let Rt=!1;if((ht||Je)&&T)for(const Yt of n.activeReplacements){if(s.bx(Yt,b,s.by.Symbol,j)||Yt.min.x>dt||dt>Yt.max.x||Yt.min.y>vt||vt>Yt.max.y)continue;const Tr=s.bz(dt,vt,k.canonical,Yt.footprintTileId.canonical);if(Rt=s.bA(Tr,Yt.footprint),Rt)break}if(ht){const Yt=Rt?jc:Rc(rt.text);be(n.text,Ne,It?jc:Yt),be(n.text,Ke,kt?jc:Yt);const Tr=rt.text.isHidden(),{leftJustifiedTextSymbolIndex:cr,centerJustifiedTextSymbolIndex:yr,rightJustifiedTextSymbolIndex:pr,verticalPlacedTextSymbolIndex:Gr}=Pe,on=n.text.placedSymbolArray,Rn=Tr||It?1:0;cr>=0&&(on.get(cr).hidden=Rn),yr>=0&&(on.get(yr).hidden=Rn),pr>=0&&(on.get(pr).hidden=Rn),Gr>=0&&(on.get(Gr).hidden=Tr||kt?1:0);const Lr=this.variableOffsets[$e];Lr&&this.markUsedJustification(n,Lr.anchor,Pe,mt);const Wn=this.placedOrientations[$e];Wn&&(this.markUsedJustification(n,"left",Pe,Wn),this.markUsedOrientation(n,Wn,Pe))}if(Je){const Yt=Rt?jc:Rc(rt.icon),{placedIconSymbolIndex:Tr,verticalPlacedIconSymbolIndex:cr}=Pe,yr=n.icon.placedSymbolArray,pr=rt.icon.isHidden()?1:0;Tr>=0&&(be(n.icon,lt,It?jc:Yt),yr.get(Tr).hidden=pr),cr>=0&&(be(n.icon,Pe.numVerticalIconVertices,kt?jc:Yt),yr.get(cr).hidden=pr)}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const Yt=n.collisionArrays[Te];if(Yt){let Tr=new s.P(0,0),cr=!0;if(Yt.textBox||Yt.verticalTextBox){if(K){const pr=this.variableOffsets[$e];pr?(Tr=hp(pr.anchor,pr.width,pr.height,pr.textOffset,pr.textScale),ne&&Tr._rotate(se?this.transform.angle:-this.transform.angle)):cr=!1}U&&(cr=!rt.clipped),Yt.textBox&&Nc(n.textCollisionBox.collisionVertexArray,rt.text.placed,!cr||It,Fe,xe,Tr.x,Tr.y),Yt.verticalTextBox&&Nc(n.textCollisionBox.collisionVertexArray,rt.text.placed,!cr||kt,Fe,xe,Tr.x,Tr.y)}const yr=cr&&!!(!kt&&Yt.verticalIconBox);Yt.iconBox&&Nc(n.iconCollisionBox.collisionVertexArray,rt.icon.placed,yr,Fe,xe,Pe.hasIconTextFit?Tr.x:0,Pe.hasIconTextFit?Tr.y:0),Yt.verticalIconBox&&Nc(n.iconCollisionBox.collisionVertexArray,rt.icon.placed,!yr,Fe,xe,Pe.hasIconTextFit?Tr.x:0,Pe.hasIconTextFit?Tr.y:0)}}}if(n.fullyClipped=we===0,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const Te=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=Te.invProjMatrix,n.placementViewportMatrix=Te.viewportMatrix,n.collisionCircleArray=Te.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,l){const m=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*m>n}setStale(){this.stale=!0}}function Nc(g,n,l,m,x,b,T){g.emplaceBack(n?1:0,l?1:0,b||0,T||0,m,x?1:0),g.emplaceBack(n?1:0,l?1:0,b||0,T||0,m,x?1:0),g.emplaceBack(n?1:0,l?1:0,b||0,T||0,m,x?1:0),g.emplaceBack(n?1:0,l?1:0,b||0,T||0,m,x?1:0)}const c0=Math.pow(2,25),Ph=Math.pow(2,24),nS=Math.pow(2,17),iS=Math.pow(2,16),Ih=Math.pow(2,9),kh=Math.pow(2,8),sS=Math.pow(2,1);function Rc(g){if(g.opacity===0&&!g.placed)return 0;if(g.opacity===1&&g.placed)return 4294967295;const n=g.placed?1:0,l=Math.floor(127*g.opacity);return l*c0+n*Ph+l*nS+n*iS+l*Ih+n*kh+l*sS+n}const jc=0;class fp{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(n,l,m,x,b,T){const k=this._bucketParts;for(;this._currentTileIndex<n.length;)if(l.getBucketParts(k,x,n[this._currentTileIndex],this._sortAcrossTiles,T),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,k.sort((j,L)=>j.sortKey-L.sortKey));this._currentPartIndex<k.length;){const j=k[this._currentPartIndex];if(l.placeLayerBucketPart(j,this._seenCrossTileIDs,m,j.symbolInstanceStart===0,T),this._currentPartIndex++,b())return!0}return!1}}class Zl{constructor(n,l,m,x,b,T,k,j,L){this.placement=new rS(n,b,T,k,j,L),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(n,l,m,x,b){const T=s.q.now(),k=()=>{const j=s.q.now()-T;return!this._forceFullPlacement&&j>2};for(;this._currentPlacementIndex>=0;){const j=l[n[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if(j.type==="symbol"&&(!j.minzoom||j.minzoom<=L)&&(!j.maxzoom||j.maxzoom>L)){const z=j,U=z.layout.get("symbol-z-elevate"),V=z.layout.get("symbol-sort-key").constantOr(1)!==void 0,Y=z.layout.get("symbol-z-order"),te=Y==="viewport-y"||Y==="auto"&&!(Y!=="viewport-y"&&V),K=z.layout.get("text-allow-overlap")||z.layout.get("icon-allow-overlap")||z.layout.get("text-ignore-placement")||z.layout.get("icon-ignore-placement"),ne=te&&K,se=this._inProgressLayer=this._inProgressLayer||new fp(z),me=s.C(j.source,j.scope);if(se.continuePlacement(U||ne?x[me]:m[me],this.placement,this._showCollisionBoxes,j,k,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const r_=512/s.ai/2;class oS{constructor(n,l,m){this.tileID=n,this.bucketInstanceId=m,this.index=new s.bE(l.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const x=n.canonical.x*s.ai,b=n.canonical.y*s.ai;for(let T=0;T<l.length;T++){const{key:k,crossTileID:j,tileAnchorX:L,tileAnchorY:z}=l.get(T),U=Math.floor((x+L)*r_),V=Math.floor((b+z)*r_);this.index.add(U,V),this.keys.push(k),this.crossTileIDs.push(j)}this.index.finish()}findMatches(n,l,m){const x=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z),b=r_/Math.pow(2,l.canonical.z-this.tileID.canonical.z),T=l.canonical.x*s.ai,k=l.canonical.y*s.ai;for(let j=0;j<n.length;j++){const L=n.get(j);if(L.crossTileID)continue;const{key:z,tileAnchorX:U,tileAnchorY:V}=L,Y=Math.floor((T+U)*b),te=Math.floor((k+V)*b),K=this.index.range(Y-x,te-x,Y+x,te+x);for(const ne of K){const se=this.crossTileIDs[ne];if(this.keys[ne]===z&&!m.has(se)){m.add(se),L.crossTileID=se;break}}}}}class aS{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class u0{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const l=Math.round((n-this.lng)/360);if(l!==0)for(const m in this.indexes){const x=this.indexes[m],b={};for(const T in x){const k=x[T];k.tileID=k.tileID.unwrapTo(k.tileID.wrap+l),b[k.tileID.key]=k}this.indexes[m]=b}this.lng=n}addBucket(n,l,m){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let b=0;b<l.symbolInstances.length;b++)l.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]=new Set);const x=this.usedCrossTileIDs[n.overscaledZ];for(const b in this.indexes){const T=this.indexes[b];if(Number(b)>n.overscaledZ)for(const k in T){const j=T[k];j.tileID.isChildOf(n)&&j.findMatches(l.symbolInstances,n,x)}else{const k=T[n.scaledTo(Number(b)).key];k&&k.findMatches(l.symbolInstances,n,x)}}for(let b=0;b<l.symbolInstances.length;b++){const T=l.symbolInstances.get(b);T.crossTileID||(T.crossTileID=m.generate(),x.add(T.crossTileID))}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new oS(n,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(n,l){for(const m of l.crossTileIDs)this.usedCrossTileIDs[n].delete(m)}removeStaleBuckets(n){let l=!1;for(const m in this.indexes){const x=this.indexes[m];for(const b in x)n[x[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,x[b]),delete x[b],l=!0)}return l}}class lS{constructor(){this.layerIndexes={},this.crossTileIDs=new aS,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,l,m,x){let b=this.layerIndexes[n.fqid];b===void 0&&(b=this.layerIndexes[n.fqid]=new u0);let T=!1;const k={};x.name!=="globe"&&b.handleWrapJump(m);for(const j of l){const L=j.getBucket(n);L&&n.fqid===L.layerIds[0]&&(L.bucketInstanceId||(L.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(j.tileID,L,this.crossTileIDs)&&(T=!0),k[L.bucketInstanceId]=!0)}return b.removeStaleBuckets(k)&&(T=!0),T}pruneUnusedLayers(n){const l={};n.forEach(m=>{l[m]=!0});for(const m in this.layerIndexes)l[m]||delete this.layerIndexes[m]}}const Yl=771;class zr{constructor(n,l,m,x){this.blendFunction=n,this.blendColor=l,this.mask=m,this.blendEquation=x}}zr.Replace=[1,0,1,0],zr.disabled=new zr(zr.Replace,s.al.transparent,[!1,!1,!1,!1]),zr.unblended=new zr(zr.Replace,s.al.transparent,[!0,!0,!0,!0]),zr.alphaBlended=new zr([1,Yl,1,Yl],s.al.transparent,[!0,!0,!0,!0]),zr.alphaBlendedNonPremultiplied=new zr([770,Yl,770,Yl],s.al.transparent,[!0,!0,!0,!0]),zr.multiply=new zr([774,0,774,0],s.al.transparent,[!0,!0,!0,!0]);class ir{constructor(n,l,m){this.func=n,this.mask=l,this.range=m}}ir.ReadOnly=!1,ir.ReadWrite=!0,ir.disabled=new ir(519,ir.ReadOnly,[0,1]);const pp=7680;class Mr{constructor(n,l,m,x,b,T){this.test=n,this.ref=l,this.mask=m,this.fail=x,this.depthFail=b,this.pass=T}}Mr.disabled=new Mr({func:519,mask:0},0,0,pp,pp,pp);const il=1029,Iu=2305;class vr{constructor(n,l,m){this.enable=n,this.mode=l,this.frontFace=m}}function n_(g,n){const l=s.bG(g,3);s.ad.mat4.fromQuat(g,n),s.bI(g,3,l)}function Dc(g,n){const l=s.ad.quat.identity([]);return s.ad.quat.rotateZ(l,l,-n),s.ad.quat.rotateX(l,l,-g),l}function ku(g,n){const l=[g[0],g[1],0],m=[n[0],n[1],0];if(s.ad.vec3.length(l)>=1e-15){const T=s.ad.vec3.normalize([],l);s.ad.vec3.scale(m,T,s.ad.vec3.dot(m,T)),n[0]=m[0],n[1]=m[1]}const x=s.ad.vec3.cross([],n,g);if(s.ad.vec3.len(x)<1e-15)return null;const b=Math.atan2(-x[1],x[0]);return Dc(Math.atan2(Math.sqrt(g[0]*g[0]+g[1]*g[1]),-g[2]),b)}vr.disabled=new vr(!1,il,Iu),vr.backCCW=new vr(!0,il,Iu),vr.backCW=new vr(!0,il,2304),vr.frontCW=new vr(!0,1028,2304),vr.frontCCW=new vr(!0,1028,Iu);class i_{constructor(n,l){this.position=n,this.orientation=l}get position(){return this._position}set position(n){if(n){const l=n instanceof s.ac?n:new s.ac(n[0],n[1],n[2]);this._renderWorldCopies&&(l.x=s.bF(l.x,0,1)),this._position=l}else this._position=null}lookAtPoint(n,l){if(this.orientation=null,!this.position)return;const m=this.position,x=this._elevation?this._elevation.getAtPointOrZero(s.ac.fromLngLat(n)):0,b=s.ac.fromLngLat(n,x),T=[b.x-m.x,b.y-m.y,b.z-m.z];l||(l=[0,0,1]),l[2]=Math.abs(l[2]),this.orientation=ku(T,l)}setPitchBearing(n,l){this.orientation=Dc(s.ak(n),s.ak(-l))}}class Nu{constructor(n,l){this._transform=s.ad.mat4.identity([]),this.orientation=l,this.position=n}get mercatorPosition(){const n=this.position;return new s.ac(n[0],n[1],n[2])}get position(){const n=s.bG(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var l;n&&s.bI(this._transform,3,[(l=n)[0],l[1],l[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||s.ad.quat.identity([]),n&&n_(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),l=this.right();return{bearing:Math.atan2(-l[1],l[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,l){this._orientation=Dc(n,l),n_(this._transform,this._orientation)}forward(){const n=s.bG(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=s.bG(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=s.bG(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,l){const m=new Float64Array(16);return s.ad.mat4.invert(m,this.getWorldToCamera(n,l)),m}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(n,l,m){const x=this.position;s.ad.vec3.scale(x,x,-n);const b=new Float64Array(16);return s.ad.mat4.fromScaling(b,[m,m,m]),s.ad.mat4.translate(b,b,x),b[10]*=l,b}getWorldToCamera(n,l){const m=new Float64Array(16),x=new Float64Array(4),b=this.position;return s.ad.quat.conjugate(x,this._orientation),s.ad.vec3.scale(b,b,-n),s.ad.mat4.fromQuat(m,x),s.ad.mat4.translate(m,m,b),m[1]*=-1,m[5]*=-1,m[9]*=-1,m[13]*=-1,m[8]*=l,m[9]*=l,m[10]*=l,m[11]*=l,m}getCameraToClipPerspective(n,l,m,x){const b=new Float64Array(16);return s.ad.mat4.perspective(b,n,l,m,x),b}getCameraToClipOrthographic(n,l,m,x,b,T){const k=new Float64Array(16);return s.ad.mat4.ortho(k,n,l,m,x,b,T),k}getDistanceToElevation(n,l=!1){const m=n===0?0:s.bH(n,l?s.aT(this.position[1]):this.position[1]),x=this.forward();return(m-this.position[2])/x[2]}clone(){return new Nu([...this.position],[...this.orientation])}}const pi={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Nh{constructor(n=0,l=0,m=0,x=0){if(isNaN(n)||n<0||isNaN(l)||l<0||isNaN(m)||m<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=l,this.left=m,this.right=x}interpolate(n,l,m){return l.top!=null&&n.top!=null&&(this.top=s.ah(n.top,l.top,m)),l.bottom!=null&&n.bottom!=null&&(this.bottom=s.ah(n.bottom,l.bottom,m)),l.left!=null&&n.left!=null&&(this.left=s.ah(n.left,l.left,m)),l.right!=null&&n.right!=null&&(this.right=s.ah(n.right,l.right,m)),this}getCenter(n,l){const m=s.ay((this.left+n-this.right)/2,0,n),x=s.ay((this.top+l-this.bottom)/2,0,l);return new s.P(m,x)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new Nh(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Ct=15;class mp{constructor(n,l,m,x,b,T,k){this.tileSize=512,this._renderWorldCopies=b===void 0||b,this._minZoom=n||0,this._maxZoom=l||22,this._minPitch=m??0,this._maxPitch=x??60,this.setProjection(T),this.setMaxBounds(k),this.width=0,this.height=0,this._center=new s.bO(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Nh,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Nu,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const n=new mp(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.mercatorFromTransition=this.mercatorFromTransition,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n._allowWorldUnderZoom=this._allowWorldUnderZoom,n}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<Ct}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(n,l=!1){const m=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||m)&&this._updateCameraOnTerrain(),(n||m)&&this._constrainCamera(l),this._calcMatrices()}getProjection(){return s.aA(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};const l=this.projection?this.getProjection():void 0;this.projection=s.bP(this.projectionOptions);const m=this.getProjection(),x=!s.bn(l,m);return x&&this._calcMatrices(),this.mercatorFromTransition=!1,x}setOrthographicProjectionAtLowPitch(n){return this._orthographicProjectionAtLowPitch!==n&&(this._orthographicProjectionAtLowPitch=n,this._calcMatrices(),!0)}setMercatorFromTransition(){const n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.bP({name:"mercator"});const l=n!==this.projection.name;return l&&this._calcMatrices(),l}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.bH(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return s.bF(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const l=-n*Math.PI/180;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=s.ad.mat2.create(),s.ad.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const l=s.ay(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=s.ak(n),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const n=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/n)}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){const l=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._setZoom(l),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(n){this._tileCoverLift!==n&&(this._tileCoverLift=n)}_updateCameraOnTerrain(){const n=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,l=this.elevation&&n===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||n===Number.NEGATIVE_INFINITY&&(!l||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const m=this._elevation;l||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&m.exaggeration()&&this._centerAltitudeValidForExaggeration!==m.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*m.exaggeration(),this._centerAltitudeValidForExaggeration=m.exaggeration()):(this._centerAltitude=n||0,this._centerAltitudeValidForExaggeration=m.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,l=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],m=this.horizonLineFromTop();let x=0,b=0;for(let T=0;T<l.length;T++){const k=new s.P(l[T][0]*this.width,m+l[T][1]*(this.height-m)),j=n.pointCoordinate(k);if(!j)continue;const L=1/Math.hypot(j[0]-this._camera.position[0],j[1]-this._camera.position[1]);x+=j[3]*L,b+=L}return b===0?NaN:x/b}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const n=this._seaLevelZoom,l=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),m=this.pixelsPerMeter/this.worldSize*l,x=this._mercatorZfromZoom(n),b=this._mercatorZfromZoom(this._maxZoom),T=Math.max(x-m,b);this._setZoom(this._zoomFromMercatorZ(T))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const l=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let m;m=n.z<this._camera.position[2]?[l.x,l.y,l.z]:[n.x,n.y,n.z];const x=s.ad.vec3.length(s.ad.vec3.sub([],this._camera.position,m));return s.ay(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let l=!1;if(n.orientation&&!s.ad.quat.exactEquals(n.orientation,this._camera.orientation)&&(l=this._setCameraOrientation(n.orientation)),n.position){const m=[n.position.x,n.position.y,n.position.z];s.ad.vec3.exactEquals(m,this._camera.position)||(this._setCameraPosition(m),l=!0)}l&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,l=new i_;return l.position=new s.ac(n[0],n[1],n[2]),l.orientation=this._camera.orientation,l._elevation=this.elevation,l._renderWorldCopies=this.renderWorldCopies,l}_setCameraOrientation(n){if(!s.ad.quat.length(n))return!1;s.ad.quat.normalize(n,n);const l=s.ad.vec3.transformQuat([],[0,0,-1],n),m=s.ad.vec3.transformQuat([],[0,-1,0],n);if(m[2]<0)return!1;const x=ku(l,m);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(n){const l=this.zoomScale(this.minZoom)*this.tileSize,m=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;n[2]=s.ay(n[2],x/m,x/l),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,l,m){this._unmodified=!1,this._edgeInsets.interpolate(n,l,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const l=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(n){const l=[new s.bQ(0,n)];if(this.renderWorldCopies){const m=this.pointCoordinate(new s.P(0,0)),x=this.pointCoordinate(new s.P(this.width,0)),b=this.pointCoordinate(new s.P(this.width,this.height)),T=this.pointCoordinate(new s.P(0,this.height)),k=Math.floor(Math.min(m.x,x.x,b.x,T.x)),j=Math.floor(Math.max(m.x,x.x,b.x,T.x)),L=1;for(let z=k-L;z<=j+L;z++)z!==0&&l.push(new s.bQ(z,n))}return l}isLODDisabled(n){return(!n||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(n,l,m){let x=[];const b=m!==void 0,T=!b;if(T&&this.zoom<l||b&&m[0]===0&&m[1]===0)return x;const k=new Set,j=(z,U,V,Y,te)=>{const K=s.c5(U,z,V,Y,te);k.has(K)||(x.push(new s.aH(z,U,V,Y,te)),k.add(K))};for(let z=0;z<n.length;z++){const U=n[z];if(T&&U.canonical.z!==l)continue;const V=U.canonical,Y=U.overscaledZ,te=U.wrap,K=1<<V.z,ne=V.x+1<K,se=V.x>0,me=V.y+1<K,xe=V.y>0,ye=U.wrap-(se?0:1),Ee=U.wrap+(ne?0:1),be=se?V.x-1:K-1,we=ne?V.x+1:0;if(b)m[0]<0?(j(Y,Ee,V.z,we,V.y),m[1]<0&&me&&(j(Y,te,V.z,V.x,V.y+1),j(Y,Ee,V.z,we,V.y+1)),m[1]>0&&xe&&(j(Y,te,V.z,V.x,V.y-1),j(Y,Ee,V.z,we,V.y-1))):m[0]>0?(j(Y,ye,V.z,be,V.y),m[1]<0&&me&&(j(Y,te,V.z,V.x,V.y+1),j(Y,ye,V.z,be,V.y+1)),m[1]>0&&xe&&(j(Y,te,V.z,V.x,V.y-1),j(Y,ye,V.z,be,V.y-1))):m[1]<0&&me?j(Y,te,V.z,V.x,V.y+1):xe&&j(Y,te,V.z,V.x,V.y-1);else{const Te=U.visibleQuadrants;1&Te&&(j(Y,ye,V.z,be,V.y),xe&&(j(Y,te,V.z,V.x,V.y-1),j(Y,ye,V.z,be,V.y-1))),2&Te&&(j(Y,Ee,V.z,we,V.y),xe&&(j(Y,te,V.z,V.x,V.y-1),j(Y,Ee,V.z,we,V.y-1))),4&Te&&(j(Y,ye,V.z,be,V.y),me&&(j(Y,te,V.z,V.x,V.y+1),j(Y,ye,V.z,be,V.y+1))),8&Te&&(j(Y,Ee,V.z,we,V.y),me&&(j(Y,te,V.z,V.x,V.y+1),j(Y,Ee,V.z,we,V.y+1)))}}const L=[];for(const z of x)x.some(U=>z.isChildOf(U))||L.push(z);if(x=L.filter(z=>!n.some(U=>!!(z.overscaledZ<l&&U.isChildOf(z))||z.equals(U)||z.isChildOf(U))),T){const z=1<<l,U=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),V=[z*U.x,z*U.y],Y=4,te=Y*Y;x=x.filter(K=>{const ne=K.canonical.x+.5-V[0],se=K.canonical.y+.5-V[1];return ne*ne+se*se<te})}return x}coveringTiles(n){let l=this.coveringZoomLevel(n);const m=l,x=this.elevation&&this.elevation.exaggeration(),b=x&&!n.isTerrainDEM,T=this.projection.name==="mercator";if(n.minzoom!==void 0&&l<n.minzoom)return[];n.maxzoom!==void 0&&l>n.maxzoom&&(l=n.maxzoom);const k=this.locationCoordinate(this.center),j=this.center.lat,L=1<<l,z=[L*k.x,L*k.y,0],U=this.projection.name==="globe",V=!U,Y=s.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,V),te=U?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),K=L*s.bH(1,this.center.lat),ne=this._camera.position[2]/s.bH(1,this.center.lat),se=[L*te.x,L*te.y,ne*(V?1:K)],me=U||x,xe=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),ye=this.isLODDisabled(!0)?l:0;let Ee;if(this._elevation&&n.isTerrainDEM)Ee=1e4*this._elevation.exaggeration();else if(this._elevation){const Fe=this._elevation.getMinMaxForVisibleTiles();Ee=Fe?Fe.max:this._centerAltitude}else Ee=this._centerAltitude;const be=n.isTerrainDEM?-Ee:this._elevation?this._elevation.getMinElevationBelowMSL():0,we=this.projection.isReprojectedInTileSpace?s.bS(this):1,Te=Fe=>{const rt=new s.ac(Fe.x+25e-6,Fe.y,Fe.z),ht=new s.ac(Fe.x,Fe.y+25e-6,Fe.z),Je=Fe.toLngLat(),mt=rt.toLngLat(),It=ht.toLngLat(),kt=this.locationCoordinate(Je),Rt=this.locationCoordinate(mt),Yt=this.locationCoordinate(It),Tr=Math.hypot(Rt.x-kt.x,Rt.y-kt.y),cr=Math.hypot(Yt.x-kt.x,Yt.y-kt.y);return Math.sqrt(Tr*cr)*we/25e-6},Pe=Fe=>{const ot=Ee,rt=be;return{aabb:s.bV(this,L,0,0,0,Fe,rt,ot,this.projection),zoom:0,x:0,y:0,minZ:rt,maxZ:ot,wrap:Fe,fullyVisible:!1}},Ne=[];let Ke=[];const $e=l,lt=n.reparseOverscaled?m:l,dt=(ne-this._centerAltitude)*K,vt=Fe=>{if(!this._elevation||!Fe.tileID||!T)return;const ot=this._elevation.getMinMaxForTile(Fe.tileID),rt=Fe.aabb;ot?(rt.min[2]=ot.min,rt.max[2]=ot.max,rt.center[2]=(rt.min[2]+rt.max[2])/2):(Fe.shouldSplit=at(Fe),Fe.shouldSplit||(rt.min[2]=rt.max[2]=rt.center[2]=this._centerAltitude))},Ue=(Fe,ot)=>{if(.707*ot<Fe)return 1;const rt=ot/Fe;return rt/(1.4144271570014144+(Math.pow(1.1,rt-1.4144271570014144+1)-1)/(1.1-1)-1)},at=Fe=>{if(Fe.zoom<ye)return!0;if(Fe.zoom===$e)return!1;if(Fe.shouldSplit!=null)return Fe.shouldSplit;const ot=Fe.aabb.distanceX(se),rt=Fe.aabb.distanceY(se);let ht=dt,Je=1;if(U){ht=Fe.aabb.distanceZ(se);const cr=Math.pow(2,Fe.zoom),yr=s.aT((Fe.y+1)/cr),pr=s.aT(Fe.y/cr),Gr=Math.min(Math.max(j,yr),pr),on=s.ca(Gr)/s.ca(j);if(Je=Gr===j?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,on/this._mercatorScaleRatio),this.zoom<=s.c6&&Fe.zoom===$e-1&&on>=.9)return!0}else if(b&&(ht=Fe.aabb.distanceZ(se)*K),this.projection.isReprojectedInTileSpace&&m<=5){const cr=Math.pow(2,Fe.zoom),yr=Te(new s.ac((Fe.x+.5)/cr,(Fe.y+.5)/cr));Je=yr>.85?1:yr}if(!T){const cr=Math.sqrt(ot*ot+rt*rt+ht*ht);let yr=(1<<$e-Fe.zoom)*xe*Je;return yr*=Ue(Math.max(ht,dt),cr),cr<yr}let mt=Number.MAX_VALUE,It=0;const kt=Fe.aabb.getCorners(),Rt=[];for(const cr of kt){s.ad.vec3.sub(Rt,cr,se),U||(b?Rt[2]*=K:Rt[2]=dt);const yr=s.ad.vec3.dot(Rt,this._camera.forward());yr<mt&&(mt=yr,It=Math.abs(Rt[2]))}let Yt=(1<<$e-Fe.zoom)*xe*Je;if(Yt*=Ue(Math.max(It,dt),mt),mt<Yt)return!0;const Tr=Fe.aabb.closestPoint(z);return Tr[0]===z[0]&&Tr[1]===z[1]};if(this.renderWorldCopies)for(let Fe=1;Fe<=3;Fe++)Ne.push(Pe(-Fe)),Ne.push(Pe(Fe));for(Ne.push(Pe(0));Ne.length>0;){const Fe=Ne.pop(),ot=Fe.x,rt=Fe.y;let ht=Fe.fullyVisible;const Je=()=>this.projection.name==="globe"&&(Fe.y===0||Fe.y===(1<<Fe.zoom)-1);if(!ht){let mt=me?Fe.aabb.intersects(Y):Fe.aabb.intersectsFlat(Y);if(mt===0&&Je()){const It=new s.bT(Fe.zoom,ot,rt);mt=s.bU(this,L,It,!0).intersects(Y)}if(mt===0)continue;ht=mt===2}if(Fe.zoom!==$e&&at(Fe))for(let mt=0;mt<4;mt++){const It=(ot<<1)+mt%2,kt=(rt<<1)+(mt>>1),Rt={aabb:T?Fe.aabb.quadrant(mt):s.bV(this,L,Fe.zoom+1,It,kt,Fe.wrap,Fe.minZ,Fe.maxZ,this.projection),zoom:Fe.zoom+1,x:It,y:kt,wrap:Fe.wrap,fullyVisible:ht,tileID:void 0,shouldSplit:void 0,minZ:Fe.minZ,maxZ:Fe.maxZ};b&&!U&&(Rt.tileID=new s.aH(Fe.zoom+1===$e?lt:Fe.zoom+1,Fe.wrap,Fe.zoom+1,It,kt),vt(Rt)),Ne.push(Rt)}else{const mt=Fe.zoom===$e?lt:Fe.zoom;if(n.minzoom&&n.minzoom>mt)continue;let It=0;if(!ht){let Tr=me?Fe.aabb.intersectsPrecise(Y):Fe.aabb.intersectsPreciseFlat(Y);if(Tr===0&&Je()){const cr=new s.bT(Fe.zoom,ot,rt);Tr=s.bU(this,L,cr,!0).intersectsPrecise(Y)}if(Tr===0)continue;if(n.calculateQuadrantVisibility)if(Y.containsPoint(Fe.aabb.center))It=15;else for(let cr=0;cr<4;cr++)Fe.aabb.quadrant(cr).intersects(Y)!==0&&(It|=1<<cr)}const kt=z[0]-(.5+ot+(Fe.wrap<<Fe.zoom))*(1<<l-Fe.zoom),Rt=z[1]-.5-rt,Yt=Fe.tileID?Fe.tileID:new s.aH(mt,Fe.wrap,Fe.zoom,ot,rt);n.calculateQuadrantVisibility&&(Yt.visibleQuadrants=It),Ke.push({tileID:Yt,distanceSq:kt*kt+Rt*Rt})}}if(this.fogCullDistSq){const Fe=this.fogCullDistSq,ot=this.horizonLineFromTop();Ke=Ke.filter(rt=>{const ht=[0,0,0,1],Je=[s.ai,s.ai,0,1],mt=this.calculateFogTileMatrix(rt.tileID.toUnwrapped());s.ad.vec4.transformMat4(ht,ht,mt),s.ad.vec4.transformMat4(Je,Je,mt);const It=s.ad.vec4.min([],ht,Je),kt=s.ad.vec4.max([],ht,Je),Rt=s.bW(It,kt);if(Rt===0)return!0;let Yt=!1;const Tr=this._elevation;if(Tr&&Rt>Fe&&ot!==0){const cr=this.calculateProjMatrix(rt.tileID.toUnwrapped());let yr;n.isTerrainDEM||(yr=Tr.getMinMaxForTile(rt.tileID)),yr||(yr={min:be,max:Ee});const pr=s.c7(this.rotation),Gr=[pr[0]*s.ai,pr[1]*s.ai,yr.max];s.ad.vec3.transformMat4(Gr,Gr,cr),Yt=(1-Gr[1])*this.height*.5<ot}return Rt<Fe||Yt})}return Ke.sort((Fe,ot)=>Fe.distanceSq-ot.distanceSq).map(Fe=>Fe.tileID)}resize(n,l){this.width=n,this.height=l,this.pixelsToGLUnits=[2/n,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const l=s.ay(n.lat,-s.bX,s.bX),m=this.projection.project(n.lng,l);return new s.P(m.x*this.worldSize,m.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.bH(1,this.center.lat)/this.worldSize}setLocationAtPoint(n,l){let m,x;const b=this.centerPoint;if(this.projection.name==="globe"){const k=this.worldSize;m=(l.x-b.x)/k,x=(l.y-b.y)/k}else{const k=this.pointCoordinate(l),j=this.pointCoordinate(b);m=k.x-j.x,x=k.y-j.y}const T=this.locationCoordinate(n);this.setLocation(new s.ac(T.x-m,T.y-x))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n,l){return this.projection.locationPoint(this,n,l)}locationPoint3D(n,l){return this.projection.locationPoint(this,n,l,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n,l){return this.coordinateLocation(this.pointCoordinate3D(n,l))}locationCoordinate(n,l){const m=l?s.bH(l,n.lat):void 0,x=this.projection.project(n.lng,n.lat);return new s.ac(x.x,x.y,m)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,l){const m=l??this._centerAltitude,x=[n.x,n.y,0,1],b=[n.x,n.y,1,1];s.ad.vec4.transformMat4(x,x,this.pixelMatrixInverse),s.ad.vec4.transformMat4(b,b,this.pixelMatrixInverse);const T=b[3];s.ad.vec4.scale(x,x,1/x[3]),s.ad.vec4.scale(b,b,1/T);const k=x[2],j=b[2];return{p0:x,p1:b,t:k===j?0:(m-k)/(j-k)}}screenPointToMercatorRay(n){const l=[n.x,n.y,0,1],m=[n.x,n.y,1,1];return s.ad.vec4.transformMat4(l,l,this.pixelMatrixInverse),s.ad.vec4.transformMat4(m,m,this.pixelMatrixInverse),s.ad.vec4.scale(l,l,1/l[3]),s.ad.vec4.scale(m,m,1/m[3]),l[2]=s.bH(l[2],this._center.lat)*this.worldSize,m[2]=s.bH(m[2],this._center.lat)*this.worldSize,s.ad.vec4.scale(l,l,1/this.worldSize),s.ad.vec4.scale(m,m,1/this.worldSize),new s.as([l[0],l[1],l[2]],s.ad.vec3.normalize([],s.ad.vec3.sub([],m,l)))}rayIntersectionCoordinate(n){const{p0:l,p1:m,t:x}=n,b=s.bH(l[2],this._center.lat),T=s.bH(m[2],this._center.lat);return new s.ac(s.ah(l[0],m[0],x)/this.worldSize,s.ah(l[1],m[1],x)/this.worldSize,s.ah(b,T,x))}pointCoordinate(n,l=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,l)}pointCoordinate3D(n,l){if(!this.elevation)return this.pointCoordinate(n,l);let m=this.projection.pointCoordinate3D(this,n.x,n.y);if(m)return new s.ac(m[0],m[1],m[2]);let x=0,b=this.horizonLineFromTop();if(n.y>b)return this.pointCoordinate(n,l);const T=.02*b,k=n.clone();for(let j=0;j<10&&b-x>T;j++){k.y=s.ah(x,b,.66);const L=this.projection.pointCoordinate3D(this,k.x,k.y);L?(b=k.y,m=L):x=k.y}return m?new s.ac(m[0],m[1],m[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}isPointOnSurface(n){if(n.y<0||n.y>this.height||n.x<0||n.x>this.width)return!1;if(this.elevation||this.zoom>=s.bY)return!this.isPointAboveHorizon(n);const l=this.pointCoordinate(n);return l.y>=0&&l.y<=1}_coordinatePoint(n,l){const m=l&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,x=[n.x*this.worldSize,n.y*this.worldSize,m+n.toAltitude(),1];return s.ad.vec4.transformMat4(x,x,this.pixelMatrix),x[3]>0?new s.P(x[0]/x[3],x[1]/x[3]):new s.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:n,left:l}=this._edgeInsets,m=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,b=this.pointLocation3D(new s.P(l,n)),T=this.pointLocation3D(new s.P(x,n)),k=this.pointLocation3D(new s.P(x,m)),j=this.pointLocation3D(new s.P(l,m));let L=Math.min(b.lng,T.lng,k.lng,j.lng),z=Math.max(b.lng,T.lng,k.lng,j.lng),U=Math.min(b.lat,T.lat,k.lat,j.lat),V=Math.max(b.lat,T.lat,k.lat,j.lat);const Y=Math.pow(2,-this.zoom)/16*270,te=this.projection.name==="globe"?1:4,K=(ne,se,me,xe,ye)=>{const Ee=(ne+me)/2,be=(se+xe)/2,we=new s.P(Ee,be),{lng:Te,lat:Pe}=this.pointLocation3D(we),Ne=Math.max(0,L-Te,U-Pe,Te-z,Pe-V);L=Math.min(L,Te),z=Math.max(z,Te),U=Math.min(U,Pe),V=Math.max(V,Pe),(ye<te||Ne>Y)&&(K(ne,se,Ee,be,ye+1),K(Ee,be,me,xe,ye+1))};if(K(l,n,x,n,1),K(x,n,x,m,1),K(x,m,l,m,1),K(l,m,l,n,1),this.projection.name==="globe"){const[ne,se]=s.bZ(this);ne?(V=90,z=180,L=-180):se&&(U=-90,z=180,L=-180)}return new s.aB(new s.bO(L,U),new s.bO(z,V))}_getBoundsRectangular(n,l){const{top:m,left:x}=this._edgeInsets,b=this.height-this._edgeInsets.bottom,T=this.width-this._edgeInsets.right,k=new s.P(x,m),j=new s.P(T,m),L=new s.P(T,b),z=new s.P(x,b);let U=this.pointCoordinate(k,n),V=this.pointCoordinate(j,n);const Y=this.pointCoordinate(L,l),te=this.pointCoordinate(z,l),K=(ne,se)=>(se.y-ne.y)/(se.x-ne.x);return U.y>1&&V.y>=0?U=new s.ac((1-te.y)/K(te,U)+te.x,1):U.y<0&&V.y<=1&&(U=new s.ac(-te.y/K(te,U)+te.x,0)),V.y>1&&U.y>=0?V=new s.ac((1-Y.y)/K(Y,V)+Y.x,1):V.y<0&&U.y<=1&&(V=new s.ac(-Y.y/K(Y,V)+Y.x,0)),new s.aB().extend(this.coordinateLocation(U)).extend(this.coordinateLocation(V)).extend(this.coordinateLocation(te)).extend(this.coordinateLocation(Y))}_getBoundsRectangularTerrain(){const n=this.elevation;if(!n.visibleDemTiles.length||n.isUsingMockSource())return this._getBoundsRectangular(0,0);const l=n.visibleDemTiles.reduce((m,x)=>{if(x.dem){const b=x.dem.tree;m.min=Math.min(m.min,b.minimums[0]),m.max=Math.max(m.max,b.maximums[0])}return m},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(l.min*n.exaggeration(),l.max*n.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(n=!0){const l=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,m=this.height/2-l*(1-this._horizonShift);return n?Math.max(0,m):m}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-s.bX,this.maxLat=s.bX,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.av(this.minLng)*this.tileSize,this.worldMaxX=s.av(this.maxLng)*this.tileSize,this.worldMinY=s.aC(this.maxLat)*this.tileSize,this.worldMaxY=s.aC(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,l){return this.projection.createTileMatrix(this,l,n)}calculateDistanceTileData(n){const l=n.key,m=this._distanceTileDataCache;if(m[l])return m[l];const x=n.canonical,b=1/this.height,T=this.cameraWorldSize,k=T/this.zoomScale(x.z),j=(x.x+Math.pow(2,x.z)*n.wrap)*k,L=x.y*k,z=this.point;z.x*=T/this.worldSize,z.y*=T/this.worldSize;const U=this.angle,V=Math.sin(-U),Y=-Math.cos(-U);return m[l]={bearing:[V,Y],center:[(z.x-j)*b,(z.y-L)*b],scale:k/s.ai*b},m[l]}calculateFogTileMatrix(n){const l=n.key,m=this._fogTileMatrixCache;if(m[l])return m[l];const x=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,n);return s.ad.mat4.multiply(x,this.worldToFogMatrix,x),m[l]=new Float32Array(x),m[l]}calculateProjMatrix(n,l=!1,m=!1){const x=n.key;let b;if(b=m?this._expandedProjMatrixCache:l?this._alignedProjMatrixCache:this._projMatrixCache,b[x])return b[x];const T=this.calculatePosMatrix(n,this.worldSize);let k;return k=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:m?this.expandedFarZProjMatrix:l?this.alignedProjMatrix:this.projMatrix,s.ad.mat4.multiply(T,k,T),b[x]=new Float32Array(T),b[x]}calculatePixelsToTileUnitsMatrix(n){const l=n.tileID.key,m=this._pixelsToTileUnitsCache;if(m[l])return m[l];const x=s.b_(n,this);return m[l]=x,m[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const n=1/this.worldSize,l=s.ad.mat4.fromScaling([],[n,n,n]);return s.ad.mat4.multiply(l,l,this.globeMatrix),l}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const n=this._elevation;this._updateCameraState();const l=s.bH(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(l),x=this._camera.forward(),b=s.bH(1,this._center.lat);m[2]/=b,x[2]/=b,s.ad.vec3.normalize(x,x);const T=n.raycast(m,x,n.exaggeration());if(T){const k=s.ad.vec3.scaleAndAdd([],m,x,T),j=new s.ac(k[0],k[1],s.bH(k[2],s.aT(k[1]))),L=(j.z+s.ad.vec3.length([j.x-m[0],j.y-m[1],j.z-m[2]*b]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(L),this._centerAltitude=j.toAltitude(),this._center=this.coordinateLocation(j),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(n=!1){if(!this._elevation)return;const l=this._elevation,m=s.bH(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(m),b=l.getAtPointOrZero(new s.ac(...x)),T=this.pixelsPerMeter/this.worldSize*b,k=this._minimumHeightOverTerrain(),j=x[2]-T;if(j<=k)if(j<0||n){const L=this.locationCoordinate(this._center,this._centerAltitude),z=[x[0],x[1],L.z-x[2]],U=s.ad.vec3.length(z);z[2]-=(k-j)/this._pixelsPerMercatorPixel;const V=s.ad.vec3.length(z);if(V===0)return;s.ad.vec3.scale(z,z,U/V*this._pixelsPerMercatorPixel),this._camera.position=[x[0],x[1],L.z*this._pixelsPerMercatorPixel-z[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){const V=this.center;return V.lat=s.ay(V.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&(V.lng=s.ay(V.lng,this.minLng,this.maxLng)),this.center=V,void(this._constraining=!1)}const l=this._unmodified,{x:m,y:x}=this.point;let b=0,T=m,k=x;const j=this.width/2,L=this.height/2,z=this.worldMinY*this.scale,U=this.worldMaxY*this.scale;if(x-L<z&&(k=z+L),x+L>U&&(k=U-L),U-z<this.height&&(b=Math.max(b,this.height/(U-z)),k=(U+z)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const V=this.worldMinX*this.scale,Y=this.worldMaxX*this.scale,te=this.worldSize/2-(V+Y)/2;T=(m+te+this.worldSize)%this.worldSize-te,T-j<V&&(T=V+j),T+j>Y&&(T=Y-j),Y-V<this.width&&(b=Math.max(b,this.width/(Y-V)),T=(Y+V)/2)}T===m&&k===x||this._allowWorldUnderZoom||(this.center=this.unproject(new s.P(T,k))),b&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(b)),this._constrainCamera(),this._unmodified=l,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,l=this.projection.name==="globe",m=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.bH(1,this.center.lat)/s.bH(1,s.c8));const x=s.b$(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,x),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const b=this.projection.zAxisUnit==="meters"?m:1,T=this._camera.getWorldToCamera(this.worldSize,b);let k;const j=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(j[8]=2*-n.x/this.width,j[9]=2*n.y/this.height,this.isOrthographic){let Pe=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Ne=Pe*this.aspect,Ke=-Ne,$e=-Pe;Ne-=n.x,Ke-=n.x,Pe+=n.y,$e+=n.y,k=this._camera.getCameraToClipOrthographic(Ke,Ne,$e,Pe,this._nearZ,this._farZ),((lt,dt,vt,Ue)=>{for(let at=0;at<16;at++)lt[at]=s.ah(dt[at],vt[at],Ue)})(k,k,j,s.c9(this.pitch>=Ct?1:this.pitch/Ct))}else k=j;const L=s.ad.mat4.mul([],j,T);let z=s.ad.mat4.mul([],k,T);if(this.projection.isReprojectedInTileSpace){const Pe=this.locationCoordinate(this.center),Ne=s.ad.mat4.identity([]);s.ad.mat4.translate(Ne,Ne,[Pe.x*this.worldSize,Pe.y*this.worldSize,0]),s.ad.mat4.multiply(Ne,Ne,s.c0(this)),s.ad.mat4.translate(Ne,Ne,[-Pe.x*this.worldSize,-Pe.y*this.worldSize,0]),s.ad.mat4.multiply(z,z,Ne),s.ad.mat4.multiply(L,L,Ne),this.inverseAdjustmentMatrix=s.c1(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=s.ad.mat4.scale([],z,[this.worldSize,this.worldSize,this.worldSize/b,1]),this.projMatrix=z,this.invProjMatrix=s.ad.mat4.invert(new Float64Array(16),this.projMatrix),l){const Pe=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Pe[8]=2*-n.x/this.width,Pe[9]=2*n.y/this.height,this.expandedFarZProjMatrix=s.ad.mat4.mul([],Pe,T)}else this.expandedFarZProjMatrix=this.projMatrix;const U=s.ad.mat4.invert([],k);this.frustumCorners=s.c2.fromInvProjectionMatrix(U,this.horizonLineFromTop(),this.height),this.cameraFrustum=s.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!l);const V=new Float32Array(16);s.ad.mat4.identity(V),s.ad.mat4.scale(V,V,[1,-1,1]),s.ad.mat4.rotateX(V,V,this._pitch),s.ad.mat4.rotateZ(V,V,this.angle);const Y=s.ad.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=s.ad.mat4.clone(Y);const te=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;Y[8]=2*-n.x/this.width,Y[9]=2*(n.y+te)/this.height,this.skyboxMatrix=s.ad.mat4.multiply(V,Y,V);const K=this.point,ne=K.x,se=K.y,me=this.width%2/2,xe=this.height%2/2,ye=Math.cos(this.angle),Ee=Math.sin(this.angle),be=ne-Math.round(ne)+ye*me+Ee*xe,we=se-Math.round(se)+ye*xe+Ee*me,Te=new Float64Array(z);if(s.ad.mat4.translate(Te,Te,[be>.5?be-1:be,we>.5?we-1:we,0]),this.alignedProjMatrix=Te,z=s.ad.mat4.create(),s.ad.mat4.scale(z,z,[this.width/2,-this.height/2,1]),s.ad.mat4.translate(z,z,[1,-1,0]),this.labelPlaneMatrix=z,z=s.ad.mat4.create(),s.ad.mat4.scale(z,z,[1,-1,1]),s.ad.mat4.translate(z,z,[-1,-1,0]),s.ad.mat4.scale(z,z,[2/this.width,2/this.height,1]),this.glCoordMatrix=z,this.pixelMatrix=s.ad.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,L),this._calcFogMatrices(),this._distanceTileDataCache={},z=s.ad.mat4.invert(new Float64Array(16),this.pixelMatrix),!z)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=z,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.c3(this);const Pe=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.ad.vec3.transformMat4(Pe,Pe,T),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=z;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSizeForFog,l=this.cameraPixelsPerMeter,m=this._camera.position,x=1/this.height/this._pixelsPerMercatorPixel,b=[n,n,l];s.ad.vec3.scale(b,b,x),s.ad.vec3.scale(m,m,-1),s.ad.vec3.multiply(m,m,b);const T=s.ad.mat4.create();s.ad.mat4.translate(T,T,m),s.ad.mat4.scale(T,T,b),this.mercatorFogMatrix=T,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,l,x)}_computeCameraPosition(n){const l=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,m=this._camera.forward(),x=this.point,b=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*l-n/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-m[0]*b,x.y/this.worldSize-m[1]*b,n/this.worldSize*this._centerAltitude-m[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const l=this._maxCameraBoundsDistance()*Math.cos(this._pitch),m=this._camera.position[2],x=n[2];let b=1;this.projection.wrap&&(this.center=this.center.wrap()),x>0&&(b=Math.min((l-m)/x,1)),this._camera.position=s.ad.vec3.scaleAndAdd([],this._camera.position,n,b),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,l=this._camera.forward(),{pitch:m,bearing:x}=this._camera.getPitchBearing(),b=s.bH(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,T=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.ak(this._maxPitch)),k=Math.max((n[2]-b)/Math.cos(m),T),j=this._zoomFromMercatorZ(k);s.ad.vec3.scaleAndAdd(n,n,l,k),this._pitch=s.ay(m,s.ak(this.minPitch),s.ak(this.maxPitch)),this.angle=s.bF(x,-Math.PI,Math.PI),this._setZoom(s.ay(j,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.ac(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(n*this.tileSize))}zoomFromMercatorZAdjusted(n){let l=0,m=s.bY,x=0,b=1/0;for(;m-l>1e-6&&m>l;){const T=l+.5*(m-l),k=this.tileSize*Math.pow(2,T),j=this.getCameraToCenterDistance(this.projection,T,k),L=this.scaleZoom(j/(n*this.tileSize)),z=Math.abs(T-L);z<b&&(b=z,x=T),T<L?l=T:m=T}return x}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,l){const m=Math.min(n.x,l.x),x=Math.max(n.x,l.x),b=Math.min(n.y,l.y),T=Math.max(n.y,l.y);if(b<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const k=[new s.P(m,b),new s.P(x,T),new s.P(m,T),new s.P(x,b)],j=this.renderWorldCopies?-3:0,L=this.renderWorldCopies?4:1;for(const z of k){const U=this.pointRayIntersection(z);if(U.t<0)return!0;const V=this.rayIntersectionCoordinate(U);if(V.x<j||V.y<0||V.x>L||V.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.c4(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.P(0,0),new s.P(this.width,this.height))}zoomDeltaToMovement(n,l){const m=s.ad.vec3.length(s.ad.vec3.sub([],this._camera.position,n)),x=this._zoomFromMercatorZ(m)+l;return m-this._mercatorZfromZoom(x)}getCameraPoint(){if(this.projection.name==="globe"){const n=function([l,m,x],b){const T=[l,m,x,1];s.ad.vec4.transformMat4(T,T,b);const k=T[3]=Math.max(T[3],1e-6);return T[0]/=k,T[1]/=k,T[2]/=k,T}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.P(n[0],n[1])}{const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,n))}}getCameraToCenterDistance(n,l=this.zoom,m=this.worldSize){const x=s.b$(n,l,this.width,this.height,1024),b=n.pixelSpaceConversion(this.center.lat,m,x);let T=.5/Math.tan(.5*this._fov)*this.height*b;return this.isOrthographic&&(T=s.ah(1,T,s.c9(this.pitch>=Ct?1:this.pitch/Ct))),T}getWorldToCameraMatrix(){const n=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.ad.mat4.multiply(n,n,this.globeMatrix),n}getFrustum(n){return s.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,this.projection.zAxisUnit==="meters")}}const sl=(g,n)=>{if(n>0&&g.terrain&&s.w("Cutoff is currently disabled on terrain"),n<=0||g.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const l=g.transform,m=Math.max(Math.abs(l._zoom-(g.minCutoffZoom-1)),1),x=l.isLODDisabled(!1)?s.ae(60,45,l.pitch):s.ae(30,15,l.pitch),b=l._farZ-l._nearZ,T=n*l.height,k=((1-(j=x))*l.cameraToCenterDistance+j*(l._farZ+T))*m;var j;return{shouldRenderCutoff:x<1,uniformValues:{u_cutoff_params:[l._nearZ,l._farZ,(k-l._nearZ)/b,(k-T-l._nearZ)/b]}}},ys={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class d0{constructor(n,l){this.aabb=n,this.lastCascade=l}}class gp{add(n,l){const m=this.receivers[n.key];m!==void 0?(m.aabb.min[0]=Math.min(m.aabb.min[0],l.min[0]),m.aabb.min[1]=Math.min(m.aabb.min[1],l.min[1]),m.aabb.min[2]=Math.min(m.aabb.min[2],l.min[2]),m.aabb.max[0]=Math.max(m.aabb.max[0],l.max[0]),m.aabb.max[1]=Math.max(m.aabb.max[1],l.max[1]),m.aabb.max[2]=Math.max(m.aabb.max[2],l.max[2])):this.receivers[n.key]=new d0(l,null)}clear(){this.receivers={}}get(n){return this.receivers[n.key]}computeRequiredCascades(n,l,m){const x=s.ce.fromPoints(n.points);let b=0;for(const T in this.receivers){const k=this.receivers[T];if(!k||!x.intersectsAabb(k.aabb))continue;k.aabb.min=x.closestPoint(k.aabb.min),k.aabb.max=x.closestPoint(k.aabb.max);const j=k.aabb.getCorners();for(let L=0;L<m.length;L++){let z=!0;for(const U of j){const V=[U[0]*l,U[1]*l,U[2]];if(s.ad.vec3.transformMat4(V,V,m[L].matrix),V[0]<-1||V[0]>1||V[1]<-1||V[1]>1){z=!1;break}}if(k.lastCascade=L,b=Math.max(b,L),z)break}}return b+1}}class ol{constructor(n){this.painter=n,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new gp,this._depthMode=new ir(n.context.gl.LEQUAL,ir.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,n.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),n.tp.registerParameter(ys,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),n.tp.registerParameter(ys,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),n.tp.registerParameter(ys,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),n.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const n of this._cascades)n.texture.destroy(),n.framebuffer.destroy();this._cascades=[]}updateShadowParameters(n,l){const m=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!l||!l.properties)return;const x=l.properties.get("shadow-intensity");if(!l.shadowsEnabled()||x<=0||(this._shadowLayerCount=m.style.order.reduce((te,K)=>{const ne=m.style._mergedLayers[K];return te+(ne.hasShadowPass()&&!ne.isHidden(n.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const b=m.context,T=ys.shadowMapResolution,k=ys.shadowMapResolution;if(this._cascades.length===0||ys.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let te=0;te<ys.cascadeCount;++te){const K=m._shadowMapDebug,ne=b.gl,se=b.createFramebuffer(T,k,K,"texture"),me=new s.T(b,{width:T,height:k,data:null},ne.DEPTH_COMPONENT16);if(se.depthAttachment.set(me.texture),K){const xe=new s.T(b,{width:T,height:k,data:null},ne.RGBA8);se.colorAttachment.set(xe.texture)}this._cascades.push({framebuffer:se,texture:me,matrix:[],far:0,boundingSphereRadius:0,frustum:new s.bR,scale:0})}}this.shadowDirection=Xl(l);let j=0;if(n.elevation){const te=n.elevation,K=[1e4,-1e4];te.visibleDemTiles.filter(ne=>ne.dem).forEach(ne=>{const se=ne.dem.tree;K[0]=Math.min(K[0],se.minimums[0]),K[1]=Math.max(K[1],se.maximums[0])}),K[0]!==1e4&&(j=(K[1]-K[0])*te.exaggeration())}const L=1.5*n.cameraToCenterDistance,z=3*L,U=new Float64Array(16);for(let te=0;te<this._cascades.length;++te){const K=this._cascades[te];let ne=n.height/50,se=1;ys.cascadeCount===1?se=z:te===0?se=L:(ne=L,se=z);const[me,xe]=Du(n,this.shadowDirection,ne,se,ys.shadowMapResolution,j);K.scale=n.scale,K.matrix=me,K.boundingSphereRadius=xe,s.ad.mat4.invert(U,K.matrix),K.frustum=s.bR.fromInvProjectionMatrix(U,1,0,!0),K.far=se}const V=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[V].far,this._cascades[V].far],this._uniformValues.u_shadow_intensity=x,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/ys.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=ys.shadowMapResolution,this._uniformValues.u_shadowmap_0=pi.ShadowMap0,this._uniformValues.u_shadowmap_1=pi.ShadowMap0+1,this._groundShadowTiles=m.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const Y=m.transform.elevation;for(const te of this._groundShadowTiles){let K={min:0,max:0};if(Y){const ne=Y.getMinMaxForTile(te);ne&&(K=ne)}this.addShadowReceiver(te.toUnwrapped(),K.min,K.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(n){this._enabled=n}drawShadowPass(n,l){if(!this.enabled)return;const m=this.painter,x=m.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(m.transform.getFrustum(0),m.transform.worldSize,this._cascades),x.viewport.set([0,0,ys.shadowMapResolution,ys.shadowMapResolution]);for(let b=0;b<this._numCascadesToRender;++b){m.currentShadowCascade=b,x.bindFramebuffer.set(this._cascades[b].framebuffer.framebuffer),x.clear({color:s.al.white,depth:1});for(const T of n.order){const k=n._mergedLayers[T];if(!k.hasShadowPass()||k.isHidden(m.transform.zoom))continue;const j=n.getLayerSourceCache(k),L=j?l[j.id]:void 0;(k.type==="model"||L&&L.length)&&m.renderLayer(m,j,k,L)}}m.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const n=this.painter,l=n.style,m=n.context,x=l.directionalLight,b=l.ambientLight;if(!x||!b)return;const T=[],k=sl(n,n.longestCutoffRange);k.shouldRenderCutoff&&T.push("RENDER_CUTOFF"),T.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&T.push("NORMAL_OFFSET");const j=ju(l,x,b),L=new ir(m.gl.LEQUAL,ir.ReadOnly,n.depthRangeFor3D);for(const z of this._groundShadowTiles){const U=z.toUnwrapped(),V=n.isTileAffectedByFog(z),Y=n.getOrCreateProgram("groundShadow",{defines:T,overrideFog:V});this.setupShadows(U,Y),n.uploadCommonUniforms(m,Y,U,null,k);const te={u_matrix:n.transform.calculateProjMatrix(U),u_ground_shadow_factor:j};Y.draw(n,m.gl.TRIANGLES,L,Mr.disabled,zr.multiply,vr.disabled,te,"ground_shadow",n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments,null,n.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?zr.unblended:zr.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(n){const l=this.painter.transform,m=l.calculatePosMatrix(n,l.worldSize);return s.ad.mat4.multiply(m,this._cascades[this.painter.currentShadowCascade].matrix,m),Float32Array.from(m)}calculateShadowPassMatrixFromMatrix(n){return s.ad.mat4.multiply(n,this._cascades[this.painter.currentShadowCascade].matrix,n),Float32Array.from(n)}setupShadows(n,l,m,x=0){if(!this.enabled)return;const b=this.painter.transform,T=this.painter.context,k=T.gl,j=this._uniformValues,L=new Float64Array(16),z=b.calculatePosMatrix(n,b.worldSize);for(let U=0;U<this._cascades.length;U++)s.ad.mat4.multiply(L,this._cascades[U].matrix,z),j[U===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(L),T.activeTexture.set(k.TEXTURE0+pi.ShadowMap0+U),this._cascades[U].texture.bind(k.NEAREST,k.CLAMP_TO_EDGE);if(this.useNormalOffset=!!m,this.useNormalOffset){const U=s.cd(n.canonical),V=2/b.tileSize*s.ai/ys.shadowMapResolution,Y=V*this._cascades[0].boundingSphereRadius,te=V*this._cascades[this._cascades.length-1].boundingSphereRadius,K=(m==="vector-tile"?1:3)/Math.pow(2,x-n.canonical.z-(1-b.zoom+Math.floor(b.zoom)));j.u_shadow_normal_offset=[U,Y*K,te*K],j.u_shadow_bias=[6e-5,.0012,.012]}else j.u_shadow_bias=[36e-5,.0012,.012];l.setShadowUniformValues(T,j)}setupShadowsFromMatrix(n,l,m=!1){if(!this.enabled)return;const x=this.painter.context,b=x.gl,T=this._uniformValues,k=new Float64Array(16);for(let j=0;j<ys.cascadeCount;j++)s.ad.mat4.multiply(k,this._cascades[j].matrix,n),T[j===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(k),x.activeTexture.set(b.TEXTURE0+pi.ShadowMap0+j),this._cascades[j].texture.bind(b.NEAREST,b.CLAMP_TO_EDGE);if(this.useNormalOffset=m,m){const j=ys.normalOffset;T.u_shadow_normal_offset=[1,j,j],T.u_shadow_bias=[6e-5,.0012,.012]}else T.u_shadow_bias=[36e-5,.0012,.012];l.setShadowUniformValues(x,T)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(n,l,m,x){if(x[2]>=0)return{};const b=function(j,L,z){const U=z/(1<<j.canonical.z);return new s.ce([j.canonical.x*U+j.wrap*z,j.canonical.y*U+j.wrap*z,0],[(j.canonical.x+1)*U+j.wrap*z,(j.canonical.y+1)*U+j.wrap*z,L])}(n,l,m).getCorners(),T=l/-x[2];x[0]<0?(s.ad.vec3.add(b[0],b[0],[x[0]*T,0,0]),s.ad.vec3.add(b[3],b[3],[x[0]*T,0,0])):x[0]>0&&(s.ad.vec3.add(b[1],b[1],[x[0]*T,0,0]),s.ad.vec3.add(b[2],b[2],[x[0]*T,0,0])),x[1]<0?(s.ad.vec3.add(b[0],b[0],[0,x[1]*T,0]),s.ad.vec3.add(b[1],b[1],[0,x[1]*T,0])):x[1]>0&&(s.ad.vec3.add(b[2],b[2],[0,x[1]*T,0]),s.ad.vec3.add(b[3],b[3],[0,x[1]*T,0]));const k={};return k.vertices=b,k.planes=[Ru(b[1],b[0],b[4]),Ru(b[2],b[1],b[5]),Ru(b[3],b[2],b[6]),Ru(b[0],b[3],b[7])],k}addShadowReceiver(n,l,m){this._receivers.add(n,s.ce.fromTileIdAndHeight(n,l,m))}getMaxCascadeForTile(n){const l=this._receivers.get(n);return l&&l.lastCascade?l.lastCascade:0}}function Ru(g,n,l){const m=s.ad.vec3.sub([],l,n),x=s.ad.vec3.sub([],g,n),b=s.ad.vec3.cross([],m,x),T=s.ad.vec3.length(b);return T===0?[0,0,1,0]:(s.ad.vec3.scale(b,b,1/T),[b[0],b[1],b[2],-s.ad.vec3.dot(b,n)])}function Xl(g){const n=g.properties.get("direction"),l=s.cc(n.x,n.y,n.z);l[2]=s.ay(l[2],0,75);const m=s.cf([l[0],l[1],l[2]]);return s.ad.vec3.fromValues(m.x,m.y,m.z)}function ju(g,n,l){const m=n.properties.get("color-use-theme")==="none",x=n.properties.get("color"),b=n.properties.get("intensity"),T=n.properties.get("direction"),k=[T.x,T.y,T.z],j=l.properties.get("color-use-theme")==="none",L=l.properties.get("color"),z=l.properties.get("intensity"),U=Math.max(s.ad.vec3.dot([0,0,1],k),0),V=[0,0,0];s.ad.vec3.scale(V,L.toRenderColor(j?null:g.getLut(n.scope)).toArray01Linear().slice(0,3),z);const Y=[0,0,0];return s.ad.vec3.scale(Y,x.toRenderColor(m?null:g.getLut(l.scope)).toArray01Linear().slice(0,3),U*b),s.cg([V[0]>0?V[0]/(V[0]+Y[0]):0,V[1]>0?V[1]/(V[1]+Y[1]):0,V[2]>0?V[2]/(V[2]+Y[2]):0])}function Du(g,n,l,m,x,b){const T=g.zoom,k=g.scale,j=g.worldSize,L=1/j,z=g.aspect,U=Math.sqrt(1+z*z)*Math.tan(.5*g.fovX),V=U*U,Y=m-l,te=m+l;let K,ne;V>Y/te?(K=m,ne=m*U):(K=.5*te*(1+V),ne=.5*Math.sqrt(Y*Y+2*(m*m+l*l)*V+te*te*V*V));const se=g.projection.pixelsPerMeter(g.center.lat,j),me=g._camera.getCameraToWorldMercator(),xe=[0,0,-K*L];s.ad.vec3.transformMat4(xe,xe,me);let ye=ne*L;const Ee=g._edgeInsets;if(!(Ee.left===0&&Ee.top===0&&Ee.right===0&&Ee.bottom===0||Ee.left===Ee.right&&Ee.top===Ee.bottom)){const ht=g._camera.getWorldToCamera(g.worldSize,g.projection.zAxisUnit==="meters"?se:1),Je=g._camera.getCameraToClipPerspective(g._fov,g.width/g.height,l,m);Je[8]=2*-g.centerOffset.x/g.width,Je[9]=2*g.centerOffset.y/g.height;const mt=new Float64Array(16);s.ad.mat4.mul(mt,Je,ht);const It=new Float64Array(16);s.ad.mat4.invert(It,mt);const kt=s.bR.fromInvProjectionMatrix(It,j,T,!0);for(const Rt of kt.points){const Yt=((be=Rt)[0]/=k,be[1]/=k,be[2]=s.bH(be[2],g._center.lat),be);ye=Math.max(ye,s.ad.vec3.len(s.ad.vec3.subtract([],xe,Yt)))}}var be;ye*=x/(x-1);const we=Math.acos(n[2]),Te=Math.atan2(-n[0],-n[1]),Pe=new Nu;Pe.position=xe,Pe.setPitchBearing(we,Te);const Ne=Pe.getWorldToCamera(j,se),Ke=ye*j,$e=Math.min(g._mercatorZfromZoom(17)*j*-2,-2*Ke),lt=Pe.getCameraToClipOrthographic(-Ke,Ke,-Ke,Ke,$e,(Ke+b*se)/n[2]),dt=new Float64Array(16);s.ad.mat4.multiply(dt,lt,Ne);const vt=s.ad.vec3.fromValues(Math.floor(1e6*xe[0])/1e6*j,Math.floor(1e6*xe[1])/1e6*j,0),Ue=.5*x,at=[0,0,0];s.ad.vec3.transformMat4(at,vt,dt),s.ad.vec3.scale(at,at,Ue);const Fe=[Math.floor(at[0]),Math.floor(at[1]),Math.floor(at[2])],ot=[0,0,0];s.ad.vec3.sub(ot,at,Fe),s.ad.vec3.scale(ot,ot,-1/Ue);const rt=new Float64Array(16);return s.ad.mat4.identity(rt),s.ad.mat4.translate(rt,rt,ot),s.ad.mat4.multiply(dt,rt,dt),[dt,Ke]}class cS extends s.E{constructor(n){super(),this.requestManager=n,this.models={"":{}},this.modelUris={"":{}},this.numModelsLoading={}}loadModel(n,l){return s.aN(this.requestManager.transformRequest(l,s.R.Model).url).then(m=>{if(!m)return;const x=s.aO(m),b=new s.aP(n,void 0,void 0,x);return b.computeBoundsAndApplyParent(),b}).catch(m=>{if(m&&m.status===404)return null;this.fire(new s.z(new Error(`Could not load model ${n} from ${l}: ${m.message}`)))})}load(n,l,m={keepNumReferences:!1}){this.models[l]||(this.models[l]={});const x=Object.keys(n);this.numModelsLoading[l]=(this.numModelsLoading[l]||0)+x.length;const b=[];for(const T of x)b.push(this.loadModel(T,n[T]));Promise.allSettled(b).then(T=>{for(let k=0;k<T.length;k++){const{status:j,value:L}=T[k];if(j==="fulfilled"&&L){const z=this.models[l][x[k]];this.models[l][x[k]]={model:L,numReferences:m.keepNumReferences&&z?z.numReferences:1}}}this.numModelsLoading[l]-=x.length,this.fire(new s.A("data",{dataType:"style"}))}).catch(T=>{this.fire(new s.z(new Error(`Could not load models: ${T.message}`)))})}isLoaded(){for(const n in this.numModelsLoading)if(this.numModelsLoading[n]>0)return!1;return!0}hasModel(n,l){return!!this.getModel(n,l)}getModel(n,l){return this.models[l]||(this.models[l]={}),this.models[l][n]?this.models[l][n].model:void 0}addModel(n,l,m){this.models[m]||(this.models[m]={}),this.modelUris[m]||(this.modelUris[m]={}),this.hasModel(n,m)&&this.models[m][n].numReferences++,this.modelUris[m][n]=this.requestManager.normalizeModelURL(l),this.load({[n]:this.modelUris[m][n]},m)}addModels(n,l){this.models[l]||(this.models[l]={}),this.modelUris[l]||(this.modelUris[l]={});const m=this.modelUris[l];for(const x in n)this.models[l][x]={},m[x]=this.requestManager.normalizeModelURL(n[x]);this.load(m,l,{keepNumReferences:!0})}reloadModels(n){this.load(this.modelUris[n],n)}addModelsFromBucket(n,l){this.models[l]||(this.models[l]={}),this.modelUris[l]||(this.modelUris[l]={});const m={};for(const x of n)this.hasModel(x,l)?this.models[l][x].numReferences++:(this.modelUris[l][x]=this.requestManager.normalizeModelURL(x),m[x]=this.modelUris[l][x]);this.load(m,l)}removeModel(n,l){if(this.models[l]&&this.models[l][n]&&(this.models[l][n].numReferences--,this.models[l][n].numReferences===0)){const m=this.models[l][n].model;delete this.models[l][n],delete this.modelUris[l][n],m.destroy()}}listModels(n){return this.models[n]||(this.models[n]={}),Object.keys(this.models[n])}upload(n,l){this.models[l]||(this.models[l]={});for(const m in this.models[l])this.models[l][m].model&&this.models[l][m].model.upload(n.context)}}const uS=new s.a7({data:new s.a8(s.a5.colorTheme.data)}),s_={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function h0(g){return g=g||{},Object.assign(g,s_)}class f0 extends s.E{constructor(n){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._selectedLevel=void 0,this._floorplanStates={},s.aQ(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=n,this._checkFloorplanVisible(!0),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(n=>{n.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new s.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=n.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=n.stylesheet.indoor.buildingFeaturesetId,this._scope=n.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:n=>(n.feature&&n.feature.properties.floorplan&&this.selectFloorplan(n.feature.properties.floorplan),!0)}),this._checkFloorplanVisible(!0)}_onMove(){this._checkFloorplanVisible(!1)}_checkFloorplanVisible(n){if(!this._queryFeatureSetId||!this._map.isStyleLoaded()||this._map.transform.zoom<13)return;this._indoorData&&!function(T,k){const[j,L]=T,{center:z,radius:U}=k,[V,Y]=z,te=Math.abs(j-V);return Math.sqrt((te>180?360-te:te)**2+(L-Y)**2)<=U}([this._map.getCenter().lng,this._map.getCenter().lat],this._indoorData.circumCircle)&&(this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new s.A("floorplangone")));const l={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},m=new s.P(this._map.transform.width/2,this._map.transform.height/2),x=[new s.P(0,0),new s.P(this._map.transform.width,this._map.transform.height)],b=this._map.queryRenderedFeatures(n?x:m,l);b.length>0&&(this._selectedFloorplan&&b[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=b[0],this._floorplanSelected(!1)))}_floorplanSelected(n){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._indoorData.circumCircle=function(b){const[[T,k],[j,L]]=b,z=(j-T+360)%360,U=z>180?360-z:z;return{center:[(T+U/2+360)%360,(k+L)/2],radius:Math.sqrt(U**2+(L-k)**2)/2}}(this._indoorData.extent),this._floorplanStates[this._indoorData.id]||(this._floorplanStates[this._indoorData.id]={});const l=this._floorplanStates[this._indoorData.id].selectedBuilding,m=this._floorplanStates[this._indoorData.id].selectedLevel;let x;if(this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",this._indoorData.floorplanIDs),this._selectedLevel)for(const b of this._indoorData.levels)b.id===this._selectedLevel.id&&(x=b.id);if(this.fire(new s.A("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:x})),l){const b=this._indoorData.buildings.find(T=>T.id===l);this._buildingSelected(b,!1)}else this._indoorData.buildings.length>0&&this._buildingSelected(this._indoorData.buildings[0],!1);if(m){const b=this._indoorData.levels.find(T=>T.id===m);this._updateLevels(b,n)}else n&&this._indoorData["default-levels"].length>0&&this.selectLevel(this._indoorData["default-levels"][0])}_buildingSelected(n,l){l&&n&&n.extent&&this._map.fitBounds(n.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=n?n.id:void 0;const m=this._indoorData.levels.filter(x=>n.levels.includes(x.id));this.fire(new s.A("buildingselected",{buildingId:n.id,levels:m}))}_levelSelected(n){if(n==="overview")this._updateLevels(void 0,!0);else{const l=this._indoorData.levels.find(m=>m.id===n);this._updateLevels(l,!0)}this.fire(new s.A("levelselected",{levelId:n==="overview"?void 0:n}))}_updateLevels(n,l){if(!n)return this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",[]]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._floorplanStates[this._indoorData.id].selectedLevel=void 0,void(l&&this._indoorData.extent&&this._map.fitBounds(this._indoorData.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}));function m(L){const z=L.indexOf("/floor/");if(z===-1)return L;const U=z+7,V=L.indexOf("/",U);return V===-1?L.slice(U):L.slice(U,V)}this._selectedLevel=n,this._floorplanStates[this._indoorData.id].selectedLevel=n?n.id:void 0;const x=[],b={},T={},k={},j={};for(const L of this._indoorData.levels)if(x.push(L.id),b[L.id]=L.height,T[L.id]=L.base,n){if(this.mergeFloors){const z=m(n.id),U=m(L.id);k[L.id]=U===z?"true":"false"}else k[L.id]=L.id===n.id?"true":"false";j[L.id]=L.base<n.base?"true":"false"}else j[L.id]=!0;if(this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",x]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",b]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",T]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",k]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",j]),n&&(this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!!n.isUnderground),l&&n.extent)){const L=this._map.cameraForBounds(n.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),z=this._map.getZoom(),U=L.zoom?Math.abs(z-L.zoom):0;this._map.fitBounds(n.extent,U>=1?{pitch:this._map.getPitch(),bearing:this._map.getBearing()}:{pitch:this._map.getPitch(),bearing:this._map.getBearing(),zoom:z})}}selectFloorplan(n){const l={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},m=[new s.P(0,0),new s.P(this._map.transform.width,this._map.transform.height)],x=this._map.queryRenderedFeatures(m,l);if(x.length>0){for(const b of x)if(JSON.parse(b.properties["indoor-data"]).floorplanIDs.includes(n)){this._selectedFloorplan=b,this._floorplanSelected(!0);break}}}selectBuilding(n){const l=this._indoorData.buildings.find(m=>m.id===n);this._buildingSelected(l,!0)}selectLevel(n){this._levelSelected(n)}}function p0(g){if(!g.metadata||!g.metadata.content_area)return;const n=s.q.devicePixelRatio,{left:l,top:m,width:x,height:b}=g.metadata.content_area,T=l*n,k=m*n;return[T,k,T+x*n,k+b*n]}function _p(g){if(g)return g.map(([n,l])=>[n*s.q.devicePixelRatio,l*s.q.devicePixelRatio])}class dS{constructor(n,l,m){this.id=n,this.scope=l,this.sourceCache=m,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(n){this.missingRequests.has(n.name)||this.pendingRequests.has(n.name)||this.pendingRequests.add(n.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const n=new Map;if(!this.sourceCache.loaded())return n;const l=this.sourceCache.getVisibleCoordinates();if(l.length===0)return n;const m=this.sourceCache.getSource();if(!(m instanceof ka))return n;const x=l.map(T=>this.sourceCache.getTile(T)),b=m.getImages(x,Array.from(this.pendingRequests));for(const[T,k]of b)n.set(s.I.from({name:T,iconsetId:this.id}),k),this.pendingRequests.delete(T);for(const T of this.pendingRequests)this.missingRequests.add(T);return this.pendingRequests.clear(),n}}const Lc=(g,n)=>Ye(g,n&&n.filter(l=>l.identifier!=="source.canvas")),hS=s.aA(Yr,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),fS=s.aA(Yr,["setCenter","setZoom","setBearing","setPitch"]),yp=new Set(["background","sky","slot","custom"]),m0={version:8,layers:[],sources:{}},Rh={duration:300,delay:0};class la extends s.E{constructor(n,l={}){super(),this.map=n,this.scope=l.scope||"",this.globalId=null,this.fragments=[],this.importDepth=l.importDepth||0,this.importsCache=l.importsCache||new Map,this.resolvedImports=l.resolvedImports||new Set,this.transition=s.l({},Rh),this._buildingIndex=new a0(this),this.crossTileSymbolIndex=new lS,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=l.styleChanges||new hi,this.dispatcher=l.dispatcher?l.dispatcher:new s.D(s.cj(),this),l.imageManager?this.imageManager=l.imageManager:(this.imageManager=new Vi(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=l.glyphManager?l.glyphManager:new s.ck(n._requestManager,l.localFontFamily?s.cl.all:l.localIdeographFontFamily?s.cl.ideographs:s.cl.none,l.localFontFamily||l.localIdeographFontFamily),l.modelManager?this.modelManager=l.modelManager:(this.modelManager=new cS(n._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=l.configOptions?l.configOptions:new Map,this._configDependentLayers=l.configDependentLayers?l.configDependentLayers:new Set,this._config=l.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:l.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=l.initialConfig,this.dispatcher.broadcast("setReferrer",s.cm());const m=this;this._rtlTextPluginCallback=la.registerForPluginStateChange(x=>{m.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(b,T)=>{if(s.cn(b),T&&T.every(k=>k))for(const k in m._sourceCaches){const j=m._sourceCaches[k],L=j.getSource().type;L!=="vector"&&L!=="geojson"||j.reload()}})}),this.on("data",x=>{if(x.dataType!=="source"||x.sourceDataType!=="metadata")return;const b=this.getOwnSource(x.sourceId);if(b&&b.vectorLayerIds)for(const T in this._layers){const k=this._layers[T];k.source===b.id&&this._validateLayer(k)}})}load(n){return n?(typeof n=="string"?this.loadURL(n):this.loadJSON(n),this):this}_getGlobalId(n){if(!n)return null;if(typeof n=="string"){if(s.f(n))return n;const l=s.co(n);if(!l.startsWith("http"))try{return new URL(l,location.href).toString()}catch{return l}return l}return`json://${s.cp(JSON.stringify(n))}`}_diffStyle(n,l,m){this.globalId=this._getGlobalId(n);const x=(b,T)=>{try{T(null,this.setState(b,m))}catch(k){T(k,!1)}};if(typeof n=="string"){const b=this.map._requestManager.normalizeStyleURL(n),T=this.map._requestManager.transformRequest(b,s.R.Style);s.n(T,(k,j)=>{k?this.fire(new s.z(k)):j&&x(j,l)})}else typeof n=="object"&&x(n,l)}loadURL(n,l={}){this.fire(new s.A("dataloading",{dataType:"style"}));const m=typeof l.validate=="boolean"?l.validate:!s.f(n);this.globalId=this._getGlobalId(n),n=this.map._requestManager.normalizeStyleURL(n,l.accessToken),this.resolvedImports.add(n);const x=this.importsCache.get(n);if(x)return this._load(x,m);const b=this.map._requestManager.transformRequest(n,s.R.Style);this._request=s.n(b,(T,k)=>{if(this._request=null,T)this.fire(new s.z(T));else if(k)return this.importsCache.set(n,k),this._load(k,m)})}loadJSON(n,l={}){this.fire(new s.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(n),this._request=s.q.frame(()=>{this._request=null,this._load(n,l.validate!==!1)})}loadEmpty(){this.fire(new s.A("dataloading",{dataType:"style"})),this._load(m0,!1)}_loadImports(n,l,m){if(this.importDepth>=4)return s.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const x=[];for(const b of n){const T=this._createFragmentStyle(b),k=new Promise(z=>{T.once("style.import.load",z),T.once("error",z)}).then(()=>this.mergeAll());if(x.push(k),this.resolvedImports.has(b.url)){T.loadEmpty();continue}const j=b.data||this.importsCache.get(b.url);j?(T.loadJSON(j,{validate:l}),this._isInternalStyle(j)&&(T.globalId=null)):b.url?T.loadURL(b.url,{validate:l}):T.loadEmpty();const L={style:T,id:b.id,config:b.config};if(m){const z=this.fragments.findIndex(({id:U})=>U===m);this.fragments=this.fragments.slice(0,z).concat(L).concat(this.fragments.slice(z))}else this.fragments.push(L)}return Promise.allSettled(x)}getImportGlobalIds(n=this,l=new Set){for(const m of n.fragments)m.style.globalId&&l.add(m.style.globalId),this.getImportGlobalIds(m.style,l);return[...l.values()]}_createFragmentStyle(n){const l=this.scope?s.C(n.id,this.scope):n.id;let m;const x=this._initialConfig&&this._initialConfig[l];(n.config||x)&&(m=s.l({},n.config,x));const b=new la(this.map,{scope:l,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:m,configOptions:this.options,colorThemeOverride:n["color-theme"],configDependentLayers:this._configDependentLayers});return b.setEventedParent(this.map,{style:b}),b}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(n){return this.isRootStyle()&&(n.fragment||!!n.schema&&n.fragment!==!1)}_load(n,l){const m=n.indoor?h0(n.schema):n.schema;if(this._isInternalStyle(n)){const T=s.l({},m0,{imports:[{id:"basemap",data:n,url:""}]});return void this._load(T,l)}if(this.updateConfig(this._config,m),l&&Lc(this,xi(n)))return;this._loaded=!0,this.stylesheet=s.cq(n);const x=()=>{for(const L in n.sources)this.addSource(L,n.sources[L],{validate:!1,isInitialLoad:!0});if(n.iconsets)for(const L in n.iconsets)this.addIconset(L,n.iconsets[L]);n.sprite?this._loadIconset(n.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.setGlyphsUrl(n.glyphs);const T=Eh(this.stylesheet.layers);if(this._order=T.map(L=>L.id),this.stylesheet.light&&s.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const L=this.stylesheet.lights[0];this.light=new Qe(L.properties,L.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Qe(this.stylesheet.light)),this._layers={};for(const L of T){const z=s.cv(L,this.scope,this._styleColorTheme.lut,this.options);z.configDependencies.size!==0&&this._configDependentLayers.add(z.fqid),z.setEventedParent(this,{layer:{id:z.id}}),this._layers[z.id]=z;const U=this.getOwnLayerSourceCache(z),V=!!this.directionalLight&&this.directionalLight.shadowsEnabled();U&&z.canCastShadows()&&V&&(U.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const k=this.stylesheet.terrain;k&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(k,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new s.A("data",{dataType:"style"}));const j=this.isRootStyle();n.imports?this._loadImports(n.imports,l).then(()=>{this._reloadImports(),this.fire(new s.A(j?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new s.A(j?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const b=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(b){const T=this._evaluateColorThemeData(b);this._loadColorTheme(T).then(()=>{x()}).catch(k=>{s.w(`Couldn't load color theme from the stylesheet: ${k}`),x()})}else this._styleColorTheme.lut=null,x()}isRootStyle(){return this.importDepth===0}mergeAll(){let n,l,m,x,b,T,k,j,L,z;const U={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(V=>{if(V.stylesheet){if(V.light!=null&&(n=V.light),V.stylesheet.lights)for(const Y of V.stylesheet.lights)Y.type==="ambient"&&V.ambientLight!=null&&(l=V.ambientLight),Y.type==="directional"&&V.directionalLight!=null&&(m=V.directionalLight);x=this._prioritizeTerrain(x,V.terrain,V.stylesheet.terrain),V.stylesheet.fog&&V.fog!=null&&(b=V.fog),V.stylesheet.snow&&V.snow!=null&&(T=V.snow),V.stylesheet.rain&&V.rain!=null&&(k=V.rain),V.stylesheet.camera!=null&&(z=V.stylesheet.camera),V.stylesheet.projection!=null&&(j=V.stylesheet.projection),V.stylesheet.transition!=null&&(L=V.stylesheet.transition),U[V.scope]=V._styleColorTheme}}),this.light=n,this.ambientLight=l,this.directionalLight=m,this.fog=b,this.snow=T,this.rain=k,this._styleColorThemeForScope=U,x===null?delete this.terrain:this.terrain=x,this.camera=z||{"camera-projection":"perspective"},this.projection=j||{name:"mercator"},this.transition=s.l({},Rh,L),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(n){const l=m=>{for(const x of m.fragments)l(x.style);n(m)};l(this)}_prioritizeTerrain(n,l,m){const x=n&&n.drapeRenderMode===0;return m===null?l&&l.drapeRenderMode===0?l:x?n:null:l!=null&&(!n||x||l&&l.drapeRenderMode===1)?l:n}mergeTerrain(){let n;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(l=>{n=this._prioritizeTerrain(n,l.terrain,l.stylesheet.terrain)}),n===null?delete this.terrain:this.terrain=n}mergeProjection(){let n;this.forEachFragmentStyle(l=>{l.stylesheet.projection!=null&&(n=l.stylesheet.projection)}),this.projection=n||{name:"mercator"}}mergeSources(){const n={},l={},m={};this.forEachFragmentStyle(x=>{for(const b in x._sourceCaches){const T=s.C(b,x.scope);n[T]=x._sourceCaches[b]}for(const b in x._otherSourceCaches){const T=s.C(b,x.scope);l[T]=x._otherSourceCaches[b]}for(const b in x._symbolSourceCaches){const T=s.C(b,x.scope);m[T]=x._symbolSourceCaches[b]}}),this._mergedSourceCaches=n,this._mergedOtherSourceCaches=l,this._mergedSymbolSourceCaches=m}mergeLayers(){const n={},l=[],m={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(b=>{for(const T of b._order){const k=b._layers[T];if(k.type==="slot"){const j=s.cr(T);if(n[j])continue;n[j]=[]}k.slot&&n[k.slot]?n[k.slot].push(k):l.push(k)}}),this._mergedOrder=[];const x=(b=[])=>{for(const T of b)if(T.type==="slot"){const k=s.cr(T.id);n[k]&&x(n[k]),this._mergedSlots.push(k)}else{const k=s.C(T.id,T.scope);this._mergedOrder.push(k),m[k]=T,T.is3D(!!this.terrain)&&(this._has3DLayers=!0),T.type==="circle"&&(this._hasCircleLayers=!0),T.type==="symbol"&&(this._hasSymbolLayers=!0),T.type==="clip"&&(this._clipLayerPresent=!0)}};x(l),this._mergedOrder.sort((b,T)=>{const k=m[b],j=m[T];return k.hasInitialOcclusionOpacityProperties?j.is3D(!!this.terrain)?1:0:k.is3D(!!this.terrain)&&j.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=m,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(n){return this.stylesheet.camera=s.l({},this.stylesheet.camera,n),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(n){return n.data?function(l,m,x){const b=s.l({},m);for(const k of Object.keys(s.a5.colorTheme))b[k]===void 0&&(b[k]=s.a5.colorTheme[k].default);const T=new s.a6(uS,l,new Map(x));return T.setTransitionOrValue(b,x),T.untransitioned().possiblyEvaluate(new s.aa(0))}(this.scope,n,this.options).get("data"):null}_loadColorTheme(n){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const l=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((m,x)=>{const b="data:image/png;base64,";if(!n||n.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void m();let T=n;T.startsWith(b)||(T=b+T);const k=s.I.from("mapbox-reserved-lut"),j=new Image;j.src=T,j.onerror=()=>{this._styleColorTheme.lutLoading=!1,x(new Error("Failed to load image data"))},j.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==l)return void m();this._styleColorTheme.lutLoading=!1;const{width:L,height:z,data:U}=s.q.getImageData(j);if(z>32)return void x(new Error("The height of the image must be less than or equal to 32 pixels."));if(L!==z*z)return void x(new Error("The width of the image must be equal to the height squared."));this.getImage(k,this.scope)&&this.removeImage(k,this.scope),this.addImage(k,this.scope,{data:new s.r({width:L,height:z},U),pixelRatio:1,sdf:!1,usvg:!1,version:0});const V=this.imageManager.getImage(k,this.scope);V?(this._styleColorTheme.lut={image:V.data,data:n},m()):x(new Error("Missing LUT image."))}})}getLut(n){const l=this._styleColorThemeForScope[n];return l?l.lut:null}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(n){this._spriteRequest=function(l,m,x){let b,T,k;const j=s.q.devicePixelRatio>1?"@2x":"";let L=s.n(m.transformRequest(m.normalizeSpriteURL(l,j,".json"),s.R.SpriteJSON),(V,Y)=>{L=null,k||(k=V,b=Y,U())}),z=s.o(m.transformRequest(m.normalizeSpriteURL(l,j,".png"),s.R.SpriteImage),(V,Y)=>{z=null,k||(k=V,T=Y,U())});function U(){if(k)x(k);else if(b&&T){const V=s.q.getImageData(T),Y={};for(const te in b){const{width:K,height:ne,x:se,y:me,sdf:xe,pixelRatio:ye,stretchX:Ee,stretchY:be,content:we}=b[te],Te=new s.r({width:K,height:ne});s.r.copy(V,Te,{x:se,y:me},{x:0,y:0},{width:K,height:ne},null),Y[te]={data:Te,pixelRatio:ye,sdf:xe,stretchX:Ee,stretchY:be,content:we,usvg:!1}}x(null,Y)}}return{cancel(){L&&(L.cancel(),L=null),z&&(z.cancel(),z=null)}}}(n,this.map._requestManager,(l,m)=>{if(this._spriteRequest=null,l)this.fire(new s.z(l));else if(m){const x=new Map;for(const b in m)x.set(s.I.from(b),m[b]);this.addImages(x,this.scope)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.A("data",{dataType:"style"}))})}addIconset(n,l){if(l.type==="sprite")return void this._loadSprite(l.url);const m=this.getOwnSourceCache(l.source);if(!m)return void this.fire(new s.z(new Error(`Source "${l.source}" as specified by iconset "${n}" does not exist and cannot be used as an iconset source`)));const x=m.getSource();if(x.type!=="raster-array")return void this.fire(new s.z(new Error(`Source "${l.source}" as specified by iconset "${n}" is not a "raster-array" source and cannot be used as an iconset source`)));x.partial=!1;const b=new dS(n,this.scope,m);this.imageManager.addImageProvider(b,this.scope)}removeIconset(n){this.imageManager.removeImageProvider(n,this.scope)}_loadIconset(n){if(!s.f(n)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(n);const l=this.map._spriteFormat==="auto";var m,x;this._spriteRequest=(x=(b,T)=>{if(this._spriteRequest=null,b)l?this._loadSprite(n):this.fire(new s.z(b));else if(T){const k=new Map;for(const j in T)k.set(s.I.from(j),T[j]);this.addImages(k,this.scope)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.A("data",{dataType:"style"}))},s.bj((m=this.map._requestManager).transformRequest(m.normalizeIconsetURL(n),s.R.Iconset),(b,T)=>{if(b)return void x(b);const k={},j=s.ch(new s.bi(T));for(const L of j.icons){const z={version:1,pixelRatio:s.q.devicePixelRatio,content:p0(L),stretchX:L.metadata?_p(L.metadata.stretch_x_areas):void 0,stretchY:L.metadata?_p(L.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:L};k[L.name]=z}x(null,k)}))}_validateLayer(n){const l=this.getOwnSource(n.source);if(!l)return;const m=n.sourceLayer;m&&(l.type==="geojson"||l.vectorLayerIds&&l.vectorLayerIds.indexOf(m)===-1)&&this.fire(new s.z(new Error(`Source layer "${m}" does not exist on source "${l.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:n}of this.fragments)if(!n.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((n,l)=>{const m=this.fragments[l];return m&&m.style&&(n.data=m.style.serialize()),n})}_serializeSources(){const n={};for(const l in this._sourceCaches){const m=this._sourceCaches[l].getSource();n[m.id]||(n[m.id]=m.serialize())}return n}_serializeLayers(n){const l=[];for(const m of n){const x=this._layers[m];x&&x.type!=="custom"&&l.push(x.serialize())}return l}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(n){return n?this.order:this._mergedOrder}isLayerDraped(n){return!!this.terrain&&n.isDraped(this.getLayerSourceCache(n))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(n){const l=this.getOwnLayer(n);if(l)return l;this.fire(new s.z(new Error(`The layer '${n}' does not exist in the map's style.`)))}_checkSource(n){const l=this.getOwnSource(n);if(l)return l;this.fire(new s.z(new Error(`The source '${n}' does not exist in the map's style.`)))}precompilePrograms(n,l){const m=this.map.painter;if(m)for(let x=n.minzoom||0;x<(n.maxzoom||25.5);x++){const b=n.getProgramIds();if(b)for(const T of b){const k=n.getDefaultProgramParams(T,l.zoom,this._styleColorTheme.lut);k&&(m.style=this,this.fog&&(m._fogVisible=!0,k.overrideFog=!0,m.getOrCreateProgram(T,k)),m._fogVisible=!1,k.overrideFog=!1,m.getOrCreateProgram(T,k),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(k.overrideRtt=!0,m.getOrCreateProgram(T,k)))}}}update(n){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(n),this.directionalLight&&this.directionalLight.recalculate(n);const l=this.calculateLightsBrightness();n.brightness=l||0,l!==this._brightness&&(this._brightness=l,this.dispatcher.broadcast("setBrightness",l));const m=this._changes.isDirty();let x=!1;if(this._changes.isDirty()){const k=this._changes.getLayerUpdatesByScope();for(const j in k){const{updatedIds:L,removedIds:z}=k[j];(L||z)&&(this._updateWorkerLayers(j,L,z),x=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(n),this.light&&this.light.updateTransitions(n),this.ambientLight&&this.ambientLight.updateTransitions(n),this.directionalLight&&this.directionalLight.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this.snow&&this.snow.updateTransitions(n),this.rain&&this.rain.updateTransitions(n),this._changes.reset()}const b={};for(const k in this._mergedSourceCaches){const j=this._mergedSourceCaches[k];b[k]=j.used,j.used=!1,j.tileCoverLift=0}for(const k of this._mergedOrder){const j=this._mergedLayers[k];if(j.recalculate(n,this._availableImages),!j.isHidden(n.zoom)){const L=this.getLayerSourceCache(j);L&&(L.used=!0,L.tileCoverLift=Math.max(L.tileCoverLift,j.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(j,n)}):this.precompilePrograms(j,n))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&x&&this.mergeLayers();const T=this.imageManager.getPendingImageProviders();for(const k of T)k.sourceCache.used=!0;for(const k in b){const j=this._mergedSourceCaches[k];b[k]!==j.used&&j.getSource().fire(new s.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:j.getSource().id}))}this.light&&this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.snow&&this.snow.recalculate(n),this.rain&&this.rain.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),m&&this.fire(new s.A("data",{dataType:"style"}))}updateImageProviders(){const n=this.imageManager.getPendingImageProviders();for(const l of n){const m=l.resolvePendingRequests();this.addImages(m,l.scope)}}_updateTilesForChangedImages(){const n={};for(const l in this._mergedSourceCaches){const m=this._mergedSourceCaches[l].getSource().scope;n[m]=n[m]||this._changes.getUpdatedImages(m),n[m].length!==0&&this._mergedSourceCaches[l].reloadTilesForDependencies(["icons","patterns"],n[m])}for(const l in n)this._changes.resetUpdatedImages(l)}_updateWorkerLayers(n,l,m){const x=this.getFragmentStyle(n);x&&this.dispatcher.broadcast("updateLayers",{layers:l?x._serializeLayers(l):[],scope:n,removedIds:m||[],options:x.options})}setState(n,l){if(this._checkLoaded(),Lc(this,xi(n)))return!1;(n=s.cq(n)).layers=Eh(n.layers);const m=function(T,k){if(!T)return[{command:Yr.setStyle,args:[k]}];let j=[];try{if(!s.bn(T.version,k.version))return[{command:Yr.setStyle,args:[k]}];if(s.bn(T.center,k.center)||j.push({command:Yr.setCenter,args:[k.center]}),s.bn(T.zoom,k.zoom)||j.push({command:Yr.setZoom,args:[k.zoom]}),s.bn(T.bearing,k.bearing)||j.push({command:Yr.setBearing,args:[k.bearing]}),s.bn(T.pitch,k.pitch)||j.push({command:Yr.setPitch,args:[k.pitch]}),s.bn(T.sprite,k.sprite)||j.push({command:Yr.setSprite,args:[k.sprite]}),s.bn(T.glyphs,k.glyphs)||j.push({command:Yr.setGlyphs,args:[k.glyphs]}),s.bn(T.imports,k.imports)||function(Y=[],te=[],K){te=te||[];const ne=(Y=Y||[]).map(Jr),se=te.map(Jr),me=Y.reduce(Ms,{}),xe=te.reduce(Ms,{}),ye=ne.slice();let Ee,be,we,Te;for(Ee=0,be=0;Ee<ne.length;Ee++)we=ne[Ee],xe.hasOwnProperty(we)?be++:(K.push({command:Yr.removeImport,args:[we]}),ye.splice(ye.indexOf(we,be),1));for(Ee=0,be=0;Ee<se.length;Ee++)we=se[se.length-1-Ee],ye[ye.length-1-Ee]!==we&&(me.hasOwnProperty(we)?(K.push({command:Yr.removeImport,args:[we]}),ye.splice(ye.lastIndexOf(we,ye.length-be),1)):be++,Te=ye[ye.length-Ee],K.push({command:Yr.addImport,args:[xe[we],Te]}),ye.splice(ye.length-Ee,0,we));for(const Pe of te){const Ne=me[Pe.id];Ne&&!s.bn(Ne,Pe)&&K.push({command:Yr.updateImport,args:[Pe.id,Pe]})}}(T.imports,k.imports,j),s.bn(T.transition,k.transition)||j.push({command:Yr.setTransition,args:[k.transition]}),s.bn(T.light,k.light)||j.push({command:Yr.setLight,args:[k.light]}),s.bn(T.fog,k.fog)||j.push({command:Yr.setFog,args:[k.fog]}),s.bn(T.snow,k.snow)||j.push({command:Yr.setSnow,args:[k.snow]}),s.bn(T.rain,k.rain)||j.push({command:Yr.setRain,args:[k.rain]}),s.bn(T.projection,k.projection)||j.push({command:Yr.setProjection,args:[k.projection]}),s.bn(T.lights,k.lights)||j.push({command:Yr.setLights,args:[k.lights]}),s.bn(T.camera,k.camera)||j.push({command:Yr.setCamera,args:[k.camera]}),s.bn(T.iconsets,k.iconsets)||function(Y,te,K){let ne;for(ne in te=te||{},Y=Y||{})Y.hasOwnProperty(ne)&&(te.hasOwnProperty(ne)||K.push({command:Yr.removeIconset,args:[ne]}));for(ne in te){if(!te.hasOwnProperty(ne))continue;const se=te[ne];Y.hasOwnProperty(ne)?s.bn(Y[ne],se)||(K.push({command:Yr.removeIconset,args:[ne]}),K.push({command:Yr.addIconset,args:[ne,se]})):K.push({command:Yr.addIconset,args:[ne,se]})}}(T.iconsets,k.iconsets,j),!s.bn(T["color-theme"],k["color-theme"]))return[{command:Yr.setStyle,args:[k]}];const L={},z=[];(function(Y,te,K,ne){let se;for(se in te=te||{},Y=Y||{})Y.hasOwnProperty(se)&&(te.hasOwnProperty(se)||up(se,K,ne));for(se in te){if(!te.hasOwnProperty(se))continue;const me=te[se];Y.hasOwnProperty(se)?s.bn(Y[se],me)||(Y[se].type==="geojson"&&me.type==="geojson"&&er(Y,te,se)?K.push({command:Yr.setGeoJSONSourceData,args:[se,me.data]}):Eu(se,te,K,ne)):Lo(se,te,K)}})(T.sources,k.sources,z,L);const U=[];T.layers&&T.layers.forEach(Y=>{Y.source&&L[Y.source]?j.push({command:Yr.removeLayer,args:[Y.id]}):U.push(Y)});let V=T.terrain;V&&L[V.source]&&(j.push({command:Yr.setTerrain,args:[void 0]}),V=void 0),j=j.concat(z),s.bn(V,k.terrain)||j.push({command:Yr.setTerrain,args:[k.terrain]}),function(Y,te,K){te=te||[];const ne=(Y=Y||[]).map(Jr),se=te.map(Jr),me=Y.reduce(Ms,{}),xe=te.reduce(Ms,{}),ye=ne.slice(),Ee=Object.create(null);let be,we,Te,Pe,Ne,Ke,$e;for(be=0,we=0;be<ne.length;be++)Te=ne[be],xe.hasOwnProperty(Te)?we++:(K.push({command:Yr.removeLayer,args:[Te]}),ye.splice(ye.indexOf(Te,we),1));for(be=0,we=0;be<se.length;be++)Te=se[se.length-1-be],ye[ye.length-1-be]!==Te&&(me.hasOwnProperty(Te)?(K.push({command:Yr.removeLayer,args:[Te]}),ye.splice(ye.lastIndexOf(Te,ye.length-we),1)):we++,Ke=ye[ye.length-be],K.push({command:Yr.addLayer,args:[xe[Te],Ke]}),ye.splice(ye.length-be,0,Te),Ee[Te]=!0);for(be=0;be<se.length;be++)if(Te=se[be],Pe=me[Te],Ne=xe[Te],!Ee[Te]&&!s.bn(Pe,Ne))if(s.bn(Pe.source,Ne.source)&&s.bn(Pe["source-layer"],Ne["source-layer"])&&s.bn(Pe.type,Ne.type)){for($e in fn(Pe.layout,Ne.layout,K,Te,null,Yr.setLayoutProperty),fn(Pe.paint,Ne.paint,K,Te,null,Yr.setPaintProperty),s.bn(Pe.slot,Ne.slot)||K.push({command:Yr.setSlot,args:[Te,Ne.slot]}),s.bn(Pe.filter,Ne.filter)||K.push({command:Yr.setFilter,args:[Te,Ne.filter]}),s.bn(Pe.minzoom,Ne.minzoom)&&s.bn(Pe.maxzoom,Ne.maxzoom)||K.push({command:Yr.setLayerZoomRange,args:[Te,Ne.minzoom,Ne.maxzoom]}),Pe)Pe.hasOwnProperty($e)&&$e!=="layout"&&$e!=="paint"&&$e!=="filter"&&$e!=="metadata"&&$e!=="minzoom"&&$e!=="maxzoom"&&$e!=="slot"&&($e.indexOf("paint.")===0?fn(Pe[$e],Ne[$e],K,Te,$e.slice(6),Yr.setPaintProperty):s.bn(Pe[$e],Ne[$e])||K.push({command:Yr.setLayerProperty,args:[Te,$e,Ne[$e]]}));for($e in Ne)Ne.hasOwnProperty($e)&&!Pe.hasOwnProperty($e)&&$e!=="layout"&&$e!=="paint"&&$e!=="filter"&&$e!=="metadata"&&$e!=="minzoom"&&$e!=="maxzoom"&&$e!=="slot"&&($e.indexOf("paint.")===0?fn(Pe[$e],Ne[$e],K,Te,$e.slice(6),Yr.setPaintProperty):s.bn(Pe[$e],Ne[$e])||K.push({command:Yr.setLayerProperty,args:[Te,$e,Ne[$e]]}))}else K.push({command:Yr.removeLayer,args:[Te]}),Ke=ye[ye.lastIndexOf(Te)+1],K.push({command:Yr.addLayer,args:[Ne,Ke]})}(U,k.layers,j)}catch(L){console.warn("Unable to compute style diff:",L),j=[{command:Yr.setStyle,args:[k]}]}return j}(this.serialize(),n).filter(T=>!(T.command in fS));if(m.length===0)return!1;const x=m.filter(T=>!(T.command in hS));if(x.length>0)throw new Error(`Unimplemented: ${x.map(T=>T.command).join(", ")}.`);const b=[];return m.forEach(T=>{b.push(this[T.command].apply(this,T.args))}),l&&Promise.all(b).then(l),this.stylesheet=n,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(n){const l=this.getFragmentStyle(n);l&&(l._availableImages=l.imageManager.listImages(n),l.dispatcher.broadcast("setImages",{scope:n,images:l._availableImages}))}addImages(n,l){for(const[m,x]of n.entries()){if(this.getImage(m,l))return this.fire(new s.z(new Error(`An image with the name "${m.name}" already exists.`)));this.imageManager.addImage(m,l,x),this._changes.updateImage(m,l)}return this._updateWorkerImages(l),this.fire(new s.A("data",{dataType:"style"})),this}addImage(n,l,m){return this.getImage(n,l)?this.fire(new s.z(new Error(`An image with the name "${n.name}" already exists.`))):(this.imageManager.addImage(n,l,m),this._changes.updateImage(n,l),this._updateWorkerImages(l),this.fire(new s.A("data",{dataType:"style"})),this)}updateImage(n,l,m,x=!1){this.imageManager.updateImage(n,l,m),x&&(this._changes.updateImage(n,l),this._updateWorkerImages(l),this.fire(new s.A("data",{dataType:"style"})))}getImage(n,l){return this.imageManager.getImage(n,l)}removeImage(n,l){return this.getImage(n,l)?(this.imageManager.removeImage(n,l),this._changes.updateImage(n,l),this._updateWorkerImages(l),this.fire(new s.A("data",{dataType:"style"})),this):this.fire(new s.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(n,l,m={}){return this._checkLoaded(),this._validate(Ae,`models.${n}`,l,null,m)||(this.modelManager.addModel(n,l,this.scope),this._changes.setDirty()),this}hasModel(n){return this.modelManager.hasModel(n,this.scope)}removeModel(n){return this.hasModel(n)?(this.modelManager.removeModel(n,this.scope),this):this.fire(new s.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(n,l,m={}){if(this._checkLoaded(),this.getOwnSource(n)!==void 0)throw new Error(`There is already a source with ID "${n}".`);if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(gs,`sources.${n}`,l,null,m))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const x=lp(n,l,this.dispatcher,this);x.scope=this.scope,x.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(x.id),source:x.serialize(),sourceId:x.id}));const b=T=>{const k=(T?"symbol:":"other:")+x.id,j=s.C(k,this.scope),L=this._sourceCaches[k]=new Do(j,x,T);(T?this._symbolSourceCaches:this._otherSourceCaches)[x.id]=L,L.onAdd(this.map)};b(!1),l.type!=="vector"&&l.type!=="geojson"||b(!0),x.onAdd&&x.onAdd(this.map),m.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(n){this._checkLoaded();const l=this.getOwnSource(n);if(!l)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===n)return this.fire(new s.z(new Error(`Source "${n}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===n)return this.fire(new s.z(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const x=Object.entries(this.stylesheet.iconsets).find(([b,T])=>T.type==="source"&&T.source===n);if(x)return this.fire(new s.z(new Error(`Source "${n}" cannot be removed while iconset "${x[0]}" is using it.`)))}const m=this.getOwnSourceCaches(n);for(const x of m){const b=s.cr(x.id);delete this._sourceCaches[b],this._changes.discardSourceCacheUpdate(x.id),x.fire(new s.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles()}return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],this.mergeSources(),l.setEventedParent(null),l.onRemove&&l.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(n,l){this._checkLoaded(),this.getOwnSource(n).setData(l),this._changes.setDirty()}getOwnSource(n){const l=this.getOwnSourceCache(n);return l&&l.getSource()}getOwnSources(){const n=[];for(const l in this._otherSourceCaches){const m=this.getOwnSourceCache(l);m&&n.push(m.getSource())}return n}areTilesLoaded(){const n=this._mergedSourceCaches;for(const l in n){const m=n[l]._tiles;for(const x in m){const b=m[x];if(b.state!=="loaded"&&b.state!=="errored")return!1}}return!0}setLights(n){if(this._checkLoaded(),!n)return delete this.ambientLight,void delete this.directionalLight;const l=this._getTransitionParameters();for(const x of n){if(this._validate(ql,"lights",x))return;switch(x.type){case"ambient":if(this.ambientLight){const b=this.ambientLight;b.set(x),b.updateTransitions(l)}else this.ambientLight=new vi(x,Vr||(Vr=new s.a7({color:new s.a8(s.a5.properties_light_ambient.color),"color-use-theme":new s.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.a8(s.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const b=this.directionalLight;b.set(x),b.updateTransitions(l)}else this.directionalLight=new vi(x,mn||(mn=new s.a7({direction:new s.am(s.a5.properties_light_directional.direction),color:new s.a8(s.a5.properties_light_directional.color),"color-use-theme":new s.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.a8(s.a5.properties_light_directional.intensity),"cast-shadows":new s.a8(s.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new s.a8(s.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new s.a8(s.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const m=new s.aa(this.z||0,l);this.ambientLight&&this.ambientLight.recalculate(m),this.directionalLight&&this.directionalLight.recalculate(m),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const n=this.directionalLight,l=this.ambientLight;if(!n||!l)return;const m=V=>.2126*(V[0]<=.03928?V[0]/12.92:Math.pow((V[0]+.055)/1.055,2.4))+.7152*(V[1]<=.03928?V[1]/12.92:Math.pow((V[1]+.055)/1.055,2.4))+.0722*(V[2]<=.03928?V[2]/12.92:Math.pow((V[2]+.055)/1.055,2.4)),x=n.properties.get("color").toRenderColor(null).toArray01(),b=n.properties.get("intensity"),T=n.properties.get("direction"),k=1-s.cc(T.x,T.y,T.z)[2]/90,j=m(x)*b*k,L=l.properties.get("color").toRenderColor(null).toArray01(),z=l.properties.get("intensity"),U=m(L)*z;return Number(((j+U)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const n=[];return this.directionalLight&&n.push(this.directionalLight.get()),this.ambientLight&&n.push(this.ambientLight.get()),n}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(n){if(!n)return this;if(s.cs(n)){const l=s.ct(n),m=this.fragments.find(({id:b})=>b===l);if(!m)throw new Error(`Style import '${n}' not found`);const x=s.cr(n);return m.style.getFragmentStyle(x)}{const l=this.fragments.find(({id:m})=>m===n);return l?l.style:void 0}}setFeaturesetSelectors(n){if(!n)return;const l={},m=(x,b="")=>`${x}::${b}`;this._featuresetSelectors={};for(const x in n){const b=this._featuresetSelectors[x]=[];for(const T of n[x].selectors){if(T.featureNamespace){const j=this.getOwnLayer(T.layer);if(!j){s.w(`Layer is undefined for selector: ${T.layer}`);continue}const L=m(j.source,j.sourceLayer);if(L in l&&l[L]!==T.featureNamespace){s.w(`"featureNamespace ${T.featureNamespace} of featureset ${x}'s selector is not associated to the same source, skip this selector`);continue}l[L]=T.featureNamespace}let k;if(T.properties)for(const j in T.properties){const L=s.X(T.properties[j]);L.result==="success"&&(k=k||{},k[j]=L.value)}b.push({layerId:T.layer,namespace:T.featureNamespace,properties:k,uniqueFeatureID:T._uniqueFeatureID})}}}getFeaturesetDescriptors(n){const l=this.getFragmentStyle(n);if(!l||!l.stylesheet.featuresets)return[];const m=[];for(const x in l.stylesheet.featuresets)m.push({featuresetId:x,importId:l.scope?l.scope:void 0});return m}getFeaturesetLayers(n,l){const m=this.getFragmentStyle(l),x=m.stylesheet.featuresets;if(!x||!x[n])return this.fire(new s.z(new Error(`The featureset '${n}' does not exist in the map's style and cannot be queried.`))),[];const b=[];for(const T of x[n].selectors){const k=m.getOwnLayer(T.layer);k&&b.push(k)}return b}getConfigProperty(n,l){const m=this.getFragmentStyle(n);if(!m)return null;const x=s.C(l,m.scope),b=m.options.get(x),T=b?b.value||b.default:null;return T?T.serialize():null}setConfigProperty(n,l,m){const x=this.getFragmentStyle(n);if(!x)return;const b=x.stylesheet.indoor?h0(x.stylesheet.schema):x.stylesheet.schema;if(!b||!b[l])return;const T=s.X(m);if(T.result!=="success")return void Lc(this,T.value);const k=T.value.expression,j=s.C(l,x.scope),L=x.options.get(j);if(!L)return;let z;const{minValue:U,maxValue:V,stepValue:Y,type:te,values:K}=b[l],ne=s.X(b[l].default);ne.result==="success"&&(z=ne.value.expression),z?(this.options.set(j,Object.assign({},L,{value:k,default:z,minValue:U,maxValue:V,stepValue:Y,type:te,values:K})),this.updateConfigDependencies(l)):this.fire(new s.z(new Error(`No schema defined for the config option "${l}" in the "${n}" fragment.`)))}getConfig(n){const l=this.getFragmentStyle(n);if(!l)return null;const m=l.stylesheet.schema;if(!m)return null;const x={};for(const b in m){const T=s.C(b,l.scope),k=l.options.get(T),j=k?k.value||k.default:null;x[b]=j?j.serialize():null}return x}setConfig(n,l){const m=this.getFragmentStyle(n);m&&(m.updateConfig(l,m.stylesheet.schema),this.updateConfigDependencies())}getSchema(n){const l=this.getFragmentStyle(n);return l?l.stylesheet.schema:null}setSchema(n,l){const m=this.getFragmentStyle(n);m&&(m.stylesheet.schema=l,m.updateConfig(m._config,l),this.updateConfigDependencies())}updateConfig(n,l){if(this._config=n,n||l)if(l)for(const m in l){let x,b;const T=s.X(l[m].default);if(T.result==="success"&&(x=T.value.expression),n&&n[m]!==void 0){const V=s.X(n[m]);V.result==="success"&&(b=V.value.expression)}const{minValue:k,maxValue:j,stepValue:L,type:z,values:U}=l[m];if(x){const V=s.C(m,this.scope);this.options.set(V,{default:x,value:b,minValue:k,maxValue:j,stepValue:L,type:z,values:U})}else this.fire(new s.z(new Error(`No schema defined for config option "${m}".`)))}else this.fire(new s.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(n){for(const l of this._configDependentLayers){const m=this.getLayer(l);if(m){if(n&&!m.configDependencies.has(n))continue;m.possiblyEvaluateVisibility(),this._updateLayer(m)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(l=>{const m=l._styleColorTheme.colorThemeOverride?l._styleColorTheme.colorThemeOverride:l._styleColorTheme.colorTheme;if(m){const x=l._evaluateColorThemeData(m);(!l._styleColorTheme.lut&&x!==""||l._styleColorTheme.lut&&x!==l._styleColorTheme.lut.data)&&l.setColorTheme(m)}}),this._changes.setDirty()}addLayer(n,l,m={}){this._checkLoaded();const x=n.id;if(this._layers[x])return void this.fire(new s.z(new Error(`Layer with id "${x}" already exists on this map`)));let b;if(n.type==="custom"){if(Lc(this,s.cu(n)))return;b=s.cv(n,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof n.source=="object"&&(this.addSource(x,n.source),n=s.cq(n),n=s.l(n,{source:x})),this._validate(oe,`layers.${x}`,n,{arrayIndex:-1},m))return;b=s.cv(n,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(b),b.setEventedParent(this,{layer:{id:x}})}b.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid);let T=this._order.length;if(l){const z=this._order.indexOf(l);if(z===-1)return void this.fire(new s.z(new Error(`Layer with id "${l}" does not exist on this map.`)));b.slot===this._layers[l].slot?T=z:s.w(`Layer with id "${l}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(T,0,x),this._layerOrderChanged=!0,this._layers[x]=b;const k=this.getOwnLayerSourceCache(b),j=!!this.directionalLight&&this.directionalLight.shadowsEnabled();k&&b.canCastShadows()&&j&&(k.castsShadows=!0);const L=this._changes.getRemovedLayer(b);if(L&&b.source&&k&&b.type!=="custom"){this._changes.discardLayerRemoval(b);const z=s.C(b.source,b.scope);L.type!==b.type?this._changes.updateSourceCache(z,"clear"):(this._changes.updateSourceCache(z,"reload"),k.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),b.scope=this.scope,this.mergeLayers()}moveLayer(n,l){this._checkLoaded();const m=this._checkLayer(n);if(!m||n===l)return;const x=this._order.indexOf(n);this._order.splice(x,1);let b=this._order.length;if(l){const T=this._order.indexOf(l);if(T===-1)return void this.fire(new s.z(new Error(`Layer with id "${l}" does not exist on this map.`)));m.slot===this._layers[l].slot?b=T:s.w(`Layer with id "${l}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(b,0,n),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(n){this._checkLoaded();const l=this._checkLayer(n);if(!l)return;l.setEventedParent(null);const m=this._order.indexOf(n);this._order.splice(m,1),delete this._layers[n],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(l.fqid),this._changes.removeLayer(l);const x=this.getOwnLayerSourceCache(l);if(x&&x.castsShadows){let b=!1;for(const T in this._layers)if(this._layers[T].source===l.source&&this._layers[T].canCastShadows()){b=!0;break}x.castsShadows=b}l.onRemove&&l.onRemove(this.map),this.mergeLayers()}getOwnLayer(n){return this._layers[n]}hasLayer(n){return n in this._mergedLayers}hasLayerType(n){for(const l in this._layers)if(this._layers[l].type===n)return!0;return!1}setLayerZoomRange(n,l,m){this._checkLoaded();const x=this._checkLayer(n);x&&(x.minzoom===l&&x.maxzoom===m||(l!=null&&(x.minzoom=l),m!=null&&(x.maxzoom=m),this._updateLayer(x)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(n,l){this._checkLoaded();const m=this._checkLayer(n);m&&m.slot!==l&&(m.slot=l,this._updateLayer(m))}setFilter(n,l,m={}){this._checkLoaded();const x=this._checkLayer(n);if(x&&!s.bn(x.filter,l))return l==null?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(ue,`layers.${x.id}.filter`,l,{layerType:x.type},m)||(x.filter=s.cq(l),this._updateLayer(x)))}getFilter(n){const l=this._checkLayer(n);if(l)return s.cq(l.filter)}setLayoutProperty(n,l,m,x={}){this._checkLoaded();const b=this._checkLayer(n);if(b&&!s.bn(b.getLayoutProperty(l),m)){if(m!=null&&(!x||x.validate!==!1)&&Lc(b,Ie.call(xi,{key:`layers.${n}.layout.${l}`,layerType:b.type,objectKey:l,value:m,styleSpec:s.a5,style:{glyphs:!0,sprite:!0}})))return;b.setLayoutProperty(l,m),b.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid),this._updateLayer(b)}}getLayoutProperty(n,l){const m=this._checkLayer(n);if(m)return m.getLayoutProperty(l)}setPaintProperty(n,l,m,x={}){this._checkLoaded();const b=this._checkLayer(n);if(!b||s.bn(b.getPaintProperty(l),m)||m!=null&&(!x||x.validate!==!1)&&Lc(b,ve.call(xi,{key:`layers.${n}.paint.${l}`,layerType:b.type,objectKey:l,value:m,styleSpec:s.a5})))return;const T=b.setPaintProperty(l,m);b.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid),T&&this._updateLayer(b),this._changes.updatePaintProperties(b)}getPaintProperty(n,l){const m=this._checkLayer(n);if(m)return m.getPaintProperty(l)}setFeatureState(n,l){if(this._checkLoaded(),"target"in n){if("featuresetId"in n.target){const{featuresetId:j,importId:L}=n.target,z=this.getFragmentStyle(L),U=z.getFeaturesetLayers(j);for(const{source:V,sourceLayer:Y}of U)z.setFeatureState({id:n.id,source:V,sourceLayer:Y},l)}else if("layerId"in n.target){const{layerId:j}=n.target,L=this.getLayer(j);this.setFeatureState({id:n.id,source:L.source,sourceLayer:L.sourceLayer},l)}return}const m=n.source,x=n.sourceLayer,b=this._checkSource(m);if(!b)return;const T=b.type;if(T==="geojson"&&x)return void this.fire(new s.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(T==="vector"&&!x)return void this.fire(new s.z(new Error("The sourceLayer parameter must be provided for vector source types.")));n.id===void 0&&this.fire(new s.z(new Error("The feature id parameter must be provided.")));const k=this.getOwnSourceCaches(m);for(const j of k)j.setFeatureState(x,n.id,l)}removeFeatureState(n,l){if(this._checkLoaded(),"target"in n){if("featuresetId"in n.target){const{featuresetId:j,importId:L}=n.target,z=this.getFragmentStyle(L),U=z.getFeaturesetLayers(j);for(const{source:V,sourceLayer:Y}of U)z.removeFeatureState({id:n.id,source:V,sourceLayer:Y},l)}else if("layerId"in n.target){const{layerId:j}=n.target,L=this.getLayer(j);this.removeFeatureState({id:n.id,source:L.source,sourceLayer:L.sourceLayer},l)}return}const m=n.source,x=this._checkSource(m);if(!x)return;const b=x.type,T=b==="vector"?n.sourceLayer:void 0;if(b==="vector"&&!T)return void this.fire(new s.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(l&&typeof n.id!="string"&&typeof n.id!="number")return void this.fire(new s.z(new Error("A feature id is required to remove its specific state property.")));const k=this.getOwnSourceCaches(m);for(const j of k)j.removeFeatureState(T,n.id,l)}getFeatureState(n){if(this._checkLoaded(),"target"in n){let b;if("featuresetId"in n.target){const{featuresetId:T,importId:k}=n.target,j=this.getFragmentStyle(k),L=j.getFeaturesetLayers(T);for(const{source:z,sourceLayer:U}of L){const V=j.getFeatureState({id:n.id,source:z,sourceLayer:U});if(V&&!b)b=V;else if(!s.bn(b,V))return void this.fire(new s.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in n.target){const{layerId:T}=n.target,k=this.getLayer(T);b=this.getFeatureState({id:n.id,source:k.source,sourceLayer:k.sourceLayer})}return b}const l=n.source,m=n.sourceLayer,x=this._checkSource(l);if(x){if(x.type!=="vector"||m)return n.id===void 0&&this.fire(new s.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(l)[0].getFeatureState(m,n.id);this.fire(new s.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(n){return this.stylesheet.transition=s.l({},this.stylesheet.transition,n),this.transition=this.stylesheet.transition,this}getTransition(){return s.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const n=this.getTerrain(),l=n&&this.terrain&&this.terrain.scope===this.scope?n:this.stylesheet.terrain;return s.cw({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:l,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},m=>m!==void 0)}_updateFilteredLayers(n){for(const l of Object.values(this._mergedLayers))n(l)&&this._updateLayer(l)}_updateLayer(n){this._changes.updateLayer(n);const l=this.getLayerSourceCache(n),m=s.C(n.source,n.scope),x=this._changes.getUpdatedSourceCaches();n.source&&!x[m]&&l&&l.getSource().type!=="raster"&&(this._changes.updateSourceCache(m,"reload"),l.pause()),n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const l=k=>this._mergedLayers[k].is3D(!!this.terrain),m=this.order,x={},b=[];for(let k=m.length-1;k>=0;k--){const j=m[k];if(l(j)){x[j]=k;for(const L of n){const z=L[j];if(z)for(const U of z)b.push(U)}}}b.sort((k,j)=>j.intersectionZ-k.intersectionZ);const T=[];for(let k=m.length-1;k>=0;k--){const j=m[k];if(l(j))for(let L=b.length-1;L>=0;L--){const z=b[L].feature;if(z.layer&&x[z.layer.id]<k)break;T.push(z),b.pop()}else for(const L of n){const z=L[j];if(z)for(const U of z)T.push(U.feature)}}return T}queryRenderedFeatures(n,l,m){let x;l&&!Array.isArray(l)&&l.filter&&(this._validate(ue,"queryRenderedFeatures.filter",l.filter,null,l),x=s.a_(l.filter));const b={},T=z=>{if(yp.has(z.type))return;const U=this.getOwnLayerSourceCache(z),V=b[U.id]=b[U.id]||{sourceCache:U,layers:{},has3DLayers:!1};z.is3D(!!this.terrain)&&(V.has3DLayers=!0),V.layers[z.fqid]=V.layers[z.fqid]||{styleLayer:z,targets:[]},V.layers[z.fqid].targets.push({filter:x})};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new s.z(new Error("parameters.layers must be an Array."))),[];for(const z of l.layers){const U=this._layers[z];if(!U)return this.fire(new s.z(new Error(`The layer '${z}' does not exist in the map's style and cannot be queried for features.`))),[];T(U)}}else for(const z in this._layers)T(this._layers[z]);const k=this._queryRenderedFeatures(n,b,m),j=this._flattenAndSortRenderedFeatures(k),L=[];for(const z of j)s.ct(z.layer.id)===this.scope&&L.push(z);return L}queryRenderedFeatureset(n,l,m){let x;l&&!Array.isArray(l)&&l.filter&&(this._validate(ue,"queryRenderedFeatures.filter",l.filter,null,l),x=s.a_(l.filter));const b="mock",T=[];if(l&&l.target)T.push(Object.assign({},l,{targetId:b,filter:x}));else{const z=this.getFeaturesetDescriptors();for(const U of z)T.push({targetId:b,filter:x,target:U});for(const{style:U}of this.fragments){const V=U.getFeaturesetDescriptors();for(const Y of V)T.push({targetId:b,filter:x,target:Y})}}const k=this.queryRenderedTargets(n,T,m),j=[],L=new Set;for(const z of k)for(const U of z.variants[b])wu(U,z,L)||j.push(new s.cx(z,U));return j}queryRenderedTargets(n,l,m){const x={},b=(k,j,L,z)=>{const U=x[j.id]=x[j.id]||{sourceCache:j,layers:{},has3DLayers:!1};if(U.layers[k.fqid]=U.layers[k.fqid]||{styleLayer:k,targets:[]},k.is3D(!!this.terrain)&&(U.has3DLayers=!0),!z)return L.uniqueFeatureID=!1,void U.layers[k.fqid].targets.push(L);U.layers[k.fqid].targets.push(Object.assign({},L,{namespace:z.namespace,properties:z.properties,uniqueFeatureID:z.uniqueFeatureID}))};for(const k of l)if("featuresetId"in k.target){const{featuresetId:j,importId:L}=k.target,z=this.getFragmentStyle(L);if(!z||!z._featuresetSelectors)continue;const U=z._featuresetSelectors[j];if(!U){this.fire(new s.z(new Error(`The featureset '${j}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const V of U){const Y=z.getOwnLayer(V.layerId);Y&&!yp.has(Y.type)&&b(Y,z.getOwnLayerSourceCache(Y),k,V)}}else if("layerId"in k.target){const{layerId:j}=k.target,L=this.getLayer(j);if(!L||yp.has(L.type))continue;b(L,this.getLayerSourceCache(L),k)}const T=this._queryRenderedFeatures(n,x,m);return this._flattenAndSortRenderedFeatures(T)}_queryRenderedFeatures(n,l,m){const x=[],b=!!this.map._showQueryGeometry,T=Ki.createFromScreenPoints(n,m);for(const k in l){const j=Yg(T,l[k],this._availableImages,m,b);Object.keys(j).length&&x.push(j)}if(this.placement)for(const k in l){if(!l[k].sourceCache._onlySymbols)continue;const j=i0(T.screenGeometry,l[k],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData);Object.keys(j).length&&x.push(j)}return x}querySourceFeatures(n,l){const m=l&&l.filter;m&&this._validate(ue,"querySourceFeatures.filter",m,null,l);let x=[];const b=this.getOwnSourceCaches(n);for(const T of b)x=x.concat(s0(T,l));return x}addSourceType(n,l,m){return la.getSourceType(n)?m(new Error(`A source type called "${n}" already exists.`)):(la.setSourceType(n,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:l.workerSourceURL},m):m(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(n,l,m={}){this._checkLoaded();const x=this.light.getLight();let b=!1;for(const k in n)if(!s.bn(n[k],x[k])){b=!0;break}if(!b)return;const T=this._getTransitionParameters();this.light.setLight(n,l,m),this.light.updateTransitions(T)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=s.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&s.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(n,l=1){if(this._checkLoaded(),!n)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),l===0&&delete this.terrain,n===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let m=n;const x=n.source==null;if(l===1){if(this.disableElevatedTerrain)return;if(typeof m.source=="object"){const k="terrain-dem-src";this.addSource(k,m.source),m=s.cq(m),m=s.l(m,{source:k})}const b=s.l({},m),T={};if(this.terrain&&x){b.source=this.terrain.get().source;const k=this.terrain?this.getFragmentStyle(this.terrain.scope):null;k&&(T.style=k.serialize())}if(this._validate(op,"terrain",b,T))return}if(!this.terrain||this.terrain.scope!==this.scope&&!x||this.terrain&&l!==this.terrain.drapeRenderMode){if(!m)return;this._createTerrain(m,l),this.fire(new s.A("data",{dataType:"style"}))}else{const b=this.terrain,T=b.get();for(const k of Object.keys(s.a5.terrain))!m.hasOwnProperty(k)&&s.a5.terrain[k].default&&(m[k]=s.a5.terrain[k].default);for(const k in n)if(!s.bn(n[k],T[k])){b.set(n,this.options),this.stylesheet.terrain=n;const j=this._getTransitionParameters({duration:0});b.updateTransitions(j),this.fire(new s.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const l=this.fog=new Dr(n,this.map.transform,this.scope,this.options);this.stylesheet.fog=l.get();const m=this._getTransitionParameters({duration:0});l.updateTransitions(m)}_createSnow(n){const l=this.snow=new gn(n,this.map.transform,this.scope,this.options);this.stylesheet.snow=l.get();const m=this._getTransitionParameters({duration:0});l.updateTransitions(m)}_createRain(n){const l=this.rain=new vn(n,this.map.transform,this.scope,this.options);this.stylesheet.rain=l.get();const m=this._getTransitionParameters({duration:0});l.updateTransitions(m)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const l=this.fog;if(!s.bn(l.get(),n)){l.set(n,this.options),this.stylesheet.fog=l.get();const m=this._getTransitionParameters({duration:0});l.updateTransitions(m)}}else this._createFog(n);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(n){if(this._checkLoaded(),!n)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const l=this.snow;if(!s.bn(l.get(),n)){l.set(n,this.options),this.stylesheet.snow=l.get();const m=this._getTransitionParameters({duration:0});l.updateTransitions(m)}}else this._createSnow(n);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(n){if(this._checkLoaded(),!n)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const l=this.rain;if(!s.bn(l.get(),n)){l.set(n,this.options),this.stylesheet.rain=l.get();const m=this._getTransitionParameters({duration:0});l.updateTransitions(m)}}else this._createRain(n);this._markersNeedUpdate=!0}_reloadColorTheme(){const n=()=>{for(const x in this._layers)this._layers[x].lut=this._styleColorTheme.lut;for(const x in this._sourceCaches)this._sourceCaches[x].clearTiles()},l=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!l)return this._styleColorTheme.lut=null,void n();const m=this._evaluateColorThemeData(l);this._loadColorTheme(m).then(()=>{this.fire(new s.A("colorthemeset")),n()}).catch(x=>{s.w(`Couldn't set color theme: ${x}`)})}setColorTheme(n){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&s.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=n,this._reloadColorTheme()}setImportColorTheme(n,l){const m=this.getFragmentStyle(n);m&&(m._styleColorTheme.colorThemeOverride=l,m._reloadColorTheme())}_getTransitionParameters(n){return{now:s.q.now(),transition:s.l(this.transition,n)}}updateDrapeFirstLayers(){if(!this.terrain)return;const n=[],l=[];for(const m of this._mergedOrder)this.isLayerDraped(this._mergedLayers[m])?n.push(m):l.push(m);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...l)}_createTerrain(n,l){const m=this.terrain=new st(n,l,this.scope,this.options);l===1&&(this.stylesheet.terrain=n),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const x=this._getTransitionParameters({duration:0});m.updateTransitions(x)}_force3DLayerUpdate(){for(const n in this._layers){const l=this._layers[n];l.type==="fill-extrusion"&&this._updateLayer(l)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const l=this._layers[n];l.type==="symbol"&&this._updateLayer(l)}}_validate(n,l,m,x,b={}){if(b&&b.validate===!1)return!1;const T=s.l({},this.serialize());return Lc(this,n.call(xi,s.l({key:l,style:T,value:m,styleSpec:s.a5},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.cy.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._mergedLayers)this._mergedLayers[n].setEventedParent(null);for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles(),this._mergedSourceCaches[n].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(n){const l=this.getSourceCaches(n);for(const m of l)m.clearTiles()}clearSources(){for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles()}reloadSource(n){const l=this.getSourceCaches(n);for(const m of l)m.resume(),m.reload()}reloadSources(){for(const n of this.getSources())n.reload&&n.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(n=>{n.modelManager.reloadModels(n.scope)})}updateSources(n){let l;this.directionalLight&&(l=Xl(this.directionalLight));for(const m in this._mergedSourceCaches)this._mergedSourceCaches[m].update(n,void 0,void 0,l)}_generateCollisionBoxes(){for(const n in this._sourceCaches){const l=this._sourceCaches[n];l.resume(),l.reload()}}_updatePlacement(n,l,m,x,b,T,k=!1){let j=!1,L=!1;const z={},U={};for(const V of this._mergedOrder){const Y=this._mergedLayers[V];if(Y.type!=="symbol")continue;const te=s.C(Y.source,Y.scope);let K=z[te];if(!K){const se=this.getLayerSourceCache(Y);if(!se)continue;const me=se.getRenderableIds(!0).map(xe=>se.getTileByID(xe));U[te]=me.slice(),K=z[te]=me.sort((xe,ye)=>ye.tileID.overscaledZ-xe.tileID.overscaledZ||(xe.tileID.isLessThan(ye.tileID)?-1:1))}const ne=this.crossTileSymbolIndex.addLayer(Y,K,l.center.lng,l.projection);j=j||ne}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),k=k||this._layerOrderChanged||x===0,this._layerOrderChanged&&this.fire(new s.A("neworder")),(k||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.q.now(),l.zoom))&&(this.pauseablePlacement=new Zl(l,this._mergedOrder,k,m,x,b,this.placement,this.fog&&l.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,z,U,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.q.now()),L=!0),j&&this.pauseablePlacement.placement.setStale()),L||j){this._buildingIndex.onNewFrame(l.zoom);for(let V=0;V<this._mergedOrder.length;V++){const Y=this._mergedLayers[this._mergedOrder[V]];if(Y.type!=="symbol")continue;const te=this.isLayerClipped(Y);this.placement.updateLayerOpacities(Y,z[s.C(Y.source,Y.scope)],V,te?T:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.q.now())}}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}addImport(n,l){this._checkLoaded();const m=this.stylesheet.imports=this.stylesheet.imports||[];if(m.findIndex(({id:b})=>b===n.id)!==-1)return void this.fire(new s.z(new Error(`Import with id '${n.id}' already exists in the map's style.`)));if(!l)return m.push(n),this._loadImports([n],!0);const x=m.findIndex(({id:b})=>b===l);return x===-1&&this.fire(new s.z(new Error(`Import with id "${l}" does not exist on this map.`))),this.stylesheet.imports=m.slice(0,x).concat(n).concat(m.slice(x)),this._loadImports([n],!0,l)}updateImport(n,l){this._checkLoaded();const m=this.stylesheet.imports||[],x=this.getImportIndex(n);return x===-1?this:typeof l=="string"?(this.setImportUrl(n,l),this):(l.url&&l.url!==m[x].url&&this.setImportUrl(n,l.url),s.bn(l.config,m[x].config)||this.setImportConfig(n,l.config,l.data.schema),s.bn(l.data,m[x].data)||this.setImportData(n,l.data),this)}moveImport(n,l){this._checkLoaded();let m=this.stylesheet.imports||[];const x=this.getImportIndex(n);if(x===-1)return this;const b=this.getImportIndex(l);if(b===-1)return this;const T=m[x],k=this.fragments[x];return m=m.filter(({id:j})=>j!==n),this.fragments=this.fragments.filter(({id:j})=>j!==n),this.stylesheet.imports=m.slice(0,b).concat(T).concat(m.slice(b)),this.fragments=this.fragments.slice(0,b).concat(k).concat(this.fragments.slice(b)),this.mergeLayers(),this}setImportUrl(n,l){this._checkLoaded();const m=this.stylesheet.imports||[],x=this.getImportIndex(n);if(x===-1)return this;m[x].url=l;const b=this.fragments[x];return b.style=this._createFragmentStyle(m[x]),b.style.on("style.import.load",()=>this.mergeAll()),b.style.loadURL(l),this}setImportData(n,l){this._checkLoaded();const m=this.getImportIndex(n),x=this.stylesheet.imports||[];return m===-1?this:l?(this.fragments[m].style.setState(l),this._reloadImports(),this):(delete x[m].data,this.setImportUrl(n,x[m].url))}setImportConfig(n,l,m){this._checkLoaded();const x=this.getImportIndex(n),b=this.stylesheet.imports||[];if(x===-1)return this;l?b[x].config=l:delete b[x].config;const T=this.fragments[x];m&&T.style.stylesheet&&(T.style.stylesheet.schema=m);const k=T.style.stylesheet&&T.style.stylesheet.schema;return T.config=l,T.style.updateConfig(l,k),this.updateConfigDependencies(),this}removeImport(n){this._checkLoaded();const l=this.stylesheet.imports||[],m=this.getImportIndex(n);m!==-1&&(l.splice(m,1),this.fragments[m].style._remove(),this.fragments.splice(m,1),this._reloadImports())}getImportIndex(n){const l=(this.stylesheet.imports||[]).findIndex(m=>m.id===n);return l===-1&&this.fire(new s.z(new Error(`Import '${n}' does not exist in the map's style and cannot be updated.`))),l}getLayer(n){return this._mergedLayers[n]}getSources(){const n=[];for(const l in this._mergedOtherSourceCaches){const m=this._mergedOtherSourceCaches[l];m&&n.push(m.getSource())}return n}getSource(n,l){const m=this.getSourceCache(n,l);return m&&m.getSource()}getLayerSource(n){const l=this.getLayerSourceCache(n);return l&&l.getSource()}getSourceCache(n,l){const m=s.C(n,l);return this._mergedOtherSourceCaches[m]}getLayerSourceCache(n){const l=s.C(n.source,n.scope);return n.type==="symbol"?this._mergedSymbolSourceCaches[l]:this._mergedOtherSourceCaches[l]}getSourceCaches(n){if(n==null)return Object.values(this._mergedSourceCaches);const l=[];return this._mergedOtherSourceCaches[n]&&l.push(this._mergedOtherSourceCaches[n]),this._mergedSymbolSourceCaches[n]&&l.push(this._mergedSymbolSourceCaches[n]),l}updateSourceCaches(){const n=this._changes.getUpdatedSourceCaches();for(const l in n){const m=n[l];m==="reload"?this.reloadSource(l):m==="clear"&&this.clearSource(l)}}updateLayers(n){const l=this._changes.getUpdatedPaintProperties();for(const m of l){const x=this.getLayer(m);x&&x.updateTransitions(n)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(n){this.stylesheet.glyphs=n,this.glyphManager.setURL(n,this.scope)}getImages(n,l,m){this.imageManager.getImages(l.images,l.scope,m),this._updateTilesForChangedImages();const x=T=>{if(T){const k=l.images.map(j=>s.I.toString(j));T.setDependencies(l.tileID.key,l.type,k)}},b=s.C(l.source,l.scope);x(this._mergedOtherSourceCaches[b]),x(this._mergedSymbolSourceCaches[b])}rasterizeImages(n,l,m){this.imageManager.rasterizeImages(l,m)}getGlyphs(n,l,m){this.glyphManager.getGlyphs(l.stacks,l.scope,m)}getResource(n,l,m){return s.cz(l,m)}getOwnSourceCache(n){return this._otherSourceCaches[n]}getOwnLayerSourceCache(n){return n.type==="symbol"?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}getOwnSourceCaches(n){const l=[];return this._otherSourceCaches[n]&&l.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&l.push(this._symbolSourceCaches[n]),l}_isSourceCacheLoaded(n){const l=this.getOwnSourceCaches(n);return l.length===0?(this.fire(new s.z(new Error(`There is no source with ID '${n}'`))),!1):l.every(m=>m.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(n,l){if(!this._clipLayerPresent&&n.type!=="fill-extrusion")return!1;const m=n.type==="fill-extrusion"&&n.sourceLayer==="building";if(n.is3D(!!this.terrain)){if(m||l&&l.type==="batched-model"||n.type==="model")return!0}else if(n.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(n=>{n.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}la.getSourceType=function(g){return Zg[g]},la.setSourceType=function(g,n){Zg[g]=n},la.registerForPluginStateChange=s.ci;var o_=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,xp=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,jh=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,vp="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Kl=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,bp=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,a_=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Oc=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Lu=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Dh=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Lh=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef TEXTURE_GATHER
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return clamp(mix(lerpx.x,lerpx.y,f.y),0.0,1.0);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz/=light_view_pos0.w;vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const al=[];Ra(o_,al),Ra(jh,al),Ra(xp,al);const zc={"_prelude_fog.vertex.glsl":bp,"_prelude_terrain.vertex.glsl":Kl,"_prelude_shadow.vertex.glsl":Dh,"_prelude_fog.fragment.glsl":a_,"_prelude_shadow.fragment.glsl":Lh,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Oc,"_prelude_raster_particle.glsl":Lu},Ou={};qr("",Kl),qr(a_,bp),qr(Lh,Dh),qr(Oc,""),qr(Lu,"");const l_=qr(xp,jh),wp=o_;var Oh={background:qr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:qr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:qr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:qr("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:qr(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:qr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:qr("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:qr("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:qr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:qr(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:qr(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:qr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
void main() {vec3 color=vec3(241.0/255.0,236.0/255.0,225.0/255.0);
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,normal);
#endif
if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(v_normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:qr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:qr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:qr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:qr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:qr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:qr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:qr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:qr(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:qr(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:qr(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:qr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:qr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),0.001);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:qr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:qr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:qr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:qr("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:qr("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:qr(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:qr(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#else
z+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#endif
}`),terrainRaster:qr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:qr("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:qr(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,vp),skyboxGradient:qr(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,vp),skyboxCapture:qr(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:qr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:qr(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:qr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:qr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:qr(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:qr("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:qr("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:qr("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:qr("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Ra(g,n){const l=g.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let m of l)if(m=m.trim(),m[0]==="#"&&m.includes("if")&&!m.includes("endif")){m=m.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const x=m.split(" ");for(const b of x)n.includes(b)||n.push(b)}}function qr(g,n){const l=/#include\s+"([^"]+)"/g,m=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let x=n.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);x&&(x=x.map(L=>{const z=L.split(" ");return z[z.length-1]}),x=[...new Set(x)]);const b={},T=[],k=[];if(g=g.replace(l,(L,z)=>(k.push(z),"")),(n=n.replace(l,(L,z)=>(T.push(z),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let j=[...al];Ra(g,j),Ra(n,j);for(const L of[...T,...k])zc[L]||console.error(`Undefined include: ${L}`),Ou[L]||(Ou[L]=[],Ra(zc[L],Ou[L])),j=[...j,...Ou[L]];return{fragmentSource:g=g.replace(m,(L,z,U,V,Y)=>(b[Y]=!0,z==="define"?`
#ifndef HAS_UNIFORM_u_${Y}
in ${U} ${V} ${Y};
#else
uniform ${U} ${V} u_${Y};
#endif
`:z==="initialize"?`
#ifdef HAS_UNIFORM_u_${Y}
    ${U} ${V} ${Y} = u_${Y};
#endif
`:z==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Y}
    in ${U} ${V} ${Y};
#endif
`:z==="initialize-attribute"?"":void 0)),vertexSource:n=n.replace(m,(L,z,U,V,Y)=>{const te=V==="float"?"vec2":V,K=Y.match(/color/)?"color":te;return z==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${Y}
in ${U} ${V} a_${Y};
#endif
`:b[Y]?z==="define"?`
#ifndef HAS_UNIFORM_u_${Y}
uniform lowp float u_${Y}_t;
in ${U} ${te} a_${Y};
out ${U} ${V} ${Y};
#else
uniform ${U} ${V} u_${Y};
#endif
`:z==="initialize"?K==="vec4"?`
#ifndef HAS_UNIFORM_u_${Y}
    ${Y} = a_${Y};
#else
    ${U} ${V} ${Y} = u_${Y};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Y}
    ${Y} = unpack_mix_${K}(a_${Y}, u_${Y}_t);
#else
    ${U} ${V} ${Y} = u_${Y};
#endif
`:z==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Y}
    in ${U} ${V} a_${Y};
    out ${U} ${V} ${Y};
#endif
`:z==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Y}
    ${Y} = a_${Y};
#endif
`:void 0:z==="define"?`
#ifndef HAS_UNIFORM_u_${Y}
uniform lowp float u_${Y}_t;
in ${U} ${te} a_${Y};
#else
uniform ${U} ${V} u_${Y};
#endif
`:z==="define-instanced"?K==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${Y}0;
in vec4 a_${Y}1;
in vec4 a_${Y}2;
in vec4 a_${Y}3;
#else
uniform ${U} ${V} u_${Y};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${U} ${te} a_${Y};
#else
uniform ${U} ${V} u_${Y};
#endif
`:z==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${Y}
    ${U} ${V} ${Y} = a_${Y};
#endif
`:K==="vec4"?`
#ifndef HAS_UNIFORM_u_${Y}
    ${U} ${V} ${Y} = a_${Y};
#else
    ${U} ${V} ${Y} = u_${Y};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Y}
    ${U} ${V} ${Y} = unpack_mix_${K}(a_${Y}, u_${Y}_t);
#else
    ${U} ${V} ${Y} = u_${Y};
#endif
`}),staticAttributes:x,usedDefines:j,vertexIncludes:T,fragmentIncludes:k}}class g0{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,l,m,x,b,T,k,j){this.context=n;let L=this.boundPaintVertexBuffers.length!==x.length;for(let U=0;!L&&U<x.length;U++)this.boundPaintVertexBuffers[U]!==x[U]&&(L=!0);let z=this.boundDynamicVertexBuffers.length!==k.length;for(let U=0;!z&&U<k.length;U++)this.boundDynamicVertexBuffers[U]!==k[U]&&(z=!0);if(!this.vao||this.boundProgram!==l||this.boundLayoutVertexBuffer!==m||L||z||this.boundIndexBuffer!==b||this.boundVertexOffset!==T)this.freshBind(l,m,x,b,T,k,j);else{n.bindVertexArrayOES.set(this.vao);for(const U of k)U&&(U.bind(),j&&U.instanceCount&&U.setVertexAttribDivisor(n.gl,l,j));b&&b.dynamicDraw&&b.bind()}}freshBind(n,l,m,x,b,T,k){const j=n.numAttributes,L=this.context,z=L.gl;this.vao&&this.destroy(),this.vao=L.gl.createVertexArray(),L.bindVertexArrayOES.set(this.vao),this.boundProgram=n,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=x,this.boundVertexOffset=b,this.boundDynamicVertexBuffers=T,l.enableAttributes(z,n),l.bind(),l.setVertexAttribPointers(z,n,b);for(const U of m)U.enableAttributes(z,n),U.bind(),U.setVertexAttribPointers(z,n,b);for(const U of T)U&&(U.enableAttributes(z,n),U.bind(),U.setVertexAttribPointers(z,n,b),k&&U.instanceCount&&U.setVertexAttribDivisor(z,n,k));x&&x.bind(),L.currentNumAttributes=j}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function _0(g,n){const l=Math.pow(2,n.canonical.z),m=n.canonical.y;return[new s.ac(0,m/l).toLngLat().lat,new s.ac(0,(m+1)/l).toLngLat().lat]}function zu(g,n,l,m,x,b,T){const k=g.context,j=k.gl,L=l.hillshadeFBO;if(!L)return;g.prepareDrawTile();const z=g.isTileAffectedByFog(n),U=g.getOrCreateProgram("hillshade",{overrideFog:z});k.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,L.colorAttachment.get());const V=((ne,se,me,xe)=>{const ye=me.paint.get("hillshade-shadow-color"),Ee=me.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",be=me.paint.get("hillshade-highlight-color"),we=me.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",Te=me.paint.get("hillshade-accent-color"),Pe=me.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Ne=me.paint.get("hillshade-emissive-strength");let Ke=s.ak(me.paint.get("hillshade-illumination-direction"));if(me.paint.get("hillshade-illumination-anchor")==="viewport")Ke-=ne.transform.angle;else if(ne.style&&ne.style.enable3dLights()&&ne.style.directionalLight){const lt=ne.style.directionalLight.properties.get("direction"),dt=s.cc(lt.x,lt.y,lt.z);Ke=s.ak(dt[1])}const $e=!ne.options.moving;return{u_matrix:xe||ne.transform.calculateProjMatrix(se.tileID.toUnwrapped(),$e),u_image:0,u_latrange:_0(0,se.tileID),u_light:[me.paint.get("hillshade-exaggeration"),Ke],u_shadow:ye.toRenderColor(Ee?null:me.lut),u_highlight:be.toRenderColor(we?null:me.lut),u_emissive_strength:Ne,u_accent:Te.toRenderColor(Pe?null:me.lut)}})(g,l,m,g.terrain?n.projMatrix:null);g.uploadCommonUniforms(k,U,n.toUnwrapped());const{tileBoundsBuffer:Y,tileBoundsIndexBuffer:te,tileBoundsSegments:K}=g.getTileBoundsBuffers(l);U.draw(g,j.TRIANGLES,x,b,T,vr.disabled,V,m.id,Y,te,K)}function c_(g,n,l){if(!n.needsDEMTextureUpload)return;const m=g.context,x=m.gl;m.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||g.getTileTexture(l.stride);const b=l.getPixels();n.demTexture?n.demTexture.update(b,{premultiply:!1}):n.demTexture=new s.T(m,b,x.R32F,{premultiply:!1}),n.needsDEMTextureUpload=!1}function pS(g,n,l){const m=g.context,x=m.gl;if(!n.dem)return;const b=n.dem;if(m.activeTexture.set(x.TEXTURE1),c_(g,n,b),!n.demTexture)return;n.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE);const T=b.dim;m.activeTexture.set(x.TEXTURE0);let k=n.hillshadeFBO;if(!k){const V=new s.T(m,{width:T,height:T,data:null},x.RGBA8);V.bind(x.LINEAR,x.CLAMP_TO_EDGE),k=n.hillshadeFBO=m.createFramebuffer(T,T,!0,"renderbuffer"),k.colorAttachment.set(V.texture)}m.bindFramebuffer.set(k.framebuffer),m.viewport.set([0,0,T,T]);const{tileBoundsBuffer:j,tileBoundsIndexBuffer:L,tileBoundsSegments:z}=g.getMercatorTileBoundsBuffers(),U=[];g.linearFloatFilteringSupported()&&U.push("TERRAIN_DEM_FLOAT_FORMAT"),g.getOrCreateProgram("hillshadePrepare",{defines:U}).draw(g,x.TRIANGLES,ir.disabled,Mr.disabled,zr.unblended,vr.disabled,((V,Y)=>{const te=Y.stride,K=s.ad.mat4.create();return s.ad.mat4.ortho(K,0,s.ai,-s.ai,0,0,1),s.ad.mat4.translate(K,K,[0,-s.ai,0]),{u_matrix:K,u_image:1,u_dimension:[te,te],u_zoom:V.overscaledZ}})(n.tileID,b),l.id,j,L,z),n.needsHillshadePrepare=!1}class qn{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class mS extends qn{getDefault(){return s.al.transparent}set(n){const l=this.current;(n.r!==l.r||n.g!==l.g||n.b!==l.b||n.a!==l.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class u_ extends qn{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class d_ extends qn{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class h_ extends qn{getDefault(){return[!0,!0,!0,!0]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||n[2]!==l[2]||n[3]!==l[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class f_ extends qn{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class y0 extends qn{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class x0 extends qn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const l=this.current;(n.func!==l.func||n.ref!==l.ref||n.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class gS extends qn{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||n[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class zh extends qn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=n,this.dirty=!1}}class Fh extends qn{getDefault(){return[0,1]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class v0 extends qn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=n,this.dirty=!1}}class po extends qn{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class p_ extends qn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.BLEND):l.disable(l.BLEND),this.current=n,this.dirty=!1}}class Sp extends qn{getDefault(){const n=this.gl;return[n.ONE,n.ZERO,n.ONE,n.ZERO]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||n[2]!==l[2]||n[3]!==l[3]||this.dirty)&&(this.gl.blendFuncSeparate(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Tp extends qn{getDefault(){return s.al.transparent}set(n){const l=this.current;(n.r!==l.r||n.g!==l.g||n.b!==l.b||n.a!==l.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class m_ extends qn{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(n,n),this.current=n,this.dirty=!1)}}class g_ extends qn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=n,this.dirty=!1}}class __ extends qn{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class Ep extends qn{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}let y_=class extends qn{getDefault(){return null}set(g){(g!==this.current||this.dirty)&&(this.gl.useProgram(g),this.current=g,this.dirty=!1)}};class x_ extends qn{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class Cp extends qn{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||n[2]!==l[2]||n[3]!==l[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class b0 extends qn{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class w0 extends qn{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Fu extends qn{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class _S extends qn{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class yS extends qn{getDefault(){return null}set(n){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class xS extends qn{getDefault(){return null}set(n){this.gl&&(n!==this.current||this.dirty)&&(this.gl.bindVertexArray(n),this.current=n,this.dirty=!1)}}class vS extends qn{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class bS extends qn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class wS extends qn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class Bh extends qn{constructor(n,l){super(n),this.context=n,this.parent=l}getDefault(){return null}}class v_ extends Bh{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class b_ extends Bh{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,this.attachment(),l.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Bu extends Bh{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,this.attachment(),l.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class S0 extends b_{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const T0=(g,n,l)=>({u_matrix:g,u_image0:0,u_skirt_height:n,u_ground_shadow_factor:l}),w_=(g,n,l,m,x,b,T,k,j,L,z,U,V,Y,te,K)=>({u_proj_matrix:Float32Array.from(g),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(m),u_merc_matrix:l,u_zoom_transition:x,u_merc_center:b,u_image0:0,u_frustum_tl:T,u_frustum_tr:k,u_frustum_br:j,u_frustum_bl:L,u_globe_pos:z,u_globe_radius:U,u_viewport:V,u_grid_matrix:K?Float32Array.from(K):new Float32Array(9),u_skirt_height:Y,u_far_z_cutoff:te});function Mp(g,n){return g!=null&&n!=null&&!(!g.hasData()||!n.hasData())&&g.demTexture!=null&&n.demTexture!=null&&g.tileID.key!==n.tileID.key}const Oo=new class{constructor(){this.operations={}}newMorphing(g,n,l,m,x){if(g in this.operations){const b=this.operations[g];b.to.tileID.key!==l.tileID.key&&(b.queued=l)}else this.operations[g]={startTime:m,phase:0,duration:x,from:n,to:l,queued:null}}getMorphValuesForProxy(g){if(!(g in this.operations))return null;const n=this.operations[g];return{from:n.from,to:n.to,phase:n.phase}}update(g){for(const n in this.operations){const l=this.operations[n];for(l.phase=(g-l.startTime)/l.duration;l.phase>=1||!this._validOp(l);)if(!this._nextOp(l,g)){delete this.operations[n];break}}}_nextOp(g,n){return!!g.queued&&(g.from=g.to,g.to=g.queued,g.queued=null,g.phase=0,g.startTime=n,!0)}_validOp(g){return g.from.hasData()&&g.to.hasData()}},S_={0:null,1:"TERRAIN_VERTEX_MORPHING"};function ll(g,n,l){if(n===0)return 0;const m=n<1&&l===514?.25/n:1;return 6*Math.pow(1.5,22-g)*Math.max(n,1)*m}function T_(g,n){const l=1<<g.z;return!n&&(g.x===0||g.x===l-1)||g.y===0||g.y===l-1}const Vu=g=>({u_matrix:g});function Ap(g,n,l,m,x){if(x>0){const b=s.q.now(),T=(b-g.timeAdded)/x,k=n?(b-n.timeAdded)/x:-1,j=l.getSource(),L=m.coveringZoomLevel({tileSize:j.tileSize,roundZoom:j.roundZoom}),z=!n||Math.abs(n.tileID.overscaledZ-L)>Math.abs(g.tileID.overscaledZ-L),U=z&&g.refreshedUponExpiration?1:s.ay(z?T:1-k,0,1);return g.refreshedUponExpiration&&T>=1&&(g.refreshedUponExpiration=!1),n?{opacity:1,mix:1-U}:{opacity:U,mix:0}}return{opacity:1,mix:0}}class E0 extends Do{constructor(n){const l={type:"raster-dem",maxzoom:n.transform.maxZoom},m=new s.D(s.cj(),null),x=lp("mock-dem",l,m,n.style);super("mock-dem",x,!1),x.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,l){n.state="loaded",l(null)}}class E_ extends Do{constructor(n){const l=lp("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},new s.D(s.cj(),null),n.style);super("proxy",l,!1),l.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,l,m){if(n.freezeTileCoverage)return;this.transform=n;const x=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((b,T)=>{if(b[T.key]="",!this._tiles[T.key]){const k=new sa(T,this._source.tileSize*T.overscaleFactor(),n.tileZoom);k.state="loaded",this._tiles[T.key]=k}return b},{});for(const b in this._tiles)b in x||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(n){const l=this.proxyCachedFBO[n];if(l!==void 0){const m=Object.values(l);this.renderCachePool.push(...m),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Pp extends s.aH{constructor(n,l,m){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=l,this.projMatrix=m}}class C0 extends s.cK{constructor(n,l){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},n.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),n.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),n.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[m,x,b]=function(j){const L=new s.b5,z=new s.aV,U=131;L.reserve(17161),z.reserve(33800);const V=s.ai/128,Y=s.ai+V/2,te=Y+V;for(let ne=-V;ne<te;ne+=V)for(let se=-V;se<te;se+=V){const me=se<0||se>Y||ne<0||ne>Y?24575:0,xe=s.ay(Math.round(se),0,s.ai),ye=s.ay(Math.round(ne),0,s.ai);L.emplaceBack(xe+me,ye)}const K=(ne,se)=>{const me=se*U+ne;z.emplaceBack(me+1,me,me+U),z.emplaceBack(me+U,me+U+1,me+1)};for(let ne=1;ne<129;ne++)for(let se=1;se<129;se++)K(se,ne);return[0,129].forEach(ne=>{for(let se=0;se<130;se++)K(se,ne),K(ne,se)}),[L,z,32768]}(),T=n.context;this.gridBuffer=T.createVertexBuffer(m,s.b7.members),this.gridIndexBuffer=T.createIndexBuffer(x),this.gridSegments=s.b8.simpleSegment(0,0,m.length,x.length),this.gridNoSkirtSegments=s.b8.simpleSegment(0,0,m.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new E_(l.map),this.orthoMatrix=s.ad.mat4.create(),s.ad.mat4.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.ai,0,s.ai,0,1);const k=T.gl;this._overlapStencilMode=new Mr({func:k.GEQUAL,mask:255},0,255,k.KEEP,k.KEEP,k.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=l,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new E0(l.map),this._pendingGroundEffectLayers=[]}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),this._style=n,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(n,l,m){if(n&&n.terrain){this._style!==n&&(this.style=n,this._evaluationZoom=void 0);const x=n.terrain.properties,b=n.terrain.drapeRenderMode===0,T=n.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=s.q.now();const k=n.terrain&&n.terrain.scope,j=x.get("source"),L=b?this._mockSourceCache:n.getSourceCache(j,k);if(!L)return void s.w(`Couldn't find terrain source "${j}".`);if(this.sourceCache=L,this._attenuationRange=n.terrain.getAttenuationRange(),this._exaggeration=T?this.calculateExaggeration(l):x.get("exaggeration"),!l.projection.requiresDraping&&T&&this._exaggeration===0)return void this._disable();this.enabled=!0;const z=()=>{this.sourceCache.used&&s.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const U=this.getScaledDemTileSize();this.sourceCache.update(l,U,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,z(),this._initializing=!0),z(),l.updateElevation(!0,m),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(l),this._emptyDEMTextureDirty=!0,this._previousZoom=l.zoom}else this._disable()}calculateExaggeration(n){if(this._attenuationRange&&n.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(n.zoom);const l=this._previousCameraAltitude,m=n.getFreeCameraOptions().position.z/n.pixelsPerMeter*n.worldSize;this._previousCameraAltitude=m;const x=l!=null?m-l:Number.MAX_VALUE;if(Math.abs(x)<2)return this._exaggeration;const b=n.zoom,T=this._style.terrain;if(!this._previousUpdateTimestamp)return T.getExaggeration(b);let k=b-this._previousZoom;const j=this._previousUpdateTimestamp;let L=b;this._evaluationZoom!=null&&(L=this._evaluationZoom,Math.abs(b-L)>.5&&(k=.5*(b-L+k)),k*x<0&&(L+=k)),this._evaluationZoom=L;const z=T.getExaggeration(L),U=z===T.getExaggeration(Math.max(0,L-.1));if(U&&Math.abs(z-this._exaggeration)<.01)return z;let V=Math.min(.1,.00375*(this._updateTimestamp-j));return(U||z<.1||Math.abs(k)<1e-4)&&(V=Math.min(.2,4*V)),s.ah(this._exaggeration,z,V)}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(n){n.coord&&n.dataType==="source"?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):n.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._mergedSourceCaches)this._style._mergedSourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const l=this.proxySourceCache,m=this.painter.transform;this._initializing&&(this._initializing=m._centerAltitude===0&&this.getAtPointOrZero(s.ac.fromLngLat(m.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=l.getIds().map(j=>{const L=l.getTileByID(j).tileID;return L.projMatrix=m.calculateProjMatrix(L.toUnwrapped()),L});(function(j,L){const z=L.transform.pointCoordinate(L.transform.getCameraPoint()),U=new s.P(z.x,z.y);j.sort((V,Y)=>{if(Y.overscaledZ-V.overscaledZ)return Y.overscaledZ-V.overscaledZ;const te=new s.P(V.canonical.x+(1<<V.canonical.z)*V.wrap,V.canonical.y),K=new s.P(Y.canonical.x+(1<<Y.canonical.z)*Y.wrap,Y.canonical.y),ne=U.mult(1<<V.canonical.z);return ne.x-=.5,ne.y-=.5,ne.distSqr(te)-ne.distSqr(K)})})(x,this.painter);const b=this.proxyToSource||{};this.proxyToSource={},x.forEach(j=>{this.proxyToSource[j.key]={}}),this.terrainTileForTile={};const T=this._style._mergedSourceCaches;for(const j in T){const L=T[j];if(!L.used||(L!==this.sourceCache&&this.resetTileLookupCache(L.id),this._setupProxiedCoordsForOrtho(L,n[j],b),L.usedForTerrain))continue;const z=n[j];L.getSource().reparseOverscaled&&this._assignTerrainTiles(z)}this.proxiedCoords[l.id]=x.map(j=>new Pp(j,j.key,this.orthoMatrix)),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1;const k={};this._visibleDemTiles=[];for(const j of this.proxyCoords){const L=this.terrainTileForTile[j.key];if(!L)continue;const z=L.tileID.key;z in k||(this._visibleDemTiles.push(L),k[z]=z)}}_assignTerrainTiles(n){this._initializing||n.forEach(l=>{if(this.terrainTileForTile[l.key])return;const m=this._findTileCoveringTileID(l,this.sourceCache);m&&(this.terrainTileForTile[l.key]=m)})}_prepareDEMTextures(){const n=this.painter.context,l=n.gl;for(const m in this.terrainTileForTile){const x=this.terrainTileForTile[m],b=x.dem;!b||x.demTexture&&!x.needsDEMTextureUpload||(n.activeTexture.set(l.TEXTURE1),c_(this.painter,x,b))}}_prepareDemTileUniforms(n,l,m,x){if(!l||l.demTexture==null)return!1;const b=n.tileID.canonical,T=Math.pow(2,l.tileID.canonical.z-b.z),k=x||"";return m[`u_dem_tl${k}`]=[b.x*T%1,b.y*T%1],m[`u_dem_scale${k}`]=T,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let n=0;const l=this._visibleDemTiles.reduce((m,x)=>{if(!x.dem)return m;const b=x.dem.tree.minimums[0];return b>0&&n++,m+b},0);return n?l/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,l=n.gl;n.activeTexture.set(l.TEXTURE2);const m=this._getLoadedAreaMinimum(),x=new s.cL({width:1,height:1},new Float32Array([m]));this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(x,{premultiply:!1}):b=this._emptyDEMTexture=new s.T(n,x,l.R32F,{premultiply:!1}),b}setupElevationDraw(n,l,m){const x=this.painter.context,b=x.gl,T={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};T.u_exaggeration=this.exaggeration();let k=null,j=null,L=1;if(m&&m.morphing&&this._useVertexMorphing){const Y=m.morphing.srcDemTile,te=m.morphing.dstDemTile;L=m.morphing.phase,Y&&te&&(this._prepareDemTileUniforms(n,Y,T,"_prev")&&(j=Y),this._prepareDemTileUniforms(n,te,T)&&(k=te))}const z=Y=>Y&&Y.demTexture&&this.painter.linearFloatFilteringSupported()?b.LINEAR:b.NEAREST;let U=null;var V;if(this.enabled?j&&k?(U=k.demTexture,x.activeTexture.set(b.TEXTURE4),j.demTexture.bind(z(j),b.CLAMP_TO_EDGE),T.u_dem_lerp=L):(k=this.terrainTileForTile[n.tileID.key],U=this._prepareDemTileUniforms(n,k,T)?k.demTexture:this.emptyDEMTexture):U=this.emptyDEMTexture,x.activeTexture.set(b.TEXTURE2),U&&(T.u_dem_size=(V=U).size[0]===1?1:V.size[0]-2,U.bind(z(k),b.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(m&&m.useDepthForOcclusion,l,T),m&&m.useMeterToDem&&k){const Y=(1<<k.tileID.canonical.z)*s.bH(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;T.u_meter_to_dem=Y}if(m&&m.labelPlaneMatrixInv&&(T.u_label_plane_matrix_inv=m.labelPlaneMatrixInv),l.setTerrainUniformValues(x,T),this.painter.transform.projection.name==="globe"){const Y=this.globeUniformValues(this.painter.transform,n.tileID.canonical,m&&m.useDenormalizedUpVectorScale);l.setGlobeUniformValues(x,Y)}}globeUniformValues(n,l,m){const x=n.projection;return{u_tile_tl_up:x.upVector(l,0,0),u_tile_tr_up:x.upVector(l,s.ai,0),u_tile_br_up:x.upVector(l,s.ai,s.ai),u_tile_bl_up:x.upVector(l,0,s.ai),u_tile_up_scale:m?s.cM(1):x.upVectorScale(l,n.center.lat,n.worldSize).metersToTile}}renderToBackBuffer(n){const l=this.painter,m=this.painter.context;n.length!==0&&(m.bindFramebuffer.set(null),m.viewport.set([0,0,l.width,l.height]),l.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(x,b,T,k,j){if(x.transform.projection.name==="globe")(function(L,z,U,V,Y){const te=L.context,K=te.gl;let ne,se;const me=L.transform,xe=s.cD(L,te,me),ye=(lt,dt)=>{if(se===dt)return;const vt=[S_[dt],"PROJECTION_GLOBE_VIEW"];xe&&vt.push("CUSTOM_ANTIALIASING");const Ue=L.isTileAffectedByFog(lt);ne=L.getOrCreateProgram("globeRaster",{defines:vt,overrideFog:Ue}),se=dt},Ee=L.colorModeForRenderPass(),be=new ir(K.LEQUAL,ir.ReadWrite,L.depthRangeFor3D);Oo.update(Y);const we=s.cE(me),Te=[s.av(me.center.lng),s.aC(me.center.lat)],Pe=L.globeSharedBuffers,Ne=[me.width*s.q.devicePixelRatio,me.height*s.q.devicePixelRatio],Ke=Float32Array.from(me.globeMatrix),$e={useDenormalizedUpVectorScale:!0};{const lt=L.transform,dt=ll(lt.zoom,z.exaggeration(),z.sourceCache._source.tileSize);se=-1;const vt=K.TRIANGLES;for(const Ue of V){const at=U.getTile(Ue),Fe=Mr.disabled,ot=z.prevTerrainTileForTile[Ue.key],rt=z.terrainTileForTile[Ue.key];Mp(ot,rt)&&Oo.newMorphing(Ue.key,ot,rt,Y,250),te.activeTexture.set(K.TEXTURE0),at.texture&&at.texture.bind(K.LINEAR,K.CLAMP_TO_EDGE);const ht=Oo.getMorphValuesForProxy(Ue.key),Je=ht?1:0;ht&&s.L($e,{morphing:{srcDemTile:ht.from,dstDemTile:ht.to,phase:s.cC(ht.phase)}});const mt=s.cF(Ue.canonical),It=s.cG(mt.getCenter().lat),kt=s.cH(Ue.canonical,mt,It,lt.worldSize/lt._pixelsPerMercatorPixel),Rt=s.bc(s.cI(Ue.canonical)),Yt=w_(lt.expandedFarZProjMatrix,Ke,we,Rt,s.ag(lt.zoom),Te,lt.frustumCorners.TL,lt.frustumCorners.TR,lt.frustumCorners.BR,lt.frustumCorners.BL,lt.globeCenterInViewSpace,lt.globeRadius,Ne,dt,lt._farZ,kt);if(ye(Ue,Je),ne&&(z.setupElevationDraw(at,ne,$e),L.uploadCommonUniforms(te,ne,Ue.toUnwrapped()),Pe)){const[Tr,cr,yr]=Pe.getGridBuffers(It,dt!==0);ne.draw(L,vt,be,Fe,Ee,vr.backCCW,Yt,"globe_raster",Tr,cr,yr)}}}if(Pe&&(L.renderDefaultNorthPole||L.renderDefaultSouthPole)){const lt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];xe&&lt.push("CUSTOM_ANTIALIASING"),ne=L.getOrCreateProgram("globeRaster",{defines:lt});for(const dt of V){const{x:vt,y:Ue,z:at}=dt.canonical,Fe=Ue===0,ot=Ue===(1<<at)-1,[rt,ht,Je,mt]=Pe.getPoleBuffers(at,!1);if(mt&&(Fe||ot)){const It=U.getTile(dt);te.activeTexture.set(K.TEXTURE0),It.texture&&It.texture.bind(K.LINEAR,K.CLAMP_TO_EDGE);let kt=s.cJ(at,vt,me);const Rt=s.bc(s.cI(dt.canonical)),Yt=(Tr,cr)=>Tr.draw(L,K.TRIANGLES,be,Mr.disabled,Ee,vr.disabled,w_(me.expandedFarZProjMatrix,kt,kt,Rt,0,Te,me.frustumCorners.TL,me.frustumCorners.TR,me.frustumCorners.BR,me.frustumCorners.BL,me.globeCenterInViewSpace,me.globeRadius,Ne,0,me._farZ),"globe_pole_raster",cr,Je,mt);z.setupElevationDraw(It,ne,$e),L.uploadCommonUniforms(te,ne,dt.toUnwrapped()),Fe&&L.renderDefaultNorthPole&&Yt(ne,rt),ot&&L.renderDefaultSouthPole&&(kt=s.ad.mat4.scale(s.ad.mat4.create(),kt,[1,-1,1]),Yt(ne,ht))}}}})(x,b,T,k,j);else{const L=x.context,z=L.gl;let U,V;const Y=x.shadowRenderer,te=sl(x,x.longestCutoffRange),K=Ee=>{if(V===Ee)return;const be=[];be.push(S_[Ee]),te.shouldRenderCutoff&&be.push("RENDER_CUTOFF"),Y&&(be.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Y.useNormalOffset&&be.push("NORMAL_OFFSET")),U=x.getOrCreateProgram("terrainRaster",{defines:be}),V=Ee},ne=x.colorModeForRenderPass(),se=new ir(z.LEQUAL,ir.ReadWrite,x.depthRangeFor3D);Oo.update(j);const me=x.transform,xe=ll(me.zoom,b.exaggeration(),b.sourceCache._source.tileSize);let ye=[0,0,0];if(Y){const Ee=x.style.directionalLight,be=x.style.ambientLight;Ee&&be&&(ye=ju(x.style,Ee,be))}{V=-1;const Ee=z.TRIANGLES,[be,we]=[b.gridIndexBuffer,b.gridSegments];for(const Te of k){const Pe=T.getTile(Te),Ne=Mr.disabled,Ke=b.prevTerrainTileForTile[Te.key],$e=b.terrainTileForTile[Te.key];Mp(Ke,$e)&&Oo.newMorphing(Te.key,Ke,$e,j,250),L.activeTexture.set(z.TEXTURE0),Pe.texture&&Pe.texture.bind(z.LINEAR,z.CLAMP_TO_EDGE);const lt=Oo.getMorphValuesForProxy(Te.key),dt=lt?1:0;let vt;lt&&(vt={morphing:{srcDemTile:lt.from,dstDemTile:lt.to,phase:s.cC(lt.phase)}});const Ue=T0(Te.projMatrix,T_(Te.canonical,me.renderWorldCopies)?xe/10:xe,ye);if(K(dt),!U)continue;b.setupElevationDraw(Pe,U,vt);const at=Te.toUnwrapped();Y&&Y.setupShadows(at,U),x.uploadCommonUniforms(L,U,at,null,te),U.draw(x,Ee,se,Ne,ne,vr.backCCW,Ue,"terrain_raster",b.gridBuffer,be,we)}}}}(l,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,l.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(this._drapedRenderBatches.length===0)return n+1;this.renderingToTexture=!0;const l=this.painter,m=this.painter.context,x=this.proxySourceCache,b=this.proxiedCoords[x.id],T=this._drapedRenderBatches.shift(),k=l.style.order,j=[];let L=0;for(const z of b){const U=x.getTileByID(z.proxyTileKey),V=x.proxyCachedFBO[z.key]?x.proxyCachedFBO[z.key][n]:void 0,Y=V!==void 0?x.renderCache[V]:this.pool[L++],te=V!==void 0;if(U.texture=Y.tex,te&&!Y.dirty){j.push(U.tileID);continue}let K;m.bindFramebuffer.set(Y.fb.framebuffer),this.renderedToTile=!1,Y.dirty&&(m.clear({color:s.al.transparent,stencil:0}),Y.dirty=!1);for(let ne=T.start;ne<=T.end;++ne){const se=l.style._mergedLayers[k[ne]];if(se.isHidden(l.transform.zoom))continue;const me=l.style.getLayerSourceCache(se),xe=me?this.proxyToSource[z.key][me.id]:[z];if(!xe)continue;const ye=xe;m.viewport.set([0,0,Y.fb.width,Y.fb.height]),K!==(me?me.id:null)&&(this._setupStencil(Y,xe,se,me),K=me?me.id:null),l.renderLayer(l,me,se,ye)}if(this._drapedRenderBatches.length===0)for(const ne of this._pendingGroundEffectLayers){const se=l.style._mergedLayers[k[ne]];if(se.isHidden(l.transform.zoom))continue;const me=l.style.getLayerSourceCache(se),xe=me?this.proxyToSource[z.key][me.id]:[z];if(!xe)continue;const ye=xe;m.viewport.set([0,0,Y.fb.width,Y.fb.height]),K!==(me?me.id:null)&&(this._setupStencil(Y,xe,se,me),K=me?me.id:null),l.renderLayer(l,me,se,ye)}this.renderedToTile?(Y.dirty=!0,j.push(U.tileID)):te||--L,L===5&&(L=0,this.renderToBackBuffer(j))}return this.renderToBackBuffer(j),this.renderingToTexture=!1,m.bindFramebuffer.set(null),m.viewport.set([0,0,l.width,l.height]),T.end+1}postRender(){}isLayerOrderingCorrect(n){const l=n.order.length;let m=-1,x=l;for(let b=0;b<l;++b)this._style.isLayerDraped(n._mergedLayers[n.order[b]])?m=Math.max(m,b):x=Math.min(x,b);return x>m}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(l=>l.dem).forEach(l=>{n=Math.min(n,l.dem.tree.minimums[0])}),n===0?n:(n-30)*this._exaggeration}raycast(n,l,m){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter(b=>b.dem).map(b=>{const T=b.tileID,k=1<<T.overscaledZ,{x:j,y:L}=T.canonical,z=j/k,U=(j+1)/k,V=L/k,Y=(L+1)/k;return{minx:z,miny:V,maxx:U,maxy:Y,t:b.dem.tree.raycastRoot(z,V,U,Y,n,l,m),tile:b}});x.sort((b,T)=>(b.t!==null?b.t:Number.MAX_VALUE)-(T.t!==null?T.t:Number.MAX_VALUE));for(const b of x){if(b.t==null)return null;const T=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,n,l,m);if(T!=null)return T}return null}_createFBO(){const n=this.painter.context,l=n.gl,m=this.drapeBufferSize;n.activeTexture.set(l.TEXTURE0);const x=new s.T(n,{width:m[0],height:m[1],data:null},l.RGBA8);x.bind(l.LINEAR,l.CLAMP_TO_EDGE);const b=n.createFramebuffer(m[0],m[1],!0,null);return b.colorAttachment.set(x.texture),b.depthAttachment=new S0(n,b.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,m[0],m[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&l.texParameterf(l.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:b,tex:x,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const n in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const l=this._style._mergedLayers[n],m=l.isHidden(this.painter.transform.zoom);return l.type==="hillshade"||l.type==="custom"?!m&&l.shouldRedrape():!m&&l.hasTransition()})}_clearLineLayersFromRenderCache(){let n=!1;for(const m of this._style.getSources())if(m instanceof bu){n=!0;break}if(!n)return;const l={};for(let m=0;m<this._style.order.length;++m){const x=this._style._mergedLayers[this._style.order[m]],b=this._style.getLayerSourceCache(x);if(b&&!l[b.id]&&!x.isHidden(this.painter.transform.zoom)&&x.type==="line"&&x.widthExpression()instanceof s.ab){l[b.id]=!0;for(const T of this.proxyCoords){const k=this.proxyToSource[T.key][b.id];if(k)for(const j of k)this._clearRenderCacheForTile(b.id,j)}}}}_clearRasterLayersFromRenderCache(){let n=!1;for(const m in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[m]._source instanceof jo){n=!0;break}if(!n)return;const l={};for(let m=0;m<this._style.order.length;++m){const x=this._style._mergedLayers[this._style.order[m]],b=this._style.getLayerSourceCache(x);if(!b||l[b.id]||x.isHidden(this.painter.transform.zoom)||x.type!=="raster")continue;const T=x.paint.get("raster-fade-duration");for(const k of this.proxyCoords){const j=this.proxyToSource[k.key][b.id];if(j)for(const L of j){const z=Ap(b.getTile(L),b.findLoadedParent(L,0),b,this.painter.transform,T);(z.opacity!==1||z.mix!==0)&&this._clearRenderCacheForTile(b.id,L)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const n=this._style.order,l=n.length;if(l===0)return;const m=[];this._pendingGroundEffectLayers=[];let x,b=0,T=this._style._mergedLayers[n[b]];for(;!this._style.isLayerDraped(T)&&T.isHidden(this.painter.transform.zoom)&&++b<l;)T=this._style._mergedLayers[n[b]];for(;b<l;++b){const k=this._style._mergedLayers[n[b]];k.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(k)?x===void 0&&(x=b):(k.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(b),x!==void 0&&(m.push({start:x,end:b-1}),x=void 0)))}if(x!==void 0&&m.push({start:x,end:b-1}),m.length!==0){const k=m[m.length-1];this._pendingGroundEffectLayers.every(j=>j>k.end)||s.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=m}_setupRenderCache(n){const l=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,l.renderCache.length>l.renderCachePool.length){const T=Object.values(l.proxyCachedFBO);l.proxyCachedFBO={};for(let k=0;k<T.length;++k){const j=Object.values(T[k]);l.renderCachePool.push(...j)}}return}this._clearRasterLayersFromRenderCache();const m=this.proxyCoords,x=this._tilesDirty;for(let T=m.length-1;T>=0;T--){const k=m[T];if(l.getTileByID(k.key),l.proxyCachedFBO[k.key]!==void 0){const j=n[k.key],L=this.proxyToSource[k.key];let z=0;for(const U in L){const V=L[U],Y=j[U];if(!Y||Y.length!==V.length||V.some((te,K)=>te!==Y[K]||x[U]&&x[U].hasOwnProperty(te.key))){z=-1;break}++z}for(const U in l.proxyCachedFBO[k.key])l.renderCache[l.proxyCachedFBO[k.key][U]].dirty=z<0||z!==Object.values(j).length}}const b=[...this._drapedRenderBatches];b.sort((T,k)=>k.end-k.start-(T.end-T.start));for(const T of b)for(const k of m){if(l.proxyCachedFBO[k.key])continue;let j=l.renderCachePool.pop();j===void 0&&l.renderCache.length<50&&(j=l.renderCache.length,l.renderCache.push(this._createFBO())),j!==void 0&&(l.proxyCachedFBO[k.key]={},l.proxyCachedFBO[k.key][T.start]=j,l.renderCache[j].dirty=!0)}this._tilesDirty={}}_setupStencil(n,l,m,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,T=b.gl;if(l.length<=1)return void(this._overlapStencilType=!1);let k;if(m.isTileClipped())k=l.length,this._overlapStencilMode.test={func:T.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(l[0].overscaledZ>l[l.length-1].overscaledZ))return void(this._overlapStencilType=!1);k=1,this._overlapStencilMode.test={func:T.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+k>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=k,this._overlapStencilMode.ref=this._stencilRef,m.isTileClipped()&&this._renderTileClippingMasks(l,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):Mr.disabled}_renderTileClippingMasks(n,l){const m=this.painter,x=this.painter.context,b=x.gl;m._tileClippingMaskIDs={},x.setColorMode(zr.disabled),x.setDepthMode(ir.disabled);const T=m.getOrCreateProgram("clippingMask");for(const k of n){const j=m._tileClippingMaskIDs[k.key]=--l;T.draw(m,b.TRIANGLES,ir.disabled,new Mr({func:b.ALWAYS,mask:0},j,255,b.KEEP,b.KEEP,b.REPLACE),zr.disabled,vr.disabled,Vu(k.projMatrix),"$clipping",m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}}pointCoordinate(n){const l=this.painter.transform;if(n.x<0||n.x>l.width||n.y<0||n.y>l.height)return null;const m=[n.x,n.y,1,1];s.ad.vec4.transformMat4(m,m,l.pixelMatrixInverse),s.ad.vec4.scale(m,m,1/m[3]),m[0]/=l.worldSize,m[1]/=l.worldSize;const x=l._camera.position,b=s.bH(1,l.center.lat),T=[x[0],x[1],x[2]/b,0],k=s.ad.vec3.subtract([],m.slice(0,3),T);s.ad.vec3.normalize(k,k);const j=this.raycast(T,k,this._exaggeration);return j!==null&&j?(s.ad.vec3.scaleAndAdd(T,T,k,j),T[3]=T[2],T[2]*=b,T):null}_setupProxiedCoordsForOrtho(n,l,m){if(n.getSource()instanceof s.aK)return this._setupProxiedCoordsForImageSource(n,l,m);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const x=this.proxiedCoords[n.id]=[],b=this.proxyCoords;for(let j=0;j<b.length;j++){const L=b[j],z=this._findTileCoveringTileID(L,n);if(z){const U=this._createProxiedId(L,z,m[L.key]&&m[L.key][n.id]);x.push(U),this.proxyToSource[L.key][n.id]=[U]}}let T=!1;const k=new Set;for(let j=0;j<l.length;j++){const L=n.getTile(l[j]);if(!L||!L.hasData())continue;const z=this._findTileCoveringTileID(L.tileID,this.proxySourceCache);if(z&&z.tileID.canonical.z!==L.tileID.canonical.z){const U=this.proxyToSource[z.tileID.key][n.id],V=this._createProxiedId(z.tileID,L,m[z.tileID.key]&&m[z.tileID.key][n.id]);U?U.splice(U.length-1,0,V):this.proxyToSource[z.tileID.key][n.id]=[V];const Y=this.proxyToSource[z.tileID.key][n.id];k.has(Y)||k.add(Y),x.push(V),T=!0}}if(this._sourceTilesOverlap[n.id]=T,T&&this._debugParams.sortTilesHiZFirst)for(const j of k)j.sort((L,z)=>z.overscaledZ-L.overscaledZ)}_setupProxiedCoordsForImageSource(n,l,m){if(!n.getSource().loaded())return;const x=this.proxiedCoords[n.id]=[],b=this.proxyCoords,T=n.getSource(),k=T.tileID;if(!k)return;const j=new s.P(k.x,k.y)._div(1<<k.z),L=T.coordinates.map(s.ac.fromLngLat).reduce((U,V)=>(U.min.x=Math.min(U.min.x,V.x-j.x),U.min.y=Math.min(U.min.y,V.y-j.y),U.max.x=Math.max(U.max.x,V.x-j.x),U.max.y=Math.max(U.max.y,V.y-j.y),U),{min:new s.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),z=(U,V)=>{const Y=U.wrap+U.canonical.x/(1<<U.canonical.z),te=U.canonical.y/(1<<U.canonical.z),K=s.ai/(1<<U.canonical.z),ne=V.wrap+V.canonical.x/(1<<V.canonical.z),se=V.canonical.y/(1<<V.canonical.z);return Y+K<ne+L.min.x||Y>ne+L.max.x||te+K<se+L.min.y||te>se+L.max.y};for(let U=0;U<b.length;U++){const V=b[U];for(let Y=0;Y<l.length;Y++){const te=n.getTile(l[Y]);if(!te||!te.hasData()||z(V,te.tileID))continue;const K=this._createProxiedId(V,te,m[V.key]&&m[V.key][n.id]),ne=this.proxyToSource[V.key][n.id];ne?ne.push(K):this.proxyToSource[V.key][n.id]=[K],x.push(K)}}}_createProxiedId(n,l,m){let x=this.orthoMatrix;if(m){const b=m.find(T=>T.key===l.tileID.key);if(b)return b}if(l.tileID.key!==n.key){const b=n.canonical.z-l.tileID.canonical.z;let T,k,j;x=s.ad.mat4.create();const L=l.tileID.wrap-n.wrap<<n.overscaledZ;b>0?(T=s.ai>>b,k=T*((l.tileID.canonical.x<<b)-n.canonical.x+L),j=T*((l.tileID.canonical.y<<b)-n.canonical.y)):(T=s.ai<<-b,k=s.ai*(l.tileID.canonical.x-(n.canonical.x+L<<-b)),j=s.ai*(l.tileID.canonical.y-(n.canonical.y<<-b))),s.ad.mat4.ortho(x,0,T,0,T,0,1),s.ad.mat4.translate(x,x,[k,j,0])}return new Pp(l.tileID,n.key,x)}_findTileCoveringTileID(n,l){let m=l.getTile(n);if(m&&m.hasData())return m;const x=this._findCoveringTileCache[l.id],b=x[n.key];if(m=b?l.getTileByID(b):null,m&&m.hasData()||b===null)return m;let T=m?m.tileID:n,k=T.overscaledZ;const j=l.getSource().minzoom,L=[];if(!b){const U=l.getSource().maxzoom;if(n.canonical.z>=U){const V=n.canonical.z-U;l.getSource().reparseOverscaled?(k=Math.max(n.canonical.z+2,l.transform.tileZoom),T=new s.aH(k,n.wrap,U,n.canonical.x>>V,n.canonical.y>>V)):V!==0&&(k=U,T=new s.aH(k,n.wrap,U,n.canonical.x>>V,n.canonical.y>>V))}T.key!==n.key&&(L.push(T.key),m=l.getTile(T))}const z=U=>{L.forEach(V=>{x[V]=U}),L.length=0};for(k-=1;k>=j&&(!m||!m.hasData());k--){m&&z(m.tileID.key);const U=T.calculateScaledKey(k);if(m=l.getTileByID(U),m&&m.hasData())break;const V=x[U];if(V===null)break;V===void 0?L.push(U):m=l.getTileByID(V)}return z(m?m.tileID.key:null),m&&m.hasData()?m:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,l){let m=this._tilesDirty[n];m||(m=this._tilesDirty[n]={}),m[l.key]=!0}}function M0(g,n,l){const m=function(k,j,L){const z=s.ad.vec3.dot(j,k),U=s.ad.vec3.dot(L,[.2126,.7152,.0722]),V=(te,K,ne)=>(1-ne)*te+ne*K,Y=V(1-.3*Math.min(U,1),1,Math.min(z+1,1));return V(.92,1,Math.asin(s.ay(j[2],-1,1))/Math.PI+.5)*Y}(g,[0,0,1],n),x=[0,0,0];s.ad.vec3.scale(x,l.slice(0,3),m);const b=[0,0,0];s.ad.vec3.scale(b,n.slice(0,3),g[2]);const T=[0,0,0];return s.ad.vec3.add(T,x,b),s.cg(T)}const Vh=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],SS=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class A0{static cacheKey(n,l,m,x){let b=`${l}${x?x.cacheKey:""}`;for(const T of m)n.usedDefines.includes(T)&&(b+=`/${T}`);return b}constructor(n,l,m,x,b,T){const k=n.gl;this.program=k.createProgram(),this.configuration=x,this.name=l,this.fixedDefines=[...T];const j=x?x.getBinderAttributes():[],L=(m.staticAttributes||[]).concat(j);let z=x?x.defines():[];z=z.concat(T.map(ne=>`#define ${ne}`));const U=`#version 300 es
`;let V=U+z.concat("precision mediump float;",wp,l_.fragmentSource).join(`
`);for(const ne of m.fragmentIncludes)V+=`
${zc[ne]}`;V+=`
${m.fragmentSource}`;let Y=U+z.concat("precision highp float;",wp,l_.vertexSource).join(`
`);for(const ne of m.vertexIncludes)Y+=`
${zc[ne]}`;this.forceManualRenderingForInstanceIDShaders=n.forceManualRenderingForInstanceIDShaders&&m.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(Y+=`
uniform int u_instanceID;
`),Y+=`
${m.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(Y=Y.replaceAll("gl_InstanceID","u_instanceID"));const te=k.createShader(k.FRAGMENT_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);k.shaderSource(te,V),k.compileShader(te),k.attachShader(this.program,te);const K=k.createShader(k.VERTEX_SHADER);if(k.isContextLost())this.failedToCreate=!0;else{k.shaderSource(K,Y),k.compileShader(K),k.attachShader(this.program,K),this.attributes={},this.numAttributes=L.length;for(let ne=0;ne<this.numAttributes;ne++)if(L[ne]){const se=L[ne].startsWith("a_")?L[ne]:`a_${L[ne]}`;k.bindAttribLocation(this.program,ne,se),this.attributes[se]=ne}k.linkProgram(this.program),k.deleteShader(K),k.deleteShader(te),this.fixedUniforms=b(n),this.binderUniforms=x?x.getUniforms(n):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(ne=>({u_instanceID:new s.bN(ne)}))(n)),(T.includes("TERRAIN")||l.indexOf("symbol")!==-1||l.indexOf("circle")!==-1)&&(this.terrainUniforms=(ne=>({u_dem:new s.bN(ne),u_dem_prev:new s.bN(ne),u_dem_tl:new s.bK(ne),u_dem_scale:new s.bM(ne),u_dem_tl_prev:new s.bK(ne),u_dem_scale_prev:new s.bM(ne),u_dem_size:new s.bM(ne),u_dem_lerp:new s.bM(ne),u_exaggeration:new s.bM(ne),u_depth:new s.bN(ne),u_depth_size_inv:new s.bK(ne),u_depth_range_unpack:new s.bK(ne),u_occluder_half_size:new s.bM(ne),u_occlusion_depth_offset:new s.bM(ne),u_meter_to_dem:new s.bM(ne),u_label_plane_matrix_inv:new s.bJ(ne)}))(n)),T.includes("GLOBE")&&(this.globeUniforms=(ne=>({u_tile_tl_up:new s.bL(ne),u_tile_tr_up:new s.bL(ne),u_tile_br_up:new s.bL(ne),u_tile_bl_up:new s.bL(ne),u_tile_up_scale:new s.bM(ne)}))(n)),T.includes("FOG")&&(this.fogUniforms=(ne=>({u_fog_matrix:new s.bJ(ne),u_fog_range:new s.bK(ne),u_fog_color:new s.cb(ne),u_fog_horizon_blend:new s.bM(ne),u_fog_vertical_limit:new s.bK(ne),u_fog_temporal_offset:new s.bM(ne),u_frustum_tl:new s.bL(ne),u_frustum_tr:new s.bL(ne),u_frustum_br:new s.bL(ne),u_frustum_bl:new s.bL(ne),u_globe_pos:new s.bL(ne),u_globe_radius:new s.bM(ne),u_globe_transition:new s.bM(ne),u_is_globe:new s.bN(ne),u_viewport:new s.bK(ne)}))(n)),T.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(ne=>({u_cutoff_params:new s.cb(ne)}))(n)),T.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(ne=>({u_lighting_ambient_color:new s.bL(ne),u_lighting_directional_dir:new s.bL(ne),u_lighting_directional_color:new s.bL(ne),u_ground_radiance:new s.bL(ne)}))(n)),T.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(ne=>({u_light_matrix_0:new s.bJ(ne),u_light_matrix_1:new s.bJ(ne),u_fade_range:new s.bK(ne),u_shadow_normal_offset:new s.bL(ne),u_shadow_intensity:new s.bM(ne),u_shadow_texel_size:new s.bM(ne),u_shadow_map_resolution:new s.bM(ne),u_shadow_direction:new s.bL(ne),u_shadow_bias:new s.bL(ne),u_shadowmap_0:new s.bN(ne),u_shadowmap_1:new s.bN(ne)}))(n))}}setTerrainUniformValues(n,l){if(!this.terrainUniforms)return;const m=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const x in l)m[x]&&m[x].set(this.program,x,l[x])}}setGlobeUniformValues(n,l){if(!this.globeUniforms)return;const m=this.globeUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const x in l)m[x]&&m[x].set(this.program,x,l[x])}}setFogUniformValues(n,l){if(!this.fogUniforms)return;const m=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const x in l)m[x].set(this.program,x,l[x])}}setCutoffUniformValues(n,l){if(!this.cutoffUniforms)return;const m=this.cutoffUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const x in l)m[x].set(this.program,x,l[x])}}setLightsUniformValues(n,l){if(!this.lightsUniforms)return;const m=this.lightsUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const x in l)m[x].set(this.program,x,l[x])}}setShadowUniformValues(n,l){if(this.failedToCreate||!this.shadowUniforms)return;const m=this.shadowUniforms;n.program.set(this.program);for(const x in l)m[x].set(this.program,x,l[x])}_drawDebugWireframe(n,l,m,x,b,T,k,j,L,z){const U=n.options.wireframe;if(U.terrain===!1&&U.layers2D===!1&&U.layers3D===!1)return;const V=n.context;if(!(!(!U.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!U.layers2D||n._terrain&&n._terrain.renderingToTexture||!Vh.includes(this.name))||!(!U.layers3D||!SS.includes(this.name))))return;const Y=V.gl,te=n.wireframeDebugCache.getLinesFromTrianglesBuffer(n.frameCounter,b,V);if(!te)return;const K=[...this.fixedDefines];K.push("DEBUG_WIREFRAME");const ne=n.getOrCreateProgram(this.name,{config:this.configuration,defines:K});V.program.set(ne.program);const se=(ye,Ee,be)=>{if(Ee[ye]&&be[ye])for(const we in Ee[ye])be[ye][we]&&be[ye][we].set(be.program,we,Ee[ye][we].current)};L&&L.setUniforms(ne.program,V,ne.binderUniforms,k,{zoom:j}),se("fixedUniforms",this,ne),se("terrainUniforms",this,ne),se("globeUniforms",this,ne),se("fogUniforms",this,ne),se("lightsUniforms",this,ne),se("shadowUniforms",this,ne),te.bind(),V.setColorMode(new zr([Y.ONE,Y.ONE_MINUS_SRC_ALPHA,Y.ZERO,Y.ONE],s.al.transparent,[!0,!0,!0,!1])),V.setDepthMode(new ir(l.func===Y.LESS?Y.LEQUAL:l.func,ir.ReadOnly,l.range)),V.setStencilMode(Mr.disabled);const me=3*T.primitiveLength*2,xe=3*T.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const ye=z||1;for(let Ee=0;Ee<ye;++Ee)ne.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ee),Y.drawElements(Y.LINES,me,Y.UNSIGNED_SHORT,xe)}else z&&z>1?Y.drawElementsInstanced(Y.LINES,me,Y.UNSIGNED_SHORT,xe,z):Y.drawElements(Y.LINES,me,Y.UNSIGNED_SHORT,xe);b.bind(),V.program.set(this.program),V.setDepthMode(l),V.setStencilMode(m),V.setColorMode(x)}checkUniforms(n,l,m){if(this.fixedDefines.includes(l)){for(const x of Object.keys(m))if(!m[x].initialized)throw new Error(`Program '${this.name}', from draw '${n}': uniform ${x} not set but required by ${l} being defined`)}}draw(n,l,m,x,b,T,k,j,L,z,U,V,Y,te,K,ne){const se=n.context,me=se.gl;if(this.failedToCreate)return;se.program.set(this.program),se.setDepthMode(m),se.setStencilMode(x),se.setColorMode(b),se.setCullFace(T);for(const Ee of Object.keys(this.fixedUniforms))this.fixedUniforms[Ee].set(this.program,Ee,k[Ee]);te&&te.setUniforms(this.program,se,this.binderUniforms,V,{zoom:Y});const xe={[me.POINTS]:1,[me.LINES]:2,[me.TRIANGLES]:3,[me.LINE_STRIP]:1}[l];this.checkUniforms(j,"RENDER_SHADOWS",this.shadowUniforms);const ye=ne&&ne>0?1:void 0;for(const Ee of U.get()){const be=Ee.vaos||(Ee.vaos={});if((be[j]||(be[j]=new g0)).bind(se,this,L,te?te.getPaintVertexBuffers():[],z,Ee.vertexOffset,K||[],ye),this.forceManualRenderingForInstanceIDShaders){const we=ne||1;for(let Te=0;Te<we;++Te)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Te),z?me.drawElements(l,Ee.primitiveLength*xe,me.UNSIGNED_SHORT,Ee.primitiveOffset*xe*2):me.drawArrays(l,Ee.vertexOffset,Ee.vertexLength)}else ne&&ne>1?me.drawElementsInstanced(l,Ee.primitiveLength*xe,me.UNSIGNED_SHORT,Ee.primitiveOffset*xe*2,ne):z?me.drawElements(l,Ee.primitiveLength*xe,me.UNSIGNED_SHORT,Ee.primitiveOffset*xe*2):me.drawArrays(l,Ee.vertexOffset,Ee.vertexLength);l===me.TRIANGLES&&z&&this._drawDebugWireframe(n,m,x,b,z,Ee,V,Y,te,ne)}}}function C_(g,n){const l=Math.pow(2,n.tileID.overscaledZ),m=n.tileSize*Math.pow(2,g.transform.tileZoom)/l,x=m*(n.tileID.canonical.x+n.tileID.wrap*l),b=m*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/s.at(n,1,g.transform.tileZoom),u_pixel_coord_upper:[x>>16,b>>16],u_pixel_coord_lower:[65535&x,65535&b]}}const Ip={terrain:0,flat:1},M_=s.ad.mat4.create(),kp=(g,n,l,m,x,b,T,k,j,L,z,U,V,Y,te,K,ne,se)=>{const me=n.style.light,xe=me.properties.get("position"),ye=[xe.x,xe.y,xe.z],Ee=s.ad.mat3.create();me.properties.get("anchor")==="viewport"&&(s.ad.mat3.fromRotation(Ee,-n.transform.angle),s.ad.vec3.transformMat3(ye,ye,Ee));const be=me.properties.get("color"),we=n.transform,Te={u_matrix:g,u_lightpos:ye,u_lightintensity:me.properties.get("intensity"),u_lightcolor:[be.r,be.g,be.b],u_vertical_gradient:+l,u_opacity:m,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:M_,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Ip[L],u_base_type:Ip[z],u_ao:x,u_edge_radius:b,u_width_scale:T,u_flood_light_color:te,u_vertical_scale:K,u_flood_light_intensity:ne,u_ground_shadow_factor:se};return we.projection.name==="globe"&&(Te.u_tile_id=[k.canonical.x,k.canonical.y,1<<k.canonical.z],Te.u_zoom_transition=U,Te.u_inv_rot_matrix=Y,Te.u_merc_center=V,Te.u_up_dir=we.projection.upVector(new s.bT(0,0,0),V[0]*s.ai,V[1]*s.ai),Te.u_height_lift=j),Te},Uu=(g,n,l,m,x,b)=>({u_matrix:g,u_edge_radius:n,u_width_scale:l,u_vertical_scale:m,u_height_type:Ip[x],u_base_type:Ip[b]}),A_=(g,n,l,m,x,b,T,k,j,L,z,U,V,Y,te,K,ne)=>{const se=kp(g,n,l,m,x,b,T,k,L,z,U,V,Y,te,K,ne,1,[0,0,0]),me={u_height_factor:-Math.pow(2,k.overscaledZ)/j.tileSize/8};return s.l(se,C_(n,j),me)},$u=(g,n)=>({u_matrix:g,u_emissive_strength:n}),P_=(g,n,l,m)=>s.l($u(g,n),C_(l,m)),Np=(g,n,l)=>({u_matrix:g,u_world:l,u_emissive_strength:n}),Rp=(g,n,l,m,x)=>s.l(P_(g,n,l,m),{u_world:x}),Uh=(g,n,l,m,x)=>({u_matrix:g,u_camera_pos:[n[0],n[1],n[2]],u_depth_bias:l,u_height_scale:m,u_reset_depth:x}),P0=(g,n,l,m)=>{const x=s.ai/l.tileSize;return{u_matrix:g,u_camera_to_center_distance:n.getCameraToCenterDistance(m),u_extrude_scale:[n.pixelsToGLUnits[0]/x,n.pixelsToGLUnits[1]/x]}},I0=(g,n,l=1)=>({u_matrix:g,u_color:n.toRenderColor(null),u_overlay:0,u_overlay_scale:l}),Gu=s.ad.mat4.create(),jp=(g,n,l,m,x,b,T)=>{const k=g.transform,j=k.projection.name==="globe",L=j?s.cO(k.zoom,n.canonical)*k._pixelsPerMercatorPixel:s.at(l,1,b),z={u_matrix:n.projMatrix,u_extrude_scale:L,u_intensity:T,u_inv_rot_matrix:Gu,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(j){z.u_inv_rot_matrix=m,z.u_merc_center=x,z.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],z.u_zoom_transition=s.ag(k.zoom);const U=x[0]*s.ai,V=x[1]*s.ai;z.u_up_dir=k.projection.upVector(new s.bT(0,0,0),U,V)}return z};function zt(g,[n,l,m,x],[b,T]){if(b===T)return[0,0,0,0];const k=255*(g-1)/(g*(T-b));return[n*k,l*k,m*k,x*k]}function I_(g,n,[l,m]){return l===m?0:.5/g+(n-l)*(g-1)/(g*(m-l))}const k_=(g,n,l,m,x,b,T,k,j,L,z,U,V,Y,te,K,ne,se,me,xe,ye)=>({u_matrix:g,u_normalize_matrix:n,u_globe_matrix:l,u_merc_matrix:m,u_grid_matrix:x,u_tl_parent:b,u_scale_parent:L,u_fade_t:z.mix,u_opacity:z.opacity*U.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:U.paint.get("raster-brightness-min"),u_brightness_high:U.paint.get("raster-brightness-max"),u_saturation_factor:s.cP(U.paint.get("raster-saturation")),u_contrast_factor:s.cQ(U.paint.get("raster-contrast")),u_spin_weights:Jl(U.paint.get("raster-hue-rotate")),u_perspective_transform:V,u_raster_elevation:Y,u_zoom_transition:T,u_merc_center:k,u_cutoff_params:j,u_colorization_mix:zt(s.cR,K,se),u_colorization_offset:I_(s.cR,ne,se),u_color_ramp:te,u_texture_offset:[xe/(me+2*xe),me/(me+2*xe)],u_texture_res:[me+2*xe,me+2*xe],u_emissive_strength:ye});function Jl(g){g*=Math.PI/180;const n=Math.sin(g),l=Math.cos(g);return[(2*l+1)/3,(-Math.sqrt(3)*n-l+1)/3,(Math.sqrt(3)*n-l+1)/3]}const mo=.05,ar=(g,n,l,m,x,b,T,k,j,L,z,U)=>({u_matrix:g,u_normalize_matrix:n,u_globe_matrix:l,u_merc_matrix:m,u_grid_matrix:x,u_tl_parent:b,u_scale_parent:L,u_fade_t:z.mix,u_opacity:z.opacity,u_image0:0,u_image1:1,u_raster_elevation:U,u_zoom_transition:T,u_merc_center:k,u_cutoff_params:j}),N_=(g,n,l,m,x,b,T,k,j,L)=>({u_particle_texture:g,u_particle_texture_side_len:n,u_tile_offset:l,u_velocity:m,u_color_ramp:b,u_velocity_res:x,u_max_speed:T,u_uv_offset:k,u_data_scale:[255*j[0],255*j[1]],u_data_offset:L,u_particle_pos_scale:1.1,u_particle_pos_offset:[mo,mo]}),TS=(g,n,l,m,x,b,T,k,j,L)=>({u_particle_texture:g,u_particle_texture_side_len:n,u_velocity:l,u_velocity_res:m,u_max_speed:x,u_speed_factor:b,u_reset_rate:T,u_rand_seed:Math.random(),u_uv_offset:k,u_data_scale:[255*j[0],255*j[1]],u_data_offset:L,u_particle_pos_scale:1.1,u_particle_pos_offset:[mo,mo]}),k0=s.ad.mat4.create(),Dp=(g,n,l,m,x,b,T,k,j,L,z,U,V,Y,te,K,ne,se,me,xe,ye,Ee)=>{const be=x.transform,we={u_is_size_zoom_constant:+(g==="constant"||g==="source"),u_is_size_feature_constant:+(g==="constant"||g==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:be.getCameraToCenterDistance(me),u_rotate_symbol:+l,u_aspect_ratio:be.width/be.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:T,u_coord_matrix:k,u_is_text:+L,u_elevation_from_sea:j?1:0,u_pitch_with_map:+m,u_texsize:z,u_texsize_icon:U,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:k0,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:k0,u_up_vector:[0,-1,0],u_color_adj_mat:xe,u_icon_transition:ye||0,u_gamma_scale:m?x.transform.getCameraToCenterDistance(me)*Math.cos(x.terrain?0:x.transform._pitch):1,u_device_pixel_ratio:s.q.devicePixelRatio,u_is_halo:+V,u_scale_factor:Ee||1};return me.name==="globe"&&(we.u_tile_id=[Y.canonical.x,Y.canonical.y,1<<Y.canonical.z],we.u_zoom_transition=te,we.u_inv_rot_matrix=ne,we.u_merc_center=K,we.u_camera_forward=be._camera.forward(),we.u_ecef_origin=s.cS(be.globeMatrix,Y.toUnwrapped()),we.u_tile_matrix=Float32Array.from(be.globeMatrix),we.u_up_vector=se),we},R_=(g,n,l,m)=>({u_matrix:g,u_emissive_strength:n,u_opacity:l,u_color:m}),N0=(g,n,l,m,x,b,T,k,j)=>s.l(function(L,z,U,V,Y,te){const{width:K,height:ne}=V.imageManager.getPixelSize(z),se=Math.pow(2,te.tileID.overscaledZ),me=te.tileSize*Math.pow(2,V.transform.tileZoom)/se,xe=me*(te.tileID.canonical.x+te.tileID.wrap*se),ye=me*te.tileID.canonical.y;return{u_image:0,u_pattern_tl:U.tl,u_pattern_br:U.br,u_texsize:[K,ne],u_pattern_size:U.displaySize,u_pattern_units_to_pixels:Y?[V.transform.width,-1*V.transform.height]:[1/s.at(te,1,V.transform.tileZoom),1/s.at(te,1,V.transform.tileZoom)],u_pixel_coord_upper:[xe>>16,ye>>16],u_pixel_coord_lower:[65535&xe,65535&ye]}}(0,b,T,m,k,j),{u_matrix:g,u_emissive_strength:n,u_opacity:l}),Lp=new Float32Array(s.ad.mat4.identity([])),j_=(g,n,l,m,x,b,T,k,j,L,z,U,V,Y=[0,0,0],te)=>{const K=x.style.light,ne=K.properties.get("position"),se=[-ne.x,-ne.y,ne.z],me=s.ad.mat3.create();K.properties.get("anchor")==="viewport"&&(s.ad.mat3.fromRotation(me,-x.transform.angle),s.ad.vec3.transformMat3(se,se,me));const xe=z.alphaMode==="MASK",ye=K.properties.get("color").toRenderColor(null),Ee=V.paint.get("model-ambient-occlusion-intensity"),be=V.paint.get("model-color").constantOr(s.al.white).toRenderColor(null),we=V.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:g,u_lighting_matrix:n,u_normal_matrix:l,u_node_matrix:m||Lp,u_lightpos:se,u_lightintensity:K.properties.get("intensity"),u_lightcolor:[ye.r,ye.g,ye.b],u_camera_pos:Y,u_opacity:b,u_baseTextureIsAlpha:0,u_alphaMask:+xe,u_alphaCutoff:z.alphaCutoff,u_baseColorFactor:[T.r,T.g,T.b,T.a],u_emissiveFactor:[k[0],k[1],k[2],1],u_metallicFactor:j,u_roughnessFactor:L,u_baseColorTexture:pi.BaseColor,u_metallicRoughnessTexture:pi.MetallicRoughness,u_normalTexture:pi.Normal,u_occlusionTexture:pi.Occlusion,u_emissionTexture:pi.Emission,u_lutTexture:pi.LUT,u_color_mix:[be.r,be.g,be.b,we],u_aoIntensity:Ee,u_emissive_strength:U,u_occlusionTextureTransform:te||[0,0,0,0]}},R0=(g,n=Lp,l=Lp)=>({u_matrix:g,u_instance:n,u_node_matrix:l}),D_={fillExtrusion:g=>({u_matrix:new s.bJ(g),u_lightpos:new s.bL(g),u_lightintensity:new s.bM(g),u_lightcolor:new s.bL(g),u_vertical_gradient:new s.bM(g),u_opacity:new s.bM(g),u_edge_radius:new s.bM(g),u_width_scale:new s.bM(g),u_ao:new s.bK(g),u_height_type:new s.bN(g),u_base_type:new s.bN(g),u_tile_id:new s.bL(g),u_zoom_transition:new s.bM(g),u_inv_rot_matrix:new s.bJ(g),u_merc_center:new s.bK(g),u_up_dir:new s.bL(g),u_height_lift:new s.bM(g),u_flood_light_color:new s.bL(g),u_vertical_scale:new s.bM(g),u_flood_light_intensity:new s.bM(g),u_ground_shadow_factor:new s.bL(g)}),fillExtrusionDepth:g=>({u_matrix:new s.bJ(g),u_edge_radius:new s.bM(g),u_width_scale:new s.bM(g),u_vertical_scale:new s.bM(g),u_height_type:new s.bN(g),u_base_type:new s.bN(g)}),fillExtrusionPattern:g=>({u_matrix:new s.bJ(g),u_lightpos:new s.bL(g),u_lightintensity:new s.bM(g),u_lightcolor:new s.bL(g),u_vertical_gradient:new s.bM(g),u_height_factor:new s.bM(g),u_edge_radius:new s.bM(g),u_width_scale:new s.bM(g),u_ao:new s.bK(g),u_height_type:new s.bN(g),u_base_type:new s.bN(g),u_tile_id:new s.bL(g),u_zoom_transition:new s.bM(g),u_inv_rot_matrix:new s.bJ(g),u_merc_center:new s.bK(g),u_up_dir:new s.bL(g),u_height_lift:new s.bM(g),u_image:new s.bN(g),u_texsize:new s.bK(g),u_pixel_coord_upper:new s.bK(g),u_pixel_coord_lower:new s.bK(g),u_tile_units_to_pixels:new s.bM(g),u_opacity:new s.bM(g)}),fillExtrusionGroundEffect:g=>({u_matrix:new s.bJ(g),u_opacity:new s.bM(g),u_ao_pass:new s.bM(g),u_meter_to_tile:new s.bM(g),u_ao:new s.bK(g),u_flood_light_intensity:new s.bM(g),u_flood_light_color:new s.bL(g),u_attenuation:new s.bM(g),u_edge_radius:new s.bM(g),u_fb:new s.bN(g),u_fb_size:new s.bM(g),u_dynamic_offset:new s.bM(g)}),fill:g=>({u_matrix:new s.bJ(g),u_emissive_strength:new s.bM(g)}),fillPattern:g=>({u_matrix:new s.bJ(g),u_emissive_strength:new s.bM(g),u_image:new s.bN(g),u_texsize:new s.bK(g),u_pixel_coord_upper:new s.bK(g),u_pixel_coord_lower:new s.bK(g),u_tile_units_to_pixels:new s.bM(g)}),fillOutline:g=>({u_matrix:new s.bJ(g),u_emissive_strength:new s.bM(g),u_world:new s.bK(g)}),fillOutlinePattern:g=>({u_matrix:new s.bJ(g),u_emissive_strength:new s.bM(g),u_world:new s.bK(g),u_image:new s.bN(g),u_texsize:new s.bK(g),u_pixel_coord_upper:new s.bK(g),u_pixel_coord_lower:new s.bK(g),u_tile_units_to_pixels:new s.bM(g)}),elevatedStructures:g=>({u_matrix:new s.bJ(g)}),elevatedStructuresDepthReconstruct:g=>({u_matrix:new s.bJ(g),u_camera_pos:new s.bL(g),u_depth_bias:new s.bM(g),u_height_scale:new s.bM(g),u_reset_depth:new s.bM(g)}),circle:s.cT,collisionBox:g=>({u_matrix:new s.bJ(g),u_camera_to_center_distance:new s.bM(g),u_extrude_scale:new s.bK(g)}),collisionCircle:g=>({u_matrix:new s.bJ(g),u_inv_matrix:new s.bJ(g),u_camera_to_center_distance:new s.bM(g),u_viewport_size:new s.bK(g)}),debug:g=>({u_color:new s.cA(g),u_matrix:new s.bJ(g),u_overlay:new s.bN(g),u_overlay_scale:new s.bM(g)}),clippingMask:g=>({u_matrix:new s.bJ(g)}),heatmap:g=>({u_extrude_scale:new s.bM(g),u_intensity:new s.bM(g),u_matrix:new s.bJ(g),u_inv_rot_matrix:new s.bJ(g),u_merc_center:new s.bK(g),u_tile_id:new s.bL(g),u_zoom_transition:new s.bM(g),u_up_dir:new s.bL(g)}),heatmapTexture:g=>({u_image:new s.bN(g),u_color_ramp:new s.bN(g),u_opacity:new s.bM(g)}),hillshade:g=>({u_matrix:new s.bJ(g),u_image:new s.bN(g),u_latrange:new s.bK(g),u_light:new s.bK(g),u_shadow:new s.cA(g),u_highlight:new s.cA(g),u_emissive_strength:new s.bM(g),u_accent:new s.cA(g)}),hillshadePrepare:g=>({u_matrix:new s.bJ(g),u_image:new s.bN(g),u_dimension:new s.bK(g),u_zoom:new s.bM(g)}),line:s.cU,linePattern:s.cV,raster:g=>({u_matrix:new s.bJ(g),u_normalize_matrix:new s.bJ(g),u_globe_matrix:new s.bJ(g),u_merc_matrix:new s.bJ(g),u_grid_matrix:new s.cB(g),u_tl_parent:new s.bK(g),u_scale_parent:new s.bM(g),u_fade_t:new s.bM(g),u_opacity:new s.bM(g),u_image0:new s.bN(g),u_image1:new s.bN(g),u_brightness_low:new s.bM(g),u_brightness_high:new s.bM(g),u_saturation_factor:new s.bM(g),u_contrast_factor:new s.bM(g),u_spin_weights:new s.bL(g),u_perspective_transform:new s.bK(g),u_raster_elevation:new s.bM(g),u_zoom_transition:new s.bM(g),u_merc_center:new s.bK(g),u_cutoff_params:new s.cb(g),u_colorization_mix:new s.cb(g),u_colorization_offset:new s.bM(g),u_color_ramp:new s.bN(g),u_texture_offset:new s.bK(g),u_texture_res:new s.bK(g),u_emissive_strength:new s.bM(g)}),rasterParticle:g=>({u_matrix:new s.bJ(g),u_normalize_matrix:new s.bJ(g),u_globe_matrix:new s.bJ(g),u_merc_matrix:new s.bJ(g),u_grid_matrix:new s.cB(g),u_tl_parent:new s.bK(g),u_scale_parent:new s.bM(g),u_fade_t:new s.bM(g),u_opacity:new s.bM(g),u_image0:new s.bN(g),u_image1:new s.bN(g),u_raster_elevation:new s.bM(g),u_zoom_transition:new s.bM(g),u_merc_center:new s.bK(g),u_cutoff_params:new s.cb(g)}),rasterParticleTexture:g=>({u_texture:new s.bN(g),u_opacity:new s.bM(g)}),rasterParticleDraw:g=>({u_particle_texture:new s.bN(g),u_particle_texture_side_len:new s.bM(g),u_tile_offset:new s.bK(g),u_velocity:new s.bN(g),u_color_ramp:new s.bN(g),u_velocity_res:new s.bK(g),u_max_speed:new s.bM(g),u_uv_offset:new s.bK(g),u_data_scale:new s.bK(g),u_data_offset:new s.bM(g),u_particle_pos_scale:new s.bM(g),u_particle_pos_offset:new s.bK(g)}),rasterParticleUpdate:g=>({u_particle_texture:new s.bN(g),u_particle_texture_side_len:new s.bM(g),u_velocity:new s.bN(g),u_velocity_res:new s.bK(g),u_max_speed:new s.bM(g),u_speed_factor:new s.bM(g),u_reset_rate:new s.bM(g),u_rand_seed:new s.bM(g),u_uv_offset:new s.bK(g),u_data_scale:new s.bK(g),u_data_offset:new s.bM(g),u_particle_pos_scale:new s.bM(g),u_particle_pos_offset:new s.bK(g)}),symbol:g=>({u_is_size_zoom_constant:new s.bN(g),u_is_size_feature_constant:new s.bN(g),u_size_t:new s.bM(g),u_size:new s.bM(g),u_camera_to_center_distance:new s.bM(g),u_rotate_symbol:new s.bN(g),u_aspect_ratio:new s.bM(g),u_fade_change:new s.bM(g),u_matrix:new s.bJ(g),u_label_plane_matrix:new s.bJ(g),u_coord_matrix:new s.bJ(g),u_is_text:new s.bN(g),u_elevation_from_sea:new s.bN(g),u_pitch_with_map:new s.bN(g),u_texsize:new s.bK(g),u_texsize_icon:new s.bK(g),u_texture:new s.bN(g),u_texture_icon:new s.bN(g),u_gamma_scale:new s.bM(g),u_device_pixel_ratio:new s.bM(g),u_tile_id:new s.bL(g),u_zoom_transition:new s.bM(g),u_inv_rot_matrix:new s.bJ(g),u_merc_center:new s.bK(g),u_camera_forward:new s.bL(g),u_tile_matrix:new s.bJ(g),u_up_vector:new s.bL(g),u_ecef_origin:new s.bL(g),u_is_halo:new s.bN(g),u_icon_transition:new s.bM(g),u_color_adj_mat:new s.bJ(g),u_scale_factor:new s.bM(g)}),background:g=>({u_matrix:new s.bJ(g),u_emissive_strength:new s.bM(g),u_opacity:new s.bM(g),u_color:new s.cA(g)}),backgroundPattern:g=>({u_matrix:new s.bJ(g),u_emissive_strength:new s.bM(g),u_opacity:new s.bM(g),u_image:new s.bN(g),u_pattern_tl:new s.bK(g),u_pattern_br:new s.bK(g),u_texsize:new s.bK(g),u_pattern_size:new s.bK(g),u_pixel_coord_upper:new s.bK(g),u_pixel_coord_lower:new s.bK(g),u_pattern_units_to_pixels:new s.bK(g)}),terrainRaster:g=>({u_matrix:new s.bJ(g),u_image0:new s.bN(g),u_skirt_height:new s.bM(g),u_ground_shadow_factor:new s.bL(g)}),skybox:g=>({u_matrix:new s.bJ(g),u_sun_direction:new s.bL(g),u_cubemap:new s.bN(g),u_opacity:new s.bM(g),u_temporal_offset:new s.bM(g)}),skyboxGradient:g=>({u_matrix:new s.bJ(g),u_color_ramp:new s.bN(g),u_center_direction:new s.bL(g),u_radius:new s.bM(g),u_opacity:new s.bM(g),u_temporal_offset:new s.bM(g)}),skyboxCapture:g=>({u_matrix_3f:new s.cB(g),u_sun_direction:new s.bL(g),u_sun_intensity:new s.bM(g),u_color_tint_r:new s.cb(g),u_color_tint_m:new s.cb(g),u_luminance:new s.bM(g)}),globeRaster:g=>({u_proj_matrix:new s.bJ(g),u_globe_matrix:new s.bJ(g),u_normalize_matrix:new s.bJ(g),u_merc_matrix:new s.bJ(g),u_zoom_transition:new s.bM(g),u_merc_center:new s.bK(g),u_image0:new s.bN(g),u_grid_matrix:new s.cB(g),u_skirt_height:new s.bM(g),u_far_z_cutoff:new s.bM(g),u_frustum_tl:new s.bL(g),u_frustum_tr:new s.bL(g),u_frustum_br:new s.bL(g),u_frustum_bl:new s.bL(g),u_globe_pos:new s.bL(g),u_globe_radius:new s.bM(g),u_viewport:new s.bK(g)}),globeAtmosphere:g=>({u_frustum_tl:new s.bL(g),u_frustum_tr:new s.bL(g),u_frustum_br:new s.bL(g),u_frustum_bl:new s.bL(g),u_horizon:new s.bM(g),u_transition:new s.bM(g),u_fadeout_range:new s.bM(g),u_color:new s.cb(g),u_high_color:new s.cb(g),u_space_color:new s.cb(g),u_temporal_offset:new s.bM(g),u_horizon_angle:new s.bM(g)}),model:g=>({u_matrix:new s.bJ(g),u_lighting_matrix:new s.bJ(g),u_normal_matrix:new s.bJ(g),u_node_matrix:new s.bJ(g),u_lightpos:new s.bL(g),u_lightintensity:new s.bM(g),u_lightcolor:new s.bL(g),u_camera_pos:new s.bL(g),u_opacity:new s.bM(g),u_baseColorFactor:new s.cb(g),u_emissiveFactor:new s.cb(g),u_metallicFactor:new s.bM(g),u_roughnessFactor:new s.bM(g),u_baseTextureIsAlpha:new s.bN(g),u_alphaMask:new s.bN(g),u_alphaCutoff:new s.bM(g),u_baseColorTexture:new s.bN(g),u_metallicRoughnessTexture:new s.bN(g),u_normalTexture:new s.bN(g),u_occlusionTexture:new s.bN(g),u_emissionTexture:new s.bN(g),u_lutTexture:new s.bN(g),u_color_mix:new s.cb(g),u_aoIntensity:new s.bM(g),u_emissive_strength:new s.bM(g),u_occlusionTextureTransform:new s.cb(g)}),modelDepth:g=>({u_matrix:new s.bJ(g),u_instance:new s.bJ(g),u_node_matrix:new s.bJ(g)}),groundShadow:g=>({u_matrix:new s.bJ(g),u_ground_shadow_factor:new s.bL(g)}),stars:g=>({u_matrix:new s.bJ(g),u_up:new s.bL(g),u_right:new s.bL(g),u_intensity_multiplier:new s.bM(g)}),snowParticle:g=>({u_modelview:new s.bJ(g),u_projection:new s.bJ(g),u_time:new s.bM(g),u_cam_pos:new s.bL(g),u_velocityConeAperture:new s.bM(g),u_velocity:new s.bM(g),u_horizontalOscillationRadius:new s.bM(g),u_horizontalOscillationRate:new s.bM(g),u_boxSize:new s.bM(g),u_billboardSize:new s.bM(g),u_simpleShapeParameters:new s.bK(g),u_screenSize:new s.bK(g),u_thinningCenterPos:new s.bK(g),u_thinningShape:new s.bL(g),u_thinningAffectedRatio:new s.bM(g),u_thinningParticleOffset:new s.bM(g),u_particleColor:new s.cb(g),u_direction:new s.bL(g)}),rainParticle:g=>({u_modelview:new s.bJ(g),u_projection:new s.bJ(g),u_time:new s.bM(g),u_cam_pos:new s.bL(g),u_texScreen:new s.bN(g),u_velocityConeAperture:new s.bM(g),u_velocity:new s.bM(g),u_boxSize:new s.bM(g),u_rainDropletSize:new s.bK(g),u_distortionStrength:new s.bM(g),u_rainDirection:new s.bL(g),u_color:new s.cb(g),u_screenSize:new s.bK(g),u_thinningCenterPos:new s.bK(g),u_thinningShape:new s.bL(g),u_thinningAffectedRatio:new s.bM(g),u_thinningParticleOffset:new s.bM(g),u_shapeDirectionalPower:new s.bM(g),u_shapeNormalPower:new s.bM(g),u_mode:new s.bM(g)}),vignette:g=>({u_vignetteShape:new s.bL(g),u_vignetteColor:new s.cb(g)}),occlusion:g=>({u_matrix:new s.bJ(g),u_anchorPos:new s.bL(g),u_screenSizePx:new s.bK(g),u_occluderSizePx:new s.bK(g),u_color:new s.cb(g)})};class ja{constructor(n,l,m,x){this.id=ja.uniqueIdxCounter,ja.uniqueIdxCounter++,this.context=n;const b=n.gl;this.buffer=b.createBuffer(),this.dynamicDraw=!!m,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||x||l.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=ja.uniqueIdxCounter,ja.uniqueIdxCounter++;const l=this.context.gl;this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}ja.uniqueIdxCounter=0;const L_={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class O_{constructor(n,l,m,x,b,T){this.length=l.length,this.attributes=m,this.itemSize=l.bytesPerElement,this.dynamicDraw=x,this.instanceCount=T,this.context=n;const k=n.gl;this.buffer=k.createBuffer(),n.bindVertexBuffer.set(this.buffer),k.bufferData(k.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?k.DYNAMIC_DRAW:k.STATIC_DRAW),this.dynamicDraw||b||l.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,l){for(let m=0;m<this.attributes.length;m++){const x=l.attributes[this.attributes[m].name];x!==void 0&&n.enableVertexAttribArray(x)}}setVertexAttribPointers(n,l,m){for(let x=0;x<this.attributes.length;x++){const b=this.attributes[x],T=l.attributes[b.name];T!==void 0&&n.vertexAttribPointer(T,b.components,n[L_[b.type]],!1,this.itemSize,b.offset+this.itemSize*(m||0))}}setVertexAttribDivisor(n,l,m){for(let x=0;x<this.attributes.length;x++){const b=l.attributes[this.attributes[x].name];b!==void 0&&this.instanceCount&&this.instanceCount>0&&n.vertexAttribDivisor(b,m)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class $s{constructor(n,l,m,x,b){this.context=n,this.width=l,this.height=m;const T=this.framebuffer=n.gl.createFramebuffer();x&&(this.colorAttachment=new v_(n,T)),b&&(this.depthAttachmentType=b,this.depthAttachment=b==="renderbuffer"?new b_(n,T):new Bu(n,T))}destroy(){const n=this.context.gl;if(this.colorAttachment){const l=this.colorAttachment.get();l&&n.deleteTexture(l)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const l=this.depthAttachment.get();l&&n.deleteRenderbuffer(l)}else{const l=this.depthAttachment.get();l&&n.deleteTexture(l)}n.deleteFramebuffer(this.framebuffer)}}class Ql{constructor(n,l){this.gl=n,this.clearColor=new mS(this),this.clearDepth=new u_(this),this.clearStencil=new d_(this),this.colorMask=new h_(this),this.depthMask=new f_(this),this.stencilMask=new y0(this),this.stencilFunc=new x0(this),this.stencilOp=new gS(this),this.stencilTest=new zh(this),this.depthRange=new Fh(this),this.depthTest=new v0(this),this.depthFunc=new po(this),this.blend=new p_(this),this.blendFunc=new Sp(this),this.blendColor=new Tp(this),this.blendEquation=new m_(this),this.cullFace=new g_(this),this.cullFaceSide=new __(this),this.frontFace=new Ep(this),this.program=new y_(this),this.activeTexture=new x_(this),this.viewport=new Cp(this),this.bindFramebuffer=new b0(this),this.bindRenderbuffer=new w0(this),this.bindTexture=new Fu(this),this.bindVertexBuffer=new _S(this),this.bindElementBuffer=new yS(this),this.bindVertexArrayOES=new xS(this),this.pixelStoreUnpack=new vS(this),this.pixelStoreUnpackPremultiplyAlpha=new bS(this),this.pixelStoreUnpackFlipY=new wS(this),this.options=l?Object.assign({},l):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=n.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=n.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=n.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=l&&!!l.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=n.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),this.maxPointSize=n.getParameter(n.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,l,m){return new ja(this,n,l,m)}createVertexBuffer(n,l,m,x,b){return new O_(this,n,l,m,x,b)}createRenderbuffer(n,l,m){const x=this.gl,b=x.createRenderbuffer();return this.bindRenderbuffer.set(b),x.renderbufferStorage(x.RENDERBUFFER,n,l,m),this.bindRenderbuffer.set(null),b}createFramebuffer(n,l,m,x){return new $s(this,n,l,m,x)}clear({color:n,depth:l,stencil:m,colorMask:x}){const b=this.gl;let T=0;n&&(T|=b.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set(x||[!0,!0,!0,!0])),l!==void 0&&(T|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),m!==void 0&&(T|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),b.clear(T)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){s.bn(n.blendFunction,zr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor),n.blendEquation?this.blendEquation.set(n.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(n.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let $h;function Op(g,n,l,m,x,b,T){const k=g.context,j=k.gl,L=g.transform,z=g.getOrCreateProgram("collisionBox"),U=[];let V=0,Y=0;for(let ye=0;ye<m.length;ye++){const Ee=m[ye],be=n.getTile(Ee),we=be.getBucket(l);if(!we)continue;const Te=t_(Ee,we,L);let Pe=Te;x[0]===0&&x[1]===0||(Pe=g.translatePosMatrix(Te,be,x,b));const Ne=T?we.textCollisionBox:we.iconCollisionBox,Ke=we.collisionCircleArray;if(Ke.length>0){const $e=s.ad.mat4.create(),lt=Pe;s.ad.mat4.mul($e,we.placementInvProjMatrix,L.glCoordMatrix),s.ad.mat4.mul($e,$e,we.placementViewportMatrix),U.push({circleArray:Ke,circleOffset:Y,transform:lt,invTransform:$e,projection:we.getProjection()}),V+=Ke.length/4,Y=V}Ne&&(g.terrain&&g.terrain.setupElevationDraw(be,z),z.draw(g,j.LINES,ir.disabled,Mr.disabled,g.colorModeForRenderPass(),vr.disabled,P0(Pe,L,be,we.getProjection()),l.id,Ne.layoutVertexBuffer,Ne.indexBuffer,Ne.segments,null,L.zoom,null,[Ne.collisionVertexBuffer,Ne.collisionVertexBufferExt]))}if(!T||!U.length)return;const te=g.getOrCreateProgram("collisionCircle"),K=new s.cW;K.resize(4*V),K._trim();let ne=0;for(const ye of U)for(let Ee=0;Ee<ye.circleArray.length/4;Ee++){const be=4*Ee,we=ye.circleArray[be+0],Te=ye.circleArray[be+1],Pe=ye.circleArray[be+2],Ne=ye.circleArray[be+3];K.emplace(ne++,we,Te,Pe,Ne,0),K.emplace(ne++,we,Te,Pe,Ne,1),K.emplace(ne++,we,Te,Pe,Ne,2),K.emplace(ne++,we,Te,Pe,Ne,3)}(!$h||$h.length<2*V)&&($h=function(ye){const Ee=2*ye,be=new s.aV;be.resize(Ee),be._trim();for(let we=0;we<Ee;we++){const Te=6*we;be.uint16[Te+0]=4*we+0,be.uint16[Te+1]=4*we+1,be.uint16[Te+2]=4*we+2,be.uint16[Te+3]=4*we+2,be.uint16[Te+4]=4*we+3,be.uint16[Te+5]=4*we+0}return be}(V));const se=k.createIndexBuffer($h,!0),me=k.createVertexBuffer(K,s.cX.members,!0);for(const ye of U){const Ee={u_matrix:ye.transform,u_inv_matrix:ye.invTransform,u_camera_to_center_distance:(xe=L).getCameraToCenterDistance(ye.projection),u_viewport_size:[xe.width,xe.height]};te.draw(g,j.TRIANGLES,ir.disabled,Mr.disabled,g.colorModeForRenderPass(),vr.disabled,Ee,l.id,me,se,s.b8.simpleSegment(0,2*ye.circleOffset,ye.circleArray.length,ye.circleArray.length/2),null,L.zoom)}var xe;me.destroy(),se.destroy()}const qu=s.ad.mat4.create();function zp(g){const n=g._camera.getWorldToCamera(g.worldSize,1),l=s.ad.mat4.multiply([],n,g.globeMatrix);s.ad.mat4.invert(l,l);const m=[0,0,0],x=[0,1,0,0];return s.ad.vec4.transformMat4(x,x,l),m[0]=x[0],m[1]=x[1],m[2]=x[2],s.ad.vec3.normalize(m,m),m}function j0({width:g,height:n,anchor:l,textOffset:m,textScale:x},b){const{horizontalAlign:T,verticalAlign:k}=s.bD(l),j=-(T-.5)*g,L=-(k-.5)*n,z=s.bC(l,m);return new s.P((j/x+z[0])*b,(L/x+z[1])*b)}function zo(g,n,l,m,x,b,T,k,j,L,z){const U=g.text.placedSymbolArray,V=g.text.dynamicLayoutVertexArray,Y=g.icon.dynamicLayoutVertexArray,te={},K=g.getProjection(),ne=fo(k,K,b),se=b.elevation,me=K.upVectorScale(k.canonical,b.center.lat,b.worldSize).metersToTile;V.clear();for(let xe=0;xe<U.length;xe++){const ye=U.get(xe),{tileAnchorX:Ee,tileAnchorY:be,numGlyphs:we}=ye,Te=ye.hidden||!ye.crossTileID||g.allowVerticalPlacement&&!ye.placedOrientation?null:m[ye.crossTileID];if(Te){let Pe=0,Ne=0,Ke=0;if(se){const rt=se?se.getAtTileOffset(k,Ee,be):0,[ht,Je,mt]=K.upVector(k.canonical,Ee,be);Pe=rt*ht*me,Ne=rt*Je*me,Ke=rt*mt*me}let[$e,lt,dt,vt]=oa(ye.projectedAnchorX+Pe,ye.projectedAnchorY+Ne,ye.projectedAnchorZ+Ke,l?ne:T);const Ue=Mu(b.getCameraToCenterDistance(K),vt);let at=x.evaluateSizeForFeature(g.textSizeData,L,ye)*Ue/s.bw;l&&(at*=g.tilePixelRatio/j);const Fe=j0(Te,at);l?({x:$e,y:lt,z:dt}=K.projectTilePoint(Ee+Fe.x,be+Fe.y,k.canonical),[$e,lt,dt]=oa($e+Pe,lt+Ne,dt+Ke,T)):(n&&Fe._rotate(-b.angle),$e+=Fe.x,lt+=Fe.y,dt=0);const ot=g.allowVerticalPlacement&&ye.placedOrientation===s.bq.vertical?Math.PI/2:0;for(let rt=0;rt<we;rt++)s.bt(V,$e,lt,dt,ot);z&&ye.associatedIconIndex>=0&&(te[ye.associatedIconIndex]={x:$e,y:lt,z:dt,angle:ot})}else aa(we,V)}if(z){Y.clear();const xe=g.icon.placedSymbolArray;for(let ye=0;ye<xe.length;ye++){const Ee=xe.get(ye),{numGlyphs:be}=Ee,we=te[ye];if(Ee.hidden||!we)aa(be,Y);else{const{x:Te,y:Pe,z:Ne,angle:Ke}=we;for(let $e=0;$e<be;$e++)s.bt(Y,Te,Pe,Ne,Ke)}}g.icon.dynamicLayoutVertexBuffer.updateData(Y)}g.text.dynamicLayoutVertexBuffer.updateData(V)}function kn(g,n,l,m,x,b,T={}){const k=l.paint.get("icon-translate"),j=l.paint.get("text-translate"),L=l.paint.get("icon-translate-anchor"),z=l.paint.get("text-translate-anchor"),U=l.layout.get("icon-rotation-alignment"),V=l.layout.get("text-rotation-alignment"),Y=l.layout.get("icon-pitch-alignment"),te=l.layout.get("text-pitch-alignment"),K=l.layout.get("icon-keep-upright"),ne=l.layout.get("text-keep-upright"),se=l.paint.get("icon-color-saturation"),me=l.paint.get("icon-color-contrast"),xe=l.paint.get("icon-color-brightness-min"),ye=l.paint.get("icon-color-brightness-max"),Ee=l.layout.get("symbol-elevation-reference")==="sea",be=g.context,we=be.gl,Te=g.transform,Pe=U==="map",Ne=V==="map",Ke=Y==="map",$e=te==="map",lt=l.layout.get("symbol-sort-key").constantOr(1)!==void 0;let dt=!1;const vt=g.depthModeForSublayer(0,ir.ReadOnly),Ue=[s.av(Te.center.lng),s.aC(Te.center.lat)],at=l.layout.get("text-variable-anchor"),Fe=Te.projection.name==="globe",ot=[],rt=[0,-1,0];for(const ht of m){const Je=n.getTile(ht),mt=Je.getBucket(l);if(!mt||mt.projection.name==="mercator"&&Fe||mt.fullyClipped)continue;const It=mt.projection.name==="globe",kt=It?s.ag(Te.zoom):0,Rt=fo(ht,mt.getProjection(),Te),Yt=Te.calculatePixelsToTileUnitsMatrix(Je),Tr=at&&mt.hasTextData(),cr=mt.hasIconTextFit()&&Tr&&mt.hasIconData(),yr=mt.getProjection().createInversionMatrix(Te,ht.canonical),pr=yn=>{Te.depthOcclusionForSymbolsAndCircles&&(l.hasInitialOcclusionOpacityProperties||g.terrain)&&(yn.push("DEPTH_D24"),yn.push("DEPTH_OCCLUSION"))},Gr=()=>{const yn=Pe&&l.layout.get("symbol-placement")!=="point",Qr=[];pr(Qr);const ai=yn||cr,Ei=l.paint.get("icon-image-cross-fade").constantOr(0);g.terrainRenderModeElevated()&&Ke&&Qr.push("PITCH_WITH_MAP_TERRAIN"),It&&(Qr.push("PROJECTION_GLOBE_VIEW"),ai&&Qr.push("PROJECTED_POS_ON_VIEWPORT")),Ei>0&&Qr.push("ICON_TRANSITION"),mt.icon.zOffsetVertexBuffer&&Qr.push("Z_OFFSET"),se===0&&me===0&&xe===0&&ye===1||Qr.push("COLOR_ADJUSTMENT"),mt.sdfIcons&&Qr.push("RENDER_SDF");const zi=mt.icon.programConfigurations.get(l.id),Ui=g.getOrCreateProgram("symbol",{config:zi,defines:Qr}),yo=Je.imageAtlasTexture?Je.imageAtlasTexture.size:[0,0],Is=mt.iconSizeData,Xr=s.bp(Is,Te.zoom),Zn=Ke||Te.pitch!==0,an=el(Rt,Je.tileID.canonical,Ke,Pe,Te,mt.getProjection(),Yt),Cn=bi(Rt,Je.tileID.canonical,Ke,Pe,Te,mt.getProjection(),Yt),us=g.translatePosMatrix(Cn,Je,k,L,!0),Un=g.translatePosMatrix(Rt,Je,k,L),Fi=ai?qu:an,Oa=Pe&&!Ke&&!yn;let Qs=rt;!Fe&&!Te.mercatorFromTransition||Pe||(Qs=zp(Te));const Vo=It?Qs:rt,Gs=l.getColorAdjustmentMatrix(se,me,xe,ye),Uo=Dp(Is.kind,Xr,Oa,Ke,g,Un,Fi,us,Ee,!1,yo,[0,0],!0,ht,kt,Ue,yr,Vo,mt.getProjection(),Gs,Ei),eo=Je.imageAtlasTexture?Je.imageAtlasTexture:null,fl=l.layout.get("icon-size").constantOr(0)!==1||mt.iconsNeedLinear,za=mt.sdfIcons||g.options.rotating||g.options.zooming||fl||Zn?we.LINEAR:we.NEAREST,pl=mt.sdfIcons&&l.paint.get("icon-halo-width").constantOr(1)!==0,cy=g.terrain&&Ke&&yn?s.ad.mat4.invert(s.ad.mat4.create(),an):qu;if(yn&&mt.icon){const sd=Te.elevation,rm=sd?sd.getAtTileOffsetFunc(ht,Te.center.lat,Te.worldSize,mt.getProjection()):null,uy=_s(Rt,Je.tileID.canonical,Ke,Pe,Te,mt.getProjection(),Yt);Au(mt,Rt,g,!1,uy,Cn,Ke,K,rm,ht)}return{program:Ui,buffers:mt.icon,uniformValues:Uo,atlasTexture:eo,atlasTextureIcon:null,atlasInterpolation:za,atlasInterpolationIcon:null,isSDF:mt.sdfIcons,hasHalo:pl,tile:Je,labelPlaneMatrixInv:cy}},on=()=>{const yn=Ne&&l.layout.get("symbol-placement")!=="point",Qr=[],ai=yn||at||cr;g.terrainRenderModeElevated()&&$e&&Qr.push("PITCH_WITH_MAP_TERRAIN"),It&&(Qr.push("PROJECTION_GLOBE_VIEW"),ai&&Qr.push("PROJECTED_POS_ON_VIEWPORT")),mt.text.zOffsetVertexBuffer&&Qr.push("Z_OFFSET"),mt.iconsInText&&Qr.push("RENDER_TEXT_AND_SYMBOL"),Qr.push("RENDER_SDF"),pr(Qr);const Ei=mt.text.programConfigurations.get(l.id),zi=g.getOrCreateProgram("symbol",{config:Ei,defines:Qr});let Ui,yo=[0,0],Is=null;const Xr=mt.textSizeData;mt.iconsInText&&(yo=Je.imageAtlasTexture?Je.imageAtlasTexture.size:[0,0],Is=Je.imageAtlasTexture?Je.imageAtlasTexture:null,Ui=$e||Te.pitch!==0||g.options.rotating||g.options.zooming||Xr.kind==="composite"||Xr.kind==="camera"?we.LINEAR:we.NEAREST);const Zn=Je.glyphAtlasTexture?Je.glyphAtlasTexture.size:[0,0],an=l.layout.get("text-size-scale-range"),Cn=s.ay(g.scaleFactor,an[0],an[1]),us=s.bp(Xr,Te.zoom,Cn),Un=el(Rt,Je.tileID.canonical,$e,Ne,Te,mt.getProjection(),Yt),Fi=bi(Rt,Je.tileID.canonical,$e,Ne,Te,mt.getProjection(),Yt),Oa=g.translatePosMatrix(Fi,Je,j,z,!0),Qs=g.translatePosMatrix(Rt,Je,j,z),Vo=ai?qu:Un,Gs=Ne&&!$e&&!yn;let Uo=rt;!Fe&&!Te.mercatorFromTransition||Ne||(Uo=zp(Te));const eo=Dp(Xr.kind,us,Gs,$e,g,Qs,Vo,Oa,Ee,!0,Zn,yo,!0,ht,kt,Ue,yr,It?Uo:rt,mt.getProjection(),null,null,Cn),fl=Je.glyphAtlasTexture?Je.glyphAtlasTexture:null,za=we.LINEAR,pl=l.paint.get("text-halo-width").constantOr(1)!==0,cy=g.terrain&&$e&&yn?s.ad.mat4.invert(s.ad.mat4.create(),Un):qu;if(yn&&mt.text){const sd=Te.elevation,rm=sd?sd.getAtTileOffsetFunc(ht,Te.center.lat,Te.worldSize,mt.getProjection()):null,uy=_s(Rt,Je.tileID.canonical,$e,Ne,Te,mt.getProjection(),Yt);Au(mt,Rt,g,!0,uy,Fi,$e,ne,rm,ht)}return{program:zi,buffers:mt.text,uniformValues:eo,atlasTexture:fl,atlasTextureIcon:Is,atlasInterpolation:za,atlasInterpolationIcon:Ui,isSDF:!0,hasHalo:pl,tile:Je,labelPlaneMatrixInv:cy}},Rn=mt.icon.segments.get().length,Lr=mt.text.segments.get().length,Wn=Rn&&!T.onlyText?Gr():null,Ar=Lr&&!T.onlyIcons?on():null,Xt=l.paint.get("icon-opacity").constantOr(1),Hr=l.paint.get("text-opacity").constantOr(1);if(lt&&mt.canOverlap){dt=!0;const yn=Xt&&!T.onlyText?mt.icon.segments.get():[],Qr=Hr&&!T.onlyIcons?mt.text.segments.get():[];for(const ai of yn)ot.push({segments:new s.b8([ai]),sortKey:ai.sortKey,state:Wn});for(const ai of Qr)ot.push({segments:new s.b8([ai]),sortKey:ai.sortKey,state:Ar})}else T.onlyText||ot.push({segments:Xt?mt.icon.segments:new s.b8([]),sortKey:0,state:Wn}),T.onlyIcons||ot.push({segments:Hr?mt.text.segments:new s.b8([]),sortKey:0,state:Ar})}dt&&ot.sort((ht,Je)=>ht.sortKey-Je.sortKey);for(const ht of ot){const Je=ht.state;if(Je)if(g.terrain?g.terrain.setupElevationDraw(Je.tile,Je.program,{useDepthForOcclusion:Te.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Je.labelPlaneMatrixInv}):g.setupDepthForOcclusion(Te.depthOcclusionForSymbolsAndCircles,Je.program),be.activeTexture.set(we.TEXTURE0),Je.atlasTexture&&Je.atlasTexture.bind(Je.atlasInterpolation,we.CLAMP_TO_EDGE,!0),Je.atlasTextureIcon&&(be.activeTexture.set(we.TEXTURE1),Je.atlasTextureIcon&&Je.atlasTextureIcon.bind(Je.atlasInterpolationIcon,we.CLAMP_TO_EDGE,!0)),g.uploadCommonLightUniforms(g.context,Je.program),Je.hasHalo){const mt=Je.uniformValues;mt.u_is_halo=1,Hu(Je.buffers,ht.segments,l,g,Je.program,vt,x,b,mt,2),mt.u_is_halo=0}else{if(Je.isSDF){const mt=Je.uniformValues;Je.hasHalo&&(mt.u_is_halo=1,Hu(Je.buffers,ht.segments,l,g,Je.program,vt,x,b,mt,1)),mt.u_is_halo=0}Hu(Je.buffers,ht.segments,l,g,Je.program,vt,x,b,Je.uniformValues,1)}}}function Hu(g,n,l,m,x,b,T,k,j,L){const z=[g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer,g.iconTransitioningVertexBuffer,g.globeExtVertexBuffer,g.zOffsetVertexBuffer];x.draw(m,m.context.gl.TRIANGLES,b,T,k,vr.disabled,j,l.id,g.layoutVertexBuffer,g.indexBuffer,n,l.paint,m.transform.zoom,g.programConfigurations.get(l.id),z,L)}function z_(g,n){const l=1<<g.canonical.z,m=(n.x*l-g.canonical.x-g.wrap*l)*s.ai,x=(n.y*l-g.canonical.y)*s.ai,b=s.d5(n.z,n.y);return s.ad.vec3.fromValues(m,x,b)}function F_(g,n,l,m,x){if(!l.layout||l.layout.get("fill-elevation-reference")==="none")return;const b=g.context.gl,T=new ir(g.context.gl.LEQUAL,ir.ReadWrite,g.depthRangeFor3D),k=new ir(g.context.gl.GREATER,ir.ReadWrite,g.depthRangeFor3D),j=function(Y){const te=s.c4(Y.pitch);let K=.01;return Y.isOrthographic&&(K=s.ah(1e-4,K,s.c9(te>=Ct?1:te/Ct))),2*K}(g.transform),L=g.transform.getFreeCameraOptions().position,z="elevatedStructuresDepthReconstruct",U=g.getOrCreateProgram(z,{defines:["DEPTH_RECONSTRUCTION"]}),V=g.getOrCreateProgram(z);for(const Y of m){const te=n.getTile(Y),K=te.getBucket(l);if(!K)continue;const ne=K.elevatedStructures;if(!ne)continue;const se=K.elevationBufferData.heightRange,me=z_(Y.toUnwrapped(),L),xe=g.translatePosMatrix(Y.projMatrix,te,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor"));let ye,Ee,be,we;if(x==="initialize"){if(!se||se.min>=1||ne.depthSegments.segments[0].primitiveLength===0)continue;ye=Uh(xe,me,j,1,0),Ee=T,be=ne.depthSegments,we=U}else if(x==="reset"){if(!se||se.min>=0||ne.maskSegments.segments[0].primitiveLength===0)continue;ye=Uh(xe,me,0,0,1),Ee=k,be=ne.maskSegments,we=U}else if(x==="geometry"){if(ne.depthSegments.segments[0].primitiveLength===0)continue;ye=Uh(xe,me,j,1,0),Ee=T,be=ne.depthSegments,we=V}we.draw(g,b.TRIANGLES,Ee,Mr.disabled,zr.disabled,vr.disabled,ye,l.id,ne.vertexBuffer,ne.indexBuffer,be,l.paint,g.transform.zoom)}}function Fp(g,n,l){const{painter:m,sourceCache:x,layer:b,coords:T,colorMode:k,elevationType:j,terrainEnabled:L,pass:z}=g,U=m.context.gl,V=b.paint.get("fill-pattern");let Y=j;j!=="road"||n&&!L||(Y="none");const te=Y==="road",K=new ir(m.context.gl.LEQUAL,ir.ReadWrite,m.depthRangeFor3D),ne=V&&V.constantOr(1),se=(me,xe)=>{let ye,Ee,be,we,Te;xe?(Ee=ne&&!b.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ye=U.LINES):(Ee=ne?"fillPattern":"fill",ye=U.TRIANGLES);for(const Pe of T){const Ne=x.getTile(Pe);if(ne&&!Ne.patternsLoaded())continue;const Ke=Ne.getBucket(b);if(!Ke)continue;const $e=n?Ke.elevationBufferData:Ke.bufferData;if($e.isEmpty())continue;m.prepareDrawTile();const lt=$e.programConfigurations.get(b.id),dt=m.isTileAffectedByFog(Pe),vt=[],Ue=[];te&&(vt.push("ELEVATED_ROADS"),Ue.push($e.elevatedLayoutVertexBuffer));const at=m.getOrCreateProgram(Ee,{config:lt,overrideFog:dt,defines:vt});ne&&(m.context.activeTexture.set(U.TEXTURE0),Ne.imageAtlasTexture&&Ne.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),lt.updatePaintBuffers());const Fe=V.constantOr(null);if(Fe&&Ne.imageAtlas){const ht=Ne.imageAtlas,Je=s.d0.from(Fe).getPrimary().scaleSelf(s.q.devicePixelRatio).toString(),mt=ht.patternPositions.get(Je);mt&&lt.setConstantPatternPositions(mt)}const ot=m.translatePosMatrix(Pe.projMatrix,Ne,b.paint.get("fill-translate"),b.paint.get("fill-translate-anchor")),rt=b.paint.get("fill-emissive-strength");if(xe){we=$e.lineIndexBuffer,Te=$e.lineSegments;const ht=m.terrain&&m.terrain.renderingToTexture?m.terrain.drapeBufferSize:[U.drawingBufferWidth,U.drawingBufferHeight];be=Ee==="fillOutlinePattern"&&ne?Rp(ot,rt,m,Ne,ht):Np(ot,rt,ht)}else we=$e.indexBuffer,Te=$e.triangleSegments,be=ne?P_(ot,rt,m,Ne):$u(ot,rt);m.uploadCommonUniforms(m.context,at,Pe.toUnwrapped()),at.draw(m,ye,Y!=="none"?K:me,l||m.stencilModeForClipping(Pe),k,vr.disabled,be,b.id,$e.layoutVertexBuffer,we,Te,b.paint,m.transform.zoom,lt,Ue)}};m.renderPass===z&&se(m.depthModeForSublayer(1,m.renderPass==="opaque"?ir.ReadWrite:ir.ReadOnly),!1),Y==="none"&&m.renderPass==="translucent"&&b.paint.get("fill-antialias")&&se(m.depthModeForSublayer(b.getPaintProperty("fill-outline-color")?2:0,ir.ReadOnly),!0)}function Gh(g,n,l,m,x,b,T,k){l.resetLayerRenderingStats(g);const j=g.context,L=j.gl,z=g.transform,U=l.paint.get("fill-extrusion-pattern"),V=U.constantOr(1),Y=l.paint.get("fill-extrusion-opacity"),te=g.style.enable3dLights(),K=l.paint.get(te&&!V?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ne=[l.paint.get("fill-extrusion-ambient-occlusion-intensity"),K],se=l.layout.get("fill-extrusion-edge-radius"),me=se>0&&!l.paint.get("fill-extrusion-rounded-roof"),xe=me?0:se,ye=z.projection.name==="globe"?s.d6():0,Ee=z.projection.name==="globe",be=Ee?s.ag(z.zoom):0,we=[s.av(z.center.lng),s.aC(z.center.lat)],Te=l.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Pe=l.paint.get("fill-extrusion-flood-light-color").toRenderColor(Te?null:l.lut).toArray01().slice(0,3),Ne=l.paint.get("fill-extrusion-flood-light-intensity"),Ke=l.paint.get("fill-extrusion-vertical-scale"),$e=l.paint.get("fill-extrusion-line-width").constantOr(1)!==0,lt=l.paint.get("fill-extrusion-height-alignment"),dt=l.paint.get("fill-extrusion-base-alignment"),vt=sl(g,l.paint.get("fill-extrusion-cutoff-fade-range")),Ue=[];let at;Ee&&Ue.push("PROJECTION_GLOBE_VIEW"),ne[0]>0&&Ue.push("FAUX_AO"),me&&Ue.push("ZERO_ROOF_RADIUS"),k&&Ue.push("HAS_CENTROID"),Ne>0&&Ue.push("FLOOD_LIGHT"),vt.shouldRenderCutoff&&Ue.push("RENDER_CUTOFF"),$e&&Ue.push("RENDER_WALL_MODE");const Fe=g.renderPass==="shadow",ot=g.shadowRenderer,rt=Fe&&!!ot;g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!0);let ht=[0,0,0];if(ot){const It=g.style.directionalLight,kt=g.style.ambientLight;It&&kt&&(ht=ju(g.style,It,kt)),Fe||(Ue.push("RENDER_SHADOWS","DEPTH_TEXTURE"),ot.useNormalOffset&&Ue.push("NORMAL_OFFSET")),at=Ue.concat(["SHADOWS_SINGLE_CASCADE"])}const Je=rt?"fillExtrusionDepth":V?"fillExtrusionPattern":"fillExtrusion",mt=l.getLayerRenderingStats();for(const It of m){const kt=n.getTile(It),Rt=kt.getBucket(l);if(!Rt||Rt.projection.name!==z.projection.name)continue;let Yt=!1;ot&&(Yt=ot.getMaxCascadeForTile(It.toUnwrapped())===0);const Tr=g.isTileAffectedByFog(It),cr=Rt.programConfigurations.get(l.id),yr=g.getOrCreateProgram(Je,{config:cr,defines:Yt?at:Ue,overrideFog:Tr});if(g.terrain&&g.terrain.setupElevationDraw(kt,yr,{useMeterToDem:!0}),!Rt.centroidVertexBuffer){const Ar=yr.attributes.a_centroid_pos;Ar!==void 0&&L.vertexAttrib2f(Ar,0,0)}!Fe&&ot&&ot.setupShadows(kt.tileID.toUnwrapped(),yr,"vector-tile",kt.tileID.overscaledZ),V&&(g.context.activeTexture.set(L.TEXTURE0),kt.imageAtlasTexture&&kt.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),cr.updatePaintBuffers());const pr=U.constantOr(null);if(pr&&kt.imageAtlas){const Ar=kt.imageAtlas,Xt=s.d0.from(pr).getPrimary().scaleSelf(s.q.devicePixelRatio),Hr=Ar.patternPositions.get(Xt.toString());Hr&&cr.setConstantPatternPositions(Hr)}const Gr=l.paint.get("fill-extrusion-vertical-gradient"),on=1/Rt.tileToMeter;let Rn;if(Fe&&ot){if(Xu(kt.tileID,Rt,g))continue;const Ar=ot.calculateShadowPassMatrixFromTile(kt.tileID.toUnwrapped());Rn=Uu(Ar,xe,on,Ke,lt,dt)}else{const Ar=g.translatePosMatrix(It.expandedProjMatrix,kt,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),Xt=z.projection.createInversionMatrix(z,It.canonical);Rn=V?A_(Ar,g,Gr,Y,ne,xe,on,It,kt,ye,lt,dt,be,we,Xt,Pe,Ke):kp(Ar,g,Gr,Y,ne,xe,on,It,ye,lt,dt,be,we,Xt,Pe,Ke,Ne,ht)}g.uploadCommonUniforms(j,yr,It.toUnwrapped(),null,vt);let Lr=Rt.segments;if(z.projection.name==="mercator"&&!Fe&&(Lr=Rt.getVisibleSegments(kt.tileID,g.terrain,g.transform.getFrustum(0)),!Lr.get().length))continue;if(mt)if(Fe)for(const Ar of Lr.get())mt.numRenderedVerticesInShadowPass+=Ar.primitiveLength;else for(const Ar of Lr.get())mt.numRenderedVerticesInTransparentPass+=Ar.primitiveLength;const Wn=[];(g.terrain||k)&&Wn.push(Rt.centroidVertexBuffer),Ee&&Wn.push(Rt.layoutVertexExtBuffer),$e&&Wn.push(Rt.wallVertexBuffer),yr.draw(g,j.gl.TRIANGLES,x,b,T,vr.backCCW,Rn,l.id,Rt.layoutVertexBuffer,Rt.indexBuffer,Lr,l.paint,g.transform.zoom,cr,Wn)}g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!1)}function Wu(g,n,l,m,x,b,T,k,j,L,z,U,V,Y,te,K,ne,se,me){const xe=g.context,ye=xe.gl,Ee=g.transform,be=g.transform.zoom,we=[],Te=sl(g,l.paint.get("fill-extrusion-cutoff-fade-range"));L==="clear"?(we.push("CLEAR_SUBPASS"),me&&(we.push("CLEAR_FROM_TEXTURE"),xe.activeTexture.set(ye.TEXTURE0),me.bind(ye.LINEAR,ye.CLAMP_TO_EDGE))):L==="sdf"&&we.push("SDF_SUBPASS"),ne&&we.push("HAS_CENTROID"),Te.shouldRenderCutoff&&we.push("RENDER_CUTOFF");const Pe=l.layout.get("fill-extrusion-edge-radius"),Ne=(Ke,$e,lt,dt,vt)=>{const Ue=$e.programConfigurations.get(l.id),at=g.isTileAffectedByFog(Ke),Fe=g.getOrCreateProgram("fillExtrusionGroundEffect",{config:Ue,defines:we,overrideFog:at}),ot=((ht,Je,mt,It,kt,Rt,Yt,Tr,cr,yr,pr)=>({u_matrix:Je,u_opacity:mt,u_ao_pass:It?1:0,u_meter_to_tile:kt,u_ao:Rt,u_flood_light_intensity:Yt,u_flood_light_color:Tr,u_attenuation:cr,u_edge_radius:yr,u_fb:0,u_fb_size:pr,u_dynamic_offset:1}))(0,dt,z,j,vt,[U,V*vt],Y,te,K,be>=17?0:Pe*vt,me?me.size[0]:0),rt=[];ne&&rt.push($e.hiddenByLandmarkVertexBuffer),g.uploadCommonUniforms(xe,Fe,Ke.toUnwrapped(),null,Te),Fe.draw(g,xe.gl.TRIANGLES,x,b,T,k,ot,l.id,$e.vertexBuffer,$e.indexBuffer,lt,l.paint,be,Ue,rt)};for(const Ke of m){const $e=n.getTile(Ke),lt=$e.getBucket(l);if(!lt||lt.projection.name!==Ee.projection.name||!lt.groundEffect||lt.groundEffect&&!lt.groundEffect.hasData())continue;const dt=lt.groundEffect,vt=1/lt.tileToMeter;{const Ue=g.translatePosMatrix(Ke.projMatrix,$e,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),at=dt.getDefaultSegment();Ne(Ke,dt,at,Ue,vt)}if(se)for(let Ue=0;Ue<4;Ue++){const at=s.d7[Ue](Ke),Fe=n.getTile(at);if(!Fe)continue;const ot=Fe.getBucket(l);if(!ot||ot.projection.name!==Ee.projection.name||!ot.groundEffect||ot.groundEffect&&!ot.groundEffect.hasData())continue;const rt=ot.groundEffect;let ht,Je;Ue===0?(ht=[-s.ai,0,0],Je=1):Ue===1?(ht=[s.ai,0,0],Je=0):Ue===2?(ht=[0,-s.ai,0],Je=3):(ht=[0,s.ai,0],Je=2);const mt=rt.regionSegments[Je];if(!mt)continue;const It=new Float32Array(16);s.ad.mat4.translate(It,Ke.projMatrix,ht),Ne(Ke,rt,mt,g.translatePosMatrix(It,$e,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),vt)}}}function Zu(g,n,l,m,x,b,T){m.centroidVertexArray.length===0&&m.createCentroidsBuffer();const k=b?b.findDEMTileFor(l):null;if(!(k&&k.dem||T))return;b&&k&&k.dem&&m.selfDEMTileTimestamp!==k.dem._timestamp&&(m.borderDoneWithNeighborZ=[-1,-1,-1,-1],m.selfDEMTileTimestamp=k.dem._timestamp);const j=se=>new s.P(Math.ceil((se+s.da)*s.db),0),L=se=>{const me=n.getSource().minzoom,xe=Ee=>{const be=n.getTileByID(Ee);if(be&&be.hasData())return be.getBucket(x)},ye=[0,-1,1];for(const Ee of ye){if(se.overscaledZ+Ee<me)continue;const be=xe(se.calculateScaledKey(se.overscaledZ+Ee));if(be)return be}},z=[0,0,0],U=(se,me)=>(z[0]=Math.min(se.min.y,me.min.y),z[1]=Math.max(se.max.y,me.max.y),z[2]=s.ai-me.min.x>se.max.x?me.min.x-s.ai:se.max.x,z),V=(se,me)=>(z[0]=Math.min(se.min.x,me.min.x),z[1]=Math.max(se.max.x,me.max.x),z[2]=s.ai-me.min.y>se.max.y?me.min.y-s.ai:se.max.y,z),Y=[(se,me)=>U(se,me),(se,me)=>U(me,se),(se,me)=>V(se,me),(se,me)=>V(me,se)],te=(se,me,xe,ye,Ee,be,we)=>{if(!b)return 0;const Te=[[be?xe:se,be?se:xe,0],[be?xe:me,be?me:xe,0]],Pe=we<0?s.ai+we:we,Ne=[be?Pe:(se+me)/2,be?(se+me)/2:Pe,0];return xe===0&&we<0||xe!==0&&we>0?b.getForTilePoints(Ee,[Ne],!0,ye):Te.push(Ne),b.getForTilePoints(l,Te,!0,k),Math.max(Te[0][2],Te[1][2],Ne[2])/b.exaggeration()};for(let se=0;se<4;se++){const me=m.borderFeatureIndices[se];if(me.length===0)continue;const xe=s.d7[se](l),ye=L(xe);if(!(ye&&ye instanceof s.d8))continue;const Ee=b?b.findDEMTileFor(xe):null;if(!(Ee&&Ee.dem||T)||(b&&Ee&&Ee.dem&&m.borderDEMTileTimestamp[se]!==Ee.dem._timestamp&&(m.borderDoneWithNeighborZ[se]=-1,m.borderDEMTileTimestamp[se]=Ee.dem._timestamp),m.borderDoneWithNeighborZ[se]===ye.canonical.z))continue;ye.centroidVertexArray.length===0&&ye.createCentroidsBuffer();const be=(se<2?1:5)-se,we=ye.borderDoneWithNeighborZ[be]!==m.canonical.z,Te=ye.borderFeatureIndices[be];let Pe=0;if(m.canonical.z!==ye.canonical.z){for(const Ne of me)m.showCentroid(m.featuresOnBorder[Ne]);if(we)for(const Ne of Te)ye.showCentroid(ye.featuresOnBorder[Ne]);m.borderDoneWithNeighborZ[se]=ye.canonical.z,ye.borderDoneWithNeighborZ[be]=m.canonical.z}for(const Ne of me){const Ke=m.featuresOnBorder[Ne],$e=m.centroidData[Ke.centroidDataIndex],lt=Ke.borders[se];let dt;for(;Pe<Te.length;){dt=ye.featuresOnBorder[Te[Pe]];const vt=dt.borders[be];if(vt[1]>lt[0]+3||vt[0]>lt[0]-3)break;ye.showCentroid(dt),Pe++}if(dt&&Pe<Te.length){const vt=Pe;let Ue=0;for(;!(dt.borders[be][0]>lt[1]-3)&&(Ue++,++Pe!==Te.length);)dt=ye.featuresOnBorder[Te[Pe]];dt=ye.featuresOnBorder[Te[vt]];let at=!1;if(Ue>=1){const rt=dt.borders[be];Math.abs(lt[0]-rt[0])<3&&Math.abs(lt[1]-rt[1])<3&&(Ue=1,at=!0,Pe=vt+1)}else if(Ue===0){m.showCentroid(Ke);continue}const Fe=ye.centroidData[dt.centroidDataIndex];T&&at&&(((K=$e).flags|(ne=Fe).flags)&s.d9?(K.flags|=s.d9,ne.flags|=s.d9):(K.flags&=~s.d9,ne.flags&=~s.d9));const ot=Ke.intersectsCount()>1||dt.intersectsCount()>1;if(Ue>1)Pe=vt,$e.centroidXY=Fe.centroidXY=new s.P(0,0);else if(Ee&&Ee.dem&&!ot){const rt=Y[se]($e,Fe),ht=se%2?s.ai-1:0,Je=te(rt[0],Math.min(s.ai-1,rt[1]),ht,Ee,xe,se<2,rt[2]);$e.centroidXY=Fe.centroidXY=j(Je)}else ot?$e.centroidXY=Fe.centroidXY=new s.P(0,0):($e.centroidXY=m.encodeBorderCentroid(Ke),Fe.centroidXY=ye.encodeBorderCentroid(dt));m.writeCentroidToBuffer($e),ye.writeCentroidToBuffer(Fe)}else m.showCentroid(Ke)}m.borderDoneWithNeighborZ[se]=ye.canonical.z,ye.borderDoneWithNeighborZ[be]=m.canonical.z}var K,ne;(m.needsCentroidUpdate||!m.centroidVertexBuffer&&m.centroidVertexArray.length!==0)&&m.uploadCentroid(g)}const Yu=[1,0,0],Tt=[0,1,0],Ot=[0,0,1];function Xu(g,n,l){const m=l.transform,x=l.shadowRenderer;if(!x)return!0;const b=g.toUnwrapped(),T=m.tileSize*x._cascades[l.currentShadowCascade].scale;let k=n.maxHeight;if(m.elevation){const K=m.elevation.getMinMaxForTile(g);K&&(k+=K.max)}const j=[...x.shadowDirection];j[2]=-j[2];const L=x.computeSimplifiedTileShadowVolume(b,k,T,j);if(!L)return!1;const z=[Yu,Tt,Ot,j,[j[0],0,j[2]],[0,j[1],j[2]]],U=m.projection.name==="globe",V=m.scaleZoom(T),Y=s.bR.fromInvProjectionMatrix(m.invProjMatrix,m.worldSize,V,!U),te=x.getCurrentCascadeFrustum();return Y.intersectsPrecise(L.vertices,L.planes,z)===0||te.intersectsPrecise(L.vertices,L.planes,z)===0}function ii(g){return[g[0]*s.dc,g[1]*s.dc,g[2]*s.dc,0]}function We(g,n,l,m,x,b,T,k,j){const L=m.getSource(),z=l.globeSharedBuffers;if(!z)return;let U,V,Y;if(n&&(U=m.getTile(n)),L instanceof s.aK?(V=L.texture,Y=s.cJ(0,0,l.transform)):U&&n&&(V=U.texture,Y=s.cJ(n.canonical.z,n.canonical.x,l.transform)),!V||!Y)return;g||(Y=s.ad.mat4.scale(s.ad.mat4.create(),Y,[1,-1,1]));const te=l.context,K=te.gl,ne=x.paint.get("raster-resampling")==="nearest"?K.NEAREST:K.LINEAR,se=l.colorModeForDrapableLayerRenderPass(b),me=T.defines;me.push("GLOBE_POLES");const xe=new ir(K.LEQUAL,ir.ReadWrite,l.depthRangeFor3D),ye=Float32Array.from(l.transform.expandedFarZProjMatrix),Ee=Float32Array.from(s.bc(s.cI(new s.bT(0,0,0))));l.terrain&&l.terrain.prepareDrawTile(),te.activeTexture.set(K.TEXTURE0),V.bind(ne,K.CLAMP_TO_EDGE),te.activeTexture.set(K.TEXTURE1),V.bind(ne,K.CLAMP_TO_EDGE),"useMipmap"in V&&te.extTextureFilterAnisotropic&&l.transform.pitch>20&&K.texParameterf(K.TEXTURE_2D,te.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,te.extTextureFilterAnisotropicMax);const[be,we,Te,Pe]=n?z.getPoleBuffers(n.canonical.z,!1):z.getPoleBuffers(0,!0),Ne=x.paint.get("raster-elevation");let Ke;g?(Ke=be,l.renderDefaultNorthPole=Ne!==0):(Ke=we,l.renderDefaultSouthPole=Ne!==0);const $e=ii(T.mix),lt=((vt,Ue,at,Fe,ot,rt,ht,Je,mt,It,kt,Rt,Yt)=>k_(vt,Ue,at,new Float32Array(16),new Float32Array(9),[0,0],Fe,[0,0],[0,0,0,0],1,{opacity:1,mix:0},rt,[0,0],Je,2,It,kt,Rt,1,0,Yt))(ye,Ee,Y,s.ag(l.transform.zoom),0,x,0,Ne,0,$e,T.offset,T.range,b),dt=l.getOrCreateProgram("raster",{defines:me});l.uploadCommonUniforms(te,dt,null),dt.draw(l,K.TRIANGLES,xe,j,se,k,lt,x.id,Ke,Te,Pe)}function D0(g){const n=g._nearZ,l=g.projection.farthestPixelDistance(g),m=l-n,x=.2*g.height,b=n+x;return[n,l,(b-x-n)/m,(b-n)/m]}function Bp(g,n,l,m){if(g)return n instanceof ka&&g instanceof Us?n.getTextureDescriptor(g,l,!0):{texture:g.texture,mix:ii(m.mix),offset:m.offset,buffer:0,tileSize:1}}var B_=s.dd([{name:"a_index",type:"Int16",components:1}]);class V_{constructor(n,l,m,x){const b={width:m[0],height:m[1],data:null},T=n.gl;this.targetColorTexture=new s.T(n,b,T.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new s.T(n,b,T.RGBA8,{useMipmap:!1}),this.context=n,this.updateParticleTexture(l,x),this.lastInvalidatedAt=0}updateParticleTexture(n,l){if(this.particleTextureDimension===l.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const m=this.context.gl,x=l.width*l.height;this.particleTexture0=new s.T(this.context,l,m.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new s.T(this.context,l,m.RGBA8,{premultiply:!1,useMipmap:!1});const b=new s.de;b.reserve(x);for(let T=0;T<x;T++)b.emplaceBack(T);this.particleIndexBuffer=this.context.createVertexBuffer(b,B_.members,!0),this.particleSegment=s.b8.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=l.width}update(n){return!(this.lastInvalidatedAt<n&&(this.lastInvalidatedAt=s.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function L0(g,n,l){if(!g)return null;const m=n.getTextureDescriptor(g,l,!0);if(!m)return null;let{texture:x,mix:b,offset:T,tileSize:k,buffer:j,format:L}=m;if(!x||!L)return null;let z=!1;return L==="uint32"&&(z=!0,b[3]=0,b=zt(s.df,b,[0,l.paint.get("raster-particle-max-speed")]),T=I_(s.df,T,[0,l.paint.get("raster-particle-max-speed")])),{texture:x,textureOffset:[j/(k+2*j),k/(k+2*j)],tileSize:k,scalarData:z,scale:b,offset:T,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[L]]}}function O0(g){const n=g._nearZ,l=g.projection.farthestPixelDistance(g),m=l-n,x=.2*g.height,b=n+x;return[n,l,(b-x-n)/m,(b-n)/m]}const Ku=new s.al(1,0,0,1),ES=new s.al(0,1,0,1),CS=new s.al(0,0,1,1),z0=new s.al(1,0,1,1),Vp=new s.al(0,1,1,1);function ec(g,n,l,m,x,b,T){const k=g.context,j=g.transform,L=k.gl,z=j.projection.name==="globe",U=z?["PROJECTION_GLOBE_VIEW"]:[];let V=s.ad.mat4.clone(l.projMatrix);if(z&&s.ag(j.zoom)>0){const $e=s.bb(l.canonical,j),lt=s.dg($e);V=s.ad.mat4.multiply(new Float32Array(16),j.globeMatrix,lt),s.ad.mat4.multiply(V,j.projMatrix,V)}const Y=s.ad.mat4.create();Y[12]+=2*x/(s.q.devicePixelRatio*j.width),Y[13]+=2*b/(s.q.devicePixelRatio*j.height),s.ad.mat4.multiply(V,Y,V);const te=g.getOrCreateProgram("debug",{defines:U}),K=n.getTileByID(l.key);g.terrain&&g.terrain.setupElevationDraw(K,te);const ne=ir.disabled,se=Mr.disabled,me=g.colorModeForRenderPass(),xe="$debug";k.activeTexture.set(L.TEXTURE0),g.emptyTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),z?K._makeGlobeTileDebugBuffers(g.context,j):K._makeDebugTileBoundsBuffers(g.context,j.projection);const ye=K._tileDebugBuffer||g.debugBuffer,Ee=K._tileDebugIndexBuffer||g.debugIndexBuffer,be=K._tileDebugSegments||g.debugSegments;if(te.draw(g,L.LINE_STRIP,ne,se,me,vr.disabled,I0(V,m),xe,ye,Ee,be,null,null,null,[K._globeTileDebugBorderBuffer]),T){const $e=K.latestRawTileData,lt=Math.floor(($e&&$e.byteLength||0)/1024);let dt=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(dt+=` => ${l.overscaledZ}`),dt+=` ${K.state}`,dt+=` ${lt}kb`,function(vt,Ue){vt.initDebugOverlayCanvas();const at=vt.debugOverlayCanvas,Fe=vt.context.gl,ot=vt.debugOverlayCanvas.getContext("2d");ot.clearRect(0,0,at.width,at.height),ot.shadowColor="white",ot.shadowBlur=2,ot.lineWidth=1.5,ot.strokeStyle="white",ot.textBaseline="top",ot.font="bold 36px Open Sans, sans-serif",ot.fillText(Ue,5,5),ot.strokeText(Ue,5,5),vt.debugOverlayTexture.update(at),vt.debugOverlayTexture.bind(Fe.LINEAR,Fe.CLAMP_TO_EDGE)}(g,dt)}const we=n.getTile(l).tileSize,Te=512/Math.min(we,512)*(l.overscaledZ/j.zoom)*.5,Pe=K._tileDebugTextBuffer||g.debugBuffer,Ne=K._tileDebugTextIndexBuffer||g.quadTriangleIndexBuffer,Ke=K._tileDebugTextSegments||g.debugSegments;te.draw(g,L.TRIANGLES,ne,se,zr.alphaBlended,vr.disabled,I0(V,s.al.transparent,Te),xe,Pe,Ne,Ke,null,null,null,[K._globeTileDebugTextBuffer])}function U_(g,n,l,m){Fc(g,0,n+l/2,g.transform.width,l,m)}function $_(g,n,l,m){Fc(g,n-l/2,0,l,g.transform.height,m)}function Fc(g,n,l,m,x,b){const T=g.context,k=T.gl;k.enable(k.SCISSOR_TEST),k.scissor(n*s.q.devicePixelRatio,l*s.q.devicePixelRatio,m*s.q.devicePixelRatio,x*s.q.devicePixelRatio),T.clear({color:b}),k.disable(k.SCISSOR_TEST)}const Up=s.dd([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Ju}=Up;function cl(g,n,l,m){g.emplaceBack(n,l,m)}class F0{constructor(n){this.vertexArray=new s.dh,this.indices=new s.aV,cl(this.vertexArray,-1,-1,1),cl(this.vertexArray,1,-1,1),cl(this.vertexArray,-1,1,1),cl(this.vertexArray,1,1,1),cl(this.vertexArray,-1,-1,-1),cl(this.vertexArray,1,-1,-1),cl(this.vertexArray,-1,1,-1),cl(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,Ju),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=s.b8.simpleSegment(0,0,36,12)}}function es(g,n,l,m,x,b){const T=g.context.gl,k=n.paint.get("sky-atmosphere-color"),j=n.paint.get("sky-atmosphere-halo-color"),L=n.paint.get("sky-atmosphere-sun-intensity"),z=((U,V,Y,te,K)=>({u_matrix_3f:U,u_sun_direction:V,u_sun_intensity:Y,u_color_tint_r:[te.r,te.g,te.b,te.a],u_color_tint_m:[K.r,K.g,K.b,K.a],u_luminance:5e-5}))(s.ad.mat3.fromMat4(s.ad.mat3.create(),m),x,L,k,j);T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+b,n.skyboxTexture,0),l.draw(g,T.TRIANGLES,ir.disabled,Mr.disabled,zr.unblended,vr.frontCW,z,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const MS=s.dd([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class qh{constructor(n){const l=new s.di;l.emplaceBack(-1,1,1,0,0),l.emplaceBack(1,1,1,1,0),l.emplaceBack(1,-1,1,1,1),l.emplaceBack(-1,-1,1,0,1);const m=new s.aV;m.emplaceBack(0,1,2),m.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(l,MS.members),this.indexBuffer=n.createIndexBuffer(m),this.segments=s.b8.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Dn=s.dd([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class nn{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class B0{constructor(n){this.colorModeAlphaBlendedWriteRGB=new zr([1,Yl,1,Yl],s.al.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new zr([1,0,1,0],s.al.transparent,[!1,!1,!1,!0]),this.params=new nn,this.updateNeeded=!0,n.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),n.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),n.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),n.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(n){const l=n.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new qh(l);const m=this.params.sizeRange,x=this.params.intensityRange,b=function(z){const U=s.dl(30),V=[];for(let Y=0;Y<z;++Y){const te=2*Math.PI*U(),K=Math.acos(1-2*U())-.5*Math.PI;V.push(s.ad.vec3.fromValues(Math.cos(K)*Math.cos(te),Math.cos(K)*Math.sin(te),Math.sin(K)))}return V}(this.params.starsCount),T=s.dl(300),k=new s.dj,j=new s.aV;let L=0;for(let z=0;z<b.length;++z){const U=s.ad.vec3.scale([],b[z],200),V=Math.max(0,1+.01*m*(1*T()-.5)),Y=Math.max(0,1+.01*x*(1*T()-.5));k.emplaceBack(U[0],U[1],U[2],-1,-1,V,Y),k.emplaceBack(U[0],U[1],U[2],1,-1,V,Y),k.emplaceBack(U[0],U[1],U[2],1,1,V,Y),k.emplaceBack(U[0],U[1],U[2],-1,1,V,Y),j.emplaceBack(L+0,L+1,L+2),j.emplaceBack(L+0,L+2,L+3),L+=4}this.starsVx=l.createVertexBuffer(k,Dn.members),this.starsIdx=l.createIndexBuffer(j),this.starsSegments=s.b8.simpleSegment(0,0,k.length,j.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(n,l){const m=n.context,x=m.gl,b=n.transform,T=new ir(x.LEQUAL,ir.ReadOnly,[0,1]),k=s.ag(b.zoom),j=n.style.getLut(l.scope),L=l.properties.get("color-use-theme")==="none",z=l.properties.get("color").toRenderColor(L?null:j).toArray01(),U=l.properties.get("high-color-use-theme")==="none",V=l.properties.get("high-color").toRenderColor(U?null:j).toArray01(),Y=l.properties.get("space-color-use-theme")==="none",te=l.properties.get("space-color").toRenderColor(Y?null:j).toArray01PremultipliedAlpha(),K=5e-4,ne=s.dk(l.properties.get("horizon-blend"),0,1,K,.25),se=s.cD(n,m,b)&&ne===K?b.worldSize/(2*Math.PI*1.025)-1:b.globeRadius,me=n.frameCounter/1e3%1,xe=s.ad.vec3.length(b.globeCenterInViewSpace),ye=Math.sqrt(Math.pow(xe,2)-Math.pow(se,2)),Ee=Math.acos(ye/xe),be=we=>{const Te=b.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];we&&Te.push("ALPHA_PASS");const Pe=n.getOrCreateProgram("globeAtmosphere",{defines:Te}),Ne=(($e,lt,dt,vt,Ue,at,Fe,ot,rt,ht,Je,mt)=>({u_frustum_tl:$e,u_frustum_tr:lt,u_frustum_br:dt,u_frustum_bl:vt,u_horizon:Ue,u_transition:at,u_fadeout_range:Fe,u_color:ot,u_high_color:rt,u_space_color:ht,u_temporal_offset:Je,u_horizon_angle:mt}))(b.frustumCorners.TL,b.frustumCorners.TR,b.frustumCorners.BR,b.frustumCorners.BL,b.frustumCorners.horizon,k,ne,z,V,te,me,Ee);n.uploadCommonUniforms(m,Pe);const Ke=this.atmosphereBuffer;Ke&&Pe.draw(n,x.TRIANGLES,T,Mr.disabled,we?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,vr.backCW,Ne,we?"atmosphere_glow_alpha":"atmosphere_glow",Ke.vertexBuffer,Ke.indexBuffer,Ke.segments)};be(!1),be(!0)}drawStars(n,l){const m=s.ay(l.properties.get("star-intensity"),0,1);if(m===0)return;const x=n.context,b=x.gl,T=n.transform,k=n.getOrCreateProgram("stars"),j=s.ad.quat.identity([]);s.ad.quat.rotateX(j,j,-T._pitch),s.ad.quat.rotateZ(j,j,-T.angle),s.ad.quat.rotateX(j,j,s.ak(T._center.lat)),s.ad.quat.rotateY(j,j,-s.ak(T._center.lng));const L=s.ad.mat4.fromQuat(new Float32Array(16),j),z=s.ad.mat4.multiply([],T.starsProjMatrix,L),U=s.ad.mat3.fromMat4([],L),V=s.ad.mat3.invert([],U),Y=[0,1,0];s.ad.vec3.transformMat3(Y,Y,V),s.ad.vec3.scale(Y,Y,this.params.sizeMultiplier);const te=[1,0,0];s.ad.vec3.transformMat3(te,te,V),s.ad.vec3.scale(te,te,this.params.sizeMultiplier);const K=(ne=Y,se=te,me=m,{u_matrix:Float32Array.from(z),u_up:ne,u_right:se,u_intensity_multiplier:me});var ne,se,me;n.uploadCommonUniforms(x,k),this.starsVx&&this.starsIdx&&k.draw(n,b.TRIANGLES,ir.disabled,Mr.disabled,this.colorModeAlphaBlendedWriteRGB,vr.disabled,K,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function ul(g,n){const l=[...g],m=n.cameraWorldSizeForFog/n.worldSize,x=s.ad.mat4.identity([]);return s.ad.mat4.scale(x,x,[m,m,1]),s.ad.mat4.multiply(l,x,l),s.ad.mat4.multiply(l,n.worldToFogMatrix,l),l}function Qu(g,n,l,m,x){const b=l.material,T=m.context,{baseColorTexture:k,metallicRoughnessTexture:j}=b.pbrMetallicRoughness,{normalTexture:L,occlusionTexture:z,emissionTexture:U}=b;function V(te,K,ne){if(te&&(g.push(K),T.activeTexture.set(T.gl.TEXTURE0+ne),te.gfxTexture)){const{minFilter:se,magFilter:me,wrapS:xe,wrapT:ye}=te.sampler;te.gfxTexture.bindExtraParam(se,me,xe,ye)}}V(k,"HAS_TEXTURE_u_baseColorTexture",pi.BaseColor),V(j,"HAS_TEXTURE_u_metallicRoughnessTexture",pi.MetallicRoughness),V(L,"HAS_TEXTURE_u_normalTexture",pi.Normal),V(z,"HAS_TEXTURE_u_occlusionTexture",pi.Occlusion),V(U,"HAS_TEXTURE_u_emissionTexture",pi.Emission),x&&(x.texture||(x.texture=new s.dn(m.context,x.image,[x.image.height,x.image.height,x.image.height],T.gl.RGBA8)),T.activeTexture.set(T.gl.TEXTURE0+pi.LUT),x.texture&&x.texture.bind(T.gl.LINEAR,T.gl.CLAMP_TO_EDGE),g.push("APPLY_LUT_ON_GPU")),l.texcoordBuffer&&(g.push("HAS_ATTRIBUTE_a_uv_2f"),n.push(l.texcoordBuffer)),l.colorBuffer&&(g.push(l.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),n.push(l.colorBuffer)),l.normalBuffer&&(g.push("HAS_ATTRIBUTE_a_normal_3f"),n.push(l.normalBuffer)),l.pbrBuffer&&(g.push("HAS_ATTRIBUTE_a_pbr"),g.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),n.push(l.pbrBuffer)),b.alphaMode!=="OPAQUE"&&b.alphaMode!=="MASK"||g.push("UNPREMULT_TEXTURE_IN_SHADER"),b.defined||g.push("DIFFUSE_SHADED");const Y=m.shadowRenderer;Y&&(g.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Y.useNormalOffset&&g.push("NORMAL_OFFSET"))}function dl(g,n,l,m,x,b){const T=l.paint.get("model-opacity").constantOr(1),k=n.context,j=new ir(n.context.gl.LEQUAL,ir.ReadWrite,n.depthRangeFor3D),L=n.transform,z=g.mesh,U=z.material,V=U.pbrMetallicRoughness,Y=n.style.fog;let te;te=n.transform.projection.zAxisUnit==="pixels"?[...g.nodeModelMatrix]:s.ad.mat4.multiply([],m.zScaleMatrix,g.nodeModelMatrix),s.ad.mat4.multiply(te,m.negCameraPosMatrix,te);const K=s.ad.mat4.invert([],te);s.ad.mat4.transpose(K,K);const ne=l.paint.get("model-color-use-theme").constantOr("default")==="none",se=l.paint.get("model-emissive-strength").constantOr(0),me=j_(new Float32Array(g.worldViewProjection),new Float32Array(te),new Float32Array(K),null,n,T,V.baseColorFactor.toRenderColor(null),U.emissiveFactor,V.metallicFactor,V.roughnessFactor,U,se,l),xe={defines:[]},ye=[],Ee=n.shadowRenderer;Ee&&(Ee.useNormalOffset=!1),Qu(xe.defines,ye,z,n,ne?null:l.lut);let be=null;if(Y){const Pe=ul(g.nodeModelMatrix,n.transform);if(be=new Float32Array(Pe),L.projection.name!=="globe"){const Ne=z.aabb.min,Ke=z.aabb.max,[$e,lt]=Y.getOpacityForBounds(Pe,Ne[0],Ne[1],Ke[0],Ke[1]);xe.overrideFog=$e>=Lt||lt>=Lt}}const we=sl(n,l.paint.get("model-cutoff-fade-range"));we.shouldRenderCutoff&&xe.defines.push("RENDER_CUTOFF");const Te=n.getOrCreateProgram("model",xe);n.uploadCommonUniforms(k,Te,null,be,we),n.renderPass!=="shadow"&&Ee&&Ee.setupShadowsFromMatrix(g.nodeModelMatrix,Te),Te.draw(n,k.gl.TRIANGLES,j,x,b,z.material.doubleSided?vr.disabled:vr.backCCW,me,l.id,z.vertexBuffer,z.indexBuffer,z.segments,l.paint,n.transform.zoom,void 0,ye)}function Bc(g,n,l,m,x,b,T){let k;k=g.projection.name==="globe"?s.dp(l,g):[...l],s.ad.mat4.multiply(k,k,n.matrix);const j=s.ad.mat4.multiply([],m,k);if(n.meshes)for(const L of n.meshes){if(L.material.alphaMode!=="BLEND"){T.push({mesh:L,depth:0,modelIndex:x,worldViewProjection:j,nodeModelMatrix:k});continue}const z=s.ad.vec3.transformMat4([],L.centroid,j);!g.isOrthographic&&z[2]<=0||b.push({mesh:L,depth:z[2],modelIndex:x,worldViewProjection:j,nodeModelMatrix:k})}if(n.children)for(const L of n.children)Bc(g,L,l,m,x,b,T)}function Hh(g,n,l,m){const x=l.shadowRenderer;if(!x)return;const b=x.getShadowPassDepthMode(),T=x.getShadowPassColorMode(),k=x.calculateShadowPassMatrixFromMatrix(n),j=R0(k);l.getOrCreateProgram("modelDepth",{defines:l._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(l,l.context.gl.TRIANGLES,b,Mr.disabled,T,vr.backCCW,j,m.id,g.vertexBuffer,g.indexBuffer,g.segments,m.paint,l.transform.zoom,void 0,void 0)}function G_(g,n,l){const m=n.updateZoomBasedPaintProperties(),x=function(b,T,k){let j,L,z,U=b.terrain?b.terrain.exaggeration():0;if(b.terrain&&U>0){const V=b.terrain,Y=V.findDEMTileFor(k);Y&&Y.dem?j=s.dr.create(V,k,Y):U=0}if(U===0&&(T.terrainElevationMin=0,T.terrainElevationMax=0),U===T.validForExaggeration&&(U===0||j&&j._demTile&&j._demTile.tileID===T.validForDEMTile.id&&j._dem._timestamp===T.validForDEMTile.timestamp))return!1;for(const V in T.instancesPerModel){const Y=T.instancesPerModel[V];for(let te=0;te<Y.instancedDataArray.length;++te){const K=(j?U*j.getElevationAt(0|Y.instancedDataArray.float32[16*te],0|Y.instancedDataArray.float32[16*te+1],!0,!0):0)+Y.instancesEvaluatedElevation[te];Y.instancedDataArray.float32[16*te+6]=K,L=L?Math.min(T.terrainElevationMin,K):K,z=z?Math.max(T.terrainElevationMax,K):K}}return T.terrainElevationMin=L||0,T.terrainElevationMax=z||0,T.validForExaggeration=U,T.validForDEMTile=j&&j._demTile?{id:j._demTile.tileID,timestamp:j._dem._timestamp}:{id:void 0,timestamp:0},!0}(g,n,l);(m||x)&&(n.uploaded=!1,n.upload(g.context))}const Fo={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new s.ce([0,0,0],[s.ai,s.ai,0])};function q_(g,n){const l=1<<g.canonical.z,m=n.getFreeCameraOptions().position,x=n.elevation,b=g.canonical.x/l,T=(g.canonical.x+1)/l,k=g.canonical.y/l,j=(g.canonical.y+1)/l;let L=n._centerAltitude;if(x){const Y=x.getMinMaxForTile(g);Y&&Y.max>L&&(L=Y.max)}const z=s.ay(m.x,b,T)-m.x,U=s.ay(m.y,k,j)-m.y,V=s.bH(L,n.center.lat)-m.z;return n._zoomFromMercatorZ(Math.sqrt(z*z+U*U+V*V))}function ca(g,n,l,m,x,b,T){const k=g.context,j=g.renderPass==="shadow",L=g.shadowRenderer,z=j&&L?L.getShadowPassDepthMode():new ir(k.gl.LEQUAL,ir.ReadWrite,g.depthRangeFor3D),U=g.isTileAffectedByFog(b);if(l.meshes)for(const V of l.meshes){const Y=["MODEL_POSITION_ON_GPU"],te=[];let K,ne,se;m.instancedDataArray.length>20&&Y.push("INSTANCED_ARRAYS");const me=sl(g,n.paint.get("model-cutoff-fade-range"));if(me.shouldRenderCutoff&&Y.push("RENDER_CUTOFF"),j&&L)K=g.getOrCreateProgram("modelDepth",{defines:Y}),ne=R0(T.shadowTileMatrix,T.shadowTileMatrix,Float32Array.from(l.matrix)),se=L.getShadowPassColorMode();else{Qu(Y,te,V,g,n.paint.get("model-color-use-theme").constantOr("default")==="none"?null:n.lut),K=g.getOrCreateProgram("model",{defines:Y,overrideFog:U});const ye=V.material,Ee=ye.pbrMetallicRoughness,be=n.paint.get("model-opacity").constantOr(1),we=n.paint.get("model-emissive-strength").constantOr(0);ne=j_(b.expandedProjMatrix,Float32Array.from(l.matrix),new Float32Array(16),null,g,be,Ee.baseColorFactor.toRenderColor(null),ye.emissiveFactor,Ee.metallicFactor,Ee.roughnessFactor,ye,we,n,x),L&&(T.shadowUniformsInitialized?K.setShadowUniformValues(k,L.getShadowUniformValues()):(L.setupShadows(b.toUnwrapped(),K,"model-tile",b.overscaledZ),T.shadowUniformsInitialized=!0)),se=me.shouldRenderCutoff||be<1||ye.alphaMode!=="OPAQUE"?zr.alphaBlended:zr.unblended}g.uploadCommonUniforms(k,K,b.toUnwrapped(),null,me);const xe=V.material.doubleSided?vr.disabled:vr.backCCW;if(m.instancedDataArray.length>20)te.push(m.instancedDataBuffer),K.draw(g,k.gl.TRIANGLES,z,Mr.disabled,se,xe,ne,n.id,V.vertexBuffer,V.indexBuffer,V.segments,n.paint,g.transform.zoom,void 0,te,m.instancedDataArray.length);else{const ye=j?"u_instance":"u_normal_matrix";for(let Ee=0;Ee<m.instancedDataArray.length;++Ee)ne[ye]=new Float32Array(m.instancedDataArray.arrayBuffer,64*Ee,16),K.draw(g,k.gl.TRIANGLES,z,Mr.disabled,se,xe,ne,n.id,V.vertexBuffer,V.indexBuffer,V.segments,n.paint,g.transform.zoom,void 0,te)}}if(l.children)for(const V of l.children)ca(g,n,V,m,x,b,T)}const tc=[1,-1,1];function $p(g,n,l,m){if(!l.modelManager)return!0;const x=l.modelManager;if(!l.shadowRenderer)return!0;const b=l.shadowRenderer,T=n.aabb;let k=!0,j=g.maxHeight;if(j===0){let z=0;for(const U in g.instancesPerModel){const V=x.getModel(U,m);V?z=Math.max(z,Math.max(Math.max(V.aabb.max[0],V.aabb.max[1]),V.aabb.max[2])):k=!1}j=g.maxScale*z*1.41+g.maxVerticalOffset,k&&(g.maxHeight=j)}T.max[2]=j,T.min[2]+=g.terrainElevationMin,T.max[2]+=g.terrainElevationMax,s.ad.vec3.transformMat4(T.min,T.min,n.tileMatrix),s.ad.vec3.transformMat4(T.max,T.max,n.tileMatrix);const L=T.intersects(b.getCurrentCascadeFrustum());return l.currentShadowCascade===0&&(g.isInsideFirstShadowMapFrustum=L===2),L===0}function Gp(g,n){const l=g.uniformValues.u_cutoff_params[0],m=g.uniformValues.u_cutoff_params[1],x=g.uniformValues.u_cutoff_params[2],b=g.uniformValues.u_cutoff_params[3];return m===l||b===x?1:s.ay(((n-l)/(m-l)-x)/(b-x),0,1)}function H_(g,n,l,m){if(n.pitch<20)return 1;const x=n.getWorldToCameraMatrix();s.ad.mat4.multiply(x,x,g);const b=s.ad.vec4.fromValues(l.min[0],l.min[1],l.min[2],1);let T=s.ad.vec4.transformMat4(s.ad.vec4.create(),b,x),k=T,j=T;b[1]=l.max[1],T=s.ad.vec4.transformMat4(s.ad.vec4.create(),b,x),k=T[1]<k[1]?T:k,j=T[1]>j[1]?T:j,b[0]=l.max[0],T=s.ad.vec4.transformMat4(s.ad.vec4.create(),b,x),k=T[1]<k[1]?T:k,j=T[1]>j[1]?T:j,b[1]=l.min[1],T=s.ad.vec4.transformMat4(s.ad.vec4.create(),b,x),k=T[1]<k[1]?T:k,j=T[1]>j[1]?T:j;const L=s.ay(m[0],0,1),z=100*n.pixelsPerMeter*s.ay(m[1],0,1),U=s.ay(m[2],0,1),V=s.ad.vec4.lerp(s.ad.vec4.create(),k,j,L),Y=Math.tan(.5*n.fovX),te=-V[2]*Y;if(z===0)return V[1]<-Math.abs(te)?U:1;const K=(-Math.abs(te)-V[1])/z,ne=(me,xe,ye)=>(1-ye)*me+ye*xe,se=s.ay(ne(1,U,K),U,1);return ne(1,se,s.ay((n.pitch-20)/20,0,1))}class W_{}class Vc{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(n,l,m){{const U=this._storage.get(l.id);if(U)return U.lastUsedFrameIdx=n,U.buf}const x=m.gl,b=x.getBufferParameter(x.ELEMENT_ARRAY_BUFFER,x.BUFFER_SIZE),T=new ArrayBuffer(b),k=new Int16Array(T);x.getBufferSubData(x.ELEMENT_ARRAY_BUFFER,0,new Int16Array(T));const j=new s.dt;for(let U=0;U<b/2;U+=3){const V=k[U],Y=k[U+1],te=k[U+2];j.emplaceBack(V,Y),j.emplaceBack(Y,te),j.emplaceBack(te,V)}const L=m.bindVertexArrayOES.current,z=new W_;return z.buf=new ja(m,j),z.lastUsedFrameIdx=n,this._storage.set(l.id,z),m.bindVertexArrayOES.set(L),z.buf}update(n){for(const[l,m]of this._storage)n-m.lastUsedFrameIdx>30&&(m.buf.destroy(),this._storage.delete(l))}destroy(){for(const[n,l]of this._storage)l.buf.destroy(),this._storage.delete(n)}}class Z_{constructor(n){this.occluderSize=30,this.depthOffset=-1e-4,n.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),n.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const rc=s.dd([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Y_{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Wh{constructor(n,l){this.revealStart=11,this.revealRange=2,n.registerParameter(this,[...l,"Reveal"],"revealStart",{min:0,max:17,step:.05}),n.registerParameter(this,[...l,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const X_=s.dd([{type:"Float32",name:"a_pos_2f",components:2}]);class K_{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(n,l){const m=n.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const T=new s.du,k=new s.aV;T.emplaceBack(-1,-1),T.emplaceBack(1,-1),T.emplaceBack(1,1),T.emplaceBack(-1,1),k.emplaceBack(0,1,2),k.emplaceBack(0,2,3),this.vignetteVx=n.context.createVertexBuffer(T,X_.members),this.vignetteIdx=n.context.createIndexBuffer(k)}const x=s.b8.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){n.uploadCommonUniforms(n.context,m);const T={u_vignetteShape:(b={vignetteShape:[l.start,l.range,Math.pow(10,l.fadePower)],vignetteColor:[l.color.r,l.color.g,l.color.b,l.color.a*l.strength]}).vignetteShape,u_vignetteColor:b.vignetteColor};m.draw(n,n.context.gl.TRIANGLES,ir.disabled,Mr.disabled,zr.alphaBlended,vr.disabled,T,"vignette",this.vignetteVx,this.vignetteIdx,x)}var b}}class ls{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(n,l){const m=n.getFreeCameraOptions().position,x=m.toAltitude(),b=m.toLngLat(),T=s.ak(b.lng),k=s.ak(b.lat),j=n.pixelsPerMeter/l,L=T*s.dv,z=s.dv*Math.log(Math.tan(Math.PI/4+k/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const U=-this._offsetYPrev+z,V=-this._elevationPrev+x;this._accumulatedOffsetX+=(-this._offsetXPrev+L)*j,this._accumulatedOffsetY+=U*j,this._accumulatedElevation+=V*j,this._offsetXPrev=L,this._offsetYPrev=z,this._elevationPrev=x}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function qp(g,n){return[-(g[0]-Math.floor(g[0]/n)*n),-(g[1]-Math.floor(g[1]/n)*n),-(g[2]-Math.floor(g[2]/n)*n)]}function Hp(g){const n=s.dl(1323123451230),l=[];for(let m=0;m<g;++m){const x=2*n()-1,b=2*n()-1,T=2*n()-1;l.push(s.ad.vec3.fromValues(x,b,T))}return l}function Xs(g,n,l,m,x){const b=s.ay((x-l)/(m-l),0,1);return(1-b)*g+b*n}class Wp{constructor(n){this._movement=new ls,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new K_,this._ppmScaleFactor=n}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(n,l){const m=n.transform;this._movement.update(m,this._ppmScaleFactor);const x=m.starsProjMatrix,b=s.ad.quat.identity([]);s.ad.quat.rotateX(b,b,s.ak(90)-m._pitch),s.ad.quat.rotateZ(b,b,-m.angle);const T=s.ad.mat4.fromQuat(new Float32Array(16),b),k=s.ad.mat4.fromValues(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),j=s.ad.mat4.transpose([],k),L=s.ad.mat4.multiply([],j,T),z=Date.now()/1e3;return this._accumulatedTimeFromStart+=(z-this._prevTime)*l,this._prevTime=z,{projectionMatrix:x,modelviewMatrix:L}}}class J_ extends Wp{constructor(n){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Wh(n.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(n){const l=n.context;if(!this.particlesVx){const m=Hp(this.particlesCount),x=new s.dw,b=new s.aV;let T=0;const k=s.dl(1323123451230);for(let j=0;j<m.length;++j){const L=m[j],z=[2*k()-1,k(),k(),k()];x.emplaceBack(L[0],L[1],L[2],-1,-1,...z),x.emplaceBack(L[0],L[1],L[2],1,-1,...z),x.emplaceBack(L[0],L[1],L[2],1,1,...z),x.emplaceBack(L[0],L[1],L[2],-1,1,...z),b.emplaceBack(T+0,T+1,T+2),b.emplaceBack(T+0,T+2,T+3),T+=4}this.particlesVx=l.createVertexBuffer(x,rc.members),this.particlesIdx=l.createIndexBuffer(b)}}draw(n){if(!this._params.overrideStyleParameters&&!n.style.rain)return;const l=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},m=n.transform.zoom;if(l.revealStart>m)return;const x=Xs(0,1,l.revealStart,l.revealStart+l.revealRange,m);if(!this.particlesVx||!this.particlesIdx)return;const b=structuredClone(this._params);let T=[-b.direction.x,b.direction.y,-100];s.ad.vec3.normalize(T,T);const k=structuredClone(this._vignetteParams);k.strength*=x,b.overrideStyleParameters||(b.intensity=n.style.rain.state.density,b.timeFactor=n.style.rain.state.intensity,b.color=structuredClone(n.style.rain.state.color),T=structuredClone(n.style.rain.state.direction),b.screenThinning.intensity=n.style.rain.state.centerThinning,b.dropletSizeX=n.style.rain.state.dropletSize[0],b.dropletSizeYScale=n.style.rain.state.dropletSize[1]/n.style.rain.state.dropletSize[0],b.distortionStrength=100*n.style.rain.state.distortionStrength,k.strength=1,k.color=structuredClone(n.style.rain.state.vignetteColor));const j=this.updateOnRender(n,b.timeFactor),L=n.context,z=L.gl,U=n.transform;this.screenTexture&&this.screenTexture.size[0]===n.width&&this.screenTexture.size[1]===n.height||(this.screenTexture=new s.T(L,{width:n.width,height:n.height,data:null},z.RGBA8)),b.distortionStrength>0&&(L.activeTexture.set(z.TEXTURE0),this.screenTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),z.copyTexSubImage2D(z.TEXTURE_2D,0,0,0,0,0,n.width,n.height));const V=n.getOrCreateProgram("rainParticle");n.uploadCommonUniforms(L,V),L.activeTexture.set(z.TEXTURE0),this.screenTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE);const Y=[b.color.r,b.color.g,b.color.b,b.color.a],te=(K,ne)=>{const se=qp(this._movement.getPosition(),K),me=b.dropletSizeX,xe=b.dropletSizeX*b.dropletSizeYScale,ye=n.width/2,Ee=n.height/2,be=Xs(0,b.screenThinning.start,0,1,b.screenThinning.intensity),we=Xs(.001,b.screenThinning.range,0,1,b.screenThinning.intensity),Te=Xs(0,b.screenThinning.particleOffset,0,1,b.screenThinning.intensity),Pe=(Ne={modelview:j.modelviewMatrix,projection:j.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:se,velocityConeAperture:b.velocityConeAperture,velocity:b.velocity,boxSize:K,rainDropletSize:[me,xe],distortionStrength:b.distortionStrength,rainDirection:T,color:Y,screenSize:[U.width,U.height],thinningCenterPos:[ye,Ee],thinningShape:[be,we,Math.pow(10,b.screenThinning.fadePower)],thinningAffectedRatio:b.screenThinning.affectedRatio,thinningParticleOffset:Te,shapeDirectionalPower:b.shapeDirPower,shapeNormalPower:b.shapeNormalPower,mode:ne?0:1},{u_modelview:Float32Array.from(Ne.modelview),u_projection:Float32Array.from(Ne.projection),u_time:Ne.time,u_cam_pos:Ne.camPos,u_texScreen:0,u_velocityConeAperture:Ne.velocityConeAperture,u_velocity:Ne.velocity,u_boxSize:Ne.boxSize,u_rainDropletSize:Ne.rainDropletSize,u_distortionStrength:Ne.distortionStrength,u_rainDirection:Ne.rainDirection,u_color:Ne.color,u_screenSize:Ne.screenSize,u_thinningCenterPos:Ne.thinningCenterPos,u_thinningShape:Ne.thinningShape,u_thinningAffectedRatio:Ne.thinningAffectedRatio,u_thinningParticleOffset:Ne.thinningParticleOffset,u_shapeDirectionalPower:Ne.shapeDirectionalPower,u_shapeNormalPower:Ne.shapeNormalPower,u_mode:Ne.mode});var Ne;const Ke=Math.round(b.intensity*this.particlesCount),$e=s.b8.simpleSegment(0,0,4*Ke,2*Ke);V.draw(n,z.TRIANGLES,ir.disabled,Mr.disabled,zr.alphaBlended,vr.disabled,Pe,"rain_particles",this.particlesVx,this.particlesIdx,$e)};b.distortionStrength>0&&te(b.boxSize,!0),te(b.boxSize,!1),this._vignette.draw(n,k)}}const Q_=s.dd([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class ed extends Wp{constructor(n){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Wh(n.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(n){const l=n.context;if(!this.particlesVx){const m=Hp(this.particlesCount),x=new s.dx,b=new s.aV;let T=0;const k=s.dl(1323123451230);for(let j=0;j<m.length;++j){const L=m[j],z=k(),U=k(),V=k(),Y=[j/m.length,z,U,V],te=[k(),k()];x.emplaceBack(L[0],L[1],L[2],-1,-1,...Y,...te),x.emplaceBack(L[0],L[1],L[2],1,-1,...Y,...te),x.emplaceBack(L[0],L[1],L[2],1,1,...Y,...te),x.emplaceBack(L[0],L[1],L[2],-1,1,...Y,...te),b.emplaceBack(T+0,T+1,T+2),b.emplaceBack(T+0,T+2,T+3),T+=4}this.particlesVx=l.createVertexBuffer(x,Q_.members),this.particlesIdx=l.createIndexBuffer(b)}}draw(n){if(!this._params.overrideStyleParameters&&!n.style.snow)return;const l=structuredClone(this._params);let m=[-l.direction.x,l.direction.y,-100];s.ad.vec3.normalize(m,m);const x=structuredClone(this._vignetteParams),b=l.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},T=n.transform.zoom;if(b.revealStart>T)return;const k=Xs(0,1,b.revealStart,b.revealStart+b.revealRange,T);x.strength*=k,l.overrideStyleParameters||(l.intensity=n.style.snow.state.density,l.timeFactor=n.style.snow.state.intensity,l.color=structuredClone(n.style.snow.state.color),m=structuredClone(n.style.snow.state.direction),l.screenThinning.intensity=n.style.snow.state.centerThinning,l.billboardSize=2.79*n.style.snow.state.flakeSize,x.strength=1,x.color=structuredClone(n.style.snow.state.vignetteColor));const j=this.updateOnRender(n,l.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const L=n.context,z=L.gl,U=n.transform,V=n.getOrCreateProgram("snowParticle");n.uploadCommonUniforms(L,V),((Y,te,K)=>{const ne=qp(this._movement.getPosition(),Y),se=U.width/2,me=U.height/2,xe=Xs(0,K.screenThinning.start,0,1,K.screenThinning.intensity),ye=Xs(.001,K.screenThinning.range,0,1,K.screenThinning.intensity),Ee=Xs(0,K.screenThinning.particleOffset,0,1,K.screenThinning.intensity),be=(we={modelview:j.modelviewMatrix,projection:j.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ne,velocityConeAperture:K.velocityConeAperture,velocity:K.velocity,horizontalOscillationRadius:K.horizontalOscillationRadius,horizontalOscillationRate:K.horizontalOscillationRate,boxSize:Y,billboardSize:1*K.billboardSize,simpleShapeParameters:[K.shapeFadeStart,K.shapeFadePower],screenSize:[U.width,U.height],thinningCenterPos:[se,me],thinningShape:[xe,ye,Math.pow(10,K.screenThinning.fadePower)],thinningAffectedRatio:K.screenThinning.affectedRatio,thinningParticleOffset:Ee,color:[K.color.r,K.color.g,K.color.b,K.color.a],direction:m},{u_modelview:Float32Array.from(we.modelview),u_projection:Float32Array.from(we.projection),u_time:we.time,u_cam_pos:we.camPos,u_velocityConeAperture:we.velocityConeAperture,u_velocity:we.velocity,u_horizontalOscillationRadius:we.horizontalOscillationRadius,u_horizontalOscillationRate:we.horizontalOscillationRate,u_boxSize:we.boxSize,u_billboardSize:we.billboardSize,u_simpleShapeParameters:we.simpleShapeParameters,u_screenSize:we.screenSize,u_thinningCenterPos:we.thinningCenterPos,u_thinningShape:we.thinningShape,u_thinningAffectedRatio:we.thinningAffectedRatio,u_thinningParticleOffset:we.thinningParticleOffset,u_particleColor:we.color,u_direction:we.direction});var we;const Te=Math.round(K.intensity*this.particlesCount),Pe=s.b8.simpleSegment(0,0,4*Te,2*Te);this.particlesVx&&this.particlesIdx&&V.draw(n,z.TRIANGLES,ir.disabled,Mr.disabled,zr.alphaBlended,vr.disabled,be,"snow_particles",this.particlesVx,this.particlesIdx,Pe)})(l.boxSize,0,l),this._vignette.draw(n,x)}}const Zh={symbol:function(g,n,l,m,x){if(g.renderPass!=="translucent")return;const b=Mr.disabled,T=g.colorModeForRenderPass(),k=l.layout.get("text-variable-anchor"),j=l.layout.get("text-size-scale-range"),L=s.ay(g.scaleFactor,j[0],j[1]);k&&function(V,Y,te,K,ne,se,me,xe){const ye=Y.transform,Ee=ne==="map",be=se==="map";for(const we of V){const Te=K.getTile(we),Pe=Te.getBucket(te);if(!Pe||!Pe.text||!Pe.text.segments.get().length)continue;const Ne=s.bp(Pe.textSizeData,ye.zoom,xe),Ke=fo(we,Pe.getProjection(),ye),$e=ye.calculatePixelsToTileUnitsMatrix(Te),lt=el(Ke,Te.tileID.canonical,be,Ee,ye,Pe.getProjection(),$e),dt=Pe.hasIconTextFit()&&Pe.hasIconData();if(Ne){const vt=Math.pow(2,ye.zoom-Te.tileID.overscaledZ);zo(Pe,Ee,be,me,s.cY,ye,lt,we,vt,Ne,dt)}}}(m,g,l,n,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),x,L);const z=l.paint.get("icon-opacity").constantOr(1)!==0,U=l.paint.get("text-opacity").constantOr(1)!==0;l.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(z||U)?kn(g,n,l,m,b,T):(z&&kn(g,n,l,m,b,T,{onlyIcons:!0}),U&&kn(g,n,l,m,b,T,{onlyText:!0})),n.map.showCollisionBoxes&&(Op(g,n,l,m,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),Op(g,n,l,m,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(g,n,l,m){if(g.renderPass!=="translucent")return;const x=l.paint.get("circle-opacity"),b=l.paint.get("circle-stroke-width"),T=l.paint.get("circle-stroke-opacity"),k=l.layout.get("circle-sort-key").constantOr(1)!==void 0,j=l.paint.get("circle-emissive-strength");if(x.constantOr(1)===0&&(b.constantOr(1)===0||T.constantOr(1)===0))return;const L=g.context,z=L.gl,U=g.transform,V=g.depthModeForSublayer(0,ir.ReadOnly),Y=Mr.disabled,te=g.colorModeForDrapableLayerRenderPass(j),K=U.projection.name==="globe",ne=[s.av(U.center.lng),s.aC(U.center.lat)],se=[];for(let xe=0;xe<m.length;xe++){const ye=m[xe],Ee=n.getTile(ye),be=Ee.getBucket(l);if(!be||be.projection.name!==U.projection.name)continue;const we=be.programConfigurations.get(l.id),Te=s.cZ(l),Pe=g.isTileAffectedByFog(ye);K&&Te.push("PROJECTION_GLOBE_VIEW"),Te.push("DEPTH_D24"),g.terrain&&U.depthOcclusionForSymbolsAndCircles&&Te.push("DEPTH_OCCLUSION");const Ne=g.getOrCreateProgram("circle",{config:we,defines:Te,overrideFog:Pe}),Ke=be.layoutVertexBuffer,$e=be.globeExtVertexBuffer,lt=be.indexBuffer,dt=U.projection.createInversionMatrix(U,ye.canonical),vt={programConfiguration:we,program:Ne,layoutVertexBuffer:Ke,globeExtVertexBuffer:$e,indexBuffer:lt,uniformValues:s.c_(g,ye,Ee,dt,ne,l),tile:Ee};if(k){const Ue=be.segments.get();for(const at of Ue)se.push({segments:new s.b8([at]),sortKey:at.sortKey,state:vt})}else se.push({segments:be.segments,sortKey:0,state:vt})}k&&se.sort((xe,ye)=>xe.sortKey-ye.sortKey);const me={useDepthForOcclusion:U.depthOcclusionForSymbolsAndCircles};for(const xe of se){const{programConfiguration:ye,program:Ee,layoutVertexBuffer:be,globeExtVertexBuffer:we,indexBuffer:Te,uniformValues:Pe,tile:Ne}=xe.state,Ke=xe.segments;g.terrain&&g.terrain.setupElevationDraw(Ne,Ee,me),g.uploadCommonUniforms(L,Ee,Ne.tileID.toUnwrapped()),Ee.draw(g,z.TRIANGLES,V,Y,te,vr.disabled,Pe,l.id,be,Te,Ke,l.paint,U.zoom,ye,[we])}},heatmap:function(g,n,l,m){if(l.paint.get("heatmap-opacity")!==0)if(g.renderPass==="offscreen"){const x=g.context,b=x.gl,T=Mr.disabled,k=new zr([b.ONE,b.ONE,b.ONE,b.ONE],s.al.transparent,[!0,!0,!0,!0]);(function(Y,te,K,ne){const se=Y.gl,me=te.width*ne,xe=te.height*ne;Y.activeTexture.set(se.TEXTURE1),Y.viewport.set([0,0,me,xe]);let ye=K.heatmapFbo;if(!ye||ye&&(ye.width!==me||ye.height!==xe)){ye&&ye.destroy();const Ee=se.createTexture();se.bindTexture(se.TEXTURE_2D,Ee),se.texParameteri(se.TEXTURE_2D,se.TEXTURE_WRAP_S,se.CLAMP_TO_EDGE),se.texParameteri(se.TEXTURE_2D,se.TEXTURE_WRAP_T,se.CLAMP_TO_EDGE),se.texParameteri(se.TEXTURE_2D,se.TEXTURE_MIN_FILTER,se.LINEAR),se.texParameteri(se.TEXTURE_2D,se.TEXTURE_MAG_FILTER,se.LINEAR),ye=K.heatmapFbo=Y.createFramebuffer(me,xe,!0,null),function(be,we,Te,Pe,Ne,Ke){const $e=be.gl;$e.texImage2D($e.TEXTURE_2D,0,be.extRenderToTextureHalfFloat?$e.RGBA16F:$e.RGBA,Ne,Ke,0,$e.RGBA,be.extRenderToTextureHalfFloat?$e.HALF_FLOAT:$e.UNSIGNED_BYTE,null),Pe.colorAttachment.set(Te)}(Y,0,Ee,ye,me,xe)}else se.bindTexture(se.TEXTURE_2D,ye.colorAttachment.get()),Y.bindFramebuffer.set(ye.framebuffer)})(x,g,l,g.transform.projection.name==="globe"?.5:.25),x.clear({color:s.al.transparent});const j=g.transform,L=j.projection.name==="globe",z=L?["PROJECTION_GLOBE_VIEW"]:[],U=L?vr.frontCCW:vr.disabled,V=[s.av(j.center.lng),s.aC(j.center.lat)];for(let Y=0;Y<m.length;Y++){const te=m[Y];if(n.hasRenderableParent(te))continue;const K=n.getTile(te),ne=K.getBucket(l);if(!ne||ne.projection.name!==j.projection.name)continue;const se=g.isTileAffectedByFog(te),me=ne.programConfigurations.get(l.id),xe=g.getOrCreateProgram("heatmap",{config:me,defines:z,overrideFog:se}),{zoom:ye}=g.transform;g.terrain&&g.terrain.setupElevationDraw(K,xe),g.uploadCommonUniforms(x,xe,te.toUnwrapped());const Ee=j.projection.createInversionMatrix(j,te.canonical);xe.draw(g,b.TRIANGLES,ir.disabled,T,k,U,jp(g,te,K,Ee,V,ye,l.paint.get("heatmap-intensity")),l.id,ne.layoutVertexBuffer,ne.indexBuffer,ne.segments,l.paint,g.transform.zoom,me,L?[ne.globeExtVertexBuffer]:null)}x.viewport.set([0,0,g.width,g.height])}else g.renderPass==="translucent"&&(g.context.setColorMode(g.colorModeForRenderPass()),function(x,b){const T=x.context,k=T.gl,j=b.heatmapFbo;if(!j)return;T.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,j.colorAttachment.get()),T.activeTexture.set(k.TEXTURE1);let L=b.colorRampTexture;L||(L=b.colorRampTexture=new s.T(T,b.colorRamp,k.RGBA8)),L.bind(k.LINEAR,k.CLAMP_TO_EDGE),x.getOrCreateProgram("heatmapTexture").draw(x,k.TRIANGLES,ir.disabled,Mr.disabled,x.colorModeForRenderPass(),vr.disabled,((z,U,V,Y)=>({u_image:0,u_color_ramp:1,u_opacity:U.paint.get("heatmap-opacity")}))(0,b),b.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,b.paint,x.transform.zoom)}(g,l))},line:function(g,n,l,m){if(g.renderPass!=="translucent")return;const x=l.paint.get("line-opacity"),b=l.paint.get("line-width");if(x.constantOr(1)===0||b.constantOr(1)===0)return;const T=l.paint.get("line-emissive-strength"),k=l.paint.get("line-occlusion-opacity"),j=l.layout.get("line-elevation-reference"),L=l.layout.get("line-width-unit")==="meters",z=j==="sea",U=g.context,V=U.gl;if(l.hasElevatedBuckets&&g.transform.projection.name==="globe")return;const Y=l.layout.get("line-cross-slope"),te=Y!==void 0,K=Y<1,ne=g.colorModeForDrapableLayerRenderPass(T),se=g.terrain&&g.terrain.renderingToTexture,me=se?1:s.q.devicePixelRatio,xe=l.paint.get("line-dasharray"),ye=xe.constantOr(1),Ee=l.layout.get("line-cap"),be=xe.constantOr(null),we=Ee.constantOr(null),Te=l.paint.get("line-pattern"),Pe=Te.constantOr(1),Ne=Te.constantOr(null),Ke=l.paint.get("line-opacity").constantOr(1);let $e=!Pe&&Ke!==1||g.depthOcclusion&&k>0&&k<1;const lt=l.paint.get("line-gradient"),dt=Pe?"linePattern":"line",vt=s.c$(l);let Ue;if(se&&g.terrain&&g.terrain.clipOrMaskOverlapStencilType()&&($e=!1),k!==0&&g.depthOcclusion){const Fe=l.paint._values["line-opacity"];Fe&&Fe.value&&Fe.value.kind==="constant"?Ue=Fe.value:s.w(`Occlusion opacity for layer ${l.id} is supported only when line-opacity isn't data-driven.`)}b.value.kind!=="constant"&&b.value.isLineProgressConstant===!1&&vt.push("VARIABLE_LINE_WIDTH");const at=(Fe,ot,rt,ht,Je,mt)=>{for(const It of Fe){const kt=n.getTile(It);if(Pe&&!kt.patternsLoaded())continue;const Rt=kt.getBucket(l);if(!Rt||Rt.hasZOffset&&!Je||!Rt.hasZOffset&&Je)continue;g.prepareDrawTile();const Yt=Rt.programConfigurations.get(l.id),Tr=g.isTileAffectedByFog(It),cr=g.getOrCreateProgram(dt,{config:Yt,defines:ot,overrideFog:Tr,overrideRtt:!Je&&void 0});if(Ne&&kt.imageAtlas){const Ar=s.d0.from(Ne).getPrimary().scaleSelf(me).toString(),Xt=kt.imageAtlas.patternPositions.get(Ar);Xt&&Yt.setConstantPatternPositions(Xt)}if(!Pe&&be&&we&&kt.lineAtlas){const Ar=kt.lineAtlas.getDash(be,we);Ar&&Yt.setConstantPatternPositions(Ar)}let[yr,pr]=l.paint.get("line-trim-offset");(we==="round"||we==="square")&&yr!==pr&&(yr===0&&(yr-=1),pr===1&&(pr+=1));const Gr=se?It.projMatrix:null,on=L?1/Rt.tileToMeter/s.at(kt,1,g.transform.zoom):1,Rn=L?1/Rt.tileToMeter/s.at(kt,1,Math.floor(g.transform.zoom)):1,Lr=Pe?s.d1(g,kt,l,Gr,me,on,Rn,[yr,pr]):s.d2(g,kt,l,Gr,Rt.lineClipsArray.length,me,on,Rn,[yr,pr]);if(lt){const Ar=Rt.gradients[l.id];let Xt=Ar.texture;if(l.gradientVersion!==Ar.version){let Hr=256;if(l.stepInterpolant){const yn=n.getSource().maxzoom,Qr=It.canonical.z===yn?Math.ceil(1<<g.transform.maxZoom-It.canonical.z):1;Hr=s.ay(s.d3(Rt.maxLineLength/s.ai*1024*Qr),256,U.maxTextureSize)}Ar.gradient=s.d4({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:Hr,image:Ar.gradient||void 0,clips:Rt.lineClipsArray}),Ar.texture?Ar.texture.update(Ar.gradient):Ar.texture=new s.T(U,Ar.gradient,V.RGBA8),Ar.version=l.gradientVersion,Xt=Ar.texture}U.activeTexture.set(V.TEXTURE1),Xt.bind(l.stepInterpolant?V.NEAREST:V.LINEAR,V.CLAMP_TO_EDGE)}ye&&(U.activeTexture.set(V.TEXTURE0),kt.lineAtlasTexture&&kt.lineAtlasTexture.bind(V.LINEAR,V.REPEAT),Yt.updatePaintBuffers()),Pe&&(U.activeTexture.set(V.TEXTURE0),kt.imageAtlasTexture&&kt.imageAtlasTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),Yt.updatePaintBuffers()),Je&&!z&&g.terrain.setupElevationDraw(kt,cr),g.uploadCommonUniforms(U,cr,It.toUnwrapped());const Wn=Ar=>{Ue!=null&&(Ue.value=Ke*k),cr.draw(g,V.TRIANGLES,rt,Ar,ne,vr.disabled,Lr,l.id,Rt.layoutVertexBuffer,Rt.indexBuffer,Rt.segments,l.paint,g.transform.zoom,Yt,[Rt.layoutVertexBuffer2,Rt.patternVertexBuffer,Rt.zOffsetVertexBuffer]),Ue!=null&&(Ue.value=Ke)};if($e&&!Je){const Ar=g.stencilModeForClipping(It).ref;Ar===0&&se&&U.clear({stencil:0});const Xt={func:V.EQUAL,mask:255};Lr.u_alpha_discard_threshold=.8,Wn(new Mr(Xt,Ar,255,V.KEEP,V.KEEP,V.INVERT)),Lr.u_alpha_discard_threshold=0,Wn(new Mr(Xt,Ar,255,V.KEEP,V.KEEP,V.KEEP))}else Lr.u_alpha_discard_threshold=$e&&Je&&mt?.8:0,Wn(Je?ht:g.stencilModeForClipping(It))}};if(l.hasNonElevatedBuckets){const Fe=!se&&g.terrain;k!==0&&Fe?s.w(`Occlusion opacity for layer ${l.id} is supported on terrain only if the layer has line-z-offset enabled.`):Fe?s.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${l.id}.`):at(m,vt,g.depthModeForSublayer(0,ir.ReadOnly),Mr.disabled,!1,!0)}if(l.hasElevatedBuckets){vt.push("ELEVATED"),te&&vt.push(K?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),z&&vt.push("ELEVATION_REFERENCE_SEA");const Fe=$e?g.stencilModeFor3D():Mr.disabled,ot=new ir(g.depthOcclusion?V.GREATER:V.LEQUAL,ir.ReadOnly,g.depthRangeFor3D);g.forceTerrainMode=!0,at(m,vt,ot,Fe,!0,!0),$e&&at(m,vt,ot,Fe,!0,!1),g.forceTerrainMode=!1}$e&&(g.resetStencilClippingMasks(),se&&U.clear({stencil:0})),k===0||g.depthOcclusion||se||g.layersWithOcclusionOpacity.push(g.currentLayer)},fill:function(g,n,l,m){const x=l.paint.get("fill-color"),b=l.paint.get("fill-opacity");if(b.constantOr(1)===0)return;const T=l.paint.get("fill-emissive-strength"),k=g.colorModeForDrapableLayerRenderPass(T),j=l.paint.get("fill-pattern"),L=g.opaquePassEnabledForLayer()&&!j.constantOr(1)&&x.constantOr(s.al.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";let z="none";l.layout.get("fill-elevation-reference")!=="none"?z="road":l.paint.get("fill-z-offset").constantOr(1)!==0&&(z="offset");const U=!(!g.terrain||!g.terrain.enabled),V={painter:g,sourceCache:n,layer:l,coords:m,colorMode:k,elevationType:z,terrainEnabled:U,pass:L};if(z!=="offset"){if(Fp(V,!1),z==="road"){const Y=!U&&g.renderPass==="translucent";Y&&F_(g,n,l,m,"geometry"),Fp(V,!0,Mr.disabled),Y&&function(te){const{painter:K,sourceCache:ne,layer:se,coords:me,colorMode:xe}=te,ye=K.context.gl,Ee=new ir(K.context.gl.LEQUAL,ir.ReadOnly,K.depthRangeFor3D);for(const be of me){const we=ne.getTile(be),Te=we.getBucket(se);if(!Te)continue;const Pe=Te.elevatedStructures;if(!Pe||!Pe.renderableSegments||Pe.renderableSegments.segments[0].primitiveLength===0)continue;K.prepareDrawTile();const Ne=Te.bufferData.programConfigurations.get(se.id),Ke=K.isTileAffectedByFog(be),$e=K.getOrCreateProgram("elevatedStructures",{config:Ne,overrideFog:Ke,defines:["NORMAL_OFFSET"]}),lt={u_matrix:K.translatePosMatrix(be.projMatrix,we,se.paint.get("fill-translate"),se.paint.get("fill-translate-anchor"))};K.uploadCommonUniforms(K.context,$e,be.toUnwrapped()),$e.draw(K,ye.TRIANGLES,Ee,Mr.disabled,xe,vr.backCCW,lt,se.id,Pe.vertexBuffer,Pe.indexBuffer,Pe.renderableSegments,se.paint,K.transform.zoom,Ne,[Pe.vertexBufferNormal])}}(V)}}else Fp(V,!1,g.stencilModeFor3D())},"fill-extrusion":function(g,n,l,m){const x=l.paint.get("fill-extrusion-opacity"),b=g.context,T=b.gl,k=g.terrain,j=k&&k.renderingToTexture;if(x===0)return;const L=g.conflationActive&&g.style.isLayerClipped(l,n.getSource()),z=g.style.order.indexOf(l.fqid);if(L&&function(U,V,Y,te,K){for(const ne of te){const se=V.getTile(ne).getBucket(Y);se&&(se.updateReplacement(ne,U.replacementSource,K),se.uploadCentroid(U.context))}}(g,n,l,m,z),k||L)for(const U of m){const V=n.getTile(U).getBucket(l);V&&Zu(g.context,n,U,V,l,k,L)}if(g.renderPass==="shadow"&&g.shadowRenderer){const U=g.shadowRenderer;if(k&&x<.65&&l._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof s.ab)return;const V=U.getShadowPassDepthMode(),Y=U.getShadowPassColorMode();Gh(g,n,l,m,V,Mr.disabled,Y,L)}else if(g.renderPass==="translucent"){const U=!l.paint.get("fill-extrusion-pattern").constantOr(1),V=l.paint.get("fill-extrusion-color").constantOr(s.al.white);if(!j&&V.a!==0){const Y=new ir(g.context.gl.LEQUAL,ir.ReadWrite,g.depthRangeFor3D);x===1&&U?Gh(g,n,l,m,Y,Mr.disabled,zr.unblended,L):(Gh(g,n,l,m,Y,Mr.disabled,zr.disabled,L),Gh(g,n,l,m,Y,g.stencilModeFor3D(),g.colorModeForRenderPass(),L),g.resetStencilClippingMasks())}if(g.style.enable3dLights()&&U&&(!k&&g.transform.projection.name!=="globe"||j)){const Y=l.paint.get("fill-extrusion-opacity"),te=l.paint.get("fill-extrusion-ambient-occlusion-intensity"),K=l.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ne=l.paint.get("fill-extrusion-flood-light-intensity"),se=l.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",me=l.paint.get("fill-extrusion-flood-light-color").toRenderColor(se?null:l.lut).toArray01().slice(0,3),xe=te>0&&K>0,ye=ne>0,Ee=(we,Te,Pe)=>(1-Pe)*we+Pe*Te,be=we=>{const Te=g.depthModeForSublayer(1,ir.ReadOnly,T.LEQUAL,!0),Pe=l.paint.get(we?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ne=Ee(.1,3,Pe),Ke=g._showOverdrawInspector;if(!Ke){const $e=new Mr({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),lt=new zr([T.ONE,T.ONE,T.ONE,T.ONE],s.al.transparent,[!1,!1,!1,!0],T.MIN);Wu(g,n,l,m,Te,$e,lt,vr.disabled,we,"sdf",Y,te,K,ne,me,Ne,L,!1)}{const $e=Ke?Mr.disabled:new Mr({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),lt=Ke?g.colorModeForRenderPass():new zr([T.ONE_MINUS_DST_ALPHA,T.DST_ALPHA,T.ONE,T.ONE],s.al.transparent,[!0,!0,!0,!0]);Wu(g,n,l,m,Te,$e,lt,vr.disabled,we,"color",Y,te,K,ne,me,Ne,L,!1)}};if(j){const we=(Te,Pe,Ne)=>{const Ke=g.depthModeForSublayer(1,ir.ReadOnly,T.LEQUAL,!1),$e=l.paint.get(Te?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),lt=Ee(.1,3,$e);{const dt=new zr([T.ONE,T.ONE,T.ONE,T.ONE],s.al.transparent,[!1,!1,!1,!0]);Wu(g,n,l,m,Ke,Mr.disabled,dt,vr.disabled,Te,"clear",Y,te,K,ne,me,lt,L,Pe)}{const dt=new Mr({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),vt=new zr([T.ONE,T.ONE,T.ONE,T.ONE],s.al.transparent,[!1,!1,!1,!0],T.MIN);Wu(g,n,l,m,Ke,dt,vt,vr.disabled,Te,"sdf",Y,te,K,ne,me,lt,L,Pe)}{const dt=Te?T.ZERO:T.ONE_MINUS_DST_ALPHA,vt=new Mr({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),Ue=new zr([dt,T.DST_ALPHA,T.ONE_MINUS_DST_ALPHA,T.ZERO],s.al.transparent,[!0,!0,!0,!0]);Wu(g,n,l,m,Ke,vt,Ue,vr.disabled,Te,"color",Y,te,K,ne,me,lt,L,Pe)}{const dt=new zr([T.ONE,T.ONE,T.ONE,Te?T.ZERO:T.ONE],s.al.transparent,[!1,!1,!1,!0],Te?T.FUNC_ADD:T.MAX);Wu(g,n,l,m,Ke,Mr.disabled,dt,vr.disabled,Te,"clear",Y,te,K,ne,me,lt,L,Pe,Ne)}};if(xe||ye){let Te;if(g.prepareDrawTile(),k){const Pe=k.drapeBufferSize[0],Ne=k.drapeBufferSize[1];Te=k.framebufferCopyTexture,Te&&(!Te||Te.size[0]===Pe&&Te.size[1]===Ne)||(Te&&Te.destroy(),Te=k.framebufferCopyTexture=new s.T(b,new s.r({width:Pe,height:Ne}),T.RGBA8)),Te.bind(T.LINEAR,T.CLAMP_TO_EDGE),T.copyTexSubImage2D(T.TEXTURE_2D,0,0,0,0,0,Pe,Ne)}xe&&we(!0,!1,Te),ye&&we(!1,!0,Te)}}else xe&&be(!0),ye&&be(!1),(xe||ye)&&g.resetStencilClippingMasks()}}},hillshade:function(g,n,l,m){if(g.renderPass!=="offscreen"&&g.renderPass!=="translucent"||g.style.disableElevatedTerrain)return;const x=g.context,b=g.terrain&&g.terrain.renderingToTexture,[T,k]=g.renderPass!=="translucent"||b?[{},m]:g.stencilConfigForOverlap(m);for(const j of k){const L=n.getTile(j);if(L.needsHillshadePrepare&&g.renderPass==="offscreen")pS(g,L,l);else if(g.renderPass==="translucent"){const z=g.depthModeForSublayer(0,ir.ReadOnly),U=l.paint.get("hillshade-emissive-strength"),V=g.colorModeForDrapableLayerRenderPass(U),Y=b&&g.terrain?g.terrain.stencilModeForRTTOverlap(j):T[j.overscaledZ];zu(g,j,L,l,z,Y,V)}}x.viewport.set([0,0,g.width,g.height]),g.resetStencilClippingMasks()},raster:function(g,n,l,m,x,b){if(g.renderPass!=="translucent"||l.paint.get("raster-opacity")===0)return;const T=g.transform.projection.name==="globe",k=l.paint.get("raster-elevation")!==0,j=k&&T;if(g.renderElevatedRasterBackface&&!j)return;const L=g.context,z=L.gl,U=n.getSource(),V=function(be,we,Te,Pe){const Ne=we.paint.get("raster-color"),Ke=be.type==="raster-array",$e=[],lt=we.paint.get("raster-resampling"),dt=we.paint.get("raster-color-mix");let vt=we.paint.get("raster-color-range");const Ue=[dt[0],dt[1],dt[2],0],at=dt[3];let Fe=lt==="nearest"?Pe.NEAREST:Pe.LINEAR;if(Ke&&($e.push("RASTER_ARRAY"),Ne||$e.push("RASTER_COLOR"),lt==="linear"&&$e.push("RASTER_ARRAY_LINEAR"),Fe=Pe.NEAREST,!vt&&be.rasterLayers)){const ot=be.rasterLayers.find(({id:rt})=>rt===we.sourceLayer);ot&&ot.fields&&ot.fields.range&&(vt=ot.fields.range)}if(vt=vt||[0,1],Ne){$e.push("RASTER_COLOR"),Te.activeTexture.set(Pe.TEXTURE2),we.updateColorRamp(vt);let ot=we.colorRampTexture;ot||(ot=we.colorRampTexture=new s.T(Te,we.colorRamp,Pe.RGBA8)),ot.bind(Pe.LINEAR,Pe.CLAMP_TO_EDGE)}return{mix:Ue,range:vt,offset:at,defines:$e,resampling:Fe}}(U,l,L,z);if(U instanceof s.aK&&!m.length&&!T)return;const Y=l.paint.get("raster-emissive-strength"),te=g.colorModeForDrapableLayerRenderPass(Y),K=g.terrain&&g.terrain.renderingToTexture,ne=!g.options.moving,se=l.paint.get("raster-resampling")==="nearest"?z.NEAREST:z.LINEAR;if(U instanceof s.aK&&!m.length&&(U.onNorthPole||U.onSouthPole)){const be=k?g.stencilModeFor3D():Mr.disabled;return void We(!!U.onNorthPole,null,g,n,l,Y,V,vr.disabled,be)}if(!m.length)return;const[me,xe]=U instanceof s.aK||K?[{},m]:g.stencilConfigForOverlap(m),ye=xe[xe.length-1].overscaledZ;j&&V.defines.push("PROJECTION_GLOBE_VIEW"),k&&V.defines.push("RENDER_CUTOFF");const Ee=(be,we,Te)=>{for(const Pe of be){const Ne=Pe.toUnwrapped(),Ke=n.getTile(Pe);if(K&&(!Ke||!Ke.hasData()))continue;L.activeTexture.set(z.TEXTURE0);const $e=Bp(Ke,U,l,V);if(!$e||!$e.texture)continue;const{texture:lt,mix:dt,offset:vt,tileSize:Ue,buffer:at}=$e;let Fe,ot;K?(Fe=ir.disabled,ot=Pe.projMatrix):k?(Fe=new ir(z.LEQUAL,ir.ReadWrite,g.depthRangeFor3D),ot=T?Float32Array.from(g.transform.expandedFarZProjMatrix):g.transform.calculateProjMatrix(Ne,ne)):(Fe=g.depthModeForSublayer(Pe.overscaledZ-ye,l.paint.get("raster-opacity")===1?ir.ReadWrite:ir.ReadOnly,z.LESS),ot=g.transform.calculateProjMatrix(Ne,ne));const rt=g.terrain&&K?g.terrain.stencilModeForRTTOverlap(Pe):me[Pe.overscaledZ],ht=b?0:l.paint.get("raster-fade-duration");Ke.registerFadeDuration(ht);const Je=n.findLoadedParent(Pe,0),mt=Ap(Ke,Je,n,g.transform,ht);let It,kt;g.terrain&&g.terrain.prepareDrawTile(),L.activeTexture.set(z.TEXTURE0),lt.bind(se,z.CLAMP_TO_EDGE),L.activeTexture.set(z.TEXTURE1),Je?(Je.texture&&Je.texture.bind(se,z.CLAMP_TO_EDGE),It=Math.pow(2,Je.tileID.overscaledZ-Ke.tileID.overscaledZ),kt=[Ke.tileID.canonical.x*It%1,Ke.tileID.canonical.y*It%1]):lt.bind(se,z.CLAMP_TO_EDGE),"useMipmap"in lt&&L.extTextureFilterAnisotropic&&g.transform.pitch>20&&z.texParameterf(z.TEXTURE_2D,L.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,L.extTextureFilterAnisotropicMax);const Rt=g.transform;let Yt;const Tr=k?D0(Rt):[0,0,0,0];let cr,yr,pr,Gr,on,Rn=0;if(j&&U instanceof s.aK&&U.coordinates.length>3)cr=Float32Array.from(s.bc(s.cI(new s.bT(0,0,0)))),yr=Float32Array.from(Rt.globeMatrix),pr=Float32Array.from(s.cE(Rt)),Gr=[s.av(Rt.center.lng),s.aC(Rt.center.lat)],Yt=U.elevatedGlobePerspectiveTransform,on=U.elevatedGlobeGridMatrix||new Float32Array(9);else if(j){const Xt=s.cF(Pe.canonical);Rn=s.cG(Xt.getCenter().lat),cr=Float32Array.from(s.bc(s.cI(Pe.canonical))),yr=Float32Array.from(Rt.globeMatrix),pr=Float32Array.from(s.cE(Rt)),Gr=[s.av(Rt.center.lng),s.aC(Rt.center.lat)],Yt=[0,0],on=Float32Array.from(s.cH(Pe.canonical,Xt,Rn,Rt.worldSize/Rt._pixelsPerMercatorPixel))}else Yt=U instanceof s.aK?U.perspectiveTransform:[0,0],cr=new Float32Array(16),yr=new Float32Array(9),pr=new Float32Array(16),Gr=[0,0],on=new Float32Array(9);const Lr=k_(ot,cr,yr,pr,on,kt||[0,0],s.ag(g.transform.zoom),Gr,Tr,It||1,mt,l,Yt,k?l.paint.get("raster-elevation"):0,2,dt,vt,V.range,Ue,at,Y),Wn=g.isTileAffectedByFog(Pe),Ar=g.getOrCreateProgram("raster",{defines:V.defines,overrideFog:Wn});if(g.uploadCommonUniforms(L,Ar,Ne),U instanceof s.aK){const Xt=U.elevatedGlobeVertexBuffer,Hr=U.elevatedGlobeIndexBuffer;if(K||!T)U.boundsBuffer&&U.boundsSegments&&Ar.draw(g,z.TRIANGLES,Fe,Mr.disabled,te,vr.disabled,Lr,l.id,U.boundsBuffer,g.quadTriangleIndexBuffer,U.boundsSegments);else if(Xt&&Hr){const yn=Rt.zoom<=s.c6?U.elevatedGlobeSegments:U.getSegmentsForLongitude(Rt.center.lng);yn&&Ar.draw(g,z.TRIANGLES,Fe,Mr.disabled,te,we,Lr,l.id,Xt,Hr,yn)}}else if(j){Fe=new ir(z.LEQUAL,ir.ReadOnly,g.depthRangeFor3D);const Xt=g.globeSharedBuffers;if(Xt){const[Hr,yn,Qr]=Xt.getGridBuffers(Rn,!1);Ar.draw(g,z.TRIANGLES,Fe,Te||rt,g.colorModeForRenderPass(),we,Lr,l.id,Hr,yn,Qr)}}else{const{tileBoundsBuffer:Xt,tileBoundsIndexBuffer:Hr,tileBoundsSegments:yn}=g.getTileBoundsBuffers(Ke);Ar.draw(g,z.TRIANGLES,Fe,rt,te,vr.disabled,Lr,l.id,Xt,Hr,yn)}}if(!(U instanceof s.aK)&&j)for(const Pe of be){const Ne=Pe.canonical.y===(1<<Pe.canonical.z)-1;Pe.canonical.y===0&&We(!0,Pe,g,n,l,Y,V,we,Te||Mr.disabled),Ne&&We(!1,Pe,g,n,l,Y,V,we===vr.frontCW?vr.backCW:vr.frontCW,Te||Mr.disabled)}};j?Ee(xe,g.renderElevatedRasterBackface?vr.backCW:vr.frontCW,g.stencilModeFor3D()):Ee(xe,vr.disabled,void 0),g.resetStencilClippingMasks()},"raster-particle":function(g,n,l,m,x,b){g.renderPass==="offscreen"&&function(T,k,j,L){if(!L.length)return;const z=T.context,U=z.gl,V=k.getSource();if(!(V instanceof ka))return;const Y=Math.ceil(Math.sqrt(j.paint.get("raster-particle-count")));let te=j.particlePositionRGBAImage;if(!te||te.width!==Y){const xe=function(ye){const Ee=ye*ye,be=new Uint8Array(4*Ee),we=function(Pe){return Pe|=0,Pe=Math.imul(2747636419^Pe,2654435769),Pe=Math.imul(Pe^Pe>>>16,2654435769),((Pe=Math.imul(Pe^Pe>>>16,2654435769))>>>0)/4294967296},Te=1/1.1;for(let Pe=0;Pe<Ee;Pe++){const Ne=Te*(we(2*Pe+0)+mo),Ke=Te*(we(2*Pe+1)+mo),$e=255*Ne%1,lt=255*Ke%1,dt=$e,vt=Ke-lt/255,Ue=lt;be[4*Pe+0]=255*(Ne-$e/255),be[4*Pe+1]=255*dt,be[4*Pe+2]=255*vt,be[4*Pe+3]=255*Ue}return be}(Y);te=j.particlePositionRGBAImage=new s.r({width:Y,height:Y},xe)}let K=j.particleFramebuffer;K?K.width!==Y&&(K.destroy(),K=j.particleFramebuffer=z.createFramebuffer(Y,Y,!0,null)):K=j.particleFramebuffer=z.createFramebuffer(Y,Y,!0,null);const ne=[];for(const xe of L){const ye=k.getTile(xe);if(!(ye instanceof Us))continue;const Ee=L0(ye,V,j);if(!Ee)continue;const be=[ye.tileSize,ye.tileSize];let we=j.tileFramebuffer;we||(we=j.tileFramebuffer=z.createFramebuffer(be[0],be[1],!0,null));let Te=ye.rasterParticleState;Te||(Te=ye.rasterParticleState=new V_(z,xe,be,te));const Pe=Te.update(j.lastInvalidatedAt);Te.particleTextureDimension!==Y&&Te.updateParticleTexture(xe,te);const Ne=Te.targetColorTexture;Te.targetColorTexture=Te.backgroundColorTexture,Te.backgroundColorTexture=Ne;const Ke=Te.particleTexture0;Te.particleTexture0=Te.particleTexture1,Te.particleTexture1=Ke,ne.push([xe,Ee,Te,Pe])}if(ne.length===0)return;const se=s.q.now(),me=j.previousDrawTimestamp?.001*(se-j.previousDrawTimestamp):.0167;if(j.previousDrawTimestamp=se,j.hasColorMap()){z.activeTexture.set(U.TEXTURE0+2);let xe=j.colorRampTexture;xe||(xe=j.colorRampTexture=new s.T(z,j.colorRamp,U.RGBA8)),xe.bind(U.LINEAR,U.CLAMP_TO_EDGE)}z.bindFramebuffer.set(j.tileFramebuffer.framebuffer),function(xe,ye,Ee){const be=xe.context,we=be.gl,Te=ye.tileFramebuffer;be.activeTexture.set(we.TEXTURE0);const Pe={u_texture:0,u_opacity:1.05*(Ke=ye.paint.get("raster-particle-fade-opacity-factor"))/(Ke+.05)},Ne=xe.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Ke;for(const $e of Ee){const[,,lt,dt]=$e;Te.colorAttachment.set(lt.targetColorTexture.texture),be.viewport.set([0,0,Te.width,Te.height]),be.clear({color:s.al.transparent}),dt&&(lt.backgroundColorTexture.bind(we.NEAREST,we.CLAMP_TO_EDGE),Ne.draw(xe,we.TRIANGLES,ir.disabled,Mr.disabled,zr.alphaBlended,vr.disabled,Pe,ye.id,xe.viewportBuffer,xe.quadTriangleIndexBuffer,xe.viewportSegments))}}(T,j,ne),function(xe,ye,Ee,be){const we=xe.context,Te=we.gl,Pe=Ee.tileFramebuffer,Ne=xe.transform.projection.name==="globe",Ke=Ee.paint.get("raster-particle-max-speed");for(const $e of be){const[lt,dt,vt]=$e;we.activeTexture.set(Te.TEXTURE0+0),dt.texture.bind(Te.LINEAR,Te.CLAMP_TO_EDGE),Pe.colorAttachment.set(vt.targetColorTexture.texture);const Ue=xe.getOrCreateProgram("rasterParticleDraw",{defines:dt.defines,overrideFog:!1});we.activeTexture.set(Te.TEXTURE0+1);const at=dt.scalarData?[]:[0,1,2,3].map(rt=>s.d7[rt](lt));at.push(lt);const Fe=lt.canonical.x,ot=lt.canonical.y;for(const rt of at){const ht=ye.getTile(Ne?rt.wrapped():rt);if(!ht)continue;const Je=ht.rasterParticleState;if(!Je)continue;const mt=rt.canonical.x+(1<<rt.canonical.z)*(rt.wrap-lt.wrap),It=rt.canonical.y;Je.particleTexture0.bind(Te.NEAREST,Te.CLAMP_TO_EDGE);const kt=N_(1,Je.particleTexture0.size[0],[mt-Fe,It-ot],0,dt.texture.size,2,Ke,dt.textureOffset,dt.scale,dt.offset);Ue.draw(xe,Te.POINTS,ir.disabled,Mr.disabled,zr.alphaBlended,vr.disabled,kt,Ee.id,Je.particleIndexBuffer,void 0,Je.particleSegment)}}}(T,k,j,ne),z.bindFramebuffer.set(j.particleFramebuffer.framebuffer),function(xe,ye,Ee,be){const we=xe.context,Te=we.gl,Pe=ye.paint.get("raster-particle-max-speed"),Ne=be*ye.paint.get("raster-particle-speed-factor")*.15,Ke=function(lt){return Math.pow(lt,6)}(.01+1*ye.paint.get("raster-particle-reset-rate-factor")),$e=ye.particleFramebuffer;we.viewport.set([0,0,$e.width,$e.height]);for(const lt of Ee){const[,dt,vt]=lt;we.activeTexture.set(Te.TEXTURE0+0),dt.texture.bind(Te.LINEAR,Te.CLAMP_TO_EDGE),we.activeTexture.set(Te.TEXTURE0+1);const Ue=vt.particleTexture0;Ue.bind(Te.NEAREST,Te.CLAMP_TO_EDGE);const at=TS(1,Ue.size[0],0,dt.texture.size,Pe,Ne,Ke,dt.textureOffset,dt.scale,dt.offset);$e.colorAttachment.set(vt.particleTexture1.texture),we.clear({color:s.al.transparent}),xe.getOrCreateProgram("rasterParticleUpdate",{defines:dt.defines}).draw(xe,Te.TRIANGLES,ir.disabled,Mr.disabled,zr.unblended,vr.disabled,at,ye.id,xe.viewportBuffer,xe.quadTriangleIndexBuffer,xe.viewportSegments)}}(T,j,ne,me)}(g,n,l,m),g.renderPass==="translucent"&&(function(T,k,j,L,z){const U=T.context,V=U.gl,Y=k.getSource().tileSize,te=5*(1-s.ae(s.bY,s.bY+1,T.transform.zoom))*Y+j.paint.get("raster-particle-elevation"),K=!T.options.moving,ne=T.transform.projection.name==="globe";if(!L.length)return;const[se,me]=T.stencilConfigForOverlap(L),xe=[];ne&&xe.push("PROJECTION_GLOBE_VIEW");const ye=T.stencilModeFor3D();for(const Ee of me){const be=Ee.toUnwrapped(),we=k.getTile(Ee);if(!we.rasterParticleState)continue;const Te=we.rasterParticleState,Pe=100;we.registerFadeDuration(Pe);const Ne=k.findLoadedParent(Ee,0),Ke=Ap(we,Ne,k,T.transform,Pe);let $e,lt;T.terrain&&T.terrain.prepareDrawTile(),U.activeTexture.set(V.TEXTURE0),Te.targetColorTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),U.activeTexture.set(V.TEXTURE1),Ne&&Ne.rasterParticleState?(Ne.rasterParticleState.targetColorTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),$e=Math.pow(2,Ne.tileID.overscaledZ-we.tileID.overscaledZ),lt=[we.tileID.canonical.x*$e%1,we.tileID.canonical.y*$e%1]):Te.targetColorTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE);const dt=ne?Float32Array.from(T.transform.expandedFarZProjMatrix):T.transform.calculateProjMatrix(be,K),vt=T.transform,Ue=O0(vt),at=s.cF(Ee.canonical),Fe=s.cG(at.getCenter().lat);let ot,rt,ht,Je,mt;ne?(ot=Float32Array.from(s.bc(s.cI(Ee.canonical))),rt=Float32Array.from(vt.globeMatrix),ht=Float32Array.from(s.cE(vt)),Je=[s.av(vt.center.lng),s.aC(vt.center.lat)],mt=Float32Array.from(s.cH(Ee.canonical,at,Fe,vt.worldSize/vt._pixelsPerMercatorPixel))):(ot=new Float32Array(16),rt=new Float32Array(9),ht=new Float32Array(16),Je=[0,0],mt=new Float32Array(9));const It=ar(dt,ot,rt,ht,mt,lt||[0,0],s.ag(T.transform.zoom),Je,Ue,$e||1,Ke,te),kt=T.isTileAffectedByFog(Ee),Rt=T.getOrCreateProgram("rasterParticle",{defines:xe,overrideFog:kt});if(T.uploadCommonUniforms(U,Rt,be),ne){const Yt=new ir(V.LEQUAL,ir.ReadOnly,T.depthRangeFor3D),Tr=0,cr=T.globeSharedBuffers;if(cr){const[yr,pr,Gr]=cr.getGridBuffers(Fe,Tr!==0);Rt.draw(T,V.TRIANGLES,Yt,ye,zr.alphaBlended,T.renderElevatedRasterBackface?vr.frontCCW:vr.backCCW,It,j.id,yr,pr,Gr)}}else{const Yt=T.depthModeForSublayer(0,ir.ReadOnly),Tr=se[Ee.overscaledZ],{tileBoundsBuffer:cr,tileBoundsIndexBuffer:yr,tileBoundsSegments:pr}=T.getTileBoundsBuffers(we);Rt.draw(T,V.TRIANGLES,Yt,Tr,zr.alphaBlended,vr.disabled,It,j.id,cr,yr,pr)}}T.resetStencilClippingMasks()}(g,n,l,m),g.style.map.triggerRepaint())},background:function(g,n,l,m){const x=l.paint.get("background-color"),b=l.paint.get("background-color-use-theme").constantOr("default")==="none",T=l.paint.get("background-opacity"),k=l.paint.get("background-emissive-strength"),j=l.paint.get("background-pitch-alignment")==="viewport";if(T===0)return;const L=g.context,z=L.gl,U=g.transform,V=U.tileSize,Y=l.paint.get("background-pattern");let te;if(Y!==void 0&&(Y===null||(te=g.imageManager.getPattern(s.I.from(Y.toString()),l.scope,g.style.getLut(l.scope)),!te)))return;const K=!Y&&x.a===1&&T===1&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==K)return;const ne=Mr.disabled,se=g.depthModeForSublayer(0,K==="opaque"?ir.ReadWrite:ir.ReadOnly),me=g.colorModeForDrapableLayerRenderPass(k),xe=Y?"backgroundPattern":"background";let ye,Ee=m;if(Ee||(ye=g.getBackgroundTiles(),Ee=Object.values(ye).map(be=>be.tileID)),Y&&(L.activeTexture.set(z.TEXTURE0),g.imageManager.bind(g.context,l.scope)),j){const be=g.getOrCreateProgram(xe,{overrideFog:!1,overrideRtt:!0}),we=new Float32Array(s.ad.mat4.identity([])),Te=new s.aH(0,0,0,0,0),Pe=Y?N0(we,k,T,g,0,l.scope,te,j,{tileID:Te,tileSize:V}):R_(we,k,T,x.toRenderColor(b?null:l.lut));be.draw(g,z.TRIANGLES,se,ne,me,vr.disabled,Pe,l.id,g.viewportBuffer,g.quadTriangleIndexBuffer,g.viewportSegments)}else for(const be of Ee){const we=g.isTileAffectedByFog(be),Te=g.getOrCreateProgram(xe,{overrideFog:we}),Pe=be.toUnwrapped(),Ne=m?be.projMatrix:g.transform.calculateProjMatrix(Pe);g.prepareDrawTile();const Ke=n?n.getTile(be):ye?ye[be.key]:new sa(be,V,U.zoom,g),$e=Y?N0(Ne,k,T,g,0,l.scope,te,j,{tileID:be,tileSize:V}):R_(Ne,k,T,x.toRenderColor(b?null:l.lut));g.uploadCommonUniforms(L,Te,Pe);const{tileBoundsBuffer:lt,tileBoundsIndexBuffer:dt,tileBoundsSegments:vt}=g.getTileBoundsBuffers(Ke);Te.draw(g,z.TRIANGLES,se,ne,me,vr.disabled,$e,l.id,lt,dt,vt)}},sky:function(g,n,l){const m=g._atmosphere?s.ag(g.transform.zoom):1,x=l.paint.get("sky-opacity")*m;if(x===0)return;const b=g.context,T=l.paint.get("sky-type"),k=new ir(b.gl.LEQUAL,ir.ReadOnly,[0,1]),j=g.frameCounter/1e3%1;T==="atmosphere"?g.renderPass==="offscreen"?l.needsSkyboxCapture(g)&&(function(L,z,U,V){const Y=L.context,te=Y.gl;let K=z.skyboxFbo;if(!K){K=z.skyboxFbo=Y.createFramebuffer(32,32,!0,null),z.skyboxGeometry=new F0(Y),z.skyboxTexture=Y.gl.createTexture(),te.bindTexture(te.TEXTURE_CUBE_MAP,z.skyboxTexture),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_WRAP_S,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_WRAP_T,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_MIN_FILTER,te.LINEAR),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_MAG_FILTER,te.LINEAR);for(let xe=0;xe<6;++xe)te.texImage2D(te.TEXTURE_CUBE_MAP_POSITIVE_X+xe,0,te.RGBA,32,32,0,te.RGBA,te.UNSIGNED_BYTE,null)}Y.bindFramebuffer.set(K.framebuffer),Y.viewport.set([0,0,32,32]);const ne=z.getCenter(L,!0),se=L.getOrCreateProgram("skyboxCapture"),me=new Float64Array(16);s.ad.mat4.identity(me),s.ad.mat4.rotateY(me,me,.5*-Math.PI),es(L,z,se,me,ne,0),s.ad.mat4.identity(me),s.ad.mat4.rotateY(me,me,.5*Math.PI),es(L,z,se,me,ne,1),s.ad.mat4.identity(me),s.ad.mat4.rotateX(me,me,.5*-Math.PI),es(L,z,se,me,ne,2),s.ad.mat4.identity(me),s.ad.mat4.rotateX(me,me,.5*Math.PI),es(L,z,se,me,ne,3),s.ad.mat4.identity(me),es(L,z,se,me,ne,4),s.ad.mat4.identity(me),s.ad.mat4.rotateY(me,me,Math.PI),es(L,z,se,me,ne,5),Y.viewport.set([0,0,L.width,L.height])}(g,l),l.markSkyboxValid(g)):g.renderPass==="sky"&&function(L,z,U,V,Y){const te=L.context,K=te.gl,ne=L.transform,se=L.getOrCreateProgram("skybox");te.activeTexture.set(K.TEXTURE0),K.bindTexture(K.TEXTURE_CUBE_MAP,z.skyboxTexture);const me=((xe,ye,Ee,be,we)=>({u_matrix:xe,u_sun_direction:ye,u_cubemap:0,u_opacity:be,u_temporal_offset:we}))(ne.skyboxMatrix,z.getCenter(L,!1),0,V,Y);L.uploadCommonUniforms(te,se),se.draw(L,K.TRIANGLES,U,Mr.disabled,L.colorModeForRenderPass(),vr.backCW,me,"skybox",z.skyboxGeometry.vertexBuffer,z.skyboxGeometry.indexBuffer,z.skyboxGeometry.segment)}(g,l,k,x,j):T==="gradient"&&g.renderPass==="sky"&&function(L,z,U,V,Y){const te=L.context,K=te.gl,ne=L.transform,se=L.getOrCreateProgram("skyboxGradient");z.skyboxGeometry||(z.skyboxGeometry=new F0(te)),te.activeTexture.set(K.TEXTURE0);let me=z.colorRampTexture;me||(me=z.colorRampTexture=new s.T(te,z.colorRamp,K.RGBA8)),me.bind(K.LINEAR,K.CLAMP_TO_EDGE);const xe=((ye,Ee,be,we,Te)=>({u_matrix:ye,u_color_ramp:0,u_center_direction:Ee,u_radius:s.ak(be),u_opacity:we,u_temporal_offset:Te}))(ne.skyboxMatrix,z.getCenter(L,!1),z.paint.get("sky-gradient-radius"),V,Y);L.uploadCommonUniforms(te,se),se.draw(L,K.TRIANGLES,U,Mr.disabled,L.colorModeForRenderPass(),vr.backCW,xe,"skyboxGradient",z.skyboxGeometry.vertexBuffer,z.skyboxGeometry.indexBuffer,z.skyboxGeometry.segment)}(g,l,k,x,j)},debug:function(g,n,l,m,x,b){for(let T=0;T<l.length;T++)if(x){const L=new s.al(m.r*.8,m.g*.8,m.b*.8,1);ec(g,n,l[T],m,-1,-1,b),ec(g,n,l[T],m,-1,1,b),ec(g,n,l[T],m,1,1,b),ec(g,n,l[T],m,1,-1,b),ec(g,n,l[T],L,0,0,b)}else ec(g,n,l[T],m,0,0,b)},custom:function(g,n,l,m){const x=g.context,b=l.implementation;if(!g.transform.projection.unsupportedLayers||!g.transform.projection.unsupportedLayers.includes("custom")||g.terrain&&(g.terrain.renderingToTexture||g.renderPass==="offscreen")&&l.isDraped(n)){if(g.renderPass==="offscreen"){const T=b.prerender;if(T){if(g.setCustomLayerDefaults(),x.setColorMode(g.colorModeForRenderPass()),g.transform.projection.name==="globe"){const k=g.transform.pointMerc;T.call(b,x.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),s.ag(g.transform.zoom),[k.x,k.y],g.transform.pixelsPerMeterRatio)}else T.call(b,x.gl,g.transform.customLayerMatrix());x.setDirty(),g.setBaseState()}}else if(g.renderPass==="translucent"){if(g.terrain&&g.terrain.renderingToTexture){const k=b.renderToTile;if(k){const j=m[0].canonical,L=new s.ac(j.x+m[0].wrap*(1<<j.z),j.y,j.z);x.setDepthMode(ir.disabled),x.setStencilMode(Mr.disabled),x.setColorMode(g.colorModeForRenderPass()),g.setCustomLayerDefaults(),k.call(b,x.gl,L),x.setDirty(),g.setBaseState()}return}g.setCustomLayerDefaults(),x.setColorMode(g.colorModeForRenderPass()),x.setStencilMode(Mr.disabled);const T=b.renderingMode==="3d"?new ir(g.context.gl.LEQUAL,ir.ReadWrite,g.depthRangeFor3D):g.depthModeForSublayer(0,ir.ReadOnly);if(x.setDepthMode(T),g.transform.projection.name==="globe"){const k=g.transform.pointMerc;b.render(x.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),s.ag(g.transform.zoom),[k.x,k.y],g.transform.pixelsPerMeterRatio)}else b.render(x.gl,g.transform.customLayerMatrix());x.setDirty(),g.setBaseState(),x.bindFramebuffer.set(null)}}else s.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(g,n,l,m){if(g.renderPass==="opaque")return;const x=l.paint.get("model-opacity").constantOr(1);if(x===0)return;const b=l.paint.get("model-cast-shadows");if(g.renderPass==="shadow"&&(!b||g.terrain&&x<.65&&l._transitionablePaint._values["model-opacity"].value.expression instanceof s.ab))return;const T=g.shadowRenderer,k=l.paint.get("model-receive-shadows");T&&(T.useNormalOffset=!0,k||(T.enabled=!1));const j=()=>{T&&(T.useNormalOffset=!0,k||(T.enabled=!0))},L=n.getSource();if(g.renderPass==="light-beam"&&L.type!=="batched-model")return;if(L.type==="vector"||L.type==="geojson")return function(se,me,xe,ye,Ee){const be=se.transform;if(be.projection.name!=="mercator")return void s.w(`Drawing 3D models for ${be.projection.name} projection is not yet implemented`);const we=be.getFreeCameraOptions().position;if(!se.modelManager)return;const Te=se.modelManager;xe.modelManager=Te;const Pe=se.shadowRenderer;if(!xe._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Ne=xe._unevaluatedLayout._values["model-id"],Ke=Object.assign({},xe.layout.get("model-id").parameters),$e=se.style.order.indexOf(xe.fqid);for(const lt of ye){const dt=me.getTile(lt).getBucket(xe);if(!dt||dt.projection.name!==be.projection.name)continue;const vt=dt.getModelUris();vt&&!dt.modelsRequested&&(Te.addModelsFromBucket(vt,Ee),dt.modelsRequested=!0);const Ue=q_(lt,be);Ke.zoom=Ue;const at=Ne.possiblyEvaluate(Ke);if(G_(se,dt,lt),Fo.shadowUniformsInitialized=!1,Fo.useSingleShadowCascade=!!Pe&&Pe.getMaxCascadeForTile(lt.toUnwrapped())===0,se.renderPass==="shadow"&&Pe){if(se.currentShadowCascade===1&&dt.isInsideFirstShadowMapFrustum)continue;const rt=be.calculatePosMatrix(lt.toUnwrapped(),be.worldSize);if(Fo.tileMatrix.set(rt),Fo.shadowTileMatrix=Float32Array.from(Pe.calculateShadowPassMatrixFromMatrix(rt)),Fo.aabb.min.fill(0),Fo.aabb.max[0]=Fo.aabb.max[1]=s.ai,Fo.aabb.max[2]=0,$p(dt,Fo,se,xe.scope))continue}const Fe=1<<lt.canonical.z,ot=[((we.x-lt.wrap)*Fe-lt.canonical.x)*s.ai,(we.y*Fe-lt.canonical.y)*s.ai,we.z*Fe*s.ai];se.conflationActive&&Object.keys(dt.instancesPerModel).length>0&&se.style.isLayerClipped(xe,me.getSource())&&dt.updateReplacement(lt,se.replacementSource,$e,Ee)&&(dt.uploaded=!1,dt.upload(se.context));for(let rt in dt.instancesPerModel){const ht=dt.instancesPerModel[rt];ht.features.length>0&&(rt=at.evaluate(ht.features[0].feature,{}));const Je=Te.getModel(rt,Ee);if(Je&&Je.uploaded)for(const mt of Je.nodes)ca(se,xe,mt,ht,ot,lt,Fo)}}}(g,n,l,m,L.type==="vector"?l.scope:""),void j();if(!L.loaded())return;if(L.type==="batched-model")return function(se,me,xe,ye){xe.resetLayerRenderingStats(se);const Ee=se.context,be=se.transform,we=se.style.fog,Te=se.shadowRenderer;if(be.projection.name!=="mercator")return void s.w(`Drawing 3D landmark models for ${be.projection.name} projection is not yet implemented`);const Pe=se.transform.getFreeCameraOptions().position,Ne=s.ad.vec3.scale([],[Pe.x,Pe.y,Pe.z],se.transform.worldSize),Ke=s.ad.vec3.negate([],Ne),$e=s.ad.mat4.identity([]),lt=s.dm(be.center.lat,be.zoom),dt=s.ad.mat4.fromScaling([],[1,1,1/lt]);s.ad.mat4.translate($e,$e,Ke);const vt=xe.paint.get("model-opacity").constantOr(1),Ue=new ir(Ee.gl.LEQUAL,ir.ReadWrite,se.depthRangeFor3D),at=new ir(Ee.gl.LEQUAL,ir.ReadOnly,se.depthRangeFor3D),Fe=new s.ce([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),ot=se.renderPass==="shadow",rt=ot&&Te?Te.getCurrentCascadeFrustum():be.getFrustum(be.scaleZoom(be.worldSize)),ht=xe.paint.get("model-front-cutoff"),Je=ht[2]<1,mt=sl(se,xe.paint.get("model-cutoff-fade-range")),It=xe.getLayerRenderingStats();(function(kt,Rt,Yt,Tr){const cr=kt.terrain?kt.terrain.exaggeration():0,yr=kt.transform.zoom;for(const pr of Tr){const Gr=Rt.getTile(pr).getBucket(Yt);Gr&&(Gr.setFilter(Yt.filter),kt.conflationActive&&Gr.updateReplacement(pr,kt.replacementSource),Gr.evaluateScale(kt,Yt),kt.terrain&&cr>0&&Gr.elevationUpdate(kt.terrain,cr,pr,Yt.source),Gr.needsReEvaluation(kt,yr,Yt)&&Gr.evaluate(Yt))}})(se,me,xe,ye),function(){let kt,Rt,Yt;Je?(kt=ye.length-1,Rt=-1,Yt=-1):(kt=0,Rt=ye.length,Yt=1);const Tr=new Float64Array(16),cr=s.ad.vec3.create(),yr=new s.P(0,0);for(let pr=kt;pr!==Rt;pr+=Yt){const Gr=ye[pr],on=me.getTile(Gr).getBucket(xe);if(!on||!on.uploaded)continue;let Rn=!1;Te&&(Rn=Te.getMaxCascadeForTile(Gr.toUnwrapped())===0);const Lr=be.calculatePosMatrix(Gr.toUnwrapped(),be.worldSize),Wn=on.modelTraits;!ot&&Je&&(s.ad.mat4.invert(Tr,Lr),s.ad.vec3.transformMat4(cr,Ne,Tr),yr.x=cr[0],yr.y=cr[1]);const Ar=[];on.setFilter(xe.filter);for(const Xt of on.getNodesInfo()){if(Xt.hiddenByReplacement||!Xt.node.meshes)continue;const Hr=Xt.node;let yn=0;se.terrain&&Hr.elevation&&(yn=Hr.elevation*se.terrain.exaggeration());const Qr=(()=>{const Cn=Xt.aabb;return Fe.min=[...Cn.min],Fe.max=[...Cn.max],Fe.min[2]+=yn,Fe.max[2]+=yn,s.ad.vec3.transformMat4(Fe.min,Fe.min,Lr),s.ad.vec3.transformMat4(Fe.max,Fe.max,Lr),Fe})(),ai=Xt.evaluatedScale;if(ai[0]<=1&&ai[1]<=1&&ai[2]<=1&&Qr.intersects(rt)===0)continue;if(!ot&&Je){const Cn=.16666666666666666;Xt.cameraCollisionOpacity=Ne[0]>Qr.min[0]&&Ne[0]<Qr.max[0]&&Ne[1]>Qr.min[1]&&Ne[1]<Qr.max[1]&&Ne[2]*lt<Qr.max[2]&&Hr.footprint&&s.bA(yr,Hr.footprint)?Math.max(Xt.cameraCollisionOpacity-Cn,0):Math.min(1,Xt.cameraCollisionOpacity+Cn)}const Ei=[...Lr],zi=Hr.anchor?Hr.anchor[0]:0,Ui=Hr.anchor?Hr.anchor[1]:0;s.ad.mat4.translate(Ei,Ei,[zi*(ai[0]-1),Ui*(ai[1]-1),yn]),s.ad.vec3.exactEquals(ai,s.dq)||s.ad.mat4.scale(Ei,Ei,ai);const yo=s.ad.mat4.multiply([],Ei,Hr.matrix),Is=s.ad.mat4.multiply([],be.expandedFarZProjMatrix,yo),Xr=s.ad.mat4.multiply([],be.expandedFarZProjMatrix,Ei),Zn=s.ad.vec4.transformMat4([],[zi,Ui,yn,1],Is)[2];Hr.hidden=!1;let an=vt;ot||(Je&&(an*=Xt.cameraCollisionOpacity,an*=H_(Ei,be,Xt.aabb,ht)),an*=Gp(mt,Zn)),an!==0?Ar.push({nodeInfo:Xt,depth:Zn,opacity:an,wvpForNode:Is,wvpForTile:Xr,nodeModelMatrix:yo,tileModelMatrix:Ei}):Hr.hidden=!0}ot||Ar.sort((Xt,Hr)=>!Je||Xt.opacity===1&&Hr.opacity===1?Xt.depth<Hr.depth?-1:1:Xt.opacity===1?-1:Hr.opacity===1?1:Xt.depth>Hr.depth?-1:1);for(const Xt of Ar){const Hr=Xt.nodeInfo,yn=Hr.node;let Qr=s.ad.mat4.multiply([],dt,Xt.tileModelMatrix);s.ad.mat4.multiply(Qr,$e,Qr);const ai=s.ad.mat4.invert([],Qr);s.ad.mat4.transpose(ai,ai),s.ad.mat4.scale(ai,ai,tc),Qr=s.ad.mat4.multiply(Qr,Qr,yn.matrix);const Ei=se.renderPass==="light-beam",zi=xe.paint.get("model-color-use-theme").constantOr("default")==="none",Ui=Wn&s.ds.HasMapboxMeshFeatures,yo=Ui?0:Hr.evaluatedRMEA[0][2];for(let Is=0;Is<yn.meshes.length;++Is){const Xr=yn.meshes[Is],Zn=Is===yn.lightMeshIndex;let an=Xt.wvpForNode;if(Zn){if(!Ei&&!se.terrain&&se.shadowRenderer){se.currentLayer<se.firstLightBeamLayer&&(se.firstLightBeamLayer=se.currentLayer);continue}an=Xt.wvpForTile}else if(Ei)continue;const Cn={defines:[]},us=[];if(!ot&&Te&&(Te.useNormalOffset=!!Xr.normalBuffer),Qu(Cn.defines,us,Xr,se,zi?null:xe.lut),Ui||Cn.defines.push("DIFFUSE_SHADED"),Rn&&Cn.defines.push("SHADOWS_SINGLE_CASCADE"),It&&(ot?It.numRenderedVerticesInShadowPass+=Xr.vertexArray.length:It.numRenderedVerticesInTransparentPass+=Xr.vertexArray.length),ot){Hh(Xr,Xt.nodeModelMatrix,se,xe);continue}let Un=null;if(we){const Uo=ul(Xt.nodeModelMatrix,se.transform);if(Un=new Float32Array(Uo),be.projection.name!=="globe"){const eo=Xr.aabb.min,fl=Xr.aabb.max,[za,pl]=we.getOpacityForBounds(Uo,eo[0],eo[1],fl[0],fl[1]);Cn.overrideFog=za>=Lt||pl>=Lt}}const Fi=Xr.material;let Oa;Fi.occlusionTexture&&Fi.occlusionTexture.offsetScale&&(Oa=Fi.occlusionTexture.offsetScale,Cn.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Qs=se.getOrCreateProgram("model",Cn);!ot&&Te&&Te.setupShadowsFromMatrix(Xt.tileModelMatrix,Qs,Te.useNormalOffset),se.uploadCommonUniforms(Ee,Qs,null,Un);const Vo=Fi.pbrMetallicRoughness;Vo.metallicFactor=.9,Vo.roughnessFactor=.5;const Gs=j_(new Float32Array(an),new Float32Array(Qr),new Float32Array(ai),new Float32Array(yn.matrix),se,Xt.opacity,Vo.baseColorFactor.toRenderColor(null),Fi.emissiveFactor,Vo.metallicFactor,Vo.roughnessFactor,Fi,yo,xe,[0,0,0],Oa);!Zn&&(Hr.hasTranslucentParts||Xt.opacity<1)&&Qs.draw(se,Ee.gl.TRIANGLES,Ue,Mr.disabled,zr.disabled,vr.backCCW,Gs,xe.id,Xr.vertexBuffer,Xr.indexBuffer,Xr.segments,xe.paint,se.transform.zoom,void 0,us),Qs.draw(se,Ee.gl.TRIANGLES,Zn?at:Ue,Mr.disabled,Zn||Xt.opacity<1||Hr.hasTranslucentParts?zr.alphaBlended:zr.unblended,vr.backCCW,Gs,xe.id,Xr.vertexBuffer,Xr.indexBuffer,Xr.segments,xe.paint,se.transform.zoom,void 0,us)}}}}()}(g,n,l,m),void j();if(L.type!=="model")return;const z=L.getModels(),U=[],V=g.transform.getFreeCameraOptions().position,Y=s.ad.vec3.scale([],[V.x,V.y,V.z],g.transform.worldSize);s.ad.vec3.negate(Y,Y);const te=[],K=[];let ne=0;for(const se of z){const me=l.paint.get("model-rotation").constantOr(null),xe=l.paint.get("model-scale").constantOr(null),ye=l.paint.get("model-translation").constantOr(null);se.computeModelMatrix(g,me,xe,ye,!0,!0,!1);const Ee=s.ad.mat4.identity([]),be=s.dm(se.position.lat,g.transform.zoom),we=s.ad.mat4.fromScaling([],[1,1,1/be]);s.ad.mat4.translate(Ee,Ee,Y),U.push({zScaleMatrix:we,negCameraPosMatrix:Ee});for(const Te of se.nodes)Bc(g.transform,Te,se.matrix,g.transform.expandedFarZProjMatrix,ne,te,K);ne++}if(te.sort((se,me)=>me.depth-se.depth),g.renderPass!=="shadow"){if(x===1)for(const se of K)dl(se,g,l,U[se.modelIndex],Mr.disabled,g.colorModeForRenderPass());else{for(const se of K)dl(se,g,l,U[se.modelIndex],Mr.disabled,zr.disabled);for(const se of K)dl(se,g,l,U[se.modelIndex],g.stencilModeFor3D(),g.colorModeForRenderPass());g.resetStencilClippingMasks()}for(const se of te)dl(se,g,l,U[se.modelIndex],Mr.disabled,g.colorModeForRenderPass());j()}else{for(const se of K)Hh(se.mesh,se.nodeModelMatrix,g,l);for(const se of te)Hh(se.mesh,se.nodeModelMatrix,g,l);j()}}},Zp={line:function(g,n,l){if(g.hasElevatedBuckets=!1,g.hasNonElevatedBuckets=!1,g._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||g._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(n){const m=n.getVisibleCoordinates();for(const x of m){const b=n.getTile(x).getBucket(g);if(b&&(b.hasZOffset?g.hasElevatedBuckets=!0:g.hasNonElevatedBuckets=!0,g.hasElevatedBuckets&&g.hasNonElevatedBuckets))break}}}else g.hasNonElevatedBuckets=!0},model:function(g,n,l){const m=n.getSource();if(!m.loaded())return;if(m.type==="vector"||m.type==="geojson")return void(l.modelManager&&l.modelManager.upload(l,m.type==="vector"?g.scope:""));if(m.type==="batched-model"||m.type!=="model")return;const x=m.getModels();for(const b of x)b.upload(l.context)},raster:function(g,n,l){const m=n.getSource();if(!(m instanceof ka&&m.loaded()))return;const x=g.sourceLayer||m.rasterLayerIds&&m.rasterLayerIds[0];if(!x)return;const b=g.paint.get("raster-array-band")||m.getInitialBand(x);if(b==null)return;const T=n.getIds().map(k=>n.getTileByID(k));for(const k of T)k.updateNeeded(x,b)&&m.prepareTile(k,x,b)},"raster-particle":function(g,n,l){const m=n.getSource();if(!(m instanceof ka&&m.loaded()))return;const x=g.sourceLayer||m.rasterLayerIds&&m.rasterLayerIds[0];if(!x)return;const b=g.paint.get("raster-particle-array-band")||m.getInitialBand(x);if(b==null)return;const T=n.getIds().map(k=>n.getTileByID(k));for(const k of T)k.updateNeeded(x,b)&&m.prepareTile(k,x,b)}},Yp={fill:F_};class Xp{constructor(n,l,m,x,b){this.context=new Ql(n,l),this.transform=m,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=b,this._timeStamp=s.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const T=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const j of T)this._debugParams.enabledLayers[j]=!0;b.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),b.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),b.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),b.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),b.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),b.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const j of T)b.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],j);this.occlusionParams=new Z_(b),this.setup(),this.numSublayers=Do.maxUnderzooming+Do.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new s.dy,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new ol(this),this._wireframeDebugCache=new Vc,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const k=new s.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new s.T(this.context,k,n.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=x}updateTerrain(n,l){const m=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(m||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new C0(this,n));const x=this._terrain;this.transform.elevation=m?x:null,x.update(n,this.transform,l),this.transform.elevation&&!x.enabled&&(this.transform.elevation=null)}_updateFog(n){const l=n.fog;if(!l||this.transform.projection.name==="globe"||l.getOpacity(this.transform.pitch)<1||l.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[m,x]=l.getFovAdjustedRange(this.transform._fov);if(m>x)return void(this.transform.fogCullDistSq=null);const b=m+.78*(x-m);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(n){n&&!this._terrain&&(this._terrain=new C0(this,this.style)),this._forceTerrainMode=n}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(n,l){if(this.width=n*s.q.devicePixelRatio,this.height=l*s.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style.order)this.style._mergedLayers[m].resize()}setup(){const n=this.context,l=new s.b5;l.emplaceBack(0,0),l.emplaceBack(s.ai,0),l.emplaceBack(0,s.ai),l.emplaceBack(s.ai,s.ai),this.tileExtentBuffer=n.createVertexBuffer(l,s.b7.members),this.tileExtentSegments=s.b8.simpleSegment(0,0,4,2);const m=new s.b5;m.emplaceBack(0,0),m.emplaceBack(s.ai,0),m.emplaceBack(0,s.ai),m.emplaceBack(s.ai,s.ai),this.debugBuffer=n.createVertexBuffer(m,s.b7.members),this.debugSegments=s.b8.simpleSegment(0,0,4,5);const x=new s.b5;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(x,s.b7.members),this.viewportSegments=s.b8.simpleSegment(0,0,4,2);const b=new s.aU;b.emplaceBack(0,0,0,0),b.emplaceBack(s.ai,0,s.ai,0),b.emplaceBack(0,s.ai,0,s.ai),b.emplaceBack(s.ai,s.ai,s.ai,s.ai),this.mercatorBoundsBuffer=n.createVertexBuffer(b,s.ba.members),this.mercatorBoundsSegments=s.b8.simpleSegment(0,0,4,2);const T=new s.aV;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(T);const k=new s.b6;for(const L of[0,1,3,2,0])k.emplaceBack(L);this.debugIndexBuffer=n.createIndexBuffer(k),this.emptyTexture=new s.T(n,new s.r({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA8),this.identityMat=s.ad.mat4.create();const j=this.context.gl;this.stencilClearMode=new Mr({func:j.ALWAYS,mask:0},0,255,j.ZERO,j.ZERO,j.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,n.TRIANGLES,ir.disabled,this.stencilClearMode,zr.disabled,vr.disabled,Vu(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,l,m){if(!l||this.currentStencilSource===l.id||!n.isTileClipped()||!m||m.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let k=!1;for(const j of m)if(this._tileClippingMaskIDs[j.key]===void 0){k=!0;break}if(!k)return}this.currentStencilSource=l.id;const x=this.context,b=x.gl;this.nextStencilID+m.length>256&&this.clearStencil(),x.setColorMode(zr.disabled),x.setDepthMode(ir.disabled);const T=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const k of m){const j=l.getTile(k),L=this._tileClippingMaskIDs[k.key]=this.nextStencilID++,{tileBoundsBuffer:z,tileBoundsIndexBuffer:U,tileBoundsSegments:V}=this.getTileBoundsBuffers(j);T.draw(this,b.TRIANGLES,ir.disabled,new Mr({func:b.ALWAYS,mask:0},L,255,b.KEEP,b.KEEP,b.REPLACE),zr.disabled,vr.disabled,Vu(k.projMatrix),"$clipping",z,U,V)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,l=this.context.gl;return new Mr({func:l.NOTEQUAL,mask:255},n,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const l=this.context.gl;return new Mr({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(n){const l=this.context.gl,m=n.sort((T,k)=>k.overscaledZ-T.overscaledZ),x=m[m.length-1].overscaledZ,b=m[0].overscaledZ-x+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const T={};for(let k=0;k<b;k++)T[k+x]=new Mr({func:l.GEQUAL,mask:255},k+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=b,[T,m]}return[{[x]:Mr.disabled},m]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new zr([n.CONSTANT_COLOR,n.ONE,n.CONSTANT_COLOR,n.ONE],new s.al(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?zr.unblended:zr.alphaBlended}colorModeForDrapableLayerRenderPass(n){const l=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new zr([l.ONE,l.ONE_MINUS_SRC_ALPHA,l.CONSTANT_ALPHA,l.ONE_MINUS_SRC_ALPHA],new s.al(0,0,0,n===void 0?0:n),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(n,l,m,x=!1){if(this.depthOcclusion)return new ir(this.context.gl.GREATER,ir.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!x)return ir.disabled;const b=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new ir(m||this.context.gl.LEQUAL,l,[b,b])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const n=this.context.gl,l=Math.ceil(this.width),m=Math.ceil(this.height),x=this.context.bindFramebuffer.get(),b=n.getParameter(n.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===l&&this.depthFBO.height===m||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),l!==0&&m!==0&&(this.depthFBO=new $s(this.context,l,m,!1,"texture"),this.depthTexture=new s.T(this.context,{width:l,height:m,data:null},n.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(x),n.bindTexture(n.TEXTURE_2D,b),this.depthFBO&&(n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),n.blitFramebuffer(0,0,l,m,0,0,l,m,n.DEPTH_BUFFER_BIT,n.NEAREST),n.bindFramebuffer(n.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((n,l)=>n+l/this._fpsHistory.length,0))}render(n,l){const m=s.q.now();this._dt=m-this._timeStamp,this._timeStamp=m,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=n.map.repaint,this.style=n,this.options=l;const x=this.style._mergedLayers,b=!(!this.terrain||!this.terrain.enabled),T=()=>this.style._getOrder(b).filter(Ue=>{const at=x[Ue];return!(at.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[at.type]});let k=T(),j=!1,L=!1;for(const Ue of k){const at=x[Ue];at.type==="circle"&&(j=!0),at.type==="symbol"&&(at.hasInitialOcclusionOpacityProperties?L=!0:j=!0)}let z=k.map(Ue=>x[Ue]);const U=this.style._mergedSourceCaches;this.imageManager=n.imageManager,this.modelManager=n.modelManager,this.symbolFadeChange=n.placement.symbolFadeChange(s.q.now()),this.imageManager.beginFrame();let V=0,Y=!1;for(const Ue in U){const at=U[Ue];at.used&&(at.prepare(this.context),at.getSource().usedInConflation&&++V)}let te=!1;for(const Ue of z)Ue.isHidden(this.transform.zoom)||(Ue.type==="clip"&&(te=!0),this.prepareLayer(Ue));const K={},ne={},se={},me={},xe={};for(const Ue in U){const at=U[Ue];K[Ue]=at.getVisibleCoordinates(),ne[Ue]=K[Ue].slice().reverse(),se[Ue]=at.getVisibleCoordinates(!0).reverse(),me[Ue]=at.getShadowCasterCoordinates(),xe[Ue]=at.sortCoordinatesByDistance(K[Ue])}const ye=Ue=>{const at=this.style.getLayerSourceCache(Ue);return at&&at.used?at.getSource():null};if(V||te||this._clippingActiveLastFrame){const Ue=[],at=[];let Fe=0;for(const ot of z)this.isSourceForClippingOrConflation(ot,ye(ot))&&(Ue.push(ot),at.push(Fe)),Fe++;if(Ue&&(te||Ue.length>1)||this._clippingActiveLastFrame){te=!1;const ot=[];for(let rt=0;rt<Ue.length;rt++){const ht=Ue[rt],Je=at[rt],mt=this.style.getLayerSourceCache(ht);if(!mt||!mt.used||!mt.getSource().usedInConflation&&ht.type!=="clip")continue;let It=s.dA,kt=s.by.None;const Rt=[];let Yt=!0;if(ht.type==="clip"){It=Je;for(const Tr of ht.layout.get("clip-layer-types"))kt|=Tr==="model"?s.by.Model:Tr==="symbol"?s.by.Symbol:s.by.FillExtrusion;for(const Tr of ht.layout.get("clip-layer-scope"))Rt.push(Tr);ht.isHidden(this.transform.zoom)?Yt=!1:te=!0}Yt&&ot.push({layer:ht.fqid,cache:mt,order:It,clipMask:kt,clipScope:Rt})}this.replacementSource.setSources(ot),Y=!0}}this._clippingActiveLastFrame=te,Y||this.replacementSource.clear(),this.conflationActive=Y,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Ue=0;Ue<z.length;Ue++){const at=z[Ue],Fe=at.cutoffRange();if(this.longestCutoffRange=Math.max(Fe,this.longestCutoffRange),Fe>0){const ot=ye(at);ot&&(this.minCutoffZoom=Math.max(ot.minzoom,this.minCutoffZoom)),at.minzoom&&(this.minCutoffZoom=Math.max(at.minzoom,this.minCutoffZoom))}at.is3D(b)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Ue),this._lastOcclusionLayer=Ue)}const Ee=this.style&&this.style.fog;Ee?(this._fogVisible=Ee.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Ee.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(se),this.opaquePassCutoff=0,k=T(),z=k.map(Ue=>x[Ue]));const be=this._shadowRenderer;if(be){be.updateShadowParameters(this.transform,this.style.directionalLight);for(const Ue in U)for(const at of K[Ue]){let Fe={min:0,max:0};this.terrain&&(Fe=this.terrain.getMinMaxForTile(at)||Fe),be.addShadowReceiver(at.toUnwrapped(),Fe.min,Fe.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.dz(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new B0(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const we=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),Te=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(we&&!this._snow&&(this._snow=new ed(this)),!we&&this._snow&&(this._snow.destroy(),delete this._snow),Te&&!this._rain&&(this._rain=new J_(this)),!Te&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!bn.has(this.context.gl))return;this.renderPass="offscreen";for(const Ue of z){const at=n.getLayerSourceCache(Ue);if(!Ue.hasOffscreenPass()||Ue.isHidden(this.transform.zoom))continue;const Fe=at?ne[at.id]:void 0;(Ue.type==="custom"||Ue.type==="raster"||Ue.type==="raster-particle"||Ue.isSky()||Fe&&Fe.length)&&this.renderLayer(this,at,Ue,Fe)}this.depthRangeFor3D=[0,1-(z.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,me)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Pe=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Ne=(()=>{if(l.showOverdrawInspector)return s.al.black;const Ue=this.style.fog;if(Ue&&this.transform.projection.supportsFog){const at=this.style.getLut(Ue.scope);if(!Pe){const Fe=Ue.properties.get("color-use-theme")==="none",ot=Ue.properties.get("color").toRenderColor(Fe?null:at).toArray01();return new s.al(...ot)}if(Pe){const Fe=Ue.properties.get("space-color-use-theme")==="none",ot=Ue.properties.get("space-color").toRenderColor(Fe?null:at).toArray01();return new s.al(...ot)}}return s.al.transparent})();if(this.context.clear({color:Ne,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Pe&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=k.length-1;this.currentLayer>=0;this.currentLayer--){const Ue=z[this.currentLayer],at=n.getLayerSourceCache(Ue);if(Ue.isSky())continue;const Fe=at?(Ue.is3D(b)?xe:ne)[at.id]:void 0;this._renderTileClippingMasks(Ue,at,Fe),this.renderLayer(this,at,Ue,Fe)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Pe&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||s.ag(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<k.length;this.currentLayer++){const Ue=z[this.currentLayer],at=n.getLayerSourceCache(Ue);Ue.isSky()&&this.renderLayer(this,at,Ue,at?ne[at.id]:void 0)}function Ke(Ue,at){let Fe;return at&&(Fe=(Ue.type==="symbol"?se:Ue.is3D(b)?xe:ne)[at.id]),Fe}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<k.length;){const Ue=z[this.currentLayer];if(Ue.type==="raster"||Ue.type==="raster-particle"){const at=n.getLayerSourceCache(Ue);this.renderLayer(this,at,Ue,Ke(Ue,at))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let $e=0;be&&($e=be.getShadowCastingLayerCount());let lt=!1,dt=-1;for(let Ue=0;Ue<k.length;++Ue){const at=z[Ue];at.isHidden(this.transform.zoom)||at.is3D(b)&&(dt=Ue)}L&&dt===-1&&(j=!0);let vt=!1;for(;this.currentLayer<k.length;){const Ue=z[this.currentLayer],at=n.getLayerSourceCache(Ue);if(Ue.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Ue)){if(Ue.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!vt&&Ue.is3D(b)&&!b){const Fe=this.currentLayer,ot=rt=>{for(this.currentLayer=0;this.currentLayer<z.length;this.currentLayer++){const ht=z[this.currentLayer];if(Yp[ht.type]){const Je=this.style.getLayerSourceCache(ht);Yp[ht.type](this,Je,ht,Ke(ht,Je),rt)}}};ot("initialize"),ot("reset"),this.currentLayer=Fe,vt=!0}if(j&&!lt&&this.terrain&&!this.transform.isOrthographic&&(lt=!0,this.blitDepth()),L&&dt!==-1&&this.currentLayer===dt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Ue,at,at?K[at.id]:void 0),this.renderLayer(this,at,Ue,Ke(Ue,at)),!this.terrain&&be&&$e>0&&Ue.hasShadowPass()&&--$e==0&&(be.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const Fe=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Fe;this.currentLayer++){const ot=z[this.currentLayer];if(!ot.hasLightBeamPass())continue;const rt=n.getLayerSourceCache(ot);this.renderLayer(this,rt,ot,rt?ne[rt.id]:void 0)}this.currentLayer=Fe,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Fe=this.currentLayer;this.depthOcclusion=!0;for(const ot of this.layersWithOcclusionOpacity){this.currentLayer=ot;const rt=z[this.currentLayer],ht=n.getLayerSourceCache(rt),Je=ht?ne[ht.id]:void 0;this.terrain||this._renderTileClippingMasks(rt,ht,ht?K[ht.id]:void 0),this.renderLayer(this,ht,rt,Je)}this.depthOcclusion=!1,this.currentLayer=Fe,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Ue=null;z.forEach(at=>{const Fe=n.getLayerSourceCache(at);Fe&&!at.isHidden(this.transform.zoom)&&Fe.getVisibleCoordinates().length&&(!Ue||Ue.getSource().maxzoom<Fe.getSource().maxzoom)&&(Ue=Fe)}),Ue&&this.options.showTileBoundaries&&Zh.debug(this,Ue,Ue.getVisibleCoordinates(),s.al.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Zh.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new s.al(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Ue){const at=Ue.transform.padding;U_(Ue,Ue.transform.height-(at.top||0),3,Ku),U_(Ue,at.bottom||0,3,ES),$_(Ue,at.left||0,3,CS),$_(Ue,Ue.transform.width-(at.right||0),3,z0);const Fe=Ue.transform.centerPoint;(function(ot,rt,ht,Je){Fc(ot,rt-1,ht-10,2,20,Je),Fc(ot,rt-10,ht-1,20,2,Je)})(Ue,Fe.x,Ue.transform.height-Fe.y,Vp)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),Y||(this.conflationActive=!1)}prepareLayer(n){this.gpuTimingStart(n);const{unsupportedLayers:l}=this.transform.projection,m=!l||!l.includes(n.type);if(Zp[n.type]&&(m||this.terrain&&n.type==="custom")){const x=this.style.getLayerSourceCache(n);Zp[n.type](n,x,this)}this.gpuTimingEnd()}renderLayer(n,l,m,x){m.isHidden(this.transform.zoom)||(m.type==="background"||m.type==="sky"||m.type==="custom"||m.type==="model"||m.type==="raster"||m.type==="raster-particle"||x&&x.length)&&(this.id=m.id,this.gpuTimingStart(m),n.transform.projection.unsupportedLayers&&n.transform.projection.unsupportedLayers.includes(m.type)&&(!n.terrain||m.type!=="custom")||m.type==="clip"||Zh[m.type](n,l,m,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery,m=this.context.gl;let x=this.gpuTimers[n.id];x||(x=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:m.createQuery()}),x.calls++,m.beginQuery(l.TIME_ELAPSED_EXT,x.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const n=this.context.extTimerQuery,l=this.context.gl,m=l.createQuery();this.deferredRenderGpuTimeQueries.push(m),l.beginQuery(n.TIME_ELAPSED_EXT,m)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){const n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){const l={};for(const m in n){const x=n[m],b=this.context.extTimerQuery,T=b.getQueryParameter(x.query,this.context.gl.QUERY_RESULT)/1e6;b.deleteQueryEXT(x.query),l[m]=T}return l}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;const l=this.context.gl;let m=0;for(const x of n)m+=l.getQueryParameter(x,l.QUERY_RESULT)/1e6,l.deleteQuery(x);return m}translatePosMatrix(n,l,m,x,b){if(!m[0]&&!m[1])return n;const T=b?x==="map"?this.transform.angle:0:x==="viewport"?-this.transform.angle:0;if(T){const L=Math.sin(T),z=Math.cos(T);m=[m[0]*z-m[1]*L,m[0]*L+m[1]*z]}const k=[b?m[0]:s.at(l,m[0],this.transform.zoom),b?m[1]:s.at(l,m[1],this.transform.zoom),0],j=new Float32Array(16);return s.ad.mat4.translate(j,n,k),j}saveTileTexture(n){const l=n.size[0],m=this._tileTextures[l];m?m.push(n):this._tileTextures[l]=[n]}getTileTexture(n){const l=this._tileTextures[n];return l&&l.length>0?l.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(n,l,m){const x=m===void 0?this.terrain&&this.terrain.renderingToTexture:m,b=[];return this.style&&this.style.enable3dLights()&&(n==="globeRaster"||n==="terrainRaster"?(b.push("LIGHTING_3D_MODE"),b.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):x||b.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||b.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(b.push("TERRAIN"),this.linearFloatFilteringSupported()&&b.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&b.push("GLOBE"),!this._fogVisible||x||l!==void 0&&!l||b.push("FOG","FOG_DITHERING"),x&&b.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&b.push("OVERDRAW_INSPECTOR"),b}getOrCreateProgram(n,l){this.cache=this.cache||{};const m=l&&l.defines||[],x=l&&l.config,b=this.currentGlobalDefines(n,l&&l.overrideFog,l&&l.overrideRtt).concat(m),T=A0.cacheKey(Oh[n],n,b,x);return this.cache[T]||(this.cache[T]=new A0(this.context,n,Oh[n],x,D_[n],b)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(n,l){if(this.style.enable3dLights()){const m=this.style.directionalLight,x=this.style.ambientLight;if(m&&x){const b=((T,k,j)=>{const L=T.properties.get("direction"),z=T.properties.get("color-use-theme")==="none",U=T.properties.get("color").toRenderColor(z?null:j.getLut(T.scope)).toArray01(),V=T.properties.get("intensity"),Y=k.properties.get("color-use-theme")==="none",te=k.properties.get("color").toRenderColor(Y?null:j.getLut(k.scope)).toArray01(),K=k.properties.get("intensity"),ne=[L.x,L.y,L.z],se=s.cN(te,K),me=s.cN(U,V);return{u_lighting_ambient_color:se,u_lighting_directional_dir:ne,u_lighting_directional_color:me,u_ground_radiance:M0(ne,me,se)}})(m,x,this.style);l.setLightsUniformValues(n,b)}}}uploadCommonUniforms(n,l,m,x,b){if(this.uploadCommonLightUniforms(n,l),this.terrain&&this.terrain.renderingToTexture)return;const T=this.style.fog;if(T){const k=T.getOpacity(this.transform.pitch),j=((L,z,U,V,Y,te,K,ne,se,me,xe,ye)=>{const Ee=L.transform,be=z.properties.get("color-use-theme")==="none",we=z.properties.get("color").toRenderColor(be?null:L.style.getLut(z.scope)).toArray01();we[3]=V;const Te=L.frameCounter/1e3%1,[Pe,Ne]=z.properties.get("vertical-range");return{u_fog_matrix:U?Ee.calculateFogTileMatrix(U):ye||L.identityMat,u_fog_range:z.getFovAdjustedRange(Ee._fov),u_fog_color:we,u_fog_horizon_blend:z.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Pe,Ne),Ne],u_fog_temporal_offset:Te,u_frustum_tl:Y,u_frustum_tr:te,u_frustum_br:K,u_frustum_bl:ne,u_globe_pos:se,u_globe_radius:me,u_viewport:xe,u_globe_transition:s.ag(Ee.zoom),u_is_globe:+(Ee.projection.name==="globe")}})(this,T,m,k,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.q.devicePixelRatio,this.transform.height*s.q.devicePixelRatio],x);l.setFogUniformValues(n,j)}b&&l.setCutoffUniformValues(n,b.uniformValues)}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){const n=this.canvasCopy();n&&(this.frameCopies.push(n),this.tileLoaded=!1)}canvasCopy(){const n=this.context.gl,l=n.createTexture();return n.bindTexture(n.TEXTURE_2D,l),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),l}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&n.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const n=this._backgroundTiles,l=this._backgroundTiles={},m=this.transform.coveringTiles({tileSize:512});for(const x of m)l[x.key]=n[x.key]||new sa(x,512,this.transform.tileZoom,this);return l}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(n,l){return!(!n.is3D(!(!this.terrain||!this.terrain.enabled))||n.type!=="clip"&&(n.minzoom&&n.minzoom>this.transform.zoom||(this.style._clipLayerPresent||n.sourceLayer!=="building")&&(!l||l.type!=="batched-model")))}isTileAffectedByFog(n){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let l=this._cachedTileFogOpacities[n.key];return l||(this._cachedTileFogOpacities[n.key]=l=this.style.fog.getOpacityForTile(n)),l[0]>=Lt||l[1]>=Lt}setupDepthForOcclusion(n,l,m){const x=this.context,b=x.gl,T=!!m;var k;m||(m={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),x.activeTexture.set(b.TEXTURE3),n&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),m.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],m.u_depth_range_unpack=[2/((k=this.depthRangeFor3D)[1]-k[0]),-1-2*k[0]/(k[1]-k[0])],m.u_occluder_half_size=.5*this.occlusionParams.occluderSize,m.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),x.activeTexture.set(b.TEXTURE0),T||l.setTerrainUniformValues(x,m)}}function Kp(g,n){let l=!1,m=null;const x=()=>{m=null,l&&(g(),m=setTimeout(x,n),l=!1)};return()=>(l=!0,m||x(),m)}class ey{constructor(n){this._hashName=n&&encodeURIComponent(n),s.aQ(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Kp(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const n=this._map;if(!n)return"";const l=ty(n);if(this._hashName){const m=this._hashName;let x=!1;const b=location.hash.slice(1).split("&").map(T=>{const k=T.split("=")[0];return k===m?(x=!0,`${k}=${l}`):T}).filter(T=>T);return x||b.push(`${m}=${l}`),`#${b.join("&")}`}return`#${l}`}_getCurrentHash(){const n=location.hash.replace("#","");if(this._hashName){let l;return n.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(l=m)}),(l&&l[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._map;if(!n)return!1;const l=this._getCurrentHash();if(l.length>=3&&!l.some(m=>isNaN(m))){const m=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(l[3]||0):n.getBearing();return n.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:m,pitch:+(l[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function ty(g,n){const l=g.getCenter(),m=Math.round(100*g.getZoom())/100,x=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,x),T=Math.round(l.lng*b)/b,k=Math.round(l.lat*b)/b,j=g.getBearing(),L=g.getPitch();let z=n?`/${T}/${k}/${m}`:`${m}/${k}/${T}`;return(j||L)&&(z+="/"+Math.round(10*j)/10),L&&(z+=`/${Math.round(L)}`),z}const Yh={linearity:.3,easing:s.dB(0,0,.3,1)},V0=s.l({deceleration:2500,maxSpeed:1400},Yh),U0=s.l({deceleration:20,maxSpeed:1400},Yh),$0=s.l({deceleration:1e3,maxSpeed:360},Yh),G0=s.l({deceleration:1e3,maxSpeed:90},Yh);class q0{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.q.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,l=s.q.now();for(;n.length>0&&l-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const l={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)l.zoom+=b.zoomDelta||0,l.bearing+=b.bearingDelta||0,l.pitch+=b.pitchDelta||0,b.panDelta&&l.pan._add(b.panDelta),b.around&&(l.around=b.around),b.pinchAround&&(l.pinchAround=b.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(l.pan.mag()){const b=Kh(l.pan.mag(),m,s.l({},V0,n||{}));x.offset=l.pan.mult(b.amount/l.pan.mag()),x.center=this._map.transform.center,Xh(x,b)}if(l.zoom){const b=Kh(l.zoom,m,U0);x.zoom=this._map.transform.zoom+b.amount,Xh(x,b)}if(l.bearing){const b=Kh(l.bearing,m,$0);x.bearing=this._map.transform.bearing+s.ay(b.amount,-179,179),Xh(x,b)}if(l.pitch){const b=Kh(l.pitch,m,G0);x.pitch=this._map.transform.pitch+b.amount,Xh(x,b)}if(x.zoom||x.bearing){const b=l.pinchAround===void 0?l.around:l.pinchAround;x.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),x.noMoveStart=!0,x}}function Xh(g,n){(!g.duration||g.duration<n.duration)&&(g.duration=n.duration,g.easing=n.easing)}function Kh(g,n,l){const{maxSpeed:m,linearity:x,deceleration:b}=l,T=s.ay(g*x/(n/1e3),-m,m),k=Math.abs(T)/(b*x);return{easing:l.easing,duration:1e3*k,amount:T*(k/2)}}class Ks extends s.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,l,m,x={}){const b=ct(l.getCanvasContainer(),m),T=l.unproject(b);super(n,s.l({point:b,lngLat:T,originalEvent:m},x)),this._defaultPrevented=!1,this.target=l}}class Jh extends s.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,l,m){const x=n==="touchend"?m.changedTouches:m.touches,b=pt(l.getCanvasContainer(),x),T=b.map(j=>l.unproject(j)),k=b.reduce((j,L,z,U)=>j.add(L.div(U.length)),new s.P(0,0));super(n,{points:b,point:k,lngLats:T,lngLat:l.unproject(k),originalEvent:m}),this._defaultPrevented=!1}}class H0 extends s.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,l){super("wheel",{originalEvent:l}),this._defaultPrevented=!1}}class W0{constructor(n,l){this._map=n,this._clickTolerance=l.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new H0(this._map,n))}mousedown(n,l){return this._mousedownPos=l,this._firePreventable(new Ks(n.type,this._map,n))}mouseup(n){this._map.fire(new Ks(n.type,this._map,n))}preclick(n){const l=s.l({},n);l.type="preclick",this._map.fire(new Ks(l.type,this._map,l))}click(n,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||(this.preclick(n),this._map.fire(new Ks(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new Ks(n.type,this._map,n))}mouseover(n){this._map.fire(new Ks(n.type,this._map,n))}mouseout(n){this._map.fire(new Ks(n.type,this._map,n))}touchstart(n){return this._firePreventable(new Jh(n.type,this._map,n))}touchmove(n){this._map.fire(new Jh(n.type,this._map,n))}touchend(n){this._map.fire(new Jh(n.type,this._map,n))}touchcancel(n){this._map.fire(new Jh(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class AS{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new Ks(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ks("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new Ks(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class PS{constructor(n,l){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,l){this.isEnabled()&&n.shiftKey&&n.button===0&&(Se(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(n,l){if(!this._active)return;const m=l,x=this._startPos,b=this._lastPos;if(!x||!b||b.equals(m)||!this._box&&m.dist(x)<this._clickTolerance)return;this._lastPos=m,this._box||(this._box=Q("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const T=Math.min(x.x,m.x),k=Math.max(x.x,m.x),j=Math.min(x.y,m.y),L=Math.max(x.y,m.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${T}px,${j}px)`,this._box.style.width=k-T+"px",this._box.style.height=L-j+"px")})}mouseupWindow(n,l){if(!this._active)return;const m=this._startPos,x=l;if(m&&n.button===0){if(this.reset(),qe(),m.x!==x.x||m.y!==x.y)return this._map.fire(new s.A("boxzoomend",{originalEvent:n})),{cameraAnimation:b=>b.fitScreenCoordinates(m,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),je(),delete this._startPos,delete this._lastPos}_fireEvent(n,l){return this._map.fire(new s.A(n,{originalEvent:l}))}}function Hn(g,n){const l={};for(let m=0;m<g.length;m++)l[g[m].identifier]=n[m];return l}class Z0{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,l,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=n.timeStamp),m.length===this.numTouches&&(this.centroid=function(x){const b=new s.P(0,0);for(const T of x)b._add(T);return b.div(x.length)}(l),this.touches=Hn(m,l)))}touchmove(n,l,m){if(this.aborted||!this.centroid)return;const x=Hn(m,l);for(const b in this.touches){const T=x[b];(!T||T.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(n,l,m){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),m.length===0){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class ry{constructor(n){this.singleTap=new Z0(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,l,m){this.singleTap.touchstart(n,l,m)}touchmove(n,l,m){this.singleTap.touchmove(n,l,m)}touchend(n,l,m){const x=this.singleTap.touchend(n,l,m);if(x){const b=n.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(x)<30;if(b&&T||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class IS{constructor(){this._zoomIn=new ry({numTouches:1,numTaps:2}),this._zoomOut=new ry({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,l,m){this._zoomIn.touchstart(n,l,m),this._zoomOut.touchstart(n,l,m)}touchmove(n,l,m){this._zoomIn.touchmove(n,l,m),this._zoomOut.touchmove(n,l,m)}touchend(n,l,m){const x=this._zoomIn.touchend(n,l,m),b=this._zoomOut.touchend(n,l,m);return x?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(x)},{originalEvent:n})}):b?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(b)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Qh={0:1,2:2},ny={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class ef{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,l){return!1}_move(n,l){return{}}mousedown(n,l){if(this._lastPoint)return;const m=Ze(n);this._correctButton(n,m)&&(this._lastPoint=l,this._eventButton=m)}mousemoveWindow(n,l){const m=this._lastPoint;if(m){if(n.preventDefault(),this._eventButton!=null&&function(x,b){const T=Qh[b];return x.buttons===void 0||(x.buttons&T)!==T}(n,this._eventButton))this.reset();else if(this._moved||!(l.dist(m)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(m,l)}}mouseupWindow(n){this._lastPoint&&Ze(n)===this._eventButton&&(this._moved&&qe(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Jp extends ef{mousedown(n,l){super.mousedown(n,l),this._lastPoint&&(this._active=!0)}_correctButton(n,l){return l===0&&!n.ctrlKey}_move(n,l){return{around:l,panDelta:l.sub(n)}}}class Da extends ef{constructor(n){super(n),this._pitchRotateKey=n.pitchRotateKey?ny[n.pitchRotateKey]:void 0}_correctButton(n,l){return this._pitchRotateKey?l===0&&n[this._pitchRotateKey]:l===0&&n.ctrlKey||l===2}_move(n,l){const m=.8*(l.x-n.x);if(m)return this._active=!0,{bearingDelta:m}}contextmenu(n){this._pitchRotateKey||n.preventDefault()}}class tf extends ef{constructor(n){super(n),this._pitchRotateKey=n.pitchRotateKey?ny[n.pitchRotateKey]:void 0}_correctButton(n,l){return this._pitchRotateKey?l===0&&n[this._pitchRotateKey]:l===0&&n.ctrlKey||l===2}_move(n,l){const m=-.5*(l.y-n.y);if(m)return this._active=!0,{pitchDelta:m}}contextmenu(n){this._pitchRotateKey||n.preventDefault()}}class Ti{constructor(n,l){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset(),s.aQ(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}touchstart(n,l,m){return this._calculateTransform(n,l,m)}touchmove(n,l,m){if(this._active&&!(m.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(m.length===1&&!s.dC())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,l,m)}}touchend(n,l,m){this._calculateTransform(n,l,m),this._active&&m.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,l,m){m.length>0&&(this._active=!0);const x=Hn(m,l),b=new s.P(0,0),T=new s.P(0,0);let k=0;for(const L in x){const z=x[L],U=this._touches[L];U&&(b._add(z),T._add(z.sub(U)),k++,x[L]=z)}if(this._touches=x,k<this._minTouches||!T.mag())return;const j=T.div(k);return this._sum._add(j),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(k),panDelta:j}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Q("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Bo{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,l,m){return{}}touchstart(n,l,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([l[0],l[1]]))}touchmove(n,l,m){const x=this._firstTwoTouches;if(!x)return;n.preventDefault();const[b,T]=x,k=td(m,l,b),j=td(m,l,T);if(!k||!j)return;const L=this._aroundCenter?null:k.add(j).div(2);return this._move([k,j],L,n)}touchend(n,l,m){if(!this._firstTwoTouches)return;const[x,b]=this._firstTwoTouches,T=td(m,l,x),k=td(m,l,b);T&&k||(this._active&&qe(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function td(g,n,l){for(let m=0;m<g.length;m++)if(g[m].identifier===l)return n[m]}function rf(g,n){return Math.log(g/n)/Math.LN2}class Y0 extends Bo{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,l){const m=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(rf(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:rf(this._distance,m),pinchAround:l}}}function X0(g,n){return 180*g.angleWith(n)/Math.PI}class nf extends Bo{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,l){const m=this._vector;if(this._vector=n[0].sub(n[1]),m&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:X0(this._vector,m),pinchAround:l}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const l=25/(Math.PI*this._minDiameter)*360,m=this._startVector;if(!m)return!1;const x=X0(n,m);return Math.abs(x)<l}}function iy(g){return Math.abs(g.y)>Math.abs(g.x)}class kS extends Bo{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,iy(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,l,m){const x=this._lastPoints;if(!x)return;const b=n[0].sub(x[0]),T=n[1].sub(x[1]);return this._map._cooperativeGestures&&!s.dC()&&m.touches.length<3||(this._valid=this.gestureBeginsVertically(b,T,m.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(b.y+T.y)/2*-.5})}gestureBeginsVertically(n,l,m){if(this._valid!==void 0)return this._valid;const x=n.mag()>=2,b=l.mag()>=2;if(!x&&!b)return;if(!x||!b)return this._firstMove==null&&(this._firstMove=m),m-this._firstMove<100&&void 0;const T=n.y>0==l.y>0;return iy(n)&&iy(l)&&T}}const sy={panStep:100,bearingStep:15,pitchStep:10};class oy{constructor(){const n=sy;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let l=0,m=0,x=0,b=0,T=0;switch(n.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:n.shiftKey?m=-1:(n.preventDefault(),b=-1);break;case 39:n.shiftKey?m=1:(n.preventDefault(),b=1);break;case 38:n.shiftKey?x=1:(n.preventDefault(),T=-1);break;case 40:n.shiftKey?x=-1:(n.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(m=0,x=0),{cameraAnimation:k=>{const j=k.getZoom();k.easeTo({duration:300,easeId:"keyboardHandler",easing:sf,zoom:l?Math.round(j)+l*(n.shiftKey?2:1):j,bearing:k.getBearing()+m*this._bearingStep,pitch:k.getPitch()+x*this._pitchStep,offset:[-b*this._panStep,-T*this._panStep],center:k.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function sf(g){return g*(2-g)}const Uc=4.000244140625,hl=1/450;class ua{constructor(n,l){this._map=n,this._el=n.getCanvasContainer(),this._handler=l,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=hl,s.aQ(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||s.dC()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let l=n.deltaMode===WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const m=s.q.now(),x=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,l!==0&&l%Uc==0?this._type="wheel":l!==0&&Math.abs(l)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=l,this._timeout=window.setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(x*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),n.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=n,this._delta-=l,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=ct(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:l,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform;this._type==="wheel"&&n.projection.wrap&&(n._center.lng>=180||n._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const l=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(this._delta!==0){const L=this._type==="wheel"&&Math.abs(this._delta)>Uc?this._wheelZoomRate:this._defaultZoomRate;let z=2/(1+Math.exp(-Math.abs(this._delta*L)));this._delta<0&&z!==0&&(z=1/z);const U=l(),V=Math.pow(2,U),Y=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):V;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(Y*z))),this._type==="wheel"&&(this._startZoom=U,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const m=typeof this._targetZoom=="number"?this._targetZoom:l(),x=this._startZoom,b=this._easing;let T,k=!1;if(this._type==="wheel"&&x&&b){const L=Math.min((s.q.now()-this._lastWheelEventTime)/200,1),z=b(L);T=s.ah(x,m,z),L<1?this._frameId||(this._frameId=!0):k=!0}else T=m,k=!0;this._active=!0,k&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let j=T-l();return j*this._lastDelta<0&&(j=0),{noInertia:!0,needsRenderFrame:!k,zoomDelta:j,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let l=s.dD;if(this._prevEase){const m=this._prevEase,x=(s.q.now()-m.start)/m.duration,b=m.easing(x+.01)-m.easing(x),T=.27/Math.sqrt(b*b+1e-4)*.01,k=Math.sqrt(.0729-T*T);l=s.dB(T,k,.25,1)}return this._prevEase={start:s.q.now(),duration:n,easing:l},l}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Q("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class nc{constructor(n,l){this._clickZoom=n,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class $c{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,l){return n.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:m.getZoom()+(n.shiftKey?-1:1),around:m.unproject(l)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ic{constructor(){this._tap=new ry({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,l,m){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?m.length>0&&(this._swipePoint=l[0],this._swipeTouch=m[0].identifier):this._tap.touchstart(n,l,m))}touchmove(n,l,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const x=l[0],b=x.y-this._swipePoint.y;return this._swipePoint=x,n.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(n,l,m)}touchend(n,l,m){this._tapTime?this._swipePoint&&m.length===0&&this.reset():this._tap.touchend(n,l,m)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class NS{constructor(n,l,m){this._el=n,this._mousePan=l,this._touchPan=m}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class RS{constructor(n,l,m){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=l,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class jS{constructor(n,l,m,x){this._el=n,this._touchZoom=l,this._touchRotate=m,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Qp=g=>g.zoom||g.drag||g.pitch||g.rotate;class K0 extends s.A{}class Os{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,l){const m=s.ad.vec3.sub([],l,n);this.radius=s.ad.vec3.length(m[2]<0?s.ad.vec3.div([],m,this.constants):[m[0],m[1],0])}projectRay(n){s.ad.vec3.div(n,n,this.constants),s.ad.vec3.normalize(n,n),s.ad.vec3.mul(n,n,this.constants);const l=s.ad.vec3.scale([],n,this.radius);if(l[2]>0){const m=s.ad.vec3.scale([],[0,0,1],s.ad.vec3.dot(l,[0,0,1])),x=s.ad.vec3.scale([],s.ad.vec3.normalize([],[l[0],l[1],0]),this.radius),b=s.ad.vec3.add([],l,s.ad.vec3.scale([],s.ad.vec3.sub([],s.ad.vec3.add([],x,m),l),2));l[0]=b[0],l[1]=b[1]}return l}}function rd(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class J0{constructor(n,l){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new q0(n),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Os,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(l),s.aQ(["handleEvent","handleWindowEvent"],this);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[window,"blur",void 0]];for(const[x,b,T]of this._listeners){const k=x===document?this.handleWindowEvent:this.handleEvent;x.addEventListener(b,k,T)}}destroy(){for(const[n,l,m]of this._listeners){const x=n===document?this.handleWindowEvent:this.handleEvent;n.removeEventListener(l,x,m)}}_addDefaultHandlers(n){const l=this._map,m=l.getCanvasContainer();this._add("mapEvent",new W0(l,n));const x=l.boxZoom=new PS(l,n);this._add("boxZoom",x);const b=new IS,T=new $c;l.doubleClickZoom=new nc(T,b),this._add("tapZoom",b),this._add("clickZoom",T);const k=new ic;this._add("tapDragZoom",k);const j=l.touchPitch=new kS(l);this._add("touchPitch",j);const L=new Da(n),z=new tf(n);l.dragRotate=new RS(n,L,z),this._add("mouseRotate",L,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]);const U=new Jp(n),V=new Ti(l,n);l.dragPan=new NS(m,U,V),this._add("mousePan",U),this._add("touchPan",V,["touchZoom","touchRotate"]);const Y=new nf,te=new Y0;l.touchZoomRotate=new jS(m,te,Y,k),this._add("touchRotate",Y,["touchPan","touchZoom"]),this._add("touchZoom",te,["touchPan","touchRotate"]),this._add("blockableMapEvent",new AS(l));const K=l.scrollZoom=new ua(l,this);this._add("scrollZoom",K,["mousePan"]);const ne=l.keyboard=new oy;this._add("keyboard",ne);for(const se of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[se]&&l[se].enable(n[se])}_add(n,l,m){this._handlers.push({handlerName:n,handler:l,allowed:m}),this._handlersById[n]=l}stop(n){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Qp(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(n,l,m){for(const x in n)if(x!==m&&(!l||l.indexOf(x)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const l=[];for(const m of n)this._el.contains(m.target)&&l.push(m);return l}handleEvent(n,l){this._updatingCamera=!0;const m=n.type==="renderFrame",x=m?void 0:n,b={needsRenderFrame:!1},T={},k={},j=n.touches?this._getMapTouches(n.touches):void 0,L=j?pt(this._el,j):m?void 0:ct(this._el,n);for(const{handlerName:V,handler:Y,allowed:te}of this._handlers){if(!Y.isEnabled())continue;let K;this._blockedByActive(k,te,V)?Y.reset():Y[l||n.type]&&(K=Y[l||n.type](n,L,j),this.mergeHandlerResult(b,T,K,V,x),K&&K.needsRenderFrame&&this._triggerRenderFrame()),(K||Y.isActive())&&(k[V]=Y)}const z={};for(const V in this._previousActiveHandlers)k[V]||(z[V]=x);this._previousActiveHandlers=k,(Object.keys(z).length||rd(b))&&(this._changes.push([b,T,z]),this._triggerRenderFrame()),(Object.keys(k).length||rd(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=b;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))}mergeHandlerResult(n,l,m,x,b){if(!m)return;s.l(n,m);const T={handlerName:x,originalEvent:m.originalEvent||b};m.zoomDelta!==void 0&&(l.zoom=T),m.panDelta!==void 0&&(l.drag=T),m.pitchDelta!==void 0&&(l.pitch=T),m.bearingDelta!==void 0&&(l.rotate=T)}_applyChanges(){const n={},l={},m={};for(const[x,b,T]of this._changes)x.panDelta&&(n.panDelta=(n.panDelta||new s.P(0,0))._add(x.panDelta)),x.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+x.pitchDelta),x.around!==void 0&&(n.around=x.around),x.aroundCoord!==void 0&&(n.aroundCoord=x.aroundCoord),x.pinchAround!==void 0&&(n.pinchAround=x.pinchAround),x.noInertia&&(n.noInertia=x.noInertia),s.l(l,b),s.l(m,T);this._updateMapTransform(n,l,m),this._changes=[]}_updateMapTransform(n,l,m){const x=this._map,b=x.transform,T=me=>[me.x,me.y,me.z];if((me=>{const xe=this._eventsInProgress.drag;return xe&&!this._handlersById[xe.handlerName].isActive()})()&&!rd(n)){const me=b.zoom;b.cameraElevationReference="sea",this._originalZoom!=null&&b._orthographicProjectionAtLowPitch&&b.projection.name!=="globe"&&b.pitch===0?(b.cameraElevationReference="ground",b.zoom=this._originalZoom):(b.recenterOnTerrain(),b.cameraElevationReference="ground"),me!==b.zoom&&this._map._update(!0)}if(b._isCameraConstrained&&x._stop(!0),!rd(n))return void this._fireEvents(l,m,!0);let{panDelta:k,zoomDelta:j,bearingDelta:L,pitchDelta:z,around:U,aroundCoord:V,pinchAround:Y}=n;b._isCameraConstrained&&(j>0&&(j=0),b._isCameraConstrained=!1),Y!==void 0&&(U=Y),(j||(me=>l[me]&&!this._eventsInProgress[me])("drag"))&&U&&(this._dragOrigin=T(b.pointCoordinate3D(U)),this._originalZoom=b.zoom,this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",x._stop(!0),U=U||x.transform.centerPoint,L&&(b.bearing+=L),z&&(b.pitch+=z),b._updateCameraState();const te=[0,0,0];if(k)if(b.projection.name==="mercator"){const me=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(U).dir),xe=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(U.sub(k)).dir);te[0]=xe[0]-me[0],te[1]=xe[1]-me[1]}else{const me=b.pointCoordinate(U);if(b.projection.name==="globe"){k=k.rotate(-b.angle);const xe=b._pixelsPerMercatorPixel/b.worldSize;te[0]=-k.x*s.dE(s.aT(me.y))*xe,te[1]=-k.y*s.dE(b.center.lat)*xe}else{const xe=b.pointCoordinate(U.sub(k));me&&xe&&(te[0]=xe.x-me.x,te[1]=xe.y-me.y)}}const K=b.zoom,ne=[0,0,0];if(j){const me=T(V||b.pointCoordinate3D(U)),xe={dir:s.ad.vec3.normalize([],s.ad.vec3.sub([],me,b._camera.position))};if(xe.dir[2]<0){const ye=b.zoomDeltaToMovement(me,j);s.ad.vec3.scale(ne,xe.dir,ye)}}const se=s.ad.vec3.add(te,te,ne);b._translateCameraConstrained(se),j&&Math.abs(b.zoom-K)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(l,m,!0)}_fireEvents(n,l,m){const x=Qp(this._eventsInProgress),b=Qp(n),T={};for(const z in n){const{originalEvent:U}=n[z];this._eventsInProgress[z]||(T[`${z}start`]=U),this._eventsInProgress[z]=n[z]}!x&&b&&this._fireEvent("movestart",b.originalEvent);for(const z in T)this._fireEvent(z,T[z]);b&&this._fireEvent("move",b.originalEvent);for(const z in n){const{originalEvent:U}=n[z];this._fireEvent(z,U)}const k={};let j;for(const z in this._eventsInProgress){const{handlerName:U,originalEvent:V}=this._eventsInProgress[z];this._handlersById[U].isActive()||(delete this._eventsInProgress[z],j=l[U]||V,k[`${z}end`]=j)}for(const z in k)this._fireEvent(z,k[z]);const L=Qp(this._eventsInProgress);if(m&&(x||b)&&!L){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),U=V=>V!==0&&-this._bearingSnap<V&&V<this._bearingSnap;z?(U(z.bearing||this._map.getBearing())&&(z.bearing=0),this._map.easeTo(z,{originalEvent:j})):(this._map.fire(new s.A("moveend",{originalEvent:j})),U(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,l){this._map.fire(new s.A(n,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{this._frameId=void 0,this.handleEvent(new K0("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Q0="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class nd extends s.E{constructor(n,l){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=l.bearingSnap,this._respectPrefersReducedMotion=l.respectPrefersReducedMotion!==!1,s.aQ(["_renderFrameCallback"],this)}getCenter(){return new s.bO(this.transform.center.lng,this.transform.center.lat)}setCenter(n,l){return this.jumpTo({center:n},l)}panBy(n,l,m){return n=s.P.convert(n).mult(-1),this.panTo(this.transform.center,s.l({offset:n},l),m)}panTo(n,l,m){return this.easeTo(s.l({center:n},l),m)}getZoom(){return this.transform.zoom}setZoom(n,l){return this.jumpTo({zoom:n},l),this}zoomTo(n,l,m){return this.easeTo(s.l({zoom:n},l),m)}zoomIn(n,l){return this.zoomTo(this.getZoom()+1,n,l),this}zoomOut(n,l){return this.zoomTo(this.getZoom()-1,n,l),this}getBearing(){return this.transform.bearing}setBearing(n,l){return this.jumpTo({bearing:n},l),this}getPadding(){return this.transform.padding}setPadding(n,l){return this.jumpTo({padding:n},l),this}rotateTo(n,l,m){return this.easeTo(s.l({bearing:n},l),m)}resetNorth(n,l){return this.rotateTo(0,s.l({duration:1e3},n),l),this}resetNorthPitch(n,l){return this.easeTo(s.l({bearing:0,pitch:0,duration:1e3},n),l),this}snapToNorth(n,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,l):this}getPitch(){return this.transform.pitch}setPitch(n,l){return this.jumpTo({pitch:n},l),this}cameraForBounds(n,l){n=s.aB.convert(n);const m=l&&l.bearing||0,x=l&&l.pitch||0,b=n.getNorthWest(),T=n.getSouthEast();return this._cameraForBounds(this.transform,b,T,m,x,l)}_extendPadding(n){const l={top:0,right:0,bottom:0,left:0};return n==null?s.l({},l,this.transform.padding):typeof n=="number"?{top:n,bottom:n,right:n,left:n}:s.l({},l,n)}_extendCameraOptions(n){return(n=s.l({offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding=this._extendPadding(n.padding),n}_minimumAABBFrustumDistance(n,l){const m=l.max[0]-l.min[0],x=l.max[1]-l.min[1];return m/x>n.aspect?m/(2*Math.tan(.5*n.fovX)*n.aspect):x/(2*Math.tan(.5*n.fovY)*n.aspect)}_cameraForBoundsOnGlobe(n,l,m,x,b,T){const k=n.clone(),j=this._extendCameraOptions(T);k.bearing=x,k.pitch=b;const L=s.bO.convert(l),z=s.bO.convert(m),U=.5*(L.lat+z.lat),V=.5*(L.lng+z.lng),Y=s.dF(U,V),te=s.ad.vec3.normalize([],Y),K=s.ad.vec3.normalize([],s.ad.vec3.cross([],te,[0,1,0])),ne=s.ad.vec3.cross([],K,te),se=[K[0],K[1],K[2],0,ne[0],ne[1],ne[2],0,te[0],te[1],te[2],0,0,0,0,1],me=[Y,s.dF(L.lat,L.lng),s.dF(z.lat,L.lng),s.dF(z.lat,z.lng),s.dF(L.lat,z.lng),s.dF(U,L.lng),s.dF(U,z.lng),s.dF(L.lat,V),s.dF(z.lat,V)];let xe=s.ce.fromPoints(me.map(rt=>[s.ad.vec3.dot(K,rt),s.ad.vec3.dot(ne,rt),s.ad.vec3.dot(te,rt)]));const ye=s.ad.vec3.transformMat4([],xe.center,se);s.ad.vec3.squaredLength(ye)===0&&s.ad.vec3.set(ye,0,0,1),s.ad.vec3.normalize(ye,ye),s.ad.vec3.scale(ye,ye,s.az),k.center=s.dG(ye);const Ee=k.getWorldToCameraMatrix(),be=s.ad.mat4.invert(new Float64Array(16),Ee);xe=s.ce.applyTransform(xe,s.ad.mat4.multiply([],Ee,se));const we=this._extendAABB(xe,k,j,x);if(!we)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");xe=we,s.ad.vec3.transformMat4(ye,ye,Ee);const Te=.5*(xe.max[2]-xe.min[2]),Pe=this._minimumAABBFrustumDistance(k,xe),Ne=s.ad.vec3.scale([],[0,0,1],Te),Ke=s.ad.vec3.add(Ne,ye,Ne),$e=Pe+(k.pitch===0?0:s.ad.vec3.distance(ye,Ke)),lt=k.globeCenterInViewSpace,dt=s.ad.vec3.sub([],ye,[lt[0],lt[1],lt[2]]);s.ad.vec3.normalize(dt,dt),s.ad.vec3.scale(dt,dt,$e);const vt=s.ad.vec3.add([],ye,dt);s.ad.vec3.transformMat4(vt,vt,be);const Ue=s.dv/s.az,at=s.ad.vec3.length(vt),Fe=s.bH(Math.max(at*Ue-s.dv,Number.EPSILON),0),ot=Math.min(k.zoomFromMercatorZAdjusted(Fe),j.maxZoom);return ot>.5*(s.c6+s.bY)?(k.setProjection({name:"mercator"}),k.zoom=ot,this._cameraForBounds(k,l,m,x,b,T)):{center:k.center,zoom:ot,bearing:x,pitch:b}}_extendAABB(n,l,m,x){const b=.5*((m.padding.left||0)+(m.padding.right||0)),T=.5*((m.padding.top||0)+(m.padding.bottom||0)),k=T,j=b,L=b,z=T,U=l.width-(j+L),V=l.height-(k+z),Y=s.ad.vec3.sub([],n.max,n.min),te=Math.min(U/Y[0],V/Y[1]),K=Math.min(l.scaleZoom(l.scale*te),m.maxZoom);if(isNaN(K))return null;const ne=l.scale/l.zoomScale(K),se=new s.ce([n.min[0]-j*ne,n.min[1]-z*ne,n.min[2]],[n.max[0]+L*ne,n.max[1]+k*ne,n.max[2]]),me=(typeof m.offset.x=="number"&&typeof m.offset.y=="number"?new s.P(m.offset.x,m.offset.y):s.P.convert(m.offset)).rotate(-s.ak(x));return se.center[0]-=me.x*ne,se.center[1]+=me.y*ne,se}queryTerrainElevation(n,l){const m=this.transform.elevation;return m?(l=s.l({},{exaggerated:!0},l),m.getAtPoint(s.ac.fromLngLat(n),null,l.exaggerated)):null}_cameraForBounds(n,l,m,x,b,T){if(n.projection.name==="globe")return this._cameraForBoundsOnGlobe(n,l,m,x,b,T);const k=n.clone(),j=this._extendCameraOptions(T);k.bearing=x,k.pitch=b;const L=s.bO.convert(l),z=s.bO.convert(m),U=new s.bO(L.lng,z.lat),V=new s.bO(z.lng,L.lat),Y=k.project(L),te=k.project(z),K=this.queryTerrainElevation(L),ne=this.queryTerrainElevation(z),se=this.queryTerrainElevation(U),me=this.queryTerrainElevation(V),xe=[[Y.x,Y.y,Math.min(K||0,ne||0,se||0,me||0)],[te.x,te.y,Math.max(K||0,ne||0,se||0,me||0)]];let ye=s.ce.fromPoints(xe);const Ee=k.getWorldToCameraMatrix(),be=s.ad.mat4.invert(new Float64Array(16),Ee);ye=s.ce.applyTransform(ye,Ee);const we=this._extendAABB(ye,k,j,x);if(!we)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ye=we;const Te=.5*s.ad.vec3.sub([],ye.max,ye.min)[2],Pe=this._minimumAABBFrustumDistance(k,ye),Ne=[0,0,1,0];s.ad.vec4.transformMat4(Ne,Ne,Ee),s.ad.vec4.normalize(Ne,Ne);const Ke=s.ad.vec3.scale([],Ne,Pe+Te),$e=s.ad.vec3.add([],ye.center,Ke);s.ad.vec3.transformMat4(ye.center,ye.center,be),s.ad.vec3.transformMat4($e,$e,be);const lt=k.unproject(new s.P(ye.center[0],ye.center[1])),dt=s.dH(k.projection,lt),vt=Math.pow(2,dt),Ue=Math.min(k._zoomFromMercatorZ($e[2]*k.pixelsPerMeter*vt/k.worldSize),j.maxZoom);return k.mercatorFromTransition&&Ue<.5*(s.c6+s.bY)?(k.setProjection({name:"globe"}),k.zoom=Ue,this._cameraForBounds(k,l,m,x,b,T)):{center:lt,zoom:Ue,bearing:x,pitch:b}}fitBounds(n,l,m){const x=this.cameraForBounds(n,l);return this._fitInternal(x,l,m)}fitScreenCoordinates(n,l,m,x,b){const T=s.P.convert(n),k=s.P.convert(l),j=new s.P(Math.min(T.x,k.x),Math.min(T.y,k.y)),L=new s.P(Math.max(T.x,k.x),Math.max(T.y,k.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(T,k))return this;const z=this.transform.pointLocation3D(j),U=this.transform.pointLocation3D(L),V=this.transform.pointLocation3D(new s.P(j.x,L.y)),Y=this.transform.pointLocation3D(new s.P(L.x,j.y)),te=[Math.min(z.lng,U.lng,V.lng,Y.lng),Math.min(z.lat,U.lat,V.lat,Y.lat)],K=[Math.max(z.lng,U.lng,V.lng,Y.lng),Math.max(z.lat,U.lat,V.lat,Y.lat)],ne=x&&x.pitch?x.pitch:this.getPitch(),se=this._cameraForBounds(this.transform,te,K,m,ne,x);return this._fitInternal(se,x,b)}_fitInternal(n,l,m){return n?(l=s.l(n,l)).linear?this.easeTo(l,m):this.flyTo(l,m):this}jumpTo(n,l){this.stop();const m=n.preloadOnly?this.transform.clone():this.transform;let x=!1,b=!1,T=!1;"zoom"in n&&m.zoom!==+n.zoom&&(x=!0,m.zoom=+n.zoom),n.center!==void 0&&(m.center=s.bO.convert(n.center)),"bearing"in n&&m.bearing!==+n.bearing&&(b=!0,m.bearing=+n.bearing),"pitch"in n&&m.pitch!==+n.pitch&&(T=!0,m.pitch=+n.pitch);const k=typeof n.padding=="number"?this._extendPadding(n.padding):n.padding;if(n.padding!=null&&!m.isPaddingEqual(k))if(n.retainPadding===!1){const j=m.clone();j.padding=k,m.setLocationAtPoint(m.center,j.centerPoint)}else m.padding=k;return n.preloadOnly?(this._preloadTiles(m),this):(this.fire(new s.A("movestart",l)).fire(new s.A("move",l)),x&&this.fire(new s.A("zoomstart",l)).fire(new s.A("zoom",l)).fire(new s.A("zoomend",l)),b&&this.fire(new s.A("rotatestart",l)).fire(new s.A("rotate",l)).fire(new s.A("rotateend",l)),T&&this.fire(new s.A("pitchstart",l)).fire(new s.A("pitch",l)).fire(new s.A("pitchend",l)),this.fire(new s.A("moveend",l)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.w(Q0),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,l){const m=this.transform;if(!m.projection.supportsFreeCamera)return s.w(Q0),this;this.stop();const x=m.zoom,b=m.pitch,T=m.bearing;m.setFreeCameraOptions(n);const k=x!==m.zoom,j=b!==m.pitch,L=T!==m.bearing;return this.fire(new s.A("movestart",l)).fire(new s.A("move",l)),k&&this.fire(new s.A("zoomstart",l)).fire(new s.A("zoom",l)).fire(new s.A("zoomend",l)),L&&this.fire(new s.A("rotatestart",l)).fire(new s.A("rotate",l)).fire(new s.A("rotateend",l)),j&&this.fire(new s.A("pitchstart",l)).fire(new s.A("pitch",l)).fire(new s.A("pitchend",l)),this.fire(new s.A("moveend",l)),this}easeTo(n,l){this._stop(!1,n.easeId),((n=s.l({offset:[0,0],duration:500,easing:s.dD},n)).animate===!1||this._prefersReducedMotion(n))&&(n.duration=0);const m=this.transform,x=this.getZoom(),b=this.getBearing(),T=this.getPitch(),k=this.getPadding(),j="zoom"in n?+n.zoom:x,L="bearing"in n?this._normalizeBearing(n.bearing,b):b,z="pitch"in n?+n.pitch:T,U=this._extendPadding(n.padding),V=s.P.convert(n.offset);let Y,te,K;if(m.projection.name==="globe"){const Ne=s.ac.fromLngLat(m.center),Ke=V.rotate(-m.angle);Ne.x+=Ke.x/m.worldSize,Ne.y+=Ke.y/m.worldSize;const $e=Ne.toLngLat(),lt=s.bO.convert(n.center||$e);this._normalizeCenter(lt),Y=m.centerPoint.add(Ke),te=new s.P(Ne.x,Ne.y).mult(m.worldSize),K=new s.P(s.av(lt.lng),s.aC(lt.lat)).mult(m.worldSize).sub(te)}else{Y=m.centerPoint.add(V);const Ne=m.pointLocation(Y),Ke=s.bO.convert(n.center||Ne);this._normalizeCenter(Ke),te=m.project(Ne),K=m.project(Ke).sub(te)}const ne=m.zoomScale(j-x);let se,me;n.around&&(se=s.bO.convert(n.around),me=m.locationPoint(se));const xe=this._zooming||j!==x,ye=this._rotating||b!==L,Ee=this._pitching||z!==T,be=!m.isPaddingEqual(U),we=n.retainPadding===!1?m.clone():m,Te=Ne=>Ke=>{if(xe&&(Ne.zoom=s.ah(x,j,Ke)),ye&&(Ne.bearing=s.ah(b,L,Ke)),Ee&&(Ne.pitch=s.ah(T,z,Ke)),be&&(we.interpolatePadding(k,U,Ke),Y=we.centerPoint.add(V)),se)Ne.setLocationAtPoint(se,me);else{const $e=Ne.zoomScale(Ne.zoom-x),lt=j>x?Math.min(2,ne):Math.max(.5,ne),dt=Math.pow(lt,1-Ke),vt=Ne.unproject(te.add(K.mult(Ke*dt)).mult($e));Ne.setLocationAtPoint(Ne.renderWorldCopies?vt.wrap():vt,Y)}return n.preloadOnly||this._fireMoveEvents(l),Ne};if(n.preloadOnly){const Ne=this._emulate(Te,n.duration,m);return this._preloadTiles(Ne),this}const Pe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=xe,this._rotating=ye,this._pitching=Ee,this._padding=be,this._easeId=n.easeId,this._prepareEase(l,n.noMoveStart,Pe),this._ease(Te(m),Ne=>{m.cameraElevationReference==="sea"&&m.recenterOnTerrain(),this._afterEase(l,Ne)},n),this}_prepareEase(n,l,m={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),l||m.moving||this.fire(new s.A("movestart",n)),this._zooming&&!m.zooming&&this.fire(new s.A("zoomstart",n)),this._rotating&&!m.rotating&&this.fire(new s.A("rotatestart",n)),this._pitching&&!m.pitching&&this.fire(new s.A("pitchstart",n))}_fireMoveEvents(n){this.fire(new s.A("move",n)),this._zooming&&this.fire(new s.A("zoom",n)),this._rotating&&this.fire(new s.A("rotate",n)),this._pitching&&this.fire(new s.A("pitch",n))}_afterEase(n,l){if(this._easeId&&l&&this._easeId===l)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const m=this._zooming,x=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new s.A("zoomend",n)),x&&this.fire(new s.A("rotateend",n)),b&&this.fire(new s.A("pitchend",n)),this.fire(new s.A("moveend",n))}flyTo(n,l){if(this._prefersReducedMotion(n)){const rt=s.aA(n,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(rt,l)}this.stop(),n=s.l({offset:[0,0],speed:1.2,curve:1.42,easing:s.dD},n);const m=this.transform,x=this.getZoom(),b=this.getBearing(),T=this.getPitch(),k=this.getPadding(),j="zoom"in n?s.ay(+n.zoom,m.minZoom,m.maxZoom):x,L="bearing"in n?this._normalizeBearing(n.bearing,b):b,z="pitch"in n?+n.pitch:T,U=this._extendPadding(n.padding),V=m.zoomScale(j-x),Y=s.P.convert(n.offset);let te=m.centerPoint.add(Y);const K=m.pointLocation(te),ne=s.bO.convert(n.center||K);this._normalizeCenter(ne);const se=m.project(K),me=m.project(ne).sub(se);let xe=n.curve;const ye=Math.max(m.width,m.height),Ee=ye/V,be=me.mag();if("minZoom"in n){const rt=s.ay(Math.min(n.minZoom,x,j),m.minZoom,m.maxZoom),ht=ye/m.zoomScale(rt-x);xe=Math.sqrt(ht/be*2)}const we=xe*xe;function Te(rt){const ht=(Ee*Ee-ye*ye+(rt?-1:1)*we*we*be*be)/(2*(rt?Ee:ye)*we*be);return Math.log(Math.sqrt(ht*ht+1)-ht)}function Pe(rt){return(Math.exp(rt)-Math.exp(-rt))/2}function Ne(rt){return(Math.exp(rt)+Math.exp(-rt))/2}const Ke=Te(0);let $e=function(rt){return Ne(Ke)/Ne(Ke+xe*rt)},lt=function(rt){return ye*((Ne(Ke)*(Pe(ht=Ke+xe*rt)/Ne(ht))-Pe(Ke))/we)/be;var ht},dt=(Te(1)-Ke)/xe;if(Math.abs(be)<1e-6||!isFinite(dt)){if(Math.abs(ye-Ee)<1e-6)return this.easeTo(n,l);const rt=Ee<ye?-1:1;dt=Math.abs(Math.log(Ee/ye))/xe,lt=function(){return 0},$e=function(ht){return Math.exp(rt*xe*ht)}}n.duration="duration"in n?+n.duration:1e3*dt/("screenSpeed"in n?+n.screenSpeed/xe:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const vt=b!==L,Ue=z!==T,at=!m.isPaddingEqual(U),Fe=n.retainPadding===!1?m.clone():m,ot=rt=>ht=>{const Je=ht*dt,mt=1/$e(Je);rt.zoom=ht===1?j:x+rt.scaleZoom(mt),vt&&(rt.bearing=s.ah(b,L,ht)),Ue&&(rt.pitch=s.ah(T,z,ht)),at&&(Fe.interpolatePadding(k,U,ht),te=Fe.centerPoint.add(Y));const It=ht===1?ne:rt.unproject(se.add(me.mult(lt(Je))).mult(mt));return rt.setLocationAtPoint(rt.renderWorldCopies?It.wrap():It,te),rt._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(l),rt};if(n.preloadOnly){const rt=this._emulate(ot,n.duration,m);return this._preloadTiles(rt),this}return this._zooming=!0,this._rotating=vt,this._pitching=Ue,this._padding=at,this._prepareEase(l,!1),this._ease(ot(m),()=>this._afterEase(l),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(n){}_cancelRenderFrame(n){}_stop(n,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const m=this._onEaseEnd;this._onEaseEnd=void 0,m.call(this,l)}if(!n){const m=this.handlers;m&&m.stop(!1)}return this}_ease(n,l,m){m.animate===!1||m.duration===0?(n(1),l()):(this._easeStart=s.q.now(),this._easeOptions=m,this._onEaseFrame=n,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((s.q.now()-this._easeStart)/this._easeOptions.duration,1),l=this._onEaseFrame;l&&l(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,l){n=s.bF(n,-180,180);const m=Math.abs(n-l);return Math.abs(n-360-l)<m&&(n-=360),Math.abs(n+360-l)<m&&(n+=360),n}_normalizeCenter(n){const l=this.transform;if(l.maxBounds||l.projection.name!=="globe"&&!l.renderWorldCopies)return;const m=n.lng-l.center.lng;n.lng+=m>180?-360:m<-180?360:0}_prefersReducedMotion(n){return this._respectPrefersReducedMotion&&s.q.prefersReducedMotion&&!(n&&n.essential)}_emulate(n,l,m){const x=Math.ceil(15*l/1e3),b=[],T=n(m.clone());for(let k=0;k<=x;k++){const j=T(k/x);b.push(j.clone())}return b}_preloadTiles(n,l){}}class em{constructor(n={}){this.options=n,s.aQ(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const l=this.options&&this.options.compact,m=n._getUIString("AttributionControl.ToggleAttribution");this._map=n,this._container=Q("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Q("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",m);const x=Q("span","mapboxgl-ctrl-icon",this._compactButton);return x.setAttribute("aria-hidden","true"),x.setAttribute("title",m),this._innerContainer=Q("div","mapboxgl-ctrl-attrib-inner",this._container),l&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),l===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const l=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.e.ACCESS_TOKEN}];if(n){const m=l.reduce((x,b,T)=>(b.value&&(x+=`${b.key}=${b.value}${T<l.length-1?"&":""}`),x),"?");n.href=`${s.e.FEEDBACK_URL}/${m}#${ty(this._map,!0)}`,n.rel="noopener nofollow"}}_updateData(n){!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const l=this._map.style._mergedSourceCaches;for(const x in l){const b=l[x];if(b.used){const T=b.getSource();T.attribution&&n.indexOf(T.attribution)<0&&n.push(T.attribution)}}n.sort((x,b)=>x.length-b.length),n=n.filter((x,b)=>{for(let T=b+1;T<n.length;T++)if(n[T].indexOf(x)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const m=n.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,n.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class go{constructor(){s.aQ(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=Q("div","mapboxgl-ctrl");const l=Q("a","mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://www.mapbox.com/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(Object.entries(n).length===0)return!0;for(const l in n){const m=n[l].getSource();if(m.hasOwnProperty("mapbox_logo")&&!m.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const l=n[0];this._map.getCanvasContainer().offsetWidth<250?l.classList.add("mapboxgl-compact"):l.classList.remove("mapboxgl-compact")}}}class _o{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const l=++this._id;return this._queue.push({callback:n,id:l,cancelled:!1}),l}remove(n){const l=this._currentlyRunning,m=l?this._queue.concat(l):this._queue;for(const x of m)if(x.id===n)return void(x.cancelled=!0)}run(n=0){const l=this._currentlyRunning=this._queue;this._queue=[];for(const m of l)if(!m.cancelled&&(m.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class id{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const l=s.cC((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-l)+this._end*l}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,l,m){this._start=this.getValue(l),this._end=n,this._startTime=l,this._endTime=l+m}}const Gc={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class qc extends s.A{constructor(n,l,m,x){const{point:b,lngLat:T,originalEvent:k,target:j}=n;super(n.type,{point:b,lngLat:T,originalEvent:k,target:j}),this.preventDefault=()=>{n.preventDefault()},this.id=l,this.interaction=m,this.feature=x}}class ay{constructor(n){this.map=n,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(n,l){if(this.typeById.has(n))throw new Error(`Interaction id "${n}" already exists.`);const m=l.filter;let x=l.type;m&&this.filters.set(n,s.a_(m)),x==="mouseover"&&(x="mouseenter"),x==="mouseout"&&(x="mouseleave");const b=this.interactionsByType.get(x)||new Map;x==="mouseenter"||x==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(n,l)):b.size===0&&this.map.on(x,this.handleType),b.size===0&&this.interactionsByType.set(x,b),b.set(n,l),this.typeById.set(n,x)}get(n){const l=this.typeById.get(n);if(!l)return;const m=this.interactionsByType.get(l);return m?m.get(n):void 0}remove(n){const l=this.typeById.get(n);if(!l)return;this.typeById.delete(n),this.filters.delete(n);const m=this.interactionsByType.get(l);m&&(m.delete(n),l==="mouseenter"||l==="mouseleave"?(this.delegatedInteractions.delete(n),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):m.size===0&&this.map.off(l,this.handleType))}queryTargets(n,l){const m=[];for(const[x,b]of l)b.target&&m.push({targetId:x,target:b.target,filter:this.filters.get(x)});return this.map.style.queryRenderedTargets(n,m,this.map.transform)}handleMove(n){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const l=this.queryTargets(n.point,Array.from(this.delegatedInteractions).reverse());l.length&&(n.type="mouseenter",this.handleType(n,l));const m=new Map;for(const[x,{feature:b}]of this.prevHoveredFeatures)this.hoveredFeatures.has(x)||m.set(b.id,b);m.size&&(n.type="mouseleave",this.handleType(n,Array.from(m.values())))}handleOut(n){const l=Array.from(this.hoveredFeatures.values()).map(({feature:m})=>m);l.length&&(n.type="mouseleave",this.handleType(n,l)),this.hoveredFeatures.clear()}handleType(n,l){const m=Array.from(this.interactionsByType.get(n.type)).reverse(),x=!!l;l=l||this.queryTargets(n.point,m);const b=n.type==="mouseenter";let T=!1;const k=new Set;for(const j of l){for(const[L,z]of m){if(!z.target)continue;const U=j.variants?j.variants[L]:null;if(U){for(const V of U){if(wu(V,j,k,L))continue;const Y=new s.cx(j,V),te=Th(V,j,L);x&&(Y.state=this.map.getFeatureState(Y));const K=b?this.prevHoveredFeatures.get(te):null,ne=new qc(n,L,z,Y),se=K?K.stop:z.handler(ne);if(b&&this.hoveredFeatures.set(te,{feature:j,stop:se}),se!==!1){T=!0;break}}if(T)break}}if(T)break}if(!T)for(const[j,L]of m){const{handler:z,target:U}=L;if(!U&&z(new qc(n,j,L,null))!==!1)break}}}function sn(g,n){if(Array.isArray(g)&&Array.isArray(n)){const l=new Set(g),m=new Set(n);return l.size===m.size&&g.every(x=>m.has(x))}return s.bn(g,n)}const sc={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},DS={showCompass:!0,showZoom:!0,visualizePitch:!1};class LS{constructor(n,l,m=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new Da({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,m&&(this.mousePitch=new tf({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),s.aQ(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),l.addEventListener("mousedown",this.mousedown),l.addEventListener("touchstart",this.touchstart,{passive:!1}),l.addEventListener("touchmove",this.touchmove),l.addEventListener("touchend",this.touchend),l.addEventListener("touchcancel",this.reset)}down(n,l){this.mouseRotate.mousedown(n,l),this.mousePitch&&this.mousePitch.mousedown(n,l),Se()}move(n,l){const m=this.map,x=this.mouseRotate.mousemoveWindow(n,l),b=x&&x.bearingDelta;if(b&&m.setBearing(m.getBearing()+b),this.mousePitch){const T=this.mousePitch.mousemoveWindow(n,l),k=T&&T.pitchDelta;k&&m.setPitch(m.getPitch()+k)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart,{passive:!1}),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){je(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(s.l({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),ct(this.element,n)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,ct(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=pt(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){n.targetTouches.length!==1?this.reset():(this._lastPos=pt(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function tm(g,n,l){if(g=new s.bO(g.lng,g.lat),n){const m=new s.bO(g.lng-360,g.lat),x=new s.bO(g.lng+360,g.lat),b=360*Math.ceil(Math.abs(g.lng-l.center.lng)/360),T=l.locationPoint3D(g).distSqr(n),k=n.x<0||n.y<0||n.x>l.width||n.y>l.height;l.locationPoint3D(m).distSqr(n)<T&&(k||Math.abs(m.lng-l.center.lng)<b)?g=m:l.locationPoint3D(x).distSqr(n)<T&&(k||Math.abs(x.lng-l.center.lng)<b)&&(g=x)}for(;Math.abs(g.lng-l.center.lng)>180;){const m=l.locationPoint3D(g);if(m.x>=0&&m.y>=0&&m.x<=l.width&&m.y<=l.height)break;g.lng>l.center.lng?g.lng-=360:g.lng+=360}return g}const La={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},xs={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class vs extends s.E{constructor(n,l){super(),(n instanceof HTMLElement||l)&&(n=s.l({element:n},l)),s.aQ(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:m="center",color:x="#3FB1CE",scale:b=1,draggable:T=!1,clickTolerance:k=0,rotation:j=xs.rotation,rotationAlignment:L=xs.rotationAlignment,pitchAlignment:z=xs.pitchAlignment,occludedOpacity:U=xs.occludedOpacity,altitude:V=xs.altitude}=n||{};this._anchor=m,this._color=x,this._scale=b,this._draggable=T,this._clickTolerance=k,this._rotation=j,this._rotationAlignment=L,this._pitchAlignment=z,this._occludedOpacity=U,this._altitude=V,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),n&&n.element?(this._element=n.element,this._offset=s.P.convert(n&&n.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=s.P.convert(n&&n.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",K=>{K.preventDefault()}),this._element.addEventListener("mousedown",K=>{K.preventDefault()});const Y=this._element.classList;for(const K in La)Y.remove(`mapboxgl-marker-anchor-${K}`);Y.add(`mapboxgl-marker-anchor-${this._anchor}`);const te=n&&n.className?n.className.trim().split(/\s+/):[];Y.add(...te),this._popup=null}_createDefaultMarker(){const n=Q("div"),l=ce("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},n);if(this._altitude===0){const m=ce("radialGradient",{id:"shadowGradient"},ce("defs",{},l));ce("stop",{offset:"10%","stop-opacity":.4},m),ce("stop",{offset:"100%","stop-opacity":.05},m),ce("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},l)}return ce("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},l),ce("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},l),ce("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},l),n}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){const n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=s.bO.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(n){return n===this._altitude||(this._defaultMarker&&(this._altitude===0&&n!==0||this._altitude!==0&&n===0)&&(this._element=this._createDefaultMarker()),this._altitude=n||xs.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const x=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(38.1-13.5+x)],"bottom-right":[-x,-1*(38.1-13.5+x)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,n._marker=this,n._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const l=n.code,m=n.charCode||n.keyCode;l!=="Space"&&l!=="Enter"&&m!==32&&m!==13||this.togglePopup()}_onMapClick(n){const l=n.originalEvent.target,m=this._element;this._popup&&(l===m||m.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const n=this._map,l=this._pos;if(!n||!l)return!1;const m=n.unproject(l,this._altitude),x=n.getFreeCameraOptions();if(!x.position)return!1;const b=x.position.toLngLat();return b.distanceTo(m)<.9*b.distanceTo(this._lngLat)}_evaluateOpacity(){const n=this._map;if(!n)return;const l=this._pos;if(!l||l.x<0||l.x>n.transform.width||l.y<0||l.y>n.transform.height)return void this._clearFadeTimer();const m=n.unproject(l,this._altitude);let x;n._showingGlobe()&&s.dK(n.transform,this._lngLat)?x=0:(x=1-n._queryFogOpacity(m),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(x*=this._occludedOpacity)),this._element.style.opacity=`${x}`,this._element.style.pointerEvents=x>0?"auto":"none",this._popup&&this._popup._setOpacity(x),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const n=this._pos;if(!n||!this._map)return;const l=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${n.x}px,${n.y}px)
            ${La[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${l.x}px,${l.y}px)
        `}_calculateXYTransform(){const n=this._pos,l=this._map,m=this.getPitchAlignment();if(!l||!n||m!=="map")return"";if(!l._showingGlobe()){const j=l.getPitch();return j?`rotateX(${j}deg)`:""}const x=s.c4(s.dL(l.transform,this._lngLat)),b=n.sub(s.dM(l.transform)),T=Math.abs(b.x)+Math.abs(b.y);if(T===0)return"";const k=x/T;return`rotateX(${-b.y*k}deg) rotateY(${b.x*k}deg)`}_calculateZTransform(){const n=this._pos,l=this._map;if(!l||!n)return"";let m=0;const x=this.getRotationAlignment();if(x==="map")if(l._showingGlobe()){const b=l.project(new s.bO(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),T=l.project(new s.bO(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(b);m=s.c4(Math.atan2(T.y,T.x))-90}else m=-l.getBearing();else if(x==="horizon"){const b=s.ae(4,6,l.getZoom()),T=s.dM(l.transform);T.y+=b*l.transform.height;const k=n.sub(T),j=s.c4(Math.atan2(k.y,k.x));m=(j>90?j-270:j+90)*(1-b)}return m+=this._rotation,m?`rotateZ(${m}deg)`:""}_update(n){cancelAnimationFrame(this._updateFrameId);const l=this._map;l&&(l.transform.renderWorldCopies&&(this._lngLat=tm(this._lngLat,this._pos,l.transform)),this._pos=l.project(this._lngLat,this._altitude),n===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),l._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(l._showingGlobe()||l.getTerrain()||l.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(n){return this._offset=s.P.convert(n),this._update(),this}addClassName(n){return this._element.classList.add(n),this}removeClassName(n){return this._element.classList.remove(n),this}toggleClassName(n){return this._element.classList.toggle(n)}_onMove(n){const l=this._map;if(!l)return;const m=this._pointerdownPos,x=this._positionDelta;if(m&&x){if(!this._isDragging){const b=this._clickTolerance||l._clickTolerance;if(n.point.dist(m)<b)return;this._isDragging=!0}this._pos=n.point.sub(x),this._lngLat=l.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.A("dragstart"))),this.fire(new s.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.A("dragend")),this._state="inactive"}_addDragHandler(n){const l=this._map,m=this._pos;l&&m&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(m),this._pointerdownPos=n.point,this._state="pending",l.on("mousemove",this._onMove),l.on("touchmove",this._onMove),l.once("mouseup",this._onUp),l.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;const l=this._map;return l&&(n?(l.on("mousedown",this._addDragHandler),l.on("touchstart",this._addDragHandler)):(l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||xs.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||xs.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||xs.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(n){return this._occludedOpacity=n||xs.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Js={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},cs={maxWidth:100,unit:"metric"},ly={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},wi={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},e1=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function oc(g=new s.P(0,0),n="bottom"){if(typeof g=="number"){const l=Math.round(Math.sqrt(.5*Math.pow(g,2)));switch(n){case"top":return new s.P(0,g);case"top-left":return new s.P(l,l);case"top-right":return new s.P(-l,l);case"bottom":return new s.P(0,-g);case"bottom-left":return new s.P(l,-l);case"bottom-right":return new s.P(-l,-l);case"left":return new s.P(g,0);case"right":return new s.P(-g,0)}return new s.P(0,0)}return g instanceof s.P||Array.isArray(g)?s.P.convert(g):s.P.convert(g[n]||[0,0])}return{version:N,supported:re.supported,setRTLTextPlugin:s.dN,getRTLTextPluginStatus:s.dO,Map:class extends nd{constructor(g){O.mark(D.create);const n=g;if((g=s.l({},sc,g)).minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(g.antialias&&s.dI(window)&&(g.antialias=!1,s.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new mp(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies,null,null),g),this._repaint=!!g.repaint,this._interactive=g.interactive,this._minTileCacheSize=g.minTileCacheSize,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=g.crossSourceCollisions,this._collectResourceTiming=g.collectResourceTiming,this._language=this._parseLanguage(g.language),this._worldview=g.worldview,this._renderTaskQueue=new _o,this._domRenderTaskQueue=new _o,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.aW(),this._locale=s.l({},Gc,g.locale),this._clickTolerance=g.clickTolerance,this._cooperativeGestures=g.cooperativeGestures,this._performanceMetricsCollection=g.performanceMetricsCollection,this._tessellationStep=g.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=g.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new id(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=g.scaleFactor,this._requestManager=new jt(g.transformRequest,g.accessToken,g.testMode),this._silenceAuthErrors=!!g.testMode,this._contextCreateOptions=g.contextCreateOptions?Object.assign({},g.contextCreateOptions):{},typeof g.container=="string"){const l=document.getElementById(g.container);if(!l)throw new Error(`Container '${g.container.toString()}' not found.`);this._container=l}else{if(!(g.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(this._container.childNodes.length>0&&s.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),g.maxBounds&&this.setMaxBounds(g.maxBounds),this._spriteFormat=g.spriteFormat,s.aQ(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Y_),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new J0(this,g),this._localFontFamily=g.localFontFamily,this._localIdeographFontFamily=g.localIdeographFontFamily,(g.style||!g.testMode)&&this.setStyle(g.style||s.e.DEFAULT_STYLE,{config:g.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),g.projection&&this.setProjection(g.projection),this.indoor=new f0(this),g.hash&&(this._hash=new ey(typeof g.hash=="string"&&g.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){n.center==null&&n.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch});const l=g.bounds;l&&(this.resize(),this.fitBounds(l,s.l({},g.fitBoundsOptions,{duration:0})))}this.resize(),g.attributionControl&&this.addControl(new em({customAttribution:g.customAttribution})),this._logoControl=new go,this.addControl(this._logoControl,g.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",l=>{this._update(l.dataType==="style"),this.fire(new s.A(`${l.dataType}data`,l))}),this.on("dataloading",l=>{this.fire(new s.A(`${l.dataType}dataloading`,l))}),this._interactions=new ay(this)}_getMapId(){return this._mapId}addControl(g,n){if(n===void 0&&(n=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new s.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=g.onAdd(this);this._controls.push(g);const m=this._controlPositions[n];return n.indexOf("bottom")!==-1?m.insertBefore(l,m.firstChild):m.appendChild(l),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new s.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(g);return n>-1&&this._controls.splice(n,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(g){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new s.A("movestart",g)).fire(new s.A("move",g)),this.fire(new s.A("resize",g)),n&&this.fire(new s.A("moveend",g)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(g){return this.transform.setMaxBounds(s.aB.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g?this.setZoom(g):this.fire(new s.A("zoomstart")).fire(new s.A("zoom")).fire(new s.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g?this.setZoom(g):this.fire(new s.A("zoomstart")).fire(new s.A("zoom")).fire(new s.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g?this.setPitch(g):this.fire(new s.A("pitchstart")).fire(new s.A("pitch")).fire(new s.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g?this.setPitch(g):this.fire(new s.A("pitchstart")).fire(new s.A("pitch")).fire(new s.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(g){return this._scaleFactor=g,this.painter.scaleFactor=g,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(n=>n.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(g){return g==="auto"?navigator.language:Array.isArray(g)?g.length===0?void 0:g.map(n=>n==="auto"?navigator.language:n):g}setLanguage(g){const n=this._parseLanguage(g);if(!this.style||n===this._language)return this;this._language=n,this.style.reloadSources();for(const l of this._controls)l._setLanguage&&l._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(g){return this.style&&g!==this._worldview?(this._worldview=g,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(g){return this._lazyInitEmptyStyle(),g?typeof g=="string"&&(g={name:g}):g=null,this._useExplicitProjection=!!g,this._prioritizeAndUpdateProjection(g,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const g=this.transform,n=g.projection.name;let l;n==="globe"&&g.zoom>=s.bY?(g.setMercatorFromTransition(),l=!0):n==="mercator"&&g.zoom<s.bY&&(g.setProjection({name:"globe"}),l=!0),l&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(g,n){return this._updateProjection(g||n||{name:"mercator"})}_updateProjection(g){let n;return n=g.name==="globe"&&this.transform.zoom>=s.bY?this.transform.setMercatorFromTransition():this.transform.setProjection(g),this.style.applyProjectionUpdate(),n&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(g,n){return this.transform.locationPoint3D(s.bO.convert(g),n)}unproject(g,n){return this.transform.pointLocation3D(s.P.convert(g),n)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(g,n,l){const m=x=>{let b=[];if(Array.isArray(n)){const T=n.filter(k=>this.getLayer(k));b=T.length?this.queryRenderedFeatures(x,{layers:T}):[]}else b=this.queryRenderedFeatures(x,{target:n});return b};if(g==="mouseenter"||g==="mouseover"){let x=!1;return{listener:l,targets:n,delegates:{mousemove:T=>{const k=m(T.point);k.length?x||(x=!0,l.call(this,new Ks(g,this,T.originalEvent,{features:k}))):x=!1},mouseout:()=>{x=!1}}}}if(g==="mouseleave"||g==="mouseout"){let x=!1;return{listener:l,targets:n,delegates:{mousemove:k=>{m(k.point).length?x=!0:x&&(x=!1,l.call(this,new Ks(g,this,k.originalEvent)))},mouseout:k=>{x&&(x=!1,l.call(this,new Ks(g,this,k.originalEvent)))}}}}{const x=b=>{const T=m(b.point);T.length&&(b.features=T,l.call(this,b),delete b.features)};return{listener:l,targets:n,delegates:{[g]:x}}}}on(g,n,l){if(typeof n=="function"||l===void 0)return super.on(g,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const m=this._createDelegatedListener(g,n,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(m);for(const x in m.delegates)this.on(x,m.delegates[x]);return this}once(g,n,l){if(typeof n=="function"||l===void 0)return super.once(g,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const m=this._createDelegatedListener(g,n,l);for(const x in m.delegates)this.once(x,m.delegates[x]);return this}off(g,n,l){if(typeof n=="function"||l===void 0)return super.off(g,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const m=this._delegatedListeners?this._delegatedListeners[g]:void 0;return m&&(x=>{for(let b=0;b<x.length;b++){const T=x[b];if(T.listener===l&&sn(T.targets,n)){for(const k in T.delegates)this.off(k,T.delegates[k]);return x.splice(b,1),this}}})(m),this}queryRenderedFeatures(g,n){if(!this.style)return[];if(g===void 0||g instanceof s.P||Array.isArray(g)||n!==void 0||(n=g,g=void 0),g=g||[[0,0],[this.transform.width,this.transform.height]],!n){const b=this.style.queryRenderedFeatures(g,void 0,this.transform),T=this.style.queryRenderedFeatureset(g,void 0,this.transform);return b.concat(T)}let l=!0;if(n.target&&(l=this._isTargetValid(n.target),l&&!n.layers))return this.style.queryRenderedFeatureset(g,n,this.transform);let m=!0;if(n.layers&&Array.isArray(n.layers)){for(const b of n.layers)if(!this._isValidId(b)){m=!1;break}if(m&&!n.target)return this.style.queryRenderedFeatures(g,n,this.transform)}let x=[];return m&&(x=x.concat(this.style.queryRenderedFeatures(g,n,this.transform))),l&&(x=x.concat(this.style.queryRenderedFeatureset(g,n,this.transform))),x}querySourceFeatures(g,n){return!g||typeof g=="string"&&!this._isValidId(g)?[]:this.style.querySourceFeatures(g,n)}isPointOnSurface(g){const{name:n}=this.transform.projection;return n!=="globe"&&n!=="mercator"&&s.w(`${n} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.P.convert(g))}addInteraction(g,n){return this._interactions.add(g,n),this}removeInteraction(g){return this._interactions.remove(g),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(g){return this._cooperativeGestures=g,this}setStyle(g,n){return n=s.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n),this.style&&g&&n.diff!==!1&&n.localFontFamily===this._localFontFamily&&n.localIdeographFontFamily===this._localIdeographFontFamily&&!n.config?(this.style._diffStyle(g,(l,m)=>{l?(s.w(`Unable to perform style diff: ${String(l.message||l.error||l)}. Rebuilding the style from scratch.`),this._updateStyle(g,n)):m&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(g,n))}_getUIString(g){const n=this._locale[g];if(n==null)throw new Error(`Missing UI string '${g}'`);return n}_updateStyle(g,n){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),g){const l=s.l({},n);n&&n.config&&(l.initialConfig=n.config,delete l.config),this.style=new la(this,l).load(g),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new la(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.w("There is no style added to the map."),!1)}_isValidId(g){return g==null?(this.fire(new s.z(new Error("IDs can't be empty."))),!1):!s.cs(g)||(this.fire(new s.z(new Error(`IDs can't contain special symbols: "${g}".`))),!1)}_isTargetValid(g){return"featuresetId"in g?this._isValidId("importId"in g?g.importId:g.featuresetId):"layerId"in g&&this._isValidId(g.layerId)}_areTargetsValid(g){if(Array.isArray(g)){for(const n of g)if(!this._isValidId(n))return!1;return!0}return this._isTargetValid(g)}addSource(g,n){return this._isValidId(g)?(this._lazyInitEmptyStyle(),this.style.addSource(g,n),this._update(!0)):this}isSourceLoaded(g){return!!this._isValidId(g)&&!!this.style&&this.style._isSourceCacheLoaded(g)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(g,n,l){this._lazyInitEmptyStyle(),this.style.addSourceType(g,n,l)}removeSource(g){return this._isValidId(g)?(this.style.removeSource(g),this._updateTerrain(),this._update(!0)):this}getSource(g){return this._isValidId(g)?this.style.getOwnSource(g):null}addImage(g,n,{pixelRatio:l=1,sdf:m=!1,stretchX:x,stretchY:b,content:T}={}){this._lazyInitEmptyStyle();const k=s.I.from(g);if(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap){const{width:j,height:L,data:z}=s.q.getImageData(n);this.style.addImage(k,this.style.scope,{data:new s.r({width:j,height:L},z),pixelRatio:l,stretchX:x,stretchY:b,content:T,sdf:m,version:0,usvg:!1})}else if(n.width===void 0||n.height===void 0)this.fire(new s.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:j,height:L}=n,z=n;this.style.addImage(k,this.style.scope,{data:new s.r({width:j,height:L},new Uint8Array(z.data)),pixelRatio:l,stretchX:x,stretchY:b,content:T,sdf:m,usvg:!1,version:0,userImage:z}),z.onAdd&&z.onAdd(this,g)}}updateImage(g,n){this._lazyInitEmptyStyle();const l=s.I.from(g),m=this.style.getImage(l,this.style.scope);if(!m)return void this.fire(new s.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const x=n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap?s.q.getImageData(n):n,{width:b,height:T,data:k}=x;if(b===void 0||T===void 0)return void this.fire(new s.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(b!==(m.usvg?m.icon.usvg_tree.width:m.data.width)||T!==(m.usvg?m.icon.usvg_tree.height:m.data.height))return void this.fire(new s.z(new Error(`The width and height of the updated image (${b}, ${T})
                must be that same as the previous version of the image
                (${m.data.width}, ${m.data.height})`)));const j=!(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap);let L=!1;m.usvg?(m.data=new s.r({width:b,height:T},new Uint8Array(k)),m.usvg=!1,m.icon=void 0,L=!0):m.data.replace(k,j),this.style.updateImage(l,this.style.scope,m,L)}hasImage(g){return g?!!this.style&&!!this.style.getImage(s.I.from(g),this.style.scope):(this.fire(new s.z(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(s.I.from(g),this.style.scope)}loadImage(g,n){s.o(this._requestManager.transformRequest(g,s.R.Image),(l,m)=>{n(l,m instanceof HTMLImageElement?s.q.getImageData(m):m)})}listImages(){return this.style.listImages().map(g=>g.name)}addModel(g,n){this._lazyInitEmptyStyle(),this.style.addModel(g,n)}hasModel(g){return g?this.style.hasModel(g):(this.fire(new s.z(new Error("Missing required model id"))),!1)}removeModel(g){this.style.removeModel(g)}listModels(){return this.style.listModels()}addLayer(g,n){return this._isValidId(g.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(g,n),this._update(!0)):this}getSlot(g){const n=this.getLayer(g);return n&&n.slot||null}setSlot(g,n){return this.style.setSlot(g,n),this.style.mergeLayers(),this._update(!0)}addImport(g,n){return this.style.addImport(g,n),this}updateImport(g,n){return typeof n!="string"&&n.id!==g?(this.removeImport(g),this.addImport(n)):(this.style.updateImport(g,n),this._update(!0))}removeImport(g){return this.style.removeImport(g),this}moveImport(g,n){return this.style.moveImport(g,n),this._update(!0)}moveLayer(g,n){return this._isValidId(g)?(this.style.moveLayer(g,n),this._update(!0)):this}removeLayer(g){return this._isValidId(g)?(this.style.removeLayer(g),this._update(!0)):this}getLayer(g){if(!this._isValidId(g))return null;const n=this.style.getOwnLayer(g);return n?n.type==="custom"?n.implementation:n.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(g,n,l){return this._isValidId(g)?(this.style.setLayerZoomRange(g,n,l),this._update(!0)):this}setFilter(g,n,l={}){return this._isValidId(g)?(this.style.setFilter(g,n,l),this._update(!0)):this}getFilter(g){return this._isValidId(g)?this.style.getFilter(g):null}setPaintProperty(g,n,l,m={}){return this._isValidId(g)?(this.style.setPaintProperty(g,n,l,m),this._update(!0)):this}getPaintProperty(g,n){return this._isValidId(g)?this.style.getPaintProperty(g,n):null}setLayoutProperty(g,n,l,m={}){return this._isValidId(g)?(this.style.setLayoutProperty(g,n,l,m),this._update(!0)):this}getLayoutProperty(g,n){return this._isValidId(g)?this.style.getLayoutProperty(g,n):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(g){return this.style.setGlyphsUrl(g),this._update(!0)}getSchema(g){return this.style.getSchema(g)}setSchema(g,n){return this.style.setSchema(g,n),this._update(!0)}getConfig(g){return this.style.getConfig(g)}setConfig(g,n){return this.style.setConfig(g,n),this._update(!0)}getConfigProperty(g,n){return this.style.getConfigProperty(g,n)}setConfigProperty(g,n,l){return this.style.setConfigProperty(g,n,l),this._update(!0)}getFeaturesetDescriptors(g){return this.style.getFeaturesetDescriptors(g)}setLights(g){if(this._lazyInitEmptyStyle(),g&&g.length===1&&g[0].type==="flat"){const n=g[0];n.properties?this.style.setFlatLight(n.properties,n.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(g),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const g=this.style.getLights()||[];return g.length===0&&g.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),g}setLight(g,n={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:g}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(g){return this._lazyInitEmptyStyle(),!g&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(g),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(g){return this._lazyInitEmptyStyle(),this.style.setFog(g),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(g){return this._lazyInitEmptyStyle(),this.style.setSnow(g),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(g){return this._lazyInitEmptyStyle(),this.style.setRain(g),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(g){return this._lazyInitEmptyStyle(),this.style.setColorTheme(g),this._update(!0)}setImportColorTheme(g,n){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(g,n),this._update(!0)}setCamera(g){return this.style.setCamera(g),this._triggerCameraUpdate(g)}_triggerCameraUpdate(g){return this._update(this.transform.setOrthographicProjectionAtLowPitch(g["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(g){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.bO.convert(g),this.transform):0}setFeatureState(g,n){return g.source&&!this._isValidId(g.source)?this:(this.style.setFeatureState(g,n),this._update())}removeFeatureState(g,n){return g.source&&!this._isValidId(g.source)?this:(this.style.removeFeatureState(g,n),this._update())}getFeatureState(g){return g.source&&!this._isValidId(g.source)?null:this.style.getFeatureState(g)}_updateContainerDimensions(){if(!this._container)return;const g=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let l,m,x,b=this._container;for(;b&&(!m||!x);){const T=window.getComputedStyle(b).transform;T&&T!=="none"&&(l=T.match(/matrix.*\((.+)\)/)[1].split(", "),l[0]&&l[0]!=="0"&&l[0]!=="1"&&(m=l[0]),l[3]&&l[3]!=="0"&&l[3]!=="1"&&(x=l[3])),b=b.parentElement}this._containerWidth=m?Math.abs(g/m):g,this._containerHeight=x?Math.abs(n/x):n}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=Q("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=Q("div","mapboxgl-canvas-container",g);this._canvas=Q("canvas","mapboxgl-canvas",n),this._interactive&&(n.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const l=this._controlContainer=Q("div","mapboxgl-control-container",g),m=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(x=>{m[x]=Q("div",`mapboxgl-ctrl-${x}`,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,n){const l=s.q.devicePixelRatio||1;this._canvas.width=l*Math.ceil(g),this._canvas.height=l*Math.ceil(n),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${n}px`}_addMarker(g){this._markers.push(g)}_removeMarker(g){const n=this._markers.indexOf(g);n!==-1&&this._markers.splice(n,1)}_addPopup(g){this._popups.push(g)}_removePopup(g){const n=this._popups.indexOf(g);n!==-1&&this._popups.splice(n,1)}_setupPainter(){const g=s.l({},re.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl2",g);n?(pn(n,!0),this.painter=new Xp(n,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",l=>{l.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),s.m.testSupport(n)):this.fire(new s.z(new Error("Failed to initialize WebGL")))}_contextLost(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.A("webglcontextlost",{originalEvent:g}))}_contextRestored(g){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style.reloadModels(),this.style.clearSources(),this._update(),this.fire(new s.A("webglcontextrestored",{originalEvent:g}))}_onMapScroll(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_requestDomTask(g){!this.loaded()||this.loaded()&&!this.isMoving()?g():this._domRenderTaskQueue.add(g)}_render(g){let n;this.fire(new s.A("renderstart")),++this._frameId;const l=this.painter.context.extTimerQuery,m=s.q.now(),x=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(n=x.createQuery(),x.beginQuery(l.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(g),this._domRenderTaskQueue.run(g),this._removed)return;this._updateProjectionTransition();const b=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const L=this.transform.zoom,z=this.transform.pitch,U=s.q.now(),V=new s.aa(L,{now:U,fadeDuration:b,pitch:z,transition:this.style.transition});this.style.update(V)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let T=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),T=this._updateAverageElevation(m),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):T=this._updateAverageElevation(m);const k=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,b,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),k&&(this._placementDirty=k.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,O.mark(D.load),this.fire(new s.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const L=s.q.now()-m;x.endQuery(l.TIME_ELAPSED_EXT),setTimeout(()=>{const z=x.getQueryParameter(n,x.QUERY_RESULT)/1e6;x.deleteQuery(n),this.fire(new s.A("gpu-timing-frame",{cpuTime:L,gpuTime:z}))},50)}if(this.listens("gpu-timing-layer")){const L=this.painter.collectGpuTimers();setTimeout(()=>{const z=this.painter.queryGpuTimers(L);this.fire(new s.A("gpu-timing-layer",{layerTimes:z}))},50)}if(this.listens("gpu-timing-deferred-render")){const L=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const z=this.painter.queryGpuTimeDeferredRender(L);this.fire(new s.A("gpu-timing-deferred-render",{gpuTime:z}))},50)}const j=this._sourcesDirty||this._styleDirty||this._placementDirty||T;if(j||this._repaint)this.triggerRepaint();else{const L=this.idle();if(L&&(T=this._updateAverageElevation(m,!0)),T)this.triggerRepaint();else if(this._triggerFrame(!1),L&&(this.fire(new s.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const z=this._calculateSpeedIndex();this.fire(new s.A("speedindexcompleted",{speedIndex:z})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||j||(this._fullyLoaded=!0,O.mark(D.fullLoad),this._performanceMetricsCollection&&Br(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(g){for(const n of this._markers)g&&!this.getRenderWorldCopies()&&(n._lngLat=n._lngLat.wrap()),n._update();for(const n of this._popups)!g||this.getRenderWorldCopies()||n._trackPointer||(n._lngLat=n._lngLat.wrap()),n._update()}_updateAverageElevation(g,n=!1){const l=x=>(this.transform.averageElevation=x,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&l(0);const m=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(m||(n||g-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(g)){const x=this.transform.averageElevation;let b=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(b)?b=0:this._averageElevationLastSampledAt=g;const T=Math.abs(x-b);if(T>1){if(this._isInitialLoad||m)return this._averageElevation.jumpTo(b),l(b);this._averageElevation.easeTo(b,g,300)}else if(T>1e-4)return this._averageElevation.jumpTo(b),l(b)}return!!this._averageElevation.isEasing(g)&&l(this._averageElevation.getValue(g))}_authenticate(){de(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,g=>{if(g&&(g.message===Jt||g.status===401)){const n=this.painter.context.gl;pn(n,!1),this._logoControl instanceof go&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),hn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&At(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const g=this._isDragging();this.painter.updateTerrain(this.style,g)}_calculateSpeedIndex(){const g=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const l=this.painter.context.gl,m=l.createFramebuffer();function x(b){l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,b,0);const T=new Uint8Array(l.drawingBufferWidth*l.drawingBufferHeight*4);return l.readPixels(0,0,l.drawingBufferWidth,l.drawingBufferHeight,l.RGBA,l.UNSIGNED_BYTE,T),T}return l.bindFramebuffer(l.FRAMEBUFFER,m),this._canvasPixelComparison(x(g),n.canvasCopies.map(x),n.timeStamps)}_canvasPixelComparison(g,n,l){let m=l[1]-l[0];const x=g.length/4;for(let b=0;b<n.length;b++){const T=n[b];let k=0;for(let j=0;j<T.length;j+=4)T[j]===g[j]&&T[j+1]===g[j+1]&&T[j+2]===g[j+2]&&T[j+3]===g[j+3]&&(k+=1);m+=(l[b+2]-l[b+1])*(1-k/x)}return m}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const g=this.painter.context.gl.getExtension("WEBGL_lose_context");g&&g.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),bn.delete(this.painter.context.gl),xn.remove(),Ut.remove(),this._removed=!0,this.fire(new s.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(g){this._renderNextFrame=this._renderNextFrame||g,this.style&&!this._frame&&(this._frame=s.q.frame(n=>{const l=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,l&&this._render(n)}))}_preloadTiles(g){const n=this.style?this.style.getSourceCaches():[];return s.bl(n,(l,m)=>l._preloadTiles(g,m),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(g){this._trackResize&&this.resize({originalEvent:g})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(g){this._showParseStatus!==g&&(this._showParseStatus=g,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(g){this._showTerrainWireframe!==g&&(this._showTerrainWireframe=g,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(g){this._showLayers2DWireframe!==g&&(this._showLayers2DWireframe=g,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(g){this._showLayers3DWireframe!==g&&(this._showLayers3DWireframe=g,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(g){this._speedIndexTiming!==g&&(this._speedIndexTiming=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,this._tp.refreshUI(),g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(g){this._showTileAABBs!==g&&(this._showTileAABBs=g,this._tp.refreshUI(),g&&this._update())}_setCacheLimits(g,n){s.dJ(g,n)}get version(){return N}},NavigationControl:class{constructor(g={}){this.options=s.l({},DS,g),this._container=Q("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(s.aQ(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>{this._map&&this._map.zoomIn({},{originalEvent:n})}),Q("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>{this._map&&this._map.zoomOut({},{originalEvent:n})}),Q("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.aQ(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{const l=this._map;l&&(this.options.visualizePitch?l.resetNorthPitch({},{originalEvent:n}):l.resetNorth({},{originalEvent:n}))}),this._compassIcon=Q("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const g=this._map;if(!g)return;const n=g.getZoom(),l=n===g.getMaxZoom(),m=n===g.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())}_rotateCompassArrow(){const g=this._map;if(!g)return;const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(g.transform.pitch*(Math.PI/180)),.5)}) rotateX(${g.transform.pitch}deg) rotateZ(${g.transform.angle*(180/Math.PI)}deg)`:`rotate(${g.transform.angle*(180/Math.PI)}deg)`;g._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=n)})}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),g.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&g.on("pitch",this._rotateCompassArrow),g.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new LS(g,this._compass,this.options.visualizePitch)),this._container}onRemove(){const g=this._map;g&&(this._container.remove(),this.options.showZoom&&g.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&g.off("pitch",this._rotateCompassArrow),g.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(g,n){const l=Q("button",g,this._container);return l.type="button",l.addEventListener("click",n),l}_setButtonTitle(g,n){if(!this._map)return;const l=this._map._getUIString(`NavigationControl.${n}`);g.setAttribute("aria-label",l),g.firstElementChild&&g.firstElementChild.setAttribute("title",l)}},GeolocateControl:class extends s.E{constructor(g={}){super();const n=navigator.geolocation;this.options=s.l({geolocation:n},Js,g),s.aQ(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Kp(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(g){return this._map=g,this._container=Q("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(g){const n=(l=!!this.options.geolocation)=>{this._supportsGeolocation=l,g(l)};this._supportsGeolocation!==void 0?g(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(l=>n(l.state!=="denied")).catch(()=>n()):n()}_isOutOfMapMaxBounds(g){const n=this._map.getMaxBounds(),l=g.coords;return!!n&&(l.longitude<n.getWest()||l.longitude>n.getEast()||l.latitude<n.getSouth()||l.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(g){if(this._map){if(this._isOutOfMapMaxBounds(g))return this._setErrorState(),this.fire(new s.A("outofmaxbounds",g)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=g,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(g),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(g),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.A("geolocate",g)),this._finish()}}_updateCamera(g){const n=new s.bO(g.coords.longitude,g.coords.latitude),l=g.coords.accuracy,m=this._map.getBearing(),x=s.l({bearing:m},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(l),x,{geolocateSource:!0})}_updateMarker(g){if(g){const n=new s.bO(g.coords.longitude,g.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=g.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const g=this._map.transform,n=s.bH(1,g._center.lat)*g.worldSize,l=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${l}px`,this._circleElement.style.height=`${l}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(g){if(this._map){if(this.options.trackUserLocation)if(g.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(g.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.A("error",g)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(g){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=Q("button","mapboxgl-ctrl-geolocate",this._container),Q("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",g===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Q("div","mapboxgl-user-location"),this._dotElement.appendChild(Q("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Q("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new vs({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Q("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new vs({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.A("trackuserlocationend")))})}}_onDeviceOrientation(g){this._userLocationDotMarker&&(g.webkitCompassHeading?this._heading=g.webkitCompassHeading:g.absolute===!0&&(this._heading=-1*g.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let g;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(g={maximumAge:6e5,timeout:0},this._noTimeout=!0):(g=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,g),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const g=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(n=>{n==="granted"&&g()}).catch(console.error):g()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:em,ScaleControl:class{constructor(g={}){this.options=s.l({},cs,g),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),s.aQ(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const g=this.options.maxWidth||100,n=this._map,l=n._containerHeight/2,m=n._containerWidth/2-g/2,x=n.unproject([m,l]),b=n.unproject([m+g,l]),T=x.distanceTo(b);if(this.options.unit==="imperial"){const k=3.2808*T;k>5280?this._setScale(g,k/5280,"mile"):this._setScale(g,k,"foot")}else this.options.unit==="nautical"?this._setScale(g,T/1852,"nautical-mile"):T>=1e3?this._setScale(g,T/1e3,"kilometer"):this._setScale(g,T,"meter")}_setScale(g,n,l){this._map._requestDomTask(()=>{const m=function(b){const T=Math.pow(10,`${Math.floor(b)}`.length-1);let k=b/T;return k=k>=10?10:k>=5?5:k>=3?3:k>=2?2:k>=1?1:function(j){const L=Math.pow(10,Math.ceil(-Math.log(j)/Math.LN10));return Math.round(j*L)/L}(k),T*k}(n),x=m/n;this._container.innerHTML=this._isNumberFormatSupported&&l!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:l}).format(m):`${m}&nbsp;${ly[l]}`,this._container.style.width=g*x+"px"})}onAdd(g){return this._map=g,this._language=g.getLanguage(),this._container=Q("div","mapboxgl-ctrl mapboxgl-ctrl-scale",g.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(g){this._language=g,this._update()}setUnit(g){this.options.unit=g,this._update()}},FullscreenControl:class{constructor(g={}){this._fullscreen=!1,g&&g.container&&(g.container instanceof HTMLElement?this._container=g.container:s.w("Full screen control 'container' must be a DOM element.")),s.aQ(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=Q("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const g=this._fullscreenButton=Q("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Q("span","mapboxgl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",g)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends s.E{constructor(g){super(),this.options=s.l(Object.create(wi),g),this._altitude=this.options.altitude,s.aQ(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(g&&g.className?g.className.trim().split(/\s+/):[])}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&g.on("preclick",this._onClose),this.options.closeOnMove&&g.on("move",this._onClose),g.on("remove",this.remove),this._update(),g._addPopup(this),this._focusFirstElement(),this._trackPointer?(g.on("mousemove",this._onMouseEvent),g.on("mouseup",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")):g.on("move",this._update),this.fire(new s.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const g=this._map;return g&&(g.off("move",this._update),g.off("move",this._onClose),g.off("preclick",this._onClose),g.off("click",this._onClose),g.off("remove",this.remove),g.off("mousemove",this._onMouseEvent),g.off("mouseup",this._onMouseEvent),g.off("drag",this._onMouseEvent),g._canvasContainer&&g._canvasContainer.classList.remove("mapboxgl-track-pointer"),g._removePopup(this),this._map=void 0),this.fire(new s.A("close")),this}getLngLat(){return this._lngLat}setLngLat(g){this._lngLat=s.bO.convert(g),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(g){return this._altitude=g,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const g=this._map;return g&&(g.off("move",this._update),g.on("mousemove",this._onMouseEvent),g.on("drag",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(document.createTextNode(g))}setHTML(g){const n=document.createDocumentFragment(),l=document.createElement("body");let m;for(l.innerHTML=g;m=l.firstChild,m;)n.appendChild(m);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=Q("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(g),this.options.closeButton){const l=this._closeButton=Q("button","mapboxgl-popup-close-button",n);l.type="button",l.setAttribute("aria-label","Close popup"),l.innerHTML='<span aria-hidden="true">&#215;</span>',l.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(g){return this._classList.add(g),this._updateClassList(),this}removeClassName(g){return this._classList.delete(g),this._updateClassList(),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){let n;return this._classList.delete(g)?n=!1:(this._classList.add(g),n=!0),this._updateClassList(),n}_onMouseEvent(g){this._update(g.point)}_getAnchor(g){if(this.options.anchor)return this.options.anchor;const n=this._map,l=this._container,m=this._pos;if(!n||!l||!m)return"bottom";const x=l.offsetWidth,b=l.offsetHeight,T=m.x<x/2,k=m.x>n.transform.width-x/2;if(m.y+g<b)return T?"top-left":k?"top-right":"top";if(m.y>n.transform.height-b){if(T)return"bottom-left";if(k)return"bottom-right"}return T?"left":k?"right":"bottom"}_updateClassList(){const g=this._container;if(!g)return;const n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),g.className=n.join(" ")}_update(g){const n=this._map,l=this._content;if(!n||!this._lngLat&&!this._trackPointer||!l)return;let m=this._container;if(m||(m=this._container=Q("div","mapboxgl-popup",n.getContainer()),this._tip=Q("div","mapboxgl-popup-tip",m),m.appendChild(l)),this.options.maxWidth&&m.style.maxWidth!==this.options.maxWidth&&(m.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=tm(this._lngLat,this._pos,n.transform)),!this._trackPointer||g){const x=this._pos=this._trackPointer&&g instanceof s.P?g:n.project(this._lngLat,this._altitude),b=oc(this.options.offset),T=this._anchor=this._getAnchor(b.y),k=oc(this.options.offset,T),j=x.add(k).round();n._requestDomTask(()=>{this._container&&T&&(this._container.style.transform=`${La[T]} translate(${j.x}px,${j.y}px)`)})}if(!this._marker&&n._showingGlobe()){const x=s.dK(n.transform,this._lngLat)?0:1;this._setOpacity(x)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(e1);g&&g.focus()}_onClose(){this.remove()}_setOpacity(g){this._container&&(this._container.style.opacity=`${g}`),this._content&&(this._content.style.pointerEvents=g?"auto":"none")}},Marker:vs,Style:la,LngLat:s.bO,LngLatBounds:s.aB,Point:s.P,MercatorCoordinate:s.ac,FreeCameraOptions:i_,Evented:s.E,config:s.e,prewarm:s.dP,clearPrewarmedResources:s.dQ,get accessToken(){return s.e.ACCESS_TOKEN},set accessToken(g){s.e.ACCESS_TOKEN=g},get baseApiUrl(){return s.e.API_URL},set baseApiUrl(g){s.e.API_URL=g},get workerCount(){return s.dR.workerCount},set workerCount(g){s.dR.workerCount=g},get maxParallelImageRequests(){return s.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(g){s.e.MAX_PARALLEL_IMAGE_REQUESTS=g},clearStorage(g){s.dS(g)},get workerUrl(){return s.dT.workerUrl},set workerUrl(g){s.dT.workerUrl=g},get workerClass(){return s.dT.workerClass},set workerClass(g){s.dT.workerClass=g},get workerParams(){return s.dT.workerParams},set workerParams(g){s.dT.workerParams=g},get dracoUrl(){return s.dU()},set dracoUrl(g){s.dV(g)},get meshoptUrl(){return s.dW()},set meshoptUrl(g){s.dX(g)},setNow:s.q.setNow,restoreNow:s.q.restoreNow}});var S=d;return S})})(Q6);var Toe=Q6.exports;const Tb=ZM(Toe),tV=({city:e,randomize:t=!0})=>{const i=H.useRef(null),a=H.useRef(null);return H.useEffect(()=>{if(!i.current)return;Tb.accessToken="pk.eyJ1IjoibG92YWJsZS1kZW1vIiwiYSI6ImNsdmk4dDRnYTA5aGUyc29kODQxM2E1eHEifQ.ohorbZuc9o6pktQ7mIpJNA";const d={"Paris, France":[2.3522,48.8566],"Madrid, Spain":[-3.7038,40.4168],"Barcelona, Spain":[2.1734,41.3851],"Berlin, Germany":[13.405,52.52],"Copenhagen, Denmark":[12.5683,55.6761],"Warsaw, Poland":[21.0122,52.2297],"Munich, Germany":[11.582,48.1351],"Vienna, Austria":[16.3738,48.2082],"Geneva, Switzerland":[6.1432,46.2044],"London, UK":[-.1278,51.5074],"Amsterdam, Netherlands":[4.9041,52.3676]};let[y,S]=d[e]||[-.1278,51.5074];return t&&(y+=(Math.random()-.5)*.02,S+=(Math.random()-.5)*.02),a.current=new Tb.Map({container:i.current,style:"mapbox://styles/mapbox/streets-v11",center:[y,S],zoom:13}),a.current.addControl(new Tb.NavigationControl,"top-right"),new Tb.Marker({color:"#683bfa"}).setLngLat([y,S]).addTo(a.current),()=>{var s;(s=a.current)==null||s.remove()}},[e,t]),f.jsx("div",{ref:i,className:"w-full h-full rounded-lg"})},Eoe=({location:e})=>f.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[f.jsx("h3",{className:"font-semibold text-lg mb-4",children:"Location"}),f.jsx("div",{className:"rounded-lg h-48",children:f.jsx(tV,{city:e})}),f.jsx("p",{className:"mt-3 text-sm text-gray-600",children:"Note: Only an approximate location is shown for privacy reasons"})]}),rV=({recipientName:e,listingTitle:t="this opportunity",listingLocation:i="the location",contactInfo:a={instagram:"student_exchange_eu",whatsapp:"+31 6 12345678",snapchat:"exchange_student",email:"student@university.edu"},buttonVariant:d="default",buttonColor:y=""})=>f.jsx(J6,{recipientName:e,listingTitle:t,listingLocation:i,contactInfo:a,buttonVariant:d,className:y}),nV=({itemName:e,variant:t="outline",colorClass:i=""})=>{const[a,d]=H.useState(!1),[y,S]=H.useState([]),{toast:s}=Ov(),N=()=>{if(a)d(!1),s({title:"Removed from Favorites",description:`This ${e} has been removed from your favorites.`});else{const D=Array(5).fill(0).map((O,$)=>({id:Date.now()+$,left:`${48+(Math.random()*6-3)}%`}));S([...y,...D]),setTimeout(()=>{S(O=>O.filter($=>!D.some(q=>q.id===$.id)))},1e3),d(!0),s({title:"Added to Favorites",description:`This ${e} has been added to your favorites.`})}};return f.jsxs("div",{className:"relative",children:[f.jsx(Kt,{variant:t,className:`w-full relative ${a?"bg-opacity-50 text-red-600 border-red-200":""} ${i}`,onClick:N,children:a?f.jsxs(f.Fragment,{children:[f.jsx(Rf,{className:"h-4 w-4 mr-2 text-red-500 fill-red-500"}),"Saved to Favorites"]}):f.jsxs(f.Fragment,{children:[f.jsx(Rf,{className:"h-4 w-4 mr-2"}),"Save to Favorites"]})}),y.map(D=>f.jsx(Rf,{className:"animate-float-up absolute bottom-full transform -translate-x-1/2 text-red-500 fill-red-500",style:{left:D.left,opacity:1},size:20},D.id))]})},Coe=e=>[{id:"101",user:{name:"The Martinez Family",avatar:"https://i.pravatar.cc/150?img=20",location:"Lyon, France"},accommodation:{title:"Private Room in Family Home",image:"https://images.unsplash.com/photo-1616047006789-b7af5afb8c20?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=60",benefits:"Private room, meals included, family atmosphere",description:"We offer a comfortable private room in our family home located in a quiet neighborhood of Lyon. The room has a single bed, desk, and plenty of storage space. You'll have access to a shared bathroom with the children. Our home is spacious with a garden and is located 15 minutes from the city center by public transport."},requirements:{hours:"15-20 hours per week",tasks:"Childcare for 2 children (ages 5 & 8), light housework",language:"English and basic French",additional:"We're looking for someone energetic, patient, and creative who enjoys spending time with children. Experience with childcare is preferred but not required if you have the right attitude. We'd like someone who can help with homework and organize fun activities."},duration:"Sep 10, 2023 - Jun 30, 2024",tags:["Family with Children","City Center","Cultural Exchange"],family:{description:"We are a friendly family of four, with two children aged 5 and 8. Both parents work in education. We enjoy outdoor activities, board games, and exploring our region during weekends. We've hosted au pairs before and value cultural exchange as part of the experience."}},{id:"102",user:{name:"The Schmidt Family",avatar:"https://i.pravatar.cc/150?img=30",location:"Munich, Germany"},accommodation:{title:"Guest Suite with Private Bathroom",image:"https://images.unsplash.com/photo-1505693416388-ac5ce068fe85?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=60",benefits:"Private suite, meals included, access to family car",description:"You will have your own private guest suite with an en-suite bathroom on the top floor of our house. The room includes a comfortable double bed, desk, TV, and mini-fridge. Our home is in a suburban area with good public transport connections to the city center (20 minutes by train)."},requirements:{hours:"20 hours per week",tasks:"Childcare for 3 children (ages 3, 6, 10), school pickups",language:"English and basic German",additional:"We need help primarily with school pickups, after-school activities, and occasional evening babysitting. The ideal candidate would be responsible, organized, and have a driver's license as you may need to drive the children to activities."},duration:"Oct 15, 2023 - Jul 15, 2024",tags:["Suburban Area","Pet-friendly","Near Public Transport"],family:{description:"We are a family of five with three active children. Both parents work full-time in business. We have a friendly dog named Max who loves attention. We enjoy hiking on weekends and have a vacation home in the mountains that we visit during school breaks."}},{id:"103",user:{name:"The Garcia Family",avatar:"https://i.pravatar.cc/150?img=33",location:"Madrid, Spain"},accommodation:{title:"Cozy Room in Modern Apartment",image:"https://images.unsplash.com/photo-1617104611622-d5f245d317f0?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=60",benefits:"Shared bathroom, meals included, Spanish lessons",description:"We offer a bright and cozy room in our modern apartment in central Madrid. You'll have your own bedroom with a single bed, desk and built-in wardrobe. The bathroom is shared with our daughter. Our apartment is located in a lively neighborhood with many cafes, restaurants and shops nearby."},requirements:{hours:"15 hours per week",tasks:"Childcare for 1 child (age 7), tutoring in English",language:"English, Spanish beneficial",additional:"We're looking for someone who can help our daughter improve her English through conversation, reading, and fun activities. We would prefer someone with some teaching experience or who enjoys working with children. A creative person who can make learning fun would be ideal."},duration:"Nov 1, 2023 - May 30, 2024",tags:["City Center","Cultural Activities","Language Exchange"],family:{description:"We are a small family of three. Mom is a university professor and Dad works in marketing. Our daughter is 7 years old and very curious and energetic. We love arts and culture, and often visit museums and attend concerts. We're offering Spanish lessons as part of the cultural exchange."}}].find(i=>i.id===e),Moe=()=>{const{id:e}=fP(),[t,i]=H.useState(null),[a,d]=H.useState(!0);return H.useEffect(()=>{if(e){const y=Coe(e);i(y),d(!1)}},[e]),a?f.jsxs("div",{className:"min-h-screen flex flex-col",children:[f.jsx(gi,{}),f.jsx("main",{className:"flex-grow flex items-center justify-center",children:f.jsx("div",{className:"animate-pulse",children:"Loading au pair details..."})}),f.jsx(_i,{})]}):t?f.jsxs("div",{className:"min-h-screen flex flex-col",children:[f.jsx(gi,{}),f.jsx("main",{className:"flex-grow py-8 px-4 md:px-8 bg-gray-50",children:f.jsxs("div",{className:"max-w-7xl mx-auto",children:[f.jsxs(un,{to:"/aupair",className:"flex items-center text-purple-600 mb-6 hover:underline",children:[f.jsx(G4,{className:"h-4 w-4 mr-2"}),"Back to Browse"]}),f.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between mb-8",children:[f.jsxs("div",{className:"flex items-center gap-4 mb-4 md:mb-0",children:[f.jsx("img",{src:t.user.avatar,alt:t.user.name,className:"w-16 h-16 rounded-full object-cover border-2 border-purple-500"}),f.jsxs("div",{children:[f.jsx("h1",{className:"text-2xl font-bold",children:t.user.name}),f.jsx("p",{className:"text-gray-600",children:t.user.location})]})]}),f.jsxs("div",{className:"flex items-center bg-white px-4 py-2 rounded-lg border",children:[f.jsx(nh,{className:"h-5 w-5 text-purple-600 mr-2"}),f.jsx("span",{className:"font-medium",children:t.duration})]})]}),f.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[f.jsxs("div",{className:"lg:col-span-2",children:[f.jsx(voe,{image:t.accommodation.image,title:t.accommodation.title}),f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 mb-8",children:[f.jsx(woe,{title:t.accommodation.title,benefits:t.accommodation.benefits,description:t.accommodation.description}),f.jsx(Soe,{hours:t.requirements.hours,tasks:t.requirements.tasks,language:t.requirements.language,additional:t.requirements.additional})]}),f.jsx(boe,{familyDescription:t.family.description,tags:t.tags})]}),f.jsxs("div",{children:[f.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm mb-6",children:[f.jsx("h3",{className:"font-semibold text-lg mb-4",children:"Interested in this opportunity?"}),f.jsxs("p",{className:"text-gray-600 mb-6",children:["Contact ",t.user.name," to discuss the details of this au pair arrangement"]}),f.jsx(rV,{recipientName:t.user.name,buttonColor:"bg-purple-600 hover:bg-purple-700 mb-3",placeholder:"I'm interested in your au pair opportunity. I would like to discuss..."}),f.jsx(nV,{itemName:"au pair opportunity"})]}),f.jsx(Eoe,{location:t.user.location})]})]})]})}),f.jsx(_i,{})]}):f.jsxs("div",{className:"min-h-screen flex flex-col",children:[f.jsx(gi,{}),f.jsx("main",{className:"flex-grow flex items-center justify-center p-4",children:f.jsxs("div",{className:"text-center",children:[f.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Au Pair Listing Not Found"}),f.jsx("p",{className:"mb-6",children:"The au pair listing you're looking for doesn't exist or has been removed."}),f.jsx(un,{to:"/aupair",children:f.jsx(Kt,{children:"Browse Au Pair Opportunities"})})]})}),f.jsx(_i,{})]})},Aoe=e=>[{id:"201",title:"Modern Studio in City Center",location:"Milan, Italy",price:"€850/month",images:["https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=60","https://images.unsplash.com/photo-1484154218962-a197022b5858?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=60","https://images.unsplash.com/photo-1560185127-6ed189bf02f4?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=60"],size:"30m²",description:"Fully furnished studio in the heart of Milan. Walking distance to universities and public transit. The apartment features a comfortable sleeping area, a small kitchenette with all necessary appliances, and a modern bathroom. Large windows provide plenty of natural light throughout the day.",amenities:["WiFi","Washer","Air Conditioning","Dishwasher","Smart TV","Building Security"],availability:"Available from Sep 1, 2023",landlordName:"Elena Rossi",landlordAvatar:"https://i.pravatar.cc/150?img=28",about:"I'm Elena, a university professor who has been renting to students for over 10 years. I live nearby and am always available to help with any issues that arise. I'm passionate about making sure my tenants have a comfortable and pleasant stay in Milan. I speak Italian, English, and some French.",additionalInfo:"Utilities included in the rent. Minimum stay of 4 months required. The building has an elevator and secure entry system."},{id:"202",title:"Charming 1-Bedroom Near University",location:"Vienna, Austria",price:"€700/month",images:["https://images.unsplash.com/photo-1493809842364-78817add7ffb?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=60","https://images.unsplash.com/photo-1598928636135-d146006ff4be?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=60","https://images.unsplash.com/photo-1574362848149-11496d93a7c7?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=60"],size:"45m²",description:"Beautiful 1-bedroom apartment with balcony, perfect for students. 5 minutes to university campus. The apartment consists of a separate bedroom, living room with an open kitchen, and a bathroom with shower. The balcony overlooks a quiet courtyard.",amenities:["Balcony","Furnished","Heating","Dishwasher","Storage Space","Bike Storage"],availability:"Available from Oct 15, 2023",landlordName:"Thomas Wagner",landlordAvatar:"https://i.pravatar.cc/150?img=51",about:"Hello! I'm Thomas, a local business owner who enjoys meeting students from around the world. I've been renting out this apartment for 5 years and take pride in maintaining it to a high standard. I'm responsive to maintenance requests and happy to provide advice about living in Vienna.",additionalInfo:"Utilities are not included in the rent price. No pets allowed. Security deposit equal to 2 months rent required."},{id:"203",title:"Shared 2-Bedroom Student Flat",location:"Lisbon, Portugal",price:"€450/month per room",images:["https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=60","https://images.unsplash.com/photo-1505693416388-ac5ce068fe85?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=60","https://images.unsplash.com/photo-1617104611622-d5f245d317f0?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=60"],size:"70m² (whole apartment)",description:"Room available in shared apartment with one other student. Common kitchen and living area. Great location. The available room is fully furnished with a single bed, desk, chair, and wardrobe. The apartment has a fully equipped kitchen, cozy living room, and a shared bathroom.",amenities:["Shared Kitchen","Laundry","WiFi","Utilities Included","Study Area","Public Transport Nearby"],availability:"Available immediately",landlordName:"Sofia Almeida",landlordAvatar:"https://i.pravatar.cc/150?img=47",about:"I'm Sofia, a young professional who owns and manages several student accommodations in Lisbon. As a former international student myself, I understand the challenges of finding comfortable housing in a new city. I strive to create a welcoming environment for all my tenants and am available to help with anything you might need during your stay.",additionalInfo:"Current roommate is a friendly 22-year-old female engineering student. Communal areas are cleaned once a week (included in rent). No overnight guests allowed more than twice per week."}].find(i=>i.id===e),Poe=()=>{const{id:e}=fP(),[t,i]=H.useState(null),[a,d]=H.useState(!0),[y,S]=H.useState(0),{toast:s}=Ov();H.useEffect(()=>{if(e){const D=Aoe(e);i(D),d(!1)}},[e]);const N=D=>{D.preventDefault(),s({title:"Viewing Requested",description:"Your viewing request has been submitted. We'll confirm the details soon."})};return a?f.jsxs("div",{className:"min-h-screen flex flex-col",children:[f.jsx(gi,{}),f.jsx("main",{className:"flex-grow flex items-center justify-center",children:f.jsx("div",{className:"animate-pulse",children:"Loading rental details..."})}),f.jsx(_i,{})]}):t?f.jsxs("div",{className:"min-h-screen flex flex-col",children:[f.jsx(gi,{}),f.jsx("main",{className:"flex-grow py-8 px-4 md:px-8 bg-gray-50",children:f.jsxs("div",{className:"max-w-7xl mx-auto",children:[f.jsxs(un,{to:"/rentals",className:"flex items-center text-amber-600 mb-6 hover:underline",children:[f.jsx(G4,{className:"h-4 w-4 mr-2"}),"Back to Browse"]}),f.jsxs("div",{className:"mb-6",children:[f.jsx("h1",{className:"text-2xl font-bold mb-2",children:t.title}),f.jsxs("div",{className:"flex items-center text-gray-600",children:[f.jsx(Ec,{className:"h-4 w-4 mr-1"}),f.jsx("p",{children:t.location})]})]}),f.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[f.jsxs("div",{className:"lg:col-span-2",children:[f.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden mb-8",children:[f.jsx("div",{className:"relative aspect-video",children:f.jsx("img",{src:t.images[y],alt:t.title,className:"w-full h-full object-cover"})}),f.jsx("div",{className:"p-2 flex overflow-x-auto gap-2",children:t.images.map((D,O)=>f.jsx("button",{onClick:()=>S(O),className:`relative w-20 h-20 flex-shrink-0 ${O===y?"ring-2 ring-amber-500":""}`,children:f.jsx("img",{src:D,alt:`Thumbnail ${O+1}`,className:"w-full h-full object-cover rounded"})},O))})]}),f.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-8",children:[f.jsxs("div",{className:"flex justify-between items-center mb-6",children:[f.jsx("h2",{className:"text-xl font-semibold",children:"Property Details"}),f.jsxs("div",{className:"flex items-center",children:[f.jsx(xg,{className:"h-5 w-5 text-amber-600 mr-2"}),f.jsx("span",{className:"text-xl font-bold text-amber-600",children:t.price})]})]}),f.jsxs("div",{className:"mb-4",children:[f.jsx("p",{className:"text-gray-600 mb-1",children:"Size"}),f.jsx("p",{className:"font-medium",children:t.size})]}),f.jsxs("div",{className:"mb-4",children:[f.jsx("p",{className:"text-gray-600 mb-1",children:"Availability"}),f.jsx("p",{className:"font-medium",children:t.availability})]}),f.jsxs("div",{className:"mb-6",children:[f.jsx("p",{className:"text-gray-600 mb-2",children:"Description"}),f.jsx("p",{className:"text-gray-800",children:t.description})]}),f.jsxs("div",{children:[f.jsx("p",{className:"text-gray-600 mb-3",children:"Amenities"}),f.jsx("div",{className:"flex flex-wrap gap-2",children:t.amenities.map((D,O)=>f.jsx(wn,{variant:"secondary",className:"bg-gray-100 text-gray-800 py-1.5 px-3 text-sm",children:D},O))})]})]}),f.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-8",children:[f.jsx("h2",{className:"text-xl font-semibold mb-4",children:"About the Landlord"}),f.jsx("p",{className:"text-gray-700",children:t.about})]}),f.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-8",children:[f.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Additional Information"}),f.jsx("p",{className:"text-gray-700",children:t.additionalInfo})]})]}),f.jsxs("div",{children:[f.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm mb-6",children:[f.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[f.jsx("img",{src:t.landlordAvatar,alt:t.landlordName,className:"w-12 h-12 rounded-full object-cover border-2 border-amber-500"}),f.jsxs("div",{children:[f.jsx("h3",{className:"font-medium",children:t.landlordName}),f.jsx("p",{className:"text-sm text-gray-600",children:"Property Manager"})]})]}),f.jsx(rV,{recipientName:t.landlordName,buttonColor:"bg-amber-600 hover:bg-amber-700 mb-3",placeholder:"I'm interested in this property and would like to know more about...",successMessage:`Your message has been sent to ${t.landlordName}. They will get back to you soon.`}),f.jsxs(Wg,{children:[f.jsx(t0,{asChild:!0,children:f.jsxs(Kt,{variant:"outline",className:"w-full mb-3",children:[f.jsx(Xm,{className:"h-4 w-4 mr-2"}),"Schedule Viewing"]})}),f.jsxs(np,{className:"sm:max-w-[425px]",children:[f.jsxs(ip,{children:[f.jsx(sp,{children:"Schedule a Viewing"}),f.jsx(q2,{children:"Select a date and time that works for you to see this property."})]}),f.jsxs("form",{onSubmit:N,className:"space-y-4 py-4",children:[f.jsxs("div",{className:"grid w-full items-center gap-1.5",children:[f.jsx("label",{htmlFor:"viewing-name",className:"text-sm font-medium",children:"Your Name"}),f.jsx("input",{id:"viewing-name",className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background",required:!0})]}),f.jsxs("div",{className:"grid w-full items-center gap-1.5",children:[f.jsx("label",{htmlFor:"viewing-email",className:"text-sm font-medium",children:"Your Email"}),f.jsx("input",{id:"viewing-email",type:"email",className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background",required:!0})]}),f.jsxs("div",{className:"grid w-full items-center gap-1.5",children:[f.jsx("label",{htmlFor:"viewing-date",className:"text-sm font-medium",children:"Preferred Date"}),f.jsx("input",{id:"viewing-date",type:"date",className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background",required:!0})]}),f.jsxs("div",{className:"grid w-full items-center gap-1.5",children:[f.jsx("label",{htmlFor:"viewing-time",className:"text-sm font-medium",children:"Preferred Time"}),f.jsxs("select",{id:"viewing-time",className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background",required:!0,children:[f.jsx("option",{value:"",children:"Select a time"}),f.jsx("option",{value:"morning",children:"Morning (9AM - 12PM)"}),f.jsx("option",{value:"afternoon",children:"Afternoon (12PM - 5PM)"}),f.jsx("option",{value:"evening",children:"Evening (5PM - 8PM)"})]})]}),f.jsx(nI,{children:f.jsx(Kt,{type:"submit",children:"Request Viewing"})})]})]})]}),f.jsx(nV,{itemName:"rental property"})]}),f.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[f.jsx("h3",{className:"font-semibold text-lg mb-4",children:"Location"}),f.jsx("div",{className:"rounded-lg h-48",children:f.jsx(tV,{city:t.location})}),f.jsx("p",{className:"mt-3 text-sm text-gray-600",children:"Note: The exact address will be provided after initial screening"})]})]})]})]})}),f.jsx(_i,{})]}):f.jsxs("div",{className:"min-h-screen flex flex-col",children:[f.jsx(gi,{}),f.jsx("main",{className:"flex-grow flex items-center justify-center p-4",children:f.jsxs("div",{className:"text-center",children:[f.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Rental Listing Not Found"}),f.jsx("p",{className:"mb-6",children:"The rental listing you're looking for doesn't exist or has been removed."}),f.jsx(un,{to:"/rentals",children:f.jsx(Kt,{children:"Browse Available Rentals"})})]})}),f.jsx(_i,{})]})},Ioe=()=>{const[e]=HX(),[t,i]=H.useState("loading"),[a,d]=H.useState(null),y=$l();return H.useEffect(()=>{(async()=>{console.log("Starting email verification process"),console.log("URL params:",Object.fromEntries(e.entries()));const s=e.get("token_hash"),N=e.get("type");if(console.log("Verification params:",{token_hash:!!s,type:N}),!s||!N){console.error("Missing token_hash or type in URL"),i("error"),di.error("Invalid verification link",{description:"The link appears to be missing required parameters."});return}try{const{data:D,error:O}=await Pi.auth.verifyOtp({token_hash:s,type:N,options:{redirectTo:window.location.origin}});O?(console.error("Verification error:",O),i("error"),di.error("Verification failed",{description:O.message})):(console.log("Email verification successful:",D),d(D.user),i("success"),di.success("Email verified successfully!",{description:"Let's complete your profile setup"}),setTimeout(()=>{y("/onboarding")},3e3))}catch(D){console.error("Error during verification:",D),i("error"),di.error("Verification process failed",{description:"Please try signing up again or contact support."})}})()},[e,y]),f.jsxs("div",{className:"min-h-screen flex flex-col",children:[f.jsx(gi,{}),f.jsx("main",{className:"flex-grow flex items-center justify-center p-4",children:f.jsxs("div",{className:"w-full max-w-md bg-white rounded-lg shadow-sm p-8",children:[t==="loading"&&f.jsxs("div",{className:"text-center space-y-4",children:[f.jsx(Bf,{className:"h-16 w-16 text-swap-blue animate-spin mx-auto"}),f.jsx("h1",{className:"text-2xl font-bold",children:"Verifying your email..."}),f.jsx("p",{className:"text-gray-600",children:"This will only take a moment."})]}),t==="success"&&f.jsxs("div",{className:"text-center space-y-4",children:[f.jsx(pu,{className:"h-16 w-16 text-green-500 mx-auto"}),f.jsx("h1",{className:"text-2xl font-bold text-green-700",children:"Email Verified!"}),f.jsx("p",{className:"text-gray-600",children:"Your email has been successfully verified. Let's complete your profile setup to see your first matches!"}),f.jsxs("div",{className:"pt-4",children:[f.jsx(Kt,{asChild:!0,className:"w-full",children:f.jsx(un,{to:"/onboarding",children:"Complete Profile Setup"})}),f.jsx("p",{className:"mt-4 text-sm text-gray-500",children:"Redirecting to profile setup in a few seconds..."})]})]}),t==="error"&&f.jsxs("div",{className:"text-center space-y-4",children:[f.jsx(mW,{className:"h-16 w-16 text-red-500 mx-auto"}),f.jsx("h1",{className:"text-2xl font-bold text-red-700",children:"Verification Failed"}),f.jsx("p",{className:"text-gray-600",children:"We couldn't verify your email address. The verification link may be expired or invalid."}),f.jsxs("div",{className:"pt-4",children:[f.jsx(Kt,{asChild:!0,variant:"outline",className:"w-full",children:f.jsx(un,{to:"/signup",children:"Try Again"})}),f.jsxs("p",{className:"mt-4 text-sm text-gray-500",children:["If you continue to have issues, please ",f.jsx(un,{to:"/support",className:"text-swap-blue hover:underline",children:"contact support"})]})]})]})]})}),f.jsx(_i,{})]})};function koe({className:e}){const{subscriptionData:t,isPremium:i,loading:a,user:d}=H2(),y=async D=>{var O;if(!d){di.error("Please log in to upgrade your subscription");return}try{const{data:$,error:q}=await Pi.functions.invoke("create-checkout",{body:{tier:D},headers:{Authorization:`Bearer ${(O=(await Pi.auth.getSession()).data.session)==null?void 0:O.access_token}`}});if(q){console.error("Checkout error:",q),di.error("Failed to start checkout. Please try again.");return}$!=null&&$.url&&window.open($.url,"_blank")}catch($){console.error("Error creating checkout:",$),di.error("An error occurred. Please try again.")}},S=async()=>{var D;if(!d){di.error("Please log in to manage your subscription");return}try{const{data:O,error:$}=await Pi.functions.invoke("customer-portal",{headers:{Authorization:`Bearer ${(D=(await Pi.auth.getSession()).data.session)==null?void 0:D.access_token}`}});if($){console.error("Portal error:",$),di.error("Failed to open customer portal. Please try again.");return}O!=null&&O.url&&(window.location.href=O.url)}catch(O){console.error("Error opening customer portal:",O),di.error("An error occurred. Please try again.")}},s=[{id:"free",name:"Free Browsing",price:"€0",period:"forever",description:"Browse student profiles and accommodations",features:[{name:"Browse all listings",included:!0},{name:"View student profiles",included:!0},{name:"University verification",included:!0},{name:"Basic safety guidelines",included:!0},{name:"Contact information access",included:!1},{name:"Direct messaging",included:!1},{name:"Priority support",included:!1},{name:"Profile views tracking",included:!1},{name:"Premium badge",included:!1},{name:"Advanced matching",included:!1},{name:"Swap guarantee",included:!1}],buttonText:"Current Plan",highlight:!1},{id:"basic",name:"Basic Connect",price:"€15",period:"/month",description:"Connect with up to 5 students per month",features:[{name:"Everything in Free",included:!0},{name:"5 contact reveals per month",included:!0},{name:"Direct messaging (5 chats/month)",included:!0},{name:"Email support",included:!0},{name:"Profile views tracking",included:!0},{name:"Premium badge",included:!1},{name:"Priority support",included:!1},{name:"Advanced matching",included:!1},{name:"Swap guarantee",included:!1},{name:"Spotlighted listings",included:!1},{name:"Unlimited connections",included:!1}],buttonText:"Get Basic",highlight:!1},{id:"premium",name:"Premium Connect",price:"€25",period:"/month",description:"Unlimited connections with premium features",features:[{name:"Everything in Basic",included:!0},{name:"Unlimited contact reveals",included:!0},{name:"Unlimited direct messaging",included:!0},{name:"Priority support (2h response)",included:!0},{name:"Advanced matching algorithm",included:!0},{name:"Premium badge",included:!0},{name:"Profile boost (2x visibility)",included:!0},{name:"Swap guarantee protection",included:!1},{name:"Spotlighted listings",included:!1},{name:"Concierge service",included:!1},{name:"Legal assistance",included:!1}],buttonText:"Get Premium",highlight:!0},{id:"elite",name:"Elite Experience",price:"€45",period:"/month",description:"Everything included with VIP treatment",features:[{name:"Everything in Premium",included:!0},{name:"Swap guarantee protection",included:!0},{name:"Spotlighted listings (top placement)",included:!0},{name:"Personal concierge service",included:!0},{name:"Legal assistance & contracts",included:!0},{name:"24/7 priority support",included:!0},{name:"Custom matching preferences",included:!0},{name:"Exclusive events access",included:!0},{name:"Travel insurance discount",included:!0},{name:"Multi-city planning",included:!0},{name:"VIP badge",included:!0}],buttonText:"Get Elite",highlight:!1}],N=(t==null?void 0:t.subscription_tier)||"free";return a?f.jsx("div",{className:e,children:f.jsx(Zr,{children:f.jsx(Kr,{className:"p-6",children:f.jsxs("div",{className:"animate-pulse",children:[f.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),f.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"})]})})})}):f.jsx("div",{className:e,children:f.jsxs("div",{className:"space-y-8",children:[f.jsxs(Zr,{className:i?"border-yellow-200 bg-yellow-50":"",children:[f.jsx(zn,{children:f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{children:[f.jsx(Fn,{className:"flex items-center gap-2",children:N==="elite"?f.jsxs(f.Fragment,{children:[f.jsx(gc,{className:"h-5 w-5 text-purple-600"}),"Elite Experience"]}):N==="premium"?f.jsxs(f.Fragment,{children:[f.jsx(gc,{className:"h-5 w-5 text-yellow-600"}),"Premium Connect"]}):N==="basic"?f.jsxs(f.Fragment,{children:[f.jsx(Dl,{className:"h-5 w-5 text-blue-600"}),"Basic Connect"]}):"Free Browsing"}),f.jsx(oo,{children:N==="elite"?`You have elite access with all features${t!=null&&t.subscription_end?` until ${new Date(t.subscription_end).toLocaleDateString()}`:""}`:N==="premium"?`You have unlimited connections and premium features${t!=null&&t.subscription_end?` until ${new Date(t.subscription_end).toLocaleDateString()}`:""}`:N==="basic"?`You can connect with up to 5 students per month${t!=null&&t.subscription_end?` until ${new Date(t.subscription_end).toLocaleDateString()}`:""}`:"Browse student profiles and accommodations. Upgrade to start connecting directly."})]}),f.jsx(wn,{variant:i?"default":"secondary",children:N==="elite"?"Elite":N==="premium"?"Premium":N==="basic"?"Basic":"Free"})]})}),f.jsx(Kr,{children:f.jsx("div",{className:"flex gap-3",children:i?f.jsx(Kt,{variant:"outline",onClick:S,children:"Manage Subscription"}):f.jsxs(Kt,{onClick:()=>y("basic"),className:"bg-blue-600 hover:bg-blue-700",children:[f.jsx(Dl,{className:"h-4 w-4 mr-2"}),"Start with Basic - €15/month"]})})})]}),f.jsxs(Zr,{children:[f.jsxs(zn,{children:[f.jsx(Fn,{children:"Choose Your Plan"}),f.jsx(oo,{children:"Select the plan that best fits your student accommodation needs"})]}),f.jsx(Kr,{children:f.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:s.map(D=>f.jsxs("div",{className:`relative rounded-lg border p-6 ${D.highlight?"border-yellow-300 bg-yellow-50 ring-2 ring-yellow-300":N===D.id?"border-green-300 bg-green-50":"border-gray-200"}`,children:[D.highlight&&f.jsx("div",{className:"absolute -top-3 left-1/2 transform -translate-x-1/2",children:f.jsx(wn,{className:"bg-yellow-600 text-white",children:"Most Popular"})}),N===D.id&&f.jsx("div",{className:"absolute -top-3 left-1/2 transform -translate-x-1/2",children:f.jsx(wn,{className:"bg-green-600 text-white",children:"Current Plan"})}),f.jsxs("div",{className:"text-center mb-4",children:[f.jsx("h3",{className:"text-lg font-semibold mb-2",children:D.name}),f.jsxs("div",{className:"mb-2",children:[f.jsx("span",{className:"text-3xl font-bold",children:D.price}),f.jsx("span",{className:"text-gray-500",children:D.period})]}),f.jsx("p",{className:"text-sm text-gray-600",children:D.description})]}),f.jsx("ul",{className:"space-y-2 mb-6",children:D.features.map((O,$)=>f.jsxs("li",{className:"flex items-center gap-2 text-sm",children:[O.included?f.jsx(Co,{className:"h-4 w-4 text-green-600 flex-shrink-0"}):f.jsx(wc,{className:"h-4 w-4 text-gray-400 flex-shrink-0"}),f.jsx("span",{className:O.included?"":"text-gray-500",children:O.name})]},$))}),f.jsx(Kt,{className:"w-full",variant:N===D.id?"outline":D.highlight?"default":"outline",disabled:N===D.id,onClick:()=>{D.id!=="free"&&N!==D.id&&y(D.id)},children:N===D.id?"Current Plan":D.buttonText})]},D.id))})})]}),f.jsxs(Zr,{className:"border-blue-200 bg-blue-50",children:[f.jsx(zn,{children:f.jsxs(Fn,{className:"flex items-center gap-2",children:[f.jsx(Ao,{className:"h-5 w-5 text-blue-600"}),"Built on Trust"]})}),f.jsxs(Kr,{children:[f.jsx("p",{className:"text-sm text-blue-800 mb-3",children:"SwapSpot is designed for European university students who value trust and community. All members are verified through their university email addresses."}),f.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[f.jsx("li",{children:"• University email verification required"}),f.jsx("li",{children:"• Student-to-student connections only"}),f.jsx("li",{children:"• Safe, familiar social platforms for communication"}),f.jsx("li",{children:"• Community-driven safety guidelines"}),f.jsx("li",{children:"• Swap guarantee for Premium+ members"})]})]})]})]})})}const Noe=()=>{var s;const[e,t]=H.useState(null),[i,a]=H.useState(!0),d=$l(),{isPremium:y}=H2();H.useEffect(()=>{(async()=>{try{a(!0);const{data:{session:D}}=await Pi.auth.getSession();if(!D){d("/login");return}t(D.user)}catch(D){console.error("Error fetching user profile:",D),di.error("Failed to load your profile")}finally{a(!1)}})()},[d]);const S=async()=>{try{await Pi.auth.signOut(),di.success("You've been logged out successfully"),d("/")}catch(N){console.error("Logout error:",N),di.error("Failed to log out. Please try again.")}};return i?f.jsxs("div",{className:"min-h-screen flex flex-col",children:[f.jsx(gi,{}),f.jsx("main",{className:"flex-grow flex items-center justify-center",children:f.jsxs("div",{className:"text-center",children:[f.jsx("div",{className:"w-12 h-12 border-4 border-swap-blue border-t-transparent rounded-full animate-spin mx-auto"}),f.jsx("p",{className:"mt-4",children:"Loading your profile..."})]})}),f.jsx(_i,{})]}):f.jsxs("div",{className:"min-h-screen flex flex-col",children:[f.jsx(gi,{}),f.jsx("main",{className:"flex-grow py-12 px-4",children:f.jsxs("div",{className:"max-w-4xl mx-auto",children:[f.jsx("h1",{className:"text-3xl font-bold mb-8",children:"Your Account"}),f.jsxs("div",{className:"space-y-6",children:[f.jsx(koe,{}),f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[f.jsx("div",{className:"md:col-span-1",children:f.jsxs(Zr,{className:"h-full",children:[f.jsxs(zn,{children:[f.jsxs(Fn,{className:"flex items-center gap-2",children:["Profile",y&&f.jsx(gc,{className:"h-4 w-4 text-yellow-600"})]}),f.jsx(oo,{children:"Your account information"})]}),f.jsx(Kr,{children:f.jsxs("div",{className:"flex flex-col space-y-4",children:[f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx("div",{className:"h-12 w-12 rounded-full bg-swap-lightBlue flex items-center justify-center",children:f.jsx(K4,{className:"h-6 w-6 text-swap-blue"})}),f.jsxs("div",{children:[f.jsx("p",{className:"font-medium",children:((s=e==null?void 0:e.email)==null?void 0:s.split("@")[0])||"User"}),f.jsx("p",{className:"text-sm text-gray-500",children:"Verified Student"})]})]}),f.jsxs("div",{className:"pt-4",children:[f.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Email"}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx(Vf,{className:"h-4 w-4 text-gray-500"}),f.jsx("span",{children:e==null?void 0:e.email})]})]}),f.jsxs("div",{className:"pt-4 flex flex-col gap-2",children:[f.jsx(Kt,{variant:"outline",size:"sm",className:"justify-start",asChild:!0,children:f.jsxs("a",{href:"/settings",children:[f.jsx(kW,{className:"h-4 w-4 mr-2"}),"Edit Profile"]})}),f.jsxs(Kt,{variant:"ghost",size:"sm",className:"justify-start text-red-600 hover:text-red-700 hover:bg-red-50",onClick:S,children:[f.jsx(SW,{className:"h-4 w-4 mr-2"}),"Log Out"]})]})]})})]})}),f.jsx("div",{className:"md:col-span-2",children:f.jsxs(Zr,{className:"h-full",children:[f.jsxs(zn,{children:[f.jsx(Fn,{children:"Your Places"}),f.jsx(oo,{children:"Places you've listed for swap"})]}),f.jsx(Kr,{children:f.jsxs("div",{className:"text-center py-12 border border-dashed border-gray-300 rounded-md",children:[f.jsx("div",{className:"mx-auto w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center mb-4",children:f.jsx(rv,{className:"h-8 w-8 text-gray-400"})}),f.jsx("h3",{className:"text-lg font-medium mb-2",children:"No Places Added Yet"}),f.jsx("p",{className:"text-gray-500 mb-6 max-w-sm mx-auto",children:"List your accommodation to start swapping with other students around the world"}),f.jsx(Kt,{className:"bg-green-600 hover:bg-green-700",asChild:!0,children:f.jsxs("a",{href:"/post-place",children:[f.jsx(rv,{className:"h-4 w-4 mr-2"}),"Add Your First Place"]})})]})})]})})]})]})]})}),f.jsx(_i,{})]})},fv=H.forwardRef(({className:e,...t},i)=>f.jsx("textarea",{className:br("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:i,...t}));fv.displayName="Textarea";var iI="Checkbox",[Roe,Dce]=ta(iI),[joe,Doe]=Roe(iI),iV=H.forwardRef((e,t)=>{const{__scopeCheckbox:i,name:a,checked:d,defaultChecked:y,required:S,disabled:s,value:N="on",onCheckedChange:D,form:O,...$}=e,[q,J]=H.useState(null),re=dn(t,Se=>J(Se)),Q=H.useRef(!1),ce=q?O||!!q.closest("form"):!0,[le=!1,ae]=Xa({prop:d,defaultProp:y,onChange:D}),he=H.useRef(le);return H.useEffect(()=>{const Se=q==null?void 0:q.form;if(Se){const je=()=>ae(he.current);return Se.addEventListener("reset",je),()=>Se.removeEventListener("reset",je)}},[q,ae]),f.jsxs(joe,{scope:i,state:le,disabled:s,children:[f.jsx(wr.button,{type:"button",role:"checkbox","aria-checked":eh(le)?"mixed":le,"aria-required":S,"data-state":aV(le),"data-disabled":s?"":void 0,disabled:s,value:N,...$,ref:re,onKeyDown:Ht(e.onKeyDown,Se=>{Se.key==="Enter"&&Se.preventDefault()}),onClick:Ht(e.onClick,Se=>{ae(je=>eh(je)?!0:!je),ce&&(Q.current=Se.isPropagationStopped(),Q.current||Se.stopPropagation())})}),ce&&f.jsx(Loe,{control:q,bubbles:!Q.current,name:a,value:N,checked:le,required:S,disabled:s,form:O,style:{transform:"translateX(-100%)"},defaultChecked:eh(y)?!1:y})]})});iV.displayName=iI;var sV="CheckboxIndicator",oV=H.forwardRef((e,t)=>{const{__scopeCheckbox:i,forceMount:a,...d}=e,y=Doe(sV,i);return f.jsx(Yi,{present:a||eh(y.state)||y.state===!0,children:f.jsx(wr.span,{"data-state":aV(y.state),"data-disabled":y.disabled?"":void 0,...d,ref:t,style:{pointerEvents:"none",...e.style}})})});oV.displayName=sV;var Loe=e=>{const{control:t,checked:i,bubbles:a=!0,defaultChecked:d,...y}=e,S=H.useRef(null),s=E2(i),N=iP(t);H.useEffect(()=>{const O=S.current,$=window.HTMLInputElement.prototype,J=Object.getOwnPropertyDescriptor($,"checked").set;if(s!==i&&J){const re=new Event("click",{bubbles:a});O.indeterminate=eh(i),J.call(O,eh(i)?!1:i),O.dispatchEvent(re)}},[s,i,a]);const D=H.useRef(eh(i)?!1:i);return f.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:d??D.current,...y,tabIndex:-1,ref:S,style:{...e.style,...N,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function eh(e){return e==="indeterminate"}function aV(e){return eh(e)?"indeterminate":e?"checked":"unchecked"}var lV=iV,Ooe=oV;const Pm=H.forwardRef(({className:e,...t},i)=>f.jsx(lV,{ref:i,className:br("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...t,children:f.jsx(Ooe,{className:br("flex items-center justify-center text-current"),children:f.jsx(Co,{className:"h-4 w-4"})})}));Pm.displayName=lV.displayName;const zoe=()=>{const[e,t]=H.useState(""),[i,a]=H.useState(""),[d,y]=H.useState("private"),[S,s]=H.useState(""),[N,D]=H.useState(""),[O,$]=H.useState(""),[q,J]=H.useState(""),[re,Q]=H.useState(""),[ce,le]=H.useState([]),[ae,he]=H.useState(""),[Se,je]=H.useState([]),[it,qe]=H.useState(""),[ct,pt]=H.useState({smoking:!1,pets:!1,guests:!1,quietHours:"",cleaningSchedule:""}),[Ze,yt]=H.useState(null),[Mt,Jt]=H.useState(!1),[jt,Pt]=H.useState(!1),Wt=$l(),Nt=["WiFi","Furnished","Kitchen","Parking","Air Conditioning","Heating","Washing Machine","Dishwasher","Balcony","Garden"],Xe=["Metro","Bus","Train","Tram","Bike Sharing","Walking Distance"];H.useEffect(()=>{(async()=>{var Br;const{data:qt}=await Pi.auth.getSession();(Br=qt==null?void 0:qt.session)!=null&&Br.user?(yt(qt.session.user),Jt(!0),di.success("Welcome back!",{description:"You're logged in and ready to post your apartment"})):(console.log("User not authenticated but allowing access for demo"),di.info("Demo Mode",{description:"You're using this feature in demo mode"}))})()},[]);const nt=At=>{le(qt=>qt.includes(At)?qt.filter(Br=>Br!==At):[...qt,At])},Qt=()=>{ae.trim()&&!ce.includes(ae.trim())&&(le(At=>[...At,ae.trim()]),he(""))},rr=At=>{le(qt=>qt.filter(Br=>Br!==At))},mr=At=>{je(qt=>qt.includes(At)?qt.filter(Br=>Br!==At):[...qt,At])},Ut=()=>{it.trim()&&!Se.includes(it.trim())&&(je(At=>[...At,it.trim()]),qe(""))},hn=At=>{je(qt=>qt.filter(Br=>Br!==At))},Gn=async At=>{if(At.preventDefault(),!jt){Pt(!0);try{if(!e||!i||!q){di.error("Please fill in all required fields"),Pt(!1);return}di.success("Enhanced apartment listing submitted!",{description:"Your detailed listing with amenities and house rules has been created."}),t(""),a(""),y("private"),s(""),D(""),$(""),J(""),Q(""),le([]),je([]),pt({smoking:!1,pets:!1,guests:!1,quietHours:"",cleaningSchedule:""}),setTimeout(()=>Wt("/browse"),1500)}catch(qt){console.error("Error submitting form:",qt),di.error("Something went wrong",{description:"Please try again later"})}finally{Pt(!1)}}};return f.jsxs("div",{className:"min-h-screen flex flex-col",children:[f.jsx(gi,{}),f.jsx("main",{className:"flex-grow py-10 px-4 bg-gray-50",children:f.jsxs("div",{className:"max-w-4xl mx-auto",children:[f.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Post Your Apartment"}),f.jsx("p",{className:"text-gray-600 mb-8",children:"Create a detailed listing to find the perfect swap partner"}),!Mt&&f.jsx(_u,{className:"mb-6 bg-blue-50 border border-blue-200",children:f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx(pW,{className:"h-5 w-5 text-blue-500"}),f.jsxs("div",{children:[f.jsx("h3",{className:"font-medium text-blue-700",children:"Demo Mode"}),f.jsx(yu,{className:"text-blue-600",children:"You're using this feature in demo mode. In a production app, verification would be required."})]})]})}),f.jsxs("form",{onSubmit:Gn,className:"space-y-6",children:[f.jsxs(Zr,{children:[f.jsxs(zn,{children:[f.jsx(Fn,{children:"Basic Information"}),f.jsx(oo,{children:"Essential details about your accommodation"})]}),f.jsxs(Kr,{className:"space-y-4",children:[f.jsxs("div",{children:[f.jsx("label",{htmlFor:"title",className:"text-sm font-medium block mb-1",children:"Listing Title *"}),f.jsx(Pn,{id:"title",placeholder:"e.g., Cozy Studio in the City Center",value:e,onChange:At=>t(At.target.value),required:!0})]}),f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[f.jsxs("div",{children:[f.jsx("label",{htmlFor:"location",className:"text-sm font-medium block mb-1",children:"City/Location *"}),f.jsx(Pn,{id:"location",placeholder:"e.g., Amsterdam, Netherlands",value:i,onChange:At=>a(At.target.value),required:!0})]}),f.jsxs("div",{children:[f.jsx("label",{htmlFor:"neighborhood",className:"text-sm font-medium block mb-1",children:"Neighborhood"}),f.jsx(Pn,{id:"neighborhood",placeholder:"e.g., City Center, University District",value:re,onChange:At=>Q(At.target.value)})]})]}),f.jsxs("div",{children:[f.jsx("label",{htmlFor:"roomType",className:"text-sm font-medium block mb-1",children:"Room Type"}),f.jsxs(Jd,{value:d,onValueChange:y,children:[f.jsx(ou,{children:f.jsx(Qd,{placeholder:"Select Room Type"})}),f.jsxs(au,{children:[f.jsx(hs,{value:"entire",children:"Entire Place"}),f.jsx(hs,{value:"private",children:"Private Room"}),f.jsx(hs,{value:"shared",children:"Shared Room"}),f.jsx(hs,{value:"studio",children:"Studio"})]})]})]}),f.jsxs("div",{children:[f.jsx("label",{htmlFor:"description",className:"text-sm font-medium block mb-1",children:"Description *"}),f.jsx(fv,{id:"description",placeholder:"Describe your place, including what makes it special, the atmosphere, and what you love about living there...",rows:4,value:q,onChange:At=>J(At.target.value),required:!0})]})]})]}),f.jsxs(Zr,{children:[f.jsxs(zn,{children:[f.jsx(Fn,{children:"Pricing Information"}),f.jsx(oo,{children:"Optional pricing details to help with planning"})]}),f.jsx(Kr,{children:f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[f.jsxs("div",{children:[f.jsx("label",{htmlFor:"monthlyRent",className:"text-sm font-medium block mb-1",children:"Monthly Rent"}),f.jsx(Pn,{id:"monthlyRent",type:"text",placeholder:"e.g., €800",value:S,onChange:At=>s(At.target.value)})]}),f.jsxs("div",{children:[f.jsx("label",{htmlFor:"utilities",className:"text-sm font-medium block mb-1",children:"Utilities"}),f.jsx(Pn,{id:"utilities",type:"text",placeholder:"e.g., €50 included",value:N,onChange:At=>D(At.target.value)})]}),f.jsxs("div",{children:[f.jsx("label",{htmlFor:"deposit",className:"text-sm font-medium block mb-1",children:"Deposit"}),f.jsx(Pn,{id:"deposit",type:"text",placeholder:"e.g., €400",value:O,onChange:At=>$(At.target.value)})]})]})})]}),f.jsxs(Zr,{children:[f.jsxs(zn,{children:[f.jsx(Fn,{children:"Amenities & Features"}),f.jsx(oo,{children:"What does your place offer?"})]}),f.jsxs(Kr,{className:"space-y-4",children:[f.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:Nt.map(At=>f.jsxs("div",{className:"flex items-center space-x-2",children:[f.jsx(Pm,{id:At,checked:ce.includes(At),onCheckedChange:()=>nt(At)}),f.jsx("label",{htmlFor:At,className:"text-sm",children:At})]},At))}),f.jsxs("div",{className:"flex gap-2",children:[f.jsx(Pn,{placeholder:"Add custom amenity",value:ae,onChange:At=>he(At.target.value),onKeyPress:At=>At.key==="Enter"&&(At.preventDefault(),Qt())}),f.jsx(Kt,{type:"button",variant:"outline",onClick:Qt,children:f.jsx(rv,{className:"h-4 w-4"})})]}),f.jsx("div",{className:"flex flex-wrap gap-2",children:ce.map(At=>f.jsxs(wn,{variant:"secondary",className:"flex items-center gap-1",children:[At,f.jsx("button",{type:"button",onClick:()=>rr(At),children:f.jsx(wc,{className:"h-3 w-3"})})]},At))})]})]}),f.jsxs(Zr,{children:[f.jsxs(zn,{children:[f.jsx(Fn,{children:"Transportation"}),f.jsx(oo,{children:"What transportation options are nearby?"})]}),f.jsxs(Kr,{className:"space-y-4",children:[f.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:Xe.map(At=>f.jsxs("div",{className:"flex items-center space-x-2",children:[f.jsx(Pm,{id:At,checked:Se.includes(At),onCheckedChange:()=>mr(At)}),f.jsx("label",{htmlFor:At,className:"text-sm",children:At})]},At))}),f.jsxs("div",{className:"flex gap-2",children:[f.jsx(Pn,{placeholder:"Add custom transportation",value:it,onChange:At=>qe(At.target.value),onKeyPress:At=>At.key==="Enter"&&(At.preventDefault(),Ut())}),f.jsx(Kt,{type:"button",variant:"outline",onClick:Ut,children:f.jsx(rv,{className:"h-4 w-4"})})]}),f.jsx("div",{className:"flex flex-wrap gap-2",children:Se.map(At=>f.jsxs(wn,{variant:"secondary",className:"flex items-center gap-1",children:[At,f.jsx("button",{type:"button",onClick:()=>hn(At),children:f.jsx(wc,{className:"h-3 w-3"})})]},At))})]})]}),f.jsxs(Zr,{children:[f.jsxs(zn,{children:[f.jsx(Fn,{children:"House Rules"}),f.jsx(oo,{children:"Set expectations for your space"})]}),f.jsxs(Kr,{className:"space-y-4",children:[f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[f.jsxs("div",{className:"flex items-center space-x-2",children:[f.jsx(Pm,{id:"smoking",checked:ct.smoking,onCheckedChange:At=>pt(qt=>({...qt,smoking:!!At}))}),f.jsx("label",{htmlFor:"smoking",className:"text-sm",children:"Smoking allowed"})]}),f.jsxs("div",{className:"flex items-center space-x-2",children:[f.jsx(Pm,{id:"pets",checked:ct.pets,onCheckedChange:At=>pt(qt=>({...qt,pets:!!At}))}),f.jsx("label",{htmlFor:"pets",className:"text-sm",children:"Pets allowed"})]}),f.jsxs("div",{className:"flex items-center space-x-2",children:[f.jsx(Pm,{id:"guests",checked:ct.guests,onCheckedChange:At=>pt(qt=>({...qt,guests:!!At}))}),f.jsx("label",{htmlFor:"guests",className:"text-sm",children:"Guests allowed"})]})]}),f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[f.jsxs("div",{children:[f.jsx("label",{htmlFor:"quietHours",className:"text-sm font-medium block mb-1",children:"Quiet Hours"}),f.jsx(Pn,{id:"quietHours",placeholder:"e.g., 10 PM - 8 AM",value:ct.quietHours,onChange:At=>pt(qt=>({...qt,quietHours:At.target.value}))})]}),f.jsxs("div",{children:[f.jsx("label",{htmlFor:"cleaningSchedule",className:"text-sm font-medium block mb-1",children:"Cleaning Schedule"}),f.jsx(Pn,{id:"cleaningSchedule",placeholder:"e.g., Weekly cleaning expected",value:ct.cleaningSchedule,onChange:At=>pt(qt=>({...qt,cleaningSchedule:At.target.value}))})]})]})]})]}),f.jsx(Kt,{type:"submit",className:"w-full bg-swap-blue hover:bg-swap-darkBlue",disabled:jt,children:jt?"Creating Listing...":"Create Detailed Listing"})]})]})}),f.jsx(_i,{})]})},Foe=()=>{const[e,t]=H.useState(""),[i,a]=H.useState(""),[d,y]=H.useState(!1),[S,s]=H.useState(""),[N,D]=H.useState(!1),O=$l(),$=async J=>{if(J.preventDefault(),!e||!e.includes("@")||!e.includes(".")){s("Please enter a valid email address");return}if(!i||i.length<6){s("Password must be at least 6 characters");return}s(""),D(!0);try{if(d){const{error:re}=await Pi.auth.signInWithPassword({email:e,password:i});if(re){s(re.message);return}di.success("Welcome back!"),O("/")}else{const{error:re}=await Pi.auth.signUp({email:e,password:i,options:{emailRedirectTo:`${window.location.origin}/`}});if(re){s(re.message);return}di.success("Account created! Please check your email to verify."),y(!0)}}catch(re){console.error("Auth error:",re),s("An unexpected error occurred. Please try again.")}finally{D(!1)}},q=async()=>{var J;try{const{data:re,error:Q}=await Pi.functions.invoke("create-checkout",{body:{},headers:{Authorization:`Bearer ${(J=(await Pi.auth.getSession()).data.session)==null?void 0:J.access_token}`}});if(Q){console.error("Checkout error:",Q),di.error("Failed to start payment. Please try again.");return}re!=null&&re.url&&window.open(re.url,"_blank")}catch(re){console.error("Error creating checkout:",re),di.error("An error occurred. Please try again.")}};return f.jsxs("div",{className:"min-h-screen flex flex-col bg-gray-50",children:[f.jsx(gi,{}),f.jsx("main",{className:"flex-grow flex items-center justify-center p-4",children:f.jsxs("div",{className:"w-full max-w-4xl",children:[f.jsxs("div",{className:"text-center mb-8",children:[f.jsx("h1",{className:"text-4xl font-bold text-swap-blue mb-4",children:"Join SwapSpot"}),f.jsx("p",{className:"text-xl text-gray-600 mb-2",children:"Connect with verified students across Europe"}),f.jsx(wn,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-200",children:"One-time payment • Lifetime access"})]}),f.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[f.jsxs("div",{className:"space-y-6",children:[f.jsxs(Zr,{className:"border-blue-200 bg-gradient-to-br from-blue-50 to-indigo-50",children:[f.jsxs(zn,{className:"text-center",children:[f.jsx(gc,{className:"h-12 w-12 text-yellow-600 mx-auto mb-2"}),f.jsx(Fn,{className:"text-2xl font-bold text-blue-800",children:"SwapSpot Access"}),f.jsxs("div",{className:"flex items-baseline justify-center gap-1",children:[f.jsx("span",{className:"text-4xl font-bold text-blue-800",children:"€25"}),f.jsx("span",{className:"text-lg text-blue-600",children:"one-time"})]}),f.jsx("p",{className:"text-blue-700",children:"Lifetime access to all features"})]}),f.jsx(Kr,{children:f.jsxs("ul",{className:"space-y-3",children:[f.jsxs("li",{className:"flex items-start gap-3",children:[f.jsx(Co,{className:"h-5 w-5 text-green-600 mt-0.5"}),f.jsxs("div",{children:[f.jsx("span",{className:"font-medium",children:"Unlimited Connections"}),f.jsx("p",{className:"text-sm text-gray-600",children:"Connect with verified students across Europe"})]})]}),f.jsxs("li",{className:"flex items-start gap-3",children:[f.jsx(Co,{className:"h-5 w-5 text-green-600 mt-0.5"}),f.jsxs("div",{children:[f.jsx("span",{className:"font-medium",children:"Email Match Notifications"}),f.jsx("p",{className:"text-sm text-gray-600",children:"Get contact details sent directly to your inbox"})]})]}),f.jsxs("li",{className:"flex items-start gap-3",children:[f.jsx(Co,{className:"h-5 w-5 text-green-600 mt-0.5"}),f.jsxs("div",{children:[f.jsx("span",{className:"font-medium",children:"Full Contact Access"}),f.jsx("p",{className:"text-sm text-gray-600",children:"Instagram, WhatsApp, email, and more"})]})]}),f.jsxs("li",{className:"flex items-start gap-3",children:[f.jsx(Co,{className:"h-5 w-5 text-green-600 mt-0.5"}),f.jsxs("div",{children:[f.jsx("span",{className:"font-medium",children:"Priority Support"}),f.jsx("p",{className:"text-sm text-gray-600",children:"Get help when you need it"})]})]})]})})]}),f.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[f.jsxs("div",{className:"flex flex-col items-center gap-2 p-4 bg-white rounded-lg border",children:[f.jsx(Ao,{className:"h-8 w-8 text-green-600"}),f.jsxs("div",{children:[f.jsx("h4",{className:"font-medium text-sm",children:"Verified Students"}),f.jsx("p",{className:"text-xs text-gray-600",children:"University email verified"})]})]}),f.jsxs("div",{className:"flex flex-col items-center gap-2 p-4 bg-white rounded-lg border",children:[f.jsx(Qo,{className:"h-8 w-8 text-blue-600"}),f.jsxs("div",{children:[f.jsx("h4",{className:"font-medium text-sm",children:"10,000+ Students"}),f.jsx("p",{className:"text-xs text-gray-600",children:"Active across Europe"})]})]}),f.jsxs("div",{className:"flex flex-col items-center gap-2 p-4 bg-white rounded-lg border",children:[f.jsx(Dl,{className:"h-8 w-8 text-yellow-600"}),f.jsxs("div",{children:[f.jsx("h4",{className:"font-medium text-sm",children:"4.8/5 Rating"}),f.jsx("p",{className:"text-xs text-gray-600",children:"Trusted platform"})]})]})]})]}),f.jsxs(Zr,{children:[f.jsxs(zn,{children:[f.jsx(Fn,{className:"text-center",children:d?"Sign In":"Create Account"}),f.jsx("p",{className:"text-center text-gray-600",children:d?"Welcome back to SwapSpot":"Join thousands of verified students"})]}),f.jsxs(Kr,{children:[f.jsxs("form",{onSubmit:$,className:"space-y-4",children:[f.jsxs("div",{className:"space-y-2",children:[f.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email Address"}),f.jsx(Pn,{id:"email",type:"email",placeholder:"your.email@university.edu",value:e,onChange:J=>t(J.target.value),className:"w-full",required:!0,disabled:N})]}),f.jsxs("div",{className:"space-y-2",children:[f.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Password"}),f.jsx(Pn,{id:"password",type:"password",placeholder:"At least 6 characters",value:i,onChange:J=>a(J.target.value),className:"w-full",required:!0,disabled:N,minLength:6})]}),S&&f.jsx(_u,{variant:"destructive",children:f.jsx(yu,{children:S})}),f.jsx(Kt,{type:"submit",className:"w-full",disabled:N,children:N?f.jsxs(f.Fragment,{children:[f.jsx(Bf,{className:"h-4 w-4 mr-2 animate-spin"}),d?"Signing In...":"Creating Account..."]}):f.jsxs(f.Fragment,{children:[f.jsx(Vf,{className:"h-4 w-4 mr-2"}),d?"Sign In":"Create Account"]})})]}),f.jsx("div",{className:"mt-6 text-center",children:f.jsx("button",{type:"button",onClick:()=>y(!d),className:"text-swap-blue hover:underline text-sm",children:d?"Don't have an account? Sign up":"Already have an account? Sign in"})}),d&&f.jsxs("div",{className:"mt-4 pt-4 border-t",children:[f.jsx("p",{className:"text-sm text-gray-600 mb-3 text-center",children:"Ready to get full access?"}),f.jsx(Kt,{onClick:q,className:"w-full bg-green-600 hover:bg-green-700",variant:"default",children:"Get SwapSpot Access - €25"})]})]})]})]}),f.jsx("p",{className:"text-center text-sm text-gray-500 mt-8",children:"Secure payment by Stripe • Cancel anytime • 14-day money-back guarantee"})]})}),f.jsx(_i,{})]})},Boe=()=>f.jsxs("div",{className:"min-h-screen flex flex-col",children:[f.jsx(gi,{}),f.jsxs("main",{className:"flex-grow",children:[f.jsx("section",{className:"bg-swap-blue py-20",children:f.jsxs("div",{className:"max-w-7xl mx-auto px-4 md:px-8 text-center",children:[f.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-white mb-6",children:"Your Safety is Our Priority"}),f.jsx("p",{className:"text-xl text-white/90 max-w-3xl mx-auto",children:"SwapSpot is built on trust and safety. Learn how we keep our community secure."})]})}),f.jsx("section",{className:"py-16 bg-white",children:f.jsxs("div",{className:"max-w-7xl mx-auto px-4 md:px-8",children:[f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-12 mb-16",children:[f.jsxs("div",{children:[f.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[f.jsx("div",{className:"bg-swap-lightBlue p-3 rounded-full",children:f.jsx(Ao,{className:"h-6 w-6 text-swap-blue"})}),f.jsx("h2",{className:"text-2xl font-bold",children:"University Verification"})]}),f.jsx("p",{className:"text-gray-700",children:"Every SwapSpot user must verify their university email address. This ensures that our community consists only of current university students, providing an additional layer of security and trust."})]}),f.jsxs("div",{children:[f.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[f.jsx("div",{className:"bg-swap-lightBlue p-3 rounded-full",children:f.jsx(Qo,{className:"h-6 w-6 text-swap-blue"})}),f.jsx("h2",{className:"text-2xl font-bold",children:"Secure Messaging"})]}),f.jsx("p",{className:"text-gray-700",children:"Our platform includes a secure messaging system that allows users to communicate without sharing personal contact information until they're ready. All conversations are stored for safety and reference."})]})]}),f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-12",children:[f.jsxs("div",{children:[f.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[f.jsx("div",{className:"bg-swap-lightBlue p-3 rounded-full",children:f.jsx(p2,{className:"h-6 w-6 text-swap-blue"})}),f.jsx("h2",{className:"text-2xl font-bold",children:"Swap Agreements"})]}),f.jsx("p",{className:"text-gray-700",children:"Our platform provides customizable swap agreements that outline the terms of the exchange. These digital agreements help prevent misunderstandings and provide a reference point for both parties."})]}),f.jsxs("div",{children:[f.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[f.jsx("div",{className:"bg-swap-lightBlue p-3 rounded-full",children:f.jsx(Km,{className:"h-6 w-6 text-swap-blue"})}),f.jsx("h2",{className:"text-2xl font-bold",children:"24/7 Support"})]}),f.jsx("p",{className:"text-gray-700",children:"Our support team is available to assist with any issues that may arise during your swap. We provide mediation services for conflict resolution and emergency support when needed."})]})]})]})}),f.jsx("section",{className:"py-16 bg-gray-50",children:f.jsxs("div",{className:"max-w-7xl mx-auto px-4 md:px-8",children:[f.jsx("h2",{className:"text-3xl font-bold mb-12 text-center",children:"Safety Tips for Exchange Students"}),f.jsxs("div",{className:"space-y-8",children:[f.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[f.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Before Your Swap"}),f.jsxs("ul",{className:"list-disc pl-6 space-y-2 text-gray-700",children:[f.jsx("li",{children:"Verify your swap partner's university email and student ID"}),f.jsx("li",{children:"Schedule a video call to meet virtually before committing"}),f.jsx("li",{children:"Ask detailed questions about the accommodation and neighborhood"}),f.jsx("li",{children:"Establish clear communication channels"})]})]}),f.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[f.jsx("h3",{className:"text-xl font-semibold mb-3",children:"During Your Exchange"}),f.jsxs("ul",{className:"list-disc pl-6 space-y-2 text-gray-700",children:[f.jsx("li",{children:"Keep emergency contacts saved in your phone"}),f.jsx("li",{children:"Share your location with trusted friends or family"}),f.jsx("li",{children:"Familiarize yourself with local emergency services"}),f.jsx("li",{children:"Keep all important documents secure"})]})]}),f.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[f.jsx("h3",{className:"text-xl font-semibold mb-3",children:"If Something Goes Wrong"}),f.jsxs("ul",{className:"list-disc pl-6 space-y-2 text-gray-700",children:[f.jsx("li",{children:"Contact SwapSpot support immediately"}),f.jsx("li",{children:"Document any issues with photos or written records"}),f.jsx("li",{children:"Reach out to your university's international student office"}),f.jsx("li",{children:"In emergencies, always contact local authorities first"})]})]})]})]})})]}),f.jsx(_i,{})]}),Voe=()=>f.jsxs("div",{className:"min-h-screen flex flex-col",children:[f.jsx(gi,{}),f.jsxs("main",{className:"flex-grow",children:[f.jsx("section",{className:"bg-swap-blue py-20",children:f.jsxs("div",{className:"max-w-7xl mx-auto px-4 md:px-8 text-center",children:[f.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-white mb-6",children:"Frequently Asked Questions"}),f.jsx("p",{className:"text-xl text-white/90 max-w-3xl mx-auto",children:"Find answers to common questions about SwapSpot"})]})}),f.jsx("section",{className:"py-16 bg-white",children:f.jsx("div",{className:"max-w-4xl mx-auto px-4 md:px-8",children:f.jsxs("div",{className:"space-y-8",children:[f.jsxs("div",{children:[f.jsx("h2",{className:"text-2xl font-bold mb-4",children:"General Questions"}),f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[f.jsx("h3",{className:"text-xl font-semibold mb-2",children:"What is SwapSpot?"}),f.jsx("p",{className:"text-gray-700",children:"SwapSpot is a platform that connects university students for accommodation exchanges during study abroad semesters. Instead of paying for expensive housing, students can swap their existing accommodations, making international education more affordable."})]}),f.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[f.jsx("h3",{className:"text-xl font-semibold mb-2",children:"How does SwapSpot verify users?"}),f.jsx("p",{className:"text-gray-700",children:"We verify all users through their university email addresses. This ensures that everyone on our platform is a current student at an accredited university, providing an additional layer of security and trust."})]}),f.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[f.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Is SwapSpot available worldwide?"}),f.jsx("p",{className:"text-gray-700",children:"Yes, SwapSpot is available to university students worldwide. Our platform supports international exchanges between students from different countries and continents."})]})]})]}),f.jsxs("div",{children:[f.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Using SwapSpot"}),f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[f.jsx("h3",{className:"text-xl font-semibold mb-2",children:"How do I find a swap match?"}),f.jsx("p",{className:"text-gray-700",children:"After creating a profile and listing your accommodation, you can browse available listings or use our matching algorithm to find potential swap partners. You can filter by location, dates, and accommodation type to find the perfect match."})]}),f.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[f.jsx("h3",{className:"text-xl font-semibold mb-2",children:"What if I don't find a direct swap match?"}),f.jsx("p",{className:"text-gray-700",children:"SwapSpot allows for both direct swaps and network swaps. This means you can participate in a chain of exchanges if a direct match isn't available for your specific cities and dates."})]}),f.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[f.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Is there a fee to use SwapSpot?"}),f.jsx("p",{className:"text-gray-700",children:"Basic matching and communication features are free. Premium features like verified profile badges, priority matching, and virtual tours will be available with a premium subscription in the future."})]})]})]}),f.jsxs("div",{children:[f.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Safety & Support"}),f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[f.jsx("h3",{className:"text-xl font-semibold mb-2",children:"How are conflicts resolved?"}),f.jsx("p",{className:"text-gray-700",children:"SwapSpot provides a mediation service for any issues that may arise during the swap. We also encourage users to create clear agreements about accommodation rules and expectations before finalizing a swap."})]}),f.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[f.jsx("h3",{className:"text-xl font-semibold mb-2",children:"What happens if my swap partner cancels?"}),f.jsx("p",{className:"text-gray-700",children:"If your swap partner cancels before your exchange begins, our team will prioritize finding you a new match. We also recommend having a backup plan just in case."})]}),f.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[f.jsx("h3",{className:"text-xl font-semibold mb-2",children:"How can I contact support?"}),f.jsx("p",{className:"text-gray-700",children:"You can reach our support team through the contact form on our support page, or by emailing hello@swapspot.com. For urgent matters, premium users have access to expedited support."})]})]})]})]})})})]}),f.jsx(_i,{})]}),Uoe=()=>f.jsxs("div",{className:"min-h-screen flex flex-col",children:[f.jsx(gi,{}),f.jsxs("main",{className:"flex-grow",children:[f.jsx("section",{className:"bg-swap-blue py-16",children:f.jsxs("div",{className:"max-w-7xl mx-auto px-4 md:px-8 text-center",children:[f.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-white mb-4",children:"Terms of Service"}),f.jsx("p",{className:"text-lg text-white/90 max-w-3xl mx-auto",children:"Last Updated: May 7, 2025"})]})}),f.jsx("section",{className:"py-12 bg-white",children:f.jsx("div",{className:"max-w-4xl mx-auto px-4 md:px-8",children:f.jsxs("div",{className:"prose max-w-none",children:[f.jsx("h2",{className:"text-2xl font-bold mb-4",children:"1. Acceptance of Terms"}),f.jsx("p",{className:"mb-4",children:"By accessing or using SwapSpot, you agree to be bound by these Terms of Service. If you do not agree to these terms, please do not use our services."}),f.jsx("h2",{className:"text-2xl font-bold mb-4 mt-8",children:"2. Eligibility"}),f.jsx("p",{className:"mb-4",children:"To use SwapSpot, you must be a current university student with a valid university email address. You must be at least 18 years old or the legal age of majority in your jurisdiction, whichever is greater."}),f.jsx("h2",{className:"text-2xl font-bold mb-4 mt-8",children:"3. User Accounts"}),f.jsx("p",{className:"mb-4",children:"3.1. You are responsible for maintaining the confidentiality of your account credentials and for all activities that occur under your account."}),f.jsx("p",{className:"mb-4",children:"3.2. You must provide accurate and complete information when creating your account and keep this information updated."}),f.jsx("p",{className:"mb-4",children:"3.3. SwapSpot reserves the right to suspend or terminate accounts that contain false or misleading information."}),f.jsx("h2",{className:"text-2xl font-bold mb-4 mt-8",children:"4. Accommodation Listings"}),f.jsx("p",{className:"mb-4",children:"4.1. You may only list accommodations that you have the legal right to offer for exchange."}),f.jsx("p",{className:"mb-4",children:"4.2. All listings must accurately represent the accommodation being offered."}),f.jsx("p",{className:"mb-4",children:"4.3. SwapSpot reserves the right to remove listings that violate our policies or terms."}),f.jsx("h2",{className:"text-2xl font-bold mb-4 mt-8",children:"5. Swap Agreements"}),f.jsx("p",{className:"mb-4",children:"5.1. Swap agreements are contracts between users. SwapSpot provides tools to facilitate these agreements but is not a party to them."}),f.jsx("p",{className:"mb-4",children:"5.2. Users are encouraged to create clear written agreements before finalizing swaps."}),f.jsx("p",{className:"mb-4",children:"5.3. SwapSpot is not liable for any damages resulting from swap agreements between users."}),f.jsx("h2",{className:"text-2xl font-bold mb-4 mt-8",children:"6. Privacy"}),f.jsx("p",{className:"mb-4",children:"Your privacy is important to us. Please review our Privacy Policy to understand how we collect, use, and disclose information."}),f.jsx("h2",{className:"text-2xl font-bold mb-4 mt-8",children:"7. Prohibited Activities"}),f.jsx("p",{className:"mb-4",children:"Users are prohibited from:"}),f.jsxs("ul",{className:"list-disc pl-6 mb-4",children:[f.jsx("li",{className:"mb-2",children:"Using SwapSpot for any illegal purpose"}),f.jsx("li",{className:"mb-2",children:"Providing false or misleading information"}),f.jsx("li",{className:"mb-2",children:"Harassment or abuse of other users"}),f.jsx("li",{className:"mb-2",children:"Using SwapSpot for commercial purposes"}),f.jsx("li",{className:"mb-2",children:"Any activity that disrupts or interferes with our services"})]}),f.jsx("h2",{className:"text-2xl font-bold mb-4 mt-8",children:"8. Modifications to Terms"}),f.jsx("p",{className:"mb-4",children:"SwapSpot reserves the right to modify these Terms of Service at any time. We will notify users of significant changes and continued use of our services after such modifications constitutes acceptance of the updated terms."}),f.jsx("h2",{className:"text-2xl font-bold mb-4 mt-8",children:"9. Limitation of Liability"}),f.jsx("p",{className:"mb-4",children:"To the maximum extent permitted by law, SwapSpot shall not be liable for any indirect, incidental, special, consequential, or punitive damages, including loss of profits, data, or use, arising out of or in connection with these terms or the use of our services."}),f.jsx("h2",{className:"text-2xl font-bold mb-4 mt-8",children:"10. Contact Information"}),f.jsx("p",{className:"mb-4",children:"If you have any questions about these Terms of Service, please contact us at hello@swapspot.com."})]})})})]}),f.jsx(_i,{})]}),$oe=()=>f.jsxs("div",{className:"min-h-screen flex flex-col",children:[f.jsx(gi,{}),f.jsxs("main",{className:"flex-grow",children:[f.jsx("section",{className:"bg-swap-blue py-20",children:f.jsxs("div",{className:"max-w-7xl mx-auto px-4 md:px-8 text-center",children:[f.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-white mb-6",children:"Join Our Team"}),f.jsx("p",{className:"text-xl text-white/90 max-w-3xl mx-auto mb-8",children:"Help us make international education more accessible by creating the perfect platform for student accommodation exchanges."})]})}),f.jsx("section",{className:"py-16 bg-white",children:f.jsx("div",{className:"max-w-7xl mx-auto px-4 md:px-8",children:f.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-12",children:[f.jsxs("div",{className:"w-full md:w-1/2",children:[f.jsx("h2",{className:"text-3xl font-bold mb-6",children:"Our Mission"}),f.jsx("p",{className:"text-lg text-gray-700 mb-4",children:"At SwapSpot, we're building a community that makes international education more accessible by solving one of its biggest challenges: affordable accommodation."}),f.jsx("p",{className:"text-lg text-gray-700",children:"We believe that financial constraints shouldn't prevent students from experiencing the transformative power of studying abroad. By connecting students for accommodation exchanges, we're removing barriers and creating opportunities."})]}),f.jsxs("div",{className:"w-full md:w-1/2 grid grid-cols-2 gap-6",children:[f.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[f.jsx(tv,{className:"h-10 w-10 text-swap-blue mb-4"}),f.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Global Impact"}),f.jsx("p",{className:"text-gray-600",children:"Supporting student mobility and cultural exchange worldwide"})]}),f.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[f.jsx(Rf,{className:"h-10 w-10 text-swap-blue mb-4"}),f.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Community First"}),f.jsx("p",{className:"text-gray-600",children:"Building trusted connections between students globally"})]}),f.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[f.jsx(X4,{className:"h-10 w-10 text-swap-blue mb-4"}),f.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Innovation"}),f.jsx("p",{className:"text-gray-600",children:"Creating elegant solutions to complex problems"})]}),f.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[f.jsx(oW,{className:"h-10 w-10 text-swap-blue mb-4"}),f.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Growth"}),f.jsx("p",{className:"text-gray-600",children:"Expanding opportunities for our team and community"})]})]})]})})}),f.jsx("section",{className:"py-16 bg-gray-50",children:f.jsxs("div",{className:"max-w-7xl mx-auto px-4 md:px-8",children:[f.jsx("h2",{className:"text-3xl font-bold mb-12 text-center",children:"Open Positions"}),f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[f.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-4",children:[f.jsxs("div",{children:[f.jsx("h3",{className:"text-xl font-semibold",children:"Senior Full-Stack Developer"}),f.jsx("p",{className:"text-gray-600",children:"Remote • Full-time"})]}),f.jsx(Kt,{className:"w-full md:w-auto",children:"Apply Now"})]}),f.jsx("p",{className:"text-gray-700",children:"We're looking for an experienced full-stack developer to help build and scale our platform. You'll work with React, Node.js, and PostgreSQL to create beautiful, functional features that help students connect."})]}),f.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[f.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-4",children:[f.jsxs("div",{children:[f.jsx("h3",{className:"text-xl font-semibold",children:"UX/UI Designer"}),f.jsx("p",{className:"text-gray-600",children:"Remote • Full-time"})]}),f.jsx(Kt,{className:"w-full md:w-auto",children:"Apply Now"})]}),f.jsx("p",{className:"text-gray-700",children:"Help us create an intuitive, accessible platform that students love to use. You'll work closely with our product team to research, prototype, and design features that solve real problems for our users."})]}),f.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[f.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-4",children:[f.jsxs("div",{children:[f.jsx("h3",{className:"text-xl font-semibold",children:"University Partnerships Manager"}),f.jsx("p",{className:"text-gray-600",children:"Remote • Full-time"})]}),f.jsx(Kt,{className:"w-full md:w-auto",children:"Apply Now"})]}),f.jsx("p",{className:"text-gray-700",children:"Build relationships with universities worldwide to help promote SwapSpot to their international exchange students. You'll work with international offices to integrate SwapSpot into their study abroad programs."})]}),f.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[f.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-4",children:[f.jsxs("div",{children:[f.jsx("h3",{className:"text-xl font-semibold",children:"Community Manager"}),f.jsx("p",{className:"text-gray-600",children:"Remote • Part-time"})]}),f.jsx(Kt,{className:"w-full md:w-auto",children:"Apply Now"})]}),f.jsx("p",{className:"text-gray-700",children:"Help grow and nurture our community of exchange students. You'll engage with users across social media, moderate discussions, gather feedback, and help create content that resonates with international students."})]})]}),f.jsxs("div",{className:"mt-12 text-center",children:[f.jsx("p",{className:"text-lg mb-6",children:"Don't see a position that matches your skills? We're always looking for talented people to join our team."}),f.jsx(Kt,{size:"lg",variant:"outline",children:"Send Spontaneous Application"})]})]})}),f.jsx("section",{className:"py-16 bg-white",children:f.jsxs("div",{className:"max-w-7xl mx-auto px-4 md:px-8",children:[f.jsx("h2",{className:"text-3xl font-bold mb-12 text-center",children:"Why Join SwapSpot"}),f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[f.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[f.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Flexible Work"}),f.jsx("p",{className:"text-gray-700",children:"Work remotely with flexible hours. We care about results, not when or where you work."})]}),f.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[f.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Meaningful Impact"}),f.jsx("p",{className:"text-gray-700",children:"Help make international education more accessible for students worldwide."})]}),f.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[f.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Growth Opportunities"}),f.jsx("p",{className:"text-gray-700",children:"Join an early-stage startup with room to grow and shape your role."})]}),f.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[f.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Competitive Compensation"}),f.jsx("p",{className:"text-gray-700",children:"Salary, equity, and benefits packages that reward your contributions."})]}),f.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[f.jsx("h3",{className:"text-xl font-semibold mb-4",children:"International Team"}),f.jsx("p",{className:"text-gray-700",children:"Work with colleagues from around the world, bringing diverse perspectives."})]}),f.jsxs("div",{className:"bg-gray-50 p-6 rounded-lg",children:[f.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Learning Budget"}),f.jsx("p",{className:"text-gray-700",children:"Resources for conferences, courses, and tools to help you grow professionally."})]})]})]})})]}),f.jsx(_i,{})]});var Yn;(function(e){e.assertEqual=d=>d;function t(d){}e.assertIs=t;function i(d){throw new Error}e.assertNever=i,e.arrayToEnum=d=>{const y={};for(const S of d)y[S]=S;return y},e.getValidEnumValues=d=>{const y=e.objectKeys(d).filter(s=>typeof d[d[s]]!="number"),S={};for(const s of y)S[s]=d[s];return e.objectValues(S)},e.objectValues=d=>e.objectKeys(d).map(function(y){return d[y]}),e.objectKeys=typeof Object.keys=="function"?d=>Object.keys(d):d=>{const y=[];for(const S in d)Object.prototype.hasOwnProperty.call(d,S)&&y.push(S);return y},e.find=(d,y)=>{for(const S of d)if(y(S))return S},e.isInteger=typeof Number.isInteger=="function"?d=>Number.isInteger(d):d=>typeof d=="number"&&isFinite(d)&&Math.floor(d)===d;function a(d,y=" | "){return d.map(S=>typeof S=="string"?`'${S}'`:S).join(y)}e.joinValues=a,e.jsonStringifyReplacer=(d,y)=>typeof y=="bigint"?y.toString():y})(Yn||(Yn={}));var UM;(function(e){e.mergeShapes=(t,i)=>({...t,...i})})(UM||(UM={}));const Pr=Yn.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Rd=e=>{switch(typeof e){case"undefined":return Pr.undefined;case"string":return Pr.string;case"number":return isNaN(e)?Pr.nan:Pr.number;case"boolean":return Pr.boolean;case"function":return Pr.function;case"bigint":return Pr.bigint;case"symbol":return Pr.symbol;case"object":return Array.isArray(e)?Pr.array:e===null?Pr.null:e.then&&typeof e.then=="function"&&e.catch&&typeof e.catch=="function"?Pr.promise:typeof Map<"u"&&e instanceof Map?Pr.map:typeof Set<"u"&&e instanceof Set?Pr.set:typeof Date<"u"&&e instanceof Date?Pr.date:Pr.object;default:return Pr.unknown}},sr=Yn.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Goe=e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:");class Sa extends Error{constructor(t){super(),this.issues=[],this.addIssue=a=>{this.issues=[...this.issues,a]},this.addIssues=(a=[])=>{this.issues=[...this.issues,...a]};const i=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,i):this.__proto__=i,this.name="ZodError",this.issues=t}get errors(){return this.issues}format(t){const i=t||function(y){return y.message},a={_errors:[]},d=y=>{for(const S of y.issues)if(S.code==="invalid_union")S.unionErrors.map(d);else if(S.code==="invalid_return_type")d(S.returnTypeError);else if(S.code==="invalid_arguments")d(S.argumentsError);else if(S.path.length===0)a._errors.push(i(S));else{let s=a,N=0;for(;N<S.path.length;){const D=S.path[N];N===S.path.length-1?(s[D]=s[D]||{_errors:[]},s[D]._errors.push(i(S))):s[D]=s[D]||{_errors:[]},s=s[D],N++}}};return d(this),a}static assert(t){if(!(t instanceof Sa))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Yn.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=i=>i.message){const i={},a=[];for(const d of this.issues)d.path.length>0?(i[d.path[0]]=i[d.path[0]]||[],i[d.path[0]].push(t(d))):a.push(t(d));return{formErrors:a,fieldErrors:i}}get formErrors(){return this.flatten()}}Sa.create=e=>new Sa(e);const Ag=(e,t)=>{let i;switch(e.code){case sr.invalid_type:e.received===Pr.undefined?i="Required":i=`Expected ${e.expected}, received ${e.received}`;break;case sr.invalid_literal:i=`Invalid literal value, expected ${JSON.stringify(e.expected,Yn.jsonStringifyReplacer)}`;break;case sr.unrecognized_keys:i=`Unrecognized key(s) in object: ${Yn.joinValues(e.keys,", ")}`;break;case sr.invalid_union:i="Invalid input";break;case sr.invalid_union_discriminator:i=`Invalid discriminator value. Expected ${Yn.joinValues(e.options)}`;break;case sr.invalid_enum_value:i=`Invalid enum value. Expected ${Yn.joinValues(e.options)}, received '${e.received}'`;break;case sr.invalid_arguments:i="Invalid function arguments";break;case sr.invalid_return_type:i="Invalid function return type";break;case sr.invalid_date:i="Invalid date";break;case sr.invalid_string:typeof e.validation=="object"?"includes"in e.validation?(i=`Invalid input: must include "${e.validation.includes}"`,typeof e.validation.position=="number"&&(i=`${i} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?i=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?i=`Invalid input: must end with "${e.validation.endsWith}"`:Yn.assertNever(e.validation):e.validation!=="regex"?i=`Invalid ${e.validation}`:i="Invalid";break;case sr.too_small:e.type==="array"?i=`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:e.type==="string"?i=`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:e.type==="number"?i=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="date"?i=`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:i="Invalid input";break;case sr.too_big:e.type==="array"?i=`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:e.type==="string"?i=`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:e.type==="number"?i=`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="bigint"?i=`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="date"?i=`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:i="Invalid input";break;case sr.custom:i="Invalid input";break;case sr.invalid_intersection_types:i="Intersection results could not be merged";break;case sr.not_multiple_of:i=`Number must be a multiple of ${e.multipleOf}`;break;case sr.not_finite:i="Number must be finite";break;default:i=t.defaultError,Yn.assertNever(e)}return{message:i}};let cV=Ag;function qoe(e){cV=e}function Lw(){return cV}const Ow=e=>{const{data:t,path:i,errorMaps:a,issueData:d}=e,y=[...i,...d.path||[]],S={...d,path:y};if(d.message!==void 0)return{...d,path:y,message:d.message};let s="";const N=a.filter(D=>!!D).slice().reverse();for(const D of N)s=D(S,{data:t,defaultError:s}).message;return{...d,path:y,message:s}},Hoe=[];function Er(e,t){const i=Lw(),a=Ow({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,i,i===Ag?void 0:Ag].filter(d=>!!d)});e.common.issues.push(a)}class lo{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,i){const a=[];for(const d of i){if(d.status==="aborted")return cn;d.status==="dirty"&&t.dirty(),a.push(d.value)}return{status:t.value,value:a}}static async mergeObjectAsync(t,i){const a=[];for(const d of i){const y=await d.key,S=await d.value;a.push({key:y,value:S})}return lo.mergeObjectSync(t,a)}static mergeObjectSync(t,i){const a={};for(const d of i){const{key:y,value:S}=d;if(y.status==="aborted"||S.status==="aborted")return cn;y.status==="dirty"&&t.dirty(),S.status==="dirty"&&t.dirty(),y.value!=="__proto__"&&(typeof S.value<"u"||d.alwaysSet)&&(a[y.value]=S.value)}return{status:t.value,value:a}}}const cn=Object.freeze({status:"aborted"}),$m=e=>({status:"dirty",value:e}),Po=e=>({status:"valid",value:e}),$M=e=>e.status==="aborted",GM=e=>e.status==="dirty",pv=e=>e.status==="valid",mv=e=>typeof Promise<"u"&&e instanceof Promise;function zw(e,t,i,a){if(typeof t=="function"?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t.get(e)}function uV(e,t,i,a,d){if(typeof t=="function"?e!==t||!d:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t.set(e,i),i}var $r;(function(e){e.errToObj=t=>typeof t=="string"?{message:t}:t||{},e.toString=t=>typeof t=="string"?t:t==null?void 0:t.message})($r||($r={}));var px,mx;class Ac{constructor(t,i,a,d){this._cachedPath=[],this.parent=t,this.data=i,this._path=a,this._key=d}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const LD=(e,t)=>{if(pv(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const i=new Sa(e.common.issues);return this._error=i,this._error}}};function Sn(e){if(!e)return{};const{errorMap:t,invalid_type_error:i,required_error:a,description:d}=e;if(t&&(i||a))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:d}:{errorMap:(S,s)=>{var N,D;const{message:O}=e;return S.code==="invalid_enum_value"?{message:O??s.defaultError}:typeof s.data>"u"?{message:(N=O??a)!==null&&N!==void 0?N:s.defaultError}:S.code!=="invalid_type"?{message:s.defaultError}:{message:(D=O??i)!==null&&D!==void 0?D:s.defaultError}},description:d}}class In{constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(t){return Rd(t.data)}_getOrReturnCtx(t,i){return i||{common:t.parent.common,data:t.data,parsedType:Rd(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new lo,ctx:{common:t.parent.common,data:t.data,parsedType:Rd(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){const i=this._parse(t);if(mv(i))throw new Error("Synchronous parse encountered promise.");return i}_parseAsync(t){const i=this._parse(t);return Promise.resolve(i)}parse(t,i){const a=this.safeParse(t,i);if(a.success)return a.data;throw a.error}safeParse(t,i){var a;const d={common:{issues:[],async:(a=i==null?void 0:i.async)!==null&&a!==void 0?a:!1,contextualErrorMap:i==null?void 0:i.errorMap},path:(i==null?void 0:i.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Rd(t)},y=this._parseSync({data:t,path:d.path,parent:d});return LD(d,y)}async parseAsync(t,i){const a=await this.safeParseAsync(t,i);if(a.success)return a.data;throw a.error}async safeParseAsync(t,i){const a={common:{issues:[],contextualErrorMap:i==null?void 0:i.errorMap,async:!0},path:(i==null?void 0:i.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Rd(t)},d=this._parse({data:t,path:a.path,parent:a}),y=await(mv(d)?d:Promise.resolve(d));return LD(a,y)}refine(t,i){const a=d=>typeof i=="string"||typeof i>"u"?{message:i}:typeof i=="function"?i(d):i;return this._refinement((d,y)=>{const S=t(d),s=()=>y.addIssue({code:sr.custom,...a(d)});return typeof Promise<"u"&&S instanceof Promise?S.then(N=>N?!0:(s(),!1)):S?!0:(s(),!1)})}refinement(t,i){return this._refinement((a,d)=>t(a)?!0:(d.addIssue(typeof i=="function"?i(a,d):i),!1))}_refinement(t){return new Ul({schema:this,typeName:tn.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}optional(){return Sc.create(this,this._def)}nullable(){return dh.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Ll.create(this,this._def)}promise(){return Ig.create(this,this._def)}or(t){return xv.create([this,t],this._def)}and(t){return vv.create(this,t,this._def)}transform(t){return new Ul({...Sn(this._def),schema:this,typeName:tn.ZodEffects,effect:{type:"transform",transform:t}})}default(t){const i=typeof t=="function"?t:()=>t;return new Ev({...Sn(this._def),innerType:this,defaultValue:i,typeName:tn.ZodDefault})}brand(){return new sI({typeName:tn.ZodBranded,type:this,...Sn(this._def)})}catch(t){const i=typeof t=="function"?t:()=>t;return new Cv({...Sn(this._def),innerType:this,catchValue:i,typeName:tn.ZodCatch})}describe(t){const i=this.constructor;return new i({...this._def,description:t})}pipe(t){return r0.create(this,t)}readonly(){return Mv.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Woe=/^c[^\s-]{8,}$/i,Zoe=/^[0-9a-z]+$/,Yoe=/^[0-9A-HJKMNP-TV-Z]{26}$/,Xoe=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Koe=/^[a-z0-9_-]{21}$/i,Joe=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Qoe=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,eae="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let iC;const tae=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,rae=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,nae=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,dV="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",iae=new RegExp(`^${dV}$`);function hV(e){let t="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return e.precision?t=`${t}\\.\\d{${e.precision}}`:e.precision==null&&(t=`${t}(\\.\\d+)?`),t}function sae(e){return new RegExp(`^${hV(e)}$`)}function fV(e){let t=`${dV}T${hV(e)}`;const i=[];return i.push(e.local?"Z?":"Z"),e.offset&&i.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${i.join("|")})`,new RegExp(`^${t}$`)}function oae(e,t){return!!((t==="v4"||!t)&&tae.test(e)||(t==="v6"||!t)&&rae.test(e))}class Nl extends In{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==Pr.string){const y=this._getOrReturnCtx(t);return Er(y,{code:sr.invalid_type,expected:Pr.string,received:y.parsedType}),cn}const a=new lo;let d;for(const y of this._def.checks)if(y.kind==="min")t.data.length<y.value&&(d=this._getOrReturnCtx(t,d),Er(d,{code:sr.too_small,minimum:y.value,type:"string",inclusive:!0,exact:!1,message:y.message}),a.dirty());else if(y.kind==="max")t.data.length>y.value&&(d=this._getOrReturnCtx(t,d),Er(d,{code:sr.too_big,maximum:y.value,type:"string",inclusive:!0,exact:!1,message:y.message}),a.dirty());else if(y.kind==="length"){const S=t.data.length>y.value,s=t.data.length<y.value;(S||s)&&(d=this._getOrReturnCtx(t,d),S?Er(d,{code:sr.too_big,maximum:y.value,type:"string",inclusive:!0,exact:!0,message:y.message}):s&&Er(d,{code:sr.too_small,minimum:y.value,type:"string",inclusive:!0,exact:!0,message:y.message}),a.dirty())}else if(y.kind==="email")Qoe.test(t.data)||(d=this._getOrReturnCtx(t,d),Er(d,{validation:"email",code:sr.invalid_string,message:y.message}),a.dirty());else if(y.kind==="emoji")iC||(iC=new RegExp(eae,"u")),iC.test(t.data)||(d=this._getOrReturnCtx(t,d),Er(d,{validation:"emoji",code:sr.invalid_string,message:y.message}),a.dirty());else if(y.kind==="uuid")Xoe.test(t.data)||(d=this._getOrReturnCtx(t,d),Er(d,{validation:"uuid",code:sr.invalid_string,message:y.message}),a.dirty());else if(y.kind==="nanoid")Koe.test(t.data)||(d=this._getOrReturnCtx(t,d),Er(d,{validation:"nanoid",code:sr.invalid_string,message:y.message}),a.dirty());else if(y.kind==="cuid")Woe.test(t.data)||(d=this._getOrReturnCtx(t,d),Er(d,{validation:"cuid",code:sr.invalid_string,message:y.message}),a.dirty());else if(y.kind==="cuid2")Zoe.test(t.data)||(d=this._getOrReturnCtx(t,d),Er(d,{validation:"cuid2",code:sr.invalid_string,message:y.message}),a.dirty());else if(y.kind==="ulid")Yoe.test(t.data)||(d=this._getOrReturnCtx(t,d),Er(d,{validation:"ulid",code:sr.invalid_string,message:y.message}),a.dirty());else if(y.kind==="url")try{new URL(t.data)}catch{d=this._getOrReturnCtx(t,d),Er(d,{validation:"url",code:sr.invalid_string,message:y.message}),a.dirty()}else y.kind==="regex"?(y.regex.lastIndex=0,y.regex.test(t.data)||(d=this._getOrReturnCtx(t,d),Er(d,{validation:"regex",code:sr.invalid_string,message:y.message}),a.dirty())):y.kind==="trim"?t.data=t.data.trim():y.kind==="includes"?t.data.includes(y.value,y.position)||(d=this._getOrReturnCtx(t,d),Er(d,{code:sr.invalid_string,validation:{includes:y.value,position:y.position},message:y.message}),a.dirty()):y.kind==="toLowerCase"?t.data=t.data.toLowerCase():y.kind==="toUpperCase"?t.data=t.data.toUpperCase():y.kind==="startsWith"?t.data.startsWith(y.value)||(d=this._getOrReturnCtx(t,d),Er(d,{code:sr.invalid_string,validation:{startsWith:y.value},message:y.message}),a.dirty()):y.kind==="endsWith"?t.data.endsWith(y.value)||(d=this._getOrReturnCtx(t,d),Er(d,{code:sr.invalid_string,validation:{endsWith:y.value},message:y.message}),a.dirty()):y.kind==="datetime"?fV(y).test(t.data)||(d=this._getOrReturnCtx(t,d),Er(d,{code:sr.invalid_string,validation:"datetime",message:y.message}),a.dirty()):y.kind==="date"?iae.test(t.data)||(d=this._getOrReturnCtx(t,d),Er(d,{code:sr.invalid_string,validation:"date",message:y.message}),a.dirty()):y.kind==="time"?sae(y).test(t.data)||(d=this._getOrReturnCtx(t,d),Er(d,{code:sr.invalid_string,validation:"time",message:y.message}),a.dirty()):y.kind==="duration"?Joe.test(t.data)||(d=this._getOrReturnCtx(t,d),Er(d,{validation:"duration",code:sr.invalid_string,message:y.message}),a.dirty()):y.kind==="ip"?oae(t.data,y.version)||(d=this._getOrReturnCtx(t,d),Er(d,{validation:"ip",code:sr.invalid_string,message:y.message}),a.dirty()):y.kind==="base64"?nae.test(t.data)||(d=this._getOrReturnCtx(t,d),Er(d,{validation:"base64",code:sr.invalid_string,message:y.message}),a.dirty()):Yn.assertNever(y);return{status:a.value,value:t.data}}_regex(t,i,a){return this.refinement(d=>t.test(d),{validation:i,code:sr.invalid_string,...$r.errToObj(a)})}_addCheck(t){return new Nl({...this._def,checks:[...this._def.checks,t]})}email(t){return this._addCheck({kind:"email",...$r.errToObj(t)})}url(t){return this._addCheck({kind:"url",...$r.errToObj(t)})}emoji(t){return this._addCheck({kind:"emoji",...$r.errToObj(t)})}uuid(t){return this._addCheck({kind:"uuid",...$r.errToObj(t)})}nanoid(t){return this._addCheck({kind:"nanoid",...$r.errToObj(t)})}cuid(t){return this._addCheck({kind:"cuid",...$r.errToObj(t)})}cuid2(t){return this._addCheck({kind:"cuid2",...$r.errToObj(t)})}ulid(t){return this._addCheck({kind:"ulid",...$r.errToObj(t)})}base64(t){return this._addCheck({kind:"base64",...$r.errToObj(t)})}ip(t){return this._addCheck({kind:"ip",...$r.errToObj(t)})}datetime(t){var i,a;return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck({kind:"datetime",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,offset:(i=t==null?void 0:t.offset)!==null&&i!==void 0?i:!1,local:(a=t==null?void 0:t.local)!==null&&a!==void 0?a:!1,...$r.errToObj(t==null?void 0:t.message)})}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck({kind:"time",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,...$r.errToObj(t==null?void 0:t.message)})}duration(t){return this._addCheck({kind:"duration",...$r.errToObj(t)})}regex(t,i){return this._addCheck({kind:"regex",regex:t,...$r.errToObj(i)})}includes(t,i){return this._addCheck({kind:"includes",value:t,position:i==null?void 0:i.position,...$r.errToObj(i==null?void 0:i.message)})}startsWith(t,i){return this._addCheck({kind:"startsWith",value:t,...$r.errToObj(i)})}endsWith(t,i){return this._addCheck({kind:"endsWith",value:t,...$r.errToObj(i)})}min(t,i){return this._addCheck({kind:"min",value:t,...$r.errToObj(i)})}max(t,i){return this._addCheck({kind:"max",value:t,...$r.errToObj(i)})}length(t,i){return this._addCheck({kind:"length",value:t,...$r.errToObj(i)})}nonempty(t){return this.min(1,$r.errToObj(t))}trim(){return new Nl({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Nl({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Nl({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get minLength(){let t=null;for(const i of this._def.checks)i.kind==="min"&&(t===null||i.value>t)&&(t=i.value);return t}get maxLength(){let t=null;for(const i of this._def.checks)i.kind==="max"&&(t===null||i.value<t)&&(t=i.value);return t}}Nl.create=e=>{var t;return new Nl({checks:[],typeName:tn.ZodString,coerce:(t=e==null?void 0:e.coerce)!==null&&t!==void 0?t:!1,...Sn(e)})};function aae(e,t){const i=(e.toString().split(".")[1]||"").length,a=(t.toString().split(".")[1]||"").length,d=i>a?i:a,y=parseInt(e.toFixed(d).replace(".","")),S=parseInt(t.toFixed(d).replace(".",""));return y%S/Math.pow(10,d)}class lh extends In{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==Pr.number){const y=this._getOrReturnCtx(t);return Er(y,{code:sr.invalid_type,expected:Pr.number,received:y.parsedType}),cn}let a;const d=new lo;for(const y of this._def.checks)y.kind==="int"?Yn.isInteger(t.data)||(a=this._getOrReturnCtx(t,a),Er(a,{code:sr.invalid_type,expected:"integer",received:"float",message:y.message}),d.dirty()):y.kind==="min"?(y.inclusive?t.data<y.value:t.data<=y.value)&&(a=this._getOrReturnCtx(t,a),Er(a,{code:sr.too_small,minimum:y.value,type:"number",inclusive:y.inclusive,exact:!1,message:y.message}),d.dirty()):y.kind==="max"?(y.inclusive?t.data>y.value:t.data>=y.value)&&(a=this._getOrReturnCtx(t,a),Er(a,{code:sr.too_big,maximum:y.value,type:"number",inclusive:y.inclusive,exact:!1,message:y.message}),d.dirty()):y.kind==="multipleOf"?aae(t.data,y.value)!==0&&(a=this._getOrReturnCtx(t,a),Er(a,{code:sr.not_multiple_of,multipleOf:y.value,message:y.message}),d.dirty()):y.kind==="finite"?Number.isFinite(t.data)||(a=this._getOrReturnCtx(t,a),Er(a,{code:sr.not_finite,message:y.message}),d.dirty()):Yn.assertNever(y);return{status:d.value,value:t.data}}gte(t,i){return this.setLimit("min",t,!0,$r.toString(i))}gt(t,i){return this.setLimit("min",t,!1,$r.toString(i))}lte(t,i){return this.setLimit("max",t,!0,$r.toString(i))}lt(t,i){return this.setLimit("max",t,!1,$r.toString(i))}setLimit(t,i,a,d){return new lh({...this._def,checks:[...this._def.checks,{kind:t,value:i,inclusive:a,message:$r.toString(d)}]})}_addCheck(t){return new lh({...this._def,checks:[...this._def.checks,t]})}int(t){return this._addCheck({kind:"int",message:$r.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:$r.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:$r.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:$r.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:$r.toString(t)})}multipleOf(t,i){return this._addCheck({kind:"multipleOf",value:t,message:$r.toString(i)})}finite(t){return this._addCheck({kind:"finite",message:$r.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:$r.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:$r.toString(t)})}get minValue(){let t=null;for(const i of this._def.checks)i.kind==="min"&&(t===null||i.value>t)&&(t=i.value);return t}get maxValue(){let t=null;for(const i of this._def.checks)i.kind==="max"&&(t===null||i.value<t)&&(t=i.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&Yn.isInteger(t.value))}get isFinite(){let t=null,i=null;for(const a of this._def.checks){if(a.kind==="finite"||a.kind==="int"||a.kind==="multipleOf")return!0;a.kind==="min"?(i===null||a.value>i)&&(i=a.value):a.kind==="max"&&(t===null||a.value<t)&&(t=a.value)}return Number.isFinite(i)&&Number.isFinite(t)}}lh.create=e=>new lh({checks:[],typeName:tn.ZodNumber,coerce:(e==null?void 0:e.coerce)||!1,...Sn(e)});class ch extends In{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce&&(t.data=BigInt(t.data)),this._getType(t)!==Pr.bigint){const y=this._getOrReturnCtx(t);return Er(y,{code:sr.invalid_type,expected:Pr.bigint,received:y.parsedType}),cn}let a;const d=new lo;for(const y of this._def.checks)y.kind==="min"?(y.inclusive?t.data<y.value:t.data<=y.value)&&(a=this._getOrReturnCtx(t,a),Er(a,{code:sr.too_small,type:"bigint",minimum:y.value,inclusive:y.inclusive,message:y.message}),d.dirty()):y.kind==="max"?(y.inclusive?t.data>y.value:t.data>=y.value)&&(a=this._getOrReturnCtx(t,a),Er(a,{code:sr.too_big,type:"bigint",maximum:y.value,inclusive:y.inclusive,message:y.message}),d.dirty()):y.kind==="multipleOf"?t.data%y.value!==BigInt(0)&&(a=this._getOrReturnCtx(t,a),Er(a,{code:sr.not_multiple_of,multipleOf:y.value,message:y.message}),d.dirty()):Yn.assertNever(y);return{status:d.value,value:t.data}}gte(t,i){return this.setLimit("min",t,!0,$r.toString(i))}gt(t,i){return this.setLimit("min",t,!1,$r.toString(i))}lte(t,i){return this.setLimit("max",t,!0,$r.toString(i))}lt(t,i){return this.setLimit("max",t,!1,$r.toString(i))}setLimit(t,i,a,d){return new ch({...this._def,checks:[...this._def.checks,{kind:t,value:i,inclusive:a,message:$r.toString(d)}]})}_addCheck(t){return new ch({...this._def,checks:[...this._def.checks,t]})}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:$r.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:$r.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:$r.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:$r.toString(t)})}multipleOf(t,i){return this._addCheck({kind:"multipleOf",value:t,message:$r.toString(i)})}get minValue(){let t=null;for(const i of this._def.checks)i.kind==="min"&&(t===null||i.value>t)&&(t=i.value);return t}get maxValue(){let t=null;for(const i of this._def.checks)i.kind==="max"&&(t===null||i.value<t)&&(t=i.value);return t}}ch.create=e=>{var t;return new ch({checks:[],typeName:tn.ZodBigInt,coerce:(t=e==null?void 0:e.coerce)!==null&&t!==void 0?t:!1,...Sn(e)})};class gv extends In{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==Pr.boolean){const a=this._getOrReturnCtx(t);return Er(a,{code:sr.invalid_type,expected:Pr.boolean,received:a.parsedType}),cn}return Po(t.data)}}gv.create=e=>new gv({typeName:tn.ZodBoolean,coerce:(e==null?void 0:e.coerce)||!1,...Sn(e)});class Hf extends In{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==Pr.date){const y=this._getOrReturnCtx(t);return Er(y,{code:sr.invalid_type,expected:Pr.date,received:y.parsedType}),cn}if(isNaN(t.data.getTime())){const y=this._getOrReturnCtx(t);return Er(y,{code:sr.invalid_date}),cn}const a=new lo;let d;for(const y of this._def.checks)y.kind==="min"?t.data.getTime()<y.value&&(d=this._getOrReturnCtx(t,d),Er(d,{code:sr.too_small,message:y.message,inclusive:!0,exact:!1,minimum:y.value,type:"date"}),a.dirty()):y.kind==="max"?t.data.getTime()>y.value&&(d=this._getOrReturnCtx(t,d),Er(d,{code:sr.too_big,message:y.message,inclusive:!0,exact:!1,maximum:y.value,type:"date"}),a.dirty()):Yn.assertNever(y);return{status:a.value,value:new Date(t.data.getTime())}}_addCheck(t){return new Hf({...this._def,checks:[...this._def.checks,t]})}min(t,i){return this._addCheck({kind:"min",value:t.getTime(),message:$r.toString(i)})}max(t,i){return this._addCheck({kind:"max",value:t.getTime(),message:$r.toString(i)})}get minDate(){let t=null;for(const i of this._def.checks)i.kind==="min"&&(t===null||i.value>t)&&(t=i.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(const i of this._def.checks)i.kind==="max"&&(t===null||i.value<t)&&(t=i.value);return t!=null?new Date(t):null}}Hf.create=e=>new Hf({checks:[],coerce:(e==null?void 0:e.coerce)||!1,typeName:tn.ZodDate,...Sn(e)});class Fw extends In{_parse(t){if(this._getType(t)!==Pr.symbol){const a=this._getOrReturnCtx(t);return Er(a,{code:sr.invalid_type,expected:Pr.symbol,received:a.parsedType}),cn}return Po(t.data)}}Fw.create=e=>new Fw({typeName:tn.ZodSymbol,...Sn(e)});class _v extends In{_parse(t){if(this._getType(t)!==Pr.undefined){const a=this._getOrReturnCtx(t);return Er(a,{code:sr.invalid_type,expected:Pr.undefined,received:a.parsedType}),cn}return Po(t.data)}}_v.create=e=>new _v({typeName:tn.ZodUndefined,...Sn(e)});class yv extends In{_parse(t){if(this._getType(t)!==Pr.null){const a=this._getOrReturnCtx(t);return Er(a,{code:sr.invalid_type,expected:Pr.null,received:a.parsedType}),cn}return Po(t.data)}}yv.create=e=>new yv({typeName:tn.ZodNull,...Sn(e)});class Pg extends In{constructor(){super(...arguments),this._any=!0}_parse(t){return Po(t.data)}}Pg.create=e=>new Pg({typeName:tn.ZodAny,...Sn(e)});class jf extends In{constructor(){super(...arguments),this._unknown=!0}_parse(t){return Po(t.data)}}jf.create=e=>new jf({typeName:tn.ZodUnknown,...Sn(e)});class xu extends In{_parse(t){const i=this._getOrReturnCtx(t);return Er(i,{code:sr.invalid_type,expected:Pr.never,received:i.parsedType}),cn}}xu.create=e=>new xu({typeName:tn.ZodNever,...Sn(e)});class Bw extends In{_parse(t){if(this._getType(t)!==Pr.undefined){const a=this._getOrReturnCtx(t);return Er(a,{code:sr.invalid_type,expected:Pr.void,received:a.parsedType}),cn}return Po(t.data)}}Bw.create=e=>new Bw({typeName:tn.ZodVoid,...Sn(e)});class Ll extends In{_parse(t){const{ctx:i,status:a}=this._processInputParams(t),d=this._def;if(i.parsedType!==Pr.array)return Er(i,{code:sr.invalid_type,expected:Pr.array,received:i.parsedType}),cn;if(d.exactLength!==null){const S=i.data.length>d.exactLength.value,s=i.data.length<d.exactLength.value;(S||s)&&(Er(i,{code:S?sr.too_big:sr.too_small,minimum:s?d.exactLength.value:void 0,maximum:S?d.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:d.exactLength.message}),a.dirty())}if(d.minLength!==null&&i.data.length<d.minLength.value&&(Er(i,{code:sr.too_small,minimum:d.minLength.value,type:"array",inclusive:!0,exact:!1,message:d.minLength.message}),a.dirty()),d.maxLength!==null&&i.data.length>d.maxLength.value&&(Er(i,{code:sr.too_big,maximum:d.maxLength.value,type:"array",inclusive:!0,exact:!1,message:d.maxLength.message}),a.dirty()),i.common.async)return Promise.all([...i.data].map((S,s)=>d.type._parseAsync(new Ac(i,S,i.path,s)))).then(S=>lo.mergeArray(a,S));const y=[...i.data].map((S,s)=>d.type._parseSync(new Ac(i,S,i.path,s)));return lo.mergeArray(a,y)}get element(){return this._def.type}min(t,i){return new Ll({...this._def,minLength:{value:t,message:$r.toString(i)}})}max(t,i){return new Ll({...this._def,maxLength:{value:t,message:$r.toString(i)}})}length(t,i){return new Ll({...this._def,exactLength:{value:t,message:$r.toString(i)}})}nonempty(t){return this.min(1,t)}}Ll.create=(e,t)=>new Ll({type:e,minLength:null,maxLength:null,exactLength:null,typeName:tn.ZodArray,...Sn(t)});function Im(e){if(e instanceof qi){const t={};for(const i in e.shape){const a=e.shape[i];t[i]=Sc.create(Im(a))}return new qi({...e._def,shape:()=>t})}else return e instanceof Ll?new Ll({...e._def,type:Im(e.element)}):e instanceof Sc?Sc.create(Im(e.unwrap())):e instanceof dh?dh.create(Im(e.unwrap())):e instanceof Pc?Pc.create(e.items.map(t=>Im(t))):e}class qi extends In{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const t=this._def.shape(),i=Yn.objectKeys(t);return this._cached={shape:t,keys:i}}_parse(t){if(this._getType(t)!==Pr.object){const D=this._getOrReturnCtx(t);return Er(D,{code:sr.invalid_type,expected:Pr.object,received:D.parsedType}),cn}const{status:a,ctx:d}=this._processInputParams(t),{shape:y,keys:S}=this._getCached(),s=[];if(!(this._def.catchall instanceof xu&&this._def.unknownKeys==="strip"))for(const D in d.data)S.includes(D)||s.push(D);const N=[];for(const D of S){const O=y[D],$=d.data[D];N.push({key:{status:"valid",value:D},value:O._parse(new Ac(d,$,d.path,D)),alwaysSet:D in d.data})}if(this._def.catchall instanceof xu){const D=this._def.unknownKeys;if(D==="passthrough")for(const O of s)N.push({key:{status:"valid",value:O},value:{status:"valid",value:d.data[O]}});else if(D==="strict")s.length>0&&(Er(d,{code:sr.unrecognized_keys,keys:s}),a.dirty());else if(D!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const D=this._def.catchall;for(const O of s){const $=d.data[O];N.push({key:{status:"valid",value:O},value:D._parse(new Ac(d,$,d.path,O)),alwaysSet:O in d.data})}}return d.common.async?Promise.resolve().then(async()=>{const D=[];for(const O of N){const $=await O.key,q=await O.value;D.push({key:$,value:q,alwaysSet:O.alwaysSet})}return D}).then(D=>lo.mergeObjectSync(a,D)):lo.mergeObjectSync(a,N)}get shape(){return this._def.shape()}strict(t){return $r.errToObj,new qi({...this._def,unknownKeys:"strict",...t!==void 0?{errorMap:(i,a)=>{var d,y,S,s;const N=(S=(y=(d=this._def).errorMap)===null||y===void 0?void 0:y.call(d,i,a).message)!==null&&S!==void 0?S:a.defaultError;return i.code==="unrecognized_keys"?{message:(s=$r.errToObj(t).message)!==null&&s!==void 0?s:N}:{message:N}}}:{}})}strip(){return new qi({...this._def,unknownKeys:"strip"})}passthrough(){return new qi({...this._def,unknownKeys:"passthrough"})}extend(t){return new qi({...this._def,shape:()=>({...this._def.shape(),...t})})}merge(t){return new qi({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>({...this._def.shape(),...t._def.shape()}),typeName:tn.ZodObject})}setKey(t,i){return this.augment({[t]:i})}catchall(t){return new qi({...this._def,catchall:t})}pick(t){const i={};return Yn.objectKeys(t).forEach(a=>{t[a]&&this.shape[a]&&(i[a]=this.shape[a])}),new qi({...this._def,shape:()=>i})}omit(t){const i={};return Yn.objectKeys(this.shape).forEach(a=>{t[a]||(i[a]=this.shape[a])}),new qi({...this._def,shape:()=>i})}deepPartial(){return Im(this)}partial(t){const i={};return Yn.objectKeys(this.shape).forEach(a=>{const d=this.shape[a];t&&!t[a]?i[a]=d:i[a]=d.optional()}),new qi({...this._def,shape:()=>i})}required(t){const i={};return Yn.objectKeys(this.shape).forEach(a=>{if(t&&!t[a])i[a]=this.shape[a];else{let y=this.shape[a];for(;y instanceof Sc;)y=y._def.innerType;i[a]=y}}),new qi({...this._def,shape:()=>i})}keyof(){return pV(Yn.objectKeys(this.shape))}}qi.create=(e,t)=>new qi({shape:()=>e,unknownKeys:"strip",catchall:xu.create(),typeName:tn.ZodObject,...Sn(t)});qi.strictCreate=(e,t)=>new qi({shape:()=>e,unknownKeys:"strict",catchall:xu.create(),typeName:tn.ZodObject,...Sn(t)});qi.lazycreate=(e,t)=>new qi({shape:e,unknownKeys:"strip",catchall:xu.create(),typeName:tn.ZodObject,...Sn(t)});class xv extends In{_parse(t){const{ctx:i}=this._processInputParams(t),a=this._def.options;function d(y){for(const s of y)if(s.result.status==="valid")return s.result;for(const s of y)if(s.result.status==="dirty")return i.common.issues.push(...s.ctx.common.issues),s.result;const S=y.map(s=>new Sa(s.ctx.common.issues));return Er(i,{code:sr.invalid_union,unionErrors:S}),cn}if(i.common.async)return Promise.all(a.map(async y=>{const S={...i,common:{...i.common,issues:[]},parent:null};return{result:await y._parseAsync({data:i.data,path:i.path,parent:S}),ctx:S}})).then(d);{let y;const S=[];for(const N of a){const D={...i,common:{...i.common,issues:[]},parent:null},O=N._parseSync({data:i.data,path:i.path,parent:D});if(O.status==="valid")return O;O.status==="dirty"&&!y&&(y={result:O,ctx:D}),D.common.issues.length&&S.push(D.common.issues)}if(y)return i.common.issues.push(...y.ctx.common.issues),y.result;const s=S.map(N=>new Sa(N));return Er(i,{code:sr.invalid_union,unionErrors:s}),cn}}get options(){return this._def.options}}xv.create=(e,t)=>new xv({options:e,typeName:tn.ZodUnion,...Sn(t)});const Jc=e=>e instanceof wv?Jc(e.schema):e instanceof Ul?Jc(e.innerType()):e instanceof Sv?[e.value]:e instanceof uh?e.options:e instanceof Tv?Yn.objectValues(e.enum):e instanceof Ev?Jc(e._def.innerType):e instanceof _v?[void 0]:e instanceof yv?[null]:e instanceof Sc?[void 0,...Jc(e.unwrap())]:e instanceof dh?[null,...Jc(e.unwrap())]:e instanceof sI||e instanceof Mv?Jc(e.unwrap()):e instanceof Cv?Jc(e._def.innerType):[];class W2 extends In{_parse(t){const{ctx:i}=this._processInputParams(t);if(i.parsedType!==Pr.object)return Er(i,{code:sr.invalid_type,expected:Pr.object,received:i.parsedType}),cn;const a=this.discriminator,d=i.data[a],y=this.optionsMap.get(d);return y?i.common.async?y._parseAsync({data:i.data,path:i.path,parent:i}):y._parseSync({data:i.data,path:i.path,parent:i}):(Er(i,{code:sr.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[a]}),cn)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(t,i,a){const d=new Map;for(const y of i){const S=Jc(y.shape[t]);if(!S.length)throw new Error(`A discriminator value for key \`${t}\` could not be extracted from all schema options`);for(const s of S){if(d.has(s))throw new Error(`Discriminator property ${String(t)} has duplicate value ${String(s)}`);d.set(s,y)}}return new W2({typeName:tn.ZodDiscriminatedUnion,discriminator:t,options:i,optionsMap:d,...Sn(a)})}}function qM(e,t){const i=Rd(e),a=Rd(t);if(e===t)return{valid:!0,data:e};if(i===Pr.object&&a===Pr.object){const d=Yn.objectKeys(t),y=Yn.objectKeys(e).filter(s=>d.indexOf(s)!==-1),S={...e,...t};for(const s of y){const N=qM(e[s],t[s]);if(!N.valid)return{valid:!1};S[s]=N.data}return{valid:!0,data:S}}else if(i===Pr.array&&a===Pr.array){if(e.length!==t.length)return{valid:!1};const d=[];for(let y=0;y<e.length;y++){const S=e[y],s=t[y],N=qM(S,s);if(!N.valid)return{valid:!1};d.push(N.data)}return{valid:!0,data:d}}else return i===Pr.date&&a===Pr.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}class vv extends In{_parse(t){const{status:i,ctx:a}=this._processInputParams(t),d=(y,S)=>{if($M(y)||$M(S))return cn;const s=qM(y.value,S.value);return s.valid?((GM(y)||GM(S))&&i.dirty(),{status:i.value,value:s.data}):(Er(a,{code:sr.invalid_intersection_types}),cn)};return a.common.async?Promise.all([this._def.left._parseAsync({data:a.data,path:a.path,parent:a}),this._def.right._parseAsync({data:a.data,path:a.path,parent:a})]).then(([y,S])=>d(y,S)):d(this._def.left._parseSync({data:a.data,path:a.path,parent:a}),this._def.right._parseSync({data:a.data,path:a.path,parent:a}))}}vv.create=(e,t,i)=>new vv({left:e,right:t,typeName:tn.ZodIntersection,...Sn(i)});class Pc extends In{_parse(t){const{status:i,ctx:a}=this._processInputParams(t);if(a.parsedType!==Pr.array)return Er(a,{code:sr.invalid_type,expected:Pr.array,received:a.parsedType}),cn;if(a.data.length<this._def.items.length)return Er(a,{code:sr.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),cn;!this._def.rest&&a.data.length>this._def.items.length&&(Er(a,{code:sr.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),i.dirty());const y=[...a.data].map((S,s)=>{const N=this._def.items[s]||this._def.rest;return N?N._parse(new Ac(a,S,a.path,s)):null}).filter(S=>!!S);return a.common.async?Promise.all(y).then(S=>lo.mergeArray(i,S)):lo.mergeArray(i,y)}get items(){return this._def.items}rest(t){return new Pc({...this._def,rest:t})}}Pc.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Pc({items:e,typeName:tn.ZodTuple,rest:null,...Sn(t)})};class bv extends In{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:i,ctx:a}=this._processInputParams(t);if(a.parsedType!==Pr.object)return Er(a,{code:sr.invalid_type,expected:Pr.object,received:a.parsedType}),cn;const d=[],y=this._def.keyType,S=this._def.valueType;for(const s in a.data)d.push({key:y._parse(new Ac(a,s,a.path,s)),value:S._parse(new Ac(a,a.data[s],a.path,s)),alwaysSet:s in a.data});return a.common.async?lo.mergeObjectAsync(i,d):lo.mergeObjectSync(i,d)}get element(){return this._def.valueType}static create(t,i,a){return i instanceof In?new bv({keyType:t,valueType:i,typeName:tn.ZodRecord,...Sn(a)}):new bv({keyType:Nl.create(),valueType:t,typeName:tn.ZodRecord,...Sn(i)})}}class Vw extends In{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:i,ctx:a}=this._processInputParams(t);if(a.parsedType!==Pr.map)return Er(a,{code:sr.invalid_type,expected:Pr.map,received:a.parsedType}),cn;const d=this._def.keyType,y=this._def.valueType,S=[...a.data.entries()].map(([s,N],D)=>({key:d._parse(new Ac(a,s,a.path,[D,"key"])),value:y._parse(new Ac(a,N,a.path,[D,"value"]))}));if(a.common.async){const s=new Map;return Promise.resolve().then(async()=>{for(const N of S){const D=await N.key,O=await N.value;if(D.status==="aborted"||O.status==="aborted")return cn;(D.status==="dirty"||O.status==="dirty")&&i.dirty(),s.set(D.value,O.value)}return{status:i.value,value:s}})}else{const s=new Map;for(const N of S){const D=N.key,O=N.value;if(D.status==="aborted"||O.status==="aborted")return cn;(D.status==="dirty"||O.status==="dirty")&&i.dirty(),s.set(D.value,O.value)}return{status:i.value,value:s}}}}Vw.create=(e,t,i)=>new Vw({valueType:t,keyType:e,typeName:tn.ZodMap,...Sn(i)});class Wf extends In{_parse(t){const{status:i,ctx:a}=this._processInputParams(t);if(a.parsedType!==Pr.set)return Er(a,{code:sr.invalid_type,expected:Pr.set,received:a.parsedType}),cn;const d=this._def;d.minSize!==null&&a.data.size<d.minSize.value&&(Er(a,{code:sr.too_small,minimum:d.minSize.value,type:"set",inclusive:!0,exact:!1,message:d.minSize.message}),i.dirty()),d.maxSize!==null&&a.data.size>d.maxSize.value&&(Er(a,{code:sr.too_big,maximum:d.maxSize.value,type:"set",inclusive:!0,exact:!1,message:d.maxSize.message}),i.dirty());const y=this._def.valueType;function S(N){const D=new Set;for(const O of N){if(O.status==="aborted")return cn;O.status==="dirty"&&i.dirty(),D.add(O.value)}return{status:i.value,value:D}}const s=[...a.data.values()].map((N,D)=>y._parse(new Ac(a,N,a.path,D)));return a.common.async?Promise.all(s).then(N=>S(N)):S(s)}min(t,i){return new Wf({...this._def,minSize:{value:t,message:$r.toString(i)}})}max(t,i){return new Wf({...this._def,maxSize:{value:t,message:$r.toString(i)}})}size(t,i){return this.min(t,i).max(t,i)}nonempty(t){return this.min(1,t)}}Wf.create=(e,t)=>new Wf({valueType:e,minSize:null,maxSize:null,typeName:tn.ZodSet,...Sn(t)});class rg extends In{constructor(){super(...arguments),this.validate=this.implement}_parse(t){const{ctx:i}=this._processInputParams(t);if(i.parsedType!==Pr.function)return Er(i,{code:sr.invalid_type,expected:Pr.function,received:i.parsedType}),cn;function a(s,N){return Ow({data:s,path:i.path,errorMaps:[i.common.contextualErrorMap,i.schemaErrorMap,Lw(),Ag].filter(D=>!!D),issueData:{code:sr.invalid_arguments,argumentsError:N}})}function d(s,N){return Ow({data:s,path:i.path,errorMaps:[i.common.contextualErrorMap,i.schemaErrorMap,Lw(),Ag].filter(D=>!!D),issueData:{code:sr.invalid_return_type,returnTypeError:N}})}const y={errorMap:i.common.contextualErrorMap},S=i.data;if(this._def.returns instanceof Ig){const s=this;return Po(async function(...N){const D=new Sa([]),O=await s._def.args.parseAsync(N,y).catch(J=>{throw D.addIssue(a(N,J)),D}),$=await Reflect.apply(S,this,O);return await s._def.returns._def.type.parseAsync($,y).catch(J=>{throw D.addIssue(d($,J)),D})})}else{const s=this;return Po(function(...N){const D=s._def.args.safeParse(N,y);if(!D.success)throw new Sa([a(N,D.error)]);const O=Reflect.apply(S,this,D.data),$=s._def.returns.safeParse(O,y);if(!$.success)throw new Sa([d(O,$.error)]);return $.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...t){return new rg({...this._def,args:Pc.create(t).rest(jf.create())})}returns(t){return new rg({...this._def,returns:t})}implement(t){return this.parse(t)}strictImplement(t){return this.parse(t)}static create(t,i,a){return new rg({args:t||Pc.create([]).rest(jf.create()),returns:i||jf.create(),typeName:tn.ZodFunction,...Sn(a)})}}class wv extends In{get schema(){return this._def.getter()}_parse(t){const{ctx:i}=this._processInputParams(t);return this._def.getter()._parse({data:i.data,path:i.path,parent:i})}}wv.create=(e,t)=>new wv({getter:e,typeName:tn.ZodLazy,...Sn(t)});class Sv extends In{_parse(t){if(t.data!==this._def.value){const i=this._getOrReturnCtx(t);return Er(i,{received:i.data,code:sr.invalid_literal,expected:this._def.value}),cn}return{status:"valid",value:t.data}}get value(){return this._def.value}}Sv.create=(e,t)=>new Sv({value:e,typeName:tn.ZodLiteral,...Sn(t)});function pV(e,t){return new uh({values:e,typeName:tn.ZodEnum,...Sn(t)})}class uh extends In{constructor(){super(...arguments),px.set(this,void 0)}_parse(t){if(typeof t.data!="string"){const i=this._getOrReturnCtx(t),a=this._def.values;return Er(i,{expected:Yn.joinValues(a),received:i.parsedType,code:sr.invalid_type}),cn}if(zw(this,px)||uV(this,px,new Set(this._def.values)),!zw(this,px).has(t.data)){const i=this._getOrReturnCtx(t),a=this._def.values;return Er(i,{received:i.data,code:sr.invalid_enum_value,options:a}),cn}return Po(t.data)}get options(){return this._def.values}get enum(){const t={};for(const i of this._def.values)t[i]=i;return t}get Values(){const t={};for(const i of this._def.values)t[i]=i;return t}get Enum(){const t={};for(const i of this._def.values)t[i]=i;return t}extract(t,i=this._def){return uh.create(t,{...this._def,...i})}exclude(t,i=this._def){return uh.create(this.options.filter(a=>!t.includes(a)),{...this._def,...i})}}px=new WeakMap;uh.create=pV;class Tv extends In{constructor(){super(...arguments),mx.set(this,void 0)}_parse(t){const i=Yn.getValidEnumValues(this._def.values),a=this._getOrReturnCtx(t);if(a.parsedType!==Pr.string&&a.parsedType!==Pr.number){const d=Yn.objectValues(i);return Er(a,{expected:Yn.joinValues(d),received:a.parsedType,code:sr.invalid_type}),cn}if(zw(this,mx)||uV(this,mx,new Set(Yn.getValidEnumValues(this._def.values))),!zw(this,mx).has(t.data)){const d=Yn.objectValues(i);return Er(a,{received:a.data,code:sr.invalid_enum_value,options:d}),cn}return Po(t.data)}get enum(){return this._def.values}}mx=new WeakMap;Tv.create=(e,t)=>new Tv({values:e,typeName:tn.ZodNativeEnum,...Sn(t)});class Ig extends In{unwrap(){return this._def.type}_parse(t){const{ctx:i}=this._processInputParams(t);if(i.parsedType!==Pr.promise&&i.common.async===!1)return Er(i,{code:sr.invalid_type,expected:Pr.promise,received:i.parsedType}),cn;const a=i.parsedType===Pr.promise?i.data:Promise.resolve(i.data);return Po(a.then(d=>this._def.type.parseAsync(d,{path:i.path,errorMap:i.common.contextualErrorMap})))}}Ig.create=(e,t)=>new Ig({type:e,typeName:tn.ZodPromise,...Sn(t)});class Ul extends In{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===tn.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){const{status:i,ctx:a}=this._processInputParams(t),d=this._def.effect||null,y={addIssue:S=>{Er(a,S),S.fatal?i.abort():i.dirty()},get path(){return a.path}};if(y.addIssue=y.addIssue.bind(y),d.type==="preprocess"){const S=d.transform(a.data,y);if(a.common.async)return Promise.resolve(S).then(async s=>{if(i.value==="aborted")return cn;const N=await this._def.schema._parseAsync({data:s,path:a.path,parent:a});return N.status==="aborted"?cn:N.status==="dirty"||i.value==="dirty"?$m(N.value):N});{if(i.value==="aborted")return cn;const s=this._def.schema._parseSync({data:S,path:a.path,parent:a});return s.status==="aborted"?cn:s.status==="dirty"||i.value==="dirty"?$m(s.value):s}}if(d.type==="refinement"){const S=s=>{const N=d.refinement(s,y);if(a.common.async)return Promise.resolve(N);if(N instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return s};if(a.common.async===!1){const s=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});return s.status==="aborted"?cn:(s.status==="dirty"&&i.dirty(),S(s.value),{status:i.value,value:s.value})}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(s=>s.status==="aborted"?cn:(s.status==="dirty"&&i.dirty(),S(s.value).then(()=>({status:i.value,value:s.value}))))}if(d.type==="transform")if(a.common.async===!1){const S=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});if(!pv(S))return S;const s=d.transform(S.value,y);if(s instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:i.value,value:s}}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(S=>pv(S)?Promise.resolve(d.transform(S.value,y)).then(s=>({status:i.value,value:s})):S);Yn.assertNever(d)}}Ul.create=(e,t,i)=>new Ul({schema:e,typeName:tn.ZodEffects,effect:t,...Sn(i)});Ul.createWithPreprocess=(e,t,i)=>new Ul({schema:t,effect:{type:"preprocess",transform:e},typeName:tn.ZodEffects,...Sn(i)});class Sc extends In{_parse(t){return this._getType(t)===Pr.undefined?Po(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}Sc.create=(e,t)=>new Sc({innerType:e,typeName:tn.ZodOptional,...Sn(t)});class dh extends In{_parse(t){return this._getType(t)===Pr.null?Po(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}dh.create=(e,t)=>new dh({innerType:e,typeName:tn.ZodNullable,...Sn(t)});class Ev extends In{_parse(t){const{ctx:i}=this._processInputParams(t);let a=i.data;return i.parsedType===Pr.undefined&&(a=this._def.defaultValue()),this._def.innerType._parse({data:a,path:i.path,parent:i})}removeDefault(){return this._def.innerType}}Ev.create=(e,t)=>new Ev({innerType:e,typeName:tn.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...Sn(t)});class Cv extends In{_parse(t){const{ctx:i}=this._processInputParams(t),a={...i,common:{...i.common,issues:[]}},d=this._def.innerType._parse({data:a.data,path:a.path,parent:{...a}});return mv(d)?d.then(y=>({status:"valid",value:y.status==="valid"?y.value:this._def.catchValue({get error(){return new Sa(a.common.issues)},input:a.data})})):{status:"valid",value:d.status==="valid"?d.value:this._def.catchValue({get error(){return new Sa(a.common.issues)},input:a.data})}}removeCatch(){return this._def.innerType}}Cv.create=(e,t)=>new Cv({innerType:e,typeName:tn.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch,...Sn(t)});class Uw extends In{_parse(t){if(this._getType(t)!==Pr.nan){const a=this._getOrReturnCtx(t);return Er(a,{code:sr.invalid_type,expected:Pr.nan,received:a.parsedType}),cn}return{status:"valid",value:t.data}}}Uw.create=e=>new Uw({typeName:tn.ZodNaN,...Sn(e)});const lae=Symbol("zod_brand");class sI extends In{_parse(t){const{ctx:i}=this._processInputParams(t),a=i.data;return this._def.type._parse({data:a,path:i.path,parent:i})}unwrap(){return this._def.type}}class r0 extends In{_parse(t){const{status:i,ctx:a}=this._processInputParams(t);if(a.common.async)return(async()=>{const y=await this._def.in._parseAsync({data:a.data,path:a.path,parent:a});return y.status==="aborted"?cn:y.status==="dirty"?(i.dirty(),$m(y.value)):this._def.out._parseAsync({data:y.value,path:a.path,parent:a})})();{const d=this._def.in._parseSync({data:a.data,path:a.path,parent:a});return d.status==="aborted"?cn:d.status==="dirty"?(i.dirty(),{status:"dirty",value:d.value}):this._def.out._parseSync({data:d.value,path:a.path,parent:a})}}static create(t,i){return new r0({in:t,out:i,typeName:tn.ZodPipeline})}}class Mv extends In{_parse(t){const i=this._def.innerType._parse(t),a=d=>(pv(d)&&(d.value=Object.freeze(d.value)),d);return mv(i)?i.then(d=>a(d)):a(i)}unwrap(){return this._def.innerType}}Mv.create=(e,t)=>new Mv({innerType:e,typeName:tn.ZodReadonly,...Sn(t)});function mV(e,t={},i){return e?Pg.create().superRefine((a,d)=>{var y,S;if(!e(a)){const s=typeof t=="function"?t(a):typeof t=="string"?{message:t}:t,N=(S=(y=s.fatal)!==null&&y!==void 0?y:i)!==null&&S!==void 0?S:!0,D=typeof s=="string"?{message:s}:s;d.addIssue({code:"custom",...D,fatal:N})}}):Pg.create()}const cae={object:qi.lazycreate};var tn;(function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"})(tn||(tn={}));const uae=(e,t={message:`Input not instance of ${e.name}`})=>mV(i=>i instanceof e,t),gV=Nl.create,_V=lh.create,dae=Uw.create,hae=ch.create,yV=gv.create,fae=Hf.create,pae=Fw.create,mae=_v.create,gae=yv.create,_ae=Pg.create,yae=jf.create,xae=xu.create,vae=Bw.create,bae=Ll.create,wae=qi.create,Sae=qi.strictCreate,Tae=xv.create,Eae=W2.create,Cae=vv.create,Mae=Pc.create,Aae=bv.create,Pae=Vw.create,Iae=Wf.create,kae=rg.create,Nae=wv.create,Rae=Sv.create,jae=uh.create,Dae=Tv.create,Lae=Ig.create,OD=Ul.create,Oae=Sc.create,zae=dh.create,Fae=Ul.createWithPreprocess,Bae=r0.create,Vae=()=>gV().optional(),Uae=()=>_V().optional(),$ae=()=>yV().optional(),Gae={string:e=>Nl.create({...e,coerce:!0}),number:e=>lh.create({...e,coerce:!0}),boolean:e=>gv.create({...e,coerce:!0}),bigint:e=>ch.create({...e,coerce:!0}),date:e=>Hf.create({...e,coerce:!0})},qae=cn;var nx=Object.freeze({__proto__:null,defaultErrorMap:Ag,setErrorMap:qoe,getErrorMap:Lw,makeIssue:Ow,EMPTY_PATH:Hoe,addIssueToContext:Er,ParseStatus:lo,INVALID:cn,DIRTY:$m,OK:Po,isAborted:$M,isDirty:GM,isValid:pv,isAsync:mv,get util(){return Yn},get objectUtil(){return UM},ZodParsedType:Pr,getParsedType:Rd,ZodType:In,datetimeRegex:fV,ZodString:Nl,ZodNumber:lh,ZodBigInt:ch,ZodBoolean:gv,ZodDate:Hf,ZodSymbol:Fw,ZodUndefined:_v,ZodNull:yv,ZodAny:Pg,ZodUnknown:jf,ZodNever:xu,ZodVoid:Bw,ZodArray:Ll,ZodObject:qi,ZodUnion:xv,ZodDiscriminatedUnion:W2,ZodIntersection:vv,ZodTuple:Pc,ZodRecord:bv,ZodMap:Vw,ZodSet:Wf,ZodFunction:rg,ZodLazy:wv,ZodLiteral:Sv,ZodEnum:uh,ZodNativeEnum:Tv,ZodPromise:Ig,ZodEffects:Ul,ZodTransformer:Ul,ZodOptional:Sc,ZodNullable:dh,ZodDefault:Ev,ZodCatch:Cv,ZodNaN:Uw,BRAND:lae,ZodBranded:sI,ZodPipeline:r0,ZodReadonly:Mv,custom:mV,Schema:In,ZodSchema:In,late:cae,get ZodFirstPartyTypeKind(){return tn},coerce:Gae,any:_ae,array:bae,bigint:hae,boolean:yV,date:fae,discriminatedUnion:Eae,effect:OD,enum:jae,function:kae,instanceof:uae,intersection:Cae,lazy:Nae,literal:Rae,map:Pae,nan:dae,nativeEnum:Dae,never:xae,null:gae,nullable:zae,number:_V,object:wae,oboolean:$ae,onumber:Uae,optional:Oae,ostring:Vae,pipeline:Bae,preprocess:Fae,promise:Lae,record:Aae,set:Iae,strictObject:Sae,string:gV,symbol:pae,transformer:OD,tuple:Mae,undefined:mae,union:Tae,unknown:yae,void:vae,NEVER:qae,ZodIssueCode:sr,quotelessJson:Goe,ZodError:Sa}),n0=e=>e.type==="checkbox",Cf=e=>e instanceof Date,To=e=>e==null;const xV=e=>typeof e=="object";var ps=e=>!To(e)&&!Array.isArray(e)&&xV(e)&&!Cf(e),vV=e=>ps(e)&&e.target?n0(e.target)?e.target.checked:e.target.value:e,Hae=e=>e.substring(0,e.search(/\.\d+(\.|$)/))||e,bV=(e,t)=>e.has(Hae(t)),Wae=e=>{const t=e.constructor&&e.constructor.prototype;return ps(t)&&t.hasOwnProperty("isPrototypeOf")},oI=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function Go(e){let t;const i=Array.isArray(e);if(e instanceof Date)t=new Date(e);else if(e instanceof Set)t=new Set(e);else if(!(oI&&(e instanceof Blob||e instanceof FileList))&&(i||ps(e)))if(t=i?[]:{},!i&&!Wae(e))t=e;else for(const a in e)e.hasOwnProperty(a)&&(t[a]=Go(e[a]));else return e;return t}var Z2=e=>Array.isArray(e)?e.filter(Boolean):[],is=e=>e===void 0,fr=(e,t,i)=>{if(!t||!ps(e))return i;const a=Z2(t.split(/[,[\].]+?/)).reduce((d,y)=>To(d)?d:d[y],e);return is(a)||a===e?is(e[t])?i:e[t]:a},Ua=e=>typeof e=="boolean",aI=e=>/^\w*$/.test(e),wV=e=>Z2(e.replace(/["|']|\]/g,"").split(/\.|\[/)),ui=(e,t,i)=>{let a=-1;const d=aI(t)?[t]:wV(t),y=d.length,S=y-1;for(;++a<y;){const s=d[a];let N=i;if(a!==S){const D=e[s];N=ps(D)||Array.isArray(D)?D:isNaN(+d[a+1])?{}:[]}if(s==="__proto__")return;e[s]=N,e=e[s]}return e};const $w={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},Il={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},Xc={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},SV=Gt.createContext(null),Y2=()=>Gt.useContext(SV),Zae=e=>{const{children:t,...i}=e;return Gt.createElement(SV.Provider,{value:i},t)};var TV=(e,t,i,a=!0)=>{const d={defaultValues:t._defaultValues};for(const y in e)Object.defineProperty(d,y,{get:()=>{const S=y;return t._proxyFormState[S]!==Il.all&&(t._proxyFormState[S]=!a||Il.all),i&&(i[S]=!0),e[S]}});return d},qo=e=>ps(e)&&!Object.keys(e).length,EV=(e,t,i,a)=>{i(e);const{name:d,...y}=e;return qo(y)||Object.keys(y).length>=Object.keys(t).length||Object.keys(y).find(S=>t[S]===(!a||Il.all))},jx=e=>Array.isArray(e)?e:[e],CV=(e,t,i)=>!e||!t||e===t||jx(e).some(a=>a&&(i?a===t:a.startsWith(t)||t.startsWith(a)));function lI(e){const t=Gt.useRef(e);t.current=e,Gt.useEffect(()=>{const i=!e.disabled&&t.current.subject&&t.current.subject.subscribe({next:t.current.next});return()=>{i&&i.unsubscribe()}},[e.disabled])}function Yae(e){const t=Y2(),{control:i=t.control,disabled:a,name:d,exact:y}=e||{},[S,s]=Gt.useState(i._formState),N=Gt.useRef(!0),D=Gt.useRef({isDirty:!1,isLoading:!1,dirtyFields:!1,touchedFields:!1,validatingFields:!1,isValidating:!1,isValid:!1,errors:!1}),O=Gt.useRef(d);return O.current=d,lI({disabled:a,next:$=>N.current&&CV(O.current,$.name,y)&&EV($,D.current,i._updateFormState)&&s({...i._formState,...$}),subject:i._subjects.state}),Gt.useEffect(()=>(N.current=!0,D.current.isValid&&i._updateValid(!0),()=>{N.current=!1}),[i]),TV(S,i,D.current,!1)}var xc=e=>typeof e=="string",MV=(e,t,i,a,d)=>xc(e)?(a&&t.watch.add(e),fr(i,e,d)):Array.isArray(e)?e.map(y=>(a&&t.watch.add(y),fr(i,y))):(a&&(t.watchAll=!0),i);function Xae(e){const t=Y2(),{control:i=t.control,name:a,defaultValue:d,disabled:y,exact:S}=e||{},s=Gt.useRef(a);s.current=a,lI({disabled:y,subject:i._subjects.values,next:O=>{CV(s.current,O.name,S)&&D(Go(MV(s.current,i._names,O.values||i._formValues,!1,d)))}});const[N,D]=Gt.useState(i._getWatch(a,d));return Gt.useEffect(()=>i._removeUnmounted()),N}function Kae(e){const t=Y2(),{name:i,disabled:a,control:d=t.control,shouldUnregister:y}=e,S=bV(d._names.array,i),s=Xae({control:d,name:i,defaultValue:fr(d._formValues,i,fr(d._defaultValues,i,e.defaultValue)),exact:!0}),N=Yae({control:d,name:i,exact:!0}),D=Gt.useRef(d.register(i,{...e.rules,value:s,...Ua(e.disabled)?{disabled:e.disabled}:{}}));return Gt.useEffect(()=>{const O=d._options.shouldUnregister||y,$=(q,J)=>{const re=fr(d._fields,q);re&&re._f&&(re._f.mount=J)};if($(i,!0),O){const q=Go(fr(d._options.defaultValues,i));ui(d._defaultValues,i,q),is(fr(d._formValues,i))&&ui(d._formValues,i,q)}return()=>{(S?O&&!d._state.action:O)?d.unregister(i):$(i,!1)}},[i,d,S,y]),Gt.useEffect(()=>{fr(d._fields,i)&&d._updateDisabledField({disabled:a,fields:d._fields,name:i,value:fr(d._fields,i)._f.value})},[a,i,d]),{field:{name:i,value:s,...Ua(a)||N.disabled?{disabled:N.disabled||a}:{},onChange:Gt.useCallback(O=>D.current.onChange({target:{value:vV(O),name:i},type:$w.CHANGE}),[i]),onBlur:Gt.useCallback(()=>D.current.onBlur({target:{value:fr(d._formValues,i),name:i},type:$w.BLUR}),[i,d]),ref:Gt.useCallback(O=>{const $=fr(d._fields,i);$&&O&&($._f.ref={focus:()=>O.focus(),select:()=>O.select(),setCustomValidity:q=>O.setCustomValidity(q),reportValidity:()=>O.reportValidity()})},[d._fields,i])},formState:N,fieldState:Object.defineProperties({},{invalid:{enumerable:!0,get:()=>!!fr(N.errors,i)},isDirty:{enumerable:!0,get:()=>!!fr(N.dirtyFields,i)},isTouched:{enumerable:!0,get:()=>!!fr(N.touchedFields,i)},isValidating:{enumerable:!0,get:()=>!!fr(N.validatingFields,i)},error:{enumerable:!0,get:()=>fr(N.errors,i)}})}}const Jae=e=>e.render(Kae(e));var AV=(e,t,i,a,d)=>t?{...i[e],types:{...i[e]&&i[e].types?i[e].types:{},[a]:d||!0}}:{},zD=e=>({isOnSubmit:!e||e===Il.onSubmit,isOnBlur:e===Il.onBlur,isOnChange:e===Il.onChange,isOnAll:e===Il.all,isOnTouch:e===Il.onTouched}),FD=(e,t,i)=>!i&&(t.watchAll||t.watch.has(e)||[...t.watch].some(a=>e.startsWith(a)&&/^\.\w+/.test(e.slice(a.length))));const Dx=(e,t,i,a)=>{for(const d of i||Object.keys(e)){const y=fr(e,d);if(y){const{_f:S,...s}=y;if(S){if(S.refs&&S.refs[0]&&t(S.refs[0],d)&&!a)return!0;if(S.ref&&t(S.ref,S.name)&&!a)return!0;if(Dx(s,t))break}else if(ps(s)&&Dx(s,t))break}}};var Qae=(e,t,i)=>{const a=jx(fr(e,i));return ui(a,"root",t[i]),ui(e,i,a),e},cI=e=>e.type==="file",iu=e=>typeof e=="function",Gw=e=>{if(!oI)return!1;const t=e?e.ownerDocument:0;return e instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},Hb=e=>xc(e),uI=e=>e.type==="radio",qw=e=>e instanceof RegExp;const BD={value:!1,isValid:!1},VD={value:!0,isValid:!0};var PV=e=>{if(Array.isArray(e)){if(e.length>1){const t=e.filter(i=>i&&i.checked&&!i.disabled).map(i=>i.value);return{value:t,isValid:!!t.length}}return e[0].checked&&!e[0].disabled?e[0].attributes&&!is(e[0].attributes.value)?is(e[0].value)||e[0].value===""?VD:{value:e[0].value,isValid:!0}:VD:BD}return BD};const UD={isValid:!1,value:null};var IV=e=>Array.isArray(e)?e.reduce((t,i)=>i&&i.checked&&!i.disabled?{isValid:!0,value:i.value}:t,UD):UD;function $D(e,t,i="validate"){if(Hb(e)||Array.isArray(e)&&e.every(Hb)||Ua(e)&&!e)return{type:i,message:Hb(e)?e:"",ref:t}}var Mm=e=>ps(e)&&!qw(e)?e:{value:e,message:""},GD=async(e,t,i,a,d)=>{const{ref:y,refs:S,required:s,maxLength:N,minLength:D,min:O,max:$,pattern:q,validate:J,name:re,valueAsNumber:Q,mount:ce,disabled:le}=e._f,ae=fr(t,re);if(!ce||le)return{};const he=S?S[0]:y,Se=Mt=>{a&&he.reportValidity&&(he.setCustomValidity(Ua(Mt)?"":Mt||""),he.reportValidity())},je={},it=uI(y),qe=n0(y),ct=it||qe,pt=(Q||cI(y))&&is(y.value)&&is(ae)||Gw(y)&&y.value===""||ae===""||Array.isArray(ae)&&!ae.length,Ze=AV.bind(null,re,i,je),yt=(Mt,Jt,jt,Pt=Xc.maxLength,Wt=Xc.minLength)=>{const Nt=Mt?Jt:jt;je[re]={type:Mt?Pt:Wt,message:Nt,ref:y,...Ze(Mt?Pt:Wt,Nt)}};if(d?!Array.isArray(ae)||!ae.length:s&&(!ct&&(pt||To(ae))||Ua(ae)&&!ae||qe&&!PV(S).isValid||it&&!IV(S).isValid)){const{value:Mt,message:Jt}=Hb(s)?{value:!!s,message:s}:Mm(s);if(Mt&&(je[re]={type:Xc.required,message:Jt,ref:he,...Ze(Xc.required,Jt)},!i))return Se(Jt),je}if(!pt&&(!To(O)||!To($))){let Mt,Jt;const jt=Mm($),Pt=Mm(O);if(!To(ae)&&!isNaN(ae)){const Wt=y.valueAsNumber||ae&&+ae;To(jt.value)||(Mt=Wt>jt.value),To(Pt.value)||(Jt=Wt<Pt.value)}else{const Wt=y.valueAsDate||new Date(ae),Nt=Qt=>new Date(new Date().toDateString()+" "+Qt),Xe=y.type=="time",nt=y.type=="week";xc(jt.value)&&ae&&(Mt=Xe?Nt(ae)>Nt(jt.value):nt?ae>jt.value:Wt>new Date(jt.value)),xc(Pt.value)&&ae&&(Jt=Xe?Nt(ae)<Nt(Pt.value):nt?ae<Pt.value:Wt<new Date(Pt.value))}if((Mt||Jt)&&(yt(!!Mt,jt.message,Pt.message,Xc.max,Xc.min),!i))return Se(je[re].message),je}if((N||D)&&!pt&&(xc(ae)||d&&Array.isArray(ae))){const Mt=Mm(N),Jt=Mm(D),jt=!To(Mt.value)&&ae.length>+Mt.value,Pt=!To(Jt.value)&&ae.length<+Jt.value;if((jt||Pt)&&(yt(jt,Mt.message,Jt.message),!i))return Se(je[re].message),je}if(q&&!pt&&xc(ae)){const{value:Mt,message:Jt}=Mm(q);if(qw(Mt)&&!ae.match(Mt)&&(je[re]={type:Xc.pattern,message:Jt,ref:y,...Ze(Xc.pattern,Jt)},!i))return Se(Jt),je}if(J){if(iu(J)){const Mt=await J(ae,t),Jt=$D(Mt,he);if(Jt&&(je[re]={...Jt,...Ze(Xc.validate,Jt.message)},!i))return Se(Jt.message),je}else if(ps(J)){let Mt={};for(const Jt in J){if(!qo(Mt)&&!i)break;const jt=$D(await J[Jt](ae,t),he,Jt);jt&&(Mt={...jt,...Ze(Jt,jt.message)},Se(jt.message),i&&(je[re]=Mt))}if(!qo(Mt)&&(je[re]={ref:he,...Mt},!i))return je}}return Se(!0),je};function ele(e,t){const i=t.slice(0,-1).length;let a=0;for(;a<i;)e=is(e)?a++:e[t[a++]];return e}function tle(e){for(const t in e)if(e.hasOwnProperty(t)&&!is(e[t]))return!1;return!0}function Ns(e,t){const i=Array.isArray(t)?t:aI(t)?[t]:wV(t),a=i.length===1?e:ele(e,i),d=i.length-1,y=i[d];return a&&delete a[y],d!==0&&(ps(a)&&qo(a)||Array.isArray(a)&&tle(a))&&Ns(e,i.slice(0,-1)),e}var sC=()=>{let e=[];return{get observers(){return e},next:d=>{for(const y of e)y.next&&y.next(d)},subscribe:d=>(e.push(d),{unsubscribe:()=>{e=e.filter(y=>y!==d)}}),unsubscribe:()=>{e=[]}}},HM=e=>To(e)||!xV(e);function jd(e,t){if(HM(e)||HM(t))return e===t;if(Cf(e)&&Cf(t))return e.getTime()===t.getTime();const i=Object.keys(e),a=Object.keys(t);if(i.length!==a.length)return!1;for(const d of i){const y=e[d];if(!a.includes(d))return!1;if(d!=="ref"){const S=t[d];if(Cf(y)&&Cf(S)||ps(y)&&ps(S)||Array.isArray(y)&&Array.isArray(S)?!jd(y,S):y!==S)return!1}}return!0}var kV=e=>e.type==="select-multiple",rle=e=>uI(e)||n0(e),oC=e=>Gw(e)&&e.isConnected,NV=e=>{for(const t in e)if(iu(e[t]))return!0;return!1};function Hw(e,t={}){const i=Array.isArray(e);if(ps(e)||i)for(const a in e)Array.isArray(e[a])||ps(e[a])&&!NV(e[a])?(t[a]=Array.isArray(e[a])?[]:{},Hw(e[a],t[a])):To(e[a])||(t[a]=!0);return t}function RV(e,t,i){const a=Array.isArray(e);if(ps(e)||a)for(const d in e)Array.isArray(e[d])||ps(e[d])&&!NV(e[d])?is(t)||HM(i[d])?i[d]=Array.isArray(e[d])?Hw(e[d],[]):{...Hw(e[d])}:RV(e[d],To(t)?{}:t[d],i[d]):i[d]=!jd(e[d],t[d]);return i}var ix=(e,t)=>RV(e,t,Hw(t)),jV=(e,{valueAsNumber:t,valueAsDate:i,setValueAs:a})=>is(e)?e:t?e===""?NaN:e&&+e:i&&xc(e)?new Date(e):a?a(e):e;function aC(e){const t=e.ref;if(!(e.refs?e.refs.every(i=>i.disabled):t.disabled))return cI(t)?t.files:uI(t)?IV(e.refs).value:kV(t)?[...t.selectedOptions].map(({value:i})=>i):n0(t)?PV(e.refs).value:jV(is(t.value)?e.ref.value:t.value,e)}var nle=(e,t,i,a)=>{const d={};for(const y of e){const S=fr(t,y);S&&ui(d,y,S._f)}return{criteriaMode:i,names:[...e],fields:d,shouldUseNativeValidation:a}},sx=e=>is(e)?e:qw(e)?e.source:ps(e)?qw(e.value)?e.value.source:e.value:e;const qD="AsyncFunction";var ile=e=>(!e||!e.validate)&&!!(iu(e.validate)&&e.validate.constructor.name===qD||ps(e.validate)&&Object.values(e.validate).find(t=>t.constructor.name===qD)),sle=e=>e.mount&&(e.required||e.min||e.max||e.maxLength||e.minLength||e.pattern||e.validate);function HD(e,t,i){const a=fr(e,i);if(a||aI(i))return{error:a,name:i};const d=i.split(".");for(;d.length;){const y=d.join("."),S=fr(t,y),s=fr(e,y);if(S&&!Array.isArray(S)&&i!==y)return{name:i};if(s&&s.type)return{name:y,error:s};d.pop()}return{name:i}}var ole=(e,t,i,a,d)=>d.isOnAll?!1:!i&&d.isOnTouch?!(t||e):(i?a.isOnBlur:d.isOnBlur)?!e:(i?a.isOnChange:d.isOnChange)?e:!0,ale=(e,t)=>!Z2(fr(e,t)).length&&Ns(e,t);const lle={mode:Il.onSubmit,reValidateMode:Il.onChange,shouldFocusError:!0};function cle(e={}){let t={...lle,...e},i={submitCount:0,isDirty:!1,isLoading:iu(t.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1},a={},d=ps(t.defaultValues)||ps(t.values)?Go(t.defaultValues||t.values)||{}:{},y=t.shouldUnregister?{}:Go(d),S={action:!1,mount:!1,watch:!1},s={mount:new Set,unMount:new Set,array:new Set,watch:new Set},N,D=0;const O={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},$={values:sC(),array:sC(),state:sC()},q=zD(t.mode),J=zD(t.reValidateMode),re=t.criteriaMode===Il.all,Q=Be=>ut=>{clearTimeout(D),D=setTimeout(Be,ut)},ce=async Be=>{if(!e.disabled&&(O.isValid||Be)){const ut=t.resolver?qo((await ct()).errors):await Ze(a,!0);ut!==i.isValid&&$.state.next({isValid:ut})}},le=(Be,ut)=>{!e.disabled&&(O.isValidating||O.validatingFields)&&((Be||Array.from(s.mount)).forEach(St=>{St&&(ut?ui(i.validatingFields,St,ut):Ns(i.validatingFields,St))}),$.state.next({validatingFields:i.validatingFields,isValidating:!qo(i.validatingFields)}))},ae=(Be,ut=[],St,dr,or=!0,tr=!0)=>{if(dr&&St&&!e.disabled){if(S.action=!0,tr&&Array.isArray(fr(a,Be))){const Bt=St(fr(a,Be),dr.argA,dr.argB);or&&ui(a,Be,Bt)}if(tr&&Array.isArray(fr(i.errors,Be))){const Bt=St(fr(i.errors,Be),dr.argA,dr.argB);or&&ui(i.errors,Be,Bt),ale(i.errors,Be)}if(O.touchedFields&&tr&&Array.isArray(fr(i.touchedFields,Be))){const Bt=St(fr(i.touchedFields,Be),dr.argA,dr.argB);or&&ui(i.touchedFields,Be,Bt)}O.dirtyFields&&(i.dirtyFields=ix(d,y)),$.state.next({name:Be,isDirty:Mt(Be,ut),dirtyFields:i.dirtyFields,errors:i.errors,isValid:i.isValid})}else ui(y,Be,ut)},he=(Be,ut)=>{ui(i.errors,Be,ut),$.state.next({errors:i.errors})},Se=Be=>{i.errors=Be,$.state.next({errors:i.errors,isValid:!1})},je=(Be,ut,St,dr)=>{const or=fr(a,Be);if(or){const tr=fr(y,Be,is(St)?fr(d,Be):St);is(tr)||dr&&dr.defaultChecked||ut?ui(y,Be,ut?tr:aC(or._f)):Pt(Be,tr),S.mount&&ce()}},it=(Be,ut,St,dr,or)=>{let tr=!1,Bt=!1;const Or={name:Be};if(!e.disabled){const Xn=!!(fr(a,Be)&&fr(a,Be)._f&&fr(a,Be)._f.disabled);if(!St||dr){O.isDirty&&(Bt=i.isDirty,i.isDirty=Or.isDirty=Mt(),tr=Bt!==Or.isDirty);const Bn=Xn||jd(fr(d,Be),ut);Bt=!!(!Xn&&fr(i.dirtyFields,Be)),Bn||Xn?Ns(i.dirtyFields,Be):ui(i.dirtyFields,Be,!0),Or.dirtyFields=i.dirtyFields,tr=tr||O.dirtyFields&&Bt!==!Bn}if(St){const Bn=fr(i.touchedFields,Be);Bn||(ui(i.touchedFields,Be,St),Or.touchedFields=i.touchedFields,tr=tr||O.touchedFields&&Bn!==St)}tr&&or&&$.state.next(Or)}return tr?Or:{}},qe=(Be,ut,St,dr)=>{const or=fr(i.errors,Be),tr=O.isValid&&Ua(ut)&&i.isValid!==ut;if(e.delayError&&St?(N=Q(()=>he(Be,St)),N(e.delayError)):(clearTimeout(D),N=null,St?ui(i.errors,Be,St):Ns(i.errors,Be)),(St?!jd(or,St):or)||!qo(dr)||tr){const Bt={...dr,...tr&&Ua(ut)?{isValid:ut}:{},errors:i.errors,name:Be};i={...i,...Bt},$.state.next(Bt)}},ct=async Be=>{le(Be,!0);const ut=await t.resolver(y,t.context,nle(Be||s.mount,a,t.criteriaMode,t.shouldUseNativeValidation));return le(Be),ut},pt=async Be=>{const{errors:ut}=await ct(Be);if(Be)for(const St of Be){const dr=fr(ut,St);dr?ui(i.errors,St,dr):Ns(i.errors,St)}else i.errors=ut;return ut},Ze=async(Be,ut,St={valid:!0})=>{for(const dr in Be){const or=Be[dr];if(or){const{_f:tr,...Bt}=or;if(tr){const Or=s.array.has(tr.name),Xn=or._f&&ile(or._f);Xn&&O.validatingFields&&le([dr],!0);const Bn=await GD(or,y,re,t.shouldUseNativeValidation&&!ut,Or);if(Xn&&O.validatingFields&&le([dr]),Bn[tr.name]&&(St.valid=!1,ut))break;!ut&&(fr(Bn,tr.name)?Or?Qae(i.errors,Bn,tr.name):ui(i.errors,tr.name,Bn[tr.name]):Ns(i.errors,tr.name))}!qo(Bt)&&await Ze(Bt,ut,St)}}return St.valid},yt=()=>{for(const Be of s.unMount){const ut=fr(a,Be);ut&&(ut._f.refs?ut._f.refs.every(St=>!oC(St)):!oC(ut._f.ref))&&At(Be)}s.unMount=new Set},Mt=(Be,ut)=>!e.disabled&&(Be&&ut&&ui(y,Be,ut),!jd(rr(),d)),Jt=(Be,ut,St)=>MV(Be,s,{...S.mount?y:is(ut)?d:xc(Be)?{[Be]:ut}:ut},St,ut),jt=Be=>Z2(fr(S.mount?y:d,Be,e.shouldUnregister?fr(d,Be,[]):[])),Pt=(Be,ut,St={})=>{const dr=fr(a,Be);let or=ut;if(dr){const tr=dr._f;tr&&(!tr.disabled&&ui(y,Be,jV(ut,tr)),or=Gw(tr.ref)&&To(ut)?"":ut,kV(tr.ref)?[...tr.ref.options].forEach(Bt=>Bt.selected=or.includes(Bt.value)):tr.refs?n0(tr.ref)?tr.refs.length>1?tr.refs.forEach(Bt=>(!Bt.defaultChecked||!Bt.disabled)&&(Bt.checked=Array.isArray(or)?!!or.find(Or=>Or===Bt.value):or===Bt.value)):tr.refs[0]&&(tr.refs[0].checked=!!or):tr.refs.forEach(Bt=>Bt.checked=Bt.value===or):cI(tr.ref)?tr.ref.value="":(tr.ref.value=or,tr.ref.type||$.values.next({name:Be,values:{...y}})))}(St.shouldDirty||St.shouldTouch)&&it(Be,or,St.shouldTouch,St.shouldDirty,!0),St.shouldValidate&&Qt(Be)},Wt=(Be,ut,St)=>{for(const dr in ut){const or=ut[dr],tr=`${Be}.${dr}`,Bt=fr(a,tr);(s.array.has(Be)||ps(or)||Bt&&!Bt._f)&&!Cf(or)?Wt(tr,or,St):Pt(tr,or,St)}},Nt=(Be,ut,St={})=>{const dr=fr(a,Be),or=s.array.has(Be),tr=Go(ut);ui(y,Be,tr),or?($.array.next({name:Be,values:{...y}}),(O.isDirty||O.dirtyFields)&&St.shouldDirty&&$.state.next({name:Be,dirtyFields:ix(d,y),isDirty:Mt(Be,tr)})):dr&&!dr._f&&!To(tr)?Wt(Be,tr,St):Pt(Be,tr,St),FD(Be,s)&&$.state.next({...i}),$.values.next({name:S.mount?Be:void 0,values:{...y}})},Xe=async Be=>{S.mount=!0;const ut=Be.target;let St=ut.name,dr=!0;const or=fr(a,St),tr=()=>ut.type?aC(or._f):vV(Be),Bt=Or=>{dr=Number.isNaN(Or)||Cf(Or)&&isNaN(Or.getTime())||jd(Or,fr(y,St,Or))};if(or){let Or,Xn;const Bn=tr(),fi=Be.type===$w.BLUR||Be.type===$w.FOCUS_OUT,ms=!sle(or._f)&&!t.resolver&&!fr(i.errors,St)&&!or._f.deps||ole(fi,fr(i.touchedFields,St),i.isSubmitted,J,q),Es=FD(St,s,fi);ui(y,St,Bn),fi?(or._f.onBlur&&or._f.onBlur(Be),N&&N(0)):or._f.onChange&&or._f.onChange(Be);const ra=it(St,Bn,fi,!1),Pa=!qo(ra)||Es;if(!fi&&$.values.next({name:St,type:Be.type,values:{...y}}),ms)return O.isValid&&(e.mode==="onBlur"?fi&&ce():ce()),Pa&&$.state.next({name:St,...Es?{}:ra});if(!fi&&Es&&$.state.next({...i}),t.resolver){const{errors:co}=await ct([St]);if(Bt(Bn),dr){const na=HD(i.errors,a,St),Xi=HD(co,a,na.name||St);Or=Xi.error,St=Xi.name,Xn=qo(co)}}else le([St],!0),Or=(await GD(or,y,re,t.shouldUseNativeValidation))[St],le([St]),Bt(Bn),dr&&(Or?Xn=!1:O.isValid&&(Xn=await Ze(a,!0)));dr&&(or._f.deps&&Qt(or._f.deps),qe(St,Xn,Or,ra))}},nt=(Be,ut)=>{if(fr(i.errors,ut)&&Be.focus)return Be.focus(),1},Qt=async(Be,ut={})=>{let St,dr;const or=jx(Be);if(t.resolver){const tr=await pt(is(Be)?Be:or);St=qo(tr),dr=Be?!or.some(Bt=>fr(tr,Bt)):St}else Be?(dr=(await Promise.all(or.map(async tr=>{const Bt=fr(a,tr);return await Ze(Bt&&Bt._f?{[tr]:Bt}:Bt)}))).every(Boolean),!(!dr&&!i.isValid)&&ce()):dr=St=await Ze(a);return $.state.next({...!xc(Be)||O.isValid&&St!==i.isValid?{}:{name:Be},...t.resolver||!Be?{isValid:St}:{},errors:i.errors}),ut.shouldFocus&&!dr&&Dx(a,nt,Be?or:s.mount),dr},rr=Be=>{const ut={...S.mount?y:d};return is(Be)?ut:xc(Be)?fr(ut,Be):Be.map(St=>fr(ut,St))},mr=(Be,ut)=>({invalid:!!fr((ut||i).errors,Be),isDirty:!!fr((ut||i).dirtyFields,Be),error:fr((ut||i).errors,Be),isValidating:!!fr(i.validatingFields,Be),isTouched:!!fr((ut||i).touchedFields,Be)}),Ut=Be=>{Be&&jx(Be).forEach(ut=>Ns(i.errors,ut)),$.state.next({errors:Be?i.errors:{}})},hn=(Be,ut,St)=>{const dr=(fr(a,Be,{_f:{}})._f||{}).ref,or=fr(i.errors,Be)||{},{ref:tr,message:Bt,type:Or,...Xn}=or;ui(i.errors,Be,{...Xn,...ut,ref:dr}),$.state.next({name:Be,errors:i.errors,isValid:!1}),St&&St.shouldFocus&&dr&&dr.focus&&dr.focus()},Gn=(Be,ut)=>iu(Be)?$.values.subscribe({next:St=>Be(Jt(void 0,ut),St)}):Jt(Be,ut,!0),At=(Be,ut={})=>{for(const St of Be?jx(Be):s.mount)s.mount.delete(St),s.array.delete(St),ut.keepValue||(Ns(a,St),Ns(y,St)),!ut.keepError&&Ns(i.errors,St),!ut.keepDirty&&Ns(i.dirtyFields,St),!ut.keepTouched&&Ns(i.touchedFields,St),!ut.keepIsValidating&&Ns(i.validatingFields,St),!t.shouldUnregister&&!ut.keepDefaultValue&&Ns(d,St);$.values.next({values:{...y}}),$.state.next({...i,...ut.keepDirty?{isDirty:Mt()}:{}}),!ut.keepIsValid&&ce()},qt=({disabled:Be,name:ut,field:St,fields:dr,value:or})=>{if(Ua(Be)&&S.mount||Be){const tr=Be?void 0:is(or)?aC(St?St._f:fr(dr,ut)._f):or;ui(y,ut,tr),it(ut,tr,!1,!1,!0)}},Br=(Be,ut={})=>{let St=fr(a,Be);const dr=Ua(ut.disabled)||Ua(e.disabled);return ui(a,Be,{...St||{},_f:{...St&&St._f?St._f:{ref:{name:Be}},name:Be,mount:!0,...ut}}),s.mount.add(Be),St?qt({field:St,disabled:Ua(ut.disabled)?ut.disabled:e.disabled,name:Be,value:ut.value}):je(Be,!0,ut.value),{...dr?{disabled:ut.disabled||e.disabled}:{},...t.progressive?{required:!!ut.required,min:sx(ut.min),max:sx(ut.max),minLength:sx(ut.minLength),maxLength:sx(ut.maxLength),pattern:sx(ut.pattern)}:{},name:Be,onChange:Xe,onBlur:Xe,ref:or=>{if(or){Br(Be,ut),St=fr(a,Be);const tr=is(or.value)&&or.querySelectorAll&&or.querySelectorAll("input,select,textarea")[0]||or,Bt=rle(tr),Or=St._f.refs||[];if(Bt?Or.find(Xn=>Xn===tr):tr===St._f.ref)return;ui(a,Be,{_f:{...St._f,...Bt?{refs:[...Or.filter(oC),tr,...Array.isArray(fr(d,Be))?[{}]:[]],ref:{type:tr.type,name:Be}}:{ref:tr}}}),je(Be,!1,void 0,tr)}else St=fr(a,Be,{}),St._f&&(St._f.mount=!1),(t.shouldUnregister||ut.shouldUnregister)&&!(bV(s.array,Be)&&S.action)&&s.unMount.add(Be)}}},xn=()=>t.shouldFocusError&&Dx(a,nt,s.mount),de=Be=>{Ua(Be)&&($.state.next({disabled:Be}),Dx(a,(ut,St)=>{const dr=fr(a,St);dr&&(ut.disabled=dr._f.disabled||Be,Array.isArray(dr._f.refs)&&dr._f.refs.forEach(or=>{or.disabled=dr._f.disabled||Be}))},0,!1))},bn=(Be,ut)=>async St=>{let dr;St&&(St.preventDefault&&St.preventDefault(),St.persist&&St.persist());let or=Go(y);if($.state.next({isSubmitting:!0}),t.resolver){const{errors:tr,values:Bt}=await ct();i.errors=tr,or=Bt}else await Ze(a);if(Ns(i.errors,"root"),qo(i.errors)){$.state.next({errors:{}});try{await Be(or,St)}catch(tr){dr=tr}}else ut&&await ut({...i.errors},St),xn(),setTimeout(xn);if($.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:qo(i.errors)&&!dr,submitCount:i.submitCount+1,errors:i.errors}),dr)throw dr},pn=(Be,ut={})=>{fr(a,Be)&&(is(ut.defaultValue)?Nt(Be,Go(fr(d,Be))):(Nt(Be,ut.defaultValue),ui(d,Be,Go(ut.defaultValue))),ut.keepTouched||Ns(i.touchedFields,Be),ut.keepDirty||(Ns(i.dirtyFields,Be),i.isDirty=ut.defaultValue?Mt(Be,Go(fr(d,Be))):Mt()),ut.keepError||(Ns(i.errors,Be),O.isValid&&ce()),$.state.next({...i}))},hi=(Be,ut={})=>{const St=Be?Go(Be):d,dr=Go(St),or=qo(Be),tr=or?d:dr;if(ut.keepDefaultValues||(d=St),!ut.keepValues){if(ut.keepDirtyValues){const Bt=new Set([...s.mount,...Object.keys(ix(d,y))]);for(const Or of Array.from(Bt))fr(i.dirtyFields,Or)?ui(tr,Or,fr(y,Or)):Nt(Or,fr(tr,Or))}else{if(oI&&is(Be))for(const Bt of s.mount){const Or=fr(a,Bt);if(Or&&Or._f){const Xn=Array.isArray(Or._f.refs)?Or._f.refs[0]:Or._f.ref;if(Gw(Xn)){const Bn=Xn.closest("form");if(Bn){Bn.reset();break}}}}a={}}y=e.shouldUnregister?ut.keepDefaultValues?Go(d):{}:Go(tr),$.array.next({values:{...tr}}),$.values.next({values:{...tr}})}s={mount:ut.keepDirtyValues?s.mount:new Set,unMount:new Set,array:new Set,watch:new Set,watchAll:!1,focus:""},S.mount=!O.isValid||!!ut.keepIsValid||!!ut.keepDirtyValues,S.watch=!!e.shouldUnregister,$.state.next({submitCount:ut.keepSubmitCount?i.submitCount:0,isDirty:or?!1:ut.keepDirty?i.isDirty:!!(ut.keepDefaultValues&&!jd(Be,d)),isSubmitted:ut.keepIsSubmitted?i.isSubmitted:!1,dirtyFields:or?{}:ut.keepDirtyValues?ut.keepDefaultValues&&y?ix(d,y):i.dirtyFields:ut.keepDefaultValues&&Be?ix(d,Be):ut.keepDirty?i.dirtyFields:{},touchedFields:ut.keepTouched?i.touchedFields:{},errors:ut.keepErrors?i.errors:{},isSubmitSuccessful:ut.keepIsSubmitSuccessful?i.isSubmitSuccessful:!1,isSubmitting:!1})},bt=(Be,ut)=>hi(iu(Be)?Be(y):Be,ut);return{control:{register:Br,unregister:At,getFieldState:mr,handleSubmit:bn,setError:hn,_executeSchema:ct,_getWatch:Jt,_getDirty:Mt,_updateValid:ce,_removeUnmounted:yt,_updateFieldArray:ae,_updateDisabledField:qt,_getFieldArray:jt,_reset:hi,_resetDefaultValues:()=>iu(t.defaultValues)&&t.defaultValues().then(Be=>{bt(Be,t.resetOptions),$.state.next({isLoading:!1})}),_updateFormState:Be=>{i={...i,...Be}},_disableForm:de,_subjects:$,_proxyFormState:O,_setErrors:Se,get _fields(){return a},get _formValues(){return y},get _state(){return S},set _state(Be){S=Be},get _defaultValues(){return d},get _names(){return s},set _names(Be){s=Be},get _formState(){return i},set _formState(Be){i=Be},get _options(){return t},set _options(Be){t={...t,...Be}}},trigger:Qt,register:Br,handleSubmit:bn,watch:Gn,setValue:Nt,getValues:rr,reset:bt,resetField:pn,clearErrors:Ut,unregister:At,setError:hn,setFocus:(Be,ut={})=>{const St=fr(a,Be),dr=St&&St._f;if(dr){const or=dr.refs?dr.refs[0]:dr.ref;or.focus&&(or.focus(),ut.shouldSelect&&or.select())}},getFieldState:mr}}function ule(e={}){const t=Gt.useRef(),i=Gt.useRef(),[a,d]=Gt.useState({isDirty:!1,isValidating:!1,isLoading:iu(e.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1,defaultValues:iu(e.defaultValues)?void 0:e.defaultValues});t.current||(t.current={...cle(e),formState:a});const y=t.current.control;return y._options=e,lI({subject:y._subjects.state,next:S=>{EV(S,y._proxyFormState,y._updateFormState,!0)&&d({...y._formState})}}),Gt.useEffect(()=>y._disableForm(e.disabled),[y,e.disabled]),Gt.useEffect(()=>{if(y._proxyFormState.isDirty){const S=y._getDirty();S!==a.isDirty&&y._subjects.state.next({isDirty:S})}},[y,a.isDirty]),Gt.useEffect(()=>{e.values&&!jd(e.values,i.current)?(y._reset(e.values,y._options.resetOptions),i.current=e.values,d(S=>({...S}))):y._resetDefaultValues()},[e.values,y]),Gt.useEffect(()=>{e.errors&&y._setErrors(e.errors)},[e.errors,y]),Gt.useEffect(()=>{y._state.mount||(y._updateValid(),y._state.mount=!0),y._state.watch&&(y._state.watch=!1,y._subjects.state.next({...y._formState})),y._removeUnmounted()}),Gt.useEffect(()=>{e.shouldUnregister&&y._subjects.values.next({values:y._getWatch()})},[e.shouldUnregister,y]),Gt.useEffect(()=>{t.current&&(t.current.watch=t.current.watch.bind({}))},[a]),t.current.formState=TV(a,y),t.current}const WD=(e,t,i)=>{if(e&&"reportValidity"in e){const a=fr(i,t);e.setCustomValidity(a&&a.message||""),e.reportValidity()}},DV=(e,t)=>{for(const i in t.fields){const a=t.fields[i];a&&a.ref&&"reportValidity"in a.ref?WD(a.ref,i,e):a.refs&&a.refs.forEach(d=>WD(d,i,e))}},dle=(e,t)=>{t.shouldUseNativeValidation&&DV(e,t);const i={};for(const a in e){const d=fr(t.fields,a),y=Object.assign(e[a]||{},{ref:d&&d.ref});if(hle(t.names||Object.keys(e),a)){const S=Object.assign({},fr(i,a));ui(S,"root",y),ui(i,a,S)}else ui(i,a,y)}return i},hle=(e,t)=>e.some(i=>i.startsWith(t+"."));var fle=function(e,t){for(var i={};e.length;){var a=e[0],d=a.code,y=a.message,S=a.path.join(".");if(!i[S])if("unionErrors"in a){var s=a.unionErrors[0].errors[0];i[S]={message:s.message,type:s.code}}else i[S]={message:y,type:d};if("unionErrors"in a&&a.unionErrors.forEach(function(O){return O.errors.forEach(function($){return e.push($)})}),t){var N=i[S].types,D=N&&N[a.code];i[S]=AV(S,t,i,d,D?[].concat(D,a.message):a.message)}e.shift()}return i},ple=function(e,t,i){return i===void 0&&(i={}),function(a,d,y){try{return Promise.resolve(function(S,s){try{var N=Promise.resolve(e[i.mode==="sync"?"parse":"parseAsync"](a,t)).then(function(D){return y.shouldUseNativeValidation&&DV({},y),{errors:{},values:i.raw?a:D}})}catch(D){return s(D)}return N&&N.then?N.then(void 0,s):N}(0,function(S){if(function(s){return Array.isArray(s==null?void 0:s.errors)}(S))return{values:{},errors:dle(fle(S.errors,!y.shouldUseNativeValidation&&y.criteriaMode==="all"),y)};throw S}))}catch(S){return Promise.reject(S)}}};const mle=Zae,LV=H.createContext({}),Eb=({...e})=>f.jsx(LV.Provider,{value:{name:e.name},children:f.jsx(Jae,{...e})}),X2=()=>{const e=H.useContext(LV),t=H.useContext(OV),{getFieldState:i,formState:a}=Y2(),d=i(e.name,a);if(!e)throw new Error("useFormField should be used within <FormField>");const{id:y}=t;return{id:y,name:e.name,formItemId:`${y}-form-item`,formDescriptionId:`${y}-form-item-description`,formMessageId:`${y}-form-item-message`,...d}},OV=H.createContext({}),gx=H.forwardRef(({className:e,...t},i)=>{const a=H.useId();return f.jsx(OV.Provider,{value:{id:a},children:f.jsx("div",{ref:i,className:br("space-y-2",e),...t})})});gx.displayName="FormItem";const _x=H.forwardRef(({className:e,...t},i)=>{const{error:a,formItemId:d}=X2();return f.jsx(rs,{ref:i,className:br(a&&"text-destructive",e),htmlFor:d,...t})});_x.displayName="FormLabel";const yx=H.forwardRef(({...e},t)=>{const{error:i,formItemId:a,formDescriptionId:d,formMessageId:y}=X2();return f.jsx(Tc,{ref:t,id:a,"aria-describedby":i?`${d} ${y}`:`${d}`,"aria-invalid":!!i,...e})});yx.displayName="FormControl";const gle=H.forwardRef(({className:e,...t},i)=>{const{formDescriptionId:a}=X2();return f.jsx("p",{ref:i,id:a,className:br("text-sm text-muted-foreground",e),...t})});gle.displayName="FormDescription";const xx=H.forwardRef(({className:e,children:t,...i},a)=>{const{error:d,formMessageId:y}=X2(),S=d?String(d==null?void 0:d.message):t;return S?f.jsx("p",{ref:a,id:y,className:br("text-sm font-medium text-destructive",e),...i,children:S}):null});xx.displayName="FormMessage";function _le(e,t){return H.useReducer((i,a)=>t[i][a]??i,e)}var dI="ScrollArea",[zV,Lce]=ta(dI),[yle,Ja]=zV(dI),FV=H.forwardRef((e,t)=>{const{__scopeScrollArea:i,type:a="hover",dir:d,scrollHideDelay:y=600,...S}=e,[s,N]=H.useState(null),[D,O]=H.useState(null),[$,q]=H.useState(null),[J,re]=H.useState(null),[Q,ce]=H.useState(null),[le,ae]=H.useState(0),[he,Se]=H.useState(0),[je,it]=H.useState(!1),[qe,ct]=H.useState(!1),pt=dn(t,yt=>N(yt)),Ze=Qf(d);return f.jsx(yle,{scope:i,type:a,dir:Ze,scrollHideDelay:y,scrollArea:s,viewport:D,onViewportChange:O,content:$,onContentChange:q,scrollbarX:J,onScrollbarXChange:re,scrollbarXEnabled:je,onScrollbarXEnabledChange:it,scrollbarY:Q,onScrollbarYChange:ce,scrollbarYEnabled:qe,onScrollbarYEnabledChange:ct,onCornerWidthChange:ae,onCornerHeightChange:Se,children:f.jsx(wr.div,{dir:Ze,...S,ref:pt,style:{position:"relative","--radix-scroll-area-corner-width":le+"px","--radix-scroll-area-corner-height":he+"px",...e.style}})})});FV.displayName=dI;var BV="ScrollAreaViewport",VV=H.forwardRef((e,t)=>{const{__scopeScrollArea:i,children:a,asChild:d,nonce:y,...S}=e,s=Ja(BV,i),N=H.useRef(null),D=dn(t,N,s.onViewportChange);return f.jsxs(f.Fragment,{children:[f.jsx("style",{dangerouslySetInnerHTML:{__html:`
[data-radix-scroll-area-viewport] {
  scrollbar-width: none;
  -ms-overflow-style: none;
  -webkit-overflow-scrolling: touch;
}
[data-radix-scroll-area-viewport]::-webkit-scrollbar {
  display: none;
}
:where([data-radix-scroll-area-viewport]) {
  display: flex;
  flex-direction: column;
  align-items: stretch;
}
:where([data-radix-scroll-area-content]) {
  flex-grow: 1;
}
`},nonce:y}),f.jsx(wr.div,{"data-radix-scroll-area-viewport":"",...S,asChild:d,ref:D,style:{overflowX:s.scrollbarXEnabled?"scroll":"hidden",overflowY:s.scrollbarYEnabled?"scroll":"hidden",...e.style},children:Ale({asChild:d,children:a},O=>f.jsx("div",{"data-radix-scroll-area-content":"",ref:s.onContentChange,style:{minWidth:s.scrollbarXEnabled?"fit-content":void 0},children:O}))})]})});VV.displayName=BV;var kc="ScrollAreaScrollbar",hI=H.forwardRef((e,t)=>{const{forceMount:i,...a}=e,d=Ja(kc,e.__scopeScrollArea),{onScrollbarXEnabledChange:y,onScrollbarYEnabledChange:S}=d,s=e.orientation==="horizontal";return H.useEffect(()=>(s?y(!0):S(!0),()=>{s?y(!1):S(!1)}),[s,y,S]),d.type==="hover"?f.jsx(xle,{...a,ref:t,forceMount:i}):d.type==="scroll"?f.jsx(vle,{...a,ref:t,forceMount:i}):d.type==="auto"?f.jsx(UV,{...a,ref:t,forceMount:i}):d.type==="always"?f.jsx(fI,{...a,ref:t}):null});hI.displayName=kc;var xle=H.forwardRef((e,t)=>{const{forceMount:i,...a}=e,d=Ja(kc,e.__scopeScrollArea),[y,S]=H.useState(!1);return H.useEffect(()=>{const s=d.scrollArea;let N=0;if(s){const D=()=>{window.clearTimeout(N),S(!0)},O=()=>{N=window.setTimeout(()=>S(!1),d.scrollHideDelay)};return s.addEventListener("pointerenter",D),s.addEventListener("pointerleave",O),()=>{window.clearTimeout(N),s.removeEventListener("pointerenter",D),s.removeEventListener("pointerleave",O)}}},[d.scrollArea,d.scrollHideDelay]),f.jsx(Yi,{present:i||y,children:f.jsx(UV,{"data-state":y?"visible":"hidden",...a,ref:t})})}),vle=H.forwardRef((e,t)=>{const{forceMount:i,...a}=e,d=Ja(kc,e.__scopeScrollArea),y=e.orientation==="horizontal",S=J2(()=>N("SCROLL_END"),100),[s,N]=_le("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return H.useEffect(()=>{if(s==="idle"){const D=window.setTimeout(()=>N("HIDE"),d.scrollHideDelay);return()=>window.clearTimeout(D)}},[s,d.scrollHideDelay,N]),H.useEffect(()=>{const D=d.viewport,O=y?"scrollLeft":"scrollTop";if(D){let $=D[O];const q=()=>{const J=D[O];$!==J&&(N("SCROLL"),S()),$=J};return D.addEventListener("scroll",q),()=>D.removeEventListener("scroll",q)}},[d.viewport,y,N,S]),f.jsx(Yi,{present:i||s!=="hidden",children:f.jsx(fI,{"data-state":s==="hidden"?"hidden":"visible",...a,ref:t,onPointerEnter:Ht(e.onPointerEnter,()=>N("POINTER_ENTER")),onPointerLeave:Ht(e.onPointerLeave,()=>N("POINTER_LEAVE"))})})}),UV=H.forwardRef((e,t)=>{const i=Ja(kc,e.__scopeScrollArea),{forceMount:a,...d}=e,[y,S]=H.useState(!1),s=e.orientation==="horizontal",N=J2(()=>{if(i.viewport){const D=i.viewport.offsetWidth<i.viewport.scrollWidth,O=i.viewport.offsetHeight<i.viewport.scrollHeight;S(s?D:O)}},10);return kg(i.viewport,N),kg(i.content,N),f.jsx(Yi,{present:a||y,children:f.jsx(fI,{"data-state":y?"visible":"hidden",...d,ref:t})})}),fI=H.forwardRef((e,t)=>{const{orientation:i="vertical",...a}=e,d=Ja(kc,e.__scopeScrollArea),y=H.useRef(null),S=H.useRef(0),[s,N]=H.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),D=WV(s.viewport,s.content),O={...a,sizes:s,onSizesChange:N,hasThumb:D>0&&D<1,onThumbChange:q=>y.current=q,onThumbPointerUp:()=>S.current=0,onThumbPointerDown:q=>S.current=q};function $(q,J){return Cle(q,S.current,s,J)}return i==="horizontal"?f.jsx(ble,{...O,ref:t,onThumbPositionChange:()=>{if(d.viewport&&y.current){const q=d.viewport.scrollLeft,J=ZD(q,s,d.dir);y.current.style.transform=`translate3d(${J}px, 0, 0)`}},onWheelScroll:q=>{d.viewport&&(d.viewport.scrollLeft=q)},onDragScroll:q=>{d.viewport&&(d.viewport.scrollLeft=$(q,d.dir))}}):i==="vertical"?f.jsx(wle,{...O,ref:t,onThumbPositionChange:()=>{if(d.viewport&&y.current){const q=d.viewport.scrollTop,J=ZD(q,s);y.current.style.transform=`translate3d(0, ${J}px, 0)`}},onWheelScroll:q=>{d.viewport&&(d.viewport.scrollTop=q)},onDragScroll:q=>{d.viewport&&(d.viewport.scrollTop=$(q))}}):null}),ble=H.forwardRef((e,t)=>{const{sizes:i,onSizesChange:a,...d}=e,y=Ja(kc,e.__scopeScrollArea),[S,s]=H.useState(),N=H.useRef(null),D=dn(t,N,y.onScrollbarXChange);return H.useEffect(()=>{N.current&&s(getComputedStyle(N.current))},[N]),f.jsx(GV,{"data-orientation":"horizontal",...d,ref:D,sizes:i,style:{bottom:0,left:y.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:y.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":K2(i)+"px",...e.style},onThumbPointerDown:O=>e.onThumbPointerDown(O.x),onDragScroll:O=>e.onDragScroll(O.x),onWheelScroll:(O,$)=>{if(y.viewport){const q=y.viewport.scrollLeft+O.deltaX;e.onWheelScroll(q),YV(q,$)&&O.preventDefault()}},onResize:()=>{N.current&&y.viewport&&S&&a({content:y.viewport.scrollWidth,viewport:y.viewport.offsetWidth,scrollbar:{size:N.current.clientWidth,paddingStart:Zw(S.paddingLeft),paddingEnd:Zw(S.paddingRight)}})}})}),wle=H.forwardRef((e,t)=>{const{sizes:i,onSizesChange:a,...d}=e,y=Ja(kc,e.__scopeScrollArea),[S,s]=H.useState(),N=H.useRef(null),D=dn(t,N,y.onScrollbarYChange);return H.useEffect(()=>{N.current&&s(getComputedStyle(N.current))},[N]),f.jsx(GV,{"data-orientation":"vertical",...d,ref:D,sizes:i,style:{top:0,right:y.dir==="ltr"?0:void 0,left:y.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":K2(i)+"px",...e.style},onThumbPointerDown:O=>e.onThumbPointerDown(O.y),onDragScroll:O=>e.onDragScroll(O.y),onWheelScroll:(O,$)=>{if(y.viewport){const q=y.viewport.scrollTop+O.deltaY;e.onWheelScroll(q),YV(q,$)&&O.preventDefault()}},onResize:()=>{N.current&&y.viewport&&S&&a({content:y.viewport.scrollHeight,viewport:y.viewport.offsetHeight,scrollbar:{size:N.current.clientHeight,paddingStart:Zw(S.paddingTop),paddingEnd:Zw(S.paddingBottom)}})}})}),[Sle,$V]=zV(kc),GV=H.forwardRef((e,t)=>{const{__scopeScrollArea:i,sizes:a,hasThumb:d,onThumbChange:y,onThumbPointerUp:S,onThumbPointerDown:s,onThumbPositionChange:N,onDragScroll:D,onWheelScroll:O,onResize:$,...q}=e,J=Ja(kc,i),[re,Q]=H.useState(null),ce=dn(t,pt=>Q(pt)),le=H.useRef(null),ae=H.useRef(""),he=J.viewport,Se=a.content-a.viewport,je=oi(O),it=oi(N),qe=J2($,10);function ct(pt){if(le.current){const Ze=pt.clientX-le.current.left,yt=pt.clientY-le.current.top;D({x:Ze,y:yt})}}return H.useEffect(()=>{const pt=Ze=>{const yt=Ze.target;(re==null?void 0:re.contains(yt))&&je(Ze,Se)};return document.addEventListener("wheel",pt,{passive:!1}),()=>document.removeEventListener("wheel",pt,{passive:!1})},[he,re,Se,je]),H.useEffect(it,[a,it]),kg(re,qe),kg(J.content,qe),f.jsx(Sle,{scope:i,scrollbar:re,hasThumb:d,onThumbChange:oi(y),onThumbPointerUp:oi(S),onThumbPositionChange:it,onThumbPointerDown:oi(s),children:f.jsx(wr.div,{...q,ref:ce,style:{position:"absolute",...q.style},onPointerDown:Ht(e.onPointerDown,pt=>{pt.button===0&&(pt.target.setPointerCapture(pt.pointerId),le.current=re.getBoundingClientRect(),ae.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",J.viewport&&(J.viewport.style.scrollBehavior="auto"),ct(pt))}),onPointerMove:Ht(e.onPointerMove,ct),onPointerUp:Ht(e.onPointerUp,pt=>{const Ze=pt.target;Ze.hasPointerCapture(pt.pointerId)&&Ze.releasePointerCapture(pt.pointerId),document.body.style.webkitUserSelect=ae.current,J.viewport&&(J.viewport.style.scrollBehavior=""),le.current=null})})})}),Ww="ScrollAreaThumb",qV=H.forwardRef((e,t)=>{const{forceMount:i,...a}=e,d=$V(Ww,e.__scopeScrollArea);return f.jsx(Yi,{present:i||d.hasThumb,children:f.jsx(Tle,{ref:t,...a})})}),Tle=H.forwardRef((e,t)=>{const{__scopeScrollArea:i,style:a,...d}=e,y=Ja(Ww,i),S=$V(Ww,i),{onThumbPositionChange:s}=S,N=dn(t,$=>S.onThumbChange($)),D=H.useRef(),O=J2(()=>{D.current&&(D.current(),D.current=void 0)},100);return H.useEffect(()=>{const $=y.viewport;if($){const q=()=>{if(O(),!D.current){const J=Mle($,s);D.current=J,s()}};return s(),$.addEventListener("scroll",q),()=>$.removeEventListener("scroll",q)}},[y.viewport,O,s]),f.jsx(wr.div,{"data-state":S.hasThumb?"visible":"hidden",...d,ref:N,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...a},onPointerDownCapture:Ht(e.onPointerDownCapture,$=>{const J=$.target.getBoundingClientRect(),re=$.clientX-J.left,Q=$.clientY-J.top;S.onThumbPointerDown({x:re,y:Q})}),onPointerUp:Ht(e.onPointerUp,S.onThumbPointerUp)})});qV.displayName=Ww;var pI="ScrollAreaCorner",HV=H.forwardRef((e,t)=>{const i=Ja(pI,e.__scopeScrollArea),a=!!(i.scrollbarX&&i.scrollbarY);return i.type!=="scroll"&&a?f.jsx(Ele,{...e,ref:t}):null});HV.displayName=pI;var Ele=H.forwardRef((e,t)=>{const{__scopeScrollArea:i,...a}=e,d=Ja(pI,i),[y,S]=H.useState(0),[s,N]=H.useState(0),D=!!(y&&s);return kg(d.scrollbarX,()=>{var $;const O=(($=d.scrollbarX)==null?void 0:$.offsetHeight)||0;d.onCornerHeightChange(O),N(O)}),kg(d.scrollbarY,()=>{var $;const O=(($=d.scrollbarY)==null?void 0:$.offsetWidth)||0;d.onCornerWidthChange(O),S(O)}),D?f.jsx(wr.div,{...a,ref:t,style:{width:y,height:s,position:"absolute",right:d.dir==="ltr"?0:void 0,left:d.dir==="rtl"?0:void 0,bottom:0,...e.style}}):null});function Zw(e){return e?parseInt(e,10):0}function WV(e,t){const i=e/t;return isNaN(i)?0:i}function K2(e){const t=WV(e.viewport,e.content),i=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,a=(e.scrollbar.size-i)*t;return Math.max(a,18)}function Cle(e,t,i,a="ltr"){const d=K2(i),y=d/2,S=t||y,s=d-S,N=i.scrollbar.paddingStart+S,D=i.scrollbar.size-i.scrollbar.paddingEnd-s,O=i.content-i.viewport,$=a==="ltr"?[0,O]:[O*-1,0];return ZV([N,D],$)(e)}function ZD(e,t,i="ltr"){const a=K2(t),d=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,y=t.scrollbar.size-d,S=t.content-t.viewport,s=y-a,N=i==="ltr"?[0,S]:[S*-1,0],D=RM(e,N);return ZV([0,S],[0,s])(D)}function ZV(e,t){return i=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const a=(t[1]-t[0])/(e[1]-e[0]);return t[0]+a*(i-e[0])}}function YV(e,t){return e>0&&e<t}var Mle=(e,t=()=>{})=>{let i={left:e.scrollLeft,top:e.scrollTop},a=0;return function d(){const y={left:e.scrollLeft,top:e.scrollTop},S=i.left!==y.left,s=i.top!==y.top;(S||s)&&t(),i=y,a=window.requestAnimationFrame(d)}(),()=>window.cancelAnimationFrame(a)};function J2(e,t){const i=oi(e),a=H.useRef(0);return H.useEffect(()=>()=>window.clearTimeout(a.current),[]),H.useCallback(()=>{window.clearTimeout(a.current),a.current=window.setTimeout(i,t)},[i,t])}function kg(e,t){const i=oi(t);ss(()=>{let a=0;if(e){const d=new ResizeObserver(()=>{cancelAnimationFrame(a),a=window.requestAnimationFrame(i)});return d.observe(e),()=>{window.cancelAnimationFrame(a),d.unobserve(e)}}},[e,i])}function Ale(e,t){const{asChild:i,children:a}=e;if(!i)return typeof t=="function"?t(a):t;const d=H.Children.only(a);return H.cloneElement(d,{children:typeof t=="function"?t(d.props.children):t})}var XV=FV,Ple=VV,Ile=HV;const KV=H.forwardRef(({className:e,children:t,...i},a)=>f.jsxs(XV,{ref:a,className:br("relative overflow-hidden",e),...i,children:[f.jsx(Ple,{className:"h-full w-full rounded-[inherit]",children:t}),f.jsx(JV,{}),f.jsx(Ile,{})]}));KV.displayName=XV.displayName;const JV=H.forwardRef(({className:e,orientation:t="vertical",...i},a)=>f.jsx(hI,{ref:a,orientation:t,className:br("flex touch-none select-none transition-colors",t==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",t==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...i,children:f.jsx(qV,{className:"relative flex-1 rounded-full bg-border"})}));JV.displayName=hI.displayName;var mI="Avatar",[kle,Oce]=ta(mI),[Nle,QV]=kle(mI),eU=H.forwardRef((e,t)=>{const{__scopeAvatar:i,...a}=e,[d,y]=H.useState("idle");return f.jsx(Nle,{scope:i,imageLoadingStatus:d,onImageLoadingStatusChange:y,children:f.jsx(wr.span,{...a,ref:t})})});eU.displayName=mI;var tU="AvatarImage",rU=H.forwardRef((e,t)=>{const{__scopeAvatar:i,src:a,onLoadingStatusChange:d=()=>{},...y}=e,S=QV(tU,i),s=Rle(a,y.referrerPolicy),N=oi(D=>{d(D),S.onImageLoadingStatusChange(D)});return ss(()=>{s!=="idle"&&N(s)},[s,N]),s==="loaded"?f.jsx(wr.img,{...y,ref:t,src:a}):null});rU.displayName=tU;var nU="AvatarFallback",iU=H.forwardRef((e,t)=>{const{__scopeAvatar:i,delayMs:a,...d}=e,y=QV(nU,i),[S,s]=H.useState(a===void 0);return H.useEffect(()=>{if(a!==void 0){const N=window.setTimeout(()=>s(!0),a);return()=>window.clearTimeout(N)}},[a]),S&&y.imageLoadingStatus!=="loaded"?f.jsx(wr.span,{...d,ref:t}):null});iU.displayName=nU;function Rle(e,t){const[i,a]=H.useState("idle");return ss(()=>{if(!e){a("error");return}let d=!0;const y=new window.Image,S=s=>()=>{d&&a(s)};return a("loading"),y.onload=S("loaded"),y.onerror=S("error"),y.src=e,t&&(y.referrerPolicy=t),()=>{d=!1}},[e,t]),i}var sU=eU,oU=rU,aU=iU;const Av=H.forwardRef(({className:e,...t},i)=>f.jsx(sU,{ref:i,className:br("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",e),...t}));Av.displayName=sU.displayName;const gI=H.forwardRef(({className:e,...t},i)=>f.jsx(oU,{ref:i,className:br("aspect-square h-full w-full",e),...t}));gI.displayName=oU.displayName;const Pv=H.forwardRef(({className:e,...t},i)=>f.jsx(aU,{ref:i,className:br("flex h-full w-full items-center justify-center rounded-full bg-muted",e),...t}));Pv.displayName=aU.displayName;const jle="https://geeuxuskzdnpcuirrkqv.supabase.co",Dle="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdlZXV4dXNremRucGN1aXJya3F2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY1MzQ2ODAsImV4cCI6MjA2MjExMDY4MH0.YS4Kjb_cxMq7IjUG_UVU7GE0rQF0A09stuWbPhPhqDg",Lle=uB(jle,Dle),_I=({className:e=""})=>{const[t,i]=H.useState([{id:"welcome",role:"assistant",content:"Hi there! I'm John, your SwapSpot AI assistant! 🏠✨ I'm here to help you with anything about student accommodation swaps. Whether you need help creating a listing, finding matches, or understanding how our platform works, just ask me!",timestamp:new Date}]),[a,d]=H.useState(""),[y,S]=H.useState(!1),s=H.useRef(null);H.useEffect(()=>{s.current&&(s.current.scrollTop=s.current.scrollHeight)},[t]);const N=async()=>{if(!a.trim()||y)return;const O={id:Date.now().toString(),role:"user",content:a.trim(),timestamp:new Date};i($=>[...$,O]),d(""),S(!0);try{const $=t.map(Q=>({role:Q.role,content:Q.content})),{data:q,error:J}=await Lle.functions.invoke("pubert-chat",{body:{message:O.content,conversationHistory:$}});if(J)throw J;const re={id:(Date.now()+1).toString(),role:"assistant",content:q.reply,timestamp:new Date};i(Q=>[...Q,re])}catch($){console.error("Error sending message to John:",$),di.error("Sorry, I couldn't process your message. Please try again.");const q={id:(Date.now()+1).toString(),role:"assistant",content:"Oops! I seem to be having some technical difficulties. Please try again in a moment, or contact our support team if the issue persists.",timestamp:new Date};i(J=>[...J,q])}finally{S(!1)}},D=O=>{O.key==="Enter"&&!O.shiftKey&&(O.preventDefault(),N())};return f.jsxs(Zr,{className:`flex flex-col h-[600px] ${e}`,children:[f.jsx(zn,{className:"flex-shrink-0",children:f.jsxs(Fn,{className:"flex items-center gap-2",children:[f.jsx(Ix,{className:"h-5 w-5 text-swap-blue"}),"Chat with John"]})}),f.jsxs(Kr,{className:"flex-grow flex flex-col p-0",children:[f.jsx(KV,{className:"flex-grow px-6",ref:s,children:f.jsxs("div",{className:"space-y-4 pb-4",children:[t.map(O=>f.jsxs("div",{className:`flex items-start gap-3 ${O.role==="user"?"flex-row-reverse":"flex-row"}`,children:[f.jsx(Av,{className:"h-8 w-8",children:f.jsx(Pv,{children:O.role==="user"?f.jsx(K4,{className:"h-4 w-4"}):f.jsx(Ix,{className:"h-4 w-4"})})}),f.jsxs("div",{className:`max-w-[80%] rounded-lg p-3 ${O.role==="user"?"bg-swap-blue text-white ml-auto":"bg-gray-100 text-gray-900"}`,children:[f.jsx("p",{className:"text-sm whitespace-pre-wrap",children:O.content}),f.jsx("p",{className:"text-xs mt-1 opacity-70",children:O.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]},O.id)),y&&f.jsxs("div",{className:"flex items-start gap-3",children:[f.jsx(Av,{className:"h-8 w-8",children:f.jsx(Pv,{children:f.jsx(Ix,{className:"h-4 w-4"})})}),f.jsx("div",{className:"bg-gray-100 rounded-lg p-3",children:f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx(Bf,{className:"h-4 w-4 animate-spin"}),f.jsx("span",{className:"text-sm text-gray-600",children:"John is typing..."})]})})]})]})}),f.jsx("div",{className:"flex-shrink-0 p-6 border-t",children:f.jsxs("div",{className:"flex gap-2",children:[f.jsx(Pn,{value:a,onChange:O=>d(O.target.value),onKeyPress:D,placeholder:"Ask John anything about SwapSpot...",disabled:y,className:"flex-grow"}),f.jsx(Kt,{onClick:N,disabled:!a.trim()||y,className:"flex-shrink-0",children:y?f.jsx(Bf,{className:"h-4 w-4 animate-spin"}):f.jsx(Y4,{className:"h-4 w-4"})})]})})]})]})},Ole=nx.object({name:nx.string().min(2,{message:"Name must be at least 2 characters"}),email:nx.string().email({message:"Please enter a valid email address"}),subject:nx.string().min(1,{message:"Please select a subject"}),message:nx.string().min(10,{message:"Message must be at least 10 characters"})}),zle=()=>{const[e,t]=H.useState(!1),i=ule({resolver:ple(Ole),defaultValues:{name:"",email:"",subject:"",message:""}});function a(d){console.log(d),di.success("Support request submitted",{description:"We'll get back to you as soon as possible."}),i.reset()}return f.jsxs("div",{className:"min-h-screen flex flex-col",children:[f.jsx(gi,{}),f.jsxs("main",{className:"flex-grow",children:[f.jsx("section",{className:"bg-swap-blue py-20",children:f.jsxs("div",{className:"max-w-7xl mx-auto px-4 md:px-8 text-center",children:[f.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-white mb-6",children:"We're Here to Help"}),f.jsx("p",{className:"text-xl text-white/90 max-w-3xl mx-auto",children:"Get the support you need for a smooth accommodation exchange"})]})}),f.jsx("section",{className:"py-16 bg-white",children:f.jsxs("div",{className:"max-w-7xl mx-auto px-4 md:px-8",children:[f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-8 mb-16",children:[f.jsxs("div",{className:"bg-gray-50 p-8 rounded-lg text-center",children:[f.jsx("div",{className:"flex justify-center mb-4",children:f.jsx("div",{className:"bg-swap-lightBlue p-3 rounded-full",children:f.jsx(Ix,{className:"h-6 w-6 text-swap-blue"})})}),f.jsx("h2",{className:"text-xl font-semibold mb-2",children:"AI Assistant"}),f.jsx("p",{className:"text-gray-600 mb-4",children:"Chat with John, our AI assistant, for instant help and guidance."}),f.jsxs(Wg,{open:e,onOpenChange:t,children:[f.jsx(t0,{asChild:!0,children:f.jsx(Kt,{variant:"outline",children:"Chat with John"})}),f.jsxs(np,{className:"max-w-4xl h-[80vh] p-0",children:[f.jsx(ip,{className:"p-6 pb-0",children:f.jsx(sp,{children:"Chat with John - AI Assistant"})}),f.jsx("div",{className:"flex-grow p-6 pt-0",children:f.jsx(_I,{className:"h-full"})})]})]})]}),f.jsxs("div",{className:"bg-gray-50 p-8 rounded-lg text-center",children:[f.jsx("div",{className:"flex justify-center mb-4",children:f.jsx("div",{className:"bg-swap-lightBlue p-3 rounded-full",children:f.jsx(vg,{className:"h-6 w-6 text-swap-blue"})})}),f.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Chat Support"}),f.jsx("p",{className:"text-gray-600 mb-4",children:"Chat with our support team for quick answers to common questions."}),f.jsx(Kt,{variant:"outline",children:"Start Chat"})]}),f.jsxs("div",{className:"bg-gray-50 p-8 rounded-lg text-center",children:[f.jsx("div",{className:"flex justify-center mb-4",children:f.jsx("div",{className:"bg-swap-lightBlue p-3 rounded-full",children:f.jsx(Vf,{className:"h-6 w-6 text-swap-blue"})})}),f.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Email Support"}),f.jsx("p",{className:"text-gray-600 mb-4",children:"Send us a message and we'll respond within 24 hours."}),f.jsx(Kt,{variant:"outline",asChild:!0,children:f.jsx("a",{href:"mailto:hello@swapspot.com",children:"Email Us"})})]}),f.jsxs("div",{className:"bg-gray-50 p-8 rounded-lg text-center",children:[f.jsx("div",{className:"flex justify-center mb-4",children:f.jsx("div",{className:"bg-swap-lightBlue p-3 rounded-full",children:f.jsx(sW,{className:"h-6 w-6 text-swap-blue"})})}),f.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Help Center"}),f.jsx("p",{className:"text-gray-600 mb-4",children:"Browse our knowledge base for tutorials and guides."}),f.jsx(Kt,{variant:"outline",children:"Visit Help Center"})]})]}),f.jsxs("div",{className:"max-w-2xl mx-auto",children:[f.jsx("h2",{className:"text-2xl font-bold mb-6 text-center",children:"Contact Us"}),f.jsx(mle,{...i,children:f.jsxs("form",{onSubmit:i.handleSubmit(a),className:"space-y-6",children:[f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[f.jsx(Eb,{control:i.control,name:"name",render:({field:d})=>f.jsxs(gx,{children:[f.jsx(_x,{children:"Name"}),f.jsx(yx,{children:f.jsx(Pn,{placeholder:"Your name",...d})}),f.jsx(xx,{})]})}),f.jsx(Eb,{control:i.control,name:"email",render:({field:d})=>f.jsxs(gx,{children:[f.jsx(_x,{children:"Email"}),f.jsx(yx,{children:f.jsx(Pn,{type:"email",placeholder:"Your email",...d})}),f.jsx(xx,{})]})})]}),f.jsx(Eb,{control:i.control,name:"subject",render:({field:d})=>f.jsxs(gx,{children:[f.jsx(_x,{children:"Subject"}),f.jsxs(Jd,{onValueChange:d.onChange,defaultValue:d.value,children:[f.jsx(yx,{children:f.jsx(ou,{children:f.jsx(Qd,{placeholder:"Select a topic"})})}),f.jsxs(au,{children:[f.jsx(hs,{value:"general",children:"General Question"}),f.jsx(hs,{value:"technical",children:"Technical Support"}),f.jsx(hs,{value:"account",children:"Account Issues"}),f.jsx(hs,{value:"swap",children:"Swap Problems"}),f.jsx(hs,{value:"feedback",children:"Feedback or Suggestions"})]})]}),f.jsx(xx,{})]})}),f.jsx(Eb,{control:i.control,name:"message",render:({field:d})=>f.jsxs(gx,{children:[f.jsx(_x,{children:"Message"}),f.jsx(yx,{children:f.jsx(fv,{placeholder:"How can we help you?",className:"min-h-[120px]",...d})}),f.jsx(xx,{})]})}),f.jsx(Kt,{type:"submit",className:"w-full",children:"Send Message"})]})})]})]})})]}),f.jsx(_i,{})]})},Fle=({data:e,onUpdate:t,onNext:i,canGoNext:a})=>{const d=["University of Amsterdam","Sorbonne University","Heidelberg University","Cambridge University","Oxford University","Politecnico di Milano","Technical University of Berlin","Uppsala University","Complutense University of Madrid","IE University Madrid","Erasmus University Rotterdam","Harvard University","Stanford University","MIT","UC Berkeley","New York University","Other"],y=["Exchange Program - Computer Science","Exchange Program - Business Administration","Exchange Program - International Relations","Exchange Program - Engineering","Exchange Program - Medicine","Exchange Program - Law","Exchange Program - Economics","Exchange Program - Psychology","Exchange Program - Architecture","Exchange Program - Art & Design","Erasmus+ Exchange","Study Abroad Program","Other Exchange Program"],S=e.university&&e.program;return f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{className:"text-center mb-6",children:[f.jsxs("div",{className:"flex items-center justify-center gap-2 mb-3",children:[f.jsx(Kf,{className:"h-6 w-6 text-swap-blue"}),f.jsx("span",{className:"text-swap-blue font-semibold",children:"Exchange Student Information"})]}),f.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Tell us about your exchange studies"}),f.jsx("p",{className:"text-gray-600",children:"This helps us find the best matches for your study abroad experience and academic schedule"})]}),f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{children:[f.jsx(rs,{htmlFor:"university",children:"Your Home University"}),f.jsxs(Jd,{value:e.university,onValueChange:s=>t({university:s}),children:[f.jsx(ou,{children:f.jsx(Qd,{placeholder:"Select your home university"})}),f.jsx(au,{children:d.map(s=>f.jsx(hs,{value:s,children:s},s))})]}),f.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"The university you're currently enrolled at"})]}),f.jsxs("div",{children:[f.jsx(rs,{htmlFor:"program",children:"Exchange Program/Field of Study"}),f.jsxs(Jd,{value:e.program,onValueChange:s=>t({program:s}),children:[f.jsx(ou,{children:f.jsx(Qd,{placeholder:"Select your exchange program"})}),f.jsx(au,{children:y.map(s=>f.jsx(hs,{value:s,children:s},s))})]}),f.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Your field of study for the exchange program"})]})]}),f.jsx("div",{className:"flex justify-end",children:f.jsx(Kt,{onClick:i,disabled:!S||!a,className:"px-8",children:"Continue to Exchange Dates"})})]})},Ble=({data:e,onUpdate:t,onNext:i,onPrevious:a,canGoNext:d,canGoPrevious:y})=>{const S=(N,D)=>{t({preferredDates:{...e.preferredDates,[N]:D}})},s=e.preferredDates.startDate&&e.preferredDates.endDate;return f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{className:"text-center mb-6",children:[f.jsx(aW,{className:"h-12 w-12 text-swap-blue mx-auto mb-3"}),f.jsx("h3",{className:"text-lg font-semibold mb-2",children:"When do you want to swap?"}),f.jsx("p",{className:"text-gray-600",children:"Select your preferred exchange dates"})]}),f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{children:[f.jsx(rs,{htmlFor:"startDate",children:"Start Date"}),f.jsx(Pn,{id:"startDate",type:"date",value:e.preferredDates.startDate,onChange:N=>S("startDate",N.target.value),min:new Date().toISOString().split("T")[0]})]}),f.jsxs("div",{children:[f.jsx(rs,{htmlFor:"endDate",children:"End Date"}),f.jsx(Pn,{id:"endDate",type:"date",value:e.preferredDates.endDate,onChange:N=>S("endDate",N.target.value),min:e.preferredDates.startDate||new Date().toISOString().split("T")[0]})]}),s&&f.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:f.jsxs("p",{className:"text-sm text-blue-700",children:["Duration: ",Math.ceil((new Date(e.preferredDates.endDate).getTime()-new Date(e.preferredDates.startDate).getTime())/(1e3*60*60*24))," days"]})})]}),f.jsxs("div",{className:"flex justify-between",children:[f.jsx(Kt,{variant:"outline",onClick:a,disabled:!y,children:"Previous"}),f.jsx(Kt,{onClick:i,disabled:!s||!d,className:"px-8",children:"Continue"})]})]})},Vle=({data:e,onUpdate:t,onNext:i,onPrevious:a,canGoNext:d,canGoPrevious:y})=>{const S=H.useRef(null),s=O=>{const $=Array.from(O.target.files||[]),q=[...e.photos,...$].slice(0,6);t({photos:q})},N=O=>{const $=e.photos.filter((q,J)=>J!==O);t({photos:$})},D=e.photos.length>=1;return f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{className:"text-center mb-6",children:[f.jsx(cW,{className:"h-12 w-12 text-swap-blue mx-auto mb-3"}),f.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Show off your space"}),f.jsx("p",{className:"text-gray-600",children:"Upload photos of your room to attract potential swappers"})]}),f.jsxs("div",{className:"space-y-4",children:[f.jsxs(Zr,{className:"border-2 border-dashed border-gray-300 p-8 text-center cursor-pointer hover:border-swap-blue transition-colors",onClick:()=>{var O;return(O=S.current)==null?void 0:O.click()},children:[f.jsx(YA,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),f.jsx("p",{className:"text-gray-600 mb-1",children:"Click to upload photos"}),f.jsx("p",{className:"text-xs text-gray-500",children:"Max 6 photos, JPG or PNG"}),f.jsx("input",{ref:S,type:"file",multiple:!0,accept:"image/*",onChange:s,className:"hidden"})]}),e.photos.length>0&&f.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:e.photos.map((O,$)=>f.jsxs("div",{className:"relative group",children:[f.jsx("img",{src:URL.createObjectURL(O),alt:`Room photo ${$+1}`,className:"w-full h-32 object-cover rounded-lg"}),f.jsx(Kt,{size:"sm",variant:"destructive",className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity h-6 w-6 p-0",onClick:()=>N($),children:f.jsx(wc,{className:"h-3 w-3"})})]},$))}),e.photos.length>0&&f.jsxs("p",{className:"text-sm text-green-600 text-center",children:[e.photos.length," photo",e.photos.length!==1?"s":""," uploaded"]})]}),f.jsxs("div",{className:"flex justify-between",children:[f.jsx(Kt,{variant:"outline",onClick:a,disabled:!y,children:"Previous"}),f.jsx(Kt,{onClick:i,disabled:!D||!d,className:"px-8",children:"Continue"})]})]})};var yI="Radio",[Ule,lU]=ta(yI),[$le,Gle]=Ule(yI),cU=H.forwardRef((e,t)=>{const{__scopeRadio:i,name:a,checked:d=!1,required:y,disabled:S,value:s="on",onCheck:N,form:D,...O}=e,[$,q]=H.useState(null),J=dn(t,ce=>q(ce)),re=H.useRef(!1),Q=$?D||!!$.closest("form"):!0;return f.jsxs($le,{scope:i,checked:d,disabled:S,children:[f.jsx(wr.button,{type:"button",role:"radio","aria-checked":d,"data-state":hU(d),"data-disabled":S?"":void 0,disabled:S,value:s,...O,ref:J,onClick:Ht(e.onClick,ce=>{d||N==null||N(),Q&&(re.current=ce.isPropagationStopped(),re.current||ce.stopPropagation())})}),Q&&f.jsx(qle,{control:$,bubbles:!re.current,name:a,value:s,checked:d,required:y,disabled:S,form:D,style:{transform:"translateX(-100%)"}})]})});cU.displayName=yI;var uU="RadioIndicator",dU=H.forwardRef((e,t)=>{const{__scopeRadio:i,forceMount:a,...d}=e,y=Gle(uU,i);return f.jsx(Yi,{present:a||y.checked,children:f.jsx(wr.span,{"data-state":hU(y.checked),"data-disabled":y.disabled?"":void 0,...d,ref:t})})});dU.displayName=uU;var qle=e=>{const{control:t,checked:i,bubbles:a=!0,...d}=e,y=H.useRef(null),S=E2(i),s=iP(t);return H.useEffect(()=>{const N=y.current,D=window.HTMLInputElement.prototype,$=Object.getOwnPropertyDescriptor(D,"checked").set;if(S!==i&&$){const q=new Event("click",{bubbles:a});$.call(N,i),N.dispatchEvent(q)}},[S,i,a]),f.jsx("input",{type:"radio","aria-hidden":!0,defaultChecked:i,...d,tabIndex:-1,ref:y,style:{...e.style,...s,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function hU(e){return e?"checked":"unchecked"}var Hle=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],xI="RadioGroup",[Wle,zce]=ta(xI,[$g,lU]),fU=$g(),pU=lU(),[Zle,Yle]=Wle(xI),mU=H.forwardRef((e,t)=>{const{__scopeRadioGroup:i,name:a,defaultValue:d,value:y,required:S=!1,disabled:s=!1,orientation:N,dir:D,loop:O=!0,onValueChange:$,...q}=e,J=fU(i),re=Qf(D),[Q,ce]=Xa({prop:y,defaultProp:d,onChange:$});return f.jsx(Zle,{scope:i,name:a,required:S,disabled:s,value:Q,onValueChange:ce,children:f.jsx(vP,{asChild:!0,...J,orientation:N,dir:re,loop:O,children:f.jsx(wr.div,{role:"radiogroup","aria-required":S,"aria-orientation":N,"data-disabled":s?"":void 0,dir:re,...q,ref:t})})})});mU.displayName=xI;var gU="RadioGroupItem",_U=H.forwardRef((e,t)=>{const{__scopeRadioGroup:i,disabled:a,...d}=e,y=Yle(gU,i),S=y.disabled||a,s=fU(i),N=pU(i),D=H.useRef(null),O=dn(t,D),$=y.value===d.value,q=H.useRef(!1);return H.useEffect(()=>{const J=Q=>{Hle.includes(Q.key)&&(q.current=!0)},re=()=>q.current=!1;return document.addEventListener("keydown",J),document.addEventListener("keyup",re),()=>{document.removeEventListener("keydown",J),document.removeEventListener("keyup",re)}},[]),f.jsx(bP,{asChild:!0,...s,focusable:!S,active:$,children:f.jsx(cU,{disabled:S,required:y.required,checked:$,...N,...d,name:y.name,ref:O,onCheck:()=>y.onValueChange(d.value),onKeyDown:Ht(J=>{J.key==="Enter"&&J.preventDefault()}),onFocus:Ht(d.onFocus,()=>{var J;q.current&&((J=D.current)==null||J.click())})})})});_U.displayName=gU;var Xle="RadioGroupIndicator",yU=H.forwardRef((e,t)=>{const{__scopeRadioGroup:i,...a}=e,d=pU(i);return f.jsx(dU,{...d,...a,ref:t})});yU.displayName=Xle;var xU=mU,vU=_U,Kle=yU;const bU=H.forwardRef(({className:e,...t},i)=>f.jsx(xU,{className:br("grid gap-2",e),...t,ref:i}));bU.displayName=xU.displayName;const WM=H.forwardRef(({className:e,...t},i)=>f.jsx(vU,{ref:i,className:br("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),...t,children:f.jsx(Kle,{className:"flex items-center justify-center",children:f.jsx(H4,{className:"h-2.5 w-2.5 fill-current text-current"})})}));WM.displayName=vU.displayName;const Jle=({data:e,onUpdate:t,onNext:i,onPrevious:a,canGoNext:d,canGoPrevious:y})=>{const S=H.useRef(null),s=O=>{t({verificationMethod:O})},N=O=>{var q;const $=(q=O.target.files)==null?void 0:q[0];$&&t({verificationFile:$})},D=e.verificationMethod==="email"||e.verificationMethod==="id"&&e.verificationFile;return f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{className:"text-center mb-6",children:[f.jsx(Ao,{className:"h-12 w-12 text-swap-blue mx-auto mb-3"}),f.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Verify your student status"}),f.jsx("p",{className:"text-gray-600",children:"This helps build trust and ensures quality matches"})]}),f.jsxs(bU,{value:e.verificationMethod,onValueChange:s,className:"space-y-4",children:[f.jsx(Zr,{className:"p-4",children:f.jsxs("div",{className:"flex items-center space-x-3",children:[f.jsx(WM,{value:"email",id:"email"}),f.jsx(rs,{htmlFor:"email",className:"flex-1 cursor-pointer",children:f.jsxs("div",{className:"flex items-center space-x-3",children:[f.jsx(Vf,{className:"h-5 w-5 text-blue-500"}),f.jsxs("div",{children:[f.jsx("p",{className:"font-medium",children:"University Email Verification"}),f.jsx("p",{className:"text-sm text-gray-600",children:"We'll verify your .edu or university domain email"})]})]})})]})}),f.jsxs(Zr,{className:"p-4",children:[f.jsxs("div",{className:"flex items-center space-x-3",children:[f.jsx(WM,{value:"id",id:"id"}),f.jsx(rs,{htmlFor:"id",className:"flex-1 cursor-pointer",children:f.jsxs("div",{className:"flex items-center space-x-3",children:[f.jsx(W4,{className:"h-5 w-5 text-green-500"}),f.jsxs("div",{children:[f.jsx("p",{className:"font-medium",children:"Student ID Upload"}),f.jsx("p",{className:"text-sm text-gray-600",children:"Upload a photo of your student ID card"})]})]})})]}),e.verificationMethod==="id"&&f.jsxs("div",{className:"mt-4 pl-8",children:[f.jsxs(Kt,{variant:"outline",onClick:()=>{var O;return(O=S.current)==null?void 0:O.click()},className:"w-full",children:[f.jsx(YA,{className:"h-4 w-4 mr-2"}),e.verificationFile?"Change File":"Upload Student ID"]}),e.verificationFile&&f.jsxs("p",{className:"text-sm text-green-600 mt-2",children:["✓ ",e.verificationFile.name]}),f.jsx("input",{ref:S,type:"file",accept:"image/*,.pdf",onChange:N,className:"hidden"})]})]})]}),f.jsx("div",{className:"bg-yellow-50 border border-yellow-200 p-4 rounded-lg",children:f.jsxs("p",{className:"text-sm text-yellow-800",children:[f.jsx(Ao,{className:"h-4 w-4 inline mr-1"}),"Your information is secure and will only be used for verification purposes"]})}),f.jsxs("div",{className:"flex justify-between",children:[f.jsx(Kt,{variant:"outline",onClick:a,disabled:!y,children:"Previous"}),f.jsx(Kt,{onClick:i,disabled:!D||!d,className:"px-8",children:"Continue"})]})]})},Qle=({data:e,onPrevious:t,canGoPrevious:i})=>{const a=$l(),d=[{id:1,title:"Cozy Studio in City Center",location:"Amsterdam, Netherlands",university:"University of Amsterdam",dates:{start:"2025-09-01",end:"2025-12-15"},compatibility:95,rating:4.8,reviews:12,images:["/placeholder.svg"]},{id:2,title:"Shared Apartment Near Campus",location:"Berlin, Germany",university:"Technical University of Berlin",dates:{start:"2025-08-15",end:"2025-12-20"},compatibility:87,rating:4.6,reviews:8,images:["/placeholder.svg"]},{id:3,title:"Modern Room with Great Views",location:"Paris, France",university:"Sorbonne University",dates:{start:"2025-09-05",end:"2025-01-10"},compatibility:82,rating:4.9,reviews:15,images:["/placeholder.svg"]}],y=()=>{localStorage.setItem("onboardingComplete","true"),localStorage.setItem("userProfile",JSON.stringify(e)),a("/browse")};return f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{className:"text-center mb-6",children:[f.jsx("div",{className:"flex justify-center mb-3",children:f.jsx("div",{className:"bg-green-100 p-3 rounded-full",children:f.jsx(Rf,{className:"h-8 w-8 text-green-600"})})}),f.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Your First Matches!"}),f.jsx("p",{className:"text-gray-600",children:"Based on your preferences, here are some great swap opportunities"})]}),f.jsx("div",{className:"space-y-4",children:d.map(S=>f.jsx(Zr,{className:"hover:shadow-md transition-shadow",children:f.jsx(Kr,{className:"p-4",children:f.jsxs("div",{className:"flex gap-4",children:[f.jsx("img",{src:S.images[0],alt:S.title,className:"w-20 h-20 object-cover rounded-lg"}),f.jsxs("div",{className:"flex-1",children:[f.jsxs("div",{className:"flex justify-between items-start mb-2",children:[f.jsx("h4",{className:"font-semibold",children:S.title}),f.jsx(R2,{compatibility:S.compatibility,variant:"compact"})]}),f.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx(Ec,{className:"h-3 w-3"}),S.location]}),f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx(Qo,{className:"h-3 w-3"}),S.university]}),f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx(nh,{className:"h-3 w-3"}),S.dates.start," - ",S.dates.end]}),f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx(Dl,{className:"h-3 w-3 fill-yellow-400 text-yellow-400"}),S.rating," (",S.reviews," reviews)"]})]})]})]})})},S.id))}),f.jsxs("div",{className:"bg-blue-50 border border-blue-200 p-4 rounded-lg text-center",children:[f.jsx("h4",{className:"font-semibold text-blue-800 mb-2",children:"🎉 Profile Complete!"}),f.jsx("p",{className:"text-sm text-blue-700 mb-3",children:"You're all set! Start browsing matches and connect with other students."}),f.jsxs(wn,{variant:"secondary",className:"bg-blue-100 text-blue-800",children:["Found ",d.length," potential matches"]})]}),f.jsxs("div",{className:"flex justify-between",children:[f.jsx(Kt,{variant:"outline",onClick:t,disabled:!i,children:"Previous"}),f.jsx(Kt,{onClick:y,className:"px-8 bg-green-600 hover:bg-green-700",children:"Start Browsing Matches"})]})]})},ece=()=>{const[e,t]=H.useState(1),[i,a]=H.useState({university:"",program:"",preferredDates:{startDate:"",endDate:""},photos:[],verificationMethod:"email"}),d=5,y=e/d*100,S=[{number:1,title:"University & Program",component:Fle},{number:2,title:"Preferred Dates",component:Ble},{number:3,title:"Room Photos",component:Vle},{number:4,title:"Student Verification",component:Jle},{number:5,title:"Your First Matches",component:Qle}],s=()=>{e<d&&t(e+1)},N=()=>{e>1&&t(e-1)},D=$=>{a(q=>({...q,...$}))},O=S[e-1].component;return f.jsx("div",{className:"min-h-screen bg-gray-50 p-4",children:f.jsxs("div",{className:"max-w-2xl mx-auto",children:[f.jsxs("div",{className:"mb-8",children:[f.jsxs("div",{className:"flex items-center justify-between mb-4",children:[f.jsx("h1",{className:"text-2xl font-bold text-swap-blue",children:"Complete Your Profile"}),f.jsxs("span",{className:"text-sm text-gray-600",children:["Step ",e," of ",d]})]}),f.jsx(Iw,{value:y,className:"h-3 mb-2"}),f.jsxs("p",{className:"text-sm text-gray-600 text-center",children:[Math.round(y),"% Complete"]})]}),f.jsx("div",{className:"flex justify-center mb-8",children:f.jsx("div",{className:"flex space-x-4",children:S.map($=>f.jsxs("div",{className:"flex items-center",children:[f.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${e>$.number?"bg-green-500 text-white":e===$.number?"bg-swap-blue text-white":"bg-gray-200 text-gray-600"}`,children:e>$.number?f.jsx(pu,{className:"h-4 w-4"}):$.number}),$.number<d&&f.jsx("div",{className:`w-8 h-0.5 ${e>$.number?"bg-green-500":"bg-gray-200"}`})]},$.number))})}),f.jsxs(Zr,{children:[f.jsx(zn,{children:f.jsx(Fn,{children:S[e-1].title})}),f.jsx(Kr,{children:f.jsx(O,{data:i,onUpdate:D,onNext:s,onPrevious:N,canGoNext:e<d,canGoPrevious:e>1})})]})]})})},tce=()=>f.jsx(ece,{});var vI="Tabs",[rce,Fce]=ta(vI,[$g]),wU=$g(),[nce,bI]=rce(vI),SU=H.forwardRef((e,t)=>{const{__scopeTabs:i,value:a,onValueChange:d,defaultValue:y,orientation:S="horizontal",dir:s,activationMode:N="automatic",...D}=e,O=Qf(s),[$,q]=Xa({prop:a,onChange:d,defaultProp:y});return f.jsx(nce,{scope:i,baseId:ba(),value:$,onValueChange:q,orientation:S,dir:O,activationMode:N,children:f.jsx(wr.div,{dir:O,"data-orientation":S,...D,ref:t})})});SU.displayName=vI;var TU="TabsList",EU=H.forwardRef((e,t)=>{const{__scopeTabs:i,loop:a=!0,...d}=e,y=bI(TU,i),S=wU(i);return f.jsx(vP,{asChild:!0,...S,orientation:y.orientation,dir:y.dir,loop:a,children:f.jsx(wr.div,{role:"tablist","aria-orientation":y.orientation,...d,ref:t})})});EU.displayName=TU;var CU="TabsTrigger",MU=H.forwardRef((e,t)=>{const{__scopeTabs:i,value:a,disabled:d=!1,...y}=e,S=bI(CU,i),s=wU(i),N=IU(S.baseId,a),D=kU(S.baseId,a),O=a===S.value;return f.jsx(bP,{asChild:!0,...s,focusable:!d,active:O,children:f.jsx(wr.button,{type:"button",role:"tab","aria-selected":O,"aria-controls":D,"data-state":O?"active":"inactive","data-disabled":d?"":void 0,disabled:d,id:N,...y,ref:t,onMouseDown:Ht(e.onMouseDown,$=>{!d&&$.button===0&&$.ctrlKey===!1?S.onValueChange(a):$.preventDefault()}),onKeyDown:Ht(e.onKeyDown,$=>{[" ","Enter"].includes($.key)&&S.onValueChange(a)}),onFocus:Ht(e.onFocus,()=>{const $=S.activationMode!=="manual";!O&&!d&&$&&S.onValueChange(a)})})})});MU.displayName=CU;var AU="TabsContent",PU=H.forwardRef((e,t)=>{const{__scopeTabs:i,value:a,forceMount:d,children:y,...S}=e,s=bI(AU,i),N=IU(s.baseId,a),D=kU(s.baseId,a),O=a===s.value,$=H.useRef(O);return H.useEffect(()=>{const q=requestAnimationFrame(()=>$.current=!1);return()=>cancelAnimationFrame(q)},[]),f.jsx(Yi,{present:d||O,children:({present:q})=>f.jsx(wr.div,{"data-state":O?"active":"inactive","data-orientation":s.orientation,role:"tabpanel","aria-labelledby":N,hidden:!q,id:D,tabIndex:0,...S,ref:t,style:{...e.style,animationDuration:$.current?"0s":void 0},children:q&&y})})});PU.displayName=AU;function IU(e,t){return`${e}-trigger-${t}`}function kU(e,t){return`${e}-content-${t}`}var ice=SU,NU=EU,RU=MU,jU=PU;const wI=ice,Q2=H.forwardRef(({className:e,...t},i)=>f.jsx(NU,{ref:i,className:br("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...t}));Q2.displayName=NU.displayName;const lu=H.forwardRef(({className:e,...t},i)=>f.jsx(RU,{ref:i,className:br("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...t}));lu.displayName=RU.displayName;const cu=H.forwardRef(({className:e,...t},i)=>f.jsx(jU,{ref:i,className:br("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t}));cu.displayName=jU.displayName;const sce=()=>{const[e,t]=H.useState(""),[i,a]=H.useState(null),[d,y]=H.useState(""),S=[{id:"1",author:{name:"Sarah M.",university:"University of Amsterdam",verified:!0},content:"Just completed my first swap in Barcelona! The experience was amazing. My advice: communicate early and often with your swap partner about house rules and expectations.",timestamp:"2 hours ago",likes:12,replies:3},{id:"2",author:{name:"Miguel R.",university:"Universidad Complutense Madrid",verified:!0},content:"Looking for tips on handling cultural differences. My swap partner and I have very different cleaning standards. How do you navigate this diplomatically?",timestamp:"4 hours ago",likes:8,replies:7},{id:"3",author:{name:"Emma L.",university:"King's College London",verified:!1},content:"PSA: Always take photos before and after your stay! Saved me from a potential dispute about a stain that was already there.",timestamp:"6 hours ago",likes:15,replies:2}],s=()=>{e.trim()&&(console.log("Sending message:",e),t(""))},N=D=>{d.trim()&&(console.log("Sending reply to:",D,d),y(""),a(null))};return f.jsxs("div",{className:"space-y-6",children:[f.jsxs(Zr,{children:[f.jsx(zn,{children:f.jsxs(Fn,{className:"flex items-center gap-2",children:[f.jsx(vg,{className:"h-5 w-5"}),"Share Your Experience"]})}),f.jsxs(Kr,{className:"space-y-4",children:[f.jsx(fv,{placeholder:"Ask a question, share a tip, or tell us about your swap experience...",value:e,onChange:D=>t(D.target.value),className:"min-h-[100px]"}),f.jsxs("div",{className:"flex justify-between items-center",children:[f.jsx("p",{className:"text-sm text-gray-600",children:"Be respectful and helpful to fellow students"}),f.jsxs(Kt,{onClick:s,disabled:!e.trim(),children:[f.jsx(Y4,{className:"h-4 w-4 mr-2"}),"Post Message"]})]})]})]}),f.jsx("div",{className:"space-y-4",children:S.map(D=>f.jsx(Zr,{children:f.jsx(Kr,{className:"p-6",children:f.jsxs("div",{className:"flex items-start gap-4",children:[f.jsxs(Av,{children:[f.jsx(gI,{src:D.author.avatar}),f.jsx(Pv,{children:D.author.name.split(" ").map(O=>O[0]).join("")})]}),f.jsxs("div",{className:"flex-grow",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[f.jsx("h4",{className:"font-semibold",children:D.author.name}),D.author.verified&&f.jsx(wn,{variant:"secondary",className:"text-xs",children:"Verified Student"}),f.jsx("span",{className:"text-sm text-gray-500",children:D.author.university}),f.jsx("span",{className:"text-sm text-gray-400",children:"•"}),f.jsx("span",{className:"text-sm text-gray-400",children:D.timestamp})]}),f.jsx("p",{className:"text-gray-700 mb-4",children:D.content}),f.jsxs("div",{className:"flex items-center gap-4",children:[f.jsxs(Kt,{variant:"ghost",size:"sm",className:"text-gray-600",children:[f.jsx(jW,{className:"h-4 w-4 mr-1"}),D.likes]}),f.jsxs(Kt,{variant:"ghost",size:"sm",className:"text-gray-600",onClick:()=>a(D.id),children:[f.jsx(IW,{className:"h-4 w-4 mr-1"}),"Reply (",D.replies,")"]}),f.jsxs(R5,{children:[f.jsx(j5,{asChild:!0,children:f.jsx(Kt,{variant:"ghost",size:"sm",children:f.jsx(yW,{className:"h-4 w-4"})})}),f.jsx(IP,{children:f.jsxs(Ad,{children:[f.jsx(bW,{className:"h-4 w-4 mr-2"}),"Report"]})})]})]}),i===D.id&&f.jsx("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg",children:f.jsxs("div",{className:"flex gap-3",children:[f.jsx(fv,{placeholder:"Write your reply...",value:d,onChange:O=>y(O.target.value),className:"flex-grow",rows:2}),f.jsxs("div",{className:"flex flex-col gap-2",children:[f.jsx(Kt,{size:"sm",onClick:()=>N(D.id),disabled:!d.trim(),children:"Send"}),f.jsx(Kt,{variant:"outline",size:"sm",onClick:()=>a(null),children:"Cancel"})]})]})})]})]})})},D.id))})]})},oce=()=>{const[e,t]=H.useState(""),[i,a]=H.useState("all"),d=[{id:"paris",name:"Paris Exchange Students",description:"Connect with students heading to Paris for study abroad",location:"Paris",country:"France",members:234,posts:1456,lastActivity:"2 hours ago",featured:!0},{id:"london",name:"London Student Community",description:"Find your tribe in London - accommodation, social events, and tips",location:"London",country:"UK",members:187,posts:892,lastActivity:"4 hours ago",featured:!0},{id:"barcelona",name:"Barcelona Erasmus Hub",description:"Spanish adventure awaits! Connect before you arrive",location:"Barcelona",country:"Spain",members:156,posts:743,lastActivity:"1 hour ago",featured:!0},{id:"amsterdam",name:"Amsterdam International Students",description:"Bikes, canals, and great company in Amsterdam",location:"Amsterdam",country:"Netherlands",members:98,posts:456,lastActivity:"6 hours ago"},{id:"rome",name:"Rome Study Abroad",description:"When in Rome... connect with fellow students!",location:"Rome",country:"Italy",members:123,posts:567,lastActivity:"3 hours ago"},{id:"berlin",name:"Berlin Exchange Network",description:"Alternative culture and student life in Berlin",location:"Berlin",country:"Germany",members:89,posts:334,lastActivity:"5 hours ago"}],y=[{id:"1",title:"Looking for roommate in 6th arrondissement - January start",author:{name:"Sophie Chen",university:"Sciences Po Paris",destination:"Paris, France"},content:"Hi everyone! I'm starting my exchange at Sciences Po in January and looking for someone to share a 2-bedroom apartment in the 6th. Budget around €800/month each. I'm tidy, social, and love exploring the city!",timestamp:"2 hours ago",replies:7,category:"Housing"},{id:"2",title:"Best neighborhoods for students in London?",author:{name:"Marcus Johnson",university:"King's College London",destination:"London, UK"},content:"Starting at KCL in September. What are the best areas to look for accommodation? Considering Elephant & Castle, Bermondsey, or further south. Any advice on commute times and student life?",timestamp:"4 hours ago",replies:12,category:"General"},{id:"3",title:"Beach trip to Costa Brava - who's in?",author:{name:"Lucia Martinez",university:"Universitat de Barcelona",destination:"Barcelona, Spain"},content:"Planning a weekend trip to Costa Brava beaches in October. Looking for 3-4 people to share accommodation and travel costs. Perfect way to explore Catalonia together!",timestamp:"1 hour ago",replies:5,category:"Travel"}],S=[{id:"all",name:"All Posts",count:24},{id:"housing",name:"Housing",count:8},{id:"travel",name:"Travel Buddies",count:6},{id:"general",name:"General",count:7},{id:"social",name:"Social Events",count:3}];return f.jsxs("div",{className:"space-y-8",children:[f.jsxs("div",{className:"text-center",children:[f.jsxs("h2",{className:"text-3xl font-bold mb-4 flex items-center justify-center gap-2",children:[f.jsx(Qo,{className:"h-8 w-8 text-swap-blue"}),"Connect with Fellow Students"]}),f.jsx("p",{className:"text-gray-600 max-w-2xl mx-auto",children:"Join destination-specific forums to connect with other exchange students, find travel buddies, and get insider tips before your stay begins."})]}),f.jsxs(wI,{defaultValue:"forums",className:"space-y-6",children:[f.jsxs(Q2,{className:"grid w-full max-w-md mx-auto grid-cols-2",children:[f.jsx(lu,{value:"forums",children:"Browse Forums"}),f.jsx(lu,{value:"posts",children:"Recent Posts"})]}),f.jsxs(cu,{value:"forums",className:"space-y-6",children:[f.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[f.jsxs("div",{className:"relative flex-grow",children:[f.jsx(_w,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),f.jsx(Pn,{placeholder:"Search destinations...",className:"pl-10",value:e,onChange:s=>t(s.target.value)})]}),f.jsxs(Kt,{className:"flex items-center gap-2",children:[f.jsx(rv,{className:"h-4 w-4"}),"Request New Forum"]})]}),f.jsxs("div",{children:[f.jsxs("h3",{className:"text-xl font-semibold mb-4 flex items-center gap-2",children:[f.jsx(tv,{className:"h-5 w-5 text-swap-blue"}),"Popular Destinations"]}),f.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:d.filter(s=>s.featured).map(s=>f.jsxs(Zr,{className:"hover:shadow-lg transition-shadow border-l-4 border-l-swap-blue",children:[f.jsx(zn,{className:"pb-3",children:f.jsxs("div",{className:"flex items-start justify-between",children:[f.jsxs("div",{children:[f.jsxs(Fn,{className:"text-lg flex items-center gap-2",children:[f.jsx(Ec,{className:"h-4 w-4 text-swap-blue"}),s.name]}),f.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[s.location,", ",s.country]})]}),f.jsx(wn,{variant:"secondary",children:"Featured"})]})}),f.jsxs(Kr,{className:"space-y-4",children:[f.jsx("p",{className:"text-sm text-gray-700",children:s.description}),f.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsxs("span",{className:"flex items-center gap-1",children:[f.jsx(Qo,{className:"h-3 w-3"}),s.members]}),f.jsxs("span",{className:"flex items-center gap-1",children:[f.jsx(vg,{className:"h-3 w-3"}),s.posts]})]}),f.jsx("span",{className:"text-xs",children:s.lastActivity})]}),f.jsx(Kt,{className:"w-full",children:"Join Forum"})]})]},s.id))})]}),f.jsxs("div",{children:[f.jsx("h3",{className:"text-xl font-semibold mb-4",children:"All Destinations"}),f.jsx("div",{className:"space-y-4",children:d.map(s=>f.jsx(Zr,{className:"hover:shadow-md transition-shadow",children:f.jsx(Kr,{className:"p-6",children:f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{className:"flex items-center gap-4 flex-grow",children:[f.jsx("div",{className:"bg-swap-lightBlue p-3 rounded-lg",children:f.jsx(Ec,{className:"h-5 w-5 text-swap-blue"})}),f.jsxs("div",{className:"flex-grow",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[f.jsx("h4",{className:"font-semibold",children:s.name}),s.featured&&f.jsx(wn,{variant:"outline",className:"text-xs",children:"Featured"})]}),f.jsx("p",{className:"text-sm text-gray-600 mb-2",children:s.description}),f.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[f.jsxs("span",{children:[s.location,", ",s.country]}),f.jsx("span",{children:"•"}),f.jsxs("span",{children:[s.members," members"]}),f.jsx("span",{children:"•"}),f.jsxs("span",{children:["Active ",s.lastActivity]})]})]})]}),f.jsx(Kt,{variant:"outline",children:"Join"})]})})},s.id))})]})]}),f.jsxs(cu,{value:"posts",className:"space-y-6",children:[f.jsx("div",{className:"flex flex-wrap gap-2",children:S.map(s=>f.jsxs(Kt,{variant:i===s.id?"default":"outline",size:"sm",onClick:()=>a(s.id),className:"flex items-center gap-1",children:[s.name,f.jsx(wn,{variant:"secondary",className:"ml-1 text-xs",children:s.count})]},s.id))}),f.jsx("div",{className:"space-y-4",children:y.map(s=>f.jsx(Zr,{className:"hover:shadow-md transition-shadow",children:f.jsx(Kr,{className:"p-6",children:f.jsxs("div",{className:"flex items-start gap-4",children:[f.jsxs(Av,{children:[f.jsx(gI,{src:s.author.avatar}),f.jsx(Pv,{children:s.author.name.split(" ").map(N=>N[0]).join("")})]}),f.jsxs("div",{className:"flex-grow",children:[f.jsxs("div",{className:"flex items-start justify-between mb-2",children:[f.jsxs("div",{children:[f.jsx("h4",{className:"font-semibold text-lg mb-1",children:s.title}),f.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[f.jsx("span",{className:"font-medium",children:s.author.name}),f.jsx("span",{children:"•"}),f.jsx("span",{children:s.author.university}),f.jsx("span",{children:"•"}),f.jsxs("span",{className:"flex items-center gap-1",children:[f.jsx(AW,{className:"h-3 w-3"}),s.author.destination]})]})]}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx(wn,{variant:"outline",className:"text-xs",children:s.category}),f.jsxs("span",{className:"text-xs text-gray-500 flex items-center gap-1",children:[f.jsx(ev,{className:"h-3 w-3"}),s.timestamp]})]})]}),f.jsx("p",{className:"text-gray-700 mb-4",children:s.content}),f.jsxs("div",{className:"flex items-center gap-4",children:[f.jsxs(Kt,{variant:"ghost",size:"sm",className:"text-gray-600",children:[f.jsx(vg,{className:"h-4 w-4 mr-1"}),s.replies," replies"]}),f.jsx(Kt,{size:"sm",children:"Reply"})]})]})]})})},s.id))}),f.jsx("div",{className:"text-center pt-4",children:f.jsx(Kt,{variant:"outline",children:"Load More Posts"})})]})]})]})},ace=()=>{const[e,t]=H.useState(!1),{subscriptionData:i,isPremium:a,isBasic:d,isElite:y,loading:S}=H2(),s=a||d||y,N=[{title:"How to Clean and Leave the Place",description:"Complete checklist for preparing your space for your swap partner",category:"Preparation",readTime:"5 min",rating:4.8,views:1250,featured:!0},{title:"Cultural Etiquette Differences Checklist",description:"Navigate cultural differences and house rules respectfully",category:"Culture",readTime:"8 min",rating:4.9,views:980,featured:!0},{title:"What to Do if Your Match Falls Through",description:"Backup plans and emergency accommodation options",category:"Emergency",readTime:"6 min",rating:4.7,views:750,featured:!0},{title:"First Week Survival Guide",description:"Essential tips for settling into your temporary home",category:"Getting Started",readTime:"10 min",rating:4.6,views:1100},{title:"Managing Utilities and Bills",description:"How to handle shared expenses during your swap",category:"Practical",readTime:"7 min",rating:4.5,views:650},{title:"Communication Best Practices",description:"How to maintain clear communication with your swap partner",category:"Communication",readTime:"4 min",rating:4.8,views:890}];return f.jsxs("div",{className:"min-h-screen flex flex-col",children:[f.jsx(gi,{}),f.jsxs("main",{className:"flex-grow",children:[f.jsx("section",{className:"bg-swap-blue py-16",children:f.jsxs("div",{className:"max-w-7xl mx-auto px-4 md:px-8 text-center",children:[f.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-white mb-6",children:"Community & Support"}),f.jsx("p",{className:"text-xl text-white/90 max-w-3xl mx-auto mb-8",children:"Learn from experienced swappers and share your own knowledge"}),f.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[f.jsx(Kt,{size:"lg",variant:"secondary",children:"Browse Wiki Guides"}),f.jsx(Kt,{size:"lg",variant:"outline",className:"border-white text-white hover:bg-white hover:text-swap-blue",children:"Join Discussion"})]})]})}),f.jsx("section",{className:"py-16",children:f.jsx("div",{className:"max-w-7xl mx-auto px-4 md:px-8",children:f.jsxs(wI,{defaultValue:"wiki",className:"space-y-8",children:[f.jsxs(Q2,{className:"grid w-full max-w-lg mx-auto grid-cols-3",children:[f.jsxs(lu,{value:"wiki",className:"flex items-center gap-2",children:[f.jsx(iW,{className:"h-4 w-4"}),"Swap Wiki"]}),f.jsxs(lu,{value:"connect",className:"flex items-center gap-2",children:[f.jsx(Qo,{className:"h-4 w-4"}),"Connect",s&&f.jsx(gc,{className:"h-3 w-3 text-yellow-500"})]}),f.jsxs(lu,{value:"community",className:"flex items-center gap-2",children:[f.jsx(vg,{className:"h-4 w-4"}),"Chat",s&&f.jsx(gc,{className:"h-3 w-3 text-yellow-500"})]})]}),f.jsxs(cu,{value:"wiki",className:"space-y-8",children:[f.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center",children:[f.jsxs("div",{className:"relative flex-grow",children:[f.jsx(_w,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),f.jsx(Pn,{placeholder:"Search wiki guides...",className:"pl-10"})]}),f.jsxs(Kt,{variant:"outline",className:"flex items-center gap-2",children:[f.jsx(vW,{className:"h-4 w-4"}),"Filter by Category"]})]}),f.jsxs("div",{children:[f.jsxs("h2",{className:"text-2xl font-bold mb-6 flex items-center gap-2",children:[f.jsx(Dl,{className:"h-6 w-6 text-yellow-500"}),"Featured Guides"]}),f.jsx("div",{className:"grid md:grid-cols-3 gap-6 mb-8",children:N.filter(D=>D.featured).map((D,O)=>f.jsxs(Zr,{className:"hover:shadow-lg transition-shadow",children:[f.jsxs(zn,{children:[f.jsxs("div",{className:"flex items-start justify-between",children:[f.jsx(wn,{variant:"secondary",children:D.category}),f.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-600",children:[f.jsx(Dl,{className:"h-3 w-3 fill-yellow-400 text-yellow-400"}),D.rating]})]}),f.jsx(Fn,{className:"text-lg",children:D.title}),f.jsx(oo,{children:D.description})]}),f.jsxs(Kr,{children:[f.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600 mb-4",children:[f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx(ev,{className:"h-3 w-3"}),D.readTime]}),f.jsxs("div",{children:[D.views," views"]})]}),f.jsx(Kt,{className:"w-full",children:"Read Guide"})]})]},O))})]}),f.jsxs("div",{children:[f.jsx("h2",{className:"text-2xl font-bold mb-6",children:"All Guides"}),f.jsx("div",{className:"space-y-4",children:N.map((D,O)=>f.jsx(Zr,{className:"hover:shadow-md transition-shadow",children:f.jsx(Kr,{className:"p-6",children:f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{className:"flex-grow",children:[f.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[f.jsx("h3",{className:"text-lg font-semibold",children:D.title}),f.jsx(wn,{variant:"outline",className:"text-xs",children:D.category}),D.featured&&f.jsx(wn,{variant:"default",className:"text-xs",children:"Featured"})]}),f.jsx("p",{className:"text-gray-600 mb-2",children:D.description}),f.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx(ev,{className:"h-3 w-3"}),D.readTime]}),f.jsxs("div",{className:"flex items-center gap-1",children:[f.jsx(Dl,{className:"h-3 w-3 fill-yellow-400 text-yellow-400"}),D.rating]}),f.jsxs("div",{children:[D.views," views"]})]})]}),f.jsx(Kt,{variant:"outline",children:"Read"})]})})},O))})]})]}),f.jsx(cu,{value:"connect",className:"space-y-8",children:s?f.jsx(oce,{}):f.jsx("div",{className:"text-center py-12",children:f.jsxs(Zr,{className:"max-w-2xl mx-auto",children:[f.jsxs(zn,{children:[f.jsx("div",{className:"flex items-center justify-center mb-4",children:f.jsx("div",{className:"bg-swap-lightBlue p-4 rounded-full",children:f.jsx(Qo,{className:"h-8 w-8 text-swap-blue"})})}),f.jsx(Fn,{className:"text-2xl mb-2",children:"Members Only Forums"}),f.jsx(oo,{className:"text-lg",children:"Connect with other exchange students before your stay"})]}),f.jsxs(Kr,{children:[f.jsxs(_u,{className:"mb-6",children:[f.jsx(gc,{className:"h-4 w-4"}),f.jsx(yu,{children:"Access exclusive forums to connect with verified students, find travel buddies, and get destination-specific advice from locals."})]}),f.jsxs("div",{className:"space-y-4",children:[f.jsx("h4",{className:"font-semibold",children:"Connect Features:"}),f.jsxs("ul",{className:"text-left space-y-2 text-sm text-gray-600",children:[f.jsx("li",{children:"• Destination-specific forums"}),f.jsx("li",{children:"• Find students going to your city"}),f.jsx("li",{children:"• Connect before your exchange"}),f.jsx("li",{children:"• Local recommendations and tips"}),f.jsx("li",{children:"• Travel buddy matching"})]})]}),f.jsxs("div",{className:"mt-8 space-y-4",children:[f.jsx(Kt,{asChild:!0,size:"lg",className:"w-full",children:f.jsx(un,{to:"/signup",children:"Upgrade to Premium"})}),f.jsx(Kt,{variant:"outline",asChild:!0,className:"w-full",children:f.jsx(un,{to:"/help-tips",children:"Browse Free Resources"})})]})]})]})})}),f.jsx(cu,{value:"community",className:"space-y-8",children:s?f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:f.jsxs("div",{className:"flex items-start gap-4",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx(Qo,{className:"h-6 w-6 text-blue-600 flex-shrink-0"}),f.jsx(gc,{className:"h-4 w-4 text-yellow-500"})]}),f.jsxs("div",{children:[f.jsx("h3",{className:"font-semibold text-blue-800 mb-2 flex items-center gap-2",children:"Premium Community Guidelines"}),f.jsx("p",{className:"text-blue-700 text-sm",children:"Welcome to our premium community! This is a safe space for verified subscribers to share experiences and help fellow students. Please be respectful, helpful, and keep discussions relevant to accommodation swaps."})]})]})}),f.jsx(sce,{})]}):f.jsx("div",{className:"text-center py-12",children:f.jsxs(Zr,{className:"max-w-2xl mx-auto",children:[f.jsxs(zn,{children:[f.jsx("div",{className:"flex items-center justify-center mb-4",children:f.jsx("div",{className:"bg-swap-lightBlue p-4 rounded-full",children:f.jsx(p2,{className:"h-8 w-8 text-swap-blue"})})}),f.jsx(Fn,{className:"text-2xl mb-2",children:"Premium Feature"}),f.jsx(oo,{className:"text-lg",children:"Community chat is available for premium subscribers only"})]}),f.jsxs(Kr,{children:[f.jsxs(_u,{className:"mb-6",children:[f.jsx(gc,{className:"h-4 w-4"}),f.jsx(yu,{children:"Join our premium community to connect with verified students, share experiences, and get real-time help from fellow swappers."})]}),f.jsxs("div",{className:"space-y-4",children:[f.jsx("h4",{className:"font-semibold",children:"Premium Community Features:"}),f.jsxs("ul",{className:"text-left space-y-2 text-sm text-gray-600",children:[f.jsx("li",{children:"• Real-time chat with verified students"}),f.jsx("li",{children:"• Ask questions and get instant answers"}),f.jsx("li",{children:"• Share your swap experiences"}),f.jsx("li",{children:"• Get tips from experienced swappers"}),f.jsx("li",{children:"• Priority support from our team"})]})]}),f.jsxs("div",{className:"mt-8 space-y-4",children:[f.jsx(Kt,{asChild:!0,size:"lg",className:"w-full",children:f.jsx(un,{to:"/signup",children:"Upgrade to Premium"})}),f.jsx(Kt,{variant:"outline",asChild:!0,className:"w-full",children:f.jsx(un,{to:"/help-tips",children:"Browse Free Resources"})})]})]})]})})})]})})}),f.jsx("section",{className:"bg-gray-50 py-16",children:f.jsxs("div",{className:"max-w-4xl mx-auto px-4 md:px-8 text-center",children:[f.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Need More Help?"}),f.jsx("p",{className:"text-gray-600 mb-6",children:"Can't find what you're looking for? Our support team and AI assistant are here to help."}),f.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[f.jsx(Kt,{asChild:!0,children:f.jsx(un,{to:"/support",children:"Contact Support"})}),f.jsxs(Wg,{open:e,onOpenChange:t,children:[f.jsx(t0,{asChild:!0,children:f.jsxs(Kt,{variant:"outline",className:"flex items-center gap-2",children:[f.jsx(Ix,{className:"h-4 w-4"}),"Chat with Pubert"]})}),f.jsxs(np,{className:"max-w-4xl h-[80vh] p-0",children:[f.jsx(ip,{className:"p-6 pb-0",children:f.jsx(sp,{children:"Chat with Pubert - AI Assistant"})}),f.jsx("div",{className:"flex-grow p-6 pt-0",children:f.jsx(_I,{className:"h-full"})})]})]})]})]})})]}),f.jsx(_i,{})]})},lce=()=>{const[e,t]=H.useState("netherlands"),i={netherlands:{name:"Netherlands",summary:"Subletting requires landlord permission and rent control compliance",keyPoints:["Written permission from landlord required","Cannot charge more than your own rent","Maximum sublet period of 2 years","Must register with municipality"],links:[{title:"Government Subletting Guidelines",url:"https://www.government.nl/topics/housing/renting-a-house"},{title:"Rent Control Information",url:"https://www.huurcommissie.nl/english"},{title:"Municipality Registration",url:"https://www.government.nl/topics/population-register"}],penalties:"Fines up to €4,350 for illegal subletting"},germany:{name:"Germany",summary:"Subletting allowed with landlord consent, strict rental laws apply",keyPoints:["Landlord consent required (Untervermietungserlaubnis)","Cannot exceed 50% of apartment without consent","Rent increases limited by local rent index","Tenant protection laws very strong"],links:[{title:"German Tenancy Law",url:"https://www.germany.travel/en/ms/german-law/tenancy-law.html"},{title:"Subletting Rights",url:"https://www.mieterbund.de/english.html"},{title:"Registration (Anmeldung)",url:"https://service.berlin.de/en/"}],penalties:"Possible termination of lease and damages"},france:{name:"France",summary:"Subletting regulated, requires written agreement and rent control",keyPoints:["Written landlord authorization required","Cannot exceed original rent amount","Must provide 3-month notice to end sublease","Social housing subletting often prohibited"],links:[{title:"French Housing Law",url:"https://www.service-public.fr/particuliers/vosdroits/F920"},{title:"ADIL Housing Information",url:"https://www.anil.org/en/"},{title:"Prefecture Services",url:"https://www.demarches.interieur.gouv.fr/"}],penalties:"Termination of lease and potential legal action"},spain:{name:"Spain",summary:"Subletting allowed with restrictions, regional variations apply",keyPoints:["Landlord permission generally required","Duration limited to lease term","Tourist subletting highly regulated","Tax obligations on rental income"],links:[{title:"Spanish Housing Ministry",url:"https://www.mitma.gob.es/vivienda"},{title:"Consumer Rights",url:"https://www.consumo.gob.es/"},{title:"NIE Registration",url:"https://www.sanidad.gob.es/en/home.htm"}],penalties:"Fines and possible lease termination"}},a={netherlands:[{step:"Arrive in Netherlands",action:"Get temporary accommodation if needed"},{step:"Register with Municipality",action:"Visit local city hall within 5 days",required:!0},{step:"Get BSN Number",action:"Received automatically upon registration",required:!0},{step:"Open Bank Account",action:"Visit bank with BSN and passport",required:!0},{step:"Get Health Insurance",action:"Mandatory within 4 months",required:!0},{step:"Register with Tax Office",action:"If working or studying",required:!1}],germany:[{step:"Find Accommodation",action:"Secure housing before arrival if possible"},{step:"Anmeldung Registration",action:"Register address within 14 days",required:!0},{step:"Get Tax ID",action:"Automatic after registration",required:!0},{step:"Open Bank Account",action:"Needed for most transactions",required:!0},{step:"Health Insurance",action:"Mandatory for all residents",required:!0},{step:"University Enrollment",action:"If applicable",required:!1}],france:[{step:"Validate Visa",action:"If required, validate within 3 months"},{step:"Open Bank Account",action:"Often needed for accommodation",required:!0},{step:"Get Social Security",action:"Register with CPAM",required:!0},{step:"Prefecture Registration",action:"For residence permit if needed",required:!0},{step:"Tax Registration",action:"Get tax number",required:!1},{step:"CAF Housing Aid",action:"Apply for housing assistance",required:!1}],spain:[{step:"Get NIE Number",action:"Foreigner identification number",required:!0},{step:"Open Bank Account",action:"Usually requires NIE",required:!0},{step:"Register with Municipality",action:"Empadronamiento certificate",required:!0},{step:"Social Security",action:"If working or studying",required:!1},{step:"Health Card",action:"Access to healthcare",required:!0},{step:"Tax Registration",action:"If earning income",required:!1}]},d=Object.keys(i),y=[{title:"Complete Your Academic Profile",description:"Include your university, program, and study period details",icon:f.jsx(yw,{className:"h-5 w-5 text-green-600"}),tips:["Use your official university email for verification","Be specific about your exchange program dates","Include your field of study and year level","Mention any specific academic requirements"]},{title:"Define Your Housing Preferences",description:"Be clear about what type of accommodation you're seeking",icon:f.jsx(Xm,{className:"h-5 w-5 text-blue-600"}),tips:["Specify preferred location or neighborhood","Indicate accommodation type (studio, shared, etc.)","Mention important amenities (WiFi, kitchen, etc.)","Set realistic expectations for housing standards"]},{title:"Set Accurate Availability",description:"Provide precise dates for your exchange period",icon:f.jsx(ev,{className:"h-5 w-5 text-purple-600"}),tips:["Include some flexibility in your dates if possible","Consider travel time before and after studies","Account for visa processing time","Update dates if your plans change"]},{title:"Optimize for Better Matches",description:"Help our algorithm find the most compatible partners",icon:f.jsx(RW,{className:"h-5 w-5 text-orange-600"}),tips:["Be honest about your lifestyle and habits","Include information about your academic goals","Mention language skills and preferences","Add details about your home city/accommodation"]}];return f.jsxs("div",{className:"min-h-screen flex flex-col bg-gray-50",children:[f.jsx(gi,{}),f.jsx("main",{className:"flex-grow",children:f.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-6xl",children:[f.jsxs("div",{className:"text-center mb-8",children:[f.jsx("h1",{className:"text-4xl font-bold text-swap-blue mb-4",children:"Help & Tips"}),f.jsx("p",{className:"text-xl text-gray-600 max-w-3xl mx-auto",children:"Get the most out of SwapSpot's matching system and prepare for your exchange"})]}),f.jsxs(wI,{defaultValue:"matching",className:"space-y-6",children:[f.jsxs(Q2,{className:"grid w-full grid-cols-3",children:[f.jsx(lu,{value:"matching",children:"Matching Tips"}),f.jsx(lu,{value:"legal",children:"Legal Info"}),f.jsx(lu,{value:"preparation",children:"Exchange Prep"})]}),f.jsxs(cu,{value:"matching",className:"space-y-6",children:[f.jsxs(Zr,{children:[f.jsx(zn,{children:f.jsxs(Fn,{className:"flex items-center gap-2",children:[f.jsx(Dl,{className:"h-5 w-5"}),"How to Get Better Matches"]})}),f.jsxs(Kr,{children:[f.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:y.map((S,s)=>f.jsxs("div",{className:"border rounded-lg p-6",children:[f.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[S.icon,f.jsx("h3",{className:"font-semibold",children:S.title})]}),f.jsx("p",{className:"text-sm text-gray-600 mb-4",children:S.description}),f.jsx("ul",{className:"space-y-2",children:S.tips.map((N,D)=>f.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[f.jsx(pu,{className:"h-3 w-3 text-green-600 flex-shrink-0 mt-0.5"}),f.jsx("span",{children:N})]},D))})]},s))}),f.jsxs(_u,{className:"mt-6",children:[f.jsx(Km,{className:"h-4 w-4"}),f.jsxs(yu,{children:[f.jsx("strong",{children:"Pro Tip:"})," The more complete and accurate your profile, the better matches you'll receive. Our algorithm works best with detailed information about your preferences and requirements."]})]})]})]}),f.jsxs(Zr,{children:[f.jsx(zn,{children:f.jsx(Fn,{children:"Understanding Your Match Notifications"})}),f.jsx(Kr,{className:"space-y-4",children:f.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[f.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[f.jsx("h4",{className:"font-semibold text-green-800 mb-2",children:"High Compatibility (90%+)"}),f.jsx("p",{className:"text-sm text-green-700",children:"Excellent match with aligned dates, location preferences, and academic goals."})]}),f.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[f.jsx("h4",{className:"font-semibold text-blue-800 mb-2",children:"Good Match (70-89%)"}),f.jsx("p",{className:"text-sm text-blue-700",children:"Strong compatibility with minor differences that may be negotiable."})]}),f.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[f.jsx("h4",{className:"font-semibold text-yellow-800 mb-2",children:"Potential Match (50-69%)"}),f.jsx("p",{className:"text-sm text-yellow-700",children:"Some compatibility factors align, but may require more discussion."})]})]})})]})]}),f.jsxs(cu,{value:"legal",className:"space-y-6",children:[f.jsxs("div",{className:"mb-8",children:[f.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Select Your Country"}),f.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:d.map(S=>f.jsx(Kt,{variant:e===S?"default":"outline",onClick:()=>t(S),className:"capitalize",children:i[S].name},S))})]}),f.jsxs(Zr,{children:[f.jsx(zn,{children:f.jsxs(Fn,{className:"flex items-center gap-2",children:[f.jsx(Ao,{className:"h-5 w-5"}),"Subletting Laws in ",i[e].name]})}),f.jsxs(Kr,{className:"space-y-6",children:[f.jsxs(_u,{children:[f.jsx(Km,{className:"h-4 w-4"}),f.jsxs(yu,{children:[f.jsx("strong",{children:"Summary:"})," ",i[e].summary]})]}),f.jsxs("div",{children:[f.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Key Requirements"}),f.jsx("ul",{className:"space-y-2",children:i[e].keyPoints.map((S,s)=>f.jsxs("li",{className:"flex items-start gap-2",children:[f.jsx(pu,{className:"h-4 w-4 text-green-600 flex-shrink-0 mt-0.5"}),f.jsx("span",{children:S})]},s))})]}),f.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[f.jsx("h4",{className:"font-semibold text-red-800 mb-2",children:"⚠️ Penalties for Illegal Subletting"}),f.jsx("p",{className:"text-red-700",children:i[e].penalties})]}),f.jsxs("div",{children:[f.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Official Resources"}),f.jsx("div",{className:"space-y-2",children:i[e].links.map((S,s)=>f.jsxs("a",{href:S.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-swap-blue hover:underline",children:[f.jsx(x3,{className:"h-4 w-4"}),S.title]},s))})]})]})]})]}),f.jsxs(cu,{value:"preparation",className:"space-y-6",children:[f.jsxs(Zr,{children:[f.jsx(zn,{children:f.jsxs(Fn,{className:"flex items-center gap-2",children:[f.jsx(yw,{className:"h-5 w-5"}),"Registration Steps in ",i[e].name]})}),f.jsx(Kr,{children:f.jsx("div",{className:"space-y-4",children:a[e].map((S,s)=>f.jsxs("div",{className:"flex items-start gap-4 p-4 border rounded-lg",children:[f.jsx("div",{className:"flex-shrink-0",children:f.jsx("div",{className:"w-8 h-8 bg-swap-blue text-white rounded-full flex items-center justify-center text-sm font-semibold",children:s+1})}),f.jsxs("div",{className:"flex-grow",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[f.jsx("h4",{className:"font-semibold",children:S.step}),S.required&&f.jsx(wn,{variant:"destructive",className:"text-xs",children:"Required"})]}),f.jsx("p",{className:"text-gray-600",children:S.action})]})]},s))})})]}),f.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[f.jsxs(Zr,{children:[f.jsx(zn,{children:f.jsxs(Fn,{className:"flex items-center gap-2",children:[f.jsx(tv,{className:"h-5 w-5"}),"Essential Resources"]})}),f.jsx(Kr,{className:"space-y-4",children:f.jsxs("div",{className:"space-y-3",children:[f.jsxs("a",{href:"https://www.embassyworld.com/",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-swap-blue hover:underline",children:[f.jsx(x3,{className:"h-4 w-4"}),"Embassy Finder Worldwide"]}),f.jsxs("a",{href:"https://www.xe.com/currencyconverter/",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-swap-blue hover:underline",children:[f.jsx(W4,{className:"h-4 w-4"}),"Currency Converter"]}),f.jsxs("a",{href:"https://www.timeanddate.com/worldclock/",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-swap-blue hover:underline",children:[f.jsx(tv,{className:"h-4 w-4"}),"World Time Zones"]})]})})]}),f.jsxs(Zr,{children:[f.jsx(zn,{children:f.jsxs(Fn,{className:"flex items-center gap-2",children:[f.jsx(MW,{className:"h-5 w-5"}),"Emergency Numbers"]})}),f.jsx(Kr,{className:"space-y-3",children:f.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[f.jsxs("div",{children:[f.jsx("strong",{children:"EU Emergency:"})," 112"]}),f.jsxs("div",{children:[f.jsx("strong",{children:"Netherlands:"})," 112"]}),f.jsxs("div",{children:[f.jsx("strong",{children:"Germany:"})," 112"]}),f.jsxs("div",{children:[f.jsx("strong",{children:"France:"})," 112"]}),f.jsxs("div",{children:[f.jsx("strong",{children:"Spain:"})," 112"]}),f.jsxs("div",{children:[f.jsx("strong",{children:"UK:"})," 999"]})]})})]})]})]})]}),f.jsx(Zr,{className:"mt-8 bg-gradient-to-r from-swap-blue to-swap-darkBlue text-white",children:f.jsxs(Kr,{className:"p-8 text-center",children:[f.jsx("h3",{className:"text-2xl font-bold mb-4",children:"Ready to Find Your Perfect Match?"}),f.jsx("p",{className:"mb-6",children:"Complete your profile and let our intelligent matching system find compatible students for you"}),f.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[f.jsx(Kt,{variant:"secondary",asChild:!0,children:f.jsx("a",{href:"/signup",children:"Create Your Profile"})}),f.jsx(Kt,{variant:"outline",className:"text-white border-white hover:bg-white hover:text-swap-blue",asChild:!0,children:f.jsx("a",{href:"/community",children:"Join Community Chat"})})]})]})})]})}),f.jsx(_i,{})]})},cce=()=>{const[e,t]=H.useState(!1);return f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"fixed bottom-6 right-6 z-50",children:f.jsx(Kt,{onClick:()=>t(!0),className:"h-14 w-14 rounded-full shadow-lg bg-swap-blue hover:bg-swap-blue/90 text-white",size:"icon",children:f.jsx(Z4,{className:"h-6 w-6"})})}),f.jsx(Wg,{open:e,onOpenChange:t,children:f.jsxs(np,{className:"max-w-4xl h-[80vh] p-0",children:[f.jsxs(ip,{className:"p-6 pb-0 flex flex-row items-center justify-between",children:[f.jsx(sp,{children:"Chat with John - AI Assistant"}),f.jsx(Kt,{variant:"ghost",size:"icon",onClick:()=>t(!1),className:"h-6 w-6 p-0",children:f.jsx(wc,{className:"h-4 w-4"})})]}),f.jsx("div",{className:"flex-grow p-6 pt-0",children:f.jsx(_I,{className:"h-full"})})]})})]})},uce=new GY({defaultOptions:{queries:{retry:1,refetchOnWindowFocus:!1}}}),dce=()=>{const[e,t]=H.useState(!0),[i,a]=H.useState(null);return H.useEffect(()=>{try{console.log("App initialized"),console.log("Supabase client available:",!!Pi),Pi.auth.getSession().then(({data:d,error:y})=>{y?console.error("Supabase session error:",y):console.log("Supabase connection working",d.session?"User is logged in":"No active session"),t(!1)}).catch(d=>{console.error("Error checking Supabase session:",d),t(!1)})}catch(d){console.error("Application startup error:",d),a("Failed to initialize application. Please check the console for more details."),t(!1)}},[]),e?f.jsx("div",{className:"flex h-screen w-full items-center justify-center",children:"Loading..."}):i?f.jsxs("div",{className:"flex h-screen w-full flex-col items-center justify-center p-4 text-center",children:[f.jsx("h1",{className:"text-2xl font-bold text-red-600 mb-4",children:"Application Error"}),f.jsx("p",{className:"mb-4",children:i}),f.jsx("p",{className:"text-sm",children:"Please check your browser console for more details."})]}):f.jsx(HY,{client:uce,children:f.jsx(_oe,{children:f.jsxs(bY,{children:[f.jsx(v9,{}),f.jsx(Y9,{}),f.jsxs(UX,{children:[f.jsxs(jX,{children:[f.jsx(Li,{path:"/",element:f.jsx(dre,{})}),f.jsx(Li,{path:"/signup",element:f.jsx(Ure,{})}),f.jsx(Li,{path:"/required-signup",element:f.jsx(Foe,{})}),f.jsx(Li,{path:"/login",element:f.jsx($re,{})}),f.jsx(Li,{path:"/how-it-works",element:f.jsx(qre,{})}),f.jsx(Li,{path:"/browse",element:f.jsx(nC,{})}),f.jsx(Li,{path:"/about",element:f.jsx(Yse,{})}),f.jsx(Li,{path:"/swaps/:id",element:f.jsx(xoe,{})}),f.jsx(Li,{path:"/aupair/:id",element:f.jsx(Moe,{})}),f.jsx(Li,{path:"/rentals/:id",element:f.jsx(Poe,{})}),f.jsx(Li,{path:"/verify",element:f.jsx(Ioe,{})}),f.jsx(Li,{path:"/onboarding",element:f.jsx(tce,{})}),f.jsx(Li,{path:"/account",element:f.jsx(Noe,{})}),f.jsx(Li,{path:"/post-place",element:f.jsx(zoe,{})}),f.jsx(Li,{path:"/safety",element:f.jsx(Boe,{})}),f.jsx(Li,{path:"/faq",element:f.jsx(Voe,{})}),f.jsx(Li,{path:"/terms",element:f.jsx(Uoe,{})}),f.jsx(Li,{path:"/careers",element:f.jsx($oe,{})}),f.jsx(Li,{path:"/support",element:f.jsx(zle,{})}),f.jsx(Li,{path:"/community",element:f.jsx(ace,{})}),f.jsx(Li,{path:"/help-tips",element:f.jsx(lce,{})}),f.jsx(Li,{path:"/aupair",element:f.jsx(nC,{})}),f.jsx(Li,{path:"/rentals",element:f.jsx(nC,{})}),f.jsx(Li,{path:"*",element:f.jsx(Gre,{})})]}),f.jsx(cce,{})]})]})})})};g4(document.getElementById("root")).render(f.jsx(dce,{}));export{ZM as g};
